{"version":3,"sources":["pageedit.js"],"names":["exports","undefined","require","ids","callback","module","defs","i","length","modules","resolve","push","apply","define","id","dependencies","definition","arguments","target","fragments","split","fi","expose","privateModules","AMDLC_TESTS","relativePosition","rect","targetRect","rel","x","y","w","h","targetW","targetH","round","create","findBestRelativePosition","constrainRect","rels","pos","inflate","intersect","cropRect","x1","y1","x2","y2","max","min","clamp","clampRect","fixedSize","underflowX1","underflowY1","overflowX2","overflowY2","cx2","cy2","fromClientRect","clientRect","left","top","width","height","Math","bind","fn","thisArg","Promise","this","TypeError","_state","_value","_deferreds","doResolve","reject","handle","deferred","me","asap","cb","onFulfilled","onRejected","ret","e","newValue","then","finale","call","len","Handler","done","value","reason","ex","window","immediateFn","setImmediate","setTimeout","isArray","Array","Object","prototype","toString","all","args","slice","res","val","remaining","constructor","race","values","requestAnimationFrame","element","featurefill","requestAnimationFrameFunc","vendors","wrappedSetTimeout","time","wrappedSetInterval","setInterval","wrappedClearTimeout","clearTimeout","wrappedClearInterval","clearInterval","requestAnimationFramePromise","document","body","setEditorTimeout","editor","removed","setEditorInterval","timer","throttle","func","stop","matchMediaQuery","query","matchMedia","matches","opera","webkit","ie","ie11","ie12","gecko","mac","iDevice","android","fileApi","phone","tablet","windowsPhone","nav","navigator","userAgent","buildNumber","test","appName","exec","indexOf","URL","createObjectURL","contentEditable","match","iOS","transparentSrc","caretAfter","range","getSelection","documentMode","ceFalse","desktop","Delay","Env","addEvent","name","capture","addEventListener","attachEvent","removeEvent","removeEventListener","detachEvent","getTargetFromShadowDom","event","defaultTarget","path","deepPath","fix","originalEvent","data","returnFalse","returnTrue","undef","deprecated","srcElement","experimentalShadowDom","mouseEventRe","type","pageX","clientX","eventDoc","ownerDocument","doc","documentElement","scrollLeft","clientLeft","pageY","clientY","scrollTop","clientTop","preventDefault","isDefaultPrevented","returnValue","stopPropagation","isPropagationStopped","cancelBubble","stopImmediatePropagation","isImmediatePropagationStopped","metaKey","bindOnReady","win","eventUtils","readyHandler","domLoaded","waitForDomLoaded","readyState","tryScroll","doScroll","self","EventUtils","executeHandlers","evt","callbackList","l","container","events","scope","count","expando","hasFocusIn","hasMouseEnterLeave","mouseEnterLeave","eventExpandoPrefix","Date","mouseenter","mouseleave","names","defaultNativeHandler","fakeName","nativeHandler","nodeType","current","related","currentTarget","relatedTarget","contains","parentNode","unbind","ci","eventMap","concat","fire","defaultView","parentWindow","clean","children","getElementsByTagName","destroy","cancel","keyLocation","layerX","layerY","webkitMovementX","webkitMovementY","keyIdentifier","Event","Sizzle","selector","context","results","seed","elem","m","groups","old","nid","newContext","newSelector","preferredDoc","setDocument","documentIsHTML","rquickExpr","getElementById","support","getElementsByClassName","qsa","rbuggyQSA","nodeName","toLowerCase","tokenize","getAttribute","replace","rescape","setAttribute","toSelector","rsibling","testContext","join","querySelectorAll","qsaError","removeAttribute","select","rtrim","createCache","cache","key","keys","Expr","cacheLength","shift","markFunction","assert","div","createElement","removeChild","addHandle","attrs","handler","arr","attrHandle","siblingCheck","a","b","cur","diff","sourceIndex","MAX_NEGATIVE","nextSibling","createInputPseudo","createButtonPseudo","createPositionalPseudo","argument","j","matchIndexes","strundefined","setFilters","tokens","addCombinator","matcher","combinator","base","dir","checkNonElements","doneName","first","xml","oldCache","outerCache","newCache","dirruns","elementMatcher","matchers","multipleContexts","contexts","condense","unmatched","map","filter","newUnmatched","mapped","setMatcher","preFilter","postFilter","postFinder","postSelector","temp","preMap","postMap","preexisting","elems","matcherIn","matcherOut","splice","matcherFromTokens","checkContext","leadingRelative","relative","implicitRelative","matchContext","matchAnyContext","outermostContext","matcherFromGroupMatchers","elementMatchers","setMatchers","bySet","byElement","superMatcher","outermost","matchedCount","setMatched","contextBackup","find","dirrunsUnique","random","pop","uniqueSort","getText","isXML","compile","sortInput","hasDuplicate","docElem","rbuggyMatches","classCache","tokenCache","compilerCache","sortOrder","hasOwn","hasOwnProperty","push_native","booleans","whitespace","identifier","attributes","pseudos","RegExp","rcomma","rcombinators","rattributeQuotes","rpseudo","ridentifier","matchExpr","ID","CLASS","TAG","ATTR","PSEUDO","CHILD","bool","needsContext","rinputs","rheader","rnative","runescape","funescape","_","escaped","escapedWhitespace","high","String","fromCharCode","childNodes","els","node","getTop","hasCompare","parent","className","appendChild","createComment","getById","getElementsByName","attrId","getAttributeNode","tag","tmp","innerHTML","input","matchesSelector","webkitMatchesSelector","mozMatchesSelector","oMatchesSelector","msMatchesSelector","disconnectedMatch","compareDocumentPosition","adown","bup","compare","sortDetached","aup","ap","bp","unshift","expr","elements","attr","specified","error","msg","Error","duplicates","detectDuplicates","sortStable","sort","textContent","firstChild","nodeValue","selectors","createPseudo",">"," ","+","~","excess","unquoted","nodeNameSelector","pattern","operator","check","result","what","last","simple","forward","ofType","nodeIndex","start","useCache","lastChild","pseudo","idx","matched","not","has","text","innerText","lang","elemLang","hash","location","root","focus","activeElement","hasFocus","href","tabIndex","enabled","disabled","checked","selected","selectedIndex","empty","header","button","eq","even","odd","lt","gt","radio","checkbox","file","password","image","submit","reset","filters","parseOnly","soFar","preFilters","cached","token","compiled","div1","defaultValue","toArray","obj","array","each","o","s","n","out","item","index","f","v","reduce","collection","iteratee","accumulator","findIndex","predicate","Arr","trim","str","whiteSpaceRegExp","is","makeMap","items","delim","p","sp","ns","cn","scn","c","de","createNS","onCreate","extend","ext","walk","explode","d","_addCacheSuffix","url","cacheSuffix","grep","inArray","Tools","isDefined","isString","isWindow","createFragment","html","fragDoc","frag","createDocumentFragment","domManipulate","targetNodes","sourceItem","reverse","getElementDocument","DomQuery","makeArray","hasClass","wrap","wrapper","lastParent","newWrapper","cloneNode","insertBefore","init","el","prop","until","sibling","siblingName","firstSibling","appendHooks","targetHooks","hooks","skipUniques","numericCssMap","booleanMap","propFix","for","class","readonly","cssFix","float","attrHooks","cssHooks","charAt","add","nodes","unique","hook","get","set","removeAttr","css","camel","toUpperCase","dashed","elm","style","removeProperty","getComputedStyle","getPropertyValue","currentStyle","remove","append","host","prepend","before","after","appendTo","prependTo","replaceWith","content","wrapAll","wrapInner","contents","unwrap","clone","addClass","toggleClass","removeClass","state","existingClassName","classState","on","off","trigger","show","hide","closest","offset","docElm","getBoundingClientRect","object","parents","next","prev","contentDocument","contentWindow","parentsUntil","nextUntil","prevUntil","overrideDefaults","sub","defaults","maxlength","maxLength","size","cssText","opacity","zoom","settings","schema","toHex","r","g","hex","parseInt","encodingItems","validStyles","invalidStyles","rgbRegExp","urlOrStrRegExp","styleRegExp","trimRightRegExp","encodingLookup","invisibleChar","getValidStyles","getInvalidStyles","color","parse","compress","prefix","suffix","noJoin","right","bottom","styles","box","canCompress","compress2","encode","isEncoded","decode","keep_slashes","processUrl","url2","url3","str2","allow_script_urls","scriptUrl","allow_svg_data_urls","urlConverter","urlConverterScope","url_converter","url_converter_scope","substr","lastIndex","border","serialize","elementName","serializeStyles","styleList","isValid","styleMap","startNode","rootNode","findSibling","startName","shallow","findPreviousNode","child","prev2","Range","dom","setStart","_setEndPoint","TRUE","setEnd","FALSE","setStartBefore","setStartAfter","setEndBefore","setEndAfter","collapse","ts","END_CONTAINER","START_CONTAINER","END_OFFSET","START_OFFSET","collapsed","selectNode","selectNodeContents","compareBoundaryPoints","sc","so","ec","eo","rsc","startContainer","rso","startOffset","rec","endContainer","reo","endOffset","_compareBoundaryPoints","deleteContents","_traverse","DELETE","extractContents","EXTRACT","cloneContents","CLONE","insertNode","nn","insertAfter","splitText","surroundContents","cloneRange","commonAncestorContainer","_getSelectedNode","_isCollapsed","containerA","offsetA","containerB","offsetB","offsetC","cmnRoot","childA","childB","findCommonAncestor","st","how","depthDiff","endNode","ep","endContainerDepth","startContainerDepth","_traverseSameContainer","_traverseCommonStartContainer","_traverseCommonEndContainer","_traverseCommonAncestors","cnt","xferNode","substring","deleteData","createTextNode","_traverseFullySelected","endAncestor","endIdx","_traverseRightBoundary","previousSibling","startAncestor","startIdx","_traverseLeftBoundary","clonedParent","prevSibling","clonedChild","clonedGrandParent","isFullySelected","_traverseNode","isLeft","txtValue","newNodeValue","oldNodeValue","newNode","toStringIE","outerText","START_TO_START","START_TO_END","END_TO_END","END_TO_START","nativeDecode","buildEntitiesLookup","radix","chr","entity","lookup","baseEntities","namedEntities","reverseEntities","attrsCharsRegExp","textCharsRegExp","rawCharsRegExp","entityRegExp","asciiMap","128","130","131","132","133","134","135","136","137","138","139","140","142","145","146","147","148","149","150","151","152","153","154","155","156","158","159","\"","'","<","&","`","&lt;","&gt;","&amp;","&quot;","&apos;","Entities","encodeRaw","encodeAllRaw","encodeNumeric","charCodeAt","encodeNamed","entities","getEncodeFunc","encodeNamedAndNumeric","encodeCustomNamed","named","numeric","appendToHead","load","loadedCallback","errorCallback","passed","callbacks","status","failed","isOldWebKit","webKitChunks","wait","testCallback","waitCallback","getTime","startTime","maxLoadTime","waitForWebKitLinkLoaded","styleSheet","owner","styleSheets","ownerNode","owningElement","link","waitForGeckoLinkLoaded","cssRules","sheet","loadedStates","idCount","async","defer","onload","onerror","$","Styles","TreeWalker","StyleSheetLoader","setupAttrHooks","domUtils","keepUrlHook","keepValues","keep_values","$elm","serializeStyle","parseStyle","src","updateInternalStyleAttr","normalized","lastNodeType","DOMUtils","blockElementsMap","files","counter","stdMode","isIE","boxModel","compatMode","styleSheetLoader","boundEvents","fixDoc","ownEvents","proxy","getBlockElements","getRoot","isBlock","simpleSelectorRe","$$","getCustomElements","deep","getAttribs","setAttrib","getAttrib","root_element","getViewPort","rootElm","pageXOffset","pageYOffset","innerWidth","clientWidth","innerHeight","clientHeight","getRect","getPos","getSize","getStyle","offsetWidth","offsetHeight","getParent","getParents","collect","selectorVal","getNext","_findSib","getPrev","elms","parentElm","run","newElm","setAttribs","setHTML","createHTML","outHtml","keepChildren","setStyle","update_styles","computed","setStyles","removeAllAttribs","removeAttributeNode","originalValue","onSetAttrib","attrElm","attrName","attrValue","defaultVal","offsetParent","offsetLeft","offsetTop","addStyle","head","styleElm","DOM","addedStyles","loadCSS","recalc","cls","isHidden","uniqueId","canHaveHTML","getOuterHTML","outerHTML","setOuterHTML","referenceNode","oldElm","replaceChild","rename","attrNode","pe","ps","rgbVal","attrRegExp","isEmpty","walker","brCount","getNonEmptyElements","createRng","createRange","splitElm","replacementElm","trimNode","surroundedBySpans","previousIsSpan","nextIsSpan","trimmedLength","bef","aft","pa","getContentEditable","getContentEditableParent","isChildOf","dumpRng","ScriptLoader","loadScript","onreadystatechange","console","log","QUEUED","LOADING","LOADED","states","queue","scriptLoadedCallbacks","queueLoadedCallbacks","loading","isDone","markDone","loadQueue","loadScripts","scripts","execScriptLoadedCallbacks","loadingScripts","AddOnManager","urls","instance","requireLangPack","languages","language","languageLoad","addOn","createUrl","baseUrl","dep","resource","addComponents","pluginName","pluginUrl","script","addOnUrl","loadDependencies","newUrl","baseURL","lastIndexOf","PluginManager","ThemeManager","isNodeType","matchNodeNames","matchStyleValues","cssValue","isElement","hasPropValue","propName","propValue","hasAttributeValue","isBogus","hasAttribute","hasContentEditableState","isText","isComment","isBr","isContentEditableTrue","isContentEditableFalse","isZwsp","ZWSP","NodeType","Zwsp","isCaretContainerBlock","isCaretContainerInline","isCaretContainer","insertInline","textNode","endsWithCaretContainer","startsWithCaretContainer","insertBlock","blockName","blockNode","caretContainerNode","CaretContainer","getEndChild","RangeUtils","rng","exclude","collectSiblings","end_node","siblings","findEndPoint","walkBoundary","start_node","ancestor","startPoint","endPoint","hasChildNodes","normalize","normalizeEndPoint","isTableCell","hasBrBeforeAfter","hasContentEditableFalseParent","isPrevNode","findTextNodeRelative","lastInlineElement","parentBlockContainer","isAfterNode","nonEmptyElementsMap","directionLeft","findClosestIeRange","rects","elementFromPoint","createTextRange","tagName","moveToElementText","getClientRects","abs","moveToPoint","compareRanges","rng1","rng2","duplicate","isEqual","getCaretRangeFromPoint","point","caretPositionFromPoint","offsetNode","caretRangeFromPoint","getSelectedNode","getNode","isSameElementPath","startElm","currentPath","getBody","lastPath","lastRng","getDoc","nativeRng","fakeRng","selection","getRng","getStart","isCollapsed","nodeChanged","selectionChange","initialized","disable_nodechange","root_node","Node","typeLookup","#text","#comment","#cdata","#pi","#doctype","#document-fragment","insert","selfAttrs","selfAttr","cloneAttrs","shortEnded","ref_node","getAll","compileSchema","arrayToMap","ni","attributesOrder","globalAttributes","dummyObj","addAttrs","schemaItem","blockContent","phrasingContent","flowContent","html4BlockContent","html4PhrasingContent","mapCache","caption","table","compileElementMap","mode","*","createLookupTable","option","default_value","extendWith","patternToRegExp","addValidElements","validElements","ei","ai","al","attrData","attrType","outputName","globalAttributesOrder","elementRuleRegExp","attrRuleRegExp","hasPatternsRegExp","paddEmpty","removeEmpty","removeEmptyAttrs","attributesRequired","required","attributesDefault","attributesForced","forcedValue","validValues","attributePatterns","patternElements","setValidElements","schemaItems","addCustomElements","customElements","customElementRegExp","text_block_elements","block_elements","rule","inline","cloneName","customElementsMap","customRule","elmName","addValidChildren","validChildren","childRuleRegExp","getElementRule","whiteSpaceElementsMap","selfClosingElementsMap","shortEndedElementsMap","boolAttrMap","validClasses","moveCaretBeforeOnEnterElementsMap","textBlockElementsMap","textInlineElementsMap","specialElements","verify_html","valid_elements","valid_styles","invalid_styles","valid_classes","special","custom_elements","valid_children","extended_valid_elements","invalid_elements","getValidClasses","getBoolAttrs","getTextBlockElements","getTextInlineElements","getShortEndedElements","getSelfClosingElements","getMoveCaretBeforeOnEnterElements","getWhiteSpaceElements","getSpecialElements","isValidChild","attrPatterns","Schema","findEndTag","startIndex","tokenRegExp","shortEndedElements","SaxParser","noop","fix_self_closing","processEndTag","stack","valid","end","parseAttribute","val2","val3","attrRule","trimRegExp","fillAttrsMap","validate","isInternalElement","validAttributesMap","validAttributePatterns","filteredUrlAttrs","uri","decodeURIComponent","unescape","scriptUriRegExp","allow_html_data_urls","dataUriRegExp","attrList","endRegExp","removeInternalElements","isShortEnded","elementRule","isValidElement","attribsValue","anyAttributesRequired","selfClosing","fixSelfClosing","self_closing_elements","remove_internals","allow_conditional_comments","comment","cdata","doctype","pi","fixInvalidChildren","newParent","currentNode","tempNode","childNode","nonEmptyElements","nonSplitableElements","textBlockElements","nextNode","fixed","filterNode","nodeFilters","attributeFilters","matchedNodes","matchedAttributes","root_name","list","addNodeFilter","addAttributeFilter","addRootBlocks","rootBlockNode","startWhiteSpaceRegExp","endWhiteSpaceRegExp","rootBlockName","blockElements","createNode","forced_root_block_attrs","removeWhitespaceBefore","textNodeNext","textVal","cloneAndExcludeBlocks","output","parser","fl","isInWhiteSpacePreservedElement","allWhiteSpaceRegExp","isAllWhiteSpaceRegExp","whiteSpaceElements","invalidChildren","forced_root_block","raw","attrFiltersLen","invalid","isRootContent","remove_trailing_brs","prevName","allow_html_in_named_anchor","classList","classValue","validClassesMap","indent","indentBefore","indentAfter","htmlOutput","indent_before","indent_after","entity_encoding","element_format","getContent","Writer","writer","sortedAttrs","handlers","3","8","7","10","4","11","inner","DomParser","Serializer","trimTrailingBr","brNode1","brNode2","tempAttrs","trimHtml","trimContentRegExp","getTrimmedContent","endTagIndex","matchLength","bogusAllRegExp","addTempAttr","htmlParser","internalName","cleanup","fix_list_elements","impl","oldDoc","htmlSerializer","implementation","createHTMLDocument","importNode","format","no_events","onPreProcess","getInner","onPostProcess","addRules","rules","setRules","Selection","getPosition","checkRng","endIndex","inside","position","parentElement","floor","compareEndPoints","move","getRange","ieRange","textNodeOffset","domRange","tmpRange","element2","bookmark","number","getBookmark","moveToBookmark","getIndexes","indexes","getBookmarkEndPoint","ctrl","resolveIndexes","setBookmarkEndPoint","moveLeft","moveRng","moveStart","setEndPoint","createControlRange","addElement","addRange","marker","tmpRng","ieRng","ctrlRng","ctrlElm","clear","getRangeAt","BACKSPACE","DOWN","ENTER","LEFT","RIGHT","SPACEBAR","TAB","UP","modifierPressed","shiftKey","ctrlKey","altKey","metaKeyPressed","VK","isResizable","object_resizing","resizeGhostElement","deltaX","deltaY","proportional","resizeHelperX","resizeHelperY","screenX","startX","screenY","startY","selectedHandle","startW","startH","selectedElm","resize_img_proportional","ratio","selectedElmGhost","startPos","resizeHelper","display","selectedElmX","selectedElmY","rootElement","scrollWidth","startScrollWidth","scrollHeight","startScrollHeight","resizeStarted","endGhostResize","setSizeProp","editableDoc","rootDocument","showResizeRect","targetElm","mouseDownHandleName","mouseDownEvent","targetWidth","targetHeight","hideResizeRect","unbindResizeHandleEvents","detachResizeStartListener","resizeHandles","startDrag","unSelectabe","margin","data-mce-bogus","handleElm","unselectable","updateResizeRect","isChildOrEqual","controlElm","img","disableGeckoResize","getEnd","resizeNativeStart","corner","cornerX","cornerY","relativeX","relativeY","lastMouseDownEvent","nativeControlSelect","execCommand","controlSelect","nw","ne","se","sw","rootClass","contentStyles","delayedSelect","throttledUpdateResizeRect","composing","constant","negate","compose","or","and","curry","tempArgs","isCaretCandidate","isInvalidTextElement","isAtomicInline","isTable","isInEditable","isAtomicContentEditableFalse","isAtomic","isEditableCaretCandidate","toStart","rect1","rect2","isValidOverflow","overflowY","clientRect1","clientRect2","isAbove","isBelow","isRight","containsXY","isExtendingChar","ch","extendingChars","Fun","CaretCandidate","ClientRect","ExtendingChar","isWhiteSpace","isHiddenWhiteSpaceRange","isNotPre","getCaretPositionClientRects","caretPosition","getBrClientRect","brNode","nbsp","clientRects","collapseAndInflateWidth","addUniqueAndValidRect","addCharacterOffset","beforeNode","isAtEnd","resolveIndex","isValidElementCaretCandidate","CaretPosition","isAtStart","toRange","isVisible","isFloated","fromRangeStart","fromRangeEnd","DomUtils","normalizedParent","getChildNodes","normalizedTextOffset","equal","targetValue","normalizedNodeIndex","numTextFragments","createPathItem","outputOffset","resolvePathItem","findTextPosition","dataLen","targetOffset","parts","CaretBookmark","BookmarkManager","normalizeTableCellSelection","moveEndPoint","getLocation","getPoint","findAdjacentContentEditableFalseElm","tridentSel","pasteHTML","data-mce-type","keep","restoreEndPoint","appendData","addBogus","resolveCaretPositionBookmark","setRng","isBookmarkNode","TridentSelection","ControlSelection","serializer","bookmarkManager","controlSelection","setCursorLocation","_moveEndPoint","whiteSpaceBefore","whiteSpaceAfter","fragment","tmpElm","getSel","htmlText","setContent","caretNode","createContextualFragment","real","startElement","endElement","lastFocusBookmark","sel","w3c","tryCompareBoundaryPoints","sourceRange","destinationRange","rangeCount","selectedRange","explicitRange","removeAllRanges","setBaseAndExtent","setNode","skipEmptyTextNodes","forwards","orig","getSelectedBlocks","endElm","selectedBlocks","isForward","anchorRange","focusRange","anchorNode","focusNode","anchorOffset","focusOffset","selectorChanged","currentSelectors","selectorChangedData","matchedSelectors","getScrollContainer","scrollContainer","scrollIntoView","alignToTop","viewPort","viewPortY","viewPortH","offsetY","getWin","scrollTo","placeCaretAt","ElementUtils","node1","node2","attribs","compareObjects","obj1","obj2","getCssText","removeVars","previewElm","parentFontSize","previewStyles","previewCss","preview_styles","formatter","block","classes","parseFloat","addPostProcessHook","postProcessHooks","postProcess","hasPreSibling","pre","isPre","blocks","joinPre","pre1","pre2","Preview","Hooks","ed","isTextBlock","isInlineBlock","isCaretNode","defaultFormats","register","valigntop","verticalAlign","valignmiddle","valignbottom","alignleft","ceFalseOverride","textAlign","inherit","defaultBlock","aligncenter","marginLeft","marginRight","alignright","alignjustify","bold","fontWeight","italic","fontStyle","underline","textDecoration","exact","strikethrough","forecolor","links","remove_similar","hilitecolor","backgroundColor","fontname","fontFamily","fontsize","fontSize","fontsize_class","blockquote","subscript","superscript","code","onmatch","onformat","fmt","vars","removeformat","expand","block_expand","formats","addKeyboardShortcuts","addShortcut","mixed","unregister","matchesUnInheritedFormatSelector","formatList","getTextDecoration","decoration","processUnderlineAndColor","setElementFormat","replaceVars","styleVal","adjustSelectionToVisibleSelection","findSelectionEnd","newEnd","applyRngStyle","node_specific","wrapName","wrapElm","newWrappers","rangeUtils","process","parentName","found","lastContentEditable","isEq","currentWrapElm","matchNode","getChildCount","isWhiteSpaceNode","mergeStyles","matchName","childCount","removeFormat","merge_with_parents","merge_siblings","mergeSiblings","getNonWhiteSpaceSibling","expandRng","performCaretAction","curSelNode","forcedRootBlock","similar","findFormatRoot","formatRoot","wrapAndSplit","lastClone","firstClone","formatRootParent","splitToFormatRoot","removeRngStyle","getContainer","toggle","matchItems","item_name","normalizeStyleValue","matchParents","matchAll","matchedFormatNames","checkedMap","canApply","formatChanged","currentFormats","formatChangeData","matchedFormats","str1","findParentContainer","isBogusBr","findLeaf","findParentContentEditable","findWordEndPoint","findSpace","pos2","lastTextNode","findSelectorEndPoint","sibling_name","curFormat","findBlockEndPoint","lastIdx","leaf","isColorFormatAndAnchor","compare_node","stylesModified","valueOut","MCE_ATTR_RE","removeNode","inc","rootBlockElm","list_block","findElementSibling","tmpSibling","elementUtils","createCaretContainer","fill","caretContainer","caretContainerId","debug","INVISIBLE_CHAR","isCaretContainerEmpty","getParentCaretContainer","findFirstTextNode","removeCaretContainer","move_caret","applyCaretFormat","removeCaretFormat","hasContentAfter","formatNode","unmarkBogusCaretParents","caret_debug","_hasCaretEvents","markCaretContainersBogus","disableCaretContainer","keyCode","isAtEndOfText","tmpNode","setDirty","addNonTypingUndoLevel","typing","beforeBookmark","isFirstTypedCharacter","locks","cmd","command","beforeChange","isDirty","level","lastLevel","modKey","custom_undo_redo_levels","undo","redo","hasUndo","hasRedo","transact","extra","callback1","callback2","handleEnterKey","canSplitBlock","renderBlockOnIE","oldRng","trimInlineElementsOnLeftSideOfBlock","firstChilds","moveToCaretPosition","firstNonWhiteSpaceNodeSibling","tempElm","lastNode","parentBlock","setForcedBlockAttrs","forcedRootBlockName","emptyBlock","createNewBlock","clonedNode","textInlineElements","parentBlockName","newBlockName","keep_styles","editableRoot","isCaretAtStartOrEndOfBlock","isAfterLastNodeInContainer","wrapSelfAndSiblingsInDefaultBlock","newBlock","handleEmptyListItem","isFirstOrLastLi","containerBlock","getContainerBlock","containerBlockParent","containerBlockParentName","undoManager","insertBr","trimLeadingLineBreaks","getEditableRoot","addBrToBlockIfNeeded","insertNewBlockAfter","containerBlockName","end_container_on_empty_block","force_p_newlines","br_in_pre","wrapped","restoreSelection","rootNodeName","moveEnd","isForwards","direction","isBackwards","findNode","predicateFn","getEditingHost","getParentBlock","isBlockLike","isInSameBlock","caretPosition1","caretPosition2","isInSameEditingHost","getChildNodeAtRelativeOffset","relativeOffset","beforeAfter","isNodesInSameBlock","lean","normalizeRange","leanLeft","leanRight","isNextToContentEditableFalse","isBeforeContentEditableFalse","isAfterContentEditableFalse","CaretUtils","nodeAtIndex","getCaretCandidatePosition","isBrBeforeBlock","findCaretPosition","startCaretPosition","innerNode","rootContentEditableFalseElm","CaretWalker","isListFragment","cleanupDomFragment","domFragment","toDomFragment","listItems","trimListItems","getParentLi","isParentBlockLi","getSplit","beforeRng","afterRng","findFirstIn","caretPos","caretWalker","newCaretPos","findLastOf","insertMiddle","li","insertAtCaret","liTarget","liElms","BEGINNING","END","isAt","newPos","InsertList","insertHtmlAtCaret","details","trimOrPaddLeftRight","hasSiblingText","trimNbspAfterDeleteAndPaddValue","reduceInlineTextElements","merge","testNode","markFragmentElements","umarkFragmentElements","isPartOfFragment","canHaveChildren","moveSelectionToMarker","getContentEditableFalseParent","findNextCaretRng","parentEditableFalseElm","nextRng","bookmarkHtml","caretElement","parserArgs","_selectionOverrides","showBlockCaretContainer","addVisual","processValue","paste","InsertContent","isOldIE","ui","customCommand","skip_focus","commands","plugins","theme","queryCommandState","quirks","queryCommandValue","addCommands","command_list","addCommand","queryCommandSupported","addQueryStateHandler","addQueryValueHandler","hasCustomCommand","execNativeCommand","isFormatMatch","toggleFormat","storeSelection","mceResetDesignMode,mceBeginUndoLevel","mceEndUndoLevel,mceAddUndoLevel","Cut,Copy,Paste","queryCommandEnabled","translate","notificationManager","open","unlink","JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone","align","InsertUnorderedList,InsertOrderedList","listElm","listParent","Bold,Italic,Underline,Strikethrough,Superscript,Subscript","ForeColor,HiliteColor,FontName","FontSize","fontClasses","fontSizes","font_size_style_values","font_size_classes","RemoveFormat","mceBlockQuote","FormatBlock","mceCleanup","mceRemoveNode","mceSelectNodeDepth","mceSelectNode","mceInsertContent","mceInsertRawHTML","mceToggleFormat","mceSetContent","Indent,Outdent","intentValue","indentUnit","indentation","indentStyleName","getParam","mceRepaint","InsertHorizontalRule","mceToggleVisualAid","hasVisual","mceReplaceContent","mceInsertLink","anchor","selectAll","delete","mceNewDocument","InsertLineBreak","hasRightSideContent","brElm","extraBr","isControlKey","JustifyLeft,JustifyCenter,JustifyRight,JustifyFull","Outdent","inline_styles","paddingLeft","FontSize,FontName","Undo","Redo","URI","baseUri","base_url","base_uri","source","isProtocolRelative","protocol","directory","toAbsPath","queryParts","part","userInfo","port","DEFAULT_PORTS","ftp","http","https","mailto","setPath","getURI","toRelative","tu","uu","toRelPath","toAbsolute","noHost","isSameOrigin","defaultPort","breakPoint","tr","outPath","nb","k","noProtoHost","parseDataUri","getDocumentBaseUrl","loc","pathname","Class","extendClass","initializing","mixins","mixin","Mixins","dummy","createMethod","_super","member","Methods","Properties","fieldName","Statics","Defaults","Dispatcher","beforeFire","bindings","once","toggleEvent","bindingName","hi","nativeEvents","isNative","Binding","model","otherModel","otherName","fromSelfToOther","fromOtherToSelf","_bindings","EventDispatcher","getEventDispatcher","_eventDispatcher","toggleNativeEvent","bubble","hasEventListeners","Observable","isNode","oldValue","uniqueItems","__checked","Collection","expression","chunker","whiteSpace","Selector","compileNameFilter","compileIdFilter","_name","compileClassesFilter","compileAttrFilter","cmp","compilePsuedoFilter","notSelectors","parseChunks","direct","_selectors","control","si","sl","proto","getWindowSize","getRuntimeStyle","innerHtml","parseBox","measureBox","getSide","isNaN","ClassList","onchange","_map","_change","curState","clsValue","animationFrameRequested","dirtyCtrls","_layout","_id","reflow","ObservableObject","BoxUtils","ReflowQueue","_nativeEvents","bindPendingEvents","eventCtrl","delegate","getParentCtrl","mouseLeaveHandler","eventRootCtrl","_lastHoverCtrl","getEl","mouseEnterHandler","lastParents","lastCtrl","fixWheelEvent","wheelDelta","wheelDeltaX","detail","_eventsRoot","eventRootDelegates","_delegates","hasWheelEventSupport","_hasMouseEnter","hasMouseWheelEventSupport","Control","classPrefix","idCounter","isRtl","rtl","applyClasses","defaultClasses","_aria","role","_elmCache","visible","active","borderBox","paddingBox","padding","marginBox","hidden","getContainerElm","controlIdLookup","initLayoutRect","layoutRect","minWidth","minHeight","autoResize","startMinWidth","startMinHeight","initialSize","deltaW","deltaH","maxW","maxWidth","maxH","maxHeight","_layoutRect","contentW","contentH","innerW","innerH","minW","minH","scrollW","_lastLayoutRect","newRect","lastLayoutRect","deltaWidth","deltaHeight","repaintControls","curRect","repaint","bodyStyle","bodyElm","borderW","borderH","lastRepaintRect","_lastRepaintRect","_hasBody","updateLayoutRect","_lastRect","resolveCallbackName","parentsAndSelf","action","parentControls","$el","blur","aria","ariaTarget","newItems","controls","renderBefore","renderHtml","postRender","renderTo","preRender","render","parentEventsRoot","border-top-width","border-right-width","border-bottom-width","border-left-width","bindStates","parentCtrl","getOffset","parentWidth","parentHeight","rootControl","namespaceInit","types","typeClass","ControlType","namespace","tinymce","getRole","focusedElement","getParentRole","getAriaProp","isTextInputElement","canFocus","getFocusElements","getNavigationRoot","targetControl","navigationRoot","focusedControl","ariaRoot","focusFirst","focusElements","ariaRemember","moveFocusToIndex","lastAriaIndex","moveFocus","parentRole","submenu","enter","up","down","tab","handleNonTabOrEscEvent","Factory","KeyboardNavigation","selectorCache","_items","bodyClasses","containerCls","layout","keyboard","focusCtrl","keyboardNav","statusbar","autofocus","oldItem","newItem","ctrlItems","defaultType","renderNew","containerElm","curItems","beforeItems","afterItems","fromJSON","toJSON","lastRect","getDocumentSize","updateWithTouchData","changedTouches","getHandleElm","$eventOverlay","downButton","drag","cursor","docSize","runtimeStyle","zIndex","DragHelper","renderScroll","repaintScroll","repaintAxis","axisName","posName","sizeName","contentSizeName","hasScroll","ax","scrollBarElm","scrollThumbElm","containerSize","scrollSize","posNameLower","sizeNameLower","hasScrollH","hasScrollV","addScroll","addScrollAxis","deltaPosName","scrollStart","axisId","draghelper","autoScroll","_hasScroll","bodyEl","Container","Scrollable","_preBodyHtml","calculateRelativePosition","selfW","selfH","viewport","testMoveRel","viewPortRect","moveRel","moveTo","moveBy","dx","dy","constrain","constrainToViewport","resizeToContent","resizeTo","resizeBy","dw","dh","Panel","Movable","Resizable","skipOrHidePanels","visiblePanels","panel","clickCtrl","autohide","bindDocumentClickHandler","documentClickHandler","bindDocumentScrollHandler","documentScrollHandler","repositionPanel","bindWindowResizeHandler","windowResizeHandler","FloatPanel","hideAll","toggleFixedChildPanels","scrollY","autofix","_autoFixY","addRemove","topModal","zOrder","modal","modalBlockEl","hasModal","currentZIndex","removeVisiblePanel","$modalBlockEl","popover","ariaLabel","describedBy","close","bodyRole","toggleFullScreenState","contentValue","noScaleMetaValue","overrideViewPort","oldMetaValue","toggleBodyFullScreenClasses","windows","_fullscreen","handleWindowResize","reposition","lastSize","Window","buttons","spacing","pack","closeClass","title","needsRecalc","headerW","headEl","headerH","headerHtml","footerHtml","fullscreen","slowRendering","_timer","_initial","dragHelper","getContentWindow","ifr","MessageBox","multiline","OK","OK_CANCEL","YES_NO","YES_NO_CANCEL","msgBox","createButton","primary","subtype","onClick","onPostRender","onClose","onCancel","alert","confirm","getTopMostWindow","fireOpenEvent","fireCloseEvent","params","editorManager","setActive","bodyType","onclick","features","message","getParams","setParams","getWindows","Tooltip","tooltip","Widget","tooltips","disable","setValue","Progress","icon","timeout","closeButton","progressBar","notificationStyle","Notification","getLastNotification","notifications","resizeWindowEvent","prePositionNotifications","positionNotifications","firstItem","getElement","getContentAreaContainer","notif","getNotifications","serviceMessage","service_message","targetNode","NodePath","setEditorCommandState","getDocumentMode","setMceInternalContent","selectionHtml","internalContent","dataTransfer","mceInternalUrlPrefix","escape","setData","mceInternalDataType","getMceInternalContent","getData","insertClipboardContents","cleanupStylesWhenDeleting","isTrailingBr","isSiblingsIgnoreWhiteSpace","findCaretNode","deleteRangeBetweenTextBlocks","startBlock","endBlock","caretNodeBefore","caretNodeAfter","expandBetweenBlocks","targetCaretNode","textBlock","targetTextBlock","handleTextBlockMergeDelete","handleLastBlockCharacterDelete","cloneTextBlockWithFormats","blockElm","currentFormatNodes","newBlockElm","br","clonedBlockElm","customDelete","mutationObserver","MutationObserver","observe","childList","subtree","attributeFilter","takeRecords","record","attributeName","addedNodes","disconnect","span","olderWebKit","dragStartRng","nodeInsert","relatedNode","records","attrModified","isMetaOrCtrl","modify","charCode","fragmentNode","blockParent","charText","pointRng","clipboardData","clearData","emptyEditorWhenDeleting","serializeRng","allContentsSelected","bodyRng","allRng","allSelection","shortcuts","inputMethodFocus","content_editable","removeHrOnBackspace","focusBody","selectControlElements","removeStylesWhenDeletingAcrossBlockElements","getAttributeApplyFunction","template","setAttributeNode","isSelectionAcrossElements","applyAttributes","ensureBodyHasRoleApplication","disableBackspaceIntoATable","addNewLinesBeforeBrInPre","brNodes","removePreSerializedStylesWhenSelectingControls","removeBlockQuoteOnBackSpace","setGeckoEditingOptions","setOpts","refreshContentEditable","addBrAfterLastLinks","fixLinks","setDefaultBlockType","deleteControlItemOnBackSpace","renderEmptyBlocksFix","emptyBlocksCSS","keepNoScriptContents","fixCaretSelectionOfDocumentElementOnIe","rngFromPoint","startRng","endSelection","started","htmlElm","normalizeSelection","showBrokenImageIcon","restoreFocusOnKeyDown","bodyHeight","blockCmdArrowNavigation","disableAutoUrlDetect","tapLinksAndImages","blockFormSubmitInsideEditor","removeAppleInterchangeBrs","ieInternalDragAndDrop","isGecko","emptyEditorOnDeleteEverything","isEverythingSelected","startCaretPos","endCaretPos","isWebKit","getEventTarget","eventName","event_root","eventRoot","bindEventDelegate","isListening","eventRootElm","delegates","customEventRootDelegates","activeEditor","editors","EditorObservable","bindPendingEventDelegates","_pendingNativeEvents","unbindAllNativeEvents","clickBlocker","toggleReadOnly","_clickBlocker","setMode","currentMode","keyCodeLookup","f9","f10","f11","modifierNames","parseShortcut","shortcut","access","alt","meta","createShortcut","desc","cmdFunc","subpatterns","hasModifier","isFunctionKey","matchShortcut","executeShortcutAction","pendingPatterns","uploadStatus","fileName","blobInfo","extensions","image/jpeg","image/jpg","image/gif","image/png","blob","pathJoin","path1","path2","blobInfoToData","base64","filename","defaultHandler","success","failure","progress","xhr","formData","XMLHttpRequest","withCredentials","credentials","upload","onprogress","loaded","total","json","JSON","responseText","basePath","FormData","send","noUpload","handlerSuccess","handlerFailure","resolvePending","blobUri","pendingPromises","uploadBlobInfo","openNotification","markPending","notification","closeNotification","markUploaded","removeFailed","percent","isDefaultHandler","pendingUploadBlobInfo","uploadBlobs","blobInfos","isUploaded","isPending","blobUriToBlob","responseType","response","dataUriToBlob","atob","Blob","Uint8Array","uriToBlob","blobToDataUri","reader","FileReader","onloadend","readAsDataURL","Conversions","blobCache","findAll","imageToBlobInfo","getByUri","findFirst","cachedBlobInfo","blobInfoId","images","promises","newPromise","cachedPromises","imageInfo","removeByUri","revokeObjectURL","createStatus","resultUri","hasBlobUri","blobUriStatuses","getResultUri","PENDING","UPLOADED","Uploader","ImageScanner","BlobCache","UploadStatus","aliveGuard","replaceString","search","replaceImageUrl","targetUrl","replacementUrl","replaceUrlInUndoStack","replaceImageUri","data-mce-src","convertURL","uploadImages","uploader","images_upload_url","images_upload_base_path","images_upload_credentials","images_upload_handler","scanForImages","imageInfos","uploadInfo","images_replace_blob_uris","uploadImagesAuto","automatic_uploads","isValidDataUriImage","imgElm","images_dataimg_filter","imageScanner","resultItem","replaceBlobUris","editorUpload","source_view","getAbsoluteClientRect","scrollX","rootRect","trimInlineCaretContainers","contentEditableFalseNodes","$lastVisualCaret","startBlink","cursorInterval","getCss","toArrayWithNode","Dimensions","findUntil","walkUntil","isAboveFn","isBeflowFn","targetClientRect","line","aboveLineNumber","lineNumber","isLine","positionsUntil","getClientRect","walkFn","isBelowFn","upUntil","downUntil","isAboveLine","distanceToRectLeft","distanceToRectRight","findClosestClientRect","isInside","oldClientRect","oldDistance","newDistance","findLineNodeRects","targetNodeRect","checkPosFn","lineRects","getContentEditableFalseChildren","caretInfo","closestCaret","contentEditableFalseNodeRects","closestNodeRect","isDraggable","setBodyCursor","isValidDropTarget","movement","rootClientRect","overflowX","dragging","relX","relY","ghost","overflow","contenteditable","maxX","maxY","hideFakeCaret","drop","dropEvt","targetClone","insertContent","ceElm","realTarget","FakeCaret","LineWalker","LineUtils","DragDropOverrides","getVisualCaretPosition","SelectionOverrides","setRange","showCaret","fakeCaret","getNodeRange","isMoveInsideSameBlock","fromCaretPosition","toCaretPosition","inSameBlock","getNormalizedRangeEndPoint","isRangeInCaretContainerBlock","moveToCeFalseHorizontally","getNextPosFn","isBeforeContentEditableFalseFn","peekCaretPosition","rangeIsInContainerBlock","renderRangeCaret","moveToCeFalseVertically","walkerFn","linePositions","nextLinePositions","closestNextLineRect","caretClientRect","dist1","dist2","contentEditableFalseNode","caretPositions","exitPreBlock","createTextBlock","getNextVisualCaretPosition","getPrevVisualCaretPosition","moveH","newRange","moveV","getBlockCaretContainer","blockCaretContainer","renderCaretAtRange","ceRoot","caretRange","deleteContentEditableNode","nextCaretPosition","prevCaretPosition","prevCeFalseElm","nextElement","clearContentEditableSelection","mergeTextBlocks","fromBlock","toBlock","textBlocks","backspaceDelete","beforeFn","afterFn","newCaretPosition","registerEvents","override","moveFn","getContentEditableRoot","isXYWithinRange","paddEmptyContentEditableArea","handleBlockContainer","handleEmptyBackspaceDelete","prevent","deleteForward","backspace","contentEditableRoot","hasNormalCaretPosition","block1","block2","hasBetterMouseTarget","targetBlock","caretBlock","setContentEditableSelection","selectedContentEditableNode","addCss","isRangeInCaretContainer","$realSelectionContainer","origTargetClone","realSelectionId","rnd","now","uuid","NodeChange","DomSerializer","Formatter","UndoManager","EnterKey","ForceBlocks","EditorCommands","WindowManager","NotificationManager","Quirks","Mode","Shortcuts","EditorUpload","Uuid","Editor","documentBaseUrl","defaultSettings","documentBaseURL","baseURI","delta_width","delta_height","popup_css","document_base_url","add_form_submit_trigger","submit_patch","add_unload_trigger","convert_urls","relative_urls","remove_script_host","visual","font_size_legacy_values","hidden_input","padd_empty_editor","render_ui","convert_fonts_to_spans","ie7_compat","external_plugins","language_load","documentBaseURI","contentCSS","loadedCSS","editorCommands","cache_suffix","override_viewport","execCallback","scriptLoader","language_url","themeUrl","theme_url","plugin","orgVisibility","visibility","form","formElement","hasHiddenInput","formEventDelegate","startContent","_mceOldSubmit","triggerSave","windowManager","encoding","save","_beforeUnload","destroyed","set_dirty","initPlugin","pluginInstance","Plugin","initializedPlugins","Theme","bodyId","bodyClass","re","i18n","setCode","rtl_ui","aria_label","getLang","orgDisplay","min_height","renderUI","iframeHeight","editorContainer","iframeContainer","content_css","u","content_style","initContentBody","iframeHTML","cssUrl","body_id","body_class","content_security_policy","domainRelaxUrl","domain","hostname","frameBorder","allowTransparency","contentAreaContainer","iframeElement","skipWrite","contentCssText","write","content_document","content_window","bodyElement","hex_colors","force_hex_style_colors","class_filter","forceBlocks","enterKey","_nodeChangeDispatcher","browser_spellcheck","gecko_spellcheck","spellcheck","directionality","nowrap","protect","initial","auto_focus","skipFocus","getContentEditableHost","contentEditableHost","callbackLookup","addButton","addMenuItem","menuItems","addContextToolbar","contextToolbars","focusedEditor","setProgressState","padd","isNotDirty","oldState","urlconverter_callback","visual_table_class","visual_anchor_class","automatic","_scanForImages","newCode","_dir","getCode","langData","match1","match2","FocusManager","getActiveElement","createBookmark","bookmarkToRng","isUIElement","isEditorUIElement","selectionChangeHandler","blurredEditor","documentFocusInHandler","documentMouseUpHandler","unregisterDocumentEvents","I18n","globalEventDelegate","EditorManager","toggleGlobalEvents","boundGlobalEvents","removeEditorFromList","removedFromList","purgeDestroyedEditor","beforeUnloadDelegate","instanceCounter","majorVersion","minorVersion","releaseDate","setup","preInit","tinyMCEPreInit","srcScript","currentScript","focusManager","isInvalidInlineTarget","invalidInlineTargets","report","createId","findTargets","targets","forms","editor_deselector","editor_selector","initEditors","createEditor","initCount","provideResults","addI18n","tinyMCE","replaceWithSpan","convert","font","face","strike","XHR","ready","success_scope","error_scope","overrideMimeType","content_type","crossDomain","setRequestHeader","requestheaders","quote","t","JSONRequest","sendRPC","ecb","scb","ty","method","updateKeys","LocalStorage","nextPos","hasOldIEDataSupport","storageElm","userDataKey","localStorage","addBehavior","getItem","setItem","removeItem","firstControlClass","lastControlClass","containerClass","firstClass","lastClass","lastItem","controlClass","Layout","btnStyle","btnElm","textHtml","setButtonText","$span","textCls","iconElm","subinput","menu","showMenu","stateValue","inputValue","lineHeight","openElm","openBtnHtml","extraAttrs","placeholder","ComboBox","onaction","repaintColor","background","Button","showPanel","panelSettings","hidePanel","popoverAlign","PanelButton","_color","resetColor","onClickHandler","Color","rgb2hsv","minRGB","maxRGB","hsvToRgb","hue","saturation","brightness","side","chroma","toRgb","toHsv","updateColor","hsv","hueUpdate","huePointElm","svPointElm","svRootElm","updateSaturationAndValue","updateHue","hueRootElm","_repaint","_svdraghelper","_hdraghelper","rgb","_rendered","getOldIeFallbackHtml","gradientPrefix","stopsList","stops","hueHtml","gradientCssText","delimiter","row","_getDataPathHtml","Path","elementpath","outParents","flex","FormItem","labelGap","formItemDefaults","formItem","label","forId","recalcLabels","maxLabelWidth","labels","labelGapCalc","labelCtrl","labelWidth","Form","actionCallback","fileBrowserCallback","fileBrowserCallbackTypes","editorSettings","file_picker_types","file_browser_callback_types","filetype","file_picker_callback","file_browser_callback","AbsoluteLayout","contLayoutRect","contPaddingBox","contSettings","totalFlex","availableSpace","ctrlLayoutRect","ctrlSettings","maxSize","maxAlignEndPos","minSizeName","maxSizeName","beforeName","innerSizeName","deltaSizeName","alignAxisName","alignInnerSizeName","alignSizeName","alignMinSizeName","alignBeforeName","alignAfterName","alignDeltaSizeName","alignContentSizeName","maxSizeItems","maxFlexSize","endClass","registerControls","createListBoxChangeHandler","formatName","createFormats","createFormatMenu","createMenu","menuItem","newFormats","createStylesMenu","style_formats_merge","style_formats","defaultStyleFormats","itemDefaults","preview","textStyle","initOnPostRender","toggleUndoRedoState","checkState","toggleVisualAidState","formatMenu","outdent","cut","copy","help","selectall","visualaid","newdocument","numlist","bullist","alignnone","selectable","block_formats","fixedWidth","onselect","defaultFontsFormats","fonts","font_formats","defaultFontsizeFormats","fontsize_formats","rows","cols","posX","posY","spacingH","spacingV","alignH","alignV","ctrlMinWidth","ctrlMinHeight","availableWidth","availableHeight","reverseRows","colWidths","rowHeights","columns","ceil","sqrt","flexV","packV","flexWidths","severity","strong","startMinH","targetCtrl","forName","Toolbar","MenuBar","MenuButton","_renderOpen","hideMenu","activeMenu","hasVisibleSiblingMenu","overCtrl","ariaHideMenu","hasMenus","_parentMenu","_lastRel","convertShortcut","textElm","hover","MenuItem","Throbber","itemsFactory","hideThrobber","throbber","factory","requestTime","_hasIcons","Menu","setSelected","menuValues","selectedText","lastItemCtrl","_values","lastControl","multiple","activateMenuItemsByValue","getSelectedItem","selectedItem","Checkbox","resizeDragHelper","createOptions","options","strOptions","_options","minVal","maxVal","setAriaProp","updateSliderHandle","maxHandlePos","shortSizeName","stylePosName","styleValue","handleEl","orientation","_minValue","_maxValue","previewFilter","minValue","maxValue","_initValue","toFraction","fromFraction","handleKeyboard","alter","delta","handleDrag","startHandlePos","handlePos","_dragHelper","screenCordName","mainButtonElm","menuButtonElm","_menuBtnText","FlowLayout","activateTab","activeTabElm","activeTabId","tabsHtml","activeTab","targetParent","headH","hidefocus","amd"],"mappings":"CASA,SAAUA,EAASC,GAClB,YAIA,SAASC,GAAQC,EAAKC,GAGrB,IAAK,GAFDC,GAAQC,KAEHC,EAAI,EAAGA,EAAIJ,EAAIK,SAAUD,EAAG,CAEpC,GADAF,EAASI,EAAQN,EAAII,KAAOG,EAAQP,EAAII,KACnCF,EACJ,KAAM,0CAA4CF,EAAII,EAGvDD,GAAKK,KAAKN,GAGXD,EAASQ,MAAM,KAAMN,GAGtB,QAASO,GAAOC,EAAIC,EAAcC,GACjC,GAAkB,gBAAPF,GACV,KAAM,sEAGP,IAAIC,IAAiBd,EACpB,KAAM,2DAGP,IAAIe,IAAef,EAClB,KAAM,kEAGPC,GAAQa,EAAc,WACrBN,EAAQK,GAAME,EAAWJ,MAAM,KAAMK,aAQvC,QAASP,GAAQI,GAIhB,IAAK,GAHDI,GAASlB,EACTmB,EAAYL,EAAGM,MAAM,SAEhBC,EAAK,EAAGA,EAAKF,EAAUX,SAAUa,EAAI,CAC7C,IAAKH,EAAOC,EAAUE,IACrB,MAGDH,GAASA,EAAOC,EAAUE,IAG3B,MAAOH,GAGR,QAASI,GAAOnB,GACf,GAAII,GAAGW,EAAQJ,EAAIK,EAAWI,CAE9B,KAAKhB,EAAI,EAAGA,EAAIJ,EAAIK,OAAQD,IAAK,CAChCW,EAASlB,EACTc,EAAKX,EAAII,GACTY,EAAYL,EAAGM,MAAM,QAErB,KAAK,GAAIC,GAAK,EAAGA,EAAKF,EAAUX,OAAS,IAAKa,EACzCH,EAAOC,EAAUE,MAASpB,IAC7BiB,EAAOC,EAAUE,QAGlBH,EAASA,EAAOC,EAAUE,GAG3BH,GAAOC,EAAUA,EAAUX,OAAS,IAAMC,EAAQK,GAInD,GAAId,EAAQwB,YAAa,CACxBD,EAAiBvB,EAAQuB,kBAEzB,KAAKT,IAAML,GACVc,EAAeT,GAAML,EAAQK,EAG9B,KAAKP,EAAI,EAAGA,EAAIJ,EAAIK,OAAQD,UACpBgB,GAAepB,EAAII,GAG3BP,GAAQuB,eAAiBA,GArF3B,GAAId,KA0GLI,GAAO,uBACJ,WAcF,QAASY,GAAiBC,EAAMC,EAAYC,GAC3C,GAAIC,GAAGC,EAAGC,EAAGC,EAAGC,EAASC,CA2CzB,OAzCAL,GAAIF,EAAWE,EACfC,EAAIH,EAAWG,EACfC,EAAIL,EAAKK,EACTC,EAAIN,EAAKM,EACTC,EAAUN,EAAWI,EACrBG,EAAUP,EAAWK,EAErBJ,GAAOA,GAAO,IAAIR,MAAM,IAET,MAAXQ,EAAI,KACPE,GAAKI,GAGS,MAAXN,EAAI,KACPC,GAAKI,GAGS,MAAXL,EAAI,KACPE,GAAKK,EAAMD,EAAU,IAGP,MAAXN,EAAI,KACPC,GAAKM,EAAMF,EAAU,IAGP,MAAXL,EAAI,KACPE,GAAKE,GAGS,MAAXJ,EAAI,KACPC,GAAKE,GAGS,MAAXH,EAAI,KACPE,GAAKK,EAAMH,EAAI,IAGD,MAAXJ,EAAI,KACPC,GAAKM,EAAMJ,EAAI,IAGTK,EAAOP,EAAGC,EAAGC,EAAGC,GAYxB,QAASK,GAAyBX,EAAMC,EAAYW,EAAeC,GAClE,GAAIC,GAAKjC,CAET,KAAKA,EAAI,EAAGA,EAAIgC,EAAK/B,OAAQD,IAG5B,GAFAiC,EAAMf,EAAiBC,EAAMC,EAAYY,EAAKhC,IAE1CiC,EAAIX,GAAKS,EAAcT,GAAKW,EAAIX,EAAIW,EAAIT,GAAKO,EAAcP,EAAIO,EAAcT,GAChFW,EAAIV,GAAKQ,EAAcR,GAAKU,EAAIV,EAAIU,EAAIR,GAAKM,EAAcN,EAAIM,EAAcR,EAC7E,MAAOS,GAAKhC,EAId,OAAO,MAYR,QAASkC,GAAQf,EAAMK,EAAGC,GACzB,MAAOI,GAAOV,EAAKG,EAAIE,EAAGL,EAAKI,EAAIE,EAAGN,EAAKK,EAAQ,EAAJA,EAAOL,EAAKM,EAAQ,EAAJA,GAWhE,QAASU,GAAUhB,EAAMiB,GACxB,GAAIC,GAAIC,EAAIC,EAAIC,CAOhB,OALAH,GAAKI,EAAItB,EAAKG,EAAGc,EAASd,GAC1BgB,EAAKG,EAAItB,EAAKI,EAAGa,EAASb,GAC1BgB,EAAKG,EAAIvB,EAAKG,EAAIH,EAAKK,EAAGY,EAASd,EAAIc,EAASZ,GAChDgB,EAAKE,EAAIvB,EAAKI,EAAIJ,EAAKM,EAAGW,EAASb,EAAIa,EAASX,GAE5Cc,EAAKF,EAAK,GAAKG,EAAKF,EAAK,EACrB,KAGDT,EAAOQ,EAAIC,EAAIC,EAAKF,EAAIG,EAAKF,GAarC,QAASK,GAAMxB,EAAMyB,EAAWC,GAC/B,GAAIC,GAAaC,EAAaC,EAAYC,EACzCZ,EAAIC,EAAIC,EAAIC,EAAIU,EAAKC,CA2BtB,OAzBAd,GAAKlB,EAAKG,EACVgB,EAAKnB,EAAKI,EACVgB,EAAKpB,EAAKG,EAAIH,EAAKK,EACnBgB,EAAKrB,EAAKI,EAAIJ,EAAKM,EACnByB,EAAMN,EAAUtB,EAAIsB,EAAUpB,EAC9B2B,EAAMP,EAAUrB,EAAIqB,EAAUnB,EAE9BqB,EAAcL,EAAI,EAAGG,EAAUtB,EAAIe,GACnCU,EAAcN,EAAI,EAAGG,EAAUrB,EAAIe,GACnCU,EAAaP,EAAI,EAAGF,EAAKW,GACzBD,EAAaR,EAAI,EAAGD,EAAKW,GAEzBd,GAAMS,EACNR,GAAMS,EAEFF,IACHN,GAAMO,EACNN,GAAMO,EACNV,GAAMW,EACNV,GAAMW,GAGPV,GAAMS,EACNR,GAAMS,EAECpB,EAAOQ,EAAIC,EAAIC,EAAKF,EAAIG,EAAKF,GAarC,QAAST,GAAOP,EAAGC,EAAGC,EAAGC,GACxB,OAAQH,EAAGA,EAAGC,EAAGA,EAAGC,EAAGA,EAAGC,EAAGA,GAU9B,QAAS2B,GAAeC,GACvB,MAAOxB,GAAOwB,EAAWC,KAAMD,EAAWE,IAAKF,EAAWG,MAAOH,EAAWI,QAtL7E,GAAIf,GAAMgB,KAAKhB,IAAKD,EAAMiB,KAAKjB,IAAKb,EAAQ8B,KAAK9B,KAyLjD,QACCM,QAASA,EACThB,iBAAkBA,EAClBY,yBAA0BA,EAC1BK,UAAWA,EACXQ,MAAOA,EACPd,OAAQA,EACRuB,eAAgBA,KAwBlB9C,EAAO,0BAA4B,WAUlC,QAASqD,GAAKC,EAAIC,GACjB,MAAO,YACND,EAAGvD,MAAMwD,EAASnD,YAMpB,QAASoD,GAAQF,GAChB,GAAoB,gBAATG,MAAmB,KAAM,IAAIC,WAAU,uCAClD,IAAkB,kBAAPJ,GAAmB,KAAM,IAAII,WAAU,iBAClDD,MAAKE,OAAS,KACdF,KAAKG,OAAS,KACdH,KAAKI,cAELC,EAAUR,EAAID,EAAKxD,EAAS4D,MAAOJ,EAAKU,EAAQN,OAGjD,QAASO,GAAOC,GACf,GAAIC,GAAKT,IACT,OAAoB,QAAhBA,KAAKE,WACRF,MAAKI,WAAW/D,KAAKmE,OAGtBE,GAAK,WACJ,GAAIC,GAAKF,EAAGP,OAASM,EAASI,YAAcJ,EAASK,UACrD,IAAW,OAAPF,EAEH,YADCF,EAAGP,OAASM,EAASpE,QAAUoE,EAASF,QAAQG,EAAGN,OAGrD,IAAIW,EACJ,KACCA,EAAMH,EAAGF,EAAGN,QAEb,MAAOY,GAEN,WADAP,GAASF,OAAOS,GAGjBP,EAASpE,QAAQ0E,KAInB,QAAS1E,GAAQ4E,GAChB,IACC,GAAIA,IAAahB,KAAM,KAAM,IAAIC,WAAU,4CAC3C,IAAIe,IAAiC,gBAAbA,IAA6C,kBAAbA,IAA0B,CACjF,GAAIC,GAAOD,EAASC,IACpB,IAAoB,kBAATA,GAEV,WADAZ,GAAUT,EAAKqB,EAAMD,GAAWpB,EAAKxD,EAAS4D,MAAOJ,EAAKU,EAAQN,OAIpEA,KAAKE,QAAS,EACdF,KAAKG,OAASa,EACdE,EAAOC,KAAKnB,MACX,MAAOe,GAAKT,EAAOa,KAAKnB,KAAMe,IAGjC,QAAST,GAAOU,GACfhB,KAAKE,QAAS,EACdF,KAAKG,OAASa,EACdE,EAAOC,KAAKnB,MAGb,QAASkB,KACR,IAAK,GAAIjF,GAAI,EAAGmF,EAAMpB,KAAKI,WAAWlE,OAAQD,EAAImF,EAAKnF,IACtDsE,EAAOY,KAAKnB,KAAMA,KAAKI,WAAWnE,GAEnC+D,MAAKI,WAAa,KAGnB,QAASiB,GAAQT,EAAaC,EAAYzE,EAASkE,GAClDN,KAAKY,YAAqC,kBAAhBA,GAA6BA,EAAc,KACrEZ,KAAKa,WAAmC,kBAAfA,GAA4BA,EAAa,KAClEb,KAAK5D,QAAUA,EACf4D,KAAKM,OAASA,EASf,QAASD,GAAUR,EAAIe,EAAaC,GACnC,GAAIS,IAAO,CACX,KACCzB,EAAG,SAAU0B,GACRD,IACJA,GAAO,EACPV,EAAYW,KACV,SAAUC,GACRF,IACJA,GAAO,EACPT,EAAWW,MAEX,MAAOC,GACR,GAAIH,EAAM,MACVA,IAAO,EACPT,EAAWY,IA5Gb,GAAIC,OAAO3B,QACV,MAAO2B,QAAO3B,OAIf,IAAIW,GAAOX,EAAQ4B,aAAwC,kBAAjBC,eAA+BA,cACxE,SAAS/B,GAAMgC,WAAWhC,EAAI,IAS3BiC,EAAUC,MAAMD,SAAW,SAASP,GAAS,MAAiD,mBAA1CS,OAAOC,UAAUC,SAASf,KAAKI,GAiKvF,OAhEAxB,GAAQkC,UAAU,SAAW,SAAUpB,GACtC,MAAOb,MAAKiB,KAAK,KAAMJ,IAGxBd,EAAQkC,UAAUhB,KAAO,SAASL,EAAaC,GAC9C,GAAIJ,GAAKT,IACT,OAAO,IAAID,GAAQ,SAAS3D,EAASkE,GACpCC,EAAOY,KAAKV,EAAI,GAAIY,GAAQT,EAAaC,EAAYzE,EAASkE,OAIhEP,EAAQoC,IAAM,WACb,GAAIC,GAAOL,MAAME,UAAUI,MAAMlB,KAA0B,IAArBxE,UAAUT,QAAgB4F,EAAQnF,UAAU,IAAMA,UAAU,GAAKA,UAEvG,OAAO,IAAIoD,GAAQ,SAAU3D,EAASkE,GAGrC,QAASgC,GAAIrG,EAAGsG,GACf,IACC,GAAIA,IAAuB,gBAARA,IAAmC,kBAARA,IAAqB,CAClE,GAAItB,GAAOsB,EAAItB,IACf,IAAoB,kBAATA,GAEV,WADAA,GAAKE,KAAKoB,EAAK,SAAUA,GAAOD,EAAIrG,EAAGsG,IAASjC,GAIlD8B,EAAKnG,GAAKsG,EACU,MAAdC,GACLpG,EAAQgG,GAER,MAAOX,GACRnB,EAAOmB,IAhBT,GAAoB,IAAhBW,EAAKlG,OAAc,MAAOE,MAmB9B,KAAK,GAlBDoG,GAAYJ,EAAKlG,OAkBZD,EAAI,EAAGA,EAAImG,EAAKlG,OAAQD,IAChCqG,EAAIrG,EAAGmG,EAAKnG,OAKf8D,EAAQ3D,QAAU,SAAUmF,GAC3B,MAAIA,IAA0B,gBAAVA,IAAsBA,EAAMkB,cAAgB1C,EACxDwB,EAGD,GAAIxB,GAAQ,SAAU3D,GAC5BA,EAAQmF,MAIVxB,EAAQO,OAAS,SAAUiB,GAC1B,MAAO,IAAIxB,GAAQ,SAAU3D,EAASkE,GACrCA,EAAOiB,MAITxB,EAAQ2C,KAAO,SAAUC,GACxB,MAAO,IAAI5C,GAAQ,SAAU3D,EAASkE,GACrC,IAAI,GAAIrE,GAAI,EAAGmF,EAAMuB,EAAOzG,OAAQD,EAAImF,EAAKnF,IAC5C0G,EAAO1G,GAAGgF,KAAK7E,EAASkE,MAKpBP,IAuBRxD,EAAO,sBACN,wBACE,SAASwD,GAGX,QAAS6C,GAAsB9G,EAAU+G,GAGxC,QAASC,GAAYhH,GACpB4F,OAAOG,WAAW/F,EAAU,GAH7B,GAAIG,GAAG8G,EAA4BrB,OAAOkB,sBAAuBI,GAAW,KAAM,MAAO,SAMzF,KAAK/G,EAAI,EAAGA,EAAI+G,EAAQ9G,SAAW6G,EAA2B9G,IAC7D8G,EAA4BrB,OAAOsB,EAAQ/G,GAAK,wBAG5C8G,KACJA,EAA4BD,GAG7BC,EAA0BjH,EAAU+G,GAGrC,QAASI,GAAkBnH,EAAUoH,GAKpC,MAJmB,gBAARA,KACVA,EAAO,GAGDrB,WAAW/F,EAAUoH,GAG7B,QAASC,GAAmBrH,EAAUoH,GAKrC,MAJmB,gBAARA,KACVA,EAAO,GAGDE,YAAYtH,EAAUoH,GAG9B,QAASG,GAAoB7G,GAC5B,MAAO8G,cAAa9G,GAGrB,QAAS+G,GAAqB/G,GAC7B,MAAOgH,eAAchH,GAzCtB,GAAIiH,EA4CJ,QAQCb,sBAAuB,SAAS9G,EAAU+G,GACzC,MAAIY,OACHA,GAA6BxC,KAAKnF,QAInC2H,EAA+B,GAAI1D,GAAQ,SAAS3D,GAC9CyG,IACJA,EAAUa,SAASC,MAGpBf,EAAsBxG,EAASyG,KAC7B5B,KAAKnF,KAWT+F,WAAYoB,EAUZG,YAAaD,EAYbS,iBAAkB,SAASC,EAAQ/H,EAAUoH,GAC5C,MAAOD,GAAkB,WACnBY,EAAOC,SACXhI,KAECoH,IAYJa,kBAAmB,SAASF,EAAQ/H,EAAUoH,GAC7C,GAAIc,EAUJ,OARAA,GAAQb,EAAmB,WACrBU,EAAOC,QAGXN,cAAcQ,GAFdlI,KAICoH,IAaJe,SAAU,SAASnI,EAAUoH,GAC5B,GAAIc,GAAOE,CAgBX,OAdAA,GAAO,WACN,GAAI9B,GAAOzF,SAEX2G,cAAaU,GAEbA,EAAQf,EAAkB,WACzBnH,EAASQ,MAAM0D,KAAMoC,IACnBc,IAGJgB,EAAKC,KAAO,WACXb,aAAaU,IAGPE,GASRV,cAAeD,EAQfD,aAAcD,KAwBhB9G,EAAO,iBAAmB,WAIzB,QAAS6H,GAAgBC,GACxB,MAAO,cAAgB3C,SAAS4C,WAAWD,GAAOE,QAJnD,GACIC,GAAOC,EAAQC,EAAIC,EAAMC,EAAMC,EAAOC,EAAKC,EAASC,EAASC,EAASC,EAAOC,EAAQC,EADrFC,EAAMC,UAAWC,EAAYF,EAAIE,SAOrCf,GAAQ9C,OAAO8C,OAAS9C,OAAO8C,MAAMgB,YACrCR,EAAU,UAAUS,KAAKF,GACzBd,EAAS,SAASgB,KAAKF,GACvBb,GAAMD,IAAWD,GAAS,SAAWiB,KAAKF,IAAc,aAAeE,KAAKJ,EAAIK,SAChFhB,EAAKA,GAAM,eAAeiB,KAAKJ,GAAW,GAC1CZ,EAAOY,EAAUK,QAAQ,kBAAsBL,EAAUK,QAAQ,YAAgBP,EAAIK,QAAQE,QAAQ,kBAAqB,GAC1HhB,EAAQW,EAAUK,QAAQ,eAAmBlB,IAAOC,GAAQ,GAC5DD,EAAKA,GAAMC,GAAQC,EACnBC,GAASJ,IAAWE,GAAQ,QAAQc,KAAKF,GACzCT,EAAMS,EAAUK,QAAQ,WACxBb,EAAU,gBAAgBU,KAAKF,GAC/BN,EAAU,YAAcvD,SAAU,cAAgBA,SAAU,OAASA,WAAYmE,IAAIC,gBACrFZ,EAAQd,EAAgB,+CAAiDY,GAAWD,GACpFI,EAASf,EAAgB,wCAA0CY,GAAWD,GAC9EK,EAAeG,EAAUK,QAAQ,qBAE7BhB,IACHH,GAAS,EAKV,IAAIsB,IAAmBhB,GAAWE,GAAWM,EAAUS,MAAM,sBAAsB,IAAM,GAEzF,QAQCxB,MAAOA,EASPC,OAAQA,EASRC,GAAIA,EASJG,MAAOA,EASPC,IAAKA,EASLmB,IAAKlB,EASLC,QAASA,EASTe,gBAAiBA,EASjBG,eAAgB,iFAShBC,WAAkB,GAANzB,EAQZ0B,MAAO1E,OAAO2E,cAAgB,SAAW3E,QAQzC4E,aAAc5B,IAAOE,EAAQlB,SAAS4C,cAAgB,EAAK,GAQ3DrB,QAASA,EAQTsB,QAAU7B,KAAO,GAASA,EAAK,EAE/B8B,SAAUtB,IAAUC,EACpBC,aAAcA,KAwBhB7I,EAAO,0BACN,qBACA,eACE,SAASkK,EAAOC,GAalB,QAASC,GAAS/J,EAAQgK,EAAM9K,EAAU+K,GACrCjK,EAAOkK,iBACVlK,EAAOkK,iBAAiBF,EAAM9K,EAAU+K,IAAW,GACzCjK,EAAOmK,aACjBnK,EAAOmK,YAAY,KAAOH,EAAM9K,GAOlC,QAASkL,GAAYpK,EAAQgK,EAAM9K,EAAU+K,GACxCjK,EAAOqK,oBACVrK,EAAOqK,oBAAoBL,EAAM9K,EAAU+K,IAAW,GAC5CjK,EAAOsK,aACjBtK,EAAOsK,YAAY,KAAON,EAAM9K,GAOlC,QAASqL,GAAuBC,EAAOC,GACtC,GAAIC,GAAM1K,EAASyK,CAmBnB,OAbAC,GAAOF,EAAME,KACTA,GAAQA,EAAKpL,OAAS,IACzBU,EAAS0K,EAAK,IAIXF,EAAMG,WACTD,EAAOF,EAAMG,WACTD,GAAQA,EAAKpL,OAAS,IACzBU,EAAS0K,EAAK,KAIT1K,EAMR,QAAS4K,GAAIC,EAAeC,GAI3B,QAASC,KACR,OAAO,EAIR,QAASC,KACR,OAAO,EATR,GAAIhB,GAA0BiB,EAApBT,EAAQM,KAalB,KAAKd,IAAQa,GAEPK,EAAWlB,KACfQ,EAAMR,GAAQa,EAAcb,GAe9B,IAVKQ,EAAMxK,SACVwK,EAAMxK,OAASwK,EAAMW,YAAcrE,UAIhCgD,EAAIsB,wBACPZ,EAAMxK,OAASuK,EAAuBM,EAAeL,EAAMxK,SAIxD6K,GAAiBQ,EAAaxC,KAAKgC,EAAcS,OAAST,EAAcU,QAAUN,GAASJ,EAAcW,UAAYP,EAAO,CAC/H,GAAIQ,GAAWjB,EAAMxK,OAAO0L,eAAiB5E,SACzC6E,EAAMF,EAASG,gBACf7E,EAAO0E,EAAS1E,IAEpByD,GAAMe,MAAQV,EAAcW,SAAWG,GAAOA,EAAIE,YAAc9E,GAAQA,EAAK8E,YAAc,IACzFF,GAAOA,EAAIG,YAAc/E,GAAQA,EAAK+E,YAAc,GAEtDtB,EAAMuB,MAAQlB,EAAcmB,SAAWL,GAAOA,EAAIM,WAAalF,GAAQA,EAAKkF,WAAa,IACvFN,GAAOA,EAAIO,WAAanF,GAAQA,EAAKmF,WAAa,GAiDrD,MA7CA1B,GAAM2B,eAAiB,WACtB3B,EAAM4B,mBAAqBpB,EAGvBH,IACCA,EAAcsB,eACjBtB,EAAcsB,iBAEdtB,EAAcwB,aAAc,IAM/B7B,EAAM8B,gBAAkB,WACvB9B,EAAM+B,qBAAuBvB,EAGzBH,IACCA,EAAcyB,gBACjBzB,EAAcyB,kBAEdzB,EAAc2B,cAAe,IAMhChC,EAAMiC,yBAA2B,WAChCjC,EAAMkC,8BAAgC1B,EACtCR,EAAM8B,mBAIF9B,EAAM4B,qBACV5B,EAAM4B,mBAAqBrB,EAC3BP,EAAM+B,qBAAuBxB,EAC7BP,EAAMkC,8BAAgC3B,GAIX,mBAAjBP,GAAMmC,UAChBnC,EAAMmC,SAAU,GAGVnC,EAOR,QAASoC,GAAYC,EAAK3N,EAAU4N,GASnC,QAASC,KACHD,EAAWE,YACfF,EAAWE,WAAY,EACvB9N,EAASsL,IAIX,QAASyC,MAGe,aAAnBtB,EAAIuB,YAAiD,gBAAnBvB,EAAIuB,YAAgCvB,EAAI5E,QAC7EqD,EAAYuB,EAAK,mBAAoBsB,GACrCF,KAIF,QAASI,KACR,IAGCxB,EAAIC,gBAAgBwB,SAAS,QAC5B,MAAOvI,GAER,WADAgF,GAAM5E,WAAWkI,GAIlBJ,IAlCD,GAAIpB,GAAMkB,EAAI/F,SAAU0D,GAASc,KAAM,QAEvC,OAAIwB,GAAWE,cACd9N,GAASsL,IAmCNmB,EAAIzB,iBACgB,aAAnByB,EAAIuB,WACPH,IAEAhD,EAAS8C,EAAK,mBAAoBE,IAInChD,EAAS4B,EAAK,mBAAoBsB,GAG9BtB,EAAIC,gBAAgBwB,UAAYP,EAAIQ,OAASR,EAAIjK,KACpDuK,SAKFpD,GAAS8C,EAAK,OAAQE,IAMvB,QAASO,KAoBR,QAASC,GAAgBC,EAAK5N,GAC7B,GAAI6N,GAAcpO,EAAGqO,EAAGxO,EAAUyO,EAAYC,EAAOhO,EAGrD,IADA6N,EAAeE,GAAaA,EAAUH,EAAIlC,MAEzC,IAAKjM,EAAI,EAAGqO,EAAID,EAAanO,OAAQD,EAAIqO,EAAGrO,IAS3C,GARAH,EAAWuO,EAAapO,GAGpBH,GAAYA,EAASoI,KAAK/C,KAAKrF,EAAS2O,MAAOL,MAAS,GAC3DA,EAAIrB,iBAIDqB,EAAId,gCACP,OAlCJ,GAA8BoB,GAAOC,EAASC,EAAYC,EAAoBC,EAA1Eb,EAAOjK,KAAMwK,IAEjBG,GAAUI,IAAuB,GAAIC,OAAQ9I,SAAS,IACtD2I,EAAqB,gBAAkBnH,UAAS8E,gBAChDoC,EAAa,aAAelH,UAAS8E,gBACrCsC,GAAmBG,WAAY,YAAaC,WAAY,YACxDR,EAAQ,EAGRT,EAAKL,WAAY,EACjBK,EAAKO,OAASA,EAwCdP,EAAKrK,KAAO,SAAShD,EAAQuO,EAAOrP,EAAU2O,GAI7C,QAASW,GAAqBhB,GAC7BD,EAAgB3C,EAAI4C,GAAOX,EAAIrC,OAAQ5K,GAJxC,GAAIA,GAAI6N,EAAcpO,EAAG2K,EAAMyE,EAAUC,EAAezE,EAAS4C,EAAM/H,MAQvE,IAAK9E,GAA8B,IAApBA,EAAO2O,UAAsC,IAApB3O,EAAO2O,SAA/C,CAmBA,IAdK3O,EAAO+N,GAKXnO,EAAKI,EAAO+N,IAJZnO,EAAKkO,IACL9N,EAAO+N,GAAWnO,EAClBgO,EAAOhO,OAMRiO,EAAQA,GAAS7N,EAGjBuO,EAAQA,EAAMrO,MAAM,KACpBb,EAAIkP,EAAMjP,OACHD,KACN2K,EAAOuE,EAAMlP,GACbqP,EAAgBF,EAChBC,EAAWxE,GAAU,EAGR,qBAATD,IACHA,EAAO,SAIJqD,EAAKL,WAAsB,UAAThD,GAAyC,YAArBhK,EAAOkN,WAChDhO,EAASqF,KAAKsJ,EAAOjD,GAAKU,KAAMtB,MAK5BiE,IACJQ,EAAWP,EAAgBlE,GAEvByE,IACHC,EAAgB,SAASlB,GACxB,GAAIoB,GAASC,CAOb,IALAD,EAAUpB,EAAIsB,cACdD,EAAUrB,EAAIuB,cAIVF,GAAWD,EAAQI,SAEtBH,EAAUD,EAAQI,SAASH,OAE3B,MAAOA,GAAWA,IAAYD,GAC7BC,EAAUA,EAAQI,UAKfJ,KACJrB,EAAM5C,EAAI4C,GAAOX,EAAIrC,OACrBgD,EAAIlC,KAAoB,aAAbkC,EAAIlC,KAAsB,aAAe,aACpDkC,EAAIxN,OAAS4O,EACbrB,EAAgBC,EAAK5N,OAOpBoO,GAAwB,YAAThE,GAA+B,aAATA,IACzCC,GAAU,EACVwE,EAAoB,YAATzE,EAAqB,QAAU,OAC1C0E,EAAgB,SAASlB,GACxBA,EAAM5C,EAAI4C,GAAOX,EAAIrC,OACrBgD,EAAIlC,KAAoB,UAAbkC,EAAIlC,KAAmB,UAAY,WAC9CiC,EAAgBC,EAAK5N,KAKvB6N,EAAeG,EAAOhO,GAAIoK,GACrByD,EAiBS,UAATzD,GAAoBqD,EAAKL,UAC5B9N,GAAUoM,KAAMtB,IAGhByD,EAAahO,MAAM6H,KAAMpI,EAAU2O,MAAOA,KApB3CD,EAAOhO,GAAIoK,GAAQyD,IAAiBnG,KAAMpI,EAAU2O,MAAOA,IAC3DJ,EAAagB,SAAWA,EACxBhB,EAAaxD,QAAUA,EAIvBwD,EAAaiB,cAAgBA,EAIhB,UAAT1E,EACH4C,EAAY5M,EAAQ0O,EAAerB,GAEnCtD,EAAS/J,EAAQyO,GAAYzE,EAAM0E,EAAezE,IAcrD,OAFAjK,GAASyN,EAAe,EAEjBvO,IAYRmO,EAAK6B,OAAS,SAASlP,EAAQuO,EAAOrP,GACrC,GAAIU,GAAI6N,EAAcpO,EAAG8P,EAAInF,EAAMoF,CAGnC,KAAKpP,GAA8B,IAApBA,EAAO2O,UAAsC,IAApB3O,EAAO2O,SAC9C,MAAOtB,EAKR,IADAzN,EAAKI,EAAO+N,GACJ,CAIP,GAHAqB,EAAWxB,EAAOhO,GAGd2O,GAGH,IAFAA,EAAQA,EAAMrO,MAAM,KACpBb,EAAIkP,EAAMjP,OACHD,KAKN,GAJA2K,EAAOuE,EAAMlP,GACboO,EAAe2B,EAASpF,GAGN,CAEjB,GAAI9K,EAEH,IADAiQ,EAAK1B,EAAanO,OACX6P,KACN,GAAI1B,EAAa0B,GAAI7H,OAASpI,EAAU,CACvC,GAAIwP,GAAgBjB,EAAaiB,cAC7BD,EAAWhB,EAAagB,SAAUxE,EAAUwD,EAAaxD,OAG7DwD,GAAeA,EAAahI,MAAM,EAAG0J,GAAIE,OAAO5B,EAAahI,MAAM0J,EAAK,IACxE1B,EAAaiB,cAAgBA,EAC7BjB,EAAagB,SAAWA,EACxBhB,EAAaxD,QAAUA,EAEvBmF,EAASpF,GAAQyD,EAMfvO,GAAoC,IAAxBuO,EAAanO,eACtB8P,GAASpF,GAChBI,EAAYpK,EAAQyN,EAAagB,UAAYzE,EAAMyD,EAAaiB,cAAejB,EAAaxD,eAIzF,CAEN,IAAKD,IAAQoF,GACZ3B,EAAe2B,EAASpF,GACxBI,EAAYpK,EAAQyN,EAAagB,UAAYzE,EAAMyD,EAAaiB,cAAejB,EAAaxD,QAG7FmF,MAID,IAAKpF,IAAQoF,GACZ,MAAO/B,SAIDO,GAAOhO,EAGd,WAEQI,GAAO+N,GACb,MAAOlJ,GAER7E,EAAO+N,GAAW,MAIpB,MAAOV,IAYRA,EAAKiC,KAAO,SAAStP,EAAQgK,EAAMxE,GAClC,GAAI5F,EAGJ,KAAKI,GAA8B,IAApBA,EAAO2O,UAAsC,IAApB3O,EAAO2O,SAC9C,MAAOtB,EAIR7H,GAAOoF,EAAI,KAAMpF,GACjBA,EAAK8F,KAAOtB,EACZxE,EAAKxF,OAASA,CAEd,GAECJ,GAAKI,EAAO+N,GACRnO,GACH2N,EAAgB/H,EAAM5F,GAIvBI,EAASA,EAAOiP,YAAcjP,EAAO0L,eAAiB1L,EAAOuP,aAAevP,EAAOwP,mBAC3ExP,IAAWwF,EAAK+G,uBAEzB,OAAOc,IAWRA,EAAKoC,MAAQ,SAASzP,GACrB,GAAIX,GAAGqQ,EAAUR,EAAS7B,EAAK6B,MAG/B,KAAKlP,GAA8B,IAApBA,EAAO2O,UAAsC,IAApB3O,EAAO2O,SAC9C,MAAOtB,EAcR,IAVIrN,EAAO+N,IACVmB,EAAOlP,GAIHA,EAAO2P,uBACX3P,EAASA,EAAO8G,UAIb9G,GAAUA,EAAO2P,qBAKpB,IAJAT,EAAOlP,GAEP0P,EAAW1P,EAAO2P,qBAAqB,KACvCtQ,EAAIqQ,EAASpQ,OACND,KACNW,EAAS0P,EAASrQ,GAEdW,EAAO+N,IACVmB,EAAOlP,EAKV,OAAOqN,IAMRA,EAAKuC,QAAU,WACdhC,MAIDP,EAAKwC,OAAS,SAAS1L,GAMtB,MALIA,KACHA,EAAEgI,iBACFhI,EAAEsI,6BAGI,GA5jBT,GAAI0B,GAAqB,YACrB9C,EAAe,+BACfH,GACH4E,YAAa,EAAGC,OAAQ,EAAGC,OAAQ,EAAG3D,YAAa,EACnD4D,gBAAiB,EAAGC,gBAAiB,EAAGC,cAAe,EA+jBxD,OAHA7C,GAAW8C,MAAQ,GAAI9C,GACvBA,EAAW8C,MAAMpN,KAAK8B,OAAQ,QAAS,cAEhCwI,IA8BR3N,EAAO,wBAA0B,WA4KjC,QAAS0Q,GAAQC,EAAUC,EAASC,EAASC,GAC5C,GAAIrH,GAAOsH,EAAMC,EAAGhC,EAEnBtP,EAAGuR,EAAQC,EAAKC,EAAKC,EAAYC,CASlC,KAPOT,EAAUA,EAAQ7E,eAAiB6E,EAAUU,KAAmBnK,GACtEoK,EAAaX,GAGdA,EAAUA,GAAWzJ,EACrB0J,EAAUA,OAEJF,GAAgC,gBAAbA,GACxB,MAAOE,EAGR,IAAuC,KAAjC7B,EAAW4B,EAAQ5B,WAAgC,IAAbA,EAC3C,QAGD,IAAKwC,IAAmBV,EAAO,CAG9B,GAAMrH,EAAQgI,GAAWrI,KAAMuH,GAE9B,GAAMK,EAAIvH,EAAM,IACf,GAAkB,IAAbuF,EAAiB,CAIrB,GAHA+B,EAAOH,EAAQc,eAAgBV,IAG1BD,IAAQA,EAAKzB,WAQjB,MAAOuB,EALP,IAAKE,EAAK9Q,KAAO+Q,EAEhB,MADAH,GAAQ/Q,KAAMiR,GACPF,MAOT,IAAKD,EAAQ7E,gBAAkBgF,EAAOH,EAAQ7E,cAAc2F,eAAgBV,KAC3E3B,EAAUuB,EAASG,IAAUA,EAAK9Q,KAAO+Q,EAEzC,MADAH,GAAQ/Q,KAAMiR,GACPF,MAKH,CAAA,GAAKpH,EAAM,GAEjB,MADA3J,GAAKC,MAAO8Q,EAASD,EAAQZ,qBAAsBW,IAC5CE,CAGD,KAAMG,EAAIvH,EAAM,KAAOkI,EAAQC,uBAErC,MADA9R,GAAKC,MAAO8Q,EAASD,EAAQgB,uBAAwBZ,IAC9CH,EAKT,GAAKc,EAAQE,OAASC,IAAcA,EAAU5I,KAAMyH,IAAc,CASjE,GARAQ,EAAMD,EAAM9C,EACZgD,EAAaR,EACbS,EAA2B,IAAbrC,GAAkB2B,EAMd,IAAb3B,GAAqD,WAAnC4B,EAAQmB,SAASC,cAA6B,CAWpE,IAVAf,EAASgB,EAAUtB,IAEbO,EAAMN,EAAQsB,aAAa,OAChCf,EAAMD,EAAIiB,QAASC,GAAS,QAE5BxB,EAAQyB,aAAc,KAAMlB,GAE7BA,EAAM,QAAUA,EAAM,MAEtBzR,EAAIuR,EAAOtR,OACHD,KACPuR,EAAOvR,GAAKyR,EAAMmB,EAAYrB,EAAOvR,GAEtC0R,GAAamB,GAASrJ,KAAMyH,IAAc6B,EAAa5B,EAAQtB,aAAgBsB,EAC/ES,EAAcJ,EAAOwB,KAAK,KAG3B,GAAKpB,EACJ,IAIC,MAHAvR,GAAKC,MAAO8Q,EACXO,EAAWsB,iBAAkBrB,IAEvBR,EACN,MAAM8B,IACN,QACKzB,GACLN,EAAQgC,gBAAgB,QAQ7B,MAAOC,GAAQlC,EAASwB,QAASW,GAAO,MAAQlC,EAASC,EAASC,GASnE,QAASiC,KAGR,QAASC,GAAOC,EAAKjO,GAMpB,MAJKkO,GAAKpT,KAAMmT,EAAM,KAAQE,EAAKC,mBAE3BJ,GAAOE,EAAKG,SAEZL,EAAOC,EAAM,KAAQjO,EAR9B,GAAIkO,KAUJ,OAAOF,GAOR,QAASM,GAAchQ,GAEtB,MADAA,GAAI8K,IAAY,EACT9K,EAOR,QAASiQ,GAAQjQ,GAChB,GAAIkQ,GAAMrM,EAASsM,cAAc,MAEjC,KACC,QAASnQ,EAAIkQ,GACZ,MAAOhP,GACR,OAAO,EACN,QAEIgP,EAAIlE,YACRkE,EAAIlE,WAAWoE,YAAaF,GAG7BA,EAAM,MASR,QAASG,GAAWC,EAAOC,GAI1B,IAHA,GAAIC,GAAMF,EAAMrT,MAAM,KACrBb,EAAIkU,EAAMjU,OAEHD,KACPyT,EAAKY,WAAYD,EAAIpU,IAAOmU,EAU9B,QAASG,GAAcC,EAAGC,GACzB,GAAIC,GAAMD,GAAKD,EACdG,EAAOD,GAAsB,IAAfF,EAAEjF,UAAiC,IAAfkF,EAAElF,YAChCkF,EAAEG,aAAeC,KACjBL,EAAEI,aAAeC,EAGtB,IAAKF,EACJ,MAAOA,EAIR,IAAKD,EACJ,KAASA,EAAMA,EAAII,aAClB,GAAKJ,IAAQD,EACZ,QAKH,OAAOD,GAAI,KAOZ,QAASO,GAAmB7I,GAC3B,MAAO,UAAUoF,GAChB,GAAI1G,GAAO0G,EAAKgB,SAASC,aACzB,OAAgB,UAAT3H,GAAoB0G,EAAKpF,OAASA,GAQ3C,QAAS8I,GAAoB9I,GAC5B,MAAO,UAAUoF,GAChB,GAAI1G,GAAO0G,EAAKgB,SAASC,aACzB,QAAiB,UAAT3H,GAA6B,WAATA,IAAsB0G,EAAKpF,OAASA,GAQlE,QAAS+I,GAAwBpR,GAChC,MAAOgQ,GAAa,SAAUqB,GAE7B,MADAA,IAAYA,EACLrB,EAAa,SAAUxC,EAAM9I,GAMnC,IALA,GAAI4M,GACHC,EAAevR,KAAQwN,EAAKnR,OAAQgV,GACpCjV,EAAImV,EAAalV,OAGVD,KACFoR,EAAO8D,EAAIC,EAAanV,MAC5BoR,EAAK8D,KAAO5M,EAAQ4M,GAAK9D,EAAK8D,SAYnC,QAASpC,GAAa5B,GACrB,MAAOA,UAAkBA,GAAQZ,uBAAyB8E,GAAgBlE,EAu+B3E,QAASmE,MAuET,QAASzC,GAAY0C,GAIpB,IAHA,GAAItV,GAAI,EACPmF,EAAMmQ,EAAOrV,OACbgR,EAAW,GACJjR,EAAImF,EAAKnF,IAChBiR,GAAYqE,EAAOtV,GAAGsF,KAEvB,OAAO2L,GAGR,QAASsE,GAAeC,EAASC,EAAYC,GAC5C,GAAIC,GAAMF,EAAWE,IACpBC,EAAmBF,GAAgB,eAARC,EAC3BE,EAAWxQ,GAEZ,OAAOoQ,GAAWK,MAEjB,SAAUzE,EAAMH,EAAS6E,GACxB,KAAS1E,EAAOA,EAAMsE,IACrB,GAAuB,IAAlBtE,EAAK/B,UAAkBsG,EAC3B,MAAOJ,GAASnE,EAAMH,EAAS6E,IAMlC,SAAU1E,EAAMH,EAAS6E,GACxB,GAAIC,GAAUC,EACbC,GAAaC,EAASN,EAGvB,IAAKE,GACJ,KAAS1E,EAAOA,EAAMsE,IACrB,IAAuB,IAAlBtE,EAAK/B,UAAkBsG,IACtBJ,EAASnE,EAAMH,EAAS6E,GAC5B,OAAO,MAKV,MAAS1E,EAAOA,EAAMsE,IACrB,GAAuB,IAAlBtE,EAAK/B,UAAkBsG,EAAmB,CAE9C,GADAK,EAAa5E,EAAM3C,KAAc2C,EAAM3C,QACjCsH,EAAWC,EAAYN,KAC5BK,EAAU,KAAQG,GAAWH,EAAU,KAAQH,EAG/C,MAAQK,GAAU,GAAMF,EAAU,EAMlC,IAHAC,EAAYN,GAAQO,EAGdA,EAAU,GAAMV,EAASnE,EAAMH,EAAS6E,GAC7C,OAAO,IASf,QAASK,GAAgBC,GACxB,MAAOA,GAASpW,OAAS,EACxB,SAAUoR,EAAMH,EAAS6E,GAExB,IADA,GAAI/V,GAAIqW,EAASpW,OACTD,KACP,IAAMqW,EAASrW,GAAIqR,EAAMH,EAAS6E,GACjC,OAAO,CAGT,QAAO,GAERM,EAAS,GAGX,QAASC,GAAkBrF,EAAUsF,EAAUpF,GAG9C,IAFA,GAAInR,GAAI,EACPmF,EAAMoR,EAAStW,OACRD,EAAImF,EAAKnF,IAChBgR,EAAQC,EAAUsF,EAASvW,GAAImR,EAEhC,OAAOA,GAGR,QAASqF,GAAUC,EAAWC,EAAKC,EAAQzF,EAAS6E,GAOnD,IANA,GAAI1E,GACHuF,KACA5W,EAAI,EACJmF,EAAMsR,EAAUxW,OAChB4W,EAAgB,MAAPH,EAEF1W,EAAImF,EAAKnF,KACVqR,EAAOoF,EAAUzW,MAChB2W,IAAUA,EAAQtF,EAAMH,EAAS6E,KACtCa,EAAaxW,KAAMiR,GACdwF,GACJH,EAAItW,KAAMJ,IAMd,OAAO4W,GAGR,QAASE,GAAYC,EAAW9F,EAAUuE,EAASwB,EAAYC,EAAYC,GAO1E,MANKF,KAAeA,EAAYtI,KAC/BsI,EAAaF,EAAYE,IAErBC,IAAeA,EAAYvI,KAC/BuI,EAAaH,EAAYG,EAAYC,IAE/BtD,EAAa,SAAUxC,EAAMD,EAASD,EAAS6E,GACrD,GAAIoB,GAAMnX,EAAGqR,EACZ+F,KACAC,KACAC,EAAcnG,EAAQlR,OAGtBsX,EAAQnG,GAAQkF,EAAkBrF,GAAY,IAAKC,EAAQ5B,UAAa4B,GAAYA,MAGpFsG,GAAYT,IAAe3F,GAASH,EAEnCsG,EADAf,EAAUe,EAAOH,EAAQL,EAAW7F,EAAS6E,GAG9C0B,EAAajC,EAEZyB,IAAgB7F,EAAO2F,EAAYO,GAAeN,MAMjD7F,EACDqG,CAQF,IALKhC,GACJA,EAASgC,EAAWC,EAAYvG,EAAS6E,GAIrCiB,EAMJ,IALAG,EAAOX,EAAUiB,EAAYJ,GAC7BL,EAAYG,KAAUjG,EAAS6E,GAG/B/V,EAAImX,EAAKlX,OACDD,MACDqR,EAAO8F,EAAKnX,MACjByX,EAAYJ,EAAQrX,MAASwX,EAAWH,EAAQrX,IAAOqR,GAK1D,IAAKD,GACJ,GAAK6F,GAAcF,EAAY,CAC9B,GAAKE,EAAa,CAIjB,IAFAE,KACAnX,EAAIyX,EAAWxX,OACPD,MACDqR,EAAOoG,EAAWzX,KAEvBmX,EAAK/W,KAAOoX,EAAUxX,GAAKqR,EAG7B4F,GAAY,KAAOQ,KAAkBN,EAAMpB,GAK5C,IADA/V,EAAIyX,EAAWxX,OACPD,MACDqR,EAAOoG,EAAWzX,MACtBmX,EAAOF,EAAatN,GAAQzE,KAAMkM,EAAMC,GAAS+F,EAAOpX,SAEzDoR,EAAK+F,KAAUhG,EAAQgG,GAAQ9F,SAOlCoG,GAAajB,EACZiB,IAAetG,EACdsG,EAAWC,OAAQJ,EAAaG,EAAWxX,QAC3CwX,GAEGR,EACJA,EAAY,KAAM9F,EAASsG,EAAY1B,GAEvC3V,EAAKC,MAAO8Q,EAASsG,KAMzB,QAASE,GAAmBrC,GAqB3B,IApBA,GAAIsC,GAAcpC,EAASN,EAC1B/P,EAAMmQ,EAAOrV,OACb4X,EAAkBpE,EAAKqE,SAAUxC,EAAO,GAAGrJ,MAC3C8L,EAAmBF,GAAmBpE,EAAKqE,SAAS,KACpD9X,EAAI6X,EAAkB,EAAI,EAG1BG,EAAezC,EAAe,SAAUlE,GACvC,MAAOA,KAASuG,GACdG,GAAkB,GACrBE,EAAkB1C,EAAe,SAAUlE,GAC1C,MAAO1H,IAAQzE,KAAM0S,EAAcvG,OACjC0G,GAAkB,GACrB1B,GAAa,SAAUhF,EAAMH,EAAS6E,GACrC,OAAU8B,IAAqB9B,GAAO7E,IAAYgH,MAChDN,EAAe1G,GAAS5B,SACxB0I,EAAc3G,EAAMH,EAAS6E,GAC7BkC,EAAiB5G,EAAMH,EAAS6E,MAG5B/V,EAAImF,EAAKnF,IAChB,GAAMwV,EAAU/B,EAAKqE,SAAUxC,EAAOtV,GAAGiM,MACxCoK,GAAad,EAAca,EAAgBC,GAAYb,QACjD,CAIN,GAHAA,EAAU/B,EAAKkD,OAAQrB,EAAOtV,GAAGiM,MAAO5L,MAAO,KAAMiV,EAAOtV,GAAGsI,SAG1DkN,EAAS9G,GAAY,CAGzB,IADAwG,IAAMlV,EACEkV,EAAI/P,IACNsO,EAAKqE,SAAUxC,EAAOJ,GAAGjJ,MADdiJ,KAKjB,MAAO4B,GACN9W,EAAI,GAAKoW,EAAgBC,GACzBrW,EAAI,GAAK4S,EAER0C,EAAOlP,MAAO,EAAGpG,EAAI,GAAIgQ,QAAS1K,MAAgC,MAAzBgQ,EAAQtV,EAAI,GAAIiM,KAAe,IAAM,MAC7EwG,QAASW,GAAO,MAClBoC,EACAxV,EAAIkV,GAAKyC,EAAmBrC,EAAOlP,MAAOpG,EAAGkV,IAC7CA,EAAI/P,GAAOwS,EAAoBrC,EAASA,EAAOlP,MAAO8O,IACtDA,EAAI/P,GAAOyN,EAAY0C,IAGzBe,EAASjW,KAAMoV,GAIjB,MAAOY,GAAgBC,GAGxB,QAAS8B,GAA0BC,EAAiBC,GACnD,GAAIC,GAAQD,EAAYpY,OAAS,EAChCsY,EAAYH,EAAgBnY,OAAS,EACrCuY,EAAe,SAAUpH,EAAMF,EAAS6E,EAAK5E,EAASsH,GACrD,GAAIpH,GAAM6D,EAAGM,EACZkD,EAAe,EACf1Y,EAAI,IACJyW,EAAYrF,MACZuH,KACAC,EAAgBV,EAEhBX,EAAQnG,GAAQmH,GAAa9E,EAAKoF,KAAU,IAAG,IAAKJ,GAEpDK,EAAiB3C,GAA4B,MAAjByC,EAAwB,EAAIlV,KAAKqV,UAAY,GACzE5T,EAAMoS,EAAMtX,MAUb,KARKwY,IACJP,EAAmBhH,IAAYzJ,GAAYyJ,GAOpClR,IAAMmF,GAA4B,OAApBkM,EAAOkG,EAAMvX,IAAaA,IAAM,CACrD,GAAKuY,GAAalH,EAAO,CAExB,IADA6D,EAAI,EACKM,EAAU4C,EAAgBlD,MAClC,GAAKM,EAASnE,EAAMH,EAAS6E,GAAQ,CACpC5E,EAAQ/Q,KAAMiR,EACd,OAGGoH,IACJtC,EAAU2C,GAKPR,KAEEjH,GAAQmE,GAAWnE,IACxBqH,IAIItH,GACJqF,EAAUrW,KAAMiR,IAOnB,GADAqH,GAAgB1Y,EACXsY,GAAStY,IAAM0Y,EAAe,CAElC,IADAxD,EAAI,EACKM,EAAU6C,EAAYnD,MAC9BM,EAASiB,EAAWkC,EAAYzH,EAAS6E,EAG1C,IAAK3E,EAAO,CAEX,GAAKsH,EAAe,EACnB,KAAQ1Y,KACAyW,EAAUzW,IAAM2Y,EAAW3Y,KACjC2Y,EAAW3Y,GAAKgZ,EAAI9T,KAAMiM,GAM7BwH,GAAanC,EAAUmC,GAIxBvY,EAAKC,MAAO8Q,EAASwH,GAGhBF,IAAcrH,GAAQuH,EAAW1Y,OAAS,GAC5CyY,EAAeL,EAAYpY,OAAW,GAExC+Q,EAAOiI,WAAY9H,GAUrB,MALKsH,KACJtC,EAAU2C,EACVZ,EAAmBU,GAGbnC,EAGT,OAAO6B,GACN1E,EAAc4E,GACdA,EApzDF,GAAIxY,GACHiS,EACAwB,EACAyF,EACAC,EACA5G,EACA6G,EACAjG,EACA+E,EACAmB,EACAC,EAGAzH,EACApK,EACA8R,EACAzH,EACAM,EACAoH,EACAlR,EACAqH,EAGAjB,EAAU,UAAY,GAAKK,MAC3B6C,EAAenM,OAAOgC,SACtB0O,EAAU,EACV9Q,EAAO,EACPoU,EAAapG,IACbqG,EAAarG,IACbsG,EAAgBtG,IAChBuG,EAAY,SAAUrF,EAAGC,GAIxB,MAHKD,KAAMC,IACV8E,GAAe,GAET,GAIRlE,QAAsB1V,GACtBkV,EAAe,GAAK,GAGpBiF,KAAcC,eACd1F,KACA4E,EAAM5E,EAAI4E,IACVe,EAAc3F,EAAIhU,KAClBA,EAAOgU,EAAIhU,KACXgG,GAAQgO,EAAIhO,MAEZuD,GAAUyK,EAAIzK,SAAW,SAAU0H,GAGlC,IAFA,GAAIrR,GAAI,EACPmF,EAAMpB,KAAK9D,OACJD,EAAImF,EAAKnF,IAChB,GAAK+D,KAAK/D,KAAOqR,EAChB,MAAOrR,EAGT,WAGDga,GAAW,6HAKXC,GAAa,sBAGbC,GAAa,mCAGbC,GAAa,MAAQF,GAAa,KAAOC,GAAa,OAASD,GAE9D,gBAAkBA,GAElB,2DAA6DC,GAAa,OAASD,GACnF,OAEDG,GAAU,KAAOF,GAAa,wFAKAC,GAAa,eAM3C/G,GAAQ,GAAIiH,QAAQ,IAAMJ,GAAa,8BAAgCA,GAAa,KAAM,KAE1FK,GAAS,GAAID,QAAQ,IAAMJ,GAAa,KAAOA,GAAa,KAC5DM,GAAe,GAAIF,QAAQ,IAAMJ,GAAa,WAAaA,GAAa,IAAMA,GAAa,KAE3FO,GAAmB,GAAIH,QAAQ,IAAMJ,GAAa,iBAAmBA,GAAa,OAAQ,KAE1FQ,GAAU,GAAIJ,QAAQD,IACtBM,GAAc,GAAIL,QAAQ,IAAMH,GAAa,KAE7CS,IACCC,GAAM,GAAIP,QAAQ,MAAQH,GAAa,KACvCW,MAAS,GAAIR,QAAQ,QAAUH,GAAa,KAC5CY,IAAO,GAAIT,QAAQ,KAAOH,GAAa,SACvCa,KAAQ,GAAIV,QAAQ,IAAMF,IAC1Ba,OAAU,GAAIX,QAAQ,IAAMD,IAC5Ba,MAAS,GAAIZ,QAAQ,yDAA2DJ,GAC/E,+BAAiCA,GAAa,cAAgBA,GAC9D,aAAeA,GAAa,SAAU,KACvCiB,KAAQ,GAAIb,QAAQ,OAASL,GAAW,KAAM,KAG9CmB,aAAgB,GAAId,QAAQ,IAAMJ,GAAa,mDAC9CA,GAAa,mBAAqBA,GAAa,mBAAoB,MAGrEmB,GAAU,sCACVC,GAAU,SAEVC,GAAU,yBAGVvJ,GAAa,mCAEbc,GAAW,OACXH,GAAU,QAGV6I,GAAY,GAAIlB,QAAQ,qBAAuBJ,GAAa,MAAQA,GAAa,OAAQ,MACzFuB,GAAY,SAAUC,EAAGC,EAASC,GACjC,GAAIC,GAAO,KAAOF,EAAU,KAI5B,OAAOE,KAASA,GAAQD,EACvBD,EACAE,EAAO,EAENC,OAAOC,aAAcF,EAAO,OAE5BC,OAAOC,aAAcF,GAAQ,GAAK,MAAe,KAAPA,EAAe,OAI7D,KACCxb,EAAKC,MACH+T,EAAMhO,GAAMlB,KAAM0M,EAAamK,YAChCnK,EAAamK,YAId3H,EAAKxC,EAAamK,WAAW9b,QAASqP,SACrC,MAAQxK,IACT1E,GAASC,MAAO+T,EAAInU,OAGnB,SAAUU,EAAQqb,GACjBjC,EAAY1Z,MAAOM,EAAQyF,GAAMlB,KAAK8W,KAKvC,SAAUrb,EAAQqb,GAIjB,IAHA,GAAI9G,GAAIvU,EAAOV,OACdD,EAAI,EAEIW,EAAOuU,KAAO8G,EAAIhc,OAC3BW,EAAOV,OAASiV,EAAI,IAqQvBjD,EAAUjB,EAAOiB,WAOjBkH,EAAQnI,EAAOmI,MAAQ,SAAU9H,GAGhC,GAAI9E,GAAkB8E,IAASA,EAAKhF,eAAiBgF,GAAM9E,eAC3D,SAAOA,GAA+C,SAA7BA,EAAgB8F,UAQ1CR,EAAcb,EAAOa,YAAc,SAAUoK,GAK5C,QAASC,GAAO1O,GAEf,IACC,MAAOA,GAAIjK,IACV,MAAOiC,IAIT,MAAO,MAZR,GAAI2W,GACH7P,EAAM2P,EAAOA,EAAK5P,eAAiB4P,EAAOrK,EAC1CwK,EAAS9P,EAAI4D,WAcd,OAAK5D,KAAQ7E,GAA6B,IAAjB6E,EAAIgD,UAAmBhD,EAAIC,iBAKpD9E,EAAW6E,EACXiN,EAAUjN,EAAIC,gBAGduF,GAAkBqH,EAAO7M,GAMpB8P,GAAUA,IAAWF,EAAOE,KAE3BA,EAAOvR,iBACXuR,EAAOvR,iBAAkB,SAAU,WAClCgH,MACE,GACQuK,EAAOtR,aAClBsR,EAAOtR,YAAa,WAAY,WAC/B+G,OAUHI,EAAQkI,WAAatG,EAAO,SAAUC,GAErC,MADAA,GAAIuI,UAAY,KACRvI,EAAItB,aAAa,eAO1BP,EAAQ3B,qBAAuBuD,EAAO,SAAUC,GAE/C,MADAA,GAAIwI,YAAahQ,EAAIiQ,cAAc,MAC3BzI,EAAIxD,qBAAqB,KAAKrQ,SAIvCgS,EAAQC,uBAAyBoJ,GAAQ9R,KAAM8C,EAAI4F,wBAMnDD,EAAQuK,QAAU3I,EAAO,SAAUC,GAElC,MADAyF,GAAQ+C,YAAaxI,GAAMvT,GAAKmO,GACxBpC,EAAImQ,oBAAsBnQ,EAAImQ,kBAAmB/N,GAAUzO,SAI/DgS,EAAQuK,SACZ/I,EAAKoF,KAAS,GAAI,SAAUtY,EAAI2Q,GAC/B,SAAYA,GAAQc,iBAAmBoD,GAAgBtD,EAAiB,CACvE,GAAIR,GAAIJ,EAAQc,eAAgBzR,EAGhC,OAAO+Q,IAAKA,EAAE1B,YAAe0B,QAG/BmC,EAAKkD,OAAW,GAAI,SAAUpW,GAC7B,GAAImc,GAASnc,EAAGkS,QAAS8I,GAAWC,GACpC,OAAO,UAAUnK,GAChB,MAAOA,GAAKmB,aAAa,QAAUkK,YAM9BjJ,GAAKoF,KAAS,GAErBpF,EAAKkD,OAAW,GAAK,SAAUpW,GAC9B,GAAImc,GAASnc,EAAGkS,QAAS8I,GAAWC,GACpC,OAAO,UAAUnK,GAChB,GAAI4K,SAAc5K,GAAKsL,mBAAqBvH,GAAgB/D,EAAKsL,iBAAiB,KAClF,OAAOV,IAAQA,EAAK3W,QAAUoX,KAMjCjJ,EAAKoF,KAAU,IAAI5G,EAAQ3B,qBAC1B,SAAUsM,EAAK1L,GACd,SAAYA,GAAQZ,uBAAyB8E,EAC5C,MAAOlE,GAAQZ,qBAAsBsM,IAGvC,SAAUA,EAAK1L,GACd,GAAIG,GACHwL,KACA7c,EAAI,EACJmR,EAAUD,EAAQZ,qBAAsBsM,EAGzC,IAAa,MAARA,EAAc,CAClB,KAASvL,EAAOF,EAAQnR,MACA,IAAlBqR,EAAK/B,UACTuN,EAAIzc,KAAMiR,EAIZ,OAAOwL,GAER,MAAO1L,IAITsC,EAAKoF,KAAY,MAAI5G,EAAQC,wBAA0B,SAAUmK,EAAWnL,GAC3E,GAAKY,EACJ,MAAOZ,GAAQgB,uBAAwBmK,IAUzC7C,KAOApH,MAEMH,EAAQE,IAAMmJ,GAAQ9R,KAAM8C,EAAI0G,qBAGrCa,EAAO,SAAUC,GAMhBA,EAAIgJ,UAAY,mEAMXhJ,EAAId,iBAAiB,wBAAwB/S,QACjDmS,EAAUhS,KAAM,SAAW6Z,GAAa,gBAKnCnG,EAAId,iBAAiB,cAAc/S,QACxCmS,EAAUhS,KAAM,MAAQ6Z,GAAa,aAAeD,GAAW,KAM1DlG,EAAId,iBAAiB,YAAY/S,QACtCmS,EAAUhS,KAAK,cAIjByT,EAAO,SAAUC,GAGhB,GAAIiJ,GAAQzQ,EAAIyH,cAAc,QAC9BgJ,GAAMpK,aAAc,OAAQ,UAC5BmB,EAAIwI,YAAaS,GAAQpK,aAAc,OAAQ,KAI1CmB,EAAId,iBAAiB,YAAY/S,QACrCmS,EAAUhS,KAAM,OAAS6Z,GAAa,eAKjCnG,EAAId,iBAAiB,YAAY/S,QACtCmS,EAAUhS,KAAM,WAAY,aAI7B0T,EAAId,iBAAiB,QACrBZ,EAAUhS,KAAK,YAIX6R,EAAQ+K,gBAAkB1B,GAAQ9R,KAAOlB,EAAUiR,EAAQjR,SAChEiR,EAAQ0D,uBACR1D,EAAQ2D,oBACR3D,EAAQ4D,kBACR5D,EAAQ6D,qBAERvJ,EAAO,SAAUC,GAGhB7B,EAAQoL,kBAAoB/U,EAAQpD,KAAM4O,EAAK,OAI/CxL,EAAQpD,KAAM4O,EAAK,aACnB0F,EAAcpZ,KAAM,KAAMga,MAI5BhI,EAAYA,EAAUnS,QAAU,GAAIoa,QAAQjI,EAAUW,KAAK,MAC3DyG,EAAgBA,EAAcvZ,QAAU,GAAIoa,QAAQb,EAAczG,KAAK,MAIvEoJ,EAAab,GAAQ9R,KAAM+P,EAAQ+D,yBAKnC3N,EAAWwM,GAAcb,GAAQ9R,KAAM+P,EAAQ5J,UAC9C,SAAU4E,EAAGC,GACZ,GAAI+I,GAAuB,IAAfhJ,EAAEjF,SAAiBiF,EAAEhI,gBAAkBgI,EAClDiJ,EAAMhJ,GAAKA,EAAE5E,UACd,OAAO2E,KAAMiJ,MAAWA,GAAwB,IAAjBA,EAAIlO,YAClCiO,EAAM5N,SACL4N,EAAM5N,SAAU6N,GAChBjJ,EAAE+I,yBAA8D,GAAnC/I,EAAE+I,wBAAyBE,MAG3D,SAAUjJ,EAAGC,GACZ,GAAKA,EACJ,KAASA,EAAIA,EAAE5E,YACd,GAAK4E,IAAMD,EACV,OAAO,CAIV,QAAO,GAOTqF,EAAYuC,EACZ,SAAU5H,EAAGC,GAGZ,GAAKD,IAAMC,EAEV,MADA8E,IAAe,EACR,CAIR,IAAImE,IAAWlJ,EAAE+I,yBAA2B9I,EAAE8I,uBAC9C,OAAKG,GACGA,GAIRA,GAAYlJ,EAAElI,eAAiBkI,MAAUC,EAAEnI,eAAiBmI,GAC3DD,EAAE+I,wBAAyB9I,GAG3B,EAGc,EAAViJ,IACFxL,EAAQyL,cAAgBlJ,EAAE8I,wBAAyB/I,KAAQkJ,EAGxDlJ,IAAMjI,GAAOiI,EAAElI,gBAAkBuF,GAAgBjC,EAASiC,EAAc2C,MAGxEC,IAAMlI,GAAOkI,EAAEnI,gBAAkBuF,GAAgBjC,EAASiC,EAAc4C,GACrE,EAID6E,EACJ1P,GAAQzE,KAAMmU,EAAW9E,GAAM5K,GAAQzE,KAAMmU,EAAW7E,GAC1D,EAGe,EAAViJ,KAAmB,IAE3B,SAAUlJ,EAAGC,GAEZ,GAAKD,IAAMC,EAEV,MADA8E,IAAe,EACR,CAGR,IAAI7E,GACHzU,EAAI,EACJ2d,EAAMpJ,EAAE3E,WACR4N,EAAMhJ,EAAE5E,WACRgO,GAAOrJ,GACPsJ,GAAOrJ,EAGR,KAAMmJ,IAAQH,EACb,MAAOjJ,KAAMjI,KACZkI,IAAMlI,EAAM,EACZqR,KACAH,EAAM,EACNnE,EACE1P,GAAQzE,KAAMmU,EAAW9E,GAAM5K,GAAQzE,KAAMmU,EAAW7E,GAC1D,CAGK,IAAKmJ,IAAQH,EACnB,MAAOlJ,GAAcC,EAAGC,EAKzB,KADAC,EAAMF,EACGE,EAAMA,EAAI7E,YAClBgO,EAAGE,QAASrJ,EAGb,KADAA,EAAMD,EACGC,EAAMA,EAAI7E,YAClBiO,EAAGC,QAASrJ,EAIb,MAAQmJ,EAAG5d,KAAO6d,EAAG7d,IACpBA,GAGD,OAAOA,GAENsU,EAAcsJ,EAAG5d,GAAI6d,EAAG7d,IAGxB4d,EAAG5d,KAAO4R,KACViM,EAAG7d,KAAO4R,EAAe,EACzB,GAGKtF,GAvVC7E,GA0VTuJ,EAAO1I,QAAU,SAAUyV,EAAMC,GAChC,MAAOhN,GAAQ+M,EAAM,KAAM,KAAMC,IAGlChN,EAAOgM,gBAAkB,SAAU3L,EAAM0M,GASxC,IAPO1M,EAAKhF,eAAiBgF,KAAW5J,GACvCoK,EAAaR,GAId0M,EAAOA,EAAKtL,QAAS+H,GAAkB,UAElCvI,EAAQ+K,iBAAmBlL,KAC5B0H,IAAkBA,EAAchQ,KAAMuU,OACtC3L,IAAkBA,EAAU5I,KAAMuU,IAErC,IACC,GAAIlZ,GAAMyD,EAAQpD,KAAMmM,EAAM0M,EAG9B,IAAKlZ,GAAOoN,EAAQoL,mBAGlBhM,EAAK5J,UAAuC,KAA3B4J,EAAK5J,SAAS6H,SAChC,MAAOzK,GAEP,MAAMC,IAGT,MAAOkM,GAAQ+M,EAAMtW,EAAU,MAAQ4J,IAASpR,OAAS,GAG1D+Q,EAAOrB,SAAW,SAAUuB,EAASG,GAKpC,OAHOH,EAAQ7E,eAAiB6E,KAAczJ,GAC7CoK,EAAaX,GAEPvB,EAAUuB,EAASG,IAG3BL,EAAOiN,KAAO,SAAU5M,EAAM1G,IAEtB0G,EAAKhF,eAAiBgF,KAAW5J,GACvCoK,EAAaR,EAGd,IAAIzN,GAAK6P,EAAKY,WAAY1J,EAAK2H,eAE9BhM,EAAM1C,GAAMiW,EAAO3U,KAAMuO,EAAKY,WAAY1J,EAAK2H,eAC9C1O,EAAIyN,EAAM1G,GAAOmH,GACjBpS,CAEF,OAAO4G,KAAQ5G,EACd4G,EACA2L,EAAQkI,aAAerI,EACtBT,EAAKmB,aAAc7H,IAClBrE,EAAM+K,EAAKsL,iBAAiBhS,KAAUrE,EAAI4X,UAC1C5X,EAAIhB,MACJ,MAGJ0L,EAAOmN,MAAQ,SAAUC,GACxB,KAAM,IAAIC,OAAO,0CAA4CD,IAO9DpN,EAAOiI,WAAa,SAAU9H,GAC7B,GAAIE,GACHiN,KACApJ,EAAI,EACJlV,EAAI,CAOL,IAJAsZ,GAAgBrH,EAAQsM,iBACxBlF,GAAapH,EAAQuM,YAAcrN,EAAQ/K,MAAO,GAClD+K,EAAQsN,KAAM7E,GAETN,EAAe,CACnB,KAASjI,EAAOF,EAAQnR,MAClBqR,IAASF,EAASnR,KACtBkV,EAAIoJ,EAAWle,KAAMJ,GAGvB,MAAQkV,KACP/D,EAAQuG,OAAQ4G,EAAYpJ,GAAK,GAQnC,MAFAmE,GAAY,KAELlI,GAOR+H,EAAUlI,EAAOkI,QAAU,SAAU7H,GACpC,GAAI4K,GACHpX,EAAM,GACN7E,EAAI,EACJsP,EAAW+B,EAAK/B,QAEjB,IAAMA,GAMC,GAAkB,IAAbA,GAA+B,IAAbA,GAA+B,KAAbA,EAAkB,CAGjE,GAAiC,gBAArB+B,GAAKqN,YAChB,MAAOrN,GAAKqN,WAGZ,KAAMrN,EAAOA,EAAKsN,WAAYtN,EAAMA,EAAOA,EAAKwD,YAC/ChQ,GAAOqU,EAAS7H,OAGZ,IAAkB,IAAb/B,GAA+B,IAAbA,EAC7B,MAAO+B,GAAKuN,cAhBZ,MAAS3C,EAAO5K,EAAKrR,MAEpB6E,GAAOqU,EAAS+C,EAkBlB,OAAOpX,IAGR4O,EAAOzC,EAAO6N,WAGbnL,YAAa,GAEboL,aAAclL,EAEd7J,MAAO4Q,GAEPtG,cAEAwE,QAEAf,UACCiH,KAAOpJ,IAAK,aAAcG,OAAO,GACjCkJ,KAAOrJ,IAAK,cACZsJ,KAAOtJ,IAAK,kBAAmBG,OAAO,GACtCoJ,KAAOvJ,IAAK,oBAGboB,WACCgE,KAAQ,SAAUhR,GAUjB,MATAA,GAAM,GAAKA,EAAM,GAAG0I,QAAS8I,GAAWC,IAGxCzR,EAAM,IAAOA,EAAM,IAAMA,EAAM,IAAMA,EAAM,IAAM,IAAK0I,QAAS8I,GAAWC,IAExD,OAAbzR,EAAM,KACVA,EAAM,GAAK,IAAMA,EAAM,GAAK,KAGtBA,EAAM3D,MAAO,EAAG,IAGxB6U,MAAS,SAAUlR,GA6BlB,MAlBAA,GAAM,GAAKA,EAAM,GAAGuI,cAEY,QAA3BvI,EAAM,GAAG3D,MAAO,EAAG,IAEjB2D,EAAM,IACXiH,EAAOmN,MAAOpU,EAAM,IAKrBA,EAAM,KAAQA,EAAM,GAAKA,EAAM,IAAMA,EAAM,IAAM,GAAK,GAAmB,SAAbA,EAAM,IAA8B,QAAbA,EAAM,KACzFA,EAAM,KAAUA,EAAM,GAAKA,EAAM,IAAqB,QAAbA,EAAM,KAGpCA,EAAM,IACjBiH,EAAOmN,MAAOpU,EAAM,IAGdA,GAGRiR,OAAU,SAAUjR,GACnB,GAAIoV,GACHC,GAAYrV,EAAM,IAAMA,EAAM,EAE/B,OAAK4Q,IAAiB,MAAEnR,KAAMO,EAAM,IAC5B,MAIHA,EAAM,GACVA,EAAM,GAAKA,EAAM,IAAMA,EAAM,IAAM,GAGxBqV,GAAY3E,GAAQjR,KAAM4V,KAEpCD,EAAS5M,EAAU6M,GAAU,MAE7BD,EAASC,EAASzV,QAAS,IAAKyV,EAASnf,OAASkf,GAAWC,EAASnf,UAGvE8J,EAAM,GAAKA,EAAM,GAAG3D,MAAO,EAAG+Y,GAC9BpV,EAAM,GAAKqV,EAAShZ,MAAO,EAAG+Y,IAIxBpV,EAAM3D,MAAO,EAAG,MAIzBuQ,QAECmE,IAAO,SAAUuE,GAChB,GAAIhN,GAAWgN,EAAiB5M,QAAS8I,GAAWC,IAAYlJ,aAChE,OAA4B,MAArB+M,EACN,WAAa,OAAO,GACpB,SAAUhO,GACT,MAAOA,GAAKgB,UAAYhB,EAAKgB,SAASC,gBAAkBD,IAI3DwI,MAAS,SAAUwB,GAClB,GAAIiD,GAAU7F,EAAY4C,EAAY,IAEtC,OAAOiD,KACLA,EAAU,GAAIjF,QAAQ,MAAQJ,GAAa,IAAMoC,EAAY,IAAMpC,GAAa,SACjFR,EAAY4C,EAAW,SAAUhL,GAChC,MAAOiO,GAAQ9V,KAAgC,gBAAnB6H,GAAKgL,WAA0BhL,EAAKgL,iBAAoBhL,GAAKmB,eAAiB4C,GAAgB/D,EAAKmB,aAAa,UAAY,OAI3JuI,KAAQ,SAAUpQ,EAAM4U,EAAUC,GACjC,MAAO,UAAUnO,GAChB,GAAIoO,GAASzO,EAAOiN,KAAM5M,EAAM1G,EAEhC,OAAe,OAAV8U,EACgB,OAAbF,GAEFA,IAINE,GAAU,GAEU,MAAbF,EAAmBE,IAAWD,EACvB,OAAbD,EAAoBE,IAAWD,EAClB,OAAbD,EAAoBC,GAAqC,IAA5BC,EAAO9V,QAAS6V,GAChC,OAAbD,EAAoBC,GAASC,EAAO9V,QAAS6V,MAChC,OAAbD,EAAoBC,GAASC,EAAOrZ,OAAQoZ,EAAMvf,UAAauf,EAClD,OAAbD,GAAsB,IAAME,EAAS,KAAM9V,QAAS6V,MACvC,OAAbD,IAAoBE,IAAWD,GAASC,EAAOrZ,MAAO,EAAGoZ,EAAMvf,OAAS,KAAQuf,EAAQ,QAK3FvE,MAAS,SAAUhP,EAAMyT,EAAMzK,EAAUa,EAAO6J,GAC/C,GAAIC,GAAgC,QAAvB3T,EAAK7F,MAAO,EAAG,GAC3ByZ,EAA+B,SAArB5T,EAAK7F,UACf0Z,EAAkB,YAATJ,CAEV,OAAiB,KAAV5J,GAAwB,IAAT6J,EAGrB,SAAUtO,GACT,QAASA,EAAKzB,YAGf,SAAUyB,EAAMH,EAAS6E,GACxB,GAAIzC,GAAO2C,EAAYgG,EAAMvH,EAAMqL,EAAWC,EAC7CrK,EAAMiK,IAAWC,EAAU,cAAgB,kBAC3CzD,EAAS/K,EAAKzB,WACdjF,EAAOmV,GAAUzO,EAAKgB,SAASC,cAC/B2N,GAAYlK,IAAQ+J,CAErB,IAAK1D,EAAS,CAGb,GAAKwD,EAAS,CACb,KAAQjK,GAAM,CAEb,IADAsG,EAAO5K,EACE4K,EAAOA,EAAMtG,IACrB,GAAKmK,EAAS7D,EAAK5J,SAASC,gBAAkB3H,EAAyB,IAAlBsR,EAAK3M,SACzD,OAAO,CAIT0Q,GAAQrK,EAAe,SAAT1J,IAAoB+T,GAAS,cAE5C,OAAO,EAMR,GAHAA,GAAUH,EAAUzD,EAAOuC,WAAavC,EAAO8D,WAG1CL,GAAWI,GAQf,IANAhK,EAAamG,EAAQ1N,KAAc0N,EAAQ1N,OAC3C4E,EAAQ2C,EAAYhK,OACpB8T,EAAYzM,EAAM,KAAO6C,GAAW7C,EAAM,GAC1CoB,EAAOpB,EAAM,KAAO6C,GAAW7C,EAAM,GACrC2I,EAAO8D,GAAa3D,EAAOL,WAAYgE,GAE9B9D,IAAS8D,GAAa9D,GAAQA,EAAMtG,KAG3CjB,EAAOqL,EAAY,IAAMC,EAAMhH,OAGhC,GAAuB,IAAlBiD,EAAK3M,YAAoBoF,GAAQuH,IAAS5K,EAAO,CACrD4E,EAAYhK,IAAWkK,EAAS4J,EAAWrL,EAC3C,YAKI,IAAKuL,IAAa3M,GAASjC,EAAM3C,KAAc2C,EAAM3C,QAAkBzC,KAAWqH,EAAM,KAAO6C,EACrGzB,EAAOpB,EAAM,OAKb,OAAS2I,IAAS8D,GAAa9D,GAAQA,EAAMtG,KAC3CjB,EAAOqL,EAAY,IAAMC,EAAMhH,UAEzB8G,EAAS7D,EAAK5J,SAASC,gBAAkB3H,EAAyB,IAAlBsR,EAAK3M,cAAsBoF,IAE5EuL,KACHhE,EAAMvN,KAAcuN,EAAMvN,QAAkBzC,IAAWkK,EAASzB,IAG7DuH,IAAS5K,MASjB,MADAqD,IAAQiL,EACDjL,IAASoB,GAAWpB,EAAOoB,IAAU,GAAKpB,EAAOoB,GAAS,KAKrEkF,OAAU,SAAUmF,EAAQlL,GAK3B,GAAI9O,GACHvC,EAAK6P,EAAK2G,QAAS+F,IAAY1M,EAAK4B,WAAY8K,EAAO7N,gBACtDtB,EAAOmN,MAAO,uBAAyBgC,EAKzC,OAAKvc,GAAI8K,GACD9K,EAAIqR,GAIPrR,EAAG3D,OAAS,GAChBkG,GAASga,EAAQA,EAAQ,GAAIlL,GACtBxB,EAAK4B,WAAWyE,eAAgBqG,EAAO7N,eAC7CsB,EAAa,SAAUxC,EAAM9I,GAI5B,IAHA,GAAI8X,GACHC,EAAUzc,EAAIwN,EAAM6D,GACpBjV,EAAIqgB,EAAQpgB,OACLD,KACPogB,EAAMzW,GAAQzE,KAAMkM,EAAMiP,EAAQrgB,IAClCoR,EAAMgP,KAAW9X,EAAS8X,GAAQC,EAAQrgB,MAG5C,SAAUqR,GACT,MAAOzN,GAAIyN,EAAM,EAAGlL,KAIhBvC,IAITwW,SAECkG,IAAO1M,EAAa,SAAU3C,GAI7B,GAAI8L,MACH5L,KACAqE,EAAU4D,EAASnI,EAASwB,QAASW,GAAO,MAE7C,OAAOoC,GAAS9G,GACfkF,EAAa,SAAUxC,EAAM9I,EAAS4I,EAAS6E,GAM9C,IALA,GAAI1E,GACHoF,EAAYjB,EAASpE,EAAM,KAAM2E,MACjC/V,EAAIoR,EAAKnR,OAGFD,MACDqR,EAAOoF,EAAUzW,MACtBoR,EAAKpR,KAAOsI,EAAQtI,GAAKqR,MAI5B,SAAUA,EAAMH,EAAS6E,GAGxB,MAFAgH,GAAM,GAAK1L,EACXmE,EAASuH,EAAO,KAAMhH,EAAK5E,IACnBA,EAAQ6H,SAInBuH,IAAO3M,EAAa,SAAU3C,GAC7B,MAAO,UAAUI,GAChB,MAAOL,GAAQC,EAAUI,GAAOpR,OAAS,KAI3C0P,SAAYiE,EAAa,SAAU4M,GAElC,MADAA,GAAOA,EAAK/N,QAAS8I,GAAWC,IACzB,SAAUnK,GAChB,OAASA,EAAKqN,aAAerN,EAAKoP,WAAavH,EAAS7H,IAAS1H,QAAS6W,SAW5EE,KAAQ9M,EAAc,SAAU8M,GAM/B,MAJMhG,IAAYlR,KAAKkX,GAAQ,KAC9B1P,EAAOmN,MAAO,qBAAuBuC,GAEtCA,EAAOA,EAAKjO,QAAS8I,GAAWC,IAAYlJ,cACrC,SAAUjB,GAChB,GAAIsP,EACJ,GACC,IAAMA,EAAW7O,EAChBT,EAAKqP,KACLrP,EAAKmB,aAAa,aAAenB,EAAKmB,aAAa,QAGnD,MADAmO,GAAWA,EAASrO,cACbqO,IAAaD,GAA2C,IAAnCC,EAAShX,QAAS+W,EAAO,YAE5CrP,EAAOA,EAAKzB,aAAiC,IAAlByB,EAAK/B,SAC3C,QAAO,KAKT3O,OAAU,SAAU0Q,GACnB,GAAIuP,GAAOnb,OAAOob,UAAYpb,OAAOob,SAASD,IAC9C,OAAOA,IAAQA,EAAKxa,MAAO,KAAQiL,EAAK9Q,IAGzCugB,KAAQ,SAAUzP,GACjB,MAAOA,KAASkI,GAGjBwH,MAAS,SAAU1P,GAClB,MAAOA,KAAS5J,EAASuZ,iBAAmBvZ,EAASwZ,UAAYxZ,EAASwZ,gBAAkB5P,EAAKpF,MAAQoF,EAAK6P,OAAS7P,EAAK8P,WAI7HC,QAAW,SAAU/P,GACpB,MAAOA,GAAKgQ,YAAa,GAG1BA,SAAY,SAAUhQ,GACrB,MAAOA,GAAKgQ,YAAa,GAG1BC,QAAW,SAAUjQ,GAGpB,GAAIgB,GAAWhB,EAAKgB,SAASC,aAC7B,OAAqB,UAAbD,KAA0BhB,EAAKiQ,SAA0B,WAAbjP,KAA2BhB,EAAKkQ,UAGrFA,SAAY,SAAUlQ,GAOrB,MAJKA,GAAKzB,YACTyB,EAAKzB,WAAW4R,cAGVnQ,EAAKkQ,YAAa,GAI1BE,MAAS,SAAUpQ,GAKlB,IAAMA,EAAOA,EAAKsN,WAAYtN,EAAMA,EAAOA,EAAKwD,YAC/C,GAAKxD,EAAK/B,SAAW,EACpB,OAAO,CAGT,QAAO,GAGR8M,OAAU,SAAU/K,GACnB,OAAQoC,EAAK2G,QAAe,MAAG/I,IAIhCqQ,OAAU,SAAUrQ,GACnB,MAAOgK,IAAQ7R,KAAM6H,EAAKgB,WAG3B0K,MAAS,SAAU1L,GAClB,MAAO+J,IAAQ5R,KAAM6H,EAAKgB,WAG3BsP,OAAU,SAAUtQ,GACnB,GAAI1G,GAAO0G,EAAKgB,SAASC,aACzB,OAAgB,UAAT3H,GAAkC,WAAd0G,EAAKpF,MAA8B,WAATtB,GAGtD6V,KAAQ,SAAUnP,GACjB,GAAI4M,EACJ,OAAuC,UAAhC5M,EAAKgB,SAASC,eACN,SAAdjB,EAAKpF,OAImC,OAArCgS,EAAO5M,EAAKmB,aAAa,UAA2C,SAAvByL,EAAK3L,gBAIvDwD,MAASd,EAAuB,WAC/B,OAAS,KAGV2K,KAAQ3K,EAAuB,SAAUG,EAAclV,GACtD,OAASA,EAAS,KAGnB2hB,GAAM5M,EAAuB,SAAUG,EAAclV,EAAQgV,GAC5D,OAASA,EAAW,EAAIA,EAAWhV,EAASgV,KAG7C4M,KAAQ7M,EAAuB,SAAUG,EAAclV,GAEtD,IADA,GAAID,GAAI,EACAA,EAAIC,EAAQD,GAAK,EACxBmV,EAAa/U,KAAMJ,EAEpB,OAAOmV,KAGR2M,IAAO9M,EAAuB,SAAUG,EAAclV,GAErD,IADA,GAAID,GAAI,EACAA,EAAIC,EAAQD,GAAK,EACxBmV,EAAa/U,KAAMJ,EAEpB,OAAOmV,KAGR4M,GAAM/M,EAAuB,SAAUG,EAAclV,EAAQgV,GAE5D,IADA,GAAIjV,GAAIiV,EAAW,EAAIA,EAAWhV,EAASgV,IACjCjV,GAAK,GACdmV,EAAa/U,KAAMJ,EAEpB,OAAOmV,KAGR6M,GAAMhN,EAAuB,SAAUG,EAAclV,EAAQgV,GAE5D,IADA,GAAIjV,GAAIiV,EAAW,EAAIA,EAAWhV,EAASgV,IACjCjV,EAAIC,GACbkV,EAAa/U,KAAMJ,EAEpB,OAAOmV,OAKV1B,EAAK2G,QAAa,IAAI3G,EAAK2G,QAAY,EAGvC,KAAMpa,KAAOiiB,OAAO,EAAMC,UAAU,EAAMC,MAAM,EAAMC,UAAU,EAAMC,OAAO,GAC5E5O,EAAK2G,QAASpa,GAAM8U,EAAmB9U,EAExC,KAAMA,KAAOsiB,QAAQ,EAAMC,OAAO,GACjC9O,EAAK2G,QAASpa,GAAM+U,EAAoB/U,EA0lBzC,OArlBAqV,GAAWrP,UAAYyN,EAAK+O,QAAU/O,EAAK2G,QAC3C3G,EAAK4B,WAAa,GAAIA,GAEtB9C,EAAWvB,EAAOuB,SAAW,SAAUtB,EAAUwR,GAChD,GAAIpC,GAAStW,EAAOuL,EAAQrJ,EAC3ByW,EAAOnR,EAAQoR,EACfC,EAASlJ,EAAYzI,EAAW,IAEjC,IAAK2R,EACJ,MAAOH,GAAY,EAAIG,EAAOxc,MAAO,EAOtC,KAJAsc,EAAQzR,EACRM,KACAoR,EAAalP,EAAKsD,UAEV2L,GAAQ,CAGTrC,KAAYtW,EAAQuQ,GAAO5Q,KAAMgZ,MACjC3Y,IAEJ2Y,EAAQA,EAAMtc,MAAO2D,EAAM,GAAG9J,SAAYyiB,GAE3CnR,EAAOnR,KAAOkV,OAGf+K,GAAU,GAGJtW,EAAQwQ,GAAa7Q,KAAMgZ,MAChCrC,EAAUtW,EAAM4J,QAChB2B,EAAOlV,MACNkF,MAAO+a,EAEPpU,KAAMlC,EAAM,GAAG0I,QAASW,GAAO,OAEhCsP,EAAQA,EAAMtc,MAAOia,EAAQpgB,QAI9B,KAAMgM,IAAQwH,GAAKkD,SACZ5M,EAAQ4Q,GAAW1O,GAAOvC,KAAMgZ,KAAcC,EAAY1W,MAC9DlC,EAAQ4Y,EAAY1W,GAAQlC,MAC7BsW,EAAUtW,EAAM4J,QAChB2B,EAAOlV,MACNkF,MAAO+a,EACPpU,KAAMA,EACN3D,QAASyB,IAEV2Y,EAAQA,EAAMtc,MAAOia,EAAQpgB,QAI/B,KAAMogB,EACL,MAOF,MAAOoC,GACNC,EAAMziB,OACNyiB,EACC1R,EAAOmN,MAAOlN,GAEdyI,EAAYzI,EAAUM,GAASnL,MAAO,IAqWzCgT,EAAUpI,EAAOoI,QAAU,SAAUnI,EAAUlH,GAC9C,GAAI/J,GACHqY,KACAD,KACAwK,EAASjJ,EAAe1I,EAAW,IAEpC,KAAM2R,EAAS,CAMd,IAJM7Y,IACLA,EAAQwI,EAAUtB,IAEnBjR,EAAI+J,EAAM9J,OACFD,KACP4iB,EAASjL,EAAmB5N,EAAM/J,IAC7B4iB,EAAQlU,GACZ2J,EAAYjY,KAAMwiB,GAElBxK,EAAgBhY,KAAMwiB,EAKxBA,GAASjJ,EAAe1I,EAAUkH,EAA0BC,EAAiBC,IAG7EuK,EAAO3R,SAAWA,EAEnB,MAAO2R,IAYRzP,EAASnC,EAAOmC,OAAS,SAAUlC,EAAUC,EAASC,EAASC,GAC9D,GAAIpR,GAAGsV,EAAQuN,EAAO5W,EAAM4M,EAC3BiK,EAA+B,kBAAb7R,IAA2BA,EAC7ClH,GAASqH,GAAQmB,EAAWtB,EAAW6R,EAAS7R,UAAYA,EAK7D,IAHAE,EAAUA,MAGY,IAAjBpH,EAAM9J,OAAe,CAIzB,GADAqV,EAASvL,EAAM,GAAKA,EAAM,GAAG3D,MAAO,GAC/BkP,EAAOrV,OAAS,GAAkC,QAA5B4iB,EAAQvN,EAAO,IAAIrJ,MAC5CgG,EAAQuK,SAAgC,IAArBtL,EAAQ5B,UAAkBwC,GAC7C2B,EAAKqE,SAAUxC,EAAO,GAAGrJ,MAAS,CAGnC,GADAiF,GAAYuC,EAAKoF,KAAS,GAAGgK,EAAMva,QAAQ,GAAGmK,QAAQ8I,GAAWC,IAAYtK,QAAkB,IACzFA,EACL,MAAOC,EAGI2R,KACX5R,EAAUA,EAAQtB,YAGnBqB,EAAWA,EAAS7K,MAAOkP,EAAO3B,QAAQrO,MAAMrF,QAKjD,IADAD,EAAI2a,GAAwB,aAAEnR,KAAMyH,GAAa,EAAIqE,EAAOrV,OACpDD,MACP6iB,EAAQvN,EAAOtV,IAGVyT,EAAKqE,SAAW7L,EAAO4W,EAAM5W,QAGlC,IAAM4M,EAAOpF,EAAKoF,KAAM5M,MAEjBmF,EAAOyH,EACZgK,EAAMva,QAAQ,GAAGmK,QAAS8I,GAAWC,IACrC3I,GAASrJ,KAAM8L,EAAO,GAAGrJ,OAAU6G,EAAa5B,EAAQtB,aAAgBsB,IACpE,CAKJ,GAFAoE,EAAOoC,OAAQ1X,EAAG,GAClBiR,EAAWG,EAAKnR,QAAU2S,EAAY0C,IAChCrE,EAEL,MADA7Q,GAAKC,MAAO8Q,EAASC,GACdD,CAGR,QAeJ,OAPE2R,GAAY1J,EAASnI,EAAUlH,IAChCqH,EACAF,GACCY,EACDX,EACA0B,GAASrJ,KAAMyH,IAAc6B,EAAa5B,EAAQtB,aAAgBsB,GAE5DC,GAMRc,EAAQuM,WAAa9P,EAAQ7N,MAAM,IAAI4d,KAAM7E,GAAY7G,KAAK,MAAQrE,EAItEuD,EAAQsM,mBAAqBjF,EAG7BzH,IAIAI,EAAQyL,aAAe7J,EAAO,SAAUkP,GAEvC,MAAuE,GAAhEA,EAAKzF,wBAAyB7V,EAASsM,cAAc,UAMvDF,EAAO,SAAUC,GAEtB,MADAA,GAAIgJ,UAAY,mBAC+B,MAAxChJ,EAAI6K,WAAWnM,aAAa,WAEnCyB,EAAW,yBAA0B,SAAU5C,EAAM1G,EAAMwO,GAC1D,IAAMA,EACL,MAAO9H,GAAKmB,aAAc7H,EAA6B,SAAvBA,EAAK2H,cAA2B,EAAI,KAOjEL,EAAQkI,YAAetG,EAAO,SAAUC,GAG7C,MAFAA,GAAIgJ,UAAY,WAChBhJ,EAAI6K,WAAWhM,aAAc,QAAS,IACY,KAA3CmB,EAAI6K,WAAWnM,aAAc,YAEpCyB,EAAW,QAAS,SAAU5C,EAAM1G,EAAMwO,GACzC,IAAMA,GAAyC,UAAhC9H,EAAKgB,SAASC,cAC5B,MAAOjB,GAAK2R,eAOTnP,EAAO,SAAUC,GACtB,MAAuC,OAAhCA,EAAItB,aAAa,eAExByB,EAAW+F,GAAU,SAAU3I,EAAM1G,EAAMwO,GAC1C,GAAI7S,EACJ,KAAM6S,EACL,MAAO9H,GAAM1G,MAAW,EAAOA,EAAK2H,eACjChM,EAAM+K,EAAKsL,iBAAkBhS,KAAWrE,EAAI4X,UAC7C5X,EAAIhB,MACL,OAMG0L,IAuBP1Q,EAAO,sBAAwB,WAK9B,QAAS2iB,GAAQC,GAChB,GAAiBljB,GAAGqO,EAAhB8U,EAAQD,CAEZ,KAAKrd,EAAQqd,GAEZ,IADAC,KACKnjB,EAAI,EAAGqO,EAAI6U,EAAIjjB,OAAQD,EAAIqO,EAAGrO,IAClCmjB,EAAMnjB,GAAKkjB,EAAIljB,EAIjB,OAAOmjB,GAGR,QAASC,GAAKC,EAAG3e,EAAI4e,GACpB,GAAIC,GAAGlV,CAEP,KAAKgV,EACJ,MAAO,EAKR,IAFAC,EAAIA,GAAKD,EAELA,EAAEpjB,SAAWP,GAEhB,IAAK6jB,EAAI,EAAGlV,EAAIgV,EAAEpjB,OAAQsjB,EAAIlV,EAAGkV,IAChC,GAAI7e,EAAGQ,KAAKoe,EAAGD,EAAEE,GAAIA,EAAGF,MAAO,EAC9B,MAAO,OAKT,KAAKE,IAAKF,GACT,GAAIA,EAAEvJ,eAAeyJ,IAChB7e,EAAGQ,KAAKoe,EAAGD,EAAEE,GAAIA,EAAGF,MAAO,EAC9B,MAAO,EAMX,OAAO,GAGR,QAAS3M,GAAIyM,EAAOtjB,GACnB,GAAI2jB,KAMJ,OAJAJ,GAAKD,EAAO,SAASM,EAAMC,GAC1BF,EAAIpjB,KAAKP,EAAS4jB,EAAMC,EAAOP,MAGzBK,EAGR,QAAS7M,GAAOpC,EAAGoP,GAClB,GAAIN,KAQJ,OANAD,GAAK7O,EAAG,SAASqP,EAAGF,GACdC,IAAKA,EAAEC,EAAGF,EAAOnP,IACrB8O,EAAEjjB,KAAKwjB,KAIFP,EAGR,QAAS1Z,GAAQ4K,EAAGqP,GACnB,GAAI5jB,GAAGqO,CAEP,IAAIkG,EACH,IAAKvU,EAAI,EAAGqO,EAAIkG,EAAEtU,OAAQD,EAAIqO,EAAGrO,IAChC,GAAIuU,EAAEvU,KAAO4jB,EACZ,MAAO5jB,EAKV,UAGD,QAAS6jB,GAAOC,EAAYC,EAAUC,EAAangB,GAClD,GAAI7D,GAAI,CAMR,KAJIU,UAAUT,OAAS,IACtB+jB,EAAcF,EAAW,IAGnB9jB,EAAI8jB,EAAW7jB,OAAQD,IAC7BgkB,EAAcD,EAAS7e,KAAKrB,EAASmgB,EAAaF,EAAW9jB,GAAIA,EAGlE,OAAOgkB,GAGR,QAASC,GAAUd,EAAOe,EAAWrgB,GACpC,GAAI7D,GAAGqO,CAEP,KAAKrO,EAAI,EAAGqO,EAAI8U,EAAMljB,OAAQD,EAAIqO,EAAGrO,IACpC,GAAIkkB,EAAUhf,KAAKrB,EAASsf,EAAMnjB,GAAIA,EAAGmjB,GACxC,MAAOnjB,EAIT,UAGD,QAAS6Y,GAAKsK,EAAOe,EAAWrgB,GAC/B,GAAIuc,GAAM6D,EAAUd,EAAOe,EAAWrgB,EAEtC,OAAIuc,QACI+C,EAAM/C,GAGP1gB,EAGR,QAASigB,GAAKmE,GACb,MAAOA,GAAWA,EAAW7jB,OAAS,GAxHvC,GAAI4F,GAAUC,MAAMD,SAAW,SAASqd,GACvC,MAA+C,mBAAxCnd,OAAOC,UAAUC,SAASf,KAAKge,GA0HvC,QACCrd,QAASA,EACTod,QAASA,EACTG,KAAMA,EACN1M,IAAKA,EACLC,OAAQA,EACRhN,QAASA,EACTka,OAAQA,EACRI,UAAWA,EACXpL,KAAMA,EACN8G,KAAMA,KAsBRrf,EAAO,sBACN,cACA,oBACE,SAASmK,EAAK0Z,GAUhB,QAASC,GAAKC,GACb,MAAgB,QAARA,GAAgBA,IAAQ3kB,EAAa,IAAM,GAAK2kB,GAAK5R,QAAQ6R,EAAkB,IAWxF,QAASC,GAAGrB,EAAKjX,GAChB,MAAKA,KAIO,SAARA,IAAmBkY,EAAIte,QAAQqd,WAIrBA,IAAOjX,EAPbiX,IAAQxjB,EAmBjB,QAAS8kB,GAAQC,EAAOC,EAAOhO,GAC9B,GAAI1W,EAYJ,KAVAykB,EAAQA,MACRC,EAAQA,GAAS,IAEG,gBAATD,KACVA,EAAQA,EAAM5jB,MAAM6jB,IAGrBhO,EAAMA,MAEN1W,EAAIykB,EAAMxkB,OACHD,KACN0W,EAAI+N,EAAMzkB,MAGX,OAAO0W,GAiDR,QAAS7U,GAAOyhB,EAAGqB,EAAG7D,GACrB,GAAiB8D,GAAIC,EAAIC,EAAIC,EAAKC,EAA9BhX,EAAOjK,KAA0BkhB,EAAK,CAU1C,IAPA3B,EAAI,oCAAoC5Z,KAAK4Z,GAC7CwB,EAAKxB,EAAE,GAAGvZ,MAAM,iBAAiB,GAGjC8a,EAAK7W,EAAKkX,SAAS5B,EAAE,GAAG7Q,QAAQ,SAAU,IAAKqO,IAG3C+D,EAAGC,GAAP,CAKA,GAAY,UAARxB,EAAE,GAOL,MANAuB,GAAGC,GAAMH,OAEL5gB,KAAKohB,UACRphB,KAAKohB,SAAS7B,EAAE,GAAIA,EAAE,GAAIuB,EAAGC,IAO1BH,GAAEG,KACNH,EAAEG,GAAM,aACRG,EAAK,GAINJ,EAAGC,GAAMH,EAAEG,GACX9W,EAAKoX,OAAOP,EAAGC,GAAI9e,UAAW2e,GAG1BrB,EAAE,KACLsB,EAAK5W,EAAK7N,QAAQmjB,EAAE,IAAItd,UACxB+e,EAAMzB,EAAE,GAAGvZ,MAAM,aAAa,GAG9Bib,EAAIH,EAAGC,GACHG,EAEHJ,EAAGC,GAAM,WACR,MAAOF,GAAGG,GAAK1kB,MAAM0D,KAAMrD,YAI5BmkB,EAAGC,GAAM,WAER,MADA/gB,MAAKqY,OAASwI,EAAGG,GACVC,EAAE3kB,MAAM0D,KAAMrD,YAGvBmkB,EAAGC,GAAI9e,UAAU8e,GAAMD,EAAGC,GAG1B9W,EAAKoV,KAAKwB,EAAI,SAASjB,EAAGJ,GACzBsB,EAAGC,GAAI9e,UAAUud,GAAKqB,EAAGrB,KAI1BvV,EAAKoV,KAAKuB,EAAG,SAAShB,EAAGJ,GAEpBqB,EAAGrB,GACNsB,EAAGC,GAAI9e,UAAUud,GAAK,WAErB,MADAxf,MAAKqY,OAASwI,EAAGrB,GACVI,EAAEtjB,MAAM0D,KAAMrD,YAGlB6iB,GAAKuB,IACRD,EAAGC,GAAI9e,UAAUud,GAAKI,MAS1B3V,EAAKoV,KAAKuB,EAAE,UAAW,SAAShB,EAAGJ,GAClCsB,EAAGC,GAAIvB,GAAKI,KAId,QAASyB,GAAOlC,EAAKmC,GACpB,GAAIrlB,GAAGqO,EAAG1D,EAAwBrF,EAAlBa,EAAOzF,SAEvB,KAAKV,EAAI,EAAGqO,EAAIlI,EAAKlG,OAAQD,EAAIqO,EAAGrO,IAAK,CACxCqlB,EAAMlf,EAAKnG,EACX,KAAK2K,IAAQ0a,GACRA,EAAIvL,eAAenP,KACtBrF,EAAQ+f,EAAI1a,GAERrF,IAAU5F,IACbwjB,EAAIvY,GAAQrF,IAMhB,MAAO4d,GAYR,QAASoC,GAAKjC,EAAGM,EAAGJ,EAAGD,GACtBA,EAAIA,GAAKvf,KAELsf,IACCE,IACHF,EAAIA,EAAEE,IAGPY,EAAIf,KAAKC,EAAG,SAASA,EAAGrjB,GACvB,MAAI2jB,GAAEze,KAAKoe,EAAGD,EAAGrjB,EAAGujB,MAAO,OAI3B+B,GAAKjC,EAAGM,EAAGJ,EAAGD,MAuBjB,QAAS4B,GAAS3B,EAAGF,GACpB,GAAIrjB,GAAG4jB,CAKP,KAHAP,EAAIA,GAAK5d,OAET8d,EAAIA,EAAE1iB,MAAM,KACPb,EAAI,EAAGA,EAAIujB,EAAEtjB,OAAQD,IACzB4jB,EAAIL,EAAEvjB,GAEDqjB,EAAEO,KACNP,EAAEO,OAGHP,EAAIA,EAAEO,EAGP,OAAOP,GAcR,QAASljB,GAAQojB,EAAGF,GACnB,GAAIrjB,GAAGqO,CAKP,KAHAgV,EAAIA,GAAK5d,OAET8d,EAAIA,EAAE1iB,MAAM,KACPb,EAAI,EAAGqO,EAAIkV,EAAEtjB,OAAQD,EAAIqO,IAC7BgV,EAAIA,EAAEE,EAAEvjB,IAEHqjB,GAH2BrjB,KAQjC,MAAOqjB,GAaR,QAASkC,GAAQjC,EAAGkC,GACnB,OAAKlC,GAAKiB,EAAGjB,EAAG,SACRA,EAGDa,EAAIzN,IAAI4M,EAAEziB,MAAM2kB,GAAK,KAAMpB,GAGnC,QAASqB,GAAgBC,GACxB,GAAIC,GAAclb,EAAIkb,WAMtB,OAJIA,KACHD,IAAQA,EAAI/b,QAAQ,UAAc,IAAM,KAAOgc;AAGzCD,EAnUR,GAAIpB,GAAmB,YAsUvB,QACCF,KAAMA,EASNve,QAASse,EAAIte,QAEb0e,GAAIA,EASJtB,QAASkB,EAAIlB,QACbuB,QAASA,EAsBTpB,KAAMe,EAAIf,KAWV1M,IAAKyN,EAAIzN,IAcTkP,KAAMzB,EAAIxN,OASVkP,QAAS1B,EAAIxa,QAEbyb,OAAQA,EACRvjB,OAAQA,EACRyjB,KAAMA,EACNJ,SAAUA,EACV/kB,QAASA,EACTolB,QAASA,EACTE,gBAAiBA,KAqCnBnlB,EAAO,wBACN,yBACA,qBACA,qBACA,eACE,SAAS2N,EAAY+C,EAAQ8U,EAAOrb,GAMtC,QAASsb,GAAU7C,GAClB,MAAsB,mBAARA,GAGf,QAAS8C,GAAS9C,GACjB,MAAsB,gBAARA,GAGf,QAAS+C,GAAS/C,GACjB,MAAOA,IAAOA,GAAOA,EAAIzd,OAG1B,QAASygB,GAAeC,EAAMC,GAC7B,GAAIC,GAAMpK,EAAM3N,CAOhB,KALA8X,EAAUA,GAAW9Z,EACrBgC,EAAY8X,EAAQrS,cAAc,OAClCsS,EAAOD,EAAQE,yBACfhY,EAAUwO,UAAYqJ,EAEdlK,EAAO3N,EAAUqQ,YACxB0H,EAAK/J,YAAYL,EAGlB,OAAOoK,GAGR,QAASE,GAAcC,EAAaC,EAAY5mB,EAAU6mB,GACzD,GAAI1mB,EAEJ,IAAIgmB,EAASS,GACZA,EAAaP,EAAeO,EAAYE,EAAmBH,EAAY,SACjE,IAAIC,EAAWxmB,SAAWwmB,EAAWnX,SAAU,CAGrD,GAFAmX,EAAaG,EAASC,UAAUJ,GAE5BC,EACH,IAAK1mB,EAAIymB,EAAWxmB,OAAS,EAAGD,GAAK,EAAGA,IACvCumB,EAAcC,EAAaC,EAAWzmB,GAAIH,EAAU6mB,OAGrD,KAAK1mB,EAAI,EAAGA,EAAIymB,EAAWxmB,OAAQD,IAClCumB,EAAcC,EAAaC,EAAWzmB,GAAIH,EAAU6mB,EAItD,OAAOF,GAGR,GAAIC,EAAWnX,SAEd,IADAtP,EAAIwmB,EAAYvmB,OACTD,KACNH,EAASqF,KAAKshB,EAAYxmB,GAAIymB,EAIhC,OAAOD,GAGR,QAASM,GAAS7K,EAAMI,GACvB,MAAOJ,IAAQI,IAAc,IAAMJ,EAAKI,UAAY,KAAK1S,QAAQ,IAAM0S,EAAY,UAGpF,QAAS0K,GAAK/I,EAAUgJ,EAAS9gB,GAChC,GAAI+gB,GAAYC,CAiBhB,OAfAF,GAAUJ,EAASI,GAAS,GAE5BhJ,EAASoF,KAAK,WACb,GAAIpV,GAAOjK,IAENmC,IAAO+gB,GAAcjZ,EAAK4B,WAM9BsX,EAAW5K,YAAYtO,IALvBiZ,EAAajZ,EAAK4B,WAClBsX,EAAaF,EAAQG,WAAU,GAC/BnZ,EAAK4B,WAAWwX,aAAaF,EAAYlZ,GACzCkZ,EAAW5K,YAAYtO,MAMlBgQ,EAgBR,QAAS4I,GAAS3V,EAAUC,GAE3B,MAAO,IAAI0V,GAAShjB,GAAGyjB,KAAKpW,EAAUC,GAGvC,QAAS2U,GAAQpC,EAAMN,GACtB,GAAInjB,EAEJ,IAAImjB,EAAMxZ,QACT,MAAOwZ,GAAMxZ,QAAQ8Z,EAItB,KADAzjB,EAAImjB,EAAMljB,OACHD,KACN,GAAImjB,EAAMnjB,KAAOyjB,EAChB,MAAOzjB,EAIT,UAKD,QAASokB,GAAKC,GACb,MAAgB,QAARA,GAAgBA,IAAQzY,EAAS,IAAM,GAAKyY,GAAK5R,QAAQ6R,EAAkB,IAGpF,QAASlB,GAAKF,EAAKrjB,GAClB,GAAII,GAAQsT,EAAKvT,EAAG4L,EAAOtG,CAE3B,IAAI4d,EAGH,GAFAjjB,EAASijB,EAAIjjB,OAETA,IAAW2L,GAEd,IAAK2H,IAAO2P,GACX,GAAIA,EAAIpJ,eAAevG,KACtBjO,EAAQ4d,EAAI3P,GACR1T,EAASqF,KAAKI,EAAOiO,EAAKjO,MAAW,GACxC,UAMH,KAAKtF,EAAI,EAAGA,EAAIC,IACfqF,EAAQ4d,EAAIljB,GACRH,EAASqF,KAAKI,EAAOtF,EAAGsF,MAAW,GAFhBtF,KAS1B,MAAOkjB,GAGR,QAAS0C,GAAKzC,EAAOtjB,GACpB,GAAI2jB,KAQJ,OANAJ,GAAKD,EAAO,SAASnjB,EAAGyjB,GACnB5jB,EAAS4jB,EAAMzjB,IAClBwjB,EAAIpjB,KAAKqjB,KAIJD,EAGR,QAASmD,GAAmB/f,GAC3B,MAAKA,GAImB,GAApBA,EAAQ0I,SACJ1I,EAGDA,EAAQyF,cAPPC,EAm/BT,QAASqJ,GAAI2R,EAAIC,EAAMC,GACtB,GAAInH,MAAc5L,EAAM6S,EAAGC,EAM3B,KAJoB,gBAATC,IAAqBA,YAAiBZ,KAChDY,EAAQA,EAAM,IAGR/S,GAAwB,IAAjBA,EAAInF,UAAgB,CACjC,GAAIkY,IAAU9nB,EAAW,CACxB,GAAI+U,IAAQ+S,EACX,KAGD,IAAoB,gBAATA,IAAqBZ,EAASnS,GAAK8P,GAAGiD,GAChD,MAImB,IAAjB/S,EAAInF,UACP+Q,EAAQjgB,KAAKqU,GAGdA,EAAMA,EAAI8S,GAGX,MAAOlH,GAGR,QAASoH,GAAQxL,EAAMyL,EAAapY,EAAUkY,GAC7C,GAAI/H,KAMJ,KAJI+H,YAAiBZ,KACpBY,EAAQA,EAAM,IAGRvL,EAAMA,EAAOA,EAAKyL,GACxB,IAAIpY,GAAY2M,EAAK3M,WAAaA,EAAlC,CAIA,GAAIkY,IAAU9nB,EAAW,CACxB,GAAIuc,IAASuL,EACZ,KAGD,IAAoB,gBAATA,IAAqBZ,EAAS3K,GAAMsI,GAAGiD,GACjD,MAIF/H,EAAOrf,KAAK6b,GAGb,MAAOwD,GAGR,QAASkI,GAAa1L,EAAMyL,EAAapY,GACxC,IAAK2M,EAAOA,EAAKyL,GAAczL,EAAMA,EAAOA,EAAKyL,GAChD,GAAIzL,EAAK3M,UAAYA,EACpB,MAAO2M,EAIT,OAAO,MAuNR,QAAS2L,GAAYC,EAAaN,EAAMO,GACvC1E,EAAK0E,EAAO,SAASnd,EAAM1C,GAC1B4f,EAAYld,GAAQkd,EAAYld,OAChCkd,EAAYld,GAAM4c,GAAQtf,IAz7C5B,GAE8B2D,GAF1BU,EAAM7E,SAAUrH,EAAO0F,MAAME,UAAU5F,KAAMgG,EAAQN,MAAME,UAAUI,MACrE2L,EAAa,2CACbhB,EAAQ9C,EAAW8C,MACnBgX,EAAcjC,EAAMtB,QAAQ,+BAqF5BwD,EAAgBlC,EAAMtB,QAAQ,uEAAwE,KACtGyD,EAAanC,EAAMtB,QAAQ,gGAAiG,KAC5H0D,GACHC,MAAO,UACPC,QAAS,YACTC,SAAY,YAETC,GACHC,QAAS,YAGNC,KAAgBC,KAwBhBnE,EAAmB,YAw4CvB,OA50CAsC,GAAShjB,GAAKgjB,EAAS5gB,WACtBQ,YAAaogB,EAQb3V,SAAU,GAQVC,QAAS,KAQTjR,OAAQ,EAURonB,KAAM,SAASpW,EAAUC,GACxB,GAAiBnH,GAAOkS,EAApBjO,EAAOjK,IAEX,KAAKkN,EACJ,MAAOjD,EAGR,IAAIiD,EAAS3B,SAIZ,MAHAtB,GAAKkD,QAAUlD,EAAK,GAAKiD,EACzBjD,EAAK/N,OAAS,EAEP+N,CAGR,IAAIkD,GAAWA,EAAQ5B,SACtBtB,EAAKkD,QAAUA,MACT,CACN,GAAIA,EACH,MAAO0V,GAAS3V,GAAUgN,KAAK/M,EAGhClD,GAAKkD,QAAUA,EAAUzJ,SAG1B,GAAIue,EAAS/U,GAAW,CASvB,GARAjD,EAAKiD,SAAWA,EAGflH,EAD0B,MAAvBkH,EAASyX,OAAO,IAAuD,MAAzCzX,EAASyX,OAAOzX,EAAShR,OAAS,IAAcgR,EAAShR,QAAU,GAC3F,KAAMgR,EAAU,MAEjBc,EAAWrI,KAAKuH,IAGrBlH,EAuBH,MAAO6c,GAAS1V,GAAS2H,KAAK5H,EAtB9B,IAAIlH,EAAM,GAGT,IAFAkS,EAAOiK,EAAejV,EAAU0V,EAAmBzV,IAAUyN,WAEtD1C,GACN7b,EAAK8E,KAAK8I,EAAMiO,GAChBA,EAAOA,EAAKpH,gBAEP,CAGN,GAFAoH,EAAO0K,EAAmBzV,GAASc,eAAejI,EAAM,KAEnDkS,EACJ,MAAOjO,EAGR,IAAIiO,EAAK1b,KAAOwJ,EAAM,GACrB,MAAOiE,GAAK6K,KAAK5H,EAGlBjD,GAAK/N,OAAS,EACd+N,EAAK,GAAKiO,OAMZlY,MAAK4kB,IAAI1X,GAAU,EAGpB,OAAOjD,IASRiV,QAAS,WACR,MAAO6C,GAAM7C,QAAQlf,OAWtB4kB,IAAK,SAASlE,EAAOhG,GACpB,GAAiBmK,GAAO5oB,EAApBgO,EAAOjK,IAEX,IAAIiiB,EAASvB,GACZ,MAAOzW,GAAK2a,IAAI/B,EAASnC,GAG1B,IAAIhG,KAAS,EAGZ,IAFAmK,EAAQhC,EAASiC,OAAO7a,EAAKiV,UAAUjT,OAAO4W,EAASC,UAAUpC,KACjEzW,EAAK/N,OAAS2oB,EAAM3oB,OACfD,EAAI,EAAGA,EAAI4oB,EAAM3oB,OAAQD,IAC7BgO,EAAKhO,GAAK4oB,EAAM5oB,OAGjBI,GAAKC,MAAM2N,EAAM4Y,EAASC,UAAUpC,GAGrC,OAAOzW,IAWRiQ,KAAM,SAAStT,EAAMrF,GACpB,GAAiBwjB,GAAb9a,EAAOjK,IAEX,IAAoB,gBAAT4G,GACVyY,EAAKzY,EAAM,SAASA,EAAMrF,GACzB0I,EAAKiQ,KAAKtT,EAAMrF,SAEX,CAAA,IAAIygB,EAAUzgB,GAkBd,CACN,GAAI0I,EAAK,IAA2B,IAArBA,EAAK,GAAGsB,SAAgB,CAEtC,GADAwZ,EAAON,EAAU7d,GACbme,GAAQA,EAAKC,IAChB,MAAOD,GAAKC,IAAI/a,EAAK,GAAIrD,EAG1B,IAAIsd,EAAWtd,GACd,MAAOqD,GAAKuZ,KAAK5c,GAAQA,EAAOiB,CAGjCtG,GAAQ0I,EAAK,GAAGwE,aAAa7H,EAAM,GAErB,OAAVrF,IACHA,EAAQsG,GAIV,MAAOtG,GAnCPvB,KAAKqf,KAAK,WACT,GAAI0F,EAEJ,IAAsB,IAAlB/kB,KAAKuL,SAAgB,CAExB,GADAwZ,EAAON,EAAU7d,GACbme,GAAQA,EAAKE,IAEhB,WADAF,GAAKE,IAAIjlB,KAAMuB,EAIF,QAAVA,EACHvB,KAAKmP,gBAAgBvI,EAAM,GAE3B5G,KAAK4O,aAAahI,EAAMrF,EAAO,MAyBnC,MAAO0I,IAURib,WAAY,SAASte,GACpB,MAAO5G,MAAKka,KAAKtT,EAAM,OAWxB4c,KAAM,SAAS5c,EAAMrF,GACpB,GAAI0I,GAAOjK,IAIX,IAFA4G,EAAOud,EAAQvd,IAASA,EAEJ,gBAATA,GACVyY,EAAKzY,EAAM,SAASA,EAAMrF,GACzB0I,EAAKuZ,KAAK5c,EAAMrF,SAEX,CAAA,IAAIygB,EAAUzgB,GAOpB,MAAI0I,GAAK,IAAMA,EAAK,GAAGsB,UAAY3E,IAAQqD,GAAK,GACxCA,EAAK,GAAGrD,GAGTrF,CAVPvB,MAAKqf,KAAK,WACY,GAAjBrf,KAAKuL,WACRvL,KAAK4G,GAAQrF,KAWhB,MAAO0I,IAWRkb,IAAK,SAASve,EAAMrF,GAGnB,QAAS6jB,GAAMxe,GACd,MAAOA,GAAK8H,QAAQ,SAAU,SAAS8B,EAAGC,GACzC,MAAOA,GAAE4U,gBAIX,QAASC,GAAO1e,GACf,MAAOA,GAAK8H,QAAQ,SAAU,SAAS8B,GACtC,MAAO,IAAMA,IAVf,GAAiB+U,GAAKR,EAAlB9a,EAAOjK,IAcX,IAAoB,gBAAT4G,GACVyY,EAAKzY,EAAM,SAASA,EAAMrF,GACzB0I,EAAKkb,IAAIve,EAAMrF,SAGhB,IAAIygB,EAAUzgB,GACbqF,EAAOwe,EAAMxe,GAGQ,gBAAVrF,IAAuB0iB,EAAcrd,KAC/CrF,GAAS,MAGV0I,EAAKoV,KAAK,WACT,GAAImG,GAAQxlB,KAAKwlB,KAGjB,IADAT,EAAOL,EAAS9d,GACZme,GAAQA,EAAKE,IAEhB,WADAF,GAAKE,IAAIjlB,KAAMuB,EAIhB,KACCvB,KAAKwlB,MAAMjB,EAAO3d,IAASA,GAAQrF,EAClC,MAAOE,IAIK,OAAVF,GAA4B,KAAVA,IACjBikB,EAAMC,eACTD,EAAMC,eAAeH,EAAO1e,IAE5B4e,EAAMrW,gBAAgBvI,UAInB,CAIN,GAHA2e,EAAMtb,EAAK,GAEX8a,EAAOL,EAAS9d,GACZme,GAAQA,EAAKC,IAChB,MAAOD,GAAKC,IAAIO,EAGjB,IAAIA,EAAIjd,cAAc6D,YACrB,IACC,MAAOoZ,GAAIjd,cAAc6D,YAAYuZ,iBAAiBH,EAAK,MAAMI,iBAAiBL,EAAO1e,IACxF,MAAOnF,GACR,MAAOoG,OAEF,IAAI0d,EAAIK,aACd,MAAOL,GAAIK,aAAaR,EAAMxe,IAKjC,MAAOqD,IASR4b,OAAQ,WAGP,IAFA,GAAiB3N,GAAbjO,EAAOjK,KAAY/D,EAAI+D,KAAK9D,OAEzBD,KACNic,EAAOjO,EAAKhO,GACZ+Q,EAAMX,MAAM6L,GAERA,EAAKrM,YACRqM,EAAKrM,WAAWoE,YAAYiI,EAI9B,OAAOlY,OASR0d,MAAO,WAGN,IAFA,GAAiBxF,GAAbjO,EAAOjK,KAAY/D,EAAI+D,KAAK9D,OAEzBD,KAEN,IADAic,EAAOjO,EAAKhO,GACLic,EAAK0C,YACX1C,EAAKjI,YAAYiI,EAAK0C,WAIxB,OAAO5a,OAURoiB,KAAM,SAAS7gB,GACd,GAAiBtF,GAAbgO,EAAOjK,IAEX,IAAIgiB,EAAUzgB,GAAQ,CACrBtF,EAAIgO,EAAK/N,MAET,KACC,KAAOD,KACNgO,EAAKhO,GAAG8c,UAAYxX,EAEpB,MAAOE,GAERohB,EAAS5Y,EAAKhO,IAAIyhB,QAAQoI,OAAOvkB,GAGlC,MAAO0I,GAGR,MAAOA,GAAK,GAAKA,EAAK,GAAG8O,UAAY,IAUtC0D,KAAM,SAASlb,GACd,GAAiBtF,GAAbgO,EAAOjK,IAEX,IAAIgiB,EAAUzgB,GAAQ,CAErB,IADAtF,EAAIgO,EAAK/N,OACFD,KACF,aAAegO,GAAKhO,GACvBgO,EAAKhO,GAAGygB,UAAYnb,EAEpB0I,EAAK,GAAG0Q,YAAcpZ,CAIxB,OAAO0I,GAGR,MAAOA,GAAK,GAAMA,EAAK,GAAGyS,WAAazS,EAAK,GAAG0Q,YAAe,IAU/DmL,OAAQ,WACP,MAAOtD,GAAcxiB,KAAMrD,UAAW,SAASub,IAExB,IAAlBlY,KAAKuL,UAAmBvL,KAAK+lB,MAA+B,IAAvB/lB,KAAK+lB,KAAKxa,WAClDvL,KAAKuY,YAAYL,MAYpB8N,QAAS,WACR,MAAOxD,GAAcxiB,KAAMrD,UAAW,SAASub,IAExB,IAAlBlY,KAAKuL,UAAmBvL,KAAK+lB,MAA+B,IAAvB/lB,KAAK+lB,KAAKxa,WAClDvL,KAAKqjB,aAAanL,EAAMlY,KAAK4a,cAE5B,IAUJqL,OAAQ,WACP,GAAIhc,GAAOjK,IAEX,OAAIiK,GAAK,IAAMA,EAAK,GAAG4B,WACf2W,EAAcvY,EAAMtN,UAAW,SAASub,GAC9ClY,KAAK6L,WAAWwX,aAAanL,EAAMlY,QAI9BiK,GAURic,MAAO,WACN,GAAIjc,GAAOjK,IAEX,OAAIiK,GAAK,IAAMA,EAAK,GAAG4B,WACf2W,EAAcvY,EAAMtN,UAAW,SAASub,GAC9ClY,KAAK6L,WAAWwX,aAAanL,EAAMlY,KAAK8Q,eACtC,GAGG7G,GAURkc,SAAU,SAAS5jB,GAGlB,MAFAsgB,GAAStgB,GAAKujB,OAAO9lB,MAEdA,MAURomB,UAAW,SAAS7jB,GAGnB,MAFAsgB,GAAStgB,GAAKyjB,QAAQhmB,MAEfA,MAURqmB,YAAa,SAASC,GACrB,MAAOtmB,MAAKimB,OAAOK,GAAST,UAU7B7C,KAAM,SAASsD,GACd,MAAOtD,GAAKhjB,KAAMsmB,IAWnBC,QAAS,SAASD,GACjB,MAAOtD,GAAKhjB,KAAMsmB,GAAS,IAU5BE,UAAW,SAASF,GAKnB,MAJAtmB,MAAKqf,KAAK,WACTwD,EAAS7iB,MAAMymB,WAAWF,QAAQD,KAG5BtmB,MASR0mB,OAAQ,WACP,MAAO1mB,MAAKqY,SAASgH,KAAK,WACzBwD,EAAS7iB,MAAMqmB,YAAYrmB,KAAKgY,eAUlC2O,MAAO,WACN,GAAIjL,KAMJ,OAJA1b,MAAKqf,KAAK,WACT3D,EAAOrf,KAAK2D,KAAKojB,WAAU,MAGrBP,EAASnH,IAUjBkL,SAAU,SAAStO,GAClB,MAAOtY,MAAK6mB,YAAYvO,GAAW,IAUpCwO,YAAa,SAASxO,GACrB,MAAOtY,MAAK6mB,YAAYvO,GAAW,IAWpCuO,YAAa,SAASvO,EAAWyO,GAChC,GAAI9c,GAAOjK,IAGX,OAAwB,gBAAbsY,GACHrO,GAGJqO,EAAU1S,QAAQ,UACrByZ,EAAK/G,EAAUxb,MAAM,KAAM,WAC1BmN,EAAK4c,YAAY7mB,KAAM+mB,KAGxB9c,EAAKoV,KAAK,SAASM,EAAOzH,GACzB,GAAI8O,GAAmBC,CAEvBA,GAAalE,EAAS7K,EAAMI,GACxB2O,IAAeF,IAClBC,EAAoB9O,EAAKI,UAErB2O,EACH/O,EAAKI,UAAY+H,GAAM,IAAM2G,EAAoB,KAAKtY,QAAQ,IAAM4J,EAAY,IAAK,MAErFJ,EAAKI,WAAa0O,EAAoB,IAAM1O,EAAYA,KAMrDrO,IAUR8Y,SAAU,SAASzK,GAClB,MAAOyK,GAAS/iB,KAAK,GAAIsY,IAW1B+G,KAAM,SAASvjB,GACd,MAAOujB,GAAKrf,KAAMlE,IAWnBorB,GAAI,SAAStgB,EAAM9K,GAClB,MAAOkE,MAAKqf,KAAK,WAChBrS,EAAMpN,KAAKI,KAAM4G,EAAM9K,MAYzBqrB,IAAK,SAASvgB,EAAM9K,GACnB,MAAOkE,MAAKqf,KAAK,WAChBrS,EAAMlB,OAAO9L,KAAM4G,EAAM9K,MAW3BsrB,QAAS,SAASxgB,GACjB,MAAO5G,MAAKqf,KAAK,WACG,gBAARzY,GACVoG,EAAMd,KAAKlM,KAAM4G,EAAKsB,KAAMtB,GAE5BoG,EAAMd,KAAKlM,KAAM4G,MAWpBygB,KAAM,WACL,MAAOrnB,MAAKmlB,IAAI,UAAW,KAS5BmC,KAAM,WACL,MAAOtnB,MAAKmlB,IAAI,UAAW,SAW5B9iB,MAAO,WACN,MAAO,IAAIwgB,GAASxgB,EAAM/F,MAAM0D,KAAMrD,aAUvCkhB,GAAI,SAAS8B,GACZ,MAAOA,QAAe3f,KAAKqC,MAAMsd,GAAS3f,KAAKqC,MAAMsd,GAAQA,EAAQ,IAStE5N,MAAO,WACN,MAAO/R,MAAK6d,GAAG,IAShBjC,KAAM,WACL,MAAO5b,MAAK6d,QAUb/I,KAAM,SAAS5H,GACd,GAAIjR,GAAGqO,EAAGxJ,IAEV,KAAK7E,EAAI,EAAGqO,EAAItK,KAAK9D,OAAQD,EAAIqO,EAAGrO,IACnC4mB,EAAS/N,KAAK5H,EAAUlN,KAAK/D,GAAI6E,EAGlC,OAAO+hB,GAAS/hB,IAUjB8R,OAAQ,SAAS1F,GAChB,MACQ2V,GADe,kBAAZ3V,GACM2U,EAAK7hB,KAAKkf,UAAW,SAASQ,EAAMzjB,GACnD,MAAOiR,GAASjR,EAAGyjB,KAILmD,EAASjQ,OAAO1F,EAAUlN,KAAKkf,aAUhDqI,QAAS,SAASra,GACjB,GAAIwO,KAoBJ,OAlBIxO,aAAoB2V,KACvB3V,EAAWA,EAAS,IAGrBlN,KAAKqf,KAAK,SAASpjB,EAAGic,GACrB,KAAOA,GAAM,CACZ,GAAuB,gBAAZhL,IAAwB2V,EAAS3K,GAAMsI,GAAGtT,GAAW,CAC/DwO,EAAOrf,KAAK6b,EACZ,OACM,GAAIA,GAAQhL,EAAU,CAC5BwO,EAAOrf,KAAK6b,EACZ,OAGDA,EAAOA,EAAKrM,cAIPgX,EAASnH,IAUjB8L,OAAQ,SAASA,GAChB,GAAIjC,GAAKhd,EAAKkf,EACIvpB,EAAdX,EAAI,EAAGC,EAAI,CAEf,OAAKgqB,GAoBExnB,KAAKmlB,IAAIqC,IAnBfjC,EAAMvlB,KAAK,GAEPulB,IACHhd,EAAMgd,EAAIjd,cACVmf,EAASlf,EAAIC,gBAET+c,EAAImC,wBACPxpB,EAAMqnB,EAAImC,wBACVnqB,EAAIW,EAAIqB,MAAQkoB,EAAOhf,YAAcF,EAAI5E,KAAK8E,YAAcgf,EAAO/e,WACnElL,EAAIU,EAAIsB,KAAOioB,EAAO5e,WAAaN,EAAI5E,KAAKkF,WAAa4e,EAAO3e,aAKjEvJ,KAAMhC,EACNiC,IAAKhC,KAORnB,KAAMA,EACNqe,QAASA,KACT/G,UAAWA,QAIZoO,EAAMV,OAAOwB,GAUZxB,OAAQU,EAAMV,OAUdyB,UAAW,SAAS6E,GACnB,MAAIzF,GAASyF,IAAWA,EAAOpc,UACtBoc,GAGF5F,EAAM7C,QAAQyI,IAYtB7F,QAASA,EAUThgB,QAASigB,EAAMjgB,QAWfud,KAAMA,EAUNgB,KAAMA,EAeNwB,KAAMA,EAGN/M,KAAM7H,EACN+M,KAAM/M,EAAO6N,UACbgK,OAAQ7X,EAAOiI,WACfuH,KAAMxP,EAAOkI,QACbvJ,SAAUqB,EAAOrB,SACjBgH,OAAQ,SAASoH,EAAMxG,EAAO+I,GAC7B,GAAItgB,GAAIuX,EAAMtX,MAMd,KAJIqgB,IACHvC,EAAO,QAAUA,EAAO,KAGlB/d,KACmB,GAArBuX,EAAMvX,GAAGsP,UACZiI,EAAMG,OAAO1X,EAAG,EAUlB,OALCuX,GADoB,IAAjBA,EAAMtX,OACD2mB,EAAS/N,KAAKmE,gBAAgBzF,EAAM,GAAIwG,IAASxG,EAAM,OAEvDqP,EAAS/N,KAAKvQ,QAAQyV,EAAMxG,MAyEvC6L,GAQChH,OAAQ,SAASH,GAChB,GAAIG,GAASH,EAAKrM,UAElB,OAAOwM,IAA8B,KAApBA,EAAO9M,SAAkB8M,EAAS,MAUpDuP,QAAS,SAAS1P,GACjB,MAAOtG,GAAIsG,EAAM,eAUlB2P,KAAM,SAAS3P,GACd,MAAO0L,GAAa1L,EAAM,cAAe,IAU1C4P,KAAM,SAAS5P,GACd,MAAO0L,GAAa1L,EAAM,kBAAmB,IAU9C5L,SAAU,SAAS4L,GAClB,MAAOwL,GAAQxL,EAAK0C,WAAY,cAAe,IAUhD6L,SAAU,SAASvO,GAClB,MAAO6J,GAAM7C,SAA2B,WAAlBhH,EAAK5J,SAAwB4J,EAAK6P,iBAAmB7P,EAAK8P,cAActkB,SAAWwU,GAAMF,cAE9G,SAASpR,EAAM/G,GACjBgjB,EAAShjB,GAAG+G,GAAQ,SAASsG,GAC5B,GAAIjD,GAAOjK,KAAM0b,IA2BjB,OAzBAzR,GAAKoV,KAAK,WACT,GAAIwF,GAAQhlB,EAAGsB,KAAKua,EAAQ1b,KAAMkN,EAAUwO,EAExCmJ,KACChC,EAAS/gB,QAAQ+iB,GACpBnJ,EAAOrf,KAAKC,MAAMof,EAAQmJ,GAE1BnJ,EAAOrf,KAAKwoB,MAMX7kB,KAAK9D,OAAS,IACZ8nB,EAAYpd,KAChB8U,EAASmH,EAASiC,OAAOpJ,IAGM,IAA5B9U,EAAKhB,QAAQ,aAChB8V,EAASA,EAAOiH,YAIlBjH,EAASmH,EAASnH,GAEdxO,EACIwO,EAAO9I,OAAO1F,GAGfwO,KAIT2D,GAUC4I,aAAc,SAAS/P,EAAMuL,GAC5B,MAAO7R,GAAIsG,EAAM,aAAcuL,IAWhCyE,UAAW,SAAShQ,EAAMuL,GACzB,MAAOC,GAAQxL,EAAM,cAAe,EAAGuL,GAAOphB,MAAM,IAWrD8lB,UAAW,SAASjQ,EAAMuL,GACzB,MAAOC,GAAQxL,EAAM,kBAAmB,EAAGuL,GAAOphB,MAAM,KAEvD,SAASuE,EAAM/G,GACjBgjB,EAAShjB,GAAG+G,GAAQ,SAASsG,EAAU0F,GACtC,GAAI3I,GAAOjK,KAAM0b,IAyBjB,OAvBAzR,GAAKoV,KAAK,WACT,GAAIwF,GAAQhlB,EAAGsB,KAAKua,EAAQ1b,KAAMkN,EAAUwO,EAExCmJ,KACChC,EAAS/gB,QAAQ+iB,GACpBnJ,EAAOrf,KAAKC,MAAMof,EAAQmJ,GAE1BnJ,EAAOrf,KAAKwoB,MAMX7kB,KAAK9D,OAAS,IACjBwf,EAASmH,EAASiC,OAAOpJ,GAEO,IAA5B9U,EAAKhB,QAAQ,YAA6B,cAATgB,IACpC8U,EAASA,EAAOiH,YAIlBjH,EAASmH,EAASnH,GAEd9I,EACI8I,EAAO9I,OAAOA,GAGf8I,KAWTmH,EAAShjB,GAAG2gB,GAAK,SAAStT,GACzB,QAASA,GAAYlN,KAAK4S,OAAO1F,GAAUhR,OAAS,GAGrD2mB,EAAShjB,GAAGyjB,KAAKrhB,UAAY4gB,EAAShjB,GAEtCgjB,EAASuF,iBAAmB,SAAStsB,GAGpC,QAASusB,GAAInb,EAAUC,GAWtB,MAVAmb,GAAWA,GAAYxsB,IAEE,IAArBa,UAAUT,SACbgR,EAAWob,EAASzlB,SAGhBsK,IACJA,EAAUmb,EAASnb,SAGb,GAAIkb,GAAIxoB,GAAGyjB,KAAKpW,EAAUC,GAblC,GAAImb,EAkBJ,OAFAzF,GAASxB,OAAOgH,EAAKroB,MAEdqoB,GAUJ3hB,EAAIhC,IAAMgC,EAAIhC,GAAK,IACtBmf,EAAYY,EAAW,OACtB8D,UAAW,SAAShD,GACnB,GAAIhkB,GAAQgkB,EAAIiD,SAEhB,OAAc,cAAVjnB,EACIsG,EAGDtG,GAGRknB,KAAM,SAASlD,GACd,GAAIhkB,GAAQgkB,EAAIkD,IAEhB,OAAc,MAAVlnB,EACIsG,EAGDtG,GAGR8iB,QAAS,SAASkB,GACjB,MAAOA,GAAIjN,WAGZkN,MAAO,SAASD,GACf,GAAIhkB,GAAQgkB,EAAIC,MAAMkD,OAEtB,OAAqB,KAAjBnnB,EAAMrF,OACF2L,EAGDtG,KAITsiB,EAAYY,EAAW,OACtBJ,QAAS,SAASkB,EAAKhkB,GACtBgkB,EAAIjN,UAAY/W,GAGjBikB,MAAO,SAASD,EAAKhkB,GACpBgkB,EAAIC,MAAMkD,QAAUnnB,MAKnBmF,EAAIhC,IAAMgC,EAAIhC,GAAK,IAGtB6f,EAAO,SAAW,aAElBV,EAAYa,EAAU,OACrBiE,QAAS,SAASpD,EAAKhkB,GACtB,GAAIikB,GAAQD,EAAIC,KAEF,QAAVjkB,GAA4B,KAAVA,EACrBikB,EAAMrW,gBAAgB,WAEtBqW,EAAMoD,KAAO,EACbpD,EAAM5S,OAAS,iBAA4B,IAARrR,EAAe,SAMtDshB,EAAS4B,UAAYA,EACrB5B,EAAS6B,SAAWA,EAEb7B,IAiCRtmB,EAAO,yBAA2B,WACjC,MAAO,UAASssB,EAAUC,GAsBzB,QAASC,GAAM/iB,EAAOgjB,EAAGC,EAAGxY,GAC3B,QAASyY,GAAI3mB,GAGZ,MAFAA,GAAM4mB,SAAS5mB,EAAK,IAAIL,SAAS,IAE1BK,EAAIrG,OAAS,EAAIqG,EAAM,IAAMA,EAGrC,MAAO,IAAM2mB,EAAIF,GAAKE,EAAID,GAAKC,EAAIzY,GA1BpC,GAIC5I,GAAO5L,EAAwBmtB,EAAeC,EAAaC,EAJxDC,EAAY,2DACfC,EAAiB,+HACjBC,EAAc,2BACdC,EAAkB,OACRC,KAAgEC,EAAgB,QAU3F,KARAf,EAAWA,MAEPC,IACHO,EAAcP,EAAOe,iBACrBP,EAAgBR,EAAOgB,oBAGxBV,GAAiB,wBAA0BQ,GAAe9sB,MAAM,KAC3Db,EAAI,EAAGA,EAAImtB,EAAcltB,OAAQD,IACrC0tB,EAAeP,EAAcntB,IAAM2tB,EAAgB3tB,EACnD0tB,EAAeC,EAAgB3tB,GAAKmtB,EAAcntB,EAanD,QAQC8sB,MAAO,SAASgB,GACf,MAAOA,GAAMrb,QAAQ6a,EAAWR,IAYjCiB,MAAO,SAAS7E,GAIf,QAAS8E,GAASC,EAAQC,EAAQC,GACjC,GAAI5qB,GAAK6qB,EAAOC,EAAQ/qB,CAGxB,IADAC,EAAM+qB,EAAOL,EAAS,OAASC,GAC1B3qB,IAIL6qB,EAAQE,EAAOL,EAAS,SAAWC,GAC9BE,IAILC,EAASC,EAAOL,EAAS,UAAYC,GAChCG,IAIL/qB,EAAOgrB,EAAOL,EAAS,QAAUC,MACjC,CAIA,GAAIK,IAAOhrB,EAAK6qB,EAAOC,EAAQ/qB,EAE/B,KADAtD,EAAIuuB,EAAItuB,OAAS,EACVD,KACFuuB,EAAIvuB,KAAOuuB,EAAIvuB,EAAI,KAKpBA,MAAUmuB,IAIdG,EAAOL,EAASC,GAAUluB,MAAUuuB,EAAI,GAAKA,EAAIxb,KAAK,WAC/Cub,GAAOL,EAAS,OAASC,SACzBI,GAAOL,EAAS,SAAWC,SAC3BI,GAAOL,EAAS,UAAYC,SAC5BI,GAAOL,EAAS,QAAUC,KAMlC,QAASM,GAAYjb,GACpB,GAAyBvT,GAArBsF,EAAQgpB,EAAO/a,EAEnB,IAAKjO,EAAL,CAMA,IAFAA,EAAQA,EAAMzE,MAAM,KACpBb,EAAIsF,EAAMrF,OACHD,KACN,GAAIsF,EAAMtF,KAAOsF,EAAM,GACtB,OAAO,CAMT,OAFAgpB,GAAO/a,GAAOjO,EAAM,IAEb,GAMR,QAASmpB,GAAU9tB,EAAQ4T,EAAGC,EAAGwQ,GAC3BwJ,EAAYja,IAIZia,EAAYha,IAIZga,EAAYxJ,KAKjBsJ,EAAO3tB,GAAU2tB,EAAO/Z,GAAK,IAAM+Z,EAAO9Z,GAAK,IAAM8Z,EAAOtJ,SACrDsJ,GAAO/Z,SACP+Z,GAAO9Z,SACP8Z,GAAOtJ,IAIf,QAAS0J,GAAOrK,GAGf,MAFAsK,IAAY,EAELjB,EAAerJ,GAKvB,QAASuK,GAAOvK,EAAKwK,GAWpB,MAVIF,KACHtK,EAAMA,EAAI5R,QAAQ,eAAgB,SAAS4R,GAC1C,MAAOqJ,GAAerJ,MAInBwK,IACJxK,EAAMA,EAAI5R,QAAQ,gBAAiB,OAG7B4R,EAGR,QAASyK,GAAW/kB,EAAO2b,EAAKqJ,EAAMC,EAAM3K,EAAK4K,GAGhD,GAFA5K,EAAMA,GAAO4K,EAMZ,MAHA5K,GAAMuK,EAAOvK,GAGN,IAAMA,EAAI5R,QAAQ,MAAO,OAAS,GAK1C,IAFAiT,EAAMkJ,EAAOlJ,GAAOqJ,GAAQC,IAEvBpC,EAASsC,kBAAmB,CAChC,GAAIC,GAAYzJ,EAAIjT,QAAQ,YAAa,GAEzC,IAAI,oBAAoBjJ,KAAK2lB,GAC5B,MAAO,EAGR,KAAKvC,EAASwC,qBAAuB,oBAAoB5lB,KAAK2lB,GAC7D,MAAO,GAUT,MALIE,KACH3J,EAAM2J,EAAanqB,KAAKoqB,EAAmB5J,EAAK,UAI1C,QAAUA,EAAIjT,QAAQ,MAAO,OAAS,KAhJ9C,GAAiBnK,GAASqC,EAAMrF,EAAOqpB,EAAnCL,KAA8Ce,EAAezC,EAAS2C,cACtED,EAAoB1C,EAAS4C,qBAAuBzrB,IAkJxD,IAAImlB,EAAK,CASR,IARAA,EAAMA,EAAIzW,QAAQ,mBAAoB,IAGtCyW,EAAMA,EAAIzW,QAAQ,oBAAqBic,GAAQjc,QAAQ,yBAA0B,SAAS4R,GACzF,MAAOA,GAAI5R,QAAQ,QAASic,KAIrBpmB,EAAUklB,EAAY9jB,KAAKwf,IAAO,CAWzC,GAVAve,EAAOrC,EAAQ,GAAGmK,QAAQgb,EAAiB,IAAInb,cAC/ChN,EAAQgD,EAAQ,GAAGmK,QAAQgb,EAAiB,IAK5CnoB,EAAQA,EAAMmN,QAAQ,eAAgB,SAAS3N,GAC9C,MAAO+W,QAAOC,aAAaoR,SAASpoB,EAAE2qB,OAAO,GAAI,OAG9C9kB,GAAQrF,EAAMrF,OAAS,EAAG,CAE7B,IAAK2sB,EAASsC,oBAA8B,YAARvkB,GAAsB,4BAA4BnB,KAAKlE,IAC1F,QAIY,iBAATqF,GAAoC,QAAVrF,EAC7BA,EAAQ,OACW,UAATqF,GAA6B,qBAATA,IAC9BrF,EAAQA,EAAMgN,eAIfhN,EAAQA,EAAMmN,QAAQ6a,EAAWR,GAGjCxnB,EAAQA,EAAMmN,QAAQ8a,EAAgBuB,GACtCR,EAAO3jB,GAAQgkB,EAAYC,EAAOtpB,GAAO,GAAQA,EAGlDkoB,EAAYkC,UAAYpnB,EAAQob,MAAQpb,EAAQ,GAAGrI,OAGpD+tB,EAAS,SAAU,IAAI,GACvBA,EAAS,SAAU,UACnBA,EAAS,SAAU,UACnBA,EAAS,SAAU,UACnBA,EAAS,UAAW,IACpBA,EAAS,SAAU,IACnBS,EAAU,SAAU,eAAgB,eAAgB,gBAG9B,gBAAlBH,EAAOqB,cACHrB,GAAOqB,OAKgB,SAA3BrB,EAAO,uBACHA,GAAO,gBAIhB,MAAOA,IAWRsB,UAAW,SAAStB,EAAQuB,GAG3B,QAASC,GAAgBnlB,GACxB,GAAIolB,GAAW/vB,EAAGqO,EAAG/I,CAGrB,IADAyqB,EAAY3C,EAAYziB,GAEvB,IAAK3K,EAAI,EAAGqO,EAAI0hB,EAAU9vB,OAAQD,EAAIqO,EAAGrO,IACxC2K,EAAOolB,EAAU/vB,GACjBsF,EAAQgpB,EAAO3jB,GAEXrF,IAAUsG,GAAStG,EAAMrF,OAAS,IACrCipB,IAAQA,EAAIjpB,OAAS,EAAI,IAAM,IAAM0K,EAAO,KAAOrF,EAAQ,KAM/D,QAAS0qB,GAAQrlB,EAAMklB,GACtB,GAAII,EAGJ,OADAA,GAAW5C,EAAc,OACrB4C,IAAYA,EAAStlB,MAIzBslB,EAAW5C,EAAcwC,IACrBI,IAAYA,EAAStlB,IA3B1B,GAAcA,GAAMrF,EAAhB4jB,EAAM,EAmCV,IAAI2G,GAAezC,EAElB0C,EAAgB,KAChBA,EAAgBD,OAGhB,KAAKllB,IAAQ2jB,GACZhpB,EAAQgpB,EAAO3jB,GAEXrF,IAAUsG,GAAStG,EAAMrF,OAAS,IAChCotB,IAAiB2C,EAAQrlB,EAAMklB,KACnC3G,IAAQA,EAAIjpB,OAAS,EAAI,IAAM,IAAM0K,EAAO,KAAOrF,EAAQ,KAM/D,OAAO4jB,QA6BX5oB,EAAO,4BAA8B,WASpC,MAAO,UAAS4vB,EAAWC,GAG1B,QAASC,GAAYnU,EAAMoU,EAAW3I,EAAa4I,GAClD,GAAI7I,GAASrL,CAEb,IAAIH,EAAM,CAET,IAAKqU,GAAWrU,EAAKoU,GACpB,MAAOpU,GAAKoU,EAIb,IAAIpU,GAAQkU,EAAU,CAErB,GADA1I,EAAUxL,EAAKyL,GAEd,MAAOD,EAIR,KAAKrL,EAASH,EAAKrM,WAAYwM,GAAUA,GAAU+T,EAAU/T,EAASA,EAAOxM,WAE5E,GADA6X,EAAUrL,EAAOsL,GAEhB,MAAOD,KAOZ,QAAS8I,GAAiBtU,EAAMoU,EAAW3I,EAAa4I,GACvD,GAAI7I,GAASrL,EAAQoU,CAErB,IAAIvU,EAAM,CAET,GADAwL,EAAUxL,EAAKyL,GACXyI,GAAY1I,IAAY0I,EAC3B,MAGD,IAAI1I,EAAS,CACZ,IAAK6I,EAEJ,IAAKE,EAAQ/I,EAAQ4I,GAAYG,EAAOA,EAAQA,EAAMH,GACrD,IAAKG,EAAMH,GACV,MAAOG,EAKV,OAAO/I,GAIR,GADArL,EAASH,EAAKrM,WACVwM,GAAUA,IAAW+T,EACxB,MAAO/T,IArDV,GAAIH,GAAOiU,CAgEXnsB,MAAKwL,QAAU,WACd,MAAO0M,IASRlY,KAAK6nB,KAAO,SAAS0E,GAEpB,MADArU,GAAOmU,EAAYnU,EAAM,aAAc,cAAeqU,IAUvDvsB,KAAK8nB,KAAO,SAASyE,GAEpB,MADArU,GAAOmU,EAAYnU,EAAM,YAAa,kBAAmBqU,IAI1DvsB,KAAK0sB,MAAQ,SAASH,GAErB,MADArU,GAAOsU,EAAiBtU,EAAM,YAAa,kBAAmBqU,OAwBjEhwB,EAAO,qBACN,sBACE,SAASwlB,GAEX,QAAS4K,GAAMC,GAed,QAASrK,KACR,MAAOha,GAAIga,yBAGZ,QAASsK,GAASrN,EAAGF,GACpBwN,EAAaC,EAAMvN,EAAGF,GAGvB,QAAS0N,GAAOxN,EAAGF,GAClBwN,EAAaG,EAAOzN,EAAGF,GAGxB,QAAS4N,GAAe1N,GACvBqN,EAASrN,EAAE3T,WAAYmQ,EAAUwD,IAGlC,QAAS2N,GAAc3N,GACtBqN,EAASrN,EAAE3T,WAAYmQ,EAAUwD,GAAK,GAGvC,QAAS4N,GAAa5N,GACrBwN,EAAOxN,EAAE3T,WAAYmQ,EAAUwD,IAGhC,QAAS6N,GAAY7N,GACpBwN,EAAOxN,EAAE3T,WAAYmQ,EAAUwD,GAAK,GAGrC,QAAS8N,GAASC,GACbA,GACHtjB,EAAKujB,GAAiBvjB,EAAKwjB,GAC3BxjB,EAAKyjB,GAAczjB,EAAK0jB,KAExB1jB,EAAKwjB,GAAmBxjB,EAAKujB,GAC7BvjB,EAAK0jB,GAAgB1jB,EAAKyjB,IAG3BzjB,EAAK2jB,UAAYb,EAGlB,QAASc,GAAWrO,GACnB0N,EAAe1N,GACf6N,EAAY7N,GAGb,QAASsO,GAAmBtO,GAC3BqN,EAASrN,EAAG,GACZwN,EAAOxN,EAAkB,IAAfA,EAAEjU,SAAiBiU,EAAExH,WAAW9b,OAASsjB,EAAE3E,UAAU3e,QAGhE,QAAS6xB,GAAsBrwB,EAAGsrB,GACjC,GAAIgF,GAAK/jB,EAAKwjB,GAAkBQ,EAAKhkB,EAAK0jB,GAAeO,EAAKjkB,EAAKujB,GAAgBW,EAAKlkB,EAAKyjB,GAC7FU,EAAMpF,EAAEqF,eAAgBC,EAAMtF,EAAEuF,YAAaC,EAAMxF,EAAEyF,aAAcC,EAAM1F,EAAE2F,SAG3E,OAAU,KAANjxB,EACIkxB,EAAuBZ,EAAIC,EAAIG,EAAKE,GAIlC,IAAN5wB,EACIkxB,EAAuBV,EAAIC,EAAIC,EAAKE,GAIlC,IAAN5wB,EACIkxB,EAAuBV,EAAIC,EAAIK,EAAKE,GAIlC,IAANhxB,EACIkxB,EAAuBZ,EAAIC,EAAIO,EAAKE,GAD5C,OAKD,QAASG,KACRC,EAAUC,GAGX,QAASC,KACR,MAAOF,GAAUG,GAGlB,QAASC,KACR,MAAOJ,GAAUK,GAGlB,QAASC,GAAW5P,GACnB,GACmC6P,GAAI/P,EADnC+O,EAAiBruB,KAAKytB,GACzBc,EAAcvuB,KAAK2tB,EAGa,KAA5BU,EAAe9iB,UAA8C,IAA5B8iB,EAAe9iB,WAAmB8iB,EAAexT,WAclFwT,EAAerW,WAAW9b,OAAS,IACtCojB,EAAI+O,EAAerW,WAAWuW,IAG3BjP,EACH+O,EAAehL,aAAa7D,EAAGF,GAEA,GAA3B+O,EAAe9iB,SAClBqhB,EAAI0C,YAAY9P,EAAG6O,GAEnBA,EAAe9V,YAAYiH,IAvBxB+O,EAGMA,GAAeF,EAAexT,UAAU3e,OAElD0wB,EAAI0C,YAAY9P,EAAG6O,IAGnBgB,EAAKhB,EAAekB,UAAUhB,GAC9BF,EAAexiB,WAAWwX,aAAa7D,EAAG6P,IAP1ChB,EAAexiB,WAAWwX,aAAa7D,EAAG6O,GA2B7C,QAASmB,GAAiBhQ,GACzB,GAAII,GAAI3V,EAAK+kB,iBAEb/kB,GAAKmlB,WAAW5P,GAChBA,EAAEjH,YAAYqH,GACd3V,EAAK4jB,WAAWrO,GAGjB,QAASiQ,KACR,MAAOpO,GAAO,GAAIsL,GAAMC,IACvByB,eAAgBpkB,EAAKwjB,GACrBc,YAAatkB,EAAK0jB,GAClBc,aAAcxkB,EAAKujB,GACnBmB,UAAW1kB,EAAKyjB,GAChBE,UAAW3jB,EAAK2jB,UAChB8B,wBAAyBzlB,EAAKylB,0BAMhC,QAASC,GAAiBplB,EAAWid,GACpC,GAAIiF,EAGJ,IAA0B,GAAtBliB,EAAUgB,SACb,MAAOhB,EAGR,IAAIid,EAAS,EACZ,MAAOjd,EAIR,KADAkiB,EAAQliB,EAAUqQ,WACX6R,GAASjF,EAAS,KACtBA,EACFiF,EAAQA,EAAM3b,WAGf,OAAI2b,GACIA,EAGDliB,EAGR,QAASqlB,KACR,MAAQ3lB,GAAKwjB,IAAoBxjB,EAAKujB,IAAkBvjB,EAAK0jB,IAAiB1jB,EAAKyjB,GAGpF,QAASkB,GAAuBiB,EAAYC,EAASC,EAAYC,GAChE,GAAI/O,GAAGgP,EAASzQ,EAAG0Q,EAASC,EAAQC,CAMpC,IAAIP,GAAcE,EACjB,MAAID,IAAWE,EACP,EAGJF,EAAUE,KAIP,CAOR,KADA/O,EAAI8O,EACG9O,GAAKA,EAAEpV,YAAcgkB,GAC3B5O,EAAIA,EAAEpV,UAGP,IAAIoV,EAAG,CAIN,IAHAgP,EAAU,EACVzQ,EAAIqQ,EAAWjV,WAER4E,GAAKyB,GAAKgP,EAAUH,GAC1BG,IACAzQ,EAAIA,EAAE1O,WAGP,OAAIgf,IAAWG,KAIR,EAOR,IADAhP,EAAI4O,EACG5O,GAAKA,EAAEpV,YAAckkB,GAC3B9O,EAAIA,EAAEpV,UAGP,IAAIoV,EAAG,CAIN,IAHAgP,EAAU,EACVzQ,EAAIuQ,EAAWnV,WAER4E,GAAKyB,GAAKgP,EAAUD,GAC1BC,IACAzQ,EAAIA,EAAE1O,WAGP,OAAImf,GAAUD,KAIP,EAUR,IAHAE,EAAUtD,EAAIyD,mBAAmBR,EAAYE,GAC7CI,EAASN,EAEFM,GAAUA,EAAOtkB,YAAcqkB,GACrCC,EAASA,EAAOtkB,UAQjB,KALKskB,IACJA,EAASD,GAGVE,EAASL,EACFK,GAAUA,EAAOvkB,YAAcqkB,GACrCE,EAASA,EAAOvkB,UAOjB,IAJKukB,IACJA,EAASF,GAGNC,GAAUC,EACb,MAAO,EAIR,KADA5Q,EAAI0Q,EAAQtV,WACL4E,GAAG,CACT,GAAIA,GAAK2Q,EACR,QAGD,IAAI3Q,GAAK4Q,EACR,MAAO,EAGR5Q,GAAIA,EAAE1O,aAIR,QAASgc,GAAawD,EAAI9Q,EAAGF,GAC5B,GAAI4O,GAAIF,CAeR,KAbIsC,GACHrmB,EAAKwjB,GAAmBjO,EACxBvV,EAAK0jB,GAAgBrO,IAErBrV,EAAKujB,GAAiBhO,EACtBvV,EAAKyjB,GAAcpO,GAOpB4O,EAAKjkB,EAAKujB,GACHU,EAAGriB,YACTqiB,EAAKA,EAAGriB,UAIT,KADAmiB,EAAK/jB,EAAKwjB,GACHO,EAAGniB,YACTmiB,EAAKA,EAAGniB,UAGLmiB,IAAME,EAKLU,EAAuB3kB,EAAKwjB,GAAkBxjB,EAAK0jB,GAAe1jB,EAAKujB,GAAgBvjB,EAAKyjB,IAAe,GAC9GzjB,EAAKqjB,SAASgD,GAGfrmB,EAAKqjB,SAASgD,GAGfrmB,EAAK2jB,UAAYgC,IACjB3lB,EAAKylB,wBAA0B9C,EAAIyD,mBAAmBpmB,EAAKwjB,GAAkBxjB,EAAKujB,IAGnF,QAASsB,GAAUyB,GAClB,GAAItP,GAAmDL,EAAG4P,EAAWrE,EAAWsE,EAAS5P,EAAI6P,EAAtFC,EAAoB,EAAGC,EAAsB,CAEpD,IAAI3mB,EAAKwjB,IAAoBxjB,EAAKujB,GACjC,MAAOqD,GAAuBN,EAG/B,KAAKtP,EAAIhX,EAAKujB,GAAgB5M,EAAIK,EAAEpV,WAAY+U,EAAGK,EAAIL,EAAGA,EAAIA,EAAE/U,WAAY,CAC3E,GAAI+U,GAAK3W,EAAKwjB,GACb,MAAOqD,GAA8B7P,EAAGsP,KAGvCI,EAGH,IAAK1P,EAAIhX,EAAKwjB,GAAkB7M,EAAIK,EAAEpV,WAAY+U,EAAGK,EAAIL,EAAGA,EAAIA,EAAE/U,WAAY,CAC7E,GAAI+U,GAAK3W,EAAKujB,GACb,MAAOuD,GAA4B9P,EAAGsP,KAGrCK,EAMH,IAHAJ,EAAYI,EAAsBD,EAElCxE,EAAYliB,EAAKwjB,GACV+C,EAAY,GAClBrE,EAAYA,EAAUtgB,WACtB2kB,GAID,KADAC,EAAUxmB,EAAKujB,GACRgD,EAAY,GAClBC,EAAUA,EAAQ5kB,WAClB2kB,GAID,KAAK3P,EAAKsL,EAAUtgB,WAAY6kB,EAAKD,EAAQ5kB,WAAYgV,GAAM6P,EAAI7P,EAAKA,EAAGhV,WAAY6kB,EAAKA,EAAG7kB,WAC9FsgB,EAAYtL,EACZ4P,EAAUC,CAGX,OAAOM,GAAyB7E,EAAWsE,EAASF,GAGrD,QAASM,GAAuBN,GAC/B,GAAIjO,GAAM/C,EAAG8I,EAAK7I,EAAGyR,EAAKvN,EAASwN,EAAUjV,EAAO7a,CAOpD,IALImvB,GAAOxB,IACVzM,EAAOC,KAIJtY,EAAK0jB,IAAiB1jB,EAAKyjB,GAC9B,MAAOpL,EAIR,IAAsC,GAAlCrY,EAAKwjB,GAAiBliB,SAAe,CAqBxC,GAnBAgU,EAAItV,EAAKwjB,GAAiB5S,UAC1BwN,EAAM9I,EAAE4R,UAAUlnB,EAAK0jB,GAAe1jB,EAAKyjB,IAGvC6C,GAAOpB,IACV3P,EAAIvV,EAAKwjB,GACTxR,EAAQhS,EAAK0jB,GACbvsB,EAAM6I,EAAKyjB,GAAczjB,EAAK0jB,GAEhB,IAAV1R,GAAe7a,GAAOoe,EAAE3E,UAAU3e,OAAS,EAC9CsjB,EAAE3T,WAAWoE,YAAYuP,GAEzBA,EAAE4R,WAAWnV,EAAO7a,GAIrB6I,EAAKqjB,SAASP,IAGXwD,GAAOxB,EACV,MAOD,OAJI1G,GAAInsB,OAAS,GAChBomB,EAAK/J,YAAYhQ,EAAI8oB,eAAehJ,IAG9B/F,EAOR,IAHA9C,EAAImQ,EAAiB1lB,EAAKwjB,GAAkBxjB,EAAK0jB,IACjDsD,EAAMhnB,EAAKyjB,GAAczjB,EAAK0jB,GAEvBnO,GAAKyR,EAAM,GACjBvN,EAAUlE,EAAE1O,YACZogB,EAAWI,EAAuB9R,EAAG+Q,GAEjCjO,GACHA,EAAK/J,YAAY2Y,KAGhBD,EACFzR,EAAIkE,CAQL,OAJI6M,IAAOpB,GACVllB,EAAKqjB,SAASP,GAGRzK,EAGR,QAASwO,GAA8BS,EAAahB,GACnD,GAAIjO,GAAM9C,EAAGgS,EAAQP,EAAKvN,EAASwN,CAenC,IAbIX,GAAOxB,IACVzM,EAAOC,KAGR/C,EAAIiS,EAAuBF,EAAahB,GAEpCjO,GACHA,EAAK/J,YAAYiH,GAGlBgS,EAASxV,EAAUuV,GACnBN,EAAMO,EAASvnB,EAAK0jB,GAEhBsD,GAAO,EAQV,MALIV,IAAOpB,IACVllB,EAAKmjB,aAAamE,GAClBtnB,EAAKqjB,SAASL,IAGR3K,CAIR,KADA9C,EAAI+R,EAAYG,gBACTT,EAAM,GACZvN,EAAUlE,EAAEkS,gBACZR,EAAWI,EAAuB9R,EAAG+Q,GAEjCjO,GACHA,EAAKe,aAAa6N,EAAU5O,EAAK1H,cAGhCqW,EACFzR,EAAIkE,CAUL,OALI6M,IAAOpB,IACVllB,EAAKmjB,aAAamE,GAClBtnB,EAAKqjB,SAASL,IAGR3K,EAGR,QAASyO,GAA4BY,EAAepB,GACnD,GAAIjO,GAAMsP,EAAUpS,EAAGyR,EAAKvN,EAASwN,CAgBrC,KAdIX,GAAOxB,IACVzM,EAAOC,KAGR/C,EAAIqS,EAAsBF,EAAepB,GACrCjO,GACHA,EAAK/J,YAAYiH,GAGlBoS,EAAW5V,EAAU2V,KACnBC,EAEFX,EAAMhnB,EAAKyjB,GAAckE,EACzBpS,EAAImS,EAAc7gB,YACX0O,GAAKyR,EAAM,GACjBvN,EAAUlE,EAAE1O,YACZogB,EAAWI,EAAuB9R,EAAG+Q,GAEjCjO,GACHA,EAAK/J,YAAY2Y,KAGhBD,EACFzR,EAAIkE,CAQL,OALI6M,IAAOpB,IACVllB,EAAKkjB,cAAcwE,GACnB1nB,EAAKqjB,SAASP,IAGRzK,EAGR,QAAS0O,GAAyBW,EAAeJ,EAAahB,GAC7D,GAAI/Q,GAAG8C,EAAMiM,EAAaI,EAAWsC,EAAKvN,EAAS5S,CAkBnD,KAhBIyf,GAAOxB,IACVzM,EAAOC,KAGR/C,EAAIqS,EAAsBF,EAAepB,GACrCjO,GACHA,EAAK/J,YAAYiH,GAGlB+O,EAAcvS,EAAU2V,GACxBhD,EAAY3S,EAAUuV,KACpBhD,EAEF0C,EAAMtC,EAAYJ,EAClB7K,EAAUiO,EAAc7gB,YAEjBmgB,EAAM,GACZngB,EAAc4S,EAAQ5S,YACtB0O,EAAI8R,EAAuB5N,EAAS6M,GAEhCjO,GACHA,EAAK/J,YAAYiH,GAGlBkE,EAAU5S,IACRmgB,CAcH,OAXAzR,GAAIiS,EAAuBF,EAAahB,GAEpCjO,GACHA,EAAK/J,YAAYiH,GAGd+Q,GAAOpB,IACVllB,EAAKkjB,cAAcwE,GACnB1nB,EAAKqjB,SAASP,IAGRzK,EAGR,QAASmP,GAAuB1U,EAAMwT,GACrC,GAAwElY,GAAQyZ,EAC5EC,EAAaC,EAAaC,EAD1BpK,EAAO8H,EAAiB1lB,EAAKujB,GAAgBvjB,EAAKyjB,GAAc,GACnBwE,EAAkBrK,GAAQ5d,EAAKujB,EAEhF,IAAI3F,GAAQ9K,EACX,MAAOoV,GAActK,EAAMqK,EAAiBjF,EAAOsD,EAMpD,KAHAlY,EAASwP,EAAKhc,WACdimB,EAAeK,EAAc9Z,EAAQ4U,EAAOA,EAAOsD,GAE5ClY,GAAQ,CACd,KAAOwP,GACNkK,EAAclK,EAAK6J,gBACnBM,EAAcG,EAActK,EAAMqK,EAAiBjF,EAAOsD,GAEtDA,GAAOxB,GACV+C,EAAazO,aAAa2O,EAAaF,EAAalX,YAGrDsX,EAAkBnF,EAClBlF,EAAOkK,CAGR,IAAI1Z,GAAU0E,EACb,MAAO+U,EAGRjK,GAAOxP,EAAOqZ,gBACdrZ,EAASA,EAAOxM,WAEhBomB,EAAoBE,EAAc9Z,EAAQ4U,EAAOA,EAAOsD,GAEpDA,GAAOxB,GACVkD,EAAkB1Z,YAAYuZ,GAG/BA,EAAeG,GAIjB,QAASJ,GAAsB9U,EAAMwT,GACpC,GACIlY,GAAQyZ,EAAchhB,EAAakhB,EAAaC,EADhDpK,EAAO8H,EAAiB1lB,EAAKwjB,GAAkBxjB,EAAK0jB,IAAgBuE,EAAkBrK,GAAQ5d,EAAKwjB,EAGvG,IAAI5F,GAAQ9K,EACX,MAAOoV,GAActK,EAAMqK,EAAiBnF,EAAMwD,EAMnD,KAHAlY,EAASwP,EAAKhc,WACdimB,EAAeK,EAAc9Z,EAAQ4U,EAAOF,EAAMwD,GAE3ClY,GAAQ,CACd,KAAOwP,GACN/W,EAAc+W,EAAK/W,YACnBkhB,EAAcG,EAActK,EAAMqK,EAAiBnF,EAAMwD,GAErDA,GAAOxB,GACV+C,EAAavZ,YAAYyZ,GAG1BE,EAAkBnF,EAClBlF,EAAO/W,CAGR,IAAIuH,GAAU0E,EACb,MAAO+U,EAGRjK,GAAOxP,EAAOvH,YACduH,EAASA,EAAOxM,WAEhBomB,EAAoBE,EAAc9Z,EAAQ4U,EAAOF,EAAMwD,GAEnDA,GAAOxB,GACVkD,EAAkB1Z,YAAYuZ,GAG/BA,EAAeG,GAIjB,QAASE,GAAc3S,EAAG0S,EAAiBE,EAAQ7B,GAClD,GAAI8B,GAAUC,EAAcC,EAAc/K,EAAQgL,CAElD,IAAIN,EACH,MAAOZ,GAAuB9R,EAAG+Q,EAIlC,IAAkB,GAAd/Q,EAAEjU,SAAe,CAiBpB,GAhBA8mB,EAAW7S,EAAE3E,UAETuX,GACH5K,EAASvd,EAAK0jB,GACd2E,EAAeD,EAASlB,UAAU3J,GAClC+K,EAAeF,EAASlB,UAAU,EAAG3J,KAErCA,EAASvd,EAAKyjB,GACd4E,EAAeD,EAASlB,UAAU,EAAG3J,GACrC+K,EAAeF,EAASlB,UAAU3J,IAG/B+I,GAAOpB,IACV3P,EAAE3E,UAAY0X,GAGXhC,GAAOxB,EACV,MAMD,OAHAyD,GAAU5F,EAAIjG,MAAMnH,EAAGyN,GACvBuF,EAAQ3X,UAAYyX,EAEbE,EAGR,GAAIjC,GAAOxB,EAIX,MAAOnC,GAAIjG,MAAMnH,EAAGyN,GAGrB,QAASqE,GAAuB9R,EAAG+Q,GAClC,MAAIA,IAAOxB,EACHwB,GAAOpB,EAAQvC,EAAIjG,MAAMnH,EAAGuN,GAAQvN,MAG5CA,GAAE3T,WAAWoE,YAAYuP,GAG1B,QAASiT,KACR,MAAO7F,GAAI9uB,OAAO,OAAQ,KAAMoxB,KAAiBwD,UA5sBlD,GAAIzoB,GAAOjK,KACVuI,EAAMqkB,EAAIrkB,IACV0mB,EAAU,EACVE,EAAQ,EACRJ,EAAS,EACThC,GAAO,EACPE,GAAQ,EACRU,EAAe,cACfF,EAAkB,iBAClBD,EAAgB,eAChBE,EAAa,YACbrM,EAASU,EAAMV,OACfrF,EAAY4Q,EAAI5Q,SAsuBjB,OAnCAqF,GAAOpX,GAENokB,eAAgB9lB,EAChBgmB,YAAa,EACbE,aAAclmB,EACdomB,UAAW,EACXf,UAAWb,EACX2C,wBAAyBnnB,EAGzBoqB,eAAgB,EAChBC,aAAc,EACdC,WAAY,EACZC,aAAc,EAGdjG,SAAUA,EACVG,OAAQA,EACRE,eAAgBA,EAChBC,cAAeA,EACfC,aAAcA,EACdC,YAAaA,EACbC,SAAUA,EACVO,WAAYA,EACZC,mBAAoBA,EACpBC,sBAAuBA,EACvBc,eAAgBA,EAChBG,gBAAiBA,EACjBE,cAAeA,EACfE,WAAYA,EACZI,iBAAkBA,EAClBC,WAAYA,EACZgD,WAAYA,IAGNxoB,EAQR,MAJA0iB,GAAM1qB,UAAUC,SAAW,WAC1B,MAAOlC,MAAKyyB,cAGN9F,IAyBRpwB,EAAO,yBACN,sBACE,SAASwlB,GAoCX,QAASgR,GAAatW,GACrB,GAAI8I,EAKJ,OAHAA,GAAM7hB,SAASsM,cAAc,OAC7BuV,EAAIxM,UAAY0D,EAET8I,EAAI5K,aAAe4K,EAAI7I,WAAaD,EAI5C,QAASuW,GAAoBtS,EAAOuS,GACnC,GAAIh3B,GAAGi3B,EAAKC,EAAQC,IAEpB,IAAI1S,EAAO,CAKV,IAJAA,EAAQA,EAAM5jB,MAAM,KACpBm2B,EAAQA,GAAS,GAGZh3B,EAAI,EAAGA,EAAIykB,EAAMxkB,OAAQD,GAAK,EAClCi3B,EAAMpb,OAAOC,aAAaoR,SAASzI,EAAMzkB,GAAIg3B,IAGxCI,EAAaH,KACjBC,EAAS,IAAMzS,EAAMzkB,EAAI,GAAK,IAC9Bm3B,EAAOF,GAAOC,EACdC,EAAOD,GAAUD,EAInB,OAAOE,IAhET,GAEIE,GAAeD,EAAcE,EAF7B9S,EAAUsB,EAAMtB,QAGnB+S,EAAmB,0EACnBC,EAAkB,kEAClBC,EAAiB,aACjBC,EAAe,kCACfC,GACCC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAChFC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAChFC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAChFC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAChFC,IAAK,IAAUC,IAAK,IAAUC,IAAK,IAIrClC,IACCmC,IAAM,SACNC,IAAK,QACLC,IAAK,OACL1a,IAAK,OACL2a,IAAK,QACLC,IAAU,SAIXrC,GACCsC,OAAQ,IACRC,OAAQ,IACRC,QAAS,IACTC,SAAU,IACVC,SAAU,KAsCX3C,EAAgBN,EACf,+rEAwBwD,GAEzD,IAAIkD,IASHC,UAAW,SAAS1Z,EAAMvC,GACzB,MAAOuC,GAAK/N,QAAQwL,EAAOsZ,EAAmBC,EAAiB,SAASP,GACvE,MAAOG,GAAaH,IAAQA,KAa9BkD,aAAc,SAAS3Z,GACtB,OAAQ,GAAKA,GAAM/N,QAAQglB,EAAgB,SAASR,GACnD,MAAOG,GAAaH,IAAQA,KAa9BmD,cAAe,SAAS5Z,EAAMvC,GAC7B,MAAOuC,GAAK/N,QAAQwL,EAAOsZ,EAAmBC,EAAiB,SAASP,GAEvE,MAAIA,GAAIh3B,OAAS,EACT,MAAwC,MAA9Bg3B,EAAIoD,WAAW,GAAK,QAAoBpD,EAAIoD,WAAW,GAAK,OAAU,OAAW,IAG5FjD,EAAaH,IAAQ,KAAOA,EAAIoD,WAAW,GAAK,OAczDC,YAAa,SAAS9Z,EAAMvC,EAAMsc,GAGjC,MAFAA,GAAWA,GAAYlD,EAEhB7W,EAAK/N,QAAQwL,EAAOsZ,EAAmBC,EAAiB,SAASP,GACvE,MAAOG,GAAaH,IAAQsD,EAAStD,IAAQA,KAY/CuD,cAAe,SAAS7vB,EAAM4vB,GAG7B,QAASE,GAAsBja,EAAMvC,GACpC,MAAOuC,GAAK/N,QAAQwL,EAAOsZ,EAAmBC,EAAiB,SAASP,GACvE,MAAOG,GAAaH,IAAQsD,EAAStD,IAAQ,KAAOA,EAAIoD,WAAW,GAAK,KAAOpD,IAIjF,QAASyD,GAAkBla,EAAMvC,GAChC,MAAOgc,GAASK,YAAY9Z,EAAMvC,EAAMsc,GAOzC,MAhBAA,GAAWxD,EAAoBwD,IAAalD,EAa5C1sB,EAAO6Z,EAAQ7Z,EAAK8H,QAAQ,MAAO,MAG/B9H,EAAKgwB,OAAShwB,EAAKiwB,QACfH,EAIJ9vB,EAAKgwB,MAEJJ,EACIG,EAGDT,EAASK,YAIb3vB,EAAKiwB,QACDX,EAASG,cAIVH,EAASC,WAUjBtL,OAAQ,SAASpO,GAChB,MAAOA,GAAK/N,QAAQilB,EAAc,SAASxxB,EAAK00B,GAC/C,MAAIA,IAEFA,EADuC,MAApCA,EAAQlS,OAAO,GAAGpW,cACX4a,SAAS0N,EAAQnL,OAAO,GAAI,IAE5BvC,SAAS0N,EAAS,IAIzBA,EAAU,OACbA,GAAW,MAEJ/e,OAAOC,aAAa,OAAU8e,GAAW,IAAK,OAAoB,KAAVA,KAGzDjD,EAASiD,IAAY/e,OAAOC,aAAa8e,IAG1CtD,EAAgBpxB,IAAQmxB,EAAcnxB,IAAQ4wB,EAAa5wB,MAKrE,OAAO+zB,KAqBR35B,EAAO,gCACN,qBACA,sBACE,SAASwlB,EAAOtb,GAGlB,MAAO,UAAS/C,EAAUmlB,GAMzB,QAASiO,GAAa5e,GACrBxU,EAAS6I,qBAAqB,QAAQ,GAAGgM,YAAYL,GAWtD,QAAS6e,GAAKpV,EAAKqV,EAAgBC,GAGlC,QAASC,KAGR,IAFA,GAAIC,GAAYpQ,EAAMmQ,OAAQj7B,EAAIk7B,EAAUj7B,OAErCD,KACNk7B,EAAUl7B,IAGX8qB,GAAMqQ,OAAS,EACfrQ,EAAMmQ,UACNnQ,EAAMsQ,UAGP,QAASA,KAGR,IAFA,GAAIF,GAAYpQ,EAAMsQ,OAAQp7B,EAAIk7B,EAAUj7B,OAErCD,KACNk7B,EAAUl7B,IAGX8qB,GAAMqQ,OAAS,EACfrQ,EAAMmQ,UACNnQ,EAAMsQ,UAIP,QAASC,KACR,GAAIC,GAAejyB,UAAUC,UAAUS,MAAM,gBAC7C,UAAUuxB,GAAgBA,EAAa,GAAK,KAI7C,QAASC,GAAKC,EAAcC,GACtBD,OAEC,GAAIzsB,OAAO2sB,UAAaC,EAAYC,EACxCpxB,EAAM5E,WAAW61B,GAEjBL,KAOH,QAASS,KACRN,EAAK,WAGJ,IAFA,GAAwCO,GAAoCC,EAAxEC,EAAcv0B,EAASu0B,YAAyBh8B,EAAIg8B,EAAY/7B,OAE7DD,KAGN,GAFA87B,EAAaE,EAAYh8B,GACzB+7B,EAAQD,EAAWG,UAAYH,EAAWG,UAAYH,EAAWI,cAC7DH,GAASA,EAAMx7B,KAAO47B,EAAK57B,GAE9B,MADA06B,MACO,GAGPY,GAIJ,QAASO,KACRb,EAAK,WACJ,IAEC,GAAIc,GAAW9S,EAAM+S,MAAMD,QAE3B,OADApB,OACSoB,EACR,MAAO72B,MAGP42B,GAxEJ,GAAID,GAAM5S,EAAOoS,EAAW7Q,CAiG5B,IAtBApF,EAAMI,EAAML,gBAAgBC,GAEvB6W,EAAa7W,GAQjBoF,EAAQyR,EAAa7W,IAPrBoF,GACCmQ,UACAG,WAGDmB,EAAa7W,GAAOoF,GAKjBiQ,GACHjQ,EAAMmQ,OAAO76B,KAAK26B,GAGfC,GACHlQ,EAAMsQ,OAAOh7B,KAAK46B,GAIC,GAAhBlQ,EAAMqQ,OAAV,CAKA,GAAoB,GAAhBrQ,EAAMqQ,OAET,WADAF,IAKD,IAAoB,GAAhBnQ,EAAMqQ,OAET,WADAC,IAeD,IAVAtQ,EAAMqQ,OAAS,EACfgB,EAAO10B,EAASsM,cAAc,QAC9BooB,EAAK96B,IAAM,aACX86B,EAAKlwB,KAAO,WACZkwB,EAAK57B,GAAK,IAAOi8B,IACjBL,EAAKM,OAAQ,EACbN,EAAKO,OAAQ,EACbf,GAAY,GAAI5sB,OAAO2sB,UAGnB,UAAYS,KAASd,IACxBc,EAAKQ,OAASd,EACdM,EAAKS,QAAUxB,MACT,CAGN,GAAI/xB,UAAUC,UAAUK,QAAQ,WAAa,EAK5C,MAJA4f,GAAQ9hB,EAASsM,cAAc,SAC/BwV,EAAM7K,YAAc,YAAcgH,EAAM,IACxC0W,QACAvB,GAAatR,EAKdsS,KAGDhB,EAAasB,GACbA,EAAKjb,KAAOwE,GAjKb,GAAoCkW,GAAhCY,EAAU,EAAGD,IAEjB3P,GAAWA,MACXgP,EAAchP,EAASgP,aAAe,IAiKtC73B,KAAK+2B,KAAOA,KA2Bdx6B,EAAO,wBACN,qBACA,uBACA,sBACA,yBACA,yBACA,oBACA,wBACA,cACA,qBACA,gCACE,SAAS0Q,EAAQ6rB,EAAGC,EAAQ7uB,EAAY8uB,EAAYrM,EAAOuJ,EAAUxvB,EAAKqb,EAAOkX,GAOnF,QAASC,GAAeC,EAAUtQ,GACjC,GAAuDuQ,GAAnD3U,KAAgB4U,EAAaxQ,EAASyQ,WA6C1C,OA3CAF,IACCnU,IAAK,SAASsU,EAAMh4B,EAAOqF,GACtBiiB,EAAS2C,gBACZjqB,EAAQsnB,EAAS2C,cAAcrqB,KAAK0nB,EAAS4C,qBAAuB0N,EAAU53B,EAAOqF,EAAM2yB,EAAK,KAGjGA,EAAKrf,KAAK,YAActT,EAAMrF,GAAO2Y,KAAKtT,EAAMrF,IAGjDyjB,IAAK,SAASuU,EAAM3yB,GACnB,MAAO2yB,GAAKrf,KAAK,YAActT,IAAS2yB,EAAKrf,KAAKtT,KAIpD6d,GACCe,OACCP,IAAK,SAASsU,EAAMh4B,GACnB,MAAc,QAAVA,GAAmC,gBAAVA,OAC5Bg4B,GAAKpU,IAAI5jB,IAIN83B,GACHE,EAAKrf,KAAK,iBAAkB3Y,OAG7Bg4B,GAAKrf,KAAK,QAAS3Y,KAGpByjB,IAAK,SAASuU,GACb,GAAIh4B,GAAQg4B,EAAKrf,KAAK,mBAAqBqf,EAAKrf,KAAK,QAIrD,OAFA3Y,GAAQ43B,EAASK,eAAeL,EAASM,WAAWl4B,GAAQg4B,EAAK,GAAGjrB,aAOnE+qB,IACH5U,EAAUtH,KAAOsH,EAAUiV,IAAMN,GAG3B3U,EAGR,QAASkV,GAAwBR,EAAUI,GAC1C,GAAIh4B,GAAQg4B,EAAKrf,KAAK,QAEtB3Y,GAAQ43B,EAASK,eAAeL,EAASM,WAAWl4B,GAAQg4B,EAAK,GAAGjrB,UAE/D/M,IACJA,EAAQ,MAGTg4B,EAAKrf,KAAK,iBAAkB3Y,GAG7B,QAASya,GAAU9D,EAAM0hB,GACxB,GAAaC,GAActuB,EAAvB8Q,EAAM,CAEV,IAAInE,EACH,IAAK2hB,EAAe3hB,EAAK3M,SAAU2M,EAAOA,EAAKwZ,gBAAiBxZ,EAAMA,EAAOA,EAAKwZ,gBACjFnmB,EAAW2M,EAAK3M,WAGZquB,GAA0B,GAAZruB,GACbA,GAAYsuB,GAAiB3hB,EAAK2C,UAAU3e,UAIjDmgB,IACAwd,EAAetuB,EAIjB,OAAO8Q,GAWR,QAASyd,GAASvxB,EAAKsgB,GACtB,GAAiBkR,GAAb9vB,EAAOjK,IAEXiK,GAAK1B,IAAMA,EACX0B,EAAKR,IAAM/H,OACXuI,EAAK+vB,SACL/vB,EAAKgwB,QAAU,EACfhwB,EAAKiwB,SAAWC,GAAQ5xB,EAAIjC,cAAgB,EAC5C2D,EAAKmwB,UAAYD,GAA0B,cAAlB5xB,EAAI8xB,YAA8BpwB,EAAKiwB,QAChEjwB,EAAKqwB,iBAAmB,GAAIrB,GAAiB1wB,GAC7C0B,EAAKswB,eACLtwB,EAAK4e,SAAWA,EAAWA,MAC3B5e,EAAK6e,OAASD,EAASC,OACvB7e,EAAKsgB,OAAS,GAAIwO,IACjBvN,cAAe3C,EAAS2C,cACxBC,oBAAqB5C,EAAS4C,qBAC5B5C,EAASC,QAEZ7e,EAAKuwB,OAAOjyB,GACZ0B,EAAKO,OAASqe,EAAS4R,UAAY,GAAIvwB,GAAW2e,EAAS6R,OAASxwB,EAAW8C,MAC/E/C,EAAKwa,UAAYyU,EAAejvB,EAAM4e,GACtCkR,EAAmBlR,EAASC,OAASD,EAASC,OAAO6R,sBACrD1wB,EAAK6uB,EAAIA,EAAE1Q,iBAAiB,WAC3B,OACCjb,QAAS5E,EACT1F,QAASoH,EAAK2wB,aAWhB3wB,EAAK4wB,QAAU,SAAS3iB,GAEvB,IAAKA,EACJ,OAAO,CAIR,IAAIhQ,GAAOgQ,EAAK3M,QAGhB,OAAIrD,KACgB,IAATA,IAAc6xB,EAAiB7hB,EAAK5J,aAGtCyrB,EAAiB7hB,IAjJ5B,GAAImH,GAAO0C,EAAM1C,KAAMmB,EAAKuB,EAAMvB,GAAIqB,EAAOE,EAAMF,KAAMxB,EAAO0B,EAAM1B,KAClE8Z,EAAOzzB,EAAIhC,GACXo2B,EAAmB,mBACnBva,EAAmB,cAsxDvB,OApoDAuZ,GAAS73B,WACR84B,GAAI,SAASxV,GAKZ,MAJkB,gBAAPA,KACVA,EAAMvlB,KAAKglB,IAAIO,IAGTvlB,KAAK84B,EAAEvT,IAGfxI,KAAM,KAENyd,OAAQ,SAASjyB,GAChB,GAA8B3B,GAA1BiiB,EAAW7oB,KAAK6oB,QAEpB,IAAIsR,GAAQtR,EAASC,OAAQ,CAE5B,gJAIcpa,QAAQ,OAAQ,SAAS9H,GACtC2B,EAAIyH,cAAcpJ,IAInB,KAAKA,IAAQiiB,GAASC,OAAOkS,oBAC5BzyB,EAAIyH,cAAcpJ,KAKrB+f,MAAO,SAASzO,EAAM+iB,GACrB,GAAiBtU,GAAOpe,EAApB0B,EAAOjK,IAGX,QAAKm6B,GAA0B,IAAlBjiB,EAAK3M,UAAkB0vB,EAC5B/iB,EAAKkL,UAAU6X,IAGvB1yB,EAAM0B,EAAK1B,IAGN0yB,EAWEtU,EAAM/L,YAVZ+L,EAAQpe,EAAIyH,cAAckI,EAAK5J,UAG/B+Q,EAAKpV,EAAKixB,WAAWhjB,GAAO,SAASgC,GACpCjQ,EAAKkxB,UAAUxU,EAAOzM,EAAK5L,SAAUrE,EAAKmxB,UAAUljB,EAAMgC,EAAK5L,aAGzDqY,KAaTiU,QAAS,WACR,GAAI3wB,GAAOjK,IAEX,OAAOiK,GAAK4e,SAASwS,cAAgBpxB,EAAK1B,IAAI5E,MAU/C23B,YAAa,SAAS7xB,GACrB,GAAIlB,GAAKgzB,CAOT,OALA9xB,GAAOA,EAAiBA,EAAXzJ,KAAKyJ,IAClBlB,EAAMkB,EAAI/F,SACV63B,EAAUv7B,KAAKo6B,SAAW7xB,EAAIC,gBAAkBD,EAAI5E,MAInDpG,EAAGkM,EAAI+xB,aAAeD,EAAQ9yB,WAC9BjL,EAAGiM,EAAIgyB,aAAeF,EAAQ1yB,UAC9BpL,EAAGgM,EAAIiyB,YAAcH,EAAQI,YAC7Bj+B,EAAG+L,EAAImyB,aAAeL,EAAQM,eAWhCC,QAAS,SAASvW,GACjB,GAAiBrnB,GAAKuqB,EAAlBxe,EAAOjK,IAMX,OAJAulB,GAAMtb,EAAK+a,IAAIO,GACfrnB,EAAM+L,EAAK8xB,OAAOxW,GAClBkD,EAAOxe,EAAK+xB,QAAQzW,IAGnBhoB,EAAGW,EAAIX,EAAGC,EAAGU,EAAIV,EACjBC,EAAGgrB,EAAKhrB,EAAGC,EAAG+qB,EAAK/qB,IAWrBs+B,QAAS,SAASzW,GACjB,GAAiB9nB,GAAGC,EAAhBuM,EAAOjK,IAgBX,OAdAulB,GAAMtb,EAAK+a,IAAIO,GACf9nB,EAAIwM,EAAKgyB,SAAS1W,EAAK,SACvB7nB,EAAIuM,EAAKgyB,SAAS1W,EAAK,UAGnB9nB,EAAEmI,QAAQ,aACbnI,EAAI,GAIDC,EAAEkI,QAAQ,aACblI,EAAI,IAIJD,EAAG0rB,SAAS1rB,EAAG,KAAO8nB,EAAI2W,aAAe3W,EAAIoW,YAC7Cj+B,EAAGyrB,SAASzrB,EAAG,KAAO6nB,EAAI4W,cAAgB5W,EAAIsW,eAgBhDO,UAAW,SAASlkB,EAAMhL,EAAU6P,GACnC,MAAO/c,MAAKq8B,WAAWnkB,EAAMhL,EAAU6P,GAAM,IAa9Csf,WAAY,SAASnkB,EAAMhL,EAAU6P,EAAMuf,GAC1C,GAAiBC,GAAbtyB,EAAOjK,KAAmB0b,IAuB9B,KArBAxD,EAAOjO,EAAK+a,IAAI9M,GAChBokB,EAAUA,IAAY3gC,EAGtBohB,EAAOA,IAAoC,QAA3B9S,EAAK2wB,UAAUtsB,SAAqBrE,EAAK2wB,UAAU/uB,WAAa,MAG5E2U,EAAGtT,EAAU,YAChBqvB,EAAcrvB,EAGbA,EADgB,MAAbA,EACQ,SAASgL,GACnB,MAAwB,IAAjBA,EAAK3M,UAGF,SAAS2M,GACnB,MAAOjO,GAAKuW,GAAGtI,EAAMqkB,KAKjBrkB,GACFA,GAAQ6E,GAAS7E,EAAK3M,UAA8B,IAAlB2M,EAAK3M,UAD/B,CAKZ,IAAK2B,GAAYA,EAASgL,GAAO,CAChC,IAAIokB,EAGH,MAAOpkB,EAFPwD,GAAOrf,KAAK6b,GAMdA,EAAOA,EAAKrM,WAGb,MAAOywB,GAAU5gB,EAAS,MAU3BsJ,IAAK,SAASO,GACb,GAAI3e,EAEJ,OAAI2e,IAAOvlB,KAAKuI,KAAqB,gBAAPgd,KAC7B3e,EAAO2e,EACPA,EAAMvlB,KAAKuI,IAAI0F,eAAesX,GAG1BA,GAAOA,EAAI/oB,KAAOoK,GACd5G,KAAKuI,IAAImQ,kBAAkB9R,GAAM,GAInC2e,GAWRiX,QAAS,SAAStkB,EAAMhL,GACvB,MAAOlN,MAAKy8B,SAASvkB,EAAMhL,EAAU,gBAWtCwvB,QAAS,SAASxkB,EAAMhL,GACvB,MAAOlN,MAAKy8B,SAASvkB,EAAMhL,EAAU,oBAqBtCkC,OAAQ,SAASlC,EAAUzC,GAC1B,GAAIR,GAAOjK,IAGX,OAAOiN,GAAOC,EAAUjD,EAAK+a,IAAIva,IAAUR,EAAK4e,SAASwS,cAAgBpxB,EAAK1B,SAU/EiY,GAAI,SAAS+E,EAAKrY,GACjB,GAAIjR,EAGJ,IAAIspB,EAAIrpB,SAAWP,EAAW,CAE7B,GAAiB,MAAbuR,EACH,MAAuB,IAAhBqY,EAAIha,QAIZ,IAAIuvB,EAAiBr1B,KAAKyH,GAAW,CAIpC,IAHAA,EAAWA,EAASqB,cAAczR,MAAM,KACxCyoB,EAAMA,EAAIjX,SAASC,cAEdtS,EAAIiR,EAAShR,OAAS,EAAGD,GAAK,EAAGA,IACrC,GAAIiR,EAASjR,IAAMspB,EAClB,OAAO,CAIT,QAAO,GAKT,GAAIA,EAAIha,UAA4B,GAAhBga,EAAIha,SACvB,OAAO,CAGR,IAAIoxB,GAAOpX,EAAIha,UAAYga,GAAOA,CAGlC,OAAOtY,GAAOC,EAAUyvB,EAAK,GAAGr0B,eAAiBq0B,EAAK,GAAI,KAAMA,GAAMzgC,OAAS,GAoBhF0oB,IAAK,SAASgY,EAAWh2B,EAAMuJ,EAAOiS,EAAMtkB,GAC3C,GAAImM,GAAOjK,IAEX,OAAOA,MAAK68B,IAAID,EAAW,SAASA,GACnC,GAAIE,EAaJ,OAXAA,GAAStc,EAAG5Z,EAAM,UAAYqD,EAAK1B,IAAIyH,cAAcpJ,GAAQA,EAC7DqD,EAAK8yB,WAAWD,EAAQ3sB,GAEpBiS,IACCA,EAAK7W,SACRuxB,EAAOvkB,YAAY6J,GAEnBnY,EAAK+yB,QAAQF,EAAQ1a,IAIftkB,EAAyCg/B,EAAhCF,EAAUrkB,YAAYukB,MAiBzCh/B,OAAQ,SAAS8I,EAAMuJ,EAAOiS,GAC7B,MAAOpiB,MAAK4kB,IAAI5kB,KAAKuI,IAAIyH,cAAcpJ,GAAOA,EAAMuJ,EAAOiS,EAAM,IAelE6a,WAAY,SAASr2B,EAAMuJ,EAAOiS,GACjC,GAAkB5S,GAAd0tB,EAAU,EAEdA,IAAW,IAAMt2B,CAEjB,KAAK4I,IAAOW,GACPA,EAAM4F,eAAevG,IAAuB,OAAfW,EAAMX,IAAsC,mBAAdW,GAAMX,KACpE0tB,GAAW,IAAM1tB,EAAM,KAAOxP,KAAK2qB,OAAOxa,EAAMX,IAAQ,IAK1D,OAAmB,mBAAR4S,GACH8a,EAAU,IAAM9a,EAAO,KAAOxb,EAAO,IAGtCs2B,EAAU,OAUlB/a,eAAgB,SAASC,GACxB,GAAIE,GAAMpK,EAAsB3N,EAAhBhC,EAAMvI,KAAKuI,GAS3B,KAPAgC,EAAYhC,EAAIyH,cAAc,OAC9BsS,EAAO/Z,EAAIga,yBAEPH,IACH7X,EAAUwO,UAAYqJ,GAGflK,EAAO3N,EAAUqQ,YACxB0H,EAAK/J,YAAYL,EAGlB,OAAOoK,IAmBRuD,OAAQ,SAAS3N,EAAMilB,GAmBtB,MAlBAjlB,GAAOlY,KAAK+6B,GAAG7iB,GAEXilB,EACHjlB,EAAKmH,KAAK,WAGT,IAFA,GAAIoN,GAEIA,EAAQzsB,KAAK4a,YACE,GAAlB6R,EAAMlhB,UAAuC,IAAtBkhB,EAAM/kB,KAAKxL,OACrC8D,KAAKiQ,YAAYwc,GAEjBzsB,KAAK6L,WAAWwX,aAAaoJ,EAAOzsB,QAGpC6lB,SAEH3N,EAAK2N,SAGC3N,EAAKhc,OAAS,EAAIgc,EAAKgH,UAAYhH,EAAK,IAkBhDklB,SAAU,SAAS7X,EAAK3e,EAAMrF,GAC7BgkB,EAAMvlB,KAAK+6B,GAAGxV,GAAKJ,IAAIve,EAAMrF,GAEzBvB,KAAK6oB,SAASwU,eACjB1D,EAAwB35B,KAAMulB,IAahC0W,SAAU,SAAS1W,EAAK3e,EAAM02B,GAG7B,MAFA/X,GAAMvlB,KAAK+6B,GAAGxV,GAEV+X,EACI/X,EAAIJ,IAAIve,IAIhBA,EAAOA,EAAK8H,QAAQ,SAAU,SAAS8B,EAAGC,GACzC,MAAOA,GAAE4U,gBAGE,SAARze,IACHA,EAAOF,EAAIhC,IAAMgC,EAAIhC,GAAK,GAAK,aAAe,YAGxC6gB,EAAI,IAAMA,EAAI,GAAGC,MAAQD,EAAI,GAAGC,MAAM5e,GAAQjL,IAgBtD4hC,UAAW,SAAShY,EAAKgF,GACxBhF,EAAMvlB,KAAK+6B,GAAGxV,GAAKJ,IAAIoF,GAEnBvqB,KAAK6oB,SAASwU,eACjB1D,EAAwB35B,KAAMulB,IAUhCiY,iBAAkB,SAASz8B,GAC1B,MAAOf,MAAK68B,IAAI97B,EAAG,SAASA,GAC3B,GAAI9E,GAAGkU,EAAQpP,EAAEqV,UACjB,KAAKna,EAAIkU,EAAMjU,OAAS,EAAGD,GAAK,EAAGA,IAClC8E,EAAE08B,oBAAoBttB,EAAMuP,KAAKzjB,OAoBpCk/B,UAAW,SAAS5V,EAAK3e,EAAMrF,GAC9B,GAAiBm8B,GAAe3Y,EAA5B9a,EAAOjK,KAA2B6oB,EAAW5e,EAAK4e,QAExC,MAAVtnB,IACHA,EAAQ,MAGTgkB,EAAMtb,EAAK8wB,GAAGxV,GACdmY,EAAgBnY,EAAIrL,KAAKtT,GAEpB2e,EAAIrpB,SAIT6oB,EAAO9a,EAAKwa,UAAU7d,GAClBme,GAAQA,EAAKE,IAChBF,EAAKE,IAAIM,EAAKhkB,EAAOqF,GAErB2e,EAAIrL,KAAKtT,EAAMrF,GAGZm8B,GAAiBn8B,GAASsnB,EAAS8U,aACtC9U,EAAS8U,aACRC,QAASrY,EACTsY,SAAUj3B,EACVk3B,UAAWv8B,MAkBdw7B,WAAY,SAASxX,EAAKpV,GACzB,GAAIlG,GAAOjK,IAEXiK,GAAK8wB,GAAGxV,GAAKlG,KAAK,SAASpjB,EAAGic,GAC7BmH,EAAKlP,EAAO,SAAS5O,EAAOqF,GAC3BqD,EAAKkxB,UAAUjjB,EAAMtR,EAAMrF,QAc9B65B,UAAW,SAAS7V,EAAK3e,EAAMm3B,GAC9B,GAAiBhZ,GAAMxjB,EAAnB0I,EAAOjK,IAkBX,OAhBAulB,GAAMtb,EAAK8wB,GAAGxV,GAEVA,EAAIrpB,SACP6oB,EAAO9a,EAAKwa,UAAU7d,GAGrBrF,EADGwjB,GAAQA,EAAKC,IACRD,EAAKC,IAAIO,EAAK3e,GAEd2e,EAAIrL,KAAKtT,IAIC,mBAATrF,KACVA,EAAQw8B,GAAc,IAGhBx8B,GAWRw6B,OAAQ,SAASxW,EAAKgW,GACrB,GAA+ByC,GAA+C9/B,EAA1E+L,EAAOjK,KAAMzC,EAAI,EAAGC,EAAI,EAAiB+K,EAAM0B,EAAK1B,IAAK5E,EAAO4E,EAAI5E,IAKxE,IAHA4hB,EAAMtb,EAAK+a,IAAIO,GACfgW,EAAUA,GAAW53B,EAEjB4hB,EAAK,CAGR,GAAIgW,IAAY53B,GAAQ4hB,EAAImC,uBAAqD,WAA5BoR,EAAEn1B,GAAMwhB,IAAI,YAShE,MARAjnB,GAAMqnB,EAAImC,wBACV6T,EAAUtxB,EAAKmwB,SAAW7xB,EAAIC,gBAAkB7E,EAIhDpG,EAAIW,EAAIqB,MAAQgJ,EAAIC,gBAAgBC,YAAc9E,EAAK8E,YAAc8yB,EAAQ7yB,WAC7ElL,EAAIU,EAAIsB,KAAO+I,EAAIC,gBAAgBK,WAAalF,EAAKkF,WAAa0yB,EAAQzyB,WAElEvL,EAAGA,EAAGC,EAAGA,EAIlB,KADAwgC,EAAezY,EACRyY,GAAgBA,GAAgBzC,GAAWyC,EAAazyB,UAC9DhO,GAAKygC,EAAaC,YAAc,EAChCzgC,GAAKwgC,EAAaE,WAAa,EAC/BF,EAAeA,EAAaA,YAI7B,KADAA,EAAezY,EAAI1Z,WACZmyB,GAAgBA,GAAgBzC,GAAWyC,EAAazyB,UAC9DhO,GAAKygC,EAAav1B,YAAc,EAChCjL,GAAKwgC,EAAan1B,WAAa,EAC/Bm1B,EAAeA,EAAanyB,WAI9B,OAAQtO,EAAGA,EAAGC,EAAGA,IAYlBi8B,WAAY,SAAS/Q,GACpB,MAAO1oB,MAAKuqB,OAAOP,MAAMtB,IAW1B8Q,eAAgB,SAASjP,EAAQ3jB,GAChC,MAAO5G,MAAKuqB,OAAOsB,UAAUtB,EAAQ3jB,IAStCu3B,SAAU,SAASzV,GAClB,GAAiC0V,GAAMC,EAAnCp0B,EAAOjK,KAAMuI,EAAM0B,EAAK1B;AAG5B,GAAI0B,IAAS6vB,EAASwE,KAAO/1B,IAAQ7E,SAAU,CAC9C,GAAI66B,GAAczE,EAASwE,IAAIC,WAG/B,IADAA,EAAcA,MACVA,EAAY7V,GACf,MAGD6V,GAAY7V,IAAW,EACvBoR,EAASwE,IAAIC,YAAcA,EAI5BF,EAAW91B,EAAI0F,eAAe,oBACzBowB,IACJA,EAAW91B,EAAIyH,cAAc,SAC7BquB,EAAS7hC,GAAK,mBACd6hC,EAASn2B,KAAO,WAEhBk2B,EAAO71B,EAAIgE,qBAAqB,QAAQ,GACpC6xB,EAAKxjB,WACRwjB,EAAK/a,aAAagb,EAAUD,EAAKxjB,YAEjCwjB,EAAK7lB,YAAY8lB,IAKfA,EAAStG,WACZsG,EAAStG,WAAWrP,SAAWA,EAE/B2V,EAAS9lB,YAAYhQ,EAAI8oB,eAAe3I,KAsB1C8V,QAAS,SAAS7c,GACjB,GAAiCyc,GAA7Bn0B,EAAOjK,KAAMuI,EAAM0B,EAAK1B,GAG5B,OAAI0B,KAAS6vB,EAASwE,KAAO/1B,IAAQ7E,aACpCo2B,GAASwE,IAAIE,QAAQ7c,IAIjBA,IACJA,EAAM,IAGPyc,EAAO71B,EAAIgE,qBAAqB,QAAQ,OAExC8S,GAAKsC,EAAI7kB,MAAM,KAAM,SAAS6kB,GAC7B,GAAIyW,EAEJzW,GAAMI,EAAML,gBAAgBC,GAExB1X,EAAK+vB,MAAMrY,KAIf1X,EAAK+vB,MAAMrY,IAAO,EAClByW,EAAOnuB,EAAKnM,OAAO,QAASR,IAAK,aAAc6f,KAAMwE,IAKjDwY,GAAQ5xB,EAAIjC,cAAgBiC,EAAIk2B,SACnCrG,EAAKQ,OAAS,WACTrwB,EAAIk2B,QACPl2B,EAAIk2B,SAGLrG,EAAKQ,OAAS,OAIhBwF,EAAK7lB,YAAY6f,QAkBnBxR,SAAU,SAASrB,EAAKmZ,GACvB1+B,KAAK+6B,GAAGxV,GAAKqB,SAAS8X,IAkBvB5X,YAAa,SAASvB,EAAKmZ,GAC1B1+B,KAAK6mB,YAAYtB,EAAKmZ,GAAK,IAW5B3b,SAAU,SAASwC,EAAKmZ,GACvB,MAAO1+B,MAAK+6B,GAAGxV,GAAKxC,SAAS2b,IAW9B7X,YAAa,SAAStB,EAAKmZ,EAAK3X,GAC/B/mB,KAAK+6B,GAAGxV,GAAKsB,YAAY6X,EAAK3X,GAAO1H,KAAK,WAClB,KAAnBrf,KAAKsY,WACRwgB,EAAE94B,MAAMka,KAAK,QAAS,SAWzBmN,KAAM,SAAS9B,GACdvlB,KAAK+6B,GAAGxV,GAAK8B,QAYdC,KAAM,SAAS/B,GACdvlB,KAAK+6B,GAAGxV,GAAK+B,QAUdqX,SAAU,SAASpZ,GAClB,MAAsC,QAA/BvlB,KAAK+6B,GAAGxV,GAAKJ,IAAI,YAWzByZ,SAAU,SAAS1U,GAClB,OAASA,EAAkBA,EAAT,QAAoBlqB,KAAKi6B,WAiB5C+C,QAAS,SAASzX,EAAKnD,GACtBmD,EAAMvlB,KAAK+6B,GAAGxV,GAEV4U,EACH5U,EAAIlG,KAAK,SAASpjB,EAAGW,GACpB,GAAIA,EAAOiiC,eAAgB,EAA3B,CAKA,KAAOjiC,EAAOge,YACbhe,EAAOqT,YAAYrT,EAAOge,WAG3B,KAGChe,EAAOmc,UAAY,OAASqJ,EAC5BxlB,EAAOqT,YAAYrT,EAAOge,YACzB,MAAOnZ,GAERq3B,EAAE,SAAS1W,KAAK,OAASA,GAAMqE,WAAWpkB,MAAM,GAAG8jB,SAASvpB,GAG7D,MAAOwlB,MAGRmD,EAAInD,KAAKA,IAcX0c,aAAc,SAASvZ,GAItB,MAHAA,GAAMvlB,KAAKglB,IAAIO,GAGQ,GAAhBA,EAAIha,UAAiB,aAAega,GAAMA,EAAIwZ,UAAYjG,EAAE,SAAShT,OAAOgT,EAAEvT,GAAKoB,SAASvE,QAgBpG4c,aAAc,SAASzZ,EAAKnD,GAC3B,GAAInY,GAAOjK,IAEXiK,GAAK8wB,GAAGxV,GAAKlG,KAAK,WACjB,IAEC,GAAI,aAAerf,MAElB,YADAA,KAAK++B,UAAY3c,GAGjB,MAAO3gB,IAKTwI,EAAK4b,OAAOiT,EAAE94B,MAAMoiB,KAAKA,IAAO,MAWlCyI,OAAQqL,EAASrL,OASjBF,OAAQuL,EAASE,aAUjB9G,YAAa,SAASpX,EAAM+mB,GAG3B,MAFAA,GAAgBj/B,KAAKglB,IAAIia,GAElBj/B,KAAK68B,IAAI3kB,EAAM,SAASA,GAC9B,GAAIG,GAAQvH,CAWZ,OATAuH,GAAS4mB,EAAcpzB,WACvBiF,EAAcmuB,EAAcnuB,YAExBA,EACHuH,EAAOgL,aAAanL,EAAMpH,GAE1BuH,EAAOE,YAAYL,GAGbA,KAcTxJ,QAAS,SAASouB,EAAQoC,EAAQ/B,GACjC,GAAIlzB,GAAOjK,IAEX,OAAOiK,GAAK4yB,IAAIqC,EAAQ,SAASA,GAWhC,MAVI1e,GAAG0e,EAAQ,WACdpC,EAASA,EAAO1Z,WAAU,IAGvB+Z,GACH9d,EAAKwC,EAAKqd,EAAOlnB,YAAa,SAASE,GACtC4kB,EAAOvkB,YAAYL,KAIdgnB,EAAOrzB,WAAWszB,aAAarC,EAAQoC,MAYhDE,OAAQ,SAAS7Z,EAAK3e,GACrB,GAAiBk2B,GAAb7yB,EAAOjK,IAeX,OAbIulB,GAAIjX,UAAY1H,EAAKye,gBAExByX,EAAS7yB,EAAKnM,OAAO8I,GAGrByY,EAAKpV,EAAKixB,WAAW3V,GAAM,SAAS8Z,GACnCp1B,EAAKkxB,UAAU2B,EAAQuC,EAAS/wB,SAAUrE,EAAKmxB,UAAU7V,EAAK8Z,EAAS/wB,aAIxErE,EAAKyE,QAAQouB,EAAQvX,EAAK,IAGpBuX,GAAUvX,GAWlB8K,mBAAoB,SAAS7f,EAAGC,GAG/B,IAFA,GAAY6uB,GAARC,EAAK/uB,EAEF+uB,GAAI,CAGV,IAFAD,EAAK7uB,EAEE6uB,GAAMC,GAAMD,GAClBA,EAAKA,EAAGzzB,UAGT,IAAI0zB,GAAMD,EACT,KAGDC,GAAKA,EAAG1zB,WAGT,OAAK0zB,GAAM/uB,EAAElI,cACLkI,EAAElI,cAAcE,gBAGjB+2B,GAURxW,MAAO,SAASyW,GACf,MAAOx/B,MAAKuqB,OAAOxB,MAAMhH,EAAM1B,KAAKmf,KAYrC3C,IAAK,SAAStX,EAAKrhB,EAAMuG,GACxB,GAAiBiR,GAAbzR,EAAOjK,IAMX,OAJmB,gBAARulB,KACVA,EAAMtb,EAAK+a,IAAIO,MAGXA,IAIL9a,EAAQA,GAASzK,KACZulB,EAAIha,WAAaga,EAAIrpB,QAAyB,IAAfqpB,EAAIrpB,OAgBjCgI,EAAK/C,KAAKsJ,EAAO8a,IAfvB7J,KAEA2D,EAAKkG,EAAK,SAASA,EAAKtpB,GACnBspB,IACe,gBAAPA,KACVA,EAAMtb,EAAK+a,IAAIO,IAGhB7J,EAAOrf,KAAK6H,EAAK/C,KAAKsJ,EAAO8a,EAAKtpB,OAI7Byf,KAaTwf,WAAY,SAAS3V,GACpB,GAAIpV,EAIJ,IAFAoV,EAAMvlB,KAAKglB,IAAIO,IAEVA,EACJ,QAGD,IAAI4U,EAAM,CAIT,GAHAhqB,KAGoB,UAAhBoV,EAAIjX,SACP,MAAOiX,GAAInP,UAIS,YAAjBmP,EAAIjX,UAAyBtO,KAAKo7B,UAAU7V,EAAK,aACpDpV,EAAM9T,MAAM8d,UAAW,EAAG7L,SAAU,YAIrC,IAAImxB,GAAa,uDAKjB,OAJAla,GAAInC,WAAU,GAAO2b,UAAUrwB,QAAQ+wB,EAAY,IAAI/wB,QAAQ,aAAc,SAAS8B,GACrFL,EAAM9T,MAAM8d,UAAW,EAAG7L,SAAUkC,MAG9BL,EAGR,MAAOoV,GAAInP,YAYZspB,QAAS,SAASxnB,EAAM+B,GACvB,GAAiBhe,GAAGma,EAAYlO,EAAMy3B,EAAQ/4B,EAA1CqD,EAAOjK,KAAyC4/B,EAAU,CAG9D,IADA1nB,EAAOA,EAAK0C,WACF,CACT+kB,EAAS,GAAI3G,GAAW9gB,EAAMA,EAAKrM,YACnCoO,EAAWA,IAAahQ,EAAK6e,OAAS7e,EAAK6e,OAAO+W,sBAAwB,KAE1E,GAAG,CAGF,GAFA33B,EAAOgQ,EAAK3M,SAEC,IAATrD,EAAY,CAEf,GAAIgQ,EAAKzJ,aAAa,kBACrB,QAKD,IADA7H,EAAOsR,EAAK5J,SAASC,cACjB0L,GAAYA,EAASrT,GAAO,CAE/B,GAAa,OAATA,EAAe,CAClBg5B,GACA,UAGD,OAAO,EAMR,IAFAxpB,EAAanM,EAAKixB,WAAWhjB,GAC7Bjc,EAAIma,EAAWla,OACRD,KAEN,GADA2K,EAAOwP,EAAWna,GAAGqS,SACR,SAAT1H,GAA4B,sBAATA,EACtB,OAAO,EAMV,GAAY,GAARsB,EACH,OAAO,CAIR,IAAc,IAATA,IAAeqY,EAAiB9a,KAAKyS,EAAK2C,WAC9C,OAAO,QAEC3C,EAAOynB,EAAO9X,QAGzB,MAAO+X,IAAW,GAanBE,UAAW,WACV,GAAIv3B,GAAMvI,KAAKuI,GAEf,OAAOA,GAAIw3B,YAAcx3B,EAAIw3B,cAAgB,GAAIpT,GAAM3sB,OAWxDgc,UAAWA,EAaXlf,MAAO,SAAS8/B,EAAWoD,EAAUC,GAWpC,QAASC,GAAShoB,GAGjB,QAASioB,GAAkBjoB,GAC1B,GAAIkoB,GAAiBloB,EAAKwZ,iBAAoD,QAAjCxZ,EAAKwZ,gBAAgBpjB,SAC9D+xB,EAAanoB,EAAKpH,aAA4C,QAA7BoH,EAAKpH,YAAYxC,QACtD,OAAO8xB,IAAkBC,EAL1B,GAAIpkC,GAAGqQ,EAAW4L,EAAKF,WAAY9P,EAAOgQ,EAAK3M,QAQ/C,IAAY,GAARrD,GAAmD,YAAtCgQ,EAAKzJ,aAAa,iBAAnC,CAIA,IAAKxS,EAAIqQ,EAASpQ,OAAS,EAAGD,GAAK,EAAGA,IACrCikC,EAAS5zB,EAASrQ,GAGnB,IAAY,GAARiM,EAAW,CAEd,GAAY,GAARA,GAAagQ,EAAK2C,UAAU3e,OAAS,EAAG,CAI3C,GAAIokC,GAAgBjgB,EAAKnI,EAAK2C,WAAW3e,MACzC,KAAK+N,EAAK4wB,QAAQ3iB,EAAKrM,aAAey0B,EAAgB,GAAuB,IAAlBA,GAAuBH,EAAkBjoB,GACnG,WAEK,IAAY,GAARhQ,IAEVoE,EAAW4L,EAAKF,WAGO,GAAnB1L,EAASpQ,QAAeoQ,EAAS,IAA8B,GAAxBA,EAAS,GAAGf,UACT,YAA7Ce,EAAS,GAAGmC,aAAa,kBACzByJ,EAAKrM,WAAWwX,aAAa/W,EAAS,GAAI4L,GAIvC5L,EAASpQ,QAAU,uBAAuBuJ,KAAKyS,EAAK5J,WACvD,MAIFrE,GAAK4b,OAAO3N,GAGb,MAAOA,IAxDR,GAAuCqoB,GAAKC,EAAKC,EAA7Cx2B,EAAOjK,KAAMgpB,EAAI/e,EAAK61B,WA2D1B,IAAIlD,GAAaoD,EA4BhB,MA1BAhX,GAAE6D,SAAS+P,EAAU/wB,WAAY5B,EAAK+R,UAAU4gB,IAChD5T,EAAEgE,OAAOgT,EAASn0B,WAAY5B,EAAK+R,UAAUgkB,IAC7CO,EAAMvX,EAAEgG,kBAGRhG,EAAI/e,EAAK61B,YACT9W,EAAE6D,SAASmT,EAASn0B,WAAY5B,EAAK+R,UAAUgkB,GAAY,GAC3DhX,EAAEgE,OAAO4P,EAAU/wB,WAAY5B,EAAK+R,UAAU4gB,GAAa,GAC3D4D,EAAMxX,EAAEgG,kBAGRyR,EAAK7D,EAAU/wB,WACf40B,EAAGpd,aAAa6c,EAASK,GAAM3D,GAG3BqD,EACHQ,EAAGpd,aAAa4c,EAAgBrD,GAGhC6D,EAAGpd,aAAa2c,EAAUpD,GAI3B6D,EAAGpd,aAAa6c,EAASM,GAAM5D,GAC/B3yB,EAAK4b,OAAO+W,GAELqD,GAAkBD,GAe3BpgC,KAAM,SAAShD,EAAQgK,EAAM1C,EAAMuG,GAClC,GAAIR,GAAOjK,IAEX,IAAI+hB,EAAMjgB,QAAQlF,GAAS,CAG1B,IAFA,GAAIX,GAAIW,EAAOV,OAERD,KACNW,EAAOX,GAAKgO,EAAKrK,KAAKhD,EAAOX,GAAI2K,EAAM1C,EAAMuG,EAG9C,OAAO7N,GAQR,OAJIqN,EAAK4e,SAASyT,SAAY1/B,IAAWqN,EAAK1B,KAAO3L,IAAWqN,EAAKR,KACpEQ,EAAKswB,YAAYl+B,MAAMO,EAAQgK,EAAM1C,EAAMuG,IAGrCR,EAAKO,OAAO5K,KAAKhD,EAAQgK,EAAM1C,EAAMuG,GAASR,IAatD6B,OAAQ,SAASlP,EAAQgK,EAAM1C,GAC9B,GAAiBjI,GAAbgO,EAAOjK,IAEX,IAAI+hB,EAAMjgB,QAAQlF,GAAS,CAG1B,IAFAX,EAAIW,EAAOV,OAEJD,KACNW,EAAOX,GAAKgO,EAAK6B,OAAOlP,EAAOX,GAAI2K,EAAM1C,EAG1C,OAAOtH,GAIR,GAAIqN,EAAKswB,cAAgB39B,IAAWqN,EAAK1B,KAAO3L,IAAWqN,EAAKR,KAG/D,IAFAxN,EAAIgO,EAAKswB,YAAYr+B,OAEdD,KAAK,CACX,GAAIyjB,GAAOzV,EAAKswB,YAAYt+B,EAExBW,IAAU8iB,EAAK,IAAQ9Y,GAAQA,GAAQ8Y,EAAK,IAASxb,GAAQA,GAAQwb,EAAK,IAC7E1f,KAAKwK,OAAOsB,OAAO4T,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAK7C,MAAO1f,MAAKwK,OAAOsB,OAAOlP,EAAQgK,EAAM1C,IAYzCgI,KAAM,SAAStP,EAAQgK,EAAMwD,GAC5B,MAAOpK,MAAKwK,OAAO0B,KAAKtP,EAAQgK,EAAMwD,IAIvCs2B,mBAAoB,SAASxoB,GAC5B,GAAInS,EAGJ,OAAKmS,IAAyB,GAAjBA,EAAK3M,UAKlBxF,EAAkBmS,EAAKzJ,aAAa,4BAChC1I,GAAuC,YAApBA,EACfA,EAIwB,YAAzBmS,EAAKnS,gBAAgCmS,EAAKnS,gBAAkB,MAV3D,MAaT46B,yBAA0B,SAASzoB,GAGlC,IAFA,GAAI6E,GAAO/c,KAAK46B,UAAW7T,EAAQ,KAE5B7O,GAAQA,IAAS6E,IACvBgK,EAAQ/mB,KAAK0gC,mBAAmBxoB,GAElB,OAAV6O,GAHyB7O,EAAOA,EAAKrM,YAQ1C,MAAOkb,IAQRva,QAAS,WACR,GAAIvC,GAAOjK,IAGX,IAAIiK,EAAKswB,YAAa,CAGrB,IAFA,GAAIt+B,GAAIgO,EAAKswB,YAAYr+B,OAElBD,KAAK,CACX,GAAIyjB,GAAOzV,EAAKswB,YAAYt+B,EAC5B+D,MAAKwK,OAAOsB,OAAO4T,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAG3CzV,EAAKswB,YAAc,KAKhBttB,EAAOa,aACVb,EAAOa,cAGR7D,EAAKR,IAAMQ,EAAK1B,IAAM0B,EAAK8S,KAAO9S,EAAKO,OAASP,EAAKqY,KAAO,MAG7Dse,UAAW,SAAS1oB,EAAMG,GACzB,KAAOH,GAAM,CACZ,GAAIG,IAAWH,EACd,OAAO,CAGRA,GAAOA,EAAKrM,WAGb,OAAO,GAKRg1B,QAAS,SAAS7X,GACjB,MACC,mBAAqBA,EAAEqF,eAAe/f,SACtC,kBAAoB0a,EAAEuF,YACtB,mBAAqBvF,EAAEyF,aAAangB,SACpC,gBAAkB0a,EAAE2F,WAMtB8N,SAAU,SAASvkB,EAAMhL,EAAUtG,GAClC,GAAIqD,GAAOjK,KAAMkE,EAAOgJ,CAExB,IAAIgL,EASH,IAPmB,gBAARhU,KACVA,EAAO,SAASgU,GACf,MAAOjO,GAAKuW,GAAGtI,EAAMhL,KAKlBgL,EAAOA,EAAKtR,GAAOsR,EAAMA,EAAOA,EAAKtR,GACzC,GAAI1C,EAAKgU,GACR,MAAOA,EAKV,OAAO,QAcT4hB,EAASwE,IAAM,GAAIxE,GAASp2B,UAC5Bo2B,EAAS9d,UAAYA,EAEd8d,IA0CRv9B,EAAO,4BACN,uBACA,sBACE,SAASu9B,EAAU/X,GAIrB,QAAS+e,KAkBR,QAASC,GAAWpf,EAAK7lB,GAIxB,QAASwF,KACRsrB,EAAI/G,OAAOrpB,GAEP+oB,IACHA,EAAIyb,mBAAqBzb,EAAIqT,OAASrT,EAAM,MAG7CzpB,IAGD,QAASse,KAIe,mBAAZ6mB,UAA2BA,QAAQC,KAC7CD,QAAQC,IAAI,mBAAqBvf,GAlBnC,GAAe4D,GAAK/oB,EAAhBowB,EAAM0R,CA2BV9hC,GAAKowB,EAAIgS,WAGTrZ,EAAM7hB,SAASsM,cAAc,UAC7BuV,EAAI/oB,GAAKA,EACT+oB,EAAIrd,KAAO,kBACXqd,EAAImU,IAAM3X,EAAML,gBAAgBC,GAG5B,sBAAwB4D,GAC3BA,EAAIyb,mBAAqB,WACpB,kBAAkBv7B,KAAK8f,EAAIzb,aAC9BxI,KAIFikB,EAAIqT,OAASt3B,EAIdikB,EAAIsT,QAAUze,GAGb1W,SAAS6I,qBAAqB,QAAQ,IAAM7I,SAASC,MAAM4U,YAAYgN,GApEzE,GAQC1d,GARGs5B,EAAS,EACZC,EAAU,EACVC,EAAS,EACTC,KACAC,KACAC,KACAC,KACAC,EAAU,CAuEX1hC,MAAK2hC,OAAS,SAAShgB,GACtB,MAAO2f,GAAO3f,IAAQ0f,GAUvBrhC,KAAK4hC,SAAW,SAASjgB,GACxB2f,EAAO3f,GAAO0f,GAWfrhC,KAAK4kB,IAAM5kB,KAAK+2B,KAAO,SAASpV,EAAK7lB,EAAU2O,GAC9C,GAAIsc,GAAQua,EAAO3f,EAGfoF,IAASlf,IACZ05B,EAAMllC,KAAKslB,GACX2f,EAAO3f,GAAOwf,GAGXrlC,IAEE0lC,EAAsB7f,KAC1B6f,EAAsB7f,OAGvB6f,EAAsB7f,GAAKtlB,MAC1B6H,KAAMpI,EACN2O,MAAOA,GAASzK,SAKnBA,KAAK6lB,OAAS,SAASlE,SACf2f,GAAO3f,SACP6f,GAAsB7f,IAU9B3hB,KAAK6hC,UAAY,SAAS/lC,EAAU2O,GACnCzK,KAAK8hC,YAAYP,EAAOzlC,EAAU2O,IAYnCzK,KAAK8hC,YAAc,SAASC,EAASjmC,EAAU2O,GAG9C,QAASu3B,GAA0BrgB,GAElCtC,EAAKmiB,EAAsB7f,GAAM,SAAS7lB,GACzCA,EAASoI,KAAK/C,KAAKrF,EAAS2O,SAG7B+2B,EAAsB7f,GAAO9Z,EAR9B,GAAIi6B,EAWJL,GAAqBplC,MACpB6H,KAAMpI,EACN2O,MAAOA,GAASzK,QAGjB8hC,EAAc,WACb,GAAIG,GAAiBpgB,EAAKkgB,EAG1BA,GAAQ7lC,OAAS,EAGjBmjB,EAAK4iB,EAAgB,SAAStgB,GAE7B,MAAI2f,GAAO3f,IAAQ0f,MAClBW,GAA0BrgB,QAKvB2f,EAAO3f,IAAQyf,IAClBE,EAAO3f,GAAOyf,EACdM,IAEAX,EAAWpf,EAAK,WACf2f,EAAO3f,GAAO0f,EACdK,IAEAM,EAA0BrgB,GAG1BmgB,UAMEJ,IACJriB,EAAKoiB,EAAsB,SAAS3lC,GACnCA,EAASoI,KAAK/C,KAAKrF,EAAS2O,SAG7Bg3B,EAAqBvlC,OAAS,QA9MlC,GAAIoiC,GAAMxE,EAASwE,IACfjf,EAAO0C,EAAM1C,KAAMwC,EAAOE,EAAMF,IAuNpC,OAFAif,GAAaA,aAAe,GAAIA,GAEzBA,IAoBRvkC,EAAO,wBACN,2BACA,sBACE,SAASukC,EAAc/e,GAGzB,QAASmgB,KACR,GAAIj4B,GAAOjK,IAEXiK,GAAKyW,SACLzW,EAAKk4B,QACLl4B,EAAKmpB,UAPN,GAAI/T,GAAO0C,EAAM1C,IA6LjB,OAnLA6iB,GAAajgC,WAQZ+iB,IAAK,SAASpe,GACb,MAAI5G,MAAKozB,OAAOxsB,GACR5G,KAAKozB,OAAOxsB,GAAMw7B,SAGnBzmC,GAGRc,aAAc,SAASmK,GACtB,GAAI8U,EAMJ,OAJI1b,MAAKozB,OAAOxsB,KACf8U,EAAS1b,KAAKozB,OAAOxsB,GAAMnK,cAGrBif,OAUR2mB,gBAAiB,SAASz7B,EAAM07B,GAC/B,GAAIC,GAAWL,EAAaK,QAE5B,IAAIA,GAAYL,EAAaM,gBAAiB,EAAO,CACpD,GAAIF,EAIH,GAHAA,EAAY,IAAMA,EAAY,IAG1BA,EAAU18B,QAAQ,IAAM28B,EAAS7W,OAAO,EAAG,GAAK,SACnD6W,EAAWA,EAAS7W,OAAO,EAAG,OACxB,IAAI4W,EAAU18B,QAAQ,IAAM28B,EAAW,SAC7C,MAIFzB,GAAaA,aAAalc,IAAI5kB,KAAKmiC,KAAKv7B,GAAQ,UAAY27B,EAAW,SA8BzE3d,IAAK,SAASpoB,EAAIimC,EAAOhmC,GAIxB,MAHAuD,MAAK0gB,MAAMrkB,KAAKomC,GAChBziC,KAAKozB,OAAO52B,IAAO4lC,SAAUK,EAAOhmC,aAAcA,GAE3CgmC,GAGR5c,OAAQ,SAASjf,SACT5G,MAAKmiC,KAAKv7B,SACV5G,MAAKozB,OAAOxsB,IAGpB87B,UAAW,SAASC,EAASC,GAC5B,MAAmB,gBAARA,GACHA,GAGA1Y,OAAQyY,EAAQzY,OAAQ2Y,SAAUD,EAAKzY,OAAQwY,EAAQxY,SAYhE2Y,cAAe,SAASC,EAAYhB,GACnC,GAAIiB,GAAYhjC,KAAKmiC,KAAKY,EAE1B1jB,GAAK0iB,EAAS,SAASkB,GACtBnC,EAAaA,aAAalc,IAAIoe,EAAY,IAAMC,MAsBlDlM,KAAM,SAASnwB,EAAMs8B,EAAUpnC,EAAU2O,GAGxC,QAAS04B,KACR,GAAI1mC,GAAewN,EAAKxN,aAAamK,EAErCyY,GAAK5iB,EAAc,SAASmmC,GAC3B,GAAIQ,GAASn5B,EAAKy4B,UAAUQ,EAAUN,EAEtC34B,GAAK8sB,KAAKqM,EAAOP,SAAUO,EAAQznC,EAAWA,KAG3CG,IACC2O,EACH3O,EAASqF,KAAKsJ,GAEd3O,EAASqF,KAAK2/B,IAfjB,GAAI72B,GAAOjK,KAAM2hB,EAAMuhB,CAoBnBj5B,GAAKk4B,KAAKv7B,KAIU,gBAAbs8B,KACVvhB,EAAMuhB,EAAShZ,OAASgZ,EAASL,SAAWK,EAAS/Y,QAG7B,IAArBxI,EAAI/b,QAAQ,MAAc+b,EAAI/b,QAAQ,aACzC+b,EAAMugB,EAAamB,QAAU,IAAM1hB,GAGpC1X,EAAKk4B,KAAKv7B,GAAQ+a,EAAIwP,UAAU,EAAGxP,EAAI2hB,YAAY,MAE/Cr5B,EAAKmpB,OAAOxsB,GACfu8B,IAEArC,EAAaA,aAAalc,IAAIjD,EAAKwhB,EAAkB14B,MAKxDy3B,EAAaqB,cAAgB,GAAIrB,GACjCA,EAAasB,aAAe,GAAItB,GAEzBA,IAiFR3lC,EAAO,0BAA4B,WAClC,QAASknC,GAAWv7B,GACnB,MAAO,UAASgQ,GACf,QAASA,GAAQA,EAAK3M,UAAYrD,GAMpC,QAASw7B,GAAev4B,GAGvB,MAFAA,GAAQA,EAAMoD,cAAczR,MAAM,KAE3B,SAASob,GACf,GAAIjc,GAAG2K,CAEP,IAAIsR,GAAQA,EAAK3M,SAGhB,IAFA3E,EAAOsR,EAAK5J,SAASC,cAEhBtS,EAAI,EAAGA,EAAIkP,EAAMjP,OAAQD,IAC7B,GAAI2K,IAASuE,EAAMlP,GAClB,OAAO,CAKV,QAAO,GAIT,QAAS0nC,GAAiB/8B,EAAMjE,GAG/B,MAFAA,GAASA,EAAO4L,cAAczR,MAAM,KAE7B,SAASob,GACf,GAAIjc,GAAG2nC,CAEP,IAAIC,EAAU3rB,GACb,IAAKjc,EAAI,EAAGA,EAAI0G,EAAOzG,OAAQD,IAE9B,GADA2nC,EAAWle,iBAAiBxN,EAAM,MAAMyN,iBAAiB/e,GACrDg9B,IAAajhC,EAAO1G,GACvB,OAAO,CAKV,QAAO,GAIT,QAAS6nC,GAAaC,EAAUC,GAC/B,MAAO,UAAS9rB,GACf,MAAO2rB,GAAU3rB,IAASA,EAAK6rB,KAAcC,GAI/C,QAASC,GAAkBpG,EAAUC,GACpC,MAAO,UAAS5lB,GACf,MAAO2rB,GAAU3rB,IAASA,EAAKzJ,aAAaovB,KAAcC,GAI5D,QAASoG,GAAQhsB,GAChB,MAAO2rB,GAAU3rB,IAASA,EAAKisB,aAAa,kBAG7C,QAASC,GAAwB7iC,GAChC,MAAO,UAAS2W,GACf,GAAI2rB,EAAU3rB,GAAO,CACpB,GAAIA,EAAKnS,kBAAoBxE,EAC5B,OAAO,CAGR,IAAI2W,EAAKzJ,aAAa,8BAAgClN,EACrD,OAAO,EAIT,OAAO,GArET,GAAIsiC,GAAYJ,EAAW,EAyE3B,QACCY,OAAQZ,EAAW,GACnBI,UAAWA,EACXS,UAAWb,EAAW,GACtBc,KAAMb,EAAe,MACrBc,sBAAuBJ,EAAwB,QAC/CK,uBAAwBL,EAAwB,SAChDV,eAAgBA,EAChBI,aAAcA,EACdG,kBAAmBA,EACnBN,iBAAkBA,EAClBO,QAASA,KAyBX3nC,EAAO,uBAAyB,WAG/B,QAASmoC,GAAOxR,GACf,MAAOA,IAAOyR,EAGf,QAAStkB,GAAKC,GACb,MAAOA,GAAI5R,QAAQ,GAAI4H,QAAOquB,EAAM,KAAM,IAP3C,GAAIA,GAAO,GAUX,QACCD,OAAQA,EACRC,KAAMA,EACNtkB,KAAMA,KAuBR9jB,EAAO,gCACN,uBACA,qBACE,SAASqoC,EAAUC,GAIrB,QAASC,GAAsB5sB,GAK9B,MAJImsB,GAAOnsB,KACVA,EAAOA,EAAKrM,YAGNg4B,EAAU3rB,IAASA,EAAKisB,aAAa,kBAG7C,QAASY,GAAuB7sB,GAC/B,MAAOmsB,GAAOnsB,IAAS2sB,EAAKH,OAAOxsB,EAAKxQ,MAGzC,QAASs9B,GAAiB9sB,GACzB,MAAO4sB,GAAsB5sB,IAAS6sB,EAAuB7sB,GAG9D,QAAS+sB,GAAa/sB,EAAM+N,GAC3B,GAAI1d,GAAKmb,EAASwhB,EAAUr5B,CAM5B,IAJAtD,EAAM2P,EAAK5P,cACX48B,EAAW38B,EAAI8oB,eAAewT,EAAKF,MACnC94B,EAAaqM,EAAKrM,WAEboa,EAkBE,CAEN,GADAvC,EAAUxL,EAAKwZ,gBACX2S,EAAO3gB,GAAU,CACpB,GAAIshB,EAAiBthB,GACpB,MAAOA,EAGR,IAAIyhB,EAAuBzhB,GAC1B,MAAOA,GAAQ6L,UAAU7L,EAAQhc,KAAKxL,OAAS,GAIjD2P,EAAWwX,aAAa6hB,EAAUhtB,OA9BtB,CAEZ,GADAwL,EAAUxL,EAAKpH,YACXuzB,EAAO3gB,GAAU,CACpB,GAAIshB,EAAiBthB,GACpB,MAAOA,EAGR,IAAI0hB,EAAyB1hB,GAE5B,MADAA,GAAQ6L,UAAU,GACX7L,EAILxL,EAAKpH,YACRjF,EAAWwX,aAAa6hB,EAAUhtB,EAAKpH,aAEvCjF,EAAW0M,YAAY2sB,GAiBzB,MAAOA,GAGR,QAASG,GAAYC,EAAWptB,EAAM+N,GACrC,GAAI1d,GAAKg9B,EAAW15B,CAmBpB,OAjBAtD,GAAM2P,EAAK5P,cACXi9B,EAAYh9B,EAAIyH,cAAcs1B,GAC9BC,EAAU32B,aAAa,iBAAkBqX,EAAS,SAAW,SAC7Dsf,EAAU32B,aAAa,iBAAkB,OACzC22B,EAAUhtB,YAAYhQ,EAAI8oB,eAAe,MACzCxlB,EAAaqM,EAAKrM,WAEboa,EAOJpa,EAAWwX,aAAakiB,EAAWrtB,GAN/BA,EAAKpH,YACRjF,EAAWwX,aAAakiB,EAAWrtB,EAAKpH,aAExCjF,EAAW0M,YAAYgtB,GAMlBA,EAGR,QAAS1f,GAAO2f,GACf,GAAI/oB,EAEAonB,GAAU2B,IAAuBR,EAAiBQ,KACjB,UAAhCA,EAAmBzsB,UACtBysB,EAAmBr2B,gBAAgB,kBAE/Bq2B,EAAmB35B,YACtB25B,EAAmB35B,WAAWoE,YAAYu1B,IAKzCnB,EAAOmB,KACV/oB,EAAOooB,EAAKxkB,KAAKmlB,EAAmB99B,MAEhB,IAAhB+U,EAAKvgB,QACJspC,EAAmB35B,YACtB25B,EAAmB35B,WAAWoE,YAAYu1B,GAI5CA,EAAmB3qB,UAAY4B,GAIjC,QAAS2oB,GAAyBltB,GACjC,MAAOmsB,GAAOnsB,IAASA,EAAKxQ,KAAK,IAAMm9B,EAAKF,KAG7C,QAASQ,GAAuBjtB,GAC/B,MAAOmsB,GAAOnsB,IAASA,EAAKxQ,KAAKwQ,EAAKxQ,KAAKxL,OAAS,IAAM2oC,EAAKF,KApHhE,GAAId,GAAYe,EAASf,UACxBQ,EAASO,EAASP,MAsHnB,QACCW,iBAAkBA,EAClBF,sBAAuBA,EACvBC,uBAAwBA,EACxBE,aAAcA,EACdI,YAAaA,EACbxf,OAAQA,EACRuf,yBAA0BA,EAC1BD,uBAAwBA,KAqB1B5oC,EAAO,0BACN,qBACA,yBACA,uBACA,gCACE,SAASwlB,EAAOiX,EAAY4L,EAAUa,GAKxC,QAASC,GAAYn7B,EAAWoV,GAC/B,GAAI3H,GAAazN,EAAUyN,UAU3B,OARA2H,KAEIA,EAAQ3H,EAAW9b,OAAS,EAC/ByjB,EAAQ3H,EAAW9b,OAAS,EAClByjB,EAAQ,IAClBA,EAAQ,GAGF3H,EAAW2H,IAAUpV,EAG7B,QAASo7B,GAAW/Y,GASnB5sB,KAAKuhB,KAAO,SAASqkB,EAAK9pC,GA0BzB,QAAS+pC,GAAQhhB,GAChB,GAAI3M,EAcJ,OAXAA,GAAO2M,EAAM,GACS,IAAlB3M,EAAK3M,UAAkB2M,IAASmW,GAAkBE,GAAerW,EAAK2C,UAAU3e,QACnF2oB,EAAMlR,OAAO,EAAG,GAIjBuE,EAAO2M,EAAMA,EAAM3oB,OAAS,GACV,IAAdyyB,GAAmB9J,EAAM3oB,OAAS,GAAKgc,IAASuW,GAAkC,IAAlBvW,EAAK3M,UACxEsZ,EAAMlR,OAAOkR,EAAM3oB,OAAS,EAAG,GAGzB2oB,EAYR,QAASihB,GAAgB5tB,EAAMtR,EAAMm/B,GAGpC,IAFA,GAAIC,MAEG9tB,GAAQA,GAAQ6tB,EAAU7tB,EAAOA,EAAKtR,GAC5Co/B,EAAS3pC,KAAK6b,EAGf,OAAO8tB,GAWR,QAASC,GAAa/tB,EAAM6E,GAC3B,EAAG,CACF,GAAI7E,EAAKrM,YAAckR,EACtB,MAAO7E,EAGRA,GAAOA,EAAKrM,iBACJqM,GAGV,QAASguB,GAAaC,EAAYJ,EAAUle,GAC3C,GAAIlE,GAAckE,EAAO,cAAgB,iBAEzC,KAAK3P,EAAOiuB,EAAY9tB,EAASH,EAAKrM,WAAYqM,GAAQA,GAAQ6tB,EAAU7tB,EAAOG,EAClFA,EAASH,EAAKrM,WACdm6B,EAAWF,EAAgB5tB,GAAQiuB,EAAajuB,EAAOA,EAAKyL,GAAcA,GAEtEqiB,EAAS9pC,SACP2rB,GACJme,EAASrjB,UAGV7mB,EAAS+pC,EAAQG,KA5FpB,GAICI,GAAUC,EACVC,EAAUpuB,EAAMG,EAAQ2tB,EAAUnhB,EAL/BwJ,EAAiBuX,EAAIvX,eACxBE,EAAcqX,EAAIrX,YAClBE,EAAemX,EAAInX,aACnBE,EAAYiX,EAAIjX,SAOjB,IADA9J,EAAQ+H,EAAIxd,OAAO,+CACfyV,EAAM3oB,OAAS,EAKlB,WAJAmjB,GAAKwF,EAAO,SAAS3M,GACpBpc,GAAUoc,KAgGZ,IAV+B,GAA3BmW,EAAe9iB,UAAiB8iB,EAAekY,kBAClDlY,EAAiBA,EAAerW,WAAWuW,IAIf,GAAzBE,EAAaljB,UAAiBkjB,EAAa8X,kBAC9C9X,EAAeiX,EAAYjX,EAAcE,IAItCN,GAAkBI,EACrB,MAAO3yB,GAAS+pC,GAASxX,IAO1B,KAHA+X,EAAWxZ,EAAIyD,mBAAmBhC,EAAgBI,GAG7CvW,EAAOmW,EAAgBnW,EAAMA,EAAOA,EAAKrM,WAAY,CACzD,GAAIqM,IAASuW,EACZ,MAAOyX,GAAa7X,EAAgB+X,GAAU,EAG/C,IAAIluB,IAASkuB,EACZ,MAKF,IAAKluB,EAAOuW,EAAcvW,EAAMA,EAAOA,EAAKrM,WAAY,CACvD,GAAIqM,IAASmW,EACZ,MAAO6X,GAAazX,EAAc2X,EAGnC,IAAIluB,IAASkuB,EACZ,MAKFC,EAAaJ,EAAa5X,EAAgB+X,IAAa/X,EACvDiY,EAAWL,EAAaxX,EAAc2X,IAAa3X,EAGnDyX,EAAa7X,EAAgBgY,GAAY,GAGzCL,EAAWF,EACVO,GAAchY,EAAiBgY,EAAaA,EAAWv1B,YACvD,cACAw1B,GAAY7X,EAAe6X,EAASx1B,YAAcw1B,GAG/CN,EAAS9pC,QACZJ,EAAS+pC,EAAQG,IAIlBE,EAAazX,EAAc6X,IAU5BtmC,KAAKlD,MAAQ,SAAS8oC,GAMrB,QAASrW,GAAUrX,EAAMsP,GACxB,MAAOtP,GAAKqX,UAAU/H,GANvB,GAAI6G,GAAiBuX,EAAIvX,eACxBE,EAAcqX,EAAIrX,YAClBE,EAAemX,EAAInX,aACnBE,EAAYiX,EAAIjX,SAmCjB,OA5BIN,IAAkBI,GAA2C,GAA3BJ,EAAe9iB,SAChDgjB,EAAc,GAAKA,EAAcF,EAAexT,UAAU3e,SAC7DuyB,EAAec,EAAUlB,EAAgBE,GACzCF,EAAiBI,EAAaiD,gBAE1B/C,EAAYJ,GACfI,GAAwBJ,EACxBF,EAAiBI,EAAec,EAAUd,EAAcE,GAAW+C,gBACnE/C,EAAYF,EAAa5T,UAAU3e,OACnCqyB,EAAc,GAEdI,EAAY,IAKiB,GAA3BN,EAAe9iB,UAAiBgjB,EAAc,GAAKA,EAAcF,EAAexT,UAAU3e,SAC7FmyB,EAAiBkB,EAAUlB,EAAgBE,GAC3CA,EAAc,GAIc,GAAzBE,EAAaljB,UAAiBojB,EAAY,GAAKA,EAAYF,EAAa5T,UAAU3e,SACrFuyB,EAAec,EAAUd,EAAcE,GAAW+C,gBAClD/C,EAAYF,EAAa5T,UAAU3e,UAKpCmyB,eAAgBA,EAChBE,YAAaA,EACbE,aAAcA,EACdE,UAAWA,IAWb3uB,KAAKwmC,UAAY,SAASZ,GAGzB,QAASa,GAAkBxqB,GAI1B,QAASyqB,GAAYxuB,GACpB,MAAOA,IAAQ,oBAAoBzS,KAAKyS,EAAK5J,UAG9C,QAASq4B,GAAiBzuB,EAAM3Y,GAG/B,IAFA,GAAIogC,GAAS,GAAI3G,GAAW9gB,EAAM0U,EAAIwP,UAAUlkB,EAAKrM,WAAY+gB,EAAIiO,UAAYl3B,GAEzEuU,EAAOynB,EAAOpgC,EAAO,OAAS,WACrC,GAAsB,OAAlB2Y,EAAK5J,SACR,OAAO,EAKV,QAASs4B,GAA8B1uB,GACtC,KAAOA,GAAQA,GAAQvU,GAAM,CAC5B,GAAI8gC,EAAuBvsB,GAC1B,OAAO,CAGRA,GAAOA,EAAKrM,WAGb,OAAO,EAGR,QAASg7B,GAAW3uB,EAAMtR,GACzB,MAAOsR,GAAKwZ,iBAAmBxZ,EAAKwZ,gBAAgBpjB,UAAY1H,EAKjE,QAASkgC,GAAqBvnC,EAAM4sB,GACnC,GAAIwT,GAAQoH,EAAmBC,CAO/B,IALA7a,EAAYA,GAAa5hB,EACzBy8B,EAAuBpa,EAAIwP,UAAUjQ,EAAUtgB,WAAY+gB,EAAIiO,UAAYl3B,EAIvEpE,GAA8B,MAAtB4sB,EAAU7d,UAAoB24B,GAAera,EAAI8S,QAAQsH,GAIpE,MAHAz8B,GAAY4hB,EAAUtgB,WACtB2b,EAASoF,EAAI5Q,UAAUmQ,QACvByN,GAAa,EAMd,KADA+F,EAAS,GAAI3G,GAAW7M,EAAW6a,GAC3B9uB,EAAOynB,EAAOpgC,EAAO,OAAS,WAAY,CAEjD,GAA2C,UAAvCqtB,EAAI+T,yBAAyBzoB,IAAqB8sB,EAAiB9sB,GACtE,MAID,IAAsB,IAAlBA,EAAK3M,UAAkB2M,EAAK2C,UAAU3e,OAAS,EAIlD,MAHAqO,GAAY2N,EACZsP,EAASjoB,EAAO2Y,EAAK2C,UAAU3e,OAAS,OACxC09B,GAAa,EAKd,IAAIhN,EAAIiO,QAAQ3iB,IAASgvB,EAAoBhvB,EAAK5J,SAASC,eAC1D,MAGDw4B,GAAoB7uB,EAIjB0V,GAAamZ,IAChBx8B,EAAYw8B,EACZnN,GAAa,EACbpS,EAAS,GA9EX,GAAIjd,GAAWid,EAAQmY,EAA8BznB,EAAMgvB,EACvDC,EAAeF,EADYtjC,EAAOipB,EAAIgO,SAwF1C,IANArwB,EAAYq7B,GAAK3pB,EAAQ,QAAU,OAAS,aAC5CuL,EAASoe,GAAK3pB,EAAQ,QAAU,OAAS,UACzCgrB,EAAoC,GAAtB18B,EAAUgB,UAAiBic,IAAWjd,EAAUyN,WAAW9b,OACzEgrC,EAAsBta,EAAI9D,OAAO+W,sBACjCsH,EAAgBlrB,GAEZ+oB,EAAiBz6B,GAArB,CAeA,GAX0B,GAAtBA,EAAUgB,UAAiBic,EAASjd,EAAUyN,WAAW9b,OAAS,IACrEirC,GAAgB,GAIU,IAAvB58B,EAAUgB,WACbhB,EAAYqiB,EAAIgO,UAChBpT,EAAS,GAINjd,IAAc5G,EAAM,CAEvB,GAAIwjC,IACHjvB,EAAO3N,EAAUyN,WAAWwP,EAAS,EAAIA,EAAS,EAAI,IAC5C,CACT,GAAIwd,EAAiB9sB,GACpB,MAGD,IAAIgvB,EAAoBhvB,EAAK5J,WAA8B,SAAjB4J,EAAK5J,SAC9C,OAMH,GAAI/D,EAAUg8B,gBAAiB,CAM9B,GALA/e,EAAS7nB,KAAKhB,KAAKwoC,GAAiB3f,EAAS,EAAIA,EAAS,EAAIA,EAAQjd,EAAUyN,WAAW9b,OAAS,GACpGqO,EAAYA,EAAUyN,WAAWwP,GACjCA,EAAS,GAGJoG,GAAarjB,IAAc5G,EAAKwY,WAAoC,UAAvB5R,EAAU+D,SAC3D,MAGD,IAAIs4B,EAA8Br8B,IAAcy6B,EAAiBz6B,GAChE,MAID,IAAIA,EAAUg8B,kBAAoB,QAAQ9gC,KAAK8E,EAAU+D,UAAW,CAEnE4J,EAAO3N,EACPo1B,EAAS,GAAI3G,GAAWzuB,EAAW5G,EAEnC,GAAG,CACF,GAAI8gC,EAAuBvsB,IAAS8sB,EAAiB9sB,GAAO,CAC3D0hB,GAAa,CACb,OAID,GAAsB,IAAlB1hB,EAAK3M,UAAkB2M,EAAK2C,UAAU3e,OAAS,EAAG,CACrDsrB,EAAS2f,EAAgB,EAAIjvB,EAAK2C,UAAU3e,OAC5CqO,EAAY2N,EACZ0hB,GAAa,CACb,OAID,GAAIsN,EAAoBhvB,EAAK5J,SAASC,iBAAmBm4B,EAAYxuB,GAAO,CAC3EsP,EAASoF,EAAI5Q,UAAU9D,GACvB3N,EAAY2N,EAAKrM,WAGI,OAAjBqM,EAAK5J,UAAsB64B,GAC9B3f,IAGDoS,GAAa,CACb,cAEQ1hB,EAAQivB,EAAgBxH,EAAO9X,OAAS8X,EAAO7X,UAMxD8F,IAIwB,IAAvBrjB,EAAUgB,UAA6B,IAAXic,GAC/Bsf,GAAqB,GAQK,IAAvBv8B,EAAUgB,WACb2M,EAAO3N,EAAUyN,WAAWwP,GAIvBtP,IACJA,EAAO3N,EAAUyN,WAAWwP,EAAS,KAGlCtP,GAA0B,OAAlBA,EAAK5J,UAAsBu4B,EAAW3uB,EAAM,MACtDyuB,EAAiBzuB,IAAUyuB,EAAiBzuB,GAAM,IACnD4uB,GAAqB,EAAM5uB,KAQ1BivB,IAAkBvZ,GAAoC,IAAvBrjB,EAAUgB,UAAkBic,IAAWjd,EAAUsQ,UAAU3e,QAC7F4qC,GAAqB,GAIlBlN,GACHgM,EAAI,OAAS3pB,EAAQ,QAAU,QAAQ1R,EAAWid,IArNpD,GAAIoS,GAAYhM,CAsOhB,OAbAA,GAAYgY,EAAIhY,UAEhB6Y,GAAkB,GAEb7Y,GACJ6Y,IAIG7M,GAAchM,GACjBgY,EAAItY,UAAS,GAGPsM,GAsCT,QAASwN,GAAmBh/B,EAASQ,EAASL,GAC7C,GAAI1F,GAAS+iC,EAAKyB,CAmBlB,IAjBAxkC,EAAU0F,EAAI++B,iBAAiBl/B,EAASQ,GACxCg9B,EAAMr9B,EAAI5E,KAAK4jC,kBAEV1kC,GAA8B,QAAnBA,EAAQ2kC,UACvB3kC,EAAU0F,EAAI5E,MAGfiiC,EAAI6B,kBAAkB5kC,GACtBwkC,EAAQtlB,EAAM7C,QAAQ0mB,EAAI8B,kBAE1BL,EAAQA,EAAM3sB,KAAK,SAASlK,EAAGC,GAI9B,MAHAD,GAAI7Q,KAAKgoC,IAAIhoC,KAAKjB,IAAI8R,EAAEhR,IAAMoJ,EAAS4H,EAAE8Z,OAAS1hB,IAClD6H,EAAI9Q,KAAKgoC,IAAIhoC,KAAKjB,IAAI+R,EAAEjR,IAAMoJ,EAAS6H,EAAE6Z,OAAS1hB,IAE3C4H,EAAIC,IAGR42B,EAAMnrC,OAAS,EAAG,CACrB0M,GAAWy+B,EAAM,GAAG/c,OAAS+c,EAAM,GAAG7nC,KAAO,CAE7C,KAIC,MAHAomC,GAAIgC,YAAYx/B,EAASQ,GACzBg9B,EAAItY,UAAS,GAENsY,EACN,MAAOnkC,KAKV,MAAO,MAtiBR,GAAI4d,GAAO0C,EAAM1C,KAChBolB,EAAyBG,EAASH,uBAClCO,EAAmBS,EAAeT,gBAgmBnC,OAtHAW,GAAWkC,cAAgB,SAASC,EAAMC,GACzC,GAAID,GAAQC,EAAM,CAEjB,IAAID,EAAKpoB,OAAQooB,EAAKE,UAYrB,MAAOF,GAAKzZ,gBAAkB0Z,EAAK1Z,gBAAkByZ,EAAKvZ,aAAewZ,EAAKxZ,WAV9E,IAAIuZ,EAAKpoB,MAAQqoB,EAAKroB,MAAQooB,EAAKpoB,KAAK,KAAOqoB,EAAKroB,KAAK,GACxD,OAAO,CAIR,IAAIooB,EAAKG,SAAWF,EAAKE,SAAWF,EAAKE,QAAQH,GAChD,OAAO,EAQV,OAAO,GAoDRnC,EAAWuC,uBAAyB,SAAS9/B,EAASQ,EAASL,GAC9D,GAAIq9B,GAAKuC,CAET,IAAI5/B,EAAI6/B,uBACPD,EAAQ5/B,EAAI6/B,uBAAuBhgC,EAASQ,GAC5Cg9B,EAAMr9B,EAAIw3B,cACV6F,EAAI/Y,SAASsb,EAAME,WAAYF,EAAM3gB,QACrCoe,EAAItY,UAAS,OACP,IAAI/kB,EAAI+/B,oBACd1C,EAAMr9B,EAAI+/B,oBAAoBlgC,EAASQ,OACjC,IAAIL,EAAI5E,KAAK4jC,gBAAiB,CACpC3B,EAAMr9B,EAAI5E,KAAK4jC,iBAEf,KACC3B,EAAIgC,YAAYx/B,EAASQ,GACzBg9B,EAAItY,UAAS,GACZ,MAAO7rB,GACRmkC,EAAMwB,EAAmBh/B,EAASQ,EAASL,IAI7C,MAAOq9B,IAGRD,EAAW4C,gBAAkB,SAASniC,GACrC,GAAIioB,GAAiBjoB,EAAMioB,eAC1BE,EAAcnoB,EAAMmoB,WAErB,OAAIF,GAAekY,iBAAmBngC,EAAMuoB,WAAaJ,EAAc,EAC/DF,EAAerW,WAAWuW,GAG3B,MAGRoX,EAAW6C,QAAU,SAASj+B,EAAWid,GASxC,MAR0B,IAAtBjd,EAAUgB,UAAiBhB,EAAUg8B,kBACpC/e,GAAUjd,EAAUyN,WAAW9b,SAClCsrB,EAASjd,EAAUyN,WAAW9b,OAAS,GAGxCqO,EAAYA,EAAUyN,WAAWwP,IAG3Bjd,GAGDo7B,IAqBRppC,EAAO,sBACN,yBACA,cACA,sBACE,SAASopC,EAAYj/B,EAAKD,GAC5B,MAAO,UAAS5C,GASf,QAAS4kC,GAAkBC,GAC1B,GAAIzsC,GAAG0sC,CAGP,IADAA,EAAc9kC,EAAOi1B,EAAE4P,GAAUzgB,aAAapkB,EAAO+kC,WAAWhkB,IAAI8jB,GAChEC,EAAYzsC,SAAW2sC,EAAS3sC,OAAQ,CAC3C,IAAKD,EAAI0sC,EAAYzsC,OAAQD,GAAK,GAC7B0sC,EAAY1sC,KAAO4sC,EAAS5sC,GADIA,KAMrC,GAAIA,OAEH,MADA4sC,GAAWF,GACJ,EAMT,MAFAE,GAAWF,GAEJ,EA3BR,GAAIG,GAASD,IA+BP,sBAAuBhlC,GAAOklC,UACnCllC,EAAOqjB,GAAG,uCAAwC,SAASnmB,GAC1D,GAAIioC,GAAWC,CAIfD,GAAYnlC,EAAOqlC,UAAUC,SAC7BF,GACC5a,eAAgB2a,EAAU3a,eAC1BE,YAAaya,EAAUza,YACvBE,aAAcua,EAAUva,aACxBE,UAAWqa,EAAUra,WAKR,cAAV5tB,EAAEmH,MAAyBy9B,EAAWkC,cAAcoB,EAASH,IAChEjlC,EAAOqI,KAAK,mBAGb48B,EAAUG,IAMZplC,EAAOqjB,GAAG,cAAe,WACxBrjB,EAAOqI,KAAK,qBAIbrI,EAAOqjB,GAAG,kBAAmB,WAC5B,GAAIwhB,GAAW7kC,EAAOqlC,UAAUE,UAAS,IAIpC1iC,EAAIN,OAASvC,EAAOqlC,UAAUG,gBAI9BZ,EAAkBC,IAAa7kC,EAAO+oB,IAAIgU,UAAU8H,EAAU7kC,EAAO+kC,YACzE/kC,EAAOylC,aAAaC,iBAAiB,MAKvC1lC,EAAOqjB,GAAG,UAAW,SAASnmB,GACxBA,EAAEiI,uBAGqC,OAAvCnF,EAAOqlC,UAAUV,UAAUl6B,SAC9B7H,EAAM7C,iBAAiBC,EAAQ,WAC9BA,EAAOylC,gBAGRzlC,EAAOylC,iBAYVtpC,KAAKspC,YAAc,SAASlnC,GAC3B,GAAkC8V,GAAM0P,EAAS7K,EAA7CmsB,EAAYrlC,EAAOqlC,SAGnBrlC,GAAO2lC,aAAeN,IAAcrlC,EAAOglB,SAAS4gB,qBAAuB5lC,EAAOygB,WAErFvH,EAAOlZ,EAAO+kC,UACd1wB,EAAOgxB,EAAUE,YAAcrsB,EAG3B7E,EAAK5P,eAAiBzE,EAAOklC,UAAallC,EAAO+oB,IAAIgU,UAAU1oB,EAAM6E,KACxE7E,EAAO6E,GAIa,OAAjB7E,EAAK5J,UAAqB46B,EAAUG,gBACvCnxB,EAAOA,EAAKrM,YAIb+b,KACA/jB,EAAO+oB,IAAIwP,UAAUlkB,EAAM,SAASA,GACnC,MAAIA,KAAS6E,OAIb6K,GAAQvrB,KAAK6b,KAGd9V,EAAOA,MACPA,EAAKS,QAAUqV,EACf9V,EAAKwlB,QAAUA,EAEf/jB,EAAOqI,KAAK,aAAc9J,QA4B9B7F,EAAO,uBAAyB,WAW/B,QAASglB,GAAKrJ,EAAMwxB,EAAW5hB,GAC9B,GAAIpE,GAASrL,EAAQiU,EAAYxE,EAAO,YAAc,aAAcnE,EAAcmE,EAAO,OAAS,MAGlG,IAAI5P,EAAKoU,GACR,MAAOpU,GAAKoU,EAIb,IAAIpU,IAASwxB,EAAW,CAGvB,GAFAhmB,EAAUxL,EAAKyL,GAGd,MAAOD,EAIR,KAAKrL,EAASH,EAAKG,OAAQA,GAAUA,IAAWqxB,EAAWrxB,EAASA,EAAOA,OAG1E,GAFAqL,EAAUrL,EAAOsL,GAGhB,MAAOD,IAcX,QAASimB,GAAK/iC,EAAMsB,GACnBlI,KAAK4G,KAAOA,EACZ5G,KAAKkI,KAAOA,EAEC,IAATA,IACHlI,KAAKoW,cACLpW,KAAKoW,WAAWzD,QAnDlB,GAAI4N,GAAmB,eAAgBqpB,GACtCC,QAAS,EACTC,WAAY,EACZC,SAAU,EACVC,MAAO,EACPC,WAAY,GACZC,qBAAsB,GAmdvB,OAlaAP,GAAK1nC,WAWJyM,QAAS,SAASwJ,GACjB,GAAIjO,GAAOjK,IASX,OAPIkY,GAAKG,QACRH,EAAK2N,SAGN5b,EAAKkgC,OAAOjyB,EAAMjO,GAClBA,EAAK4b,SAEE5b,GAgBRiQ,KAAM,SAAStT,EAAMrF,GACpB,GAAiB4O,GAAOlU,EAAG4L,EAAvBoC,EAAOjK,IAEX,IAAoB,gBAAT4G,GAAmB,CAC7B,IAAK3K,IAAK2K,GACTqD,EAAKiQ,KAAKje,EAAG2K,EAAK3K,GAGnB,OAAOgO,GAGR,GAAKkG,EAAQlG,EAAKmM,WAAa,CAC9B,GAAI7U,IAAUsG,EAAO,CAEpB,GAAc,OAAVtG,EAAgB,CACnB,GAAIqF,IAAQuJ,GAAMwC,IAIjB,UAHOxC,GAAMwC,IAAI/L,GAEjB3K,EAAIkU,EAAMjU,OACHD,KACN,GAAIkU,EAAMlU,GAAG2K,OAASA,EAErB,MADAuJ,GAAQA,EAAMwD,OAAO1X,EAAG,GACjBgO,CAKV,OAAOA,GAIR,GAAIrD,IAAQuJ,GAAMwC,KAGjB,IADA1W,EAAIkU,EAAMjU,OACHD,KACN,GAAIkU,EAAMlU,GAAG2K,OAASA,EAAM,CAC3BuJ,EAAMlU,GAAGsF,MAAQA,CACjB,YAIF4O,GAAM9T,MAAMuK,KAAMA,EAAMrF,MAAOA,GAKhC,OAFA4O,GAAMwC,IAAI/L,GAAQrF,EAEX0I,EAGR,MAAOkG,GAAMwC,IAAI/L,KAcnB+f,MAAO,WACN,GAAyD1qB,GAAGqO,EAAG8/B,EAAWC,EAAUC,EAAhFrgC,EAAOjK,KAAM2mB,EAAQ,GAAIgjB,GAAK1/B,EAAKrD,KAAMqD,EAAK/B,KAGlD,IAAKkiC,EAAYngC,EAAKmM,WAAa,CAIlC,IAHAk0B,KACAA,EAAW33B,OAEN1W,EAAI,EAAGqO,EAAI8/B,EAAUluC,OAAQD,EAAIqO,EAAGrO,IACxCouC,EAAWD,EAAUnuC,GAGC,OAAlBouC,EAASzjC,OACZ0jC,EAAWA,EAAWpuC,SAAW0K,KAAMyjC,EAASzjC,KAAMrF,MAAO8oC,EAAS9oC,OACtE+oC,EAAW33B,IAAI03B,EAASzjC,MAAQyjC,EAAS9oC,MAI3ColB,GAAMvQ,WAAak0B,EAMpB,MAHA3jB,GAAMplB,MAAQ0I,EAAK1I,MACnBolB,EAAM4jB,WAAatgC,EAAKsgC,WAEjB5jB,GAWR3D,KAAM,SAASC,GACd,GAAIhZ,GAAOjK,IAKX,OAHAiK,GAAKoO,OAAO8xB,OAAOlnB,EAAShZ,GAC5BgZ,EAAQ6C,OAAO7b,GAERA,GAWRyc,OAAQ,WACP,GAAiBxO,GAAM2P,EAAnB5d,EAAOjK,IAEX,KAAKkY,EAAOjO,EAAK2Q,WAAY1C,GAC5B2P,EAAO3P,EAAK2P,KACZ5d,EAAKkgC,OAAOjyB,EAAMjO,GAAM,GACxBiO,EAAO2P,CAGR5d,GAAK4b,UAYNA,OAAQ,WACP,GAAI5b,GAAOjK,KAAMqY,EAASpO,EAAKoO,OAAQwP,EAAO5d,EAAK4d,KAAMC,EAAO7d,EAAK6d,IA0BrE,OAxBIzP,KACCA,EAAOuC,aAAe3Q,GACzBoO,EAAOuC,WAAaiN,EAEhBA,IACHA,EAAKC,KAAO,OAGbA,EAAKD,KAAOA,EAGTxP,EAAO8D,YAAclS,GACxBoO,EAAO8D,UAAY2L,EAEfA,IACHA,EAAKD,KAAO,OAGbA,EAAKC,KAAOA,EAGb7d,EAAKoO,OAASpO,EAAK4d,KAAO5d,EAAK6d,KAAO,MAGhC7d,GAaR6b,OAAQ,SAAS5N,GAChB,GAAiB0D,GAAb3R,EAAOjK,IAiBX,OAfIkY,GAAKG,QACRH,EAAK2N,SAGNjK,EAAO3R,EAAKkS,UACRP,GACHA,EAAKiM,KAAO3P,EACZA,EAAK4P,KAAOlM,EACZ3R,EAAKkS,UAAYjE,GAEjBjO,EAAKkS,UAAYlS,EAAK2Q,WAAa1C,EAGpCA,EAAKG,OAASpO,EAEPiO,GAeRiyB,OAAQ,SAASjyB,EAAMsyB,EAAUvkB,GAChC,GAAI5N,EAgCJ,OA9BIH,GAAKG,QACRH,EAAK2N,SAGNxN,EAASmyB,EAASnyB,QAAUrY,KAExBimB,GACCukB,IAAanyB,EAAOuC,WACvBvC,EAAOuC,WAAa1C,EAEpBsyB,EAAS1iB,KAAKD,KAAO3P,EAGtBA,EAAK4P,KAAO0iB,EAAS1iB,KACrB5P,EAAK2P,KAAO2iB,EACZA,EAAS1iB,KAAO5P,IAEZsyB,IAAanyB,EAAO8D,UACvB9D,EAAO8D,UAAYjE,EAEnBsyB,EAAS3iB,KAAKC,KAAO5P,EAGtBA,EAAK2P,KAAO2iB,EAAS3iB,KACrB3P,EAAK4P,KAAO0iB,EACZA,EAAS3iB,KAAO3P,GAGjBA,EAAKG,OAASA,EAEPH,GAURuyB,OAAQ,SAAS7jC,GAChB,GAAiBsR,GAAbjO,EAAOjK,KAAY+f,IAEvB,KAAK7H,EAAOjO,EAAK2Q,WAAY1C,EAAMA,EAAOqJ,EAAKrJ,EAAMjO,GAChDiO,EAAKtR,OAASA,GACjBmZ,EAAW1jB,KAAK6b,EAIlB,OAAO6H,IASRrC,MAAO,WACN,GAAiBmH,GAAO5oB,EAAGic,EAAvBjO,EAAOjK,IAGX,IAAIiK,EAAK2Q,WAAY,CAIpB,IAHAiK,KAGK3M,EAAOjO,EAAK2Q,WAAY1C,EAAMA,EAAOqJ,EAAKrJ,EAAMjO,GACpD4a,EAAMxoB,KAAK6b,EAKZ,KADAjc,EAAI4oB,EAAM3oB,OACHD,KACNic,EAAO2M,EAAM5oB,GACbic,EAAKG,OAASH,EAAK0C,WAAa1C,EAAKiE,UAAYjE,EAAK2P,KAAO3P,EAAK4P,KAAO,KAM3E,MAFA7d,GAAK2Q,WAAa3Q,EAAKkS,UAAY,KAE5BlS,GAYRy1B,QAAS,SAASzlB,GACjB,GAAyChe,GAAG2K,EAAxCqD,EAAOjK,KAAMkY,EAAOjO,EAAK2Q,UAE7B,IAAI1C,EACH,EAAG,CACF,GAAkB,IAAdA,EAAKhQ,KAAY,CAEpB,GAAIgQ,EAAK9B,WAAWzD,IAAI,kBACvB,QAID,IAAIsH,EAAS/B,EAAKtR,MACjB,OAAO,CAKR,KADA3K,EAAIic,EAAK9B,WAAWla,OACbD,KAEN,GADA2K,EAAOsR,EAAK9B,WAAWna,GAAG2K,KACb,SAATA,GAAyD,IAAtCA,EAAKhB,QAAQ,qBACnC,OAAO,EAMV,GAAkB,IAAdsS,EAAKhQ,KACR,OAAO,CAIR,IAAmB,IAAdgQ,EAAKhQ,OAAeqY,EAAiB9a,KAAKyS,EAAK3W,OACnD,OAAO,QAEC2W,EAAOqJ,EAAKrJ,EAAMjO,GAG7B,QAAO,GAURsX,KAAM,SAASuG,GACd,MAAOvG,GAAKvhB,KAAM,KAAM8nB,KAY1B6hB,EAAK7rC,OAAS,SAAS8I,EAAMuJ,GAC5B,GAAI+H,GAAM2lB,CAMV,IAHA3lB,EAAO,GAAIyxB,GAAK/iC,EAAMgjC,EAAWhjC,IAAS,GAGtCuJ,EACH,IAAK0tB,IAAY1tB,GAChB+H,EAAKgC,KAAK2jB,EAAU1tB,EAAM0tB,GAI5B,OAAO3lB,IAGDyxB,IA6BRptC,EAAO,uBACN,sBACE,SAASwlB,GAIX,QAASjlB,GAAM4jB,EAAOC,GACrB,MAAOD,GAAQA,EAAM5jB,MAAM6jB,GAAS,QAUrC,QAAS+pB,GAAcxiC,GAItB,QAAS0c,GAAIhe,EAAMwP,EAAY9J,GAG9B,QAASq+B,GAAWvrB,EAAOD,GAC1B,GAAcljB,GAAGqO,EAAbqI,IAEJ,KAAK1W,EAAI,EAAGqO,EAAI8U,EAAMljB,OAAQD,EAAIqO,EAAGrO,IACpC0W,EAAIyM,EAAMnjB,IAAMkjB,KAGjB,OAAOxM,GATR,GAAIi4B,GAAI3uC,EAAG4uC,EAAiBzoC,EAAOzF,SAoBnC,KARA2P,EAAWA,MACX8J,EAAaA,GAAc,GAEH,gBAAb9J,KACVA,EAAWxP,EAAMwP,IAIbrQ,EAAI,EAAGA,EAAImG,EAAKlG,OAAQD,IACL,gBAAZmG,GAAKnG,KACfmG,EAAKnG,GAAKa,EAAMsF,EAAKnG,KAGtBqQ,EAASjQ,KAAKC,MAAMgQ,EAAUlK,EAAKnG,GAKpC,KAFA2K,EAAO9J,EAAM8J,GACbgkC,EAAKhkC,EAAK1K,OACH0uC,KACNC,KAAqB5+B,OAAO6+B,EAAkBhuC,EAAMsZ,IACpD0S,EAAOliB,EAAKgkC,KACXx0B,WAAYu0B,EAAWE,GACvBA,gBAAiBA,EACjBv+B,SAAUq+B,EAAWr+B,EAAUy+B,IAKlC,QAASC,GAASpkC,EAAMwP,GACvB,GAAIw0B,GAAIK,EAAYhvC,EAAGqO,CAKvB,KAHA1D,EAAO9J,EAAM8J,GACbgkC,EAAKhkC,EAAK1K,OACVka,EAAatZ,EAAMsZ,GACZw0B,KAEN,IADAK,EAAaniB,EAAOliB,EAAKgkC,IACpB3uC,EAAI,EAAGqO,EAAI8L,EAAWla,OAAQD,EAAIqO,EAAGrO,IACzCgvC,EAAW70B,WAAWA,EAAWna,OACjCgvC,EAAWJ,gBAAgBxuC,KAAK+Z,EAAWna,IAtD9C,GAAiB6uC,GAAkBI,EAC/BC,EAAiBC,EAAaC,EAAmBC,EADjDxiB,IA4DJ,OAAIyiB,GAASrjC,GACLqjC,EAASrjC,IAIjB4iC,EAAmBhuC,EAAM,oDAYzBouC,EAAepuC,EACd,uFAIDquC,EAAkBruC,EACjB,yLAMW,SAARoL,IACH4iC,EAAiBzuC,KAAKC,MAAMwuC,EAAkBhuC,EAAM,+EAEpDouC,EAAa7uC,KAAKC,MAAM4uC,EAAcpuC,EAAM,yEAC5CquC,EAAgB9uC,KAAKC,MAAM6uC,EAAiBruC,EAAM,qGAKvC,gBAARoL,IACH4iC,EAAiBzuC,KAAK,YAEtBivC,EAAuBxuC,EAAM,8CAC7BquC,EAAgB9uC,KAAKC,MAAM6uC,EAAiBG,GAE5CjsB,EAAKisB,EAAsB,SAAS1kC,GACnCge,EAAIhe,EAAM,GAAIukC,KAGfE,EAAoBvuC,EAAM,+BAC1BouC,EAAa7uC,KAAKC,MAAM4uC,EAAcG,GAGtCD,KAAiBn/B,OAAOi/B,EAAcC,GAEtC9rB,EAAKgsB,EAAmB,SAASzkC,GAChCge,EAAIhe,EAAM,GAAIwkC,MAKhBA,EAAcA,MAAkBn/B,OAAOi/B,EAAcC,GAIrDvmB,EAAI,OAAQ,WAAY,aACxBA,EAAI,OAAQ,GAAI,sDAChBA,EAAI,wBACJA,EAAI,OAAQ,eACZA,EAAI,OAAQ,+CACZA,EAAI,OAAQ,mCACZA,EAAI,QAAS,qBACbA,EAAI,SAAU,gCACdA,EAAI,OAAQ,0LAEyCwmB,GACrDxmB,EAAI,4BAA6B,GAAIwmB,GACrCxmB,EAAI,0GAA2G,GAAIumB,GACnHvmB,EAAI,aAAc,OAAQwmB,GAC1BxmB,EAAI,KAAM,sBAAuB,MACjCA,EAAI,KAAM,GAAI,MACdA,EAAI,KAAM,QAASwmB,GACnBxmB,EAAI,KAAM,GAAI,SACdA,EAAI,IAAK,sCAAuCumB,GAChDvmB,EAAI,IAAK,OAAQumB,GACjBvmB,EAAI,UAAW,gBAAiBwmB,GAChCxmB,EAAI,MAAO,kDACXA,EAAI,SAAU,wBAAyBwmB,GACvCxmB,EAAI,QAAS,yBACbA,EAAI,SAAU,wDAAyDwmB,EAAa,SACpFxmB,EAAI,QAAS,cACbA,EAAI,MAAO,OAAQwmB,EAAa,QAChCxmB,EAAI,OAAQ,wDACZA,EAAI,QAAS,SAAU,yCAAmD,SAAR1c,EAAkB,OAAS,KAC7F0c,EAAI,WAAY,OAAQ,OACxBA,EAAI,MAAO,QACXA,EAAI,oBAAqB,GAAI,MAC7BA,EAAI,KAAM,GAAI,SACdA,EAAI,KAAM,0BAA2BwmB,GACrCxmB,EAAI,KAAM,qCAAsCwmB,GAChDxmB,EAAI,OAAQ,2EAA4EwmB,GACxFxmB,EAAI,WAAY,qBAAsBwmB,EAAa,UACnDxmB,EAAI,QAAS,WAAYumB,GACzBvmB,EAAI,QAAS,0NAGbA,EAAI,SAAU,4FACL,SAAR1c,EAAkBkjC,EAAcD,GACjCvmB,EAAI,SAAU,4CAA6C,mBAC3DA,EAAI,WAAY,iBAAkB,UAClCA,EAAI,SAAU,iCACdA,EAAI,WAAY,yEAChBA,EAAI,OAAQ,aAAcwmB,EAAa,MACvCxmB,EAAI,WAAY,GAAIwmB,GAGR,SAARljC,IACH0c,EAAI,OACJA,EAAI,OAAQ,GAAIumB,EAAiB,SACjCvmB,EAAI,aAAc,GAAIwmB,GACtBxmB,EAAI,yBAA0B,GAAIumB,GAClCvmB,EAAI,SAAU,eAAgBwmB,GAC9BxmB,EAAI,QAAS,+FAC4BwmB,EAAa,gBACtDxmB,EAAI,QAAS,kFAAmFwmB,EAAa,gBAC7GxmB,EAAI,UAAW,GAAI,cACnBA,EAAI,SAAU,+BACdA,EAAI,QAAS,kCACbA,EAAI,WAAY,GAAIumB,EAAiB,UACrCvmB,EAAI,0CAA2C,GAAIwmB,GACnDxmB,EAAI,SAAU,GAAI,qBAClBA,EAAI,SAAU,GAAIwmB,EAAa,cAC/BxmB,EAAI,OAAQ,WAAYumB,GACxBvmB,EAAI,SAAU,OAAQwmB,GACtBxmB,EAAI,UAAW,uDACfA,EAAI,SAAU,gBAAiBumB,GAC/BvmB,EAAI,WAAY,YAAaumB,GAC7BvmB,EAAI,QAAS,iCAAkCumB,GAC/CvmB,EAAI,UAAW,OAAQwmB,EAAa,WACpCxmB,EAAI,SAAU,mDAIH,gBAAR1c,IACH8iC,EAAS,SAAU,sBACnBA,EAAS,QAAS,aAClBA,EAAS,SAAU,qFACnBA,EAAS,QAAS,4BAClBA,EAAS,QAAS,kBAClBA,EAAS,IAAK,iCACdA,EAAS,KAAM,SACfA,EAAS,SAAU,0EACnBA,EAAS,MAAO,4CAChBA,EAAS,SAAU,iEACnBA,EAAS,gBAAiB,mBAC1BA,EAAS,QAAS,gBAClBA,EAAS,SAAU,YACnBA,EAAS,YACTA,EAAS,yCAA0C,SACnDA,EAAS,KAAM,gBACfA,EAAS,KAAM,QACfA,EAAS,iBAAkB,WAC3BA,EAAS,MAAO,mBAChBA,EAAS,KAAM,4BACfA,EAAS,UAAW,UACpBA,EAAS,QAAS,mEAClBA,EAAS,MAAO,mCAChBA,EAAS,WAAY,mCACrBA,EAAS,QAAS,6BAClBA,EAAS,KAAM,qCACfA,EAAS,KAAM,8DACfA,EAAS,OAAQ,UACjBA,EAAS,KAAM,yEACfA,EAAS,QAAS,6BAClBA,EAAS,QAAS,6BAClBA,EAAS,OAAQ,UACjBA,EAAS,OAAQ,6CAIN,SAAR9iC,IACH8iC,EAAS,+BAAgC,aACzCA,EAAS,iBAAkB,eAC3BA,EAAS,IAAK,YACdA,EAAS,kBAAmB,eAC5BA,EAAS,SAAU,qCAOpB3rB,EAAKviB,EAAM,6BAA8B,SAAS8J,GAC7CkiB,EAAOliB,UACHkiB,GAAOliB,GAAM0F,SAAS1F,WAUxBkiB,GAAO0iB,QAAQl/B,SAASm/B,YAGxB3iB,GAAOma,OAOdsI,EAASrjC,GAAQ4gB,EAEVA,GAGR,QAAS4iB,GAAkBnqC,EAAOoqC,GACjC,GAAIphB,EAiBJ,OAfIhpB,KACHgpB,KAEoB,gBAAThpB,KACVA,GACCqqC,IAAKrqC,IAKP8d,EAAK9d,EAAO,SAASA,EAAOiO,GAC3B+a,EAAO/a,GAAO+a,EAAO/a,EAAI6V,eAAyB,OAARsmB,EAAgBlrB,EAAQlf,EAAO,QAAUigB,EAAQjgB,EAAO,WAI7FgpB,EAvTR,GAAIghB,MAAeR,KACftqB,EAAUsB,EAAMtB,QAASpB,EAAO0C,EAAM1C,KAAMgC,EAASU,EAAMV,OAAQG,EAAUO,EAAMP,QAASM,EAAUC,EAAMD,OAgUhH,OAAO,UAAS+G,GAOf,QAASgjB,GAAkBC,EAAQC,EAAeC,GACjD,GAAIzqC,GAAQsnB,EAASijB,EAiBrB,OAfKvqC,GAYJA,EAAQkf,EAAQlf,EAAO,OAAQkf,EAAQlf,EAAM8jB,cAAe,UAV5D9jB,EAAQgqC,EAASO,GAEZvqC,IACJA,EAAQkf,EAAQsrB,EAAe,IAAKtrB,EAAQsrB,EAAc1mB,cAAe,MACzE9jB,EAAQ8f,EAAO9f,EAAOyqC,GAEtBT,EAASO,GAAUvqC,IAOdA,EAqCR,QAAS0qC,GAAgB3rB,GACxB,MAAO,IAAIhK,QAAO,IAAMgK,EAAI5R,QAAQ,WAAY,OAAS,KAK1D,QAASw9B,GAAiBC,GACzB,GAAIC,GAAI7oB,EAAI8oB,EAAIC,EAAI/nC,EAAS1B,EAASqX,EAAMqyB,EAAUzgB,EAAa+R,EAAU2O,EAAUp2B,EAAYy0B,EAClG3gB,EAAQuiB,EAAY3B,EAAkB4B,EAAuBl9B,EAAKjO,EAClEorC,EAAoB,8DACpBC,EAAiB,gDACjBC,EAAoB,OAErB,IAAIV,EAUH,IARAA,EAAgBrvC,EAAMqvC,EAAe,KAEjClyB,EAAS,OACZ6wB,EAAmB7wB,EAAS,KAAK7D,WACjCs2B,EAAwBzyB,EAAS,KAAK4wB,iBAIlCuB,EAAK,EAAG7oB,EAAK4oB,EAAcjwC,OAAQkwC,EAAK7oB,EAAI6oB,IAGhD,GADA7nC,EAAUooC,EAAkBhnC,KAAKwmC,EAAcC,IAClC,CAgCZ,GA9BAliB,EAAS3lB,EAAQ,GACjBunB,EAAcvnB,EAAQ,GACtBkoC,EAAaloC,EAAQ,GACrBgoC,EAAWhoC,EAAQ,GAGnB6R,KACAy0B,KAGAhoC,GACCuT,WAAYA,EACZy0B,gBAAiBA,GAIH,MAAX3gB,IACHrnB,EAAQiqC,WAAY,GAIN,MAAX5iB,IACHrnB,EAAQkqC,aAAc,GAGJ,MAAfxoC,EAAQ,KACX1B,EAAQmqC,kBAAmB,GAIxBlC,EAAkB,CACrB,IAAKt7B,IAAOs7B,GACX10B,EAAW5G,GAAOs7B,EAAiBt7B,EAGpCq7B,GAAgBxuC,KAAKC,MAAMuuC,EAAiB6B,GAI7C,GAAIH,EAEH,IADAA,EAAWzvC,EAAMyvC,EAAU,KACtBF,EAAK,EAAGC,EAAKC,EAASrwC,OAAQmwC,EAAKC,EAAID,IAE3C,GADA9nC,EAAUqoC,EAAejnC,KAAK4mC,EAASF,IAC1B,CAeZ,GAdAnyB,KACAsyB,EAAWjoC,EAAQ,GACnBs5B,EAAWt5B,EAAQ,GAAGmK,QAAQ,MAAO,KACrCwb,EAAS3lB,EAAQ,GACjBhD,EAAQgD,EAAQ,GAGC,MAAbioC,IACH3pC,EAAQoqC,mBAAqBpqC,EAAQoqC,uBACrCpqC,EAAQoqC,mBAAmB5wC,KAAKwhC,GAChC3jB,EAAKgzB,UAAW,GAIA,MAAbV,EAAkB,OACdp2B,GAAWynB,GAClBgN,EAAgBl3B,OAAOmO,EAAQ+oB,EAAiBhN,GAAW,EAC3D,UAIG3T,IAEY,MAAXA,IACHrnB,EAAQsqC,kBAAoBtqC,EAAQsqC,sBACpCtqC,EAAQsqC,kBAAkB9wC,MAAMuK,KAAMi3B,EAAUt8B,MAAOA,IACvD2Y,EAAK+E,aAAe1d,GAIN,MAAX2oB,IACHrnB,EAAQuqC,iBAAmBvqC,EAAQuqC,qBACnCvqC,EAAQuqC,iBAAiB/wC,MAAMuK,KAAMi3B,EAAUt8B,MAAOA,IACtD2Y,EAAKmzB,YAAc9rC,GAIL,MAAX2oB,IACHhQ,EAAKozB,YAAc7sB,EAAQlf,EAAO,OAKhCsrC,EAAkBpnC,KAAKo4B,IAC1Bh7B,EAAQ0qC,kBAAoB1qC,EAAQ0qC,sBACpCrzB,EAAKqB,QAAU0wB,EAAgBpO,GAC/Bh7B,EAAQ0qC,kBAAkBlxC,KAAK6d,KAG1B9D,EAAWynB,IACfgN,EAAgBxuC,KAAKwhC,GAGtBznB,EAAWynB,GAAY3jB,GAOtB4wB,GAAmC,KAAfhf,IACxBgf,EAAmB10B,EACnBs2B,EAAwB7B,GAIrB4B,IACH5pC,EAAQ4pC,WAAa3gB,EACrB7R,EAASwyB,GAAc5pC,GAIpBgqC,EAAkBpnC,KAAKqmB,IAC1BjpB,EAAQ0Y,QAAU0wB,EAAgBngB,GAClC0hB,EAAgBnxC,KAAKwG,IAErBoX,EAAS6R,GAAejpB,GAO7B,QAAS4qC,GAAiBtB,GACzBlyB,KACAuzB,KAEAtB,EAAiBC,GAEjB9sB,EAAKquB,EAAa,SAAS7qC,EAAS+D,GACnC0F,EAAS1F,GAAQ/D,EAAQyJ,WAK3B,QAASqhC,GAAkBC,GAC1B,GAAIC,GAAsB,YAEtBD,KAEHrC,EAASuC,oBAAsBvC,EAASwC,eAAiB,KAEzD1uB,EAAKviB,EAAM8wC,EAAgB,KAAM,SAASI,GACzC,GAAIzpC,GAAUspC,EAAoBloC,KAAKqoC,GACtCC,EAAwB,MAAf1pC,EAAQ,GACjB2pC,EAAYD,EAAS,OAAS,MAC9BrnC,EAAOrC,EAAQ,EAYhB,IAVA+H,EAAS1F,GAAQ0F,EAAS4hC,GAC1BC,EAAkBvnC,GAAQsnC,EAGrBD,IACJlU,EAAiBnzB,EAAKye,kBACtB0U,EAAiBnzB,QAIbqT,EAASrT,GAAO,CACpB,GAAIwnC,GAAan0B,EAASi0B,EAE1BE,GAAa/sB,KAAW+sB,SACjBA,GAAWpB,uBACXoB,GAAWrB,YAElB9yB,EAASrT,GAAQwnC,EAIlB/uB,EAAK/S,EAAU,SAASzJ,EAASwrC,GAC5BxrC,EAAQqrC,KACX5hC,EAAS+hC,GAAWxrC,EAAUwe,KAAW/U,EAAS+hC,IAClDxrC,EAAQ+D,GAAQ/D,EAAQqrC,SAQ7B,QAASI,GAAiBC,GACzB,GAAIC,GAAkB,6BAGtBjD,GAAS1iB,EAASC,QAAU,KAExBylB,GACHlvB,EAAKviB,EAAMyxC,EAAe,KAAM,SAASP,GACxC,GAA0C31B,GAAQ6R,EAA9C3lB,EAAUiqC,EAAgB7oC,KAAKqoC,EAE/BzpC,KACH2lB,EAAS3lB,EAAQ,GAIhB8T,EADG6R,EACM5d,EAAS/H,EAAQ,IAEjB+H,EAAS/H,EAAQ,KAAOulC,eAGlCzxB,EAAS/L,EAAS/H,EAAQ,IAE1B8a,EAAKviB,EAAMyH,EAAQ,GAAI,KAAM,SAASkoB,GACtB,MAAXvC,QACI7R,GAAOoU,GAEdpU,EAAOoU,WAQb,QAASgiB,GAAe7nC,GACvB,GAA8B3K,GAA1B4G,EAAUoX,EAASrT,EAGvB,IAAI/D,EACH,MAAOA,EAKR,KADA5G,EAAIuxC,EAAgBtxC,OACbD,KAGN,GAFA4G,EAAU2qC,EAAgBvxC,GAEtB4G,EAAQ0Y,QAAQ9V,KAAKmB,GACxB,MAAO/D,GAjUV,GAAqEwmB,GAAaC,EAAeokB,EAC7FgB,EAAuBC,EAAwBC,EAAuBC,EAAaC,EACnF/U,EAAkBmN,EAAqB6H,EAAmCC,EAAsBC,EAFhGhlC,EAAOjK,KAAMia,KAAe3N,KAAekhC,KAG3CW,KAAwBe,IAwB5BrmB,GAAWA,MACX6kB,EAAchD,EAAc7hB,EAASC,QAGjCD,EAASsmB,eAAgB,IAC5BtmB,EAASumB,eAAiB,QAG3B/lB,EAAcqiB,EAAkB7iB,EAASwmB,cACzC/lB,EAAgBoiB,EAAkB7iB,EAASymB,eAAgB,OAC3DR,EAAepD,EAAkB7iB,EAAS0mB,cAAe,OAGzDb,EAAwB7C,EAAkB,sBAAuB,gEACjE8C,EAAyB9C,EAAkB,wBAAyB,mDACpE+C,EAAwB/C,EAAkB,uBAAwB,+FAElEgD,EAAchD,EAAkB,qBAAsB,iIAEtD3E,EAAsB2E,EAAkB,qBAAsB,yCAA0C+C,GACxGG,EAAoClD,EAAkB,sCAAuC,QAAS3E,GACtG8H,EAAuBnD,EAAkB,sBAAuB,iIAEhE9R,EAAmB8R,EAAkB,iBAAkB,iIAEZmD,GAC3CC,EAAwBpD,EAAkB,uBAAwB,0EAGlExsB,GAAMwJ,EAAS2mB,SAAW,kCAAkC1yC,MAAM,KAAM,SAAS8J,GAChFsoC,EAAgBtoC,GAAQ,GAAI0P,QAAO,KAAQ1P,EAAO,SAAU,QA6QxDiiB,EAASumB,eA6Cb3B,EAAiB5kB,EAASumB,iBA3C1B/vB,EAAKquB,EAAa,SAAS7qC,EAAS+D,GACnCqT,EAASrT,IACRwP,WAAYvT,EAAQuT,WACpBy0B,gBAAiBhoC,EAAQgoC,iBAG1Bv+B,EAAS1F,GAAQ/D,EAAQyJ,WAIH,SAAnBuc,EAASC,QACZzJ,EAAKviB,EAAM,iBAAkB,SAAS4iB,GACrCA,EAAO5iB,EAAM4iB,EAAM,KACnBzF,EAASyF,EAAK,IAAI+sB,WAAa/sB,EAAK,KAQtCL,EAAKviB,EAAM,qEAAsE,SAAS8J,GACrFqT,EAASrT,KACZqT,EAASrT,GAAMmmC,aAAc,KAK/B1tB,EAAKviB,EAAM,qDAAsD,SAAS8J,GACzEqT,EAASrT,GAAMkmC,WAAY,IAI5BztB,EAAKviB,EAAM,QAAS,SAAS8J,GAC5BqT,EAASrT,GAAMomC,kBAAmB,KAYpCW,EAAkB9kB,EAAS4mB,iBAC3BnB,EAAiBzlB,EAAS6mB,gBAC1BxD,EAAiBrjB,EAAS8mB,yBAG1BrB,EAAiB,yBAGbzlB,EAAS+mB,kBACZvwB,EAAKmC,EAAQqH,EAAS+mB,kBAAmB,SAASlwB,GAC7CzF,EAASyF,UACLzF,GAASyF,KAMd+uB,EAAe,SACnBvC,EAAiB,0BAalBjiC,EAAKqC,SAAWA,EAQhBrC,EAAK4f,eAAiB,WACrB,MAAOR,IASRpf,EAAK6f,iBAAmB,WACvB,MAAOR,IASRrf,EAAK4lC,gBAAkB;AACtB,MAAOf,IASR7kC,EAAK6lC,aAAe,WACnB,MAAOjB,IASR5kC,EAAK0wB,iBAAmB,WACvB,MAAOZ,IASR9vB,EAAK8lC,qBAAuB,WAC3B,MAAOf,IASR/kC,EAAK+lC,sBAAwB,WAC5B,MAAOf,IASRhlC,EAAKgmC,sBAAwB,WAC5B,MAAOrB,IASR3kC,EAAKimC,uBAAyB,WAC7B,MAAOvB,IAUR1kC,EAAK41B,oBAAsB,WAC1B,MAAOqH,IAURj9B,EAAKkmC,kCAAoC,WACxC,MAAOpB,IASR9kC,EAAKmmC,sBAAwB,WAC5B,MAAO1B,IAWRzkC,EAAKomC,mBAAqB,WACzB,MAAOnB,IAYRjlC,EAAKqmC,aAAe,SAAS1pC,EAAM6lB,GAClC,GAAIpU,GAAS/L,EAAS1F,EAEtB,UAAUyR,IAAUA,EAAOoU,KAY5BxiB,EAAKgiB,QAAU,SAASrlB,EAAMsT,GAC7B,GAAIq2B,GAAct0C,EAAG+xC,EAAOS,EAAe7nC,EAG3C,IAAIonC,EAAM,CACT,IAAI9zB,EAiBH,OAAO,CAfP,IAAI8zB,EAAK53B,WAAW8D,GACnB,OAAO,CAKR,IADAq2B,EAAevC,EAAKT,kBAGnB,IADAtxC,EAAIs0C,EAAar0C,OACVD,KACN,GAAIs0C,EAAat0C,GAAGsf,QAAQ9V,KAAKmB,GAChC,OAAO,EAUZ,OAAO,GAWRqD,EAAKwkC,eAAiBA,EAQtBxkC,EAAK+wB,kBAAoB,WACxB,MAAOmT,IAWRlkC,EAAKiiC,iBAAmBA,EAUxBjiC,EAAKwjC,iBAAmBA,EAQxBxjC,EAAK0jC,kBAAoBA,EASzB1jC,EAAKqkC,iBAAmBA,EAExBrkC,EAAKgQ,SAAWA,KA0DlB1d,EAAO,0BACN,sBACA,wBACA,sBACE,SAASi0C,EAAQta,EAAUnU,GAc7B,QAAS0uB,GAAW3nB,EAAQ1G,EAAMsuB,GACjC,GAAe/wB,GAAOpb,EAASosC,EAAaC,EAAxClmC,EAAQ,CAMZ,KAJAkmC,EAAqB9nB,EAAOmnB,wBAC5BU,EAAc,iGACdA,EAAYhlB,UAAYhM,EAAQ+wB,EAExBnsC,EAAUosC,EAAYhrC,KAAKyc,IAAQ,CAG1C,GAFAzC,EAAQgxB,EAAYhlB,UAED,MAAfpnB,EAAQ,GACXmG,QACM,KAAKnG,EAAQ,GAAI,CACvB,GAAIA,EAAQ,IAAMqsC,GACjB,QAGDlmC,KAGD,GAAc,IAAVA,EACH,MAIF,MAAOiV,GAWR,QAASkxB,GAAUhoB,EAAUC,GAG5B,QAASgoB,MAFT,GAAI7mC,GAAOjK,IAIX6oB,GAAWA,MACX5e,EAAK6e,OAASA,EAASA,GAAU,GAAI0nB,GAEjC3nB,EAASkoB,oBAAqB,IACjCloB,EAASkoB,kBAAmB,GAI7B1xB,EAAK,0CAA0CviB,MAAM,KAAM,SAAS8J,GAC/DA,IACHqD,EAAKrD,GAAQiiB,EAASjiB,IAASkqC,KAYjC7mC,EAAK+f,MAAQ,SAAS5H,GASrB,QAAS4uB,GAAcpqC,GACtB,GAAI1I,GAAKjC,CAIT,KADAiC,EAAM+yC,EAAM/0C,OACLgC,KACF+yC,EAAM/yC,GAAK0I,OAASA,IAMzB,GAAI1I,GAAO,EAAG,CAEb,IAAKjC,EAAIg1C,EAAM/0C,OAAS,EAAGD,GAAKiC,EAAKjC,IACpC2K,EAAOqqC,EAAMh1C,GAET2K,EAAKsqC,OACRjnC,EAAKknC,IAAIvqC,EAAKA,KAKhBqqC,GAAM/0C,OAASgC,GAIjB,QAASkzC,GAAeprC,EAAOY,EAAMrF,EAAO8vC,EAAMC,GACjD,GAAIC,GAAUt1C,EAAGu1C,EAAa,qBAM9B,IAJA5qC,EAAOA,EAAK2H,cACZhN,EAAQqF,IAAQ6qC,GAAe7qC,EAAOikB,EAAOtpB,GAAS8vC,GAAQC,GAAQ,IAGlEI,IAAaC,GAA+C,IAA1B/qC,EAAKhB,QAAQ,SAAgB,CAIlE,GAHA2rC,EAAWK,EAAmBhrC,IAGzB2qC,GAAYM,EAAwB,CAExC,IADA51C,EAAI41C,EAAuB31C,OACpBD,MACNs1C,EAAWM,EAAuB51C,IAC9Bs1C,EAASh2B,QAAQ9V,KAAKmB,MAMvB3K,SACHs1C,EAAW,MAKb,IAAKA,EACJ,MAID,IAAIA,EAASjE,eAAiB/rC,IAASgwC,GAASjE,aAC/C,OAKF,GAAIwE,EAAiBlrC,KAAUiiB,EAASsC,kBAAmB,CAC1D,GAAI4mB,GAAMxwC,EAAMmN,QAAQ8iC,EAAY,GAEpC,KAECO,EAAMC,mBAAmBD,GACxB,MAAOtwC,GAERswC,EAAME,SAASF,GAGhB,GAAIG,EAAgBzsC,KAAKssC,GACxB,MAGD,KAAKlpB,EAASspB,sBAAwBC,EAAc3sC,KAAKssC,KAAS,iBAAiBtsC,KAAKssC,GACvF,OAKFM,EAAS1/B,IAAI/L,GAAQrF,EACrB8wC,EAASh2C,MACRuK,KAAMA,EACNrF,MAAOA,IAjGT,GAAiBgD,GAAoBhD,EAAO+wC,EAAuBD,EAAUp2C,EAAGwgB,EAAM7V,EAClF+qC,EAAmBY,EAAwB3B,EAAoBa,EAAce,EAC7Ed,EAAUe,EAAaC,EAAgBx4B,EAAMy4B,EAAcf,EAAoBC,EAC/E5E,EAAoBE,EAAmBC,EACvCwF,EAAuBC,EAAalC,EAAalR,EAAYyP,EAAiBpR,EACpDgV,EAL1B7oC,EAAOjK,KAAe2f,EAAQ,EAAqBsxB,KAIsCxY,EAAU,EACnG5N,EAASqL,EAASrL,OAAwBinB,EAAmB/vB,EAAMtB,QAAQ,8CAC3EyxB,EAAkB,4BAA6BE,EAAgB,SAoHnE,KApBAzB,EAAc,GAAIr6B,QAAO,mPAOpB,KAELmpB,EAAa,iFAGbmR,EAAqB9nB,EAAOmnB,wBAC5B4C,EAAchqB,EAASkqB,uBAAyBjqB,EAAOonB,yBACvDuB,EAAe3oB,EAAOgnB,eACtB4B,EAAW7oB,EAAS6oB,SACpBa,EAAyB1pB,EAASmqB,iBAClCF,EAAiBjqB,EAASkoB,iBAC1B7B,EAAkBpmB,EAAOunB,qBAEjB9rC,EAAUosC,EAAYhrC,KAAKyc,IAAQ,CAM1C,GAJIzC,EAAQpb,EAAQob,OACnB1V,EAAKwS,KAAKoO,EAAOzI,EAAKsJ,OAAO/L,EAAOpb,EAAQob,MAAQA,KAGhDpe,EAAQgD,EAAQ,GACpBhD,EAAQA,EAAMgN,cAGU,MAApBhN,EAAMojB,OAAO,KAChBpjB,EAAQA,EAAMmqB,OAAO,IAGtBslB,EAAczvC,OACR,IAAKA,EAAQgD,EAAQ,GAAK,CAgBhC,GAfAhD,EAAQA,EAAMgN,cAGU,MAApBhN,EAAMojB,OAAO,KAChBpjB,EAAQA,EAAMmqB,OAAO,IAGtB8mB,EAAejxC,IAASqvC,GAGpBkC,GAAkBD,EAAYtxC,IAAU0vC,EAAM/0C,OAAS,GAAK+0C,EAAMA,EAAM/0C,OAAS,GAAG0K,OAASrF,GAChGyvC,EAAczvC,IAIVmwC,IAAae,EAAc3pB,EAAO2lB,eAAeltC,IAAS,CA4B9D,GA3BAmxC,GAAiB,EAGbhB,IACHE,EAAqBa,EAAYr8B,WACjCy7B,EAAyBY,EAAYlF,oBAIjCoF,EAAepuC,EAAQ,KAC3BotC,EAAoBgB,EAAa/sC,QAAQ,sBAGrC+rC,GAAqBY,IACxBG,GAAiB,GAGlBL,KACAA,EAAS1/B,OAETggC,EAAajkC,QAAQ+wB,EAAY2R,KAEjCiB,KACAA,EAAS1/B,QAIN++B,IAAaC,EAAmB,CAYnC,GAXA1E,EAAqBwF,EAAYxF,mBACjCE,EAAoBsF,EAAYtF,kBAChCC,EAAmBqF,EAAYrF,iBAC/BwF,EAAwBH,EAAYzF,iBAGhC4F,IAA0BP,EAASn2C,SACtCw2C,GAAiB,GAIdtF,EAEH,IADAnxC,EAAImxC,EAAiBlxC,OACdD,KACNie,EAAOkzB,EAAiBnxC,GACxB2K,EAAOsT,EAAKtT,KACZk3B,EAAY5jB,EAAK3Y,MAEC,WAAdu8B,IACHA,EAAY,OAASrF,KAGtB4Z,EAAS1/B,IAAI/L,GAAQk3B,EACrBuU,EAASh2C,MAAMuK,KAAMA,EAAMrF,MAAOu8B,GAKpC,IAAIqP,EAEH,IADAlxC,EAAIkxC,EAAkBjxC,OACfD,KACNie,EAAOizB,EAAkBlxC,GACzB2K,EAAOsT,EAAKtT,KAENA,IAAQyrC,GAAS1/B,MACtBmrB,EAAY5jB,EAAK3Y,MAEC,WAAdu8B,IACHA,EAAY,OAASrF,KAGtB4Z,EAAS1/B,IAAI/L,GAAQk3B,EACrBuU,EAASh2C,MAAMuK,KAAMA,EAAMrF,MAAOu8B,IAMrC,IAAImP,EAAoB,CAEvB,IADAhxC,EAAIgxC,EAAmB/wC,OAChBD,OACFgxC,EAAmBhxC,IAAMo2C,GAAS1/B,OAMnC1W,SACHy2C,GAAiB,GAKnB,GAAKx4B,EAAOm4B,EAAS1/B,IAAI,kBAAoB,CAC5C,GAAa,QAATuH,EAAgB,CACnByF,EAAQ8wB,EAAW3nB,EAAQ1G,EAAMuuB,EAAYhlB,WAC7CglB,EAAYhlB,UAAYhM,CACxB,UAGD+yB,GAAiB,GAIfA,GACHzoC,EAAKgS,MAAM1a,EAAO8wC,EAAUG,OAG7BE,IAAiB,CAIlB,IAAKJ,EAAYpD,EAAgB3tC,GAAS,CACzC+wC,EAAU3mB,UAAYhM,EAAQpb,EAAQob,MAAQpb,EAAQ,GAAGrI,QAEpDqI,EAAU+tC,EAAU3sC,KAAKyc,KACzBswB,IACHj2B,EAAO2F,EAAKsJ,OAAO/L,EAAOpb,EAAQob,MAAQA,IAG3CA,EAAQpb,EAAQob,MAAQpb,EAAQ,GAAGrI,SAEnCugB,EAAO2F,EAAKsJ,OAAO/L,GACnBA,EAAQyC,EAAKlmB,QAGVw2C,IACCj2B,EAAKvgB,OAAS,GACjB+N,EAAKwS,KAAKA,GAAM,GAGjBxS,EAAKknC,IAAI5vC,IAGVovC,EAAYhlB,UAAYhM,CACxB,UAII6yB,IACCG,GAAgBA,EAAa/sC,QAAQ,MAAQ+sC,EAAaz2C,OAAS,EAE7Dw2C,GACVzoC,EAAKknC,IAAI5vC,GAFT0vC,EAAM50C,MAAMuK,KAAMrF,EAAO2vC,MAAOwB,UAKvBnxC,EAAQgD,EAAQ,KAEH,MAApBhD,EAAMojB,OAAO,KAChBpjB,EAAQ,IAAMA,GAGVsnB,EAASoqB,4BAAqD,QAAvB1xC,EAAMmqB,OAAO,EAAG,KAC3DnqB,EAAQ,IAAMA,GAGf0I,EAAKipC,QAAQ3xC,KACFA,EAAQgD,EAAQ,IAC3B0F,EAAKkpC,MAAM5xC,IACAA,EAAQgD,EAAQ,IAC3B0F,EAAKmpC,QAAQ7xC,IACFA,EAAQgD,EAAQ,KAC3B0F,EAAKopC,GAAG9xC,EAAOgD,EAAQ,GAGxBob,GAAQpb,EAAQob,MAAQpb,EAAQ,GAAGrI,OASpC,IALIyjB,EAAQyC,EAAKlmB,QAChB+N,EAAKwS,KAAKoO,EAAOzI,EAAKsJ,OAAO/L,KAIzB1jB,EAAIg1C,EAAM/0C,OAAS,EAAGD,GAAK,EAAGA,IAClCsF,EAAQ0vC,EAAMh1C,GAEVsF,EAAM2vC,OACTjnC,EAAKknC,IAAI5vC,EAAMqF,OAvZnB,GAAIyY,GAAO0C,EAAM1C,IA+ZjB,OAFAwxB,GAAUJ,WAAaA,EAEhBI,IA2BRt0C,EAAO,0BACN,oBACA,sBACA,yBACA,sBACE,SAASotC,EAAM6G,EAAQK,EAAW9uB,GACpC,GAAItB,GAAUsB,EAAMtB,QAASpB,EAAO0C,EAAM1C,KAAMmC,EAAUO,EAAMP,QAASH,EAASU,EAAMV,MAUxF,OAAO,UAASwH,EAAUC,GAQzB,QAASwqB,GAAmBzuB,GAC3B,GAAI+lB,GAAI1yB,EAAMG,EAAQuP,EAAS2rB,EAAWC,EAAaC,EAAUC,EAAWz3C,EACxE03C,EAAkBC,EAAsBC,EAAmB3E,EAAiBxrB,EAASowB,CAOzF,KALAF,EAAuBnzB,EAAQ,oCAC/BkzB,EAAmB7qB,EAAO+W,sBAC1BgU,EAAoB/qB,EAAOinB,uBAC3Bb,EAAkBpmB,EAAOunB,qBAEpBzF,EAAK,EAAGA,EAAK/lB,EAAM3oB,OAAQ0uC,IAI/B,GAHA1yB,EAAO2M,EAAM+lB,GAGR1yB,EAAKG,SAAUH,EAAK67B,MAMzB,GAAIF,EAAkB37B,EAAKtR,OAA6B,MAApBsR,EAAKG,OAAOzR,KAAhD,CAGC,IADA8c,EAAUxL,EAAK2P,KACRnE,GACFmwB,EAAkBnwB,EAAQ9c,OAC7B8c,EAAQ9c,KAAO,KACf8c,EAAQqwB,OAAQ,EAChB77B,EAAKG,OAAO8xB,OAAOzmB,EAASxL,EAAKG,QAKlCqL,EAAUA,EAAQmE,IAInB3P,GAAKwO,OAAOxO,OAhBb,CAsBA,IADA0P,GAAW1P,GACNG,EAASH,EAAKG,OAAQA,IAAWyQ,EAAOwnB,aAAaj4B,EAAOzR,KAAMsR,EAAKtR,QAC1EgtC,EAAqBv7B,EAAOzR,MAAOyR,EAASA,EAAOA,OACpDuP,EAAQvrB,KAAKgc,EAId,IAAIA,GAAUuP,EAAQ1rB,OAAS,EAAG,CAQjC,IANA0rB,EAAQjF,UAGR4wB,EAAYC,EAAcvpC,EAAK+pC,WAAWpsB,EAAQ,GAAGjB,SAGhD1qB,EAAI,EAAGA,EAAI2rB,EAAQ1rB,OAAS,EAAGD,IAAK,CAQxC,IAPI6sB,EAAOwnB,aAAakD,EAAY5sC,KAAMghB,EAAQ3rB,GAAG2K,OACpD6sC,EAAWxpC,EAAK+pC,WAAWpsB,EAAQ3rB,GAAG0qB,SACtC6sB,EAAY1tB,OAAO2tB,IAEnBA,EAAWD,EAGPE,EAAY9rB,EAAQ3rB,GAAG2e,WAAY84B,GAAaA,GAAa9rB,EAAQ3rB,EAAI,IAC7E63C,EAAWJ,EAAU7rB,KACrB4rB,EAAS3tB,OAAO4tB,GAChBA,EAAYI,CAGbN,GAAcC,EAGVF,EAAU7T,QAAQiU,GAItBt7B,EAAO8xB,OAAOjyB,EAAM0P,EAAQ,IAAI,IAHhCvP,EAAO8xB,OAAOoJ,EAAW3rB,EAAQ,IAAI,GACrCvP,EAAO8xB,OAAOjyB,EAAMq7B,IAMrBl7B,EAASuP,EAAQ,IACbvP,EAAOqnB,QAAQiU,IAAqBt7B,EAAOuC,aAAevC,EAAO8D,WAAwC,OAA3B9D,EAAOuC,WAAWhU,OACnGyR,EAAOqF,QAAQmI,aAEV,IAAI3N,EAAKG,OAAQ,CAEvB,GAAkB,OAAdH,EAAKtR,KAAe,CAEvB,GADA8c,EAAUxL,EAAK4P,KACXpE,IAA6B,OAAjBA,EAAQ9c,MAAkC,OAAjB8c,EAAQ9c,MAAgB,CAChE8c,EAAQoC,OAAO5N,EACf,UAID,GADAwL,EAAUxL,EAAK2P,KACXnE,IAA6B,OAAjBA,EAAQ9c,MAAkC,OAAjB8c,EAAQ9c,MAAgB,CAChE8c,EAAQymB,OAAOjyB,EAAMwL,EAAQ9I,YAAY,EACzC,UAGD1C,EAAK8K,KAAK/Y,EAAK+pC,WAAW,GAAIrK,GAAK,KAAM,IACzC,UAIG7gB,EAAOwnB,aAAap4B,EAAKG,OAAOzR,KAAM,QAAUkiB,EAAOwnB,aAAa,MAAOp4B,EAAKtR,MACnFsR,EAAK8K,KAAK/Y,EAAK+pC,WAAW,GAAIrK,GAAK,MAAO,KAGtCuF,EAAgBh3B,EAAKtR,MACxBsR,EAAKwF,QAAQmI,SAEb3N,EAAKwO,WAtHV,GAAIzc,GAAOjK,KAAMi0C,KAAkBC,KAAuBC,KAAmBC,IAE7EvrB,GAAWA,MACXA,EAAS6oB,WAAW,YAAc7oB,KAAWA,EAAS6oB,SACtD7oB,EAASwrB,UAAYxrB,EAASwrB,WAAa,OAC3CpqC,EAAK6e,OAASA,EAASA,GAAU,GAAI0nB,GA+HrCvmC,EAAK+pC,WAAa,SAAS97B,GAC1B,GAAIjc,GAAG2K,EAAM0tC,CAGT1tC,KAAQqtC,KACXK,EAAOH,EAAavtC,GAEhB0tC,EACHA,EAAKj4C,KAAK6b,GAEVi8B,EAAavtC,IAASsR,IAKxBjc,EAAIi4C,EAAiBh4C,MACrB,MAAOD,KACN2K,EAAOstC,EAAiBj4C,GAAG2K,KAEvBA,IAAQsR,GAAK9B,WAAWzD,MAC3B2hC,EAAOF,EAAkBxtC,GAErB0tC,EACHA,EAAKj4C,KAAK6b,GAEVk8B,EAAkBxtC,IAASsR,GAK9B,OAAOA,IAiBRjO,EAAKsqC,cAAgB,SAAS3tC,EAAM9K,GACnCujB,EAAKmC,EAAQ5a,GAAO,SAASA,GAC5B,GAAI0tC,GAAOL,EAAYrtC,EAElB0tC,KACJL,EAAYrtC,GAAQ0tC,MAGrBA,EAAKj4C,KAAKP,MAkBZmO,EAAKuqC,mBAAqB,SAAS5tC,EAAM9K,GACxCujB,EAAKmC,EAAQ5a,GAAO,SAASA,GAC5B,GAAI3K,EAEJ,KAAKA,EAAI,EAAGA,EAAIi4C,EAAiBh4C,OAAQD,IACxC,GAAIi4C,EAAiBj4C,GAAG2K,OAASA,EAEhC,WADAstC,GAAiBj4C,GAAGk7B,UAAU96B,KAAKP,EAKrCo4C,GAAiB73C,MAAMuK,KAAMA,EAAMuwB,WAAYr7B,QAcjDmO,EAAK+f,MAAQ,SAAS5H,EAAMhgB,GAqB3B,QAASqyC,KAKR,QAASp0B,GAAKq0B,GACTA,IACHx8B,EAAOw8B,EAAc95B,WACjB1C,GAAqB,GAAbA,EAAKhQ,OAChBgQ,EAAK3W,MAAQ2W,EAAK3W,MAAMmN,QAAQimC,EAAuB,KAGxDz8B,EAAOw8B,EAAcv4B,UACjBjE,GAAqB,GAAbA,EAAKhQ,OAChBgQ,EAAK3W,MAAQ2W,EAAK3W,MAAMmN,QAAQkmC,EAAqB,MAbxD,GAAgC/sB,GAAM6sB,EAAlCx8B,EAAOkU,EAASxR,UAmBpB,IAAKkO,EAAOwnB,aAAalkB,EAASxlB,KAAMiuC,EAActmC,eAAtD,CAIA,KAAO2J,GACN2P,EAAO3P,EAAK2P,KAEK,GAAb3P,EAAKhQ,MAA2B,GAAbgQ,EAAKhQ,MAA2B,MAAdgQ,EAAKtR,OAC5CkuC,EAAc58B,EAAKtR,QAAUsR,EAAKgC,KAAK,iBACnCw6B,EAOJA,EAAc5uB,OAAO5N,IALrBw8B,EAAgBK,EAAWF,EAAe,GAC1CH,EAAcx6B,KAAK2O,EAASmsB,yBAC5B5oB,EAAS+d,OAAOuK,EAAex8B,GAC/Bw8B,EAAc5uB,OAAO5N,KAKtBmI,EAAKq0B,GACLA,EAAgB,MAGjBx8B,EAAO2P,CAGRxH,GAAKq0B,IAGN,QAASK,GAAWnuC,EAAMsB,GACzB,GAAiCosC,GAA7Bp8B,EAAO,GAAIyxB,GAAK/iC,EAAMsB,EAY1B,OAVItB,KAAQqtC,KACXK,EAAOH,EAAavtC,GAEhB0tC,EACHA,EAAKj4C,KAAK6b,GAEVi8B,EAAavtC,IAASsR,IAIjBA,EAGR,QAAS+8B,GAAuB/8B,GAC/B,GAAIgtB,GAAUgQ,EAAcC,EAASzxB,EAASoxB,EAAgBhsB,EAAO6R,kBAErE,KAAKuK,EAAWhtB,EAAK4P,KAAMod,GAA8B,IAAlBA,EAASh9B,MAAa,CAI5D,GAHAitC,EAAUjQ,EAAS3jC,MAAMmN,QAAQkmC,EAAqB,IAGlDO,EAAQj5C,OAAS,EAEpB,YADAgpC,EAAS3jC,MAAQ4zC,EAQlB,IAJAD,EAAehQ,EAASrd,KAIN,CACjB,GAAyB,GAArBqtB,EAAahtC,MAAagtC,EAAa3zC,MAAMrF,OAAQ,CACxDgpC,EAAWA,EAASpd,IACpB,UAGD,IAAKgtB,EAAcI,EAAatuC,OAA8B,UAArBsuC,EAAatuC,MAAyC,SAArBsuC,EAAatuC,KAAiB,CACvGs+B,EAAWA,EAASpd,IACpB,WAIFpE,EAAUwhB,EAASpd,KACnBod,EAASrf,SACTqf,EAAWxhB,GAIb,QAAS0xB,GAAsBp8B,GAC9B,GAAIpS,GAAMyuC,IAEV,KAAKzuC,IAAQoS,GACC,OAATpS,GAAyB,KAARA,IACpByuC,EAAOzuC,GAAQoS,EAAMpS,GAIvB,OAAOyuC,GAhIR,GAAIC,GAAQlpB,EAAUlU,EAAM2M,EAAO5oB,EAAGqO,EAAGvN,EAAIw4C,EAAIjB,EAAM1tC,EAAM8qC,EACzDoD,EAAeH,EAA6Ca,EAC5DZ,EAAqBa,EAAqBC,EAAuBC,EACjErpC,EAAUqnC,EAAkBkB,EAFUe,IAwW1C,IApWAxzC,EAAOA,MACP+xC,KACAC,KACAU,EAAgBzzB,EAAOZ,EAAQ,gDAAiDqI,EAAO6R,oBACvFgZ,EAAmB7qB,EAAO+W,sBAC1BvzB,EAAWwc,EAAOxc,SAClBolC,EAAW7oB,EAAS6oB,SACpBmD,EAAgB,qBAAuBzyC,GAAOA,EAAKyzC,kBAAoBhtB,EAASgtB,kBAEhFF,EAAqB7sB,EAAOsnB,wBAC5BuE,EAAwB,cACxBC,EAAsB,cACtBa,EAAsB,cACtBC,EAAwB,eAiHxBJ,EAAS,GAAIzE,IACZa,SAAUA,EACVvmB,kBAAmBtC,EAASsC,kBAC5B8nB,2BAA4BpqB,EAASoqB,2BAGrCF,sBAAuBqC,EAAsBtsB,EAAOonB,0BAEpDiD,MAAO,SAAS12B,GACfvE,EAAK4N,OAAOivB,EAAW,SAAU,IAAIxzC,MAAQkb,GAG9CA,KAAM,SAASA,EAAMq5B,GACpB,GAAI5Q,EAGCsQ,KACJ/4B,EAAOA,EAAK/N,QAAQ+mC,EAAqB,KAErCv9B,EAAKiE,WAAa24B,EAAc58B,EAAKiE,UAAUvV,QAClD6V,EAAOA,EAAK/N,QAAQimC,EAAuB,MAKzB,IAAhBl4B,EAAKvgB,SACRgpC,EAAW6P,EAAW,QAAS,GAC/B7P,EAAS4Q,MAAQA,EACjB59B,EAAK4N,OAAOof,GAAU3jC,MAAQkb,IAIhCy2B,QAAS,SAASz2B,GACjBvE,EAAK4N,OAAOivB,EAAW,WAAY,IAAIxzC,MAAQkb,GAGhD42B,GAAI,SAASzsC,EAAM6V,GAClBvE,EAAK4N,OAAOivB,EAAWnuC,EAAM,IAAIrF,MAAQkb,EACzCw4B,EAAuB/8B,IAGxBk7B,QAAS,SAAS32B,GACjB,GAAI+V,EAEJA,GAAUta,EAAK4N,OAAOivB,EAAW,WAAY,KAC7CviB,EAAQjxB,MAAQkb,EAChBw4B,EAAuB/8B,IAGxB+D,MAAO,SAASrV,EAAMuJ,EAAOuN,GAC5B,GAAI8U,GAASujB,EAAgBtD,EAAa5U,EAAUxlB,CAGpD,IADAo6B,EAAcf,EAAW5oB,EAAO2lB,eAAe7nC,MAC9B,CAehB,IAdA4rB,EAAUuiB,EAAWtC,EAAYhG,YAAc7lC,EAAM,GACrD4rB,EAAQpc,WAAajG,EACrBqiB,EAAQ+X,WAAa7sB,EAErBxF,EAAK4N,OAAO0M,GAIZna,EAAS/L,EAAS4L,EAAKtR,MACnByR,GAAU/L,EAASkmB,EAAQ5rB,QAAUyR,EAAOma,EAAQ5rB,OACvDgvC,EAAgBv5C,KAAKm2B,GAGtBujB,EAAiB7B,EAAiBh4C,OAC3B65C,KACNlY,EAAWqW,EAAiB6B,GAAgBnvC,KAExCi3B,IAAY1tB,GAAMwC,MACrB2hC,EAAOF,EAAkBvW,GAErByW,EACHA,EAAKj4C,KAAKm2B,GAEV4hB,EAAkBvW,IAAarL,GAM9BsiB,GAAcluC,IACjBquC,EAAuBziB,GAInB9U,IACJxF,EAAOsa,IAIHgjB,GAAkCG,EAAmB/uC,KACzD4uC,GAAiC,KAKpCrE,IAAK,SAASvqC,GACb,GAAIs+B,GAAUuN,EAAah2B,EAAMiH,EAAS+vB,CAG1C,IADAhB,EAAcf,EAAW5oB,EAAO2lB,eAAe7nC,MAC9B,CAChB,GAAIkuC,EAAcluC,KACZ4uC,EAAgC,CAGpC,GADAtQ,EAAWhtB,EAAK0C,WACZsqB,GAA8B,IAAlBA,EAASh9B,KAIxB,GAHAuU,EAAOyoB,EAAS3jC,MAAMmN,QAAQimC,EAAuB,IAGjDl4B,EAAKvgB,OAAS,EACjBgpC,EAAS3jC,MAAQkb,EACjByoB,EAAWA,EAASrd,SAOpB,KALAnE,EAAUwhB,EAASrd,KACnBqd,EAASrf,SACTqf,EAAWxhB,EAGJwhB,GAA8B,IAAlBA,EAASh9B,MAC3BuU,EAAOyoB,EAAS3jC,MAChBmiB,EAAUwhB,EAASrd,MAEC,IAAhBpL,EAAKvgB,QAAgBw5C,EAAsBjwC,KAAKgX,MACnDyoB,EAASrf,SACTqf,EAAWxhB,GAGZwhB,EAAWxhB,CAOd,IADAwhB,EAAWhtB,EAAKiE,UACZ+oB,GAA8B,IAAlBA,EAASh9B,KAIxB,GAHAuU,EAAOyoB,EAAS3jC,MAAMmN,QAAQkmC,EAAqB,IAG/Cn4B,EAAKvgB,OAAS,EACjBgpC,EAAS3jC,MAAQkb,EACjByoB,EAAWA,EAASpd,SAOpB,KALApE,EAAUwhB,EAASpd,KACnBod,EAASrf,SACTqf,EAAWxhB,EAGJwhB,GAA8B,IAAlBA,EAASh9B,MAC3BuU,EAAOyoB,EAAS3jC,MAChBmiB,EAAUwhB,EAASpd,MAEC,IAAhBrL,EAAKvgB,QAAgBw5C,EAAsBjwC,KAAKgX,MACnDyoB,EAASrf,SACTqf,EAAWxhB,GAGZwhB,EAAWxhB,EAyBhB,GALI8xB,GAAkCG,EAAmB/uC,KACxD4uC,GAAiC,IAI9B/C,EAAY1F,aAAe0F,EAAY3F,YACtC50B,EAAKwnB,QAAQiU,GAChB,GAAIlB,EAAY3F,UACf50B,EAAKwF,QAAQoI,OAAO,GAAI6jB,GAAK,QAAS,MAAMpoC,MAAQ,QAGpD,KAAK2W,EAAK9B,WAAWzD,IAAI/L,OAASsR,EAAK9B,WAAWzD,IAAInW,GAUrD,MATAi3C,GAAWv7B,EAAKG,OAEZy8B,EAAc58B,EAAKtR,MACtBsR,EAAKwF,QAAQmI,SAEb3N,EAAKwO,cAGNxO,EAAOu7B,EAOXv7B,GAAOA,EAAKG,UAGZyQ,GAEHsD,EAAWlU,EAAO,GAAIyxB,GAAKvnC,EAAK+K,SAAW0b,EAASwrB,UAAW,IAE/DiB,EAAOtrB,MAAM5H,GAGTsvB,GAAYkE,EAAgB15C,SAC1BkG,EAAK+K,QAGT/K,EAAK4zC,SAAU,EAFf1C,EAAmBsC,IAOjBf,IAAmC,QAAjBzoB,EAASxlB,MAAkBxE,EAAK6zC,gBACrDxB,KAIIryC,EAAK4zC,QAAS,CAElB,IAAKpvC,IAAQutC,GAAc,CAM1B,IALAG,EAAOL,EAAYrtC,GACnBie,EAAQsvB,EAAavtC,GAGrB7J,EAAK8nB,EAAM3oB,OACJa,KACD8nB,EAAM9nB,GAAIsb,QACdwM,EAAMlR,OAAO5W,EAAI,EAInB,KAAKd,EAAI,EAAGqO,EAAIgqC,EAAKp4C,OAAQD,EAAIqO,EAAGrO,IACnCq4C,EAAKr4C,GAAG4oB,EAAOje,EAAMxE,GAKvB,IAAKnG,EAAI,EAAGqO,EAAI4pC,EAAiBh4C,OAAQD,EAAIqO,EAAGrO,IAG/C,GAFAq4C,EAAOJ,EAAiBj4C,GAEpBq4C,EAAK1tC,OAAQwtC,GAAmB,CAKnC,IAJAvvB,EAAQuvB,EAAkBE,EAAK1tC,MAG/B7J,EAAK8nB,EAAM3oB,OACJa,KACD8nB,EAAM9nB,GAAIsb,QACdwM,EAAMlR,OAAO5W,EAAI,EAInB,KAAKA,EAAK,EAAGw4C,EAAKjB,EAAKnd,UAAUj7B,OAAQa,EAAKw4C,EAAIx4C,IACjDu3C,EAAKnd,UAAUp6B,GAAI8nB,EAAOyvB,EAAK1tC,KAAMxE,IAMzC,MAAOgqB,IAMJvD,EAASqtB,qBACZjsC,EAAKsqC,cAAc,KAAM,SAAS1vB,GACjC,GAAI5oB,GAAqBic,EAC4BG,EAAQ6K,EAAY4E,EAAMquB,EAC3E1D,EAAavN,EAFV56B,EAAIua,EAAM3oB,OAAc44C,EAAgBzzB,KAAWyH,EAAO6R,oBAC7DgZ,EAAmB7qB,EAAO+W,qBAO9B,KAHAiV,EAAcnxC,KAAO,EAGhB1H,EAAI,EAAGA,EAAIqO,EAAGrO,IAIlB,GAHAic,EAAO2M,EAAM5oB,GACboc,EAASH,EAAKG,OAEVy8B,EAAc58B,EAAKG,OAAOzR,OAASsR,IAASG,EAAO8D,UAAW,CAIjE,IADA2L,EAAO5P,EAAK4P,KACLA,GAAM,CAIZ,GAHAquB,EAAWruB,EAAKlhB,KAGC,SAAbuvC,GAAsD,aAA/BruB,EAAK5N,KAAK,iBAAiC,CAErE,GAAiB,OAAbi8B,EACH,KAID,IAAiB,OAAbA,EAAmB,CACtBj+B,EAAO,IACP,QAIF4P,EAAOA,EAAKA,KAGT5P,IACHA,EAAK2N,SAGDxN,EAAOqnB,QAAQiU,KAClBlB,EAAc3pB,EAAO2lB,eAAep2B,EAAOzR,MAGvC6rC,IACCA,EAAY1F,YACf10B,EAAOwN,SACG4sB,EAAY3F,YACtBz0B,EAAOqF,QAAQoI,OAAO,GAAI6jB,GAAK,QAAS,IAAIpoC,MAAQ,YAKlD,CAIN,IADA2hB,EAAahL,EACNG,GAAUA,EAAOuC,aAAesI,GAAc7K,EAAO8D,YAAc+G,IACzEA,EAAa7K,GAETy8B,EAAcz8B,EAAOzR,QAIzByR,EAASA,EAAOA,MAGb6K,KAAe7K,IAClB6sB,EAAW,GAAIyE,GAAK,QAAS,GAC7BzE,EAAS3jC,MAAQ,IACjB2W,EAAKxJ,QAAQw2B,OAQbrc,EAASutB,4BACbnsC,EAAKuqC,mBAAmB,UAAW,SAAS3vB,GAG3C,IAFA,GAAsBnB,GAASqO,EAAa1Z,EAAQH,EAAhDjc,EAAI4oB,EAAM3oB,OAEPD,KAEN,GADAic,EAAO2M,EAAM5oB,GACK,MAAdic,EAAKtR,MAAgBsR,EAAK0C,aAAe1C,EAAKgC,KAAK,QAAS,CAC/D7B,EAASH,EAAKG,OAGdqL,EAAUxL,EAAKiE,SACf,GACC4V,GAAcrO,EAAQoE,KACtBzP,EAAO8xB,OAAOzmB,EAASxL,GACvBwL,EAAUqO,QACFrO,MAMTmF,EAAS6oB,UAAY5oB,EAAO+mB,mBAC/B5lC,EAAKuqC,mBAAmB,QAAS,SAAS3vB,GAIzC,IAHA,GAAsB3M,GAAMm+B,EAAWtqC,EAAIuM,EAAWg+B,EACTC,EAAiBrF,EAD1Dj1C,EAAI4oB,EAAM3oB,OACV4yC,EAAehmB,EAAO+mB,kBAEnB5zC,KAAK,CAKX,IAJAic,EAAO2M,EAAM5oB,GACbo6C,EAAYn+B,EAAKgC,KAAK,SAASpd,MAAM,KACrCw5C,EAAa,GAERvqC,EAAK,EAAGA,EAAKsqC,EAAUn6C,OAAQ6P,IACnCuM,EAAY+9B,EAAUtqC,GACtBmlC,GAAQ,EAERqF,EAAkBzH,EAAa,KAC3ByH,GAAmBA,EAAgBj+B,KACtC44B,GAAQ,GAGTqF,EAAkBzH,EAAa52B,EAAKtR,OAC/BsqC,GAASqF,GAAmBA,EAAgBj+B,KAChD44B,GAAQ,GAGLA,IACCoF,IACHA,GAAc,KAGfA,GAAch+B,EAIXg+B,GAAWp6C,SACfo6C,EAAa,MAGdp+B,EAAKgC,KAAK,QAASo8B,SA+BxB/5C,EAAO,uBACN,wBACA,sBACE,SAAS25B,EAAUnU,GACrB,GAAItB,GAAUsB,EAAMtB,OASpB,OAAO,UAASoI,GACf,GAAe2tB,GAAQC,EAAcC,EAAa/rB,EAAQgsB,EAAtDv0B,IASJ,OAPAyG,GAAWA,MACX2tB,EAAS3tB,EAAS2tB,OAClBC,EAAeh2B,EAAQoI,EAAS+tB,eAAiB,IACjDF,EAAcj2B,EAAQoI,EAASguB,cAAgB,IAC/ClsB,EAASuL,EAASO,cAAc5N,EAASiuB,iBAAmB,MAAOjuB,EAAS2N,UAC5EmgB,EAAwC,QAA3B9tB,EAASkuB,gBAWrB96B,MAAO,SAASrV,EAAMuJ,EAAOuN,GAC5B,GAAIzhB,GAAGqO,EAAG4P,EAAM3Y,CAYhB,IAVIi1C,GAAUC,EAAa7vC,IAASwb,EAAKlmB,OAAS,IACjDqF,EAAQ6gB,EAAKA,EAAKlmB,OAAS,GAEvBqF,EAAMrF,OAAS,GAAe,OAAVqF,GACvB6gB,EAAK/lB,KAAK,OAIZ+lB,EAAK/lB,KAAK,IAAKuK,GAEXuJ,EACH,IAAKlU,EAAI,EAAGqO,EAAI6F,EAAMjU,OAAQD,EAAIqO,EAAGrO,IACpCie,EAAO/J,EAAMlU,GACbmmB,EAAK/lB,KAAK,IAAK6d,EAAKtT,KAAM,KAAM+jB,EAAOzQ,EAAK3Y,OAAO,GAAO,MAIvDmc,GAASi5B,EACbv0B,EAAKA,EAAKlmB,QAAU,IAEpBkmB,EAAKA,EAAKlmB,QAAU,MAGjBwhB,GAAS84B,GAAUE,EAAY9vC,IAASwb,EAAKlmB,OAAS,IACzDqF,EAAQ6gB,EAAKA,EAAKlmB,OAAS,GAEvBqF,EAAMrF,OAAS,GAAe,OAAVqF,GACvB6gB,EAAK/lB,KAAK,QAWb80C,IAAK,SAASvqC,GACb,GAAIrF,EASJ6gB,GAAK/lB,KAAK,KAAMuK,EAAM,KAElB4vC,GAAUE,EAAY9vC,IAASwb,EAAKlmB,OAAS,IAChDqF,EAAQ6gB,EAAKA,EAAKlmB,OAAS,GAEvBqF,EAAMrF,OAAS,GAAe,OAAVqF,GACvB6gB,EAAK/lB,KAAK,QAYbogB,KAAM,SAASA,EAAMq5B,GAChBr5B,EAAKvgB,OAAS,IACjBkmB,EAAKA,EAAKlmB,QAAU45C,EAAMr5B,EAAOkO,EAAOlO,KAU1C02B,MAAO,SAAS12B,GACf2F,EAAK/lB,KAAK,YAAaogB,EAAM,QAS9By2B,QAAS,SAASz2B,GACjB2F,EAAK/lB,KAAK,OAAQogB,EAAM,QAUzB42B,GAAI,SAASzsC,EAAM6V,GACdA,EACH2F,EAAK/lB,KAAK,KAAMuK,EAAM,IAAK+jB,EAAOlO,GAAO,MAEzC2F,EAAK/lB,KAAK,KAAMuK,EAAM,MAGnB4vC,GACHp0B,EAAK/lB,KAAK,OAUZ+2C,QAAS,SAAS32B,GACjB2F,EAAK/lB,KAAK,YAAaogB,EAAM,IAAK+5B,EAAS,KAAO,KAQnDh4B,MAAO,WACN4D,EAAKlmB,OAAS,GASf86C,WAAY,WACX,MAAO50B,GAAKpT,KAAK,IAAIN,QAAQ,MAAO,SA2BxCnS,EAAO,2BACN,sBACA,uBACE,SAAS06C,EAAQzG,GASnB,MAAO,UAAS3nB,EAAUC,GACzB,GAAI7e,GAAOjK,KAAMk3C,EAAS,GAAID,GAAOpuB,EAErCA,GAAWA,MACXA,EAAS6oB,WAAW,YAAc7oB,KAAWA,EAAS6oB,SAEtDznC,EAAK6e,OAASA,EAASA,GAAU,GAAI0nB,GACrCvmC,EAAKitC,OAASA,EAWdjtC,EAAK4hB,UAAY,SAAS3T,GA2CzB,QAASqJ,GAAKrJ,GACb,GAAmCtR,GAAM84B,EAASvvB,EAAO0tB,EAAUC,EAAWqZ,EAAal7C,EAAGqO,EAAGmoC,EAA7FriC,EAAUgnC,EAASl/B,EAAKhQ,KAE5B,IAAKkI,EAgDJA,EAAQ8H,OAhDK,CAMb,GALAtR,EAAOsR,EAAKtR,KACZ84B,EAAUxnB,EAAKqyB,WACfp6B,EAAQ+H,EAAK9B,WAGTs7B,GAAYvhC,GAASA,EAAMjU,OAAS,IACvCi7C,KACAA,EAAYxkC,OAEZ8/B,EAAc3pB,EAAO2lB,eAAev2B,EAAKtR,OACxB,CAChB,IAAK3K,EAAI,EAAGqO,EAAImoC,EAAY5H,gBAAgB3uC,OAAQD,EAAIqO,EAAGrO,IAC1D4hC,EAAW4U,EAAY5H,gBAAgB5uC,GAEnC4hC,IAAY1tB,GAAMwC,MACrBmrB,EAAY3tB,EAAMwC,IAAIkrB,GACtBsZ,EAAYxkC,IAAIkrB,GAAYC,EAC5BqZ,EAAY96C,MAAMuK,KAAMi3B,EAAUt8B,MAAOu8B,IAI3C,KAAK7hC,EAAI,EAAGqO,EAAI6F,EAAMjU,OAAQD,EAAIqO,EAAGrO,IACpC4hC,EAAW1tB,EAAMlU,GAAG2K,KAEdi3B,IAAYsZ,GAAYxkC,MAC7BmrB,EAAY3tB,EAAMwC,IAAIkrB,GACtBsZ,EAAYxkC,IAAIkrB,GAAYC,EAC5BqZ,EAAY96C,MAAMuK,KAAMi3B,EAAUt8B,MAAOu8B,IAI3C3tB,GAAQgnC,EAMV,GAFAD,EAAOj7B,MAAM/D,EAAKtR,KAAMuJ,EAAOuvB,IAE1BA,EAAS,CACb,GAAKxnB,EAAOA,EAAK0C,WAChB,EACC2G,GAAKrJ,SACIA,EAAOA,EAAK2P,KAGvBqvB,GAAO/F,IAAIvqC,KA1Fd,GAAIwwC,GAAU1F,CAwGd,OAtGAA,GAAW7oB,EAAS6oB,SAEpB0F,GAECC,EAAG,SAASn/B,GACXg/B,EAAOz6B,KAAKvE,EAAK3W,MAAO2W,EAAK49B,MAI9BwB,EAAG,SAASp/B,GACXg/B,EAAOhE,QAAQh7B,EAAK3W,QAIrBg2C,EAAG,SAASr/B,GACXg/B,EAAO7D,GAAGn7B,EAAKtR,KAAMsR,EAAK3W,QAI3Bi2C,GAAI,SAASt/B,GACZg/B,EAAO9D,QAAQl7B,EAAK3W,QAIrBk2C,EAAG,SAASv/B,GACXg/B,EAAO/D,MAAMj7B,EAAK3W,QAInBm2C,GAAI,SAASx/B,GACZ,GAAKA,EAAOA,EAAK0C,WAChB,EACC2G,GAAKrJ,SACIA,EAAOA,EAAK2P,QAKzBqvB,EAAO14B,QA0DU,GAAbtG,EAAKhQ,MAAc2gB,EAAS8uB,MAG/BP,EAAS,IAAIl/B,GAFbqJ,EAAKrJ,GAKCg/B,EAAOF,iBAuBjBz6C,EAAO,0BACN,uBACA,yBACA,yBACA,wBACA,0BACA,oBACA,sBACA,cACA,qBACA,qBACE,SAASu9B,EAAU8d,EAAW/G,EAAW3a,EAAU2hB,EAAYlO,EAAM6G,EAAQ9pC,EAAKqb,EAAO8iB,GAa3F,QAASiT,GAAe1rB,GAGvB,QAASmY,GAAKrsB,GACb,MAAOA,IAAsB,OAAdA,EAAKtR,KAHrB,GAAImxC,GAASC,CAMbD,GAAU3rB,EAASjQ,UACfooB,EAAKwT,KACRC,EAAUD,EAAQjwB,KAEdyc,EAAKyT,KACRD,EAAQlyB,SACRmyB,EAAQnyB,WAzBX,GAAIxG,GAAO0C,EAAM1C,KAAMgB,EAAO0B,EAAM1B,KAChCie,EAAMxE,EAASwE,IAAK2Z,GAAa,oBAqCrC,OAAO,UAASpvB,EAAUhlB,GAQzB,QAASq0C,GAAS91B,GACjB,GAAI+1B,GAAoB,GAAI7hC,SAC3B,oDACA,QAAU2hC,EAAUjpC,KAAK,KAAO,aAC/BA,KAAK,KAAM,KAIb,OAFAoT,GAAOyiB,EAAKxkB,KAAK+B,EAAK1T,QAAQypC,EAAmB,KAelD,QAASC,KACR,GAEIC,GAAa14B,EAAO24B,EAAa/zC,EAASqsC,EAF1CtqB,EAAUziB,EAAO+kC,UAAU7vB,UAC3Bw/B,EAAiB,0CAC6CzvB,EAASjlB,EAAOilB,MAMlF,KAJAxC,EAAU4xB,EAAS5xB,GACnBsqB,EAAqB9nB,EAAOmnB,wBAGpB1rC,EAAUg0C,EAAe5yC,KAAK2gB,IACrC3G,EAAQ44B,EAAe5sB,UACvB2sB,EAAc/zC,EAAQ,GAAGrI,OAGxBm8C,EADGzH,EAAmBrsC,EAAQ,IAChBob,EAEAkxB,EAAUJ,WAAW3nB,EAAQxC,EAAS3G,GAGrD2G,EAAUA,EAAQ6K,UAAU,EAAGxR,EAAQ24B,GAAehyB,EAAQ6K,UAAUknB,GACxEE,EAAe5sB,UAAYhM,EAAQ24B,CAGpC,OAAOj4B,GAAKiG,GAGb,QAASkyB,GAAY5xC,GAChBmb,EAAMD,QAAQm2B,EAAWrxC,UAC5B6xC,EAAWjE,mBAAmB5tC,EAAM,SAASie,EAAOje,GAGnD,IAFA,GAAI3K,GAAI4oB,EAAM3oB,OAEPD,KACN4oB,EAAM5oB,GAAGie,KAAKtT,EAAM,QAItBqxC,EAAU57C,KAAKuK,IAhEjB,GAAIgmB,GAAK9D,EAAQ2vB,CAoQjB,OAlQI50C,KACH+oB,EAAM/oB,EAAO+oB,IACb9D,EAASjlB,EAAOilB,QAiEjB8D,EAAMA,GAAO0R,EACbxV,EAASA,GAAU,GAAI0nB,GAAO3nB,GAC9BA,EAASiuB,gBAAkBjuB,EAASiuB,iBAAmB,QACvDjuB,EAASqtB,sBAAsB,uBAAyBrtB,KAAWA,EAASqtB,oBAE5EuC,EAAa,GAAIb,GAAU/uB,EAAUC,GAGrC2vB,EAAWjE,mBAAmB,oBAAqB,SAAS3vB,EAAOje,GAGlE,IAFA,GAAsBsR,GAAlBjc,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACbic,EAAKgC,KAAK,WAAYhC,EAAK9B,WAAWzD,IAAI,sBAC1CuF,EAAKgC,KAAKtT,EAAM,QAKlB6xC,EAAWjE,mBAAmB,iBAAkB,SAAS3vB,EAAOje,GAI/D,IAHA,GAAsBsR,GAAM3W,EACiEsG,EADzF5L,EAAI4oB,EAAM3oB,OAAqBw8C,EAAe,YAAc9xC,EAC5D0kB,EAAezC,EAAS2C,cAAeD,EAAoB1C,EAAS4C,oBAEjExvB,KACNic,EAAO2M,EAAM5oB,GAEbsF,EAAQ2W,EAAK9B,WAAWzD,IAAI+lC,GACxBn3C,IAAUsG,GAEbqQ,EAAKgC,KAAKtT,EAAMrF,EAAMrF,OAAS,EAAIqF,EAAQ,MAC3C2W,EAAKgC,KAAKw+B,EAAc,QAGxBn3C,EAAQ2W,EAAK9B,WAAWzD,IAAI/L,GAEf,UAATA,EACHrF,EAAQqrB,EAAI4M,eAAe5M,EAAI6M,WAAWl4B,GAAQ2W,EAAKtR,MAC7C0kB,IACV/pB,EAAQ+pB,EAAanqB,KAAKoqB,EAAmBhqB,EAAOqF,EAAMsR,EAAKtR,OAGhEsR,EAAKgC,KAAKtT,EAAMrF,EAAMrF,OAAS,EAAIqF,EAAQ,SAM9Ck3C,EAAWjE,mBAAmB,QAAS,SAAS3vB,GAG/C,IAFA,GAAsB3M,GAAM3W,EAAxBtF,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACbsF,EAAQ2W,EAAKgC,KAAK,SAEd3Y,IACHA,EAAQ2W,EAAKgC,KAAK,SAASxL,QAAQ,8BAA+B,IAClEwJ,EAAKgC,KAAK,QAAS3Y,EAAMrF,OAAS,EAAIqF,EAAQ,SAMjDk3C,EAAWjE,mBAAmB,gBAAiB,SAAS3vB,EAAOje,EAAMxE,GAGpE,IAFA,GAAsB8V,GAAlBjc,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GAEgC,aAAzCic,EAAK9B,WAAWzD,IAAI,kBAAoCvQ,EAAKu2C,SAChEzgC,EAAK2N,WAKR4yB,EAAWlE,cAAc,WAAY,SAAS1vB,GAG7C,IAFA,GAAsB3M,GAAlBjc,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GAAG2e,WAEZ1C,IACHA,EAAK3W,MAAQ20B,EAASrL,OAAO3S,EAAK3W,UAMrCk3C,EAAWlE,cAAc,eAAgB,SAAS1vB,EAAOje,GAGxD,QAASyZ,GAAK9e,GAGb,MAAOA,GAAMmN,QAAQ,2BAA4B,MAC9CA,QAAQ,qBAAsB,IAC9BA,QAAQ,0HAA2H,IACnIA,QAAQ,4GAA6G,IAGzH,IAXA,GAAsBwJ,GAAM3W,EAAO2G,EAA/BjM,EAAI4oB,EAAM3oB,OAWPD,KACNic,EAAO2M,EAAM5oB,GACbsF,EAAQ2W,EAAK0C,WAAa1C,EAAK0C,WAAWrZ,MAAQ,GAErC,WAATqF,GAGHsB,EAAOgQ,EAAKgC,KAAK,QACbhS,GACHgQ,EAAKgC,KAAK,OAAgB,eAARhS,EAAwB,KAAOA,EAAKwG,QAAQ,SAAU,KAGrEnN,EAAMrF,OAAS,IAClBgc,EAAK0C,WAAWrZ,MAAQ,iBAAmB8e,EAAK9e,GAAS,aAGtDA,EAAMrF,OAAS,IAClBgc,EAAK0C,WAAWrZ,MAAQ,SAAW8e,EAAK9e,GAAS,WAOrDk3C,EAAWlE,cAAc,WAAY,SAAS1vB,GAG7C,IAFA,GAAsB3M,GAAlBjc,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GAEyB,IAAlCic,EAAK3W,MAAMqE,QAAQ,YACtBsS,EAAKtR,KAAO,SACZsR,EAAKhQ,KAAO,EACZgQ,EAAK3W,MAAQ2W,EAAK3W,MAAMmN,QAAQ,oBAAqB,KACF,IAAzCwJ,EAAK3W,MAAMqE,QAAQ,oBAC7BsS,EAAKtR,KAAO,QACZsR,EAAKhQ,KAAO,EACZgQ,EAAK49B,KAAM,EACX59B,EAAK3W,MAAQ0wC,SAAS/5B,EAAK3W,OAAOmqB,OAAO,OAK5C+sB,EAAWlE,cAAc,sBAAuB,SAAS1vB,EAAOje,GAG/D,IAFA,GAAsBsR,GAAlBjc,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACK,IAAdic,EAAKhQ,KACRgQ,EAAK2N,SACmB,IAAd3N,EAAKhQ,OACF,UAATtB,GAAsB,QAAUsR,GAAK9B,WAAWzD,KACnDuF,EAAKgC,KAAK,OAAQ,WAOlB2O,EAAS+vB,mBACZH,EAAWlE,cAAc,QAAS,SAAS1vB,GAG1C,IAFA,GAAsB3M,GAAMrM,EAAxB5P,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACb4P,EAAaqM,EAAKG,OAEM,OAApBxM,EAAWjF,MAAqC,OAApBiF,EAAWjF,MACtCsR,EAAK4P,MAA2B,OAAnB5P,EAAK4P,KAAKlhB,MAC1BsR,EAAK4P,KAAKhC,OAAO5N,KAQtBugC,EAAWjE,mBACV,6GAIA,SAAS3vB,EAAOje,GAGf,IAFA,GAAI3K,GAAI4oB,EAAM3oB,OAEPD,KACN4oB,EAAM5oB,GAAGie,KAAKtT,EAAM,SAYtBkiB,OAAQA,EAgBRyrB,cAAekE,EAAWlE,cAiB1BC,mBAAoBiE,EAAWjE,mBAS/B3oB,UAAW,SAAS3T,EAAM9V,GACzB,GAAiBy2C,GAAMtwC,EAAKuwC,EAAQC,EAAgBzyB,EAAS8F,EAAzDniB,EAAOjK,IA4EX,OAxEI0G,GAAIhC,IAAMkoB,EAAIxd,OAAO,2BAA2BlT,OAAS,GAC5DoqB,EAAUpO,EAAKa,UACfb,EAAOA,EAAKkL,WAAU,GACtBwJ,EAAIoQ,QAAQ9kB,EAAMoO,IAElBpO,EAAOA,EAAKkL,WAAU,GAKvBy1B,EAAO3gC,EAAK5P,cAAc0wC,eACtBH,EAAKI,qBAER1wC,EAAMswC,EAAKI,mBAAmB,IAG9B55B,EAAsB,QAAjBnH,EAAK5J,SAAqB4J,EAAKF,YAAcE,GAAO,SAASA,GACjE3P,EAAI5E,KAAK4U,YAAYhQ,EAAI2wC,WAAWhhC,GAAM,MAK1CA,EADoB,QAAjBA,EAAK5J,SACD/F,EAAI5E,KAAKiX,WAETrS,EAAI5E,KAIZm1C,EAASlsB,EAAIrkB,IACbqkB,EAAIrkB,IAAMA,GAGXnG,EAAOA,MACPA,EAAK+2C,OAAS/2C,EAAK+2C,QAAU,OAGzB/2C,EAAK8mC,YACR9mC,EAAKyzC,kBAAoB,IAIrBzzC,EAAKg3C,YACTh3C,EAAK8V,KAAOA,EACZjO,EAAKovC,aAAaj3C,IAInBgqB,EAAWqsB,EAAWzuB,MAAM3J,EAAKje,EAAKk3C,SAAWphC,EAAKa,UAAY6T,EAAIkS,aAAa5mB,IAAQ9V,GAC3F01C,EAAe1rB,GAGf2sB,EAAiB,GAAIlB,GAAWhvB,EAAUC,GAC1C1mB,EAAKkkB,QAAUyyB,EAAeltB,UAAUO,GAGnChqB,EAAKu2C,UACTv2C,EAAKkkB,QAAUue,EAAKxkB,KAAKje,EAAKkkB,SAC9BlkB,EAAKkkB,QAAUlkB,EAAKkkB,QAAQ5X,QAAQ,UAAW,KAI3CtM,EAAKg3C,WACTnvC,EAAKsvC,cAAcn3C,GAIhB02C,IACHlsB,EAAIrkB,IAAMuwC,GAGX12C,EAAK8V,KAAO,KAEL9V,EAAKkkB,SAWbkzB,SAAU,SAASC,GAClB3wB,EAAOojB,iBAAiBuN,IAWzBC,SAAU,SAASD,GAClB3wB,EAAO2kB,iBAAiBgM,IAGzBJ,aAAc,SAASj3C,GAClByB,GACHA,EAAOqI,KAAK,aAAc9J,IAI5Bm3C,cAAe,SAASn3C,GACnByB,GACHA,EAAOqI,KAAK,cAAe9J,IAW7Bo2C,YAAaA,EAGbN,SAAUA,EACVE,kBAAmBA,MAwBtB77C,EAAO,kCAAoC,WAC1C,QAASo9C,GAAUzQ,GAGlB,QAAS0Q,GAAYhU,EAAK3pB,GACzB,GAAI49B,GAA0BC,EAAUC,EACvCztC,EAAUmgB,EAAOjF,EAAQ7H,EAAsBtH,EADlCq4B,EAAa,EACMsJ,IAQjC,IALAH,EAAWjU,EAAIoC,YACf6R,EAASvsB,SAASrR,GAClB5D,EAASwhC,EAASI,gBAGd5hC,EAAO/P,gBAAkB4gC,EAAUtc,IAAIrkB,IAA3C,CAKA,KAAkC,UAA3B8P,EAAOtS,iBACbsS,EAASA,EAAOxM,UAIjB,KAAKwM,EAAOkuB,gBACX,OAAQruB,KAAMG,EAAQ0hC,OAAQ,EAQ/B,KAJAztC,EAAW+L,EAAO/L,SAClBwtC,EAAWxtC,EAASpQ,OAAS,EAGtBw0C,GAAcoJ,GASpB,GARAn6B,EAAQhgB,KAAKu6C,OAAOxJ,EAAaoJ,GAAY,GAG7CrtB,EAAQngB,EAASqT,GACjBk6B,EAASpS,kBAAkBhb,GAC3ButB,EAAWH,EAASM,iBAAiBl+B,EAAQ,eAAiB,WAAY2pB,GAGtEoU,EAAW,EACdF,EAAWn6B,EAAQ,MACb,CAAA,KAAIq6B,EAAW,GAGrB,OAAQ9hC,KAAMuU,EAFdikB,GAAa/wB,EAAQ,EAOvB,GAAIq6B,EAAW,EAed,IAbKvtB,EAMJotB,EAASvsB,UAAS,IALlBusB,EAASpS,kBAAkBpvB,GAC3BwhC,EAASvsB,UAAS,GAClBb,EAAQpU,EACR0hC,GAAS,GAQVvyB,EAAS,EACwE,IAA1EqyB,EAASM,iBAAiBl+B,EAAQ,eAAiB,aAAc2pB,IACjC,IAAlCiU,EAASO,KAAK,YAAa,IAAY/hC,GAAUwhC,EAASI,iBAI9DzyB,QASD,KALAqyB,EAASvsB,UAAS,GAIlB9F,EAAS,EACwE,IAA1EqyB,EAASM,iBAAiBl+B,EAAQ,eAAiB,aAAc2pB,IAChC,IAAnCiU,EAASO,KAAK,iBAA0B/hC,GAAUwhC,EAASI,iBAI/DzyB,GAIF,QAAQtP,KAAMuU,EAAOutB,SAAUA,EAAUxyB,OAAQA,EAAQuyB,OAAQA,IAIlE,QAASM,KAmBR,QAASpU,GAAahqB,GACrB,GAA4C1R,GAAWid,EAA4B9D,EAAS7b,EAAOgT,EAA/FyrB,EAAWsT,EAAYU,EAASr+B,GAA2Bs+B,EAAiB,CAKhF,IAHAhwC,EAAY+7B,EAASpuB,KACrBsP,EAAS8e,EAAS9e,OAEd8e,EAASyT,SAAWxvC,EAAUg8B,gBAEjC,WADAiU,GAASv+B,EAAQ,WAAa,UAAU1R,EAAW,EAIpD,IAAIid,IAAW3f,EAEd,WADA2yC,GAASv+B,EAAQ,iBAAmB,eAAe1R,EAIpD,IAAI+7B,EAAS0T,SAAW,EAAG,CAG1B,GAFAt2B,EAAU4iB,EAASyT,OAASxvC,EAAUqQ,WAAarQ,EAAUuG,aAExD4S,EAEJ,WADA82B,GAASv+B,EAAQ,gBAAkB,eAAe1R,EAInD,KAAKid,EAOJ,YANwB,GAApB9D,EAAQnY,SACXivC,EAASv+B,EAAQ,WAAa,UAAUyH,EAAS,GAEjD82B,EAASv+B,EAAQ,iBAAmB,gBAAgByH,GAOtD,MAAOA,GAAS,CACf,GAAwB,GAApBA,EAAQnY,WACXsP,EAAY6I,EAAQ7I,UACpB0/B,GAAkB1/B,EAAU3e,OAGxBq+C,GAAkB/yB,GAAQ,CAC7Bjd,EAAYmZ,EACZ62B,GAAkB/yB,EAClB+yB,EAAiB1/B,EAAU3e,OAASq+C,CACpC,OAIF72B,EAAUA,EAAQ5S,iBAEb,CAIN,GAFA4S,EAAUnZ,EAAUmnB,iBAEfhO,EACJ,MAAO82B,GAASv+B,EAAQ,iBAAmB,gBAAgB1R,EAI5D,KAAKid,EAOJ,YAN0B,GAAtBjd,EAAUgB,SACbivC,EAASv+B,EAAQ,WAAa,UAAUyH,EAASnZ,EAAUsQ,UAAU3e,QAErEs+C,EAASv+B,EAAQ,gBAAkB,eAAeyH,GAMpD,MAAOA,GAAS,CACf,GAAwB,GAApBA,EAAQnY,WACXgvC,GAAkB72B,EAAQ7I,UAAU3e,OAGhCq+C,GAAkB/yB,GAAQ,CAC7Bjd,EAAYmZ,EACZ62B,GAAkB/yB,CAClB,OAIF9D,EAAUA,EAAQgO,iBAIpB8oB,EAASv+B,EAAQ,WAAa,UAAU1R,EAAWgwC,GAxGpD,GAA8D13C,GAAS+qB,EAAW6sB,EAAUC,EAAUC,EAAlGL,EAAUpR,EAAUC,SAAUqR,EAAW5tB,EAAIkT,WAIjD,IADAj9B,EAAUy3C,EAAQ56B,KAAO46B,EAAQ56B,KAAK,GAAK46B,EAAQL,gBAC/Cp3C,EAAQyF,eAAiBskB,EAAIrkB,IAChC,MAAOiyC,EAMR,IAHA5sB,EAAYsb,EAAUG,cAGlBiR,EAAQ56B,KAIX,MAHA86B,GAAS3tB,SAAShqB,EAAQgJ,WAAY+gB,EAAI5Q,UAAUnZ,IACpD23C,EAASxtB,OAAOwtB,EAASnsB,eAAgBmsB,EAASjsB,YAAc,GAEzDisB,CA4FR,KAECvU,GAAa,GAGRrY,GACJqY,IAEA,MAAOxkC,GAKR,GAAIA,EAAGm5C,oBAkCN,KAAMn5C,EAhCNk5C,GAAW1wC,EAAK4wC,YAAY,GAG5BJ,EAAWH,EAAQtS,YACnByS,EAASntB,UAAS,GAClBzqB,EAAU43C,EAASR,gBAGdrsB,IACJ6sB,EAAWH,EAAQtS,YACnByS,EAASntB,UAAS,GAClBotB,EAAWD,EAASR,gBACpBS,EAAS3hC,UAAY2hC,EAAS3hC,WAI/BlW,EAAQkW,UAAYlW,EAAQkW,UAG5B9O,EAAK6wC,eAAeH,GAGpBL,EAAUpR,EAAUC,SAGpBlD,GAAa,GAGRrY,GACJqY,IAOH,MAAOuU,GA3PR,GAAIvwC,GAAOjK,KAAM4sB,EAAMsc,EAAUtc,IAAKK,GAAQ,CA8P9CjtB,MAAK66C,YAAc,SAAS3yC,GAG3B,QAAS6yC,GAAW7iC,GACnB,GAAIG,GAAQ0E,EAAMzQ,EAAUrQ,EAAG++C,IAK/B,KAHA3iC,EAASH,EAAKrM,WACdkR,EAAO6P,EAAIgO,UAAU/uB,WAEdwM,GAAU0E,GAA4B,IAApB1E,EAAO9M,UAAgB,CAI/C,IAHAe,EAAW+L,EAAO/L,SAElBrQ,EAAIqQ,EAASpQ,OACND,KACN,GAAIic,IAAS5L,EAASrQ,GAAI,CACzB++C,EAAQ3+C,KAAKJ,EACb,OAIFic,EAAOG,EACPA,EAASA,EAAOxM,WAGjB,MAAOmvC,GAGR,QAASC,GAAoBh/B,GAC5B,GAAI+9B,EAGJ,IADAA,EAAWJ,EAAYhU,EAAK3pB,GAE3B,OACC+9B,SAAUA,EAASA,SACnBxyB,OAAQwyB,EAASxyB,OACjBwzB,QAASD,EAAWf,EAAS9hC,MAC7B6hC,OAAQC,EAASD,QAnCpB,GAAInU,GAAMsD,EAAUC,SAAUwR,IAsD9B,OAba,KAATzyC,IAEE09B,EAAIlmB,KAORi7B,EAAS1+B,OAASi/B,MAAM,EAAMF,QAASD,EAAWnV,EAAIlmB,KAAK,MAN3Di7B,EAAS1+B,MAAQg/B,GAAoB,GAEhC/R,EAAUG,gBACdsR,EAASxJ,IAAM8J,OAOXN,GAGR36C,KAAK86C,eAAiB,SAASH,GAG9B,QAASQ,GAAeH,GACvB,GAAI9iC,GAAMjc,EAAGogB,EAAK/P,CAGlB,KADA4L,EAAO0U,EAAIgO,UACN3+B,EAAI++C,EAAQ9+C,OAAS,EAAGD,GAAK,EAAGA,IACpCqQ,EAAW4L,EAAK5L,SAChB+P,EAAM2+B,EAAQ/+C,GAEVogB,GAAO/P,EAASpQ,OAAS,IAC5Bgc,EAAO5L,EAAS+P,GAIlB,OAAOnE,GAGR,QAASkjC,GAAoBn/B,GAC5B,GAAkDo/B,GAAUC,EAASzzC,EAAO2f,EAAxE8e,EAAWqU,EAAS1+B,EAAQ,QAAU,MAEtCqqB,KACH+U,EAAW/U,EAAS0T,SAAW,EAE/BsB,EAAU33C,EAAK4jC,kBACf+T,EAAQ7T,kBAAkB0T,EAAe7U,EAAS0U,UAElDxzB,EAAS8e,EAAS9e,OACdA,IAAW3f,GACdyzC,EAAQhuB,SAASgZ,EAASyT,QAAUsB,GACpCC,EAAQC,UAAU,YAAaF,GAAY7zB,EAASA,IAEpD8zB,EAAQhuB,SAASrR,GAGlB2pB,EAAI4V,YAAYv/B,EAAQ,eAAiB,aAAcq/B,GAEnDr/B,GACH2pB,EAAItY,UAAS,IAtChB,GAAIsY,GAAKjiC,EAAOipB,EAAIrkB,IAAI5E,IA2CpBg3C,GAAS1+B,QACR0+B,EAAS1+B,MAAMi/B,MAClBtV,EAAMjiC,EAAK83C,qBACX7V,EAAI8V,WAAWP,EAAeR,EAAS1+B,MAAM++B,UAC7CpV,EAAIx2B,WAEJw2B,EAAMjiC,EAAK4jC,kBACX6T,GAAoB,GACpBA,IACAxV,EAAIx2B,YAKPpP,KAAK27C,SAAW,SAAS/V,GAIxB,QAAS4V,GAAYv/B,GACpB,GAAI1R,GAAWid,EAAQo0B,EAAQC,EAAQh3B,CAEvC+2B,GAAShvB,EAAI9uB,OAAO,KACpByM,EAAY0R,EAAQoS,EAAiBI,EACrCjH,EAASvL,EAAQsS,EAAcI,EAC/BktB,EAASC,EAAM9T,YAEXz9B,GAAahC,GAAOgC,GAAahC,EAAIC,kBACxC+B,EAAY5G,EACZ6jB,EAAS,GAGgB,GAAtBjd,EAAUgB,UACbhB,EAAUsB,WAAWwX,aAAau4B,EAAQrxC,GAC1CsxC,EAAOpU,kBAAkBmU,GACzBC,EAAON,UAAU,YAAa/zB,GAC9BoF,EAAI/G,OAAO+1B,GACXE,EAAMN,YAAYv/B,EAAQ,eAAiB,WAAY4/B,KAEvDh3B,EAAQta,EAAUyN,WAEd6M,EAAM3oB,QACLsrB,GAAU3C,EAAM3oB,OACnB0wB,EAAI0C,YAAYssB,EAAQ/2B,EAAMA,EAAM3oB,OAAS,IAE7CqO,EAAU8Y,aAAau4B,EAAQ/2B,EAAM2C,IAGtCq0B,EAAOpU,kBAAkBmU,IACfrxC,EAAUs0B,cAGpBt0B,EAAUwO,UAAY,wBACtB6iC,EAASrxC,EAAUqQ,WACnBihC,EAAOpU,kBAAkBmU,GACzBC,EAAOvuB,SAASL,IAGjB6uB,EAAMN,YAAYv/B,EAAQ,eAAiB,WAAY4/B,GACvDjvB,EAAI/G,OAAO+1B,IA3Cb,GAAIE,GAAOC,EAAS1tB,EAAgBE,EAAaE,EAAcE,EAAWjL,EAC/BslB,EAAWgT,EAArDzzC,EAAM2gC,EAAUtc,IAAIrkB,IAAK5E,EAAO4E,EAAI5E,IAsDrC,IAPA0qB,EAAiBuX,EAAIvX,eACrBE,EAAcqX,EAAIrX,YAClBE,EAAemX,EAAInX,aACnBE,EAAYiX,EAAIjX,UAChBmtB,EAAQn4C,EAAK4jC,kBAGTlZ,GAAkBI,GAA2C,GAA3BJ,EAAe9iB,SAAe,CAEnE,GAAIgjB,GAAeI,IAAcN,EAAekY,gBAAiB,CAChE,GAAIlY,EAAewQ,YAoBlB,MAhBAnb,GAAU2K,EAAeqD,gBACrBhO,IAAYA,EAAQ6iB,iBAAmB3Z,EAAIiO,QAAQnX,GACtDA,EAAQ3K,UAAY,WAEpB2K,EAAU,KAGX2K,EAAetV,UAAY,6CAC3B+iC,EAAMrU,kBAAkBpZ,EAAelS,WACvC2/B,EAAM1sC,SACNwd,EAAIrkB,IAAI2gC,UAAU+S,QAClB5tB,EAAetV,UAAY,QAEvB2K,IACHA,EAAQ3K,UAAY,IAKtBwV,GAAc3B,EAAI5Q,UAAUqS,GAC5BA,EAAiBA,EAAexiB,WAGjC,GAAI0iB,GAAeI,EAAY,EAC9B,IASC,GARAqtB,EAAU3tB,EAAerW,WAAWuW,GACpCwtB,EAAUp4C,EAAK83C,qBACfM,EAAQL,WAAWM,GACnBD,EAAQ3sC,SAIR45B,EAAYE,EAAUC,SAClBH,EAAUtpB,MAAQs8B,IAAYhT,EAAUtpB,KAAK,GAChD,OAEA,MAAOje,KAOX+5C,GAAY,GACZA,IAGAM,EAAM1sC,UAIPpP,KAAKk8C,WAAa7B,EAGnB,MAAOV,KAkBRp9C,EAAO,mBACN,eACE,SAASmK,GACX,OACCy1C,UAAW,EACXptB,OAAQ,GACRqtB,KAAM,GACNC,MAAO,GACPC,KAAM,GACNC,MAAO,GACPC,SAAU,GACVC,IAAK,EACLC,GAAI,GAEJC,gBAAiB,SAAS57C,GACzB,MAAOA,GAAE67C,UAAY77C,EAAE87C,SAAW97C,EAAE+7C,QAAU98C,KAAK+8C,eAAeh8C,IAGnEg8C,eAAgB,SAASh8C,GAExB,MAAQ2F,GAAI5B,IAAM/D,EAAEwI,QAAUxI,EAAE87C,UAAY97C,EAAE+7C,WAwBjDvgD,EAAO,gCACN,kBACA,qBACA,qBACA,cACA,wBACE,SAASygD,EAAIj7B,EAAOtb,EAAOC,EAAKk+B,GAClC,GAAIH,GAAyBG,EAASH,sBAEtC,OAAO,UAASyE,EAAWrlC,GAgE1B,QAASo5C,GAAY13B,GACpB,GAAIrY,GAAWrJ,EAAOglB,SAASq0B,eAE/B,OAAIhwC,MAAa,IAASxG,EAAIT,MAIP,gBAAZiH,KACVA,EAAW,iBAGgC,UAAxCqY,EAAI9W,aAAa,qBAIjB8W,GAAO1hB,EAAO+kC,WAIX/kC,EAAO+oB,IAAIpM,GAAG+E,EAAKrY,KAG3B,QAASiwC,GAAmBp8C,GAC3B,GAAIq8C,GAAQC,EAAQC,EAChBC,EAAeC,CAGnBJ,GAASr8C,EAAE08C,QAAUC,EACrBL,EAASt8C,EAAE48C,QAAUC,EAGrBn+C,EAAQ29C,EAASS,EAAe,GAAKC,EACrCp+C,EAAS29C,EAASQ,EAAe,GAAKE,EAGtCt+C,EAAQA,EAAQ,EAAI,EAAIA,EACxBC,EAASA,EAAS,EAAI,EAAIA,EAGzB49C,EAD2B,OAAxBU,EAAY1vC,UAAqBzK,EAAOglB,SAASo1B,2BAA4B,GAChEjB,EAAGL,gBAAgB57C,GAEpBi8C,EAAGL,gBAAgB57C,IAA+B,OAAxBi9C,EAAY1vC,UAAqBuvC,EAAe,GAAKA,EAAe,KAAO,EAIjHP,IACC3V,EAAIyV,GAAUzV,EAAI0V,IACrB39C,EAAS7B,EAAM4B,EAAQy+C,GACvBz+C,EAAQ5B,EAAM6B,EAASw+C,KAEvBz+C,EAAQ5B,EAAM6B,EAASw+C,GACvBx+C,EAAS7B,EAAM4B,EAAQy+C,KAKzBtxB,EAAI2Q,UAAU4gB,GACb1+C,MAAOA,EACPC,OAAQA,IAIT69C,EAAgBM,EAAeO,SAAS7gD,EAAI6/C,EAC5CI,EAAgBK,EAAeO,SAAS5gD,EAAI6/C,EAC5CE,EAAgBA,EAAgB,EAAIA,EAAgB,EACpDC,EAAgBA,EAAgB,EAAIA,EAAgB,EAEpD5wB,EAAI2Q,UAAU8gB,GACb9+C,KAAMg+C,EACN/9C,IAAKg+C,EACLc,QAAS,UAGVD,EAAatlC,UAAYtZ,EAAQ,YAAcC,EAG3Cm+C,EAAe,GAAK,GAAKM,EAAiBxiB,aAAel8B,GAC5DmtB,EAAIwQ,SAAS+gB,EAAkB,OAAQI,GAAgBT,EAASr+C,IAI7Do+C,EAAe,GAAK,GAAKM,EAAiBtiB,cAAgBn8B,GAC7DktB,EAAIwQ,SAAS+gB,EAAkB,MAAOK,GAAgBT,EAASr+C,IAIhE09C,EAASqB,EAAYC,YAAcC,EACnCtB,EAASoB,EAAYG,aAAeC,EAGhCzB,EAASC,IAAW,GACvBzwB,EAAI2Q,UAAU8gB,GACb9+C,KAAMg+C,EAAgBH,EACtB59C,IAAKg+C,EAAgBH,IAIlByB,IACJj7C,EAAOqI,KAAK,qBAAsBtP,OAAQohD,EAAav+C,MAAOq+C,EAAQp+C,OAAQq+C,IAC9Ee,GAAgB,GAIlB,QAASC,KAGR,QAASC,GAAYp4C,EAAMrF,GACtBA,IAECy8C,EAAYx4B,MAAM5e,KAAU/C,EAAOilB,OAAOmD,QAAQ+xB,EAAY1vC,SAASC,cAAe3H,GACzFgmB,EAAIwQ,SAAS4gB,EAAap3C,EAAMrF,GAEhCqrB,EAAIuO,UAAU6iB,EAAap3C,EAAMrF,IARpCu9C,GAAgB,EAchBE,EAAY,QAASv/C,GACrBu/C,EAAY,SAAUt/C,GAEtBktB,EAAI9gB,OAAOmzC,EAAa,YAAa9B,GACrCvwB,EAAI9gB,OAAOmzC,EAAa,UAAWF,GAE/BG,GAAgBD,IACnBryB,EAAI9gB,OAAOozC,EAAc,YAAa/B,GACtCvwB,EAAI9gB,OAAOozC,EAAc,UAAWH,IAIrCnyB,EAAI/G,OAAOs4B,GACXvxB,EAAI/G,OAAOw4B,GAENlkB,GAAgC,SAAxB6jB,EAAY1vC,UACxB6wC,EAAenB,GAGhBn6C,EAAOqI,KAAK,iBAAkBtP,OAAQohD,EAAav+C,MAAOA,EAAOC,OAAQA,IACzEktB,EAAIuO,UAAU6iB,EAAa,QAASpxB,EAAIwO,UAAU4iB,EAAa,UAC/Dn6C,EAAOylC,cAGR,QAAS6V,GAAeC,EAAWC,EAAqBC,GACvD,GAAItF,GAAUuF,EAAaC,EAAcz+C,EAAG3D,CAE5CqiD,KACAC,IAGA1F,EAAWptB,EAAImP,OAAOqjB,EAAWX,GACjCF,EAAevE,EAASz8C,EACxBihD,EAAexE,EAASx8C,EACxBJ,EAAOgiD,EAAU13B,wBACjB63B,EAAcniD,EAAKqC,OAAUrC,EAAKitB,MAAQjtB,EAAKmC,KAC/CigD,EAAepiD,EAAKsC,QAAWtC,EAAKktB,OAASltB,EAAKoC,IAG9Cw+C,GAAeoB,IAClBO,IACA3B,EAAcoB,EACd3/C,EAAQC,EAAS,GAIlBqB,EAAI8C,EAAOqI,KAAK,kBAAmBtP,OAAQwiD,IAEvCnC,EAAYmC,KAAer+C,EAAEiI,qBAChCqW,EAAKugC,EAAe,SAASr/C,EAAQqG,GAGpC,QAASi5C,GAAU9+C,GAClB28C,EAAS38C,EAAE08C,QACXG,EAAS78C,EAAE48C,QACXG,EAASE,EAAYriB,YACrBoiB,EAASC,EAAYniB,aACrBqiB,EAAQH,EAASD,EACjBD,EAAiBt9C,EAEjBA,EAAO69C,UACN7gD,EAAGgiD,EAAch/C,EAAO,GAAKg+C,EAC7B/gD,EAAGgiD,EAAej/C,EAAO,GAAKi+C,GAG/BG,EAAmBF,EAAYC,YAC/BG,EAAoBJ,EAAYG,aAEhCT,EAAmBH,EAAY56B,WAAU,GACzCwJ,EAAIhG,SAASu3B,EAAkB,uBAC/BvxB,EAAIuO,UAAUgjB,EAAkB,iBAAkB,OAClDA,EAAiBp4C,iBAAkB,EACnCo4C,EAAiB2B,aAAc,EAC/BlzB,EAAI2Q,UAAU4gB,GACb5+C,KAAMg/C,EACN/+C,IAAKg/C,EACLuB,OAAQ,IAGT5B,EAAiBhvC,gBAAgB,qBACjCsvC,EAAYlmC,YAAY4lC,GAExBvxB,EAAIhtB,KAAKq/C,EAAa,YAAa9B,GACnCvwB,EAAIhtB,KAAKq/C,EAAa,UAAWF,GAE7BG,GAAgBD,IACnBryB,EAAIhtB,KAAKs/C,EAAc,YAAa/B,GACpCvwB,EAAIhtB,KAAKs/C,EAAc,UAAWH,IAGnCV,EAAezxB,EAAIhI,IAAI65B,EAAa,OACnCp6B,QAAS,oBACT27B,iBAAkB,OAChBlC,EAAS,YAAcC,GA3C3B,GAAIkC,EA8CJ,OAAIZ,QAECz4C,GAAQy4C,GACXQ,EAAUP,KAOZW,EAAYrzB,EAAI5H,IAAI,kBAAoBpe,GACpCq5C,GACHrzB,EAAI/G,OAAOo6B,GAGZA,EAAYrzB,EAAIhI,IAAI65B,EAAa,OAChCjiD,GAAI,kBAAoBoK,EACxBo5C,iBAAkB,MAClB37B,QAAS,mBACT67B,cAAc,EACd16B,MAAO,UAAY5e,EAAO,iCAKvBF,EAAIhC,KACPu7C,EAAUl6C,iBAAkB,GAG7B6mB,EAAIhtB,KAAKqgD,EAAW,YAAa,SAASl/C,GACzCA,EAAEsI,2BACFtI,EAAEgI,iBACF82C,EAAU9+C,KAGXR,EAAOglB,IAAM06B,MAGbrzB,GAAI2Q,UAAU0iB,GACb1gD,KAAOggD,EAAch/C,EAAO,GAAKg+C,EAAiB0B,EAAU/jB,YAAc,EAC1E18B,IAAMggD,EAAej/C,EAAO,GAAKi+C,EAAiByB,EAAU9jB,aAAe,OAI7EsjB,IAGDzB,EAAYpvC,aAAa,oBAAqB,KAG/C,QAAS6wC,KACR,GAAI74C,GAAMq5C,CAEVP,KAEI1B,GACHA,EAAY7uC,gBAAgB,oBAG7B,KAAKvI,IAAQg5C,GACZK,EAAYrzB,EAAI5H,IAAI,kBAAoBpe,GACpCq5C,IACHrzB,EAAI9gB,OAAOm0C,GACXrzB,EAAI/G,OAAOo6B,IAKd,QAASE,GAAiBp/C,GAGzB,QAASq/C,GAAeloC,EAAMG,GAC7B,GAAIH,EACH,EACC,IAAIA,IAASG,EACZ,OAAO,QAECH,EAAOA,EAAKrM,YARxB,GAAI68B,GAAU2X,CAad,KAAIvB,IAAiBj7C,EAAOC,QAY5B,MAPAub,GAAKuN,EAAIxd,OAAO,gDAAiD,SAASkxC,GACzEA,EAAInxC,gBAAgB,uBAGrBkxC,EAAuB,aAAVt/C,EAAEmH,KAAsBnH,EAAEnE,OAASssC,EAAUV,UAC1D6X,EAAazzB,EAAIkM,EAAEunB,GAAY94B,QAAQ4S,EAAO,QAAU,gBAAgB,GAEpEimB,EAAeC,EAAY5B,KAC9B8B,IACA7X,EAAWQ,EAAUE,UAAS,GAE1BgX,EAAe1X,EAAU2X,IAAeD,EAAelX,EAAUsX,QAAO,GAAOH,MAC7ElmB,GAASkmB,GAAc3X,GAAkC,QAAtBA,EAASp6B,eAChD6wC,GAAekB,OAMlBZ,KAGD,QAAS14C,GAAYwe,EAAK3e,EAAM1C,GAC3BqhB,GAAOA,EAAIxe,aACdwe,EAAIxe,YAAY,KAAOH,EAAM1C,GAI/B,QAASgD,GAAYqe,EAAK3e,EAAM1C,GAC3BqhB,GAAOA,EAAIre,aACdqe,EAAIre,YAAY,KAAON,EAAM1C,GAI/B,QAASu8C,GAAkB1/C,GAC1B,GAA2B7C,GAAK0I,EAAM85C,EAAQC,EAASC,EAASC,EAAWC,EAAvElkD,EAASmE,EAAEgH,UAEf7J,GAAMtB,EAAO8qB,wBACbm5B,EAAYE,EAAmB34C,QAAUlK,EAAIqB,KAC7CuhD,EAAYC,EAAmBn4C,QAAU1K,EAAIsB,GAG7C,KAAKoH,IAAQg5C,GAMZ,GALAc,EAASd,EAAch5C,GAEvB+5C,EAAU/jD,EAAOs/B,YAAcwkB,EAAO,GACtCE,EAAUhkD,EAAOu/B,aAAeukB,EAAO,GAEnC/Y,EAAIgZ,EAAUE,GAAa,GAAKlZ,EAAIiZ,EAAUE,GAAa,EAAG,CACjEjD,EAAiB6C,CACjB,OAKF5B,GAAgB,EAChBj7C,EAAOqI,KAAK,qBACXtP,OAAQohD,EACRv+C,MAAOu+C,EAAYriB,YACnBj8B,OAAQs+C,EAAYniB,eAErBh4B,EAAOklC,SAASG,UAAUxrB,QAC1ByhC,EAAeviD,EAAQgK,EAAMm6C,GAG9B,QAASh4C,GAAehI,GACnBA,EAAEgI,eACLhI,EAAEgI,iBAEFhI,EAAEkI,aAAc,EAIlB,QAAS+3C,GAAoBjgD,GAC5B,GAAInE,GAASmE,EAAEgH,UAEf,IAAI08B,EAAuB7nC,GAE1B,WADAmM,GAAehI,EAIhB,IAAInE,GAAUohD,EAAa,CAI1B,GAHAn6C,EAAOqI,KAAK,kBAAmBtP,OAAQA,IACvC+iD,IAE6C,IAAzC/iD,EAAOJ,GAAGoJ,QAAQ,mBAErB,YADA7E,EAAEkI,aAAc,EAIM,QAAnBrM,EAAO0R,UAAwC,SAAnB1R,EAAO0R,WACtCmxC,IACAzB,EAAcphD,EACdmK,EAAYnK,EAAQ,cAAe6jD,KAKtC,QAASd,KACRz4C,EAAY82C,EAAa,cAAeyC,GAGzC,QAASf,KACR,IAAK,GAAI94C,KAAQg5C,GAAe,CAC/B,GAAIr/C,GAASq/C,EAAch5C,EAEvBrG,GAAOglB,MACVqH,EAAI9gB,OAAOvL,EAAOglB,WACXhlB,GAAOglB,MAKjB,QAASg7B,KACR,IAEC18C,EAAOklC,SAASkY,YAAY,wBAAwB,GAAO,GAC1D,MAAOx/C,KAKV,QAASy/C,GAAc37B,GACtB,GAAIw2B,EAEJ,IAAK5hB,EAAL,CAIA4hB,EAAUkD,EAAYt7C,KAAK83C,oBAE3B,KAGC,MAFAM,GAAQL,WAAWn2B,GACnBw2B,EAAQ3sC,UACD,EACN,MAAO3N,MA0FV,QAAS+K,KACRwxC,EAAcG,EAAmB,KAE7BhkB,IACHwlB,IACAz4C,EAAYu3C,EAAa,gBAAiBuC,IAllB5C,GACIhD,GAAaG,EAAkBE,EAAcuB,EAAe/B,EAAgBkD,EAC5ErD,EAAQE,EAAQW,EAAcC,EAAcV,EAAQC,EAAQG,EAAOY,EACnEr/C,EAAOC,EAC6Di/C,EAAkBE,EAJtFjyB,EAAM/oB,EAAO+oB,IAAKvN,EAAO0C,EAAM1C,KAGhB4/B,EAAcp7C,EAAOklC,SAAUmW,EAAex7C,SAAUy2B,EAAOzzB,EAAIhC,IAAMgC,EAAIhC,GAAK,GACjGijC,EAAMhoC,KAAKgoC,IAAK9pC,EAAQ8B,KAAK9B,MAAO4gD,EAAc56C,EAAO+kC,SAG7DgX,IAMCuB,IAAK,EAAG,SACRC,IAAK,EAAG,EAAG,MACXC,IAAK,EAAG,EAAG,EAAG,GACdC,IAAK,EAAG,KAAO,GAIhB,IAAIC,GAAY,mBAkkBhB,OAjkBA19C,GAAO29C,cAAcnlD,KACpBklD,EAAY,mJASZA,EAAY,8CAGZA,EAAY,2BAA6BA,EAAY,iEAIrDA,EAAY,8CAEV76C,EAAI7B,MAAQ,GAAK,8BAClB,wDAID08C,EAAY,+QA2cb19C,EAAOqjB,GAAG,OAAQ,WACbiT,GAEHt2B,EAAOqjB,GAAG,gBAAiB,SAASnmB,GACV,SAArBA,EAAEnE,OAAO0R,WACZmxC,IACAyB,EAAcngD,EAAEnE,WAIlBmK,EAAY03C,EAAa,gBAAiBuC,GAE1Cn9C,EAAOqjB,GAAG,YAAa,SAASnmB,GAC/BggD,EAAqBhgD,MAGtBw/C,IAGI75C,EAAIhC,IAAM,KAGbb,EAAOqjB,GAAG,kBAAmB,SAASnmB,GACrC,GAAIuN,GAAWvN,EAAEnE,OAAO0R,UAEnBwwC,GAAiB,mBAAmBr5C,KAAK6I,KAC7CzK,EAAOqlC,UAAU95B,OAAOrO,EAAEnE,OAAoB,SAAZ0R,GAGpB,aAAVvN,EAAEmH,MACLrE,EAAOylC,iBAKVzlC,EAAO+oB,IAAIhtB,KAAK6+C,EAAa,kBAAmB,SAAS19C,GACxD,QAAS0gD,GAAcvpC,GACtBzR,EAAM7C,iBAAiBC,EAAQ,WAC9BA,EAAOqlC,UAAU95B,OAAO8I,KAI1B,MAAIusB,GAAuB1jC,EAAEnE,SAC5BmE,EAAEgI,qBACF04C,GAAc1gD,EAAEnE,cAIb,mBAAmB6I,KAAK1E,EAAEnE,OAAO0R,YACpCvN,EAAEgI,iBAIsB,OAApBhI,EAAEnE,OAAO4qC,SACZia,EAAc1gD,EAAEnE,aAOrB,IAAI8kD,GAA4Bj7C,EAAMxC,SAAS,SAASlD,GAClD8C,EAAO89C,WACXxB,EAAiBp/C,IAInB8C,GAAOqjB,GAAG,4CAA6Cw6B,GAGvD79C,EAAOqjB,GAAG,uBAAwB,SAASnmB,GAEtCi9C,GAAuC,SAAxBA,EAAY1vC,UAC9BozC,EAA0B3gD,KAI5B8C,EAAOqjB,GAAG,YAAau4B,KAMxB57C,EAAOqjB,GAAG,SAAUw4B,IAYnBzC,YAAaA,EACbkC,eAAgBA,EAChBM,eAAgBA,EAChBU,iBAAkBA,EAClBe,cAAeA,EACf10C,QAASA,MAuBZjQ,EAAO,sBAAwB,WAG9B,QAASqlD,GAASrgD,GACjB,MAAO,YACN,MAAOA,IAIT,QAASsgD,GAAO1hC,GACf,MAAO,UAAS5iB,GACf,OAAQ4iB,EAAU5iB,IAIpB,QAASukD,GAAQliC,EAAGqJ,GACnB,MAAO,UAAS1rB,GACf,MAAOqiB,GAAEqJ,EAAE1rB,KAIb,QAASwkD,KACR,GAAI3/C,GAAOC,EAAMlB,KAAKxE,UAEtB,OAAO,UAASY,GACf,IAAK,GAAItB,GAAI,EAAGA,EAAImG,EAAKlG,OAAQD,IAChC,GAAImG,EAAKnG,GAAGsB,GACX,OAAO,CAIT,QAAO,GAIT,QAASykD,KACR,GAAI5/C,GAAOC,EAAMlB,KAAKxE,UAEtB,OAAO,UAASY,GACf,IAAK,GAAItB,GAAI,EAAGA,EAAImG,EAAKlG,OAAQD,IAChC,IAAKmG,EAAKnG,GAAGsB,GACZ,OAAO,CAIT,QAAO,GAIT,QAAS0kD,GAAMpiD,GACd,GAAIuC,GAAOC,EAAMlB,KAAKxE,UAEtB,OAAIyF,GAAKlG,OAAS,GAAK2D,EAAG3D,OAClB2D,EAAGvD,MAAM0D,KAAMoC,EAAKC,MAAM,IAG3B,WACN,GAAI6/C,GAAW9/C,EAAK6J,UAAU5J,MAAMlB,KAAKxE,WACzC,OAAOslD,GAAM3lD,MAAM0D,KAAMkiD,IAzD3B,GAAI7/C,MAAWA,KA6Df,QACCu/C,SAAUA,EACVC,OAAQA,EACRG,IAAKA,EACLD,GAAIA,EACJE,MAAOA,EACPH,QAASA,KAuBXvlD,EAAO,gCACN,uBACA,mBACA,gCACE,SAASqoC,EAAUxkB,EAAKqlB,GAU1B,QAAS0c,GAAiBjqC,GACzB,OAAI8sB,EAAiB9sB,KAIjBmsB,EAAOnsB,IACNkqC,EAAqBlqC,EAAKrM,YAOxBw2C,EAAenqC,IAASqsB,EAAKrsB,IAASoqC,EAAQpqC,IAASusB,EAAuBvsB,IAGtF,QAASqqC,GAAarqC,EAAMkU,GAC3B,IAAKlU,EAAOA,EAAKrM,WAAYqM,GAAQA,GAAQkU,EAAUlU,EAAOA,EAAKrM,WAAY,CAC9E,GAAI44B,EAAuBvsB,GAC1B,OAAO,CAGR,IAAIssB,EAAsBtsB,GACzB,OAAO,EAIT,OAAO,EAGR,QAASsqC,GAA6BtqC,GACrC,QAAKusB,EAAuBvsB,IAIrBkI,EAAIN,OAAO5H,EAAK3L,qBAAqB,KAAM,SAASmP,EAAQ6J,GAClE,MAAO7J,IAAU8oB,EAAsBjf,KACrC,MAAW,EAGf,QAASk9B,GAASvqC,GACjB,MAAOmqC,GAAenqC,IAASsqC,EAA6BtqC,GAG7D,QAASwqC,GAAyBxqC,EAAMkU,GACvC,MAAO+1B,GAAiBjqC,IAASqqC,EAAarqC,EAAMkU,GAtDrD,GAAIoY,GAAwBI,EAASJ,sBACpCC,EAAyBG,EAASH,uBAClCF,EAAOK,EAASL,KAChBF,EAASO,EAASP,OAClB+d,EAAuBxd,EAASlB,eAAe,yBAC/C2e,EAAiBzd,EAASlB,eAAe,mDACzC4e,EAAU1d,EAASlB,eAAe,SAClCsB,EAAmBS,EAAeT,gBAkDnC,QACCmd,iBAAkBA,EAClBI,aAAcA,EACdE,SAAUA,EACVC,yBAA0BA,KAsB5BnmD,EAAO,6BAA+B,WAGrC,QAASoqB,GAAMvpB,GACd,MAAKA,IAKJmC,KAAM1B,EAAMT,EAAKmC,MACjBC,IAAK3B,EAAMT,EAAKoC,KAChB8qB,OAAQzsB,EAAMT,EAAKktB,QACnBD,MAAOxsB,EAAMT,EAAKitB,OAClB5qB,MAAO5B,EAAMT,EAAKqC,OAClBC,OAAQ7B,EAAMT,EAAKsC,UATXH,KAAM,EAAGC,IAAK,EAAG8qB,OAAQ,EAAGD,MAAO,EAAG5qB,MAAO,EAAGC,OAAQ,GAalE,QAAS4tB,GAAShuB,EAAYqjD,GAY7B,MAXArjD,GAAaqnB,EAAMrnB,GAEfqjD,EACHrjD,EAAW+qB,MAAQ/qB,EAAWC,MAE9BD,EAAWC,KAAOD,EAAWC,KAAOD,EAAWG,MAC/CH,EAAW+qB,MAAQ/qB,EAAWC,MAG/BD,EAAWG,MAAQ,EAEZH,EAGR,QAAS2oC,GAAQ2a,EAAOC,GACvB,MACCD,GAAMrjD,OAASsjD,EAAMtjD,MACrBqjD,EAAMpjD,MAAQqjD,EAAMrjD,KACpBojD,EAAMt4B,SAAWu4B,EAAMv4B,QACvBs4B,EAAMv4B,QAAUw4B,EAAMx4B,MAIxB,QAASy4B,GAAgBC,EAAWC,EAAaC,GAChD,MAAOF,IAAa,GAAKA,GAAapjD,KAAKhB,IAAIqkD,EAAYtjD,OAAQujD,EAAYvjD,QAAU,EAI1F,QAASwjD,GAAQF,EAAaC,GAC7B,MAAID,GAAY14B,OAAS24B,EAAYzjD,OAIjCwjD,EAAYxjD,IAAMyjD,EAAY34B,SAI3Bw4B,EAAgBG,EAAYzjD,IAAMwjD,EAAY14B,OAAQ04B,EAAaC,GAG3E,QAASE,GAAQH,EAAaC,GAC7B,MAAID,GAAYxjD,IAAMyjD,EAAY34B,UAI9B04B,EAAY14B,OAAS24B,EAAYzjD,MAI9BsjD,EAAgBG,EAAY34B,OAAS04B,EAAYxjD,IAAKwjD,EAAaC,GAG3E,QAAS7wB,GAAO4wB,EAAaC,GAC5B,MAAOD,GAAYzjD,KAAO0jD,EAAY1jD,KAGvC,QAAS6jD,GAAQJ,EAAaC,GAC7B,MAAOD,GAAY34B,MAAQ44B,EAAY54B,MAGxC,QAAS3Q,GAAQspC,EAAaC,GAC7B,MAAIC,GAAQF,EAAaC,MAIrBE,EAAQH,EAAaC,GACjB,EAGJ7wB,EAAO4wB,EAAaC,MAIpBG,EAAQJ,EAAaC,GACjB,EAGD,EAGR,QAASI,GAAW/jD,EAAY8I,EAASQ,GACxC,MACCR,IAAW9I,EAAWC,MACtB6I,GAAW9I,EAAW+qB,OACtBzhB,GAAWtJ,EAAWE,KACtBoJ,GAAWtJ,EAAWgrB,OAvGxB,GAAIzsB,GAAQ8B,KAAK9B,KA2GjB,QACC8oB,MAAOA,EACP2G,SAAUA,EACV2a,QAASA,EACTib,QAASA,EACTC,QAASA,EACT/wB,OAAQA,EACRgxB,QAASA,EACT1pC,QAASA,EACT2pC,WAAYA,KAwBd9mD,EAAO,gCAAkC,WA2BxC,QAAS+mD,GAAgBC,GACxB,MAAoB,gBAANA,IAAkBA,EAAGjtB,WAAW,IAAM,KAAOktB,EAAe/9C,KAAK89C,GAzBhF,GAAIC,GAAiB,GAAIltC,QACxB;AA2BD,OACCgtC,gBAAiBA,KA2BnB/mD,EAAO,+BACN,mBACA,uBACA,uBACA,yBACA,+BACA,0BACA,8BACE,SAASknD,EAAK7e,EAAU9K,EAAU6L,EAAY+d,EAAgBC,EAAYC,GAY5E,QAASC,GAAa3wB,GACrB,MAAOA,IAAO,YAAYztB,KAAKytB,GAGhC,QAAS4wB,GAAwB19C,GAChC,GAECqW,GAFGlS,EAAYnE,EAAMioB,eACrB7G,EAASphB,EAAMmoB,WAGhB,UAAIs1B,EAAaz9C,EAAMlE,aAAe6hD,EAASx5C,EAAUsB,cACxD4Q,EAAOlS,EAAU7C,KAEbm8C,EAAapnC,EAAK+K,EAAS,KAAOq8B,EAAapnC,EAAK+K,EAAS,MAQnE,QAASw8B,GAA4BC,GAKpC,QAASC,GAAgBC,GACxB,GAIC7kD,GAJGiJ,EAAM47C,EAAO77C,cAChBs9B,EAAMr9B,EAAIw3B,cACVqkB,EAAO77C,EAAI8oB,eAAe,KAC1BxlB,EAAas4C,EAAOt4C,UASrB,OANAA,GAAWwX,aAAa+gC,EAAMD,GAC9Bve,EAAI/Y,SAASu3B,EAAM,GACnBxe,EAAI5Y,OAAOo3B,EAAM,GACjB9kD,EAAaqkD,EAAWh9B,MAAMif,EAAIle,yBAClC7b,EAAWoE,YAAYm0C,GAEhB9kD,EAGR,QAASooB,GAAsBhI,GAC9B,GAAIpgB,GAAY+kD,CAShB,OAPAA,GAAc3kC,EAAKgoB,iBAElBpoC,EADG+kD,EAAYnoD,OAAS,EACXynD,EAAWh9B,MAAM09B,EAAY,IAE7BV,EAAWh9B,MAAMjH,EAAKgI,yBAGhC6c,EAAK7kB,IAA6B,IAApBpgB,EAAWC,KACrB2kD,EAAgBxkC,GAGjBpgB,EAGR,QAASglD,GAAwBhlD,EAAYqjD,GAK5C,MAJArjD,GAAaqkD,EAAWr2B,SAAShuB,EAAYqjD,GAC7CrjD,EAAWG,MAAQ,EACnBH,EAAW+qB,MAAQ/qB,EAAWC,KAAO,EAE9BD,EAGR,QAASilD,GAAsBjlD,GACJ,IAAtBA,EAAWI,SAIX2kD,EAAYnoD,OAAS,GACpBynD,EAAW1b,QAAQ3oC,EAAY+kD,EAAYA,EAAYnoD,OAAS,KAKrEmoD,EAAYhoD,KAAKiD,IAGlB,QAASklD,GAAmBj6C,EAAWid,GACtC,GAAIphB,GAAQmE,EAAUjC,cAAcy3B,aAEpC,IAAIvY,EAASjd,EAAU7C,KAAKxL,OAAQ,CACnC,GAAI0nD,EAAcN,gBAAgB/4C,EAAU7C,KAAK8f,IAChD,MAAO68B,EAKR,IAAIT,EAAcN,gBAAgB/4C,EAAU7C,KAAK8f,EAAS,MACzDphB,EAAMymB,SAAStiB,EAAWid,GAC1BphB,EAAM4mB,OAAOziB,EAAWid,EAAS,IAE5Bs8B,EAAwB19C,IAE5B,MADAm+C,GAAsBD,EAAwB58B,EAAsBthB,IAAQ,IACrEi+C,EAKN78B,EAAS,IACZphB,EAAMymB,SAAStiB,EAAWid,EAAS,GACnCphB,EAAM4mB,OAAOziB,EAAWid,GAEnBs8B,EAAwB19C,IAC5Bm+C,EAAsBD,EAAwB58B,EAAsBthB,IAAQ,KAI1EohB,EAASjd,EAAU7C,KAAKxL,SAC3BkK,EAAMymB,SAAStiB,EAAWid,GAC1BphB,EAAM4mB,OAAOziB,EAAWid,EAAS,GAE5Bs8B,EAAwB19C,IAC5Bm+C,EAAsBD,EAAwB58B,EAAsBthB,IAAQ,KA9F/E,GAAsBq+C,GAAYvsC,EAA9BmsC,IAmGJ,IAAIhgB,EAAO4f,EAAc15C,aAExB,MADAi6C,GAAmBP,EAAc15C,YAAa05C,EAAcz8B,UACrD68B,CAGR,IAAIxgB,EAAUogB,EAAc15C,aAC3B,GAAI05C,EAAcS,UACjBxsC,EAAOysC,EAAaV,EAAc15C,YAAa05C,EAAcz8B,UACzD6c,EAAOnsB,IACVssC,EAAmBtsC,EAAMA,EAAKxQ,KAAKxL,QAGhC0oD,EAA6B1sC,KAAUqsB,EAAKrsB,IAC/CqsC,EAAsBD,EAAwB58B,EAAsBxP,IAAO,QAEtE,CAMN,GALAA,EAAOysC,EAAaV,EAAc15C,YAAa05C,EAAcz8B,UACzD6c,EAAOnsB,IACVssC,EAAmBtsC,EAAM,GAGtB0sC,EAA6B1sC,IAAS+rC,EAAcS,UAEvD,MADAH,GAAsBD,EAAwB58B,EAAsBxP,IAAO,IACpEmsC,CAGRI,GAAaE,EAAaV,EAAc15C,YAAa05C,EAAcz8B,SAAW,GAC1Eo9B,EAA6BH,KAAgBlgB,EAAKkgB,KACjD5pB,EAAQ4pB,IAAe5pB,EAAQ3iB,KAAU0sC,EAA6B1sC,KACzEqsC,EAAsBD,EAAwB58B,EAAsB+8B,IAAa,IAI/EG,EAA6B1sC,IAChCqsC,EAAsBD,EAAwB58B,EAAsBxP,IAAO,IAK9E,MAAOmsC,GAWR,QAASQ,GAAct6C,EAAWid,EAAQ68B,GACzC,QAASS,KACR,MAAIzgB,GAAO95B,GACQ,IAAXid,EAGU,IAAXA,EAGR,QAASk9B,KACR,MAAIrgB,GAAO95B,GACHid,GAAUjd,EAAU7C,KAAKxL,OAG1BsrB,GAAUjd,EAAUyN,WAAW9b,OAGvC,QAAS6oD,KACR,GAAI3+C,EAMJ,OAJAA,GAAQmE,EAAUjC,cAAcy3B,cAChC35B,EAAMymB,SAAStiB,EAAWid,GAC1BphB,EAAM4mB,OAAOziB,EAAWid,GAEjBphB,EAGR,QAASshC,KAKR,MAJK2c,KACJA,EAAcL,EAA4B,GAAIa,GAAct6C,EAAWid,KAGjE68B,EAGR,QAASW,KACR,MAAOtd,KAAiBxrC,OAAS,EAGlC,QAAS+rC,GAAQgc,GAChB,MAAOA,IAAiB15C,IAAc05C,EAAc15C,aAAeid,IAAWy8B,EAAcz8B,SAG7F,QAASghB,GAAQviB,GAChB,MAAO0+B,GAAap6C,EAAW0b,EAASuB,EAAS,EAAIA,GAGtD,OAOCjd,UAAWk5C,EAAI7B,SAASr3C,GAQxBid,OAAQi8B,EAAI7B,SAASp6B,GAQrBu9B,QAASA,EASTrd,eAAgBA,EAQhBsd,UAAWA,EAQXF,UAAWA,EAQXJ,QAASA,EAUTzc,QAASA,EASTO,QAASA,GA/SX,GAAI3E,GAAYe,EAASf,UACxBse,EAAmBuB,EAAevB,iBAClCtnB,EAAU+J,EAASjB,iBAAiB,UAAW,eAC/CshB,EAAYrgB,EAASjB,iBAAiB,QAAS,cAC/CihB,EAA+BnB,EAAIzB,IAAIne,EAAWse,EAAkBsB,EAAI5B,OAAOoD,IAC/ElB,EAAWN,EAAI5B,OAAOjd,EAASjB,iBAAiB,cAAe,0BAC/DU,EAASO,EAASP,OAClBE,EAAOK,EAASL,KAChBvoB,EAAY8d,EAAS9d,UACrB2oC,EAAehf,EAAW6C,OAsV3B,OArCAqc,GAAcK,eAAiB,SAAS9+C,GACvC,MAAO,IAAIy+C,GAAcz+C,EAAMioB,eAAgBjoB,EAAMmoB,cAUtDs2B,EAAcM,aAAe,SAAS/+C,GACrC,MAAO,IAAIy+C,GAAcz+C,EAAMqoB,aAAcroB,EAAMuoB,YAUpDk2B,EAAc3+B,MAAQ,SAAShO,GAC9B,MAAO,IAAI2sC,GAAc3sC,EAAKrM,WAAYmQ,EAAU9D,GAAQ,IAU7D2sC,EAAc5+B,OAAS,SAAS/N,GAC/B,MAAO,IAAI2sC,GAAc3sC,EAAKrM,WAAYmQ,EAAU9D,KAG9C2sC,IAiCRtoD,EAAO,+BACN,uBACA,uBACA,mBACA,mBACA,+BACE,SAASqoC,EAAUwgB,EAAU3B,EAAKrjC,EAAKykC,GAKzC,QAASQ,GAAiBntC,GACzB,GAAIrM,GAAaqM,EAAKrM,UAEtB,OAAIq4B,GAAQr4B,GACJw5C,EAAiBx5C,GAGlBA,EAGR,QAASy5C,GAAcptC,GACtB,MAAKA,GAIEkI,EAAIN,OAAO5H,EAAKF,WAAY,SAAS0D,EAAQxD,GAOnD,MANIgsB,GAAQhsB,IAA0B,MAAjBA,EAAK5J,SACzBoN,EAASA,EAAOzP,OAAOq5C,EAAcptC,IAErCwD,EAAOrf,KAAK6b,GAGNwD,UAIT,QAAS6pC,GAAqBrgB,EAAU1d,GACvC,MAAQ0d,EAAWA,EAASxT,kBACtB2S,EAAOa,IAIZ1d,GAAU0d,EAASx9B,KAAKxL,MAGzB,OAAOsrB,GAGR,QAASg+B,GAAMC,GACd,MAAO,UAASlkD,GACf,MAAOkkD,KAAgBlkD,GAIzB,QAASmkD,GAAoBxtC,GAC5B,GAAI2M,GAAOlF,EAAOgmC,CAgBlB,OAdA9gC,GAAQygC,EAAcD,EAAiBntC,IACvCyH,EAAQS,EAAIF,UAAU2E,EAAO2gC,EAAMttC,GAAOA,GAC1C2M,EAAQA,EAAMxiB,MAAM,EAAGsd,EAAQ,GAC/BgmC,EAAmBvlC,EAAIN,OAAO+E,EAAO,SAASnJ,EAAQxD,EAAMjc,GAK3D,MAJIooC,GAAOnsB,IAASmsB,EAAOxf,EAAM5oB,EAAI,KACpCyf,IAGMA,GACL,GAEHmJ,EAAQzE,EAAIxN,OAAOiS,EAAO+f,EAASlB,eAAexrB,EAAK5J,WACvDqR,EAAQS,EAAIF,UAAU2E,EAAO2gC,EAAMttC,GAAOA,GAEnCyH,EAAQgmC,EAGhB,QAASC,GAAe1tC,GACvB,GAAItR,EAQJ,OALCA,GADGy9B,EAAOnsB,GACH,SAEAA,EAAK5J,SAASC,cAGf3H,EAAO,IAAM8+C,EAAoBxtC,GAAQ,IAGjD,QAAS+P,GAAamE,EAAUlU,EAAMiI,GACrC,GAAIyH,KAEJ,KAAK1P,EAAOA,EAAKrM,WAAYqM,GAAQkU,KAChCjM,IAAaA,EAAUjI,IADmBA,EAAOA,EAAKrM,WAK1D+b,EAAQvrB,KAAK6b,EAGd,OAAO0P,GAGR,QAAS9pB,GAAOsuB,EAAU63B,GACzB,GAAI15C,GAAWid,EACdq+B,EAAc7tC,EAAY4P,EADJtgB,IA2BvB,OAxBAiD,GAAY05C,EAAc15C,YAC1Bid,EAASy8B,EAAcz8B,SAEnB6c,EAAO95B,GACVs7C,EAAeN,EAAqBh7C,EAAWid,IAE/CxP,EAAazN,EAAUyN,WACnBwP,GAAUxP,EAAW9b,QACxB2pD,EAAe,QACfr+B,EAASxP,EAAW9b,OAAS,GAE7B2pD,EAAe,SAGhBt7C,EAAYyN,EAAWwP,IAGxBlgB,EAAKjL,KAAKupD,EAAer7C,IACzBqd,EAAUK,EAAamE,EAAU7hB,GACjCqd,EAAUxH,EAAIxN,OAAOgV,EAAS67B,EAAI5B,OAAOjd,EAASV,UAClD58B,EAAOA,EAAK2E,OAAOmU,EAAIzN,IAAIiV,EAAS,SAAS1P,GAC5C,MAAO0tC,GAAe1tC,MAGhB5Q,EAAKqb,UAAU3T,KAAK,KAAO,IAAM62C,EAGzC,QAASC,GAAgB5tC,EAAMtR,EAAM+Y,GACpC,GAAIkF,GAAQygC,EAAcptC,EAO1B,OALA2M,GAAQzE,EAAIxN,OAAOiS,EAAO,SAAS3M,EAAMyH,GACxC,OAAQ0kB,EAAOnsB,KAAUmsB,EAAOxf,EAAMlF,EAAQ,MAG/CkF,EAAQzE,EAAIxN,OAAOiS,EAAO+f,EAASlB,eAAe98B,IAC3Cie,EAAMlF,GAGd,QAASomC,GAAiBx7C,EAAWid,GAGpC,IAFA,GAAwCw+B,GAApC9tC,EAAO3N,EAAW07C,EAAe,EAE9B5hB,EAAOnsB,IAAO,CAGpB,GAFA8tC,EAAU9tC,EAAKxQ,KAAKxL,OAEhBsrB,GAAUy+B,GAAgBz+B,GAAUy+B,EAAeD,EAAS,CAC/Dz7C,EAAY2N,EACZsP,GAAkBy+B,CAClB,OAGD,IAAK5hB,EAAOnsB,EAAKpH,aAAc,CAC9BvG,EAAY2N,EACZsP,EAASw+B,CACT,OAGDC,GAAgBD,EAChB9tC,EAAOA,EAAKpH,YAOb,MAJI0W,GAASjd,EAAU7C,KAAKxL,SAC3BsrB,EAASjd,EAAU7C,KAAKxL,QAGlB,GAAI2oD,GAAct6C,EAAWid,GAGrC,QAASprB,GAAQgwB,EAAU9kB,GAC1B,GAAI4+C,GAAO37C,EAAWid,CAEtB,OAAKlgB,IAIL4+C,EAAQ5+C,EAAKxK,MAAM,KACnBwK,EAAO4+C,EAAM,GAAGppD,MAAM,KACtB0qB,EAAS0+B,EAAMhqD,OAAS,EAAIgqD,EAAM,GAAK,SAEvC37C,EAAY6V,EAAIN,OAAOxY,EAAM,SAASoU,EAAQna,GAE7C,OADAA,EAAQ,4BAA4BoE,KAAKpE,KAKxB,WAAbA,EAAM,KACTA,EAAM,GAAK,SAGLukD,EAAgBpqC,EAAQna,EAAM,GAAI4nB,SAAS5nB,EAAM,GAAI,MAPpD,MAQN6qB,GAEE7hB,EAIA85B,EAAO95B,GAULw7C,EAAiBx7C,EAAW4e,SAAS3B,EAAQ,MARlDA,EADc,UAAXA,EACMxL,EAAUzR,GAAa,EAEvByR,EAAUzR,GAGb,GAAIs6C,GAAct6C,EAAUsB,WAAY2b,IAVxC,MArBA,KAzKT,GAAI6c,GAASO,EAASP,OACrBH,EAAUU,EAASV,QACnBloB,EAAYopC,EAASppC,SA4MtB,QASCle,OAAQA,EAUR1B,QAASA,KAqBXG,EAAO,+BACN,cACA,qBACA,+BACA,8BACA,8BACA,wBACE,SAASmK,EAAKqb,EAAO0jB,EAAgB0gB,EAAetB,EAAejgB,GAUrE,QAASwhB,GAAgBld,GACxB,GAAItc,GAAMsc,EAAUtc,GAmBpB5sB,MAAK66C,YAAc,SAAS3yC,EAAM0xB,GAGjC,QAAS1Z,GAAUtZ,EAAM/D,GACxB,GAAI6H,GAAQ,CAcZ,OAZAqX,GAAM1C,KAAKuN,EAAIxd,OAAOxI,GAAO,SAASsR,GACrC,GAA4C,QAAxCA,EAAKzJ,aAAa,kBAItB,MAAIyJ,IAAQrV,OAIZ6H,OAGMA,EAGR,QAAS27C,GAA4BzgB,GACpC,QAAS0gB,GAAarqC,GACrB,GAAI1R,GAAWid,EAAQxP,EAAYkS,EAASjO,EAAQ,QAAU,KAE9D1R,GAAYq7B,EAAI1b,EAAS,aACzB1C,EAASoe,EAAI1b,EAAS,UAEI,GAAtB3f,EAAUgB,UAAuC,MAAtBhB,EAAU+D,WACxC0J,EAAazN,EAAUyN,WACvBzN,EAAYyN,EAAWrY,KAAKhB,IAAIsd,EAAQuL,EAASA,EAAS,EAAGxP,EAAW9b,OAAS,IAC7EqO,IACHid,EAASvL,EAAQ,EAAI1R,EAAUyN,WAAW9b,OAC1C0pC,EAAI,OAAS3pB,EAAQ,QAAU,QAAQ1R,EAAWid,KAQrD,MAHA8+B,IAAa,GACbA,IAEO1gB,EAGR,QAAS2gB,GAAY3gB,GAGpB,QAAS4gB,GAAS5gB,EAAK3pB,GACtB,GACgE/D,GAAMF,EADlEzN,EAAYq7B,EAAI3pB,EAAQ,iBAAmB,gBAC9CuL,EAASoe,EAAI3pB,EAAQ,cAAgB,aAAcksB,KAA8BjiB,EAAQ,CAE1F,IAA0B,GAAtB3b,EAAUgB,SAAe,CAC5B,GAAIquB,EACH,IAAK1hB,EAAO3N,EAAUmnB,gBAAiBxZ,GAAyB,GAAjBA,EAAK3M,SAAe2M,EAAOA,EAAKwZ,gBAC9ElK,GAAUtP,EAAK2C,UAAU3e,MAI3BisC,GAAM9rC,KAAKmrB,OAEXxP,GAAazN,EAAUyN,WAEnBwP,GAAUxP,EAAW9b,QAAU8b,EAAW9b,SAC7CgqB,EAAQ,EACRsB,EAAS7nB,KAAKjB,IAAI,EAAGsZ,EAAW9b,OAAS,IAG1CisC,EAAM9rC,KAAKuwB,EAAI5Q,UAAUhE,EAAWwP,GAASoS,GAAc1T,EAG5D,MAAO3b,GAAaA,GAAawS,EAAMxS,EAAYA,EAAUsB,WAC5Ds8B,EAAM9rC,KAAKuwB,EAAI5Q,UAAUzR,EAAWqvB,GAGrC,OAAOuO,GA7BR,GAAIprB,GAAO6P,EAAIgO,UAAW+f,IAsC1B,OANAA,GAAS1+B,MAAQuqC,EAAS5gB,GAAK,GAE1BsD,EAAUG,gBACdsR,EAASxJ,IAAMqV,EAAS5gB,IAGlB+U,EAGR,QAAS8L,GAAoC7gB,GAC5C,QAASvZ,GAAYnU,GACpB,GAAIwL,EAEJ,IAAI+hB,EAAeT,iBAAiB9sB,GAAO,CAM1C,GALI0sB,EAASP,OAAOnsB,IAASutB,EAAeX,sBAAsB5sB,KACjEA,EAAOA,EAAKrM,YAGb6X,EAAUxL,EAAKwZ,gBACX+S,EAAuB/gB,GAC1B,MAAOA,EAIR,IADAA,EAAUxL,EAAKpH,YACX2zB,EAAuB/gB,GAC1B,MAAOA,IAKV,MAAO2I,GAAYuZ,EAAIvX,iBAAmBhC,EAAYuZ,EAAInX,cA1G3D,GAAImX,GAAKmC,EAAMvrC,EAAIoxB,EAAWhnB,EAAM/D,EAA2B0nB,EAAlB2I,EAAM,UA6GnD,IAAY,GAARhrB,EAKH,MAJArF,GAAUqmC,EAAUV,UACpB5hC,EAAO/D,EAAUA,EAAQyL,SAAW,KACpCs3B,EAAMsD,EAAUC,SAEZ1E,EAAuB5hC,IAAoB,OAAR+D,GAC9BA,KAAMA,EAAM+Y,MAAOO,EAAUtZ,EAAM/D,IAGxCqmC,EAAUwd,WACNxd,EAAUwd,WAAW7L,YAAY3yC,IAGzCrF,EAAU4jD,EAAoC7gB,GAC1C/iC,GACH+D,EAAO/D,EAAQ2kC,SACP5gC,KAAMA,EAAM+Y,MAAOO,EAAUtZ,EAAM/D,KAGrC0jD,EAAY3gB,GAGpB,IAAY,GAAR19B,EAGH,MAFA09B,GAAMsD,EAAUC,UAGfltB,MAAOkqC,EAAcroD,OAAO8uB,EAAIgO,UAAWiqB,EAAcK,eAAetf,IACxEuL,IAAKgV,EAAcroD,OAAO8uB,EAAIgO,UAAWiqB,EAAcM,aAAavf,IAKtE,IAAI19B,EACH,OAAQ09B,IAAKsD,EAAUC,SASxB,IANAvD,EAAMsD,EAAUC,SAChB3sC,EAAKowB,EAAIgS,WACThR,EAAYsb,EAAUG,cACtB9e,EAAS,kCAGLqb,EAAIoC,WAAapC,EAAIlmB,KAAM,CAE9B,GAAKkmB,EAAIlmB,KA8BR,MAHA7c,GAAU+iC,EAAIlmB,KAAK,GACnB9Y,EAAO/D,EAAQyL,UAEP1H,KAAMA,EAAM+Y,MAAOO,EAAUtZ,EAAM/D,GA7B3CklC,GAAOnC,EAAIoC,WAEX,KAECpC,EAAItY,WACJsY,EAAI+gB,UAAU,sCAAwCnqD,EAAK,kBAAoB+tB,EAAS,KAAO2I,EAAM,WAGhGtF,IACJma,EAAKza,UAAS,GAIdsY,EAAI6B,kBAAkBM,EAAKkS,iBACsB,IAA7CrU,EAAIuU,iBAAiB,aAAcpS,IACtCA,EAAKqS,KAAK,gBAGXrS,EAAK4e,UAAU,sCAAwCnqD,EAAK,gBAAkB+tB,EAAS,KAAO2I,EAAM,YAEpG,MAAOzxB,GAER,MAAO,WASH,CAGN,GAFAoB,EAAUqmC,EAAUV,UACpB5hC,EAAO/D,EAAQyL,SACH,OAAR1H,EACH,OAAQA,KAAMA,EAAM+Y,MAAOO,EAAUtZ,EAAM/D,GAI5CklC,GAAOse,EAA4BzgB,EAAInW,cAGlC7B,IACJma,EAAKza,UAAS,GACdya,EAAK3Y,WAAWxC,EAAI9uB,OAAO,QAAS8oD,gBAAiB,WAAYpqD,GAAIA,EAAK,OAAQgpB,MAAO+E,GAAS2I,KAGnG0S,EAAMygB,EAA4BzgB,GAClCA,EAAItY,UAAS,GACbsY,EAAIxW,WAAWxC,EAAI9uB,OAAO,QAAS8oD,gBAAiB,WAAYpqD,GAAIA,EAAK,SAAUgpB,MAAO+E,GAAS2I,IAKpG,MAFAgW,GAAU4R,gBAAgBt+C,GAAIA,EAAIqqD,KAAM,KAEhCrqD,GAAIA,IAkBbwD,KAAK86C,eAAiB,SAASH,GAG9B,QAASa,GAAYv/B,GACpB,GAA+ChgB,GAAGic,EAAMsP,EAAQlb,EAA5D67B,EAAQwS,EAAS1+B,EAAQ,QAAU,MAEvC,IAAIksB,EAAO,CAIV,IAHA3gB,EAAS2gB,EAAM,GAGVjwB,EAAO6E,EAAM9gB,EAAIksC,EAAMjsC,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAGpD,GAFAqQ,EAAW4L,EAAKF,WAEZmwB,EAAMlsC,GAAKqQ,EAASpQ,OAAS,EAChC,MAGDgc,GAAO5L,EAAS67B,EAAMlsC,IAID,IAAlBic,EAAK3M,WACRic,EAAS7nB,KAAKhB,IAAIwpC,EAAM,GAAIjwB,EAAK2C,UAAU3e,SAItB,IAAlBgc,EAAK3M,WACRic,EAAS7nB,KAAKhB,IAAIwpC,EAAM,GAAIjwB,EAAKF,WAAW9b,SAIzC+f,EACH2pB,EAAI/Y,SAAS3U,EAAMsP,GAEnBoe,EAAI5Y,OAAO9U,EAAMsP,GAInB,OAAO,EAGR,QAASs/B,GAAgB38B,GACxB,GAAkDjS,GAAMmE,EAAKwL,EAAMC,EAA/D8zB,EAAShvB,EAAI5H,IAAI21B,EAASn+C,GAAK,IAAM2tB,GAAgC08B,EAAOlM,EAASkM,IAEzF,IAAIjL,IACH1jC,EAAO0jC,EAAO/vC,WAEA,SAAVse,GACE08B,GAGJ3uC,EAAO0jC,EAAOhhC,WACdyB,EAAM,GAHNA,EAAMuQ,EAAI5Q,UAAU4/B,GAMrBvtB,EAAiBI,EAAevW,EAChCqW,EAAcI,EAAYtS,IAErBwqC,GAGJ3uC,EAAO0jC,EAAOhhC,WACdyB,EAAM,GAHNA,EAAMuQ,EAAI5Q,UAAU4/B,GAMrBntB,EAAevW,EACfyW,EAAYtS,IAGRwqC,GAAM,CAcV,IAbA/+B,EAAO8zB,EAAOlqB,gBACd7J,EAAO+zB,EAAO9qC,YAGdiR,EAAM1C,KAAK0C,EAAMF,KAAK+5B,EAAO5jC,YAAa,SAASE,GAC7B,GAAjBA,EAAK3M,WACR2M,EAAK2C,UAAY3C,EAAK2C,UAAUnM,QAAQ,UAAW,OAO7CktC,EAAShvB,EAAI5H,IAAI21B,EAASn+C,GAAK,IAAM2tB,IAC5CyC,EAAI/G,OAAO+1B,EAAQ,EAMhB9zB,IAAQD,GAAQC,EAAKvc,UAAYsc,EAAKtc,UAA6B,GAAjBuc,EAAKvc,WAAkB7E,EAAIlC,QAChF6X,EAAMyL,EAAKjN,UAAU3e,OACrB4rB,EAAKi/B,WAAWl/B,EAAKhN,WACrB+R,EAAI/G,OAAOgC,GAEG,SAAVsC,GACHkE,EAAiBI,EAAe3G,EAChCyG,EAAcI,EAAYtS,IAE1BoS,EAAe3G,EACf6G,EAAYtS,KAOjB,QAAS2qC,GAAS9uC,GAMjB,OAJI0U,EAAIiO,QAAQ3iB,IAAUA,EAAKa,WAAcrS,EAAIhC,KAChDwT,EAAKa,UAAY,6BAGXb,EAGR,QAAS+uC,KACR,GAAIrhB,GAAK1nC,CAST,OAPA0nC,GAAMhZ,EAAIkT,YACV5hC,EAAMioD,EAAc/pD,QAAQwwB,EAAIgO,UAAW+f,EAAS1+B,OACpD2pB,EAAI/Y,SAAS3uB,EAAIqM,YAAarM,EAAIspB,UAElCtpB,EAAMioD,EAAc/pD,QAAQwwB,EAAIgO,UAAW+f,EAASxJ,KACpDvL,EAAI5Y,OAAO9uB,EAAIqM,YAAarM,EAAIspB,UAEzBoe,EA7HR,GAAIA,GAAK7oB,EAAMsR,EAAgBI,EAAcF,EAAaI,CAgI1D,IAAIgsB,EACH,GAAI54B,EAAMjgB,QAAQ64C,EAAS1+B,OAAQ,CAIlC,GAHA2pB,EAAMhZ,EAAIkT,YACV/iB,EAAO6P,EAAIgO,UAEPsO,EAAUwd,WACb,MAAOxd,GAAUwd,WAAW5L,eAAeH,EAGxCa,IAAY,IAASA,KACxBtS,EAAUge,OAAOthB,OAEiB,gBAAlB+U,GAAS1+B,MAC1BitB,EAAUge,OAAOD,EAA6BtM,IACpCA,EAASn+C,IAEnBsqD,EAAgB,SAChBA,EAAgB,OAEZz4B,IACHuX,EAAMhZ,EAAIkT,YACV8F,EAAI/Y,SAASm6B,EAAS34B,GAAiBE,GACvCqX,EAAI5Y,OAAOg6B,EAASv4B,GAAeE,GACnCua,EAAUge,OAAOthB,KAER+U,EAAS/zC,KACnBsiC,EAAU95B,OAAOwd,EAAIxd,OAAOurC,EAAS/zC,MAAM+zC,EAASh7B,QAC1Cg7B,EAAS/U,KACnBsD,EAAUge,OAAOvM,EAAS/U,MA7Z9B,GAAInB,GAAyBG,EAASH,sBA+atC,OAJA2hB,GAAgBe,eAAiB,SAASjvC,GACzC,MAAOA,IAAyB,SAAjBA,EAAKsvB,SAA6D,aAAvCtvB,EAAKzJ,aAAa,kBAGtD23C,IAwBR7pD,EAAO,yBACN,yBACA,+BACA,+BACA,yBACA,8BACA,uBACA,cACA,qBACA,+BACE,SAASy8B,EAAYouB,EAAkBC,EAAkB1hB,EAAYygB,EAAiBxhB,EAAUl+B,EAAKqb,EAAO8iC,GAc9G,QAASlL,GAAU/sB,EAAKnjB,EAAK69C,EAAYzjD,GACxC,GAAIoG,GAAOjK,IAEXiK,GAAK2iB,IAAMA,EACX3iB,EAAKR,IAAMA,EACXQ,EAAKq9C,WAAaA,EAClBr9C,EAAKpG,OAASA,EACdoG,EAAKs9C,gBAAkB,GAAInB,GAAgBn8C,GAC3CA,EAAKu9C,iBAAmB,GAAIH,GAAiBp9C,EAAMpG,GAG9CoG,EAAKR,IAAIpD,eACb4D,EAAKy8C,WAAa,GAAIU,GAAiBn9C,IAzBzC,GAAIoV,GAAO0C,EAAM1C,KAAMgB,EAAO0B,EAAM1B,KAChC8Z,EAAOzzB,EAAIhC,EAy9Bf,OA77BAi1C,GAAU13C,WASTwlD,kBAAmB,SAASvvC,EAAMsP,GACjC,GAAIvd,GAAOjK,KAAM4lC,EAAM37B,EAAK2iB,IAAIkT,WAE3B5nB,IAIJ0tB,EAAI/Y,SAAS3U,EAAMsP,GACnBoe,EAAI5Y,OAAO9U,EAAMsP,GACjBvd,EAAKi9C,OAAOthB,GACZ37B,EAAKqjB,UAAS,KANdrjB,EAAKy9C,cAAc9hB,EAAK37B,EAAKpG,OAAO+kC,WAAW,GAC/C3+B,EAAKi9C,OAAOthB,KAsBdoR,WAAY,SAAS50C,GACpB,GACwBulD,GAAkBC,EAAiBC,EADvD59C,EAAOjK,KAAM4lC,EAAM37B,EAAKk/B,SAAU2e,EAAS79C,EAAK2iB,IAAI9uB,OAAO,QAC3DujD,EAAKp3C,EAAK89C,QASd,OAPA3lD,GAAOA,MACPulD,EAAmBC,EAAkB,GACrCxlD,EAAK4iB,KAAM,EACX5iB,EAAK+2C,OAAS/2C,EAAK+2C,QAAU,OAC7B/2C,EAAK8mC,WAAY,EACjBj/B,EAAKpG,OAAOqI,KAAK,mBAAoB9J,GAElB,QAAfA,EAAK+2C,OACDlvC,EAAKo/B,cAAgB,GAAMzD,EAAInpB,OAAS4kC,EAAGn/C,SAAWm/C,EAAGn/C,WAAa,KAG1E0jC,EAAI1W,eACP24B,EAAWjiB,EAAI1W,gBAEX24B,GACHC,EAAOvvC,YAAYsvC,IAEVjiB,EAAIlmB,OAAS/jB,GAAaiqC,EAAIoiB,WAAarsD,GAIrDmsD,EAAO/uC,UAAY,QAAU6sB,EAAIlmB,KAAOkmB,EAAIlmB,KAAK,GAAGqf,UAAY6G,EAAIoiB,UACpEF,EAAO73C,YAAY63C,EAAOltC,aAE1BktC,EAAO/uC,UAAY6sB,EAAI1jC,WAIpB,MAAMuD,KAAKqiD,EAAO/uC,aACrB4uC,EAAmB,KAGhB,OAAOliD,KAAKqiD,EAAO/uC,aACtB6uC,EAAkB,KAGnBxlD,EAAKk3C,UAAW,EAEhBl3C,EAAKkkB,QAAUrc,EAAKo/B,cAAgB,GAAKse,EAAmB19C,EAAKq9C,WAAWz7B,UAAUi8B,EAAQ1lD,GAAQwlD,EACtG39C,EAAKpG,OAAOqI,KAAK,aAAc9J,GAExBA,EAAKkkB,UAeb2hC,WAAY,SAAS3hC,EAASlkB,GAC7B,GAAsC8lD,GAAoC5lC,EAAMlP,EAA5EnJ,EAAOjK,KAAM4lC,EAAM37B,EAAKk/B,SAAqB5gC,EAAM0B,EAAKR,IAAI/F,QAchE,IAZAtB,EAAOA,IAAS+2C,OAAQ,QACxB/2C,EAAK6iB,KAAM,EACX7iB,EAAK8mC,WAAY,EACjB9mC,EAAKkkB,QAAUA,EAGVlkB,EAAKg3C,WACTnvC,EAAKpG,OAAOqI,KAAK,mBAAoB9J,GAGtCkkB,EAAUlkB,EAAKkkB,QAEXsf,EAAIxW,WAAY,CAEnB9I,GAAW,8BAGPsf,EAAIvX,gBAAkB9lB,GAAOq9B,EAAInX,cAAgBlmB,EAEpDA,EAAI5E,KAAKoV,UAAYuN,GAErBsf,EAAI/W,iBAE+B,IAA/BtmB,EAAI5E,KAAKqU,WAAW9b,OACvBqM,EAAI5E,KAAKoV,UAAYuN,EAGjBsf,EAAIuiB,yBACPviB,EAAIxW,WAAWwW,EAAIuiB,yBAAyB7hC,KAG5ChE,EAAO/Z,EAAIga,yBACXnP,EAAO7K,EAAIyH,cAAc,OAEzBsS,EAAK/J,YAAYnF,GACjBA,EAAK2rB,UAAYzY,EAEjBsf,EAAIxW,WAAW9M,KAMlB4lC,EAAYj+C,EAAK2iB,IAAI5H,IAAI,WAGzB4gB,EAAMr9B,EAAIw3B,cACV6F,EAAI1Y,eAAeg7B,GACnBtiB,EAAIxY,aAAa86B,GACjBj+C,EAAKi9C,OAAOthB,GAGZ37B,EAAK2iB,IAAI/G,OAAO,UAEhB,KACC5b,EAAKi9C,OAAOthB,GACX,MAAOnkC,SAILmkC,GAAIlmB,OAEPnX,EAAI04C,YAAY,UAAU,EAAO,MACjCrb,EAAM37B,EAAKk/B,UAIR,OAAO1jC,KAAK6gB,IACfsf,EAAI+gB,UAAU,gCAAkCrgC,GAChDrc,EAAK2iB,IAAI/G,OAAO,cAEhB+f,EAAI+gB,UAAUrgC,EAKXlkB,GAAKg3C,WACTnvC,EAAKpG,OAAOqI,KAAK,aAAc9J,IAYjCgnC,SAAU,SAASgf,GAClB,GAAsCC,GAAcpO,EAAeJ,EAAU3hC,EAAzEjO,EAAOjK,KAAM4lC,EAAM37B,EAAKk/B,QAE5B,IAAIvD,EAAIoC,WAAapC,EAAIlmB,KAAM,CAE9B,GAAIkmB,EAAIlmB,KACP,MAAOkmB,GAAIlmB,KAAK,EAcjB,KAVAm6B,EAAWjU,EAAIoC,YACf6R,EAASvsB,SAAS,GAClB+6B,EAAexO,EAASI,gBACpBoO,EAAa//C,gBAAkB2B,EAAK2iB,IAAIrkB,MAC3C8/C,EAAep+C,EAAK2iB,IAAIgO,WAKzBqf,EAAgB/hC,EAAO0tB,EAAIqU,gBACnB/hC,EAAOA,EAAKrM,YACnB,GAAIqM,GAAQmwC,EAAc,CACzBA,EAAepO,CACf,OAIF,MAAOoO,GAWR,MARAA,GAAeziB,EAAIvX,eAEU,GAAzBg6B,EAAa98C,UAAiB88C,EAAa9hB,kBACzC6hB,GAASxiB,EAAIhY,YACjBy6B,EAAeA,EAAarwC,WAAWrY,KAAKhB,IAAI0pD,EAAarwC,WAAW9b,OAAS,EAAG0pC,EAAIrX,gBAItF85B,GAAyC,GAAzBA,EAAa98C,SACzB88C,EAAax8C,WAGdw8C,GAWR7H,OAAQ,SAAS4H,GAChB,GAAsCE,GAAY35B,EAA9C1kB,EAAOjK,KAAM4lC,EAAM37B,EAAKk/B,QAE5B,OAAIvD,GAAIoC,WAAapC,EAAIlmB,KACpBkmB,EAAIlmB,KACAkmB,EAAIlmB,KAAK,IAGjBkmB,EAAMA,EAAIoC,YACVpC,EAAItY,SAAS,GACbg7B,EAAa1iB,EAAIqU,gBACbqO,EAAWhgD,gBAAkB2B,EAAK2iB,IAAIrkB,MACzC+/C,EAAar+C,EAAK2iB,IAAIgO,WAGnB0tB,GAAqC,QAAvBA,EAAWh6C,SACrBg6C,EAAWnsC,WAAamsC,EAGzBA,IAGRA,EAAa1iB,EAAInX,aACjBE,EAAYiX,EAAIjX,UAEW,GAAvB25B,EAAW/8C,UAAiB+8C,EAAW/hB,kBACrC6hB,GAASxiB,EAAIhY,YACjB06B,EAAaA,EAAWtwC,WAAW2W,EAAY,EAAIA,EAAY,EAAIA,KAIjE25B,GAAqC,GAAvBA,EAAW/8C,SACrB+8C,EAAWz8C,WAGZy8C,IAoBRzN,YAAa,SAAS3yC,EAAM0xB,GAC3B,MAAO55B,MAAKunD,gBAAgB1M,YAAY3yC,EAAM0xB,IAkB/CkhB,eAAgB,SAASH,GACxB,MAAO36C,MAAKunD,gBAAgBzM,eAAeH,IAc5CvrC,OAAQ,SAAS8I,EAAMoO,GACtB,GAAwDjK,GAApDpS,EAAOjK,KAAM4sB,EAAM3iB,EAAK2iB,IAAKgZ,EAAMhZ,EAAIkT,WAK3C,IAFA71B,EAAKs+C,kBAAoB,KAErBrwC,EAAM,CACT,IAAKoO,GAAWrc,EAAKu9C,iBAAiBtG,cAAchpC,GACnD,MAGDmE,GAAMuQ,EAAI5Q,UAAU9D,GACpB0tB,EAAI/Y,SAAS3U,EAAKrM,WAAYwQ,GAC9BupB,EAAI5Y,OAAO9U,EAAKrM,WAAYwQ,EAAM,GAG9BiK,IACHrc,EAAKy9C,cAAc9hB,EAAK1tB,GAAM,GAC9BjO,EAAKy9C,cAAc9hB,EAAK1tB,IAGzBjO,EAAKi9C,OAAOthB,GAGb,MAAO1tB,IAURmxB,YAAa,WACZ,GAAIp/B,GAAOjK,KAAM4lC,EAAM37B,EAAKk/B,SAAUqf,EAAMv+C,EAAK89C,QAEjD,UAAKniB,GAAOA,EAAIlmB,QAIZkmB,EAAIuU,iBAC4C,IAA5CvU,EAAIuU,iBAAiB,aAAcvU,IAGnC4iB,GAAO5iB,EAAIhY,YASpBN,SAAU,SAASq1B,GAClB,GAAsCzqC,GAAlCjO,EAAOjK,KAAM4lC,EAAM37B,EAAKk/B,QAGxBvD,GAAIlmB,OACPxH,EAAO0tB,EAAIlmB,KAAK,GAChBkmB,EAAM37B,EAAKR,IAAI/F,SAASC,KAAK4jC,kBAC7B3B,EAAI6B,kBAAkBvvB,IAGvB0tB,EAAItY,WAAWq1B,GACf14C,EAAKi9C,OAAOthB,IASbmiB,OAAQ,WACP,GAAIt+C,GAAMzJ,KAAKyJ,GAEf,OAAOA,GAAIpD,aAAeoD,EAAIpD,eAAiBoD,EAAI/F,SAASwlC,WAY7DC,OAAQ,SAASsf,GAGhB,QAASC,GAAyBn4B,EAAKo4B,EAAaC,GACnD,IACC,MAAOD,GAAY56B,sBAAsBwC,EAAKq4B,GAC7C,MAAOnnD,GAMR,UAXF,GAAiBynC,GAAWtD,EAAKrgB,EAAKhd,EAAKuzC,EAAO1xC,EAA9CH,EAAOjK,IAeX,KAAKiK,EAAKR,IACT,MAAO,KAOR,IAJAlB,EAAM0B,EAAKR,IAAI/F,UAIV+kD,GAAOx+C,EAAKs+C,kBAAmB,CACnC,GAAI5N,GAAW1wC,EAAKs+C,iBAWpB,OARI5N,GAAStsB,gBACZuX,EAAMr9B,EAAIw3B,cACV6F,EAAI/Y,SAAS8tB,EAAStsB,eAAgBssB,EAASpsB,aAC/CqX,EAAI5Y,OAAO2tB,EAASlsB,aAAcksB,EAAShsB,YAE3CiX,EAAM+U,EAGA/U,EAIR,GAAI6iB,GAAOx+C,EAAKy8C,WACf,MAAOz8C,GAAKy8C,WAAWxK,WAAW,EAGnC,MACMhT,EAAYj/B,EAAK89C,YAEpBniB,EADGsD,EAAU2f,WAAa,EACpB3f,EAAUgT,WAAW,GAErBhT,EAAUnJ,YAAcmJ,EAAUnJ,cAAgBx3B,EAAIw3B,eAG7D,MAAOt+B,IAKT,GADA2I,EAAMH,EAAKpG,OAAOqI,KAAK,qBAAsB9F,MAAOw/B,IAChDx7B,EAAIhE,QAAUw/B,EACjB,MAAOx7B,GAAIhE,KAKZ,IAAI+zB,GAAQyL,GAAOA,EAAI/Y,UAAYtkB,EAAI2gC,UAAW,CACjD,IAEC4S,EAAQvzC,EAAI2gC,UAAUnJ,cACrB,MAAOt+B,IAILq6C,GAASA,EAAMp8B,OAClB6F,EAAMu2B,EAAMp8B,KAAK,GACjBkmB,EAAMr9B,EAAIw3B,cACV6F,EAAI1Y,eAAe3H,GACnBqgB,EAAIvY,YAAY9H,IA8BlB,MAvBKqgB,KACJA,EAAMr9B,EAAIw3B,YAAcx3B,EAAIw3B,cAAgBx3B,EAAI5E,KAAK4jC,mBAIlD3B,EAAI/Y,UAA4C,IAAhC+Y,EAAIvX,eAAe9iB,UAAkBq6B,EAAIhY,YAC5DrI,EAAMtb,EAAK2iB,IAAIgO,UACfgL,EAAI/Y,SAAStH,EAAK,GAClBqgB,EAAI5Y,OAAOzH,EAAK,IAGbtb,EAAK6+C,eAAiB7+C,EAAK8+C,gBACgD,IAA1EL,EAAyB9iB,EAAIjT,eAAgBiT,EAAK37B,EAAK6+C,gBACY,IAAtEJ,EAAyB9iB,EAAI/S,WAAY+S,EAAK37B,EAAK6+C,eAGnDljB,EAAM37B,EAAK8+C,eAEX9+C,EAAK6+C,cAAgB,KACrB7+C,EAAK8+C,cAAgB,OAIhBnjB,GAURshB,OAAQ,SAASthB,EAAK9pB,GACrB,GAAiB0sC,GAAKtwC,EAAM9N,EAAxBH,EAAOjK,IAEX,IAAK4lC,EAKL,GAAIA,EAAIx2B,OAAR,CACCnF,EAAK8+C,cAAgB,IAErB,KACCnjB,EAAIx2B,SACH,MAAO3N,SAOV,IAAKwI,EAAKy8C,YAuCT,GAAI9gB,EAAInW,WACP,IACCxlB,EAAKy8C,WAAW/K,SAAS/V,GACxB,MAAOnkC,SA1CW,CAMrB,GALA+mD,EAAMv+C,EAAK89C,SAEX39C,EAAMH,EAAKpG,OAAOqI,KAAK,qBAAsB9F,MAAOw/B,IACpDA,EAAMx7B,EAAIhE,MAENoiD,EAAK,CACRv+C,EAAK8+C,cAAgBnjB,CAErB,KACC4iB,EAAIQ,kBACJR,EAAI7M,SAAS/V,GACZ,MAAOnkC,IAKLqa,KAAY,GAAS0sC,EAAInnC,SAC5BmnC,EAAIl7B,SAASsY,EAAInX,aAAcmX,EAAIjX,WACnC65B,EAAInnC,OAAOukB,EAAIvX,eAAgBuX,EAAIrX,cAIpCtkB,EAAK6+C,cAAgBN,EAAIK,WAAa,EAAIL,EAAItM,WAAW,GAAK,KAI1DtW,EAAIhY,WAAagY,EAAIvX,gBAAkBuX,EAAInX,eAAgB+5B,EAAIS,kBAAqBviD,EAAIhC,IACxFkhC,EAAIjX,UAAYiX,EAAIrX,YAAc,GACjCqX,EAAIvX,eAAekY,kBACtBruB,EAAO0tB,EAAIvX,eAAerW,WAAW4tB,EAAIrX,aACrCrW,GAAwB,OAAhBA,EAAKsvB,SAChBv9B,EAAK89C,SAASkB,iBAAiB/wC,EAAM,EAAGA,EAAM,MA2BpDgxC,QAAS,SAAS3jC,GACjB,GAAItb,GAAOjK,IAIX,OAFAiK,GAAKg+C,WAAWh+C,EAAK2iB,IAAIkS,aAAavZ,IAE/BA,GAYRijB,QAAS,WAIR,QAAS2gB,GAAmBjxC,EAAMkxC,GAGjC,IAFA,GAAIC,GAAOnxC,EAEJA,GAA0B,IAAlBA,EAAK3M,UAAkC,IAAhB2M,EAAKhc,QAC1Cgc,EAAOkxC,EAAWlxC,EAAKpH,YAAcoH,EAAKwZ,eAG3C,OAAOxZ,IAAQmxC,EAVhB,GAAsC9jC,GAClC8I,EAAgBI,EAAcF,EAAaI,EAD3C1kB,EAAOjK,KAAM4lC,EAAM37B,EAAKk/B,SAC8BpsB,EAAO9S,EAAK2iB,IAAIgO,SAa1E,OAAKgL,IAILvX,EAAiBuX,EAAIvX,eACrBI,EAAemX,EAAInX,aACnBF,EAAcqX,EAAIrX,YAClBI,EAAYiX,EAAIjX,UAEZiX,EAAI/Y,UACPtH,EAAMqgB,EAAIlW,yBAGLkW,EAAIhY,YACJS,GAAkBI,GACjBE,EAAYJ,EAAc,GACzBF,EAAekY,kBAClBhhB,EAAM8I,EAAerW,WAAWuW,IAWH,IAA5BF,EAAe9iB,UAA4C,IAA1BkjB,EAAaljB,WAEhD8iB,EADGA,EAAenyB,SAAWqyB,EACZ46B,EAAmB96B,EAAevd,aAAa,GAE/Cud,EAAexiB,WAIhC4iB,EADiB,IAAdE,EACYw6B,EAAmB16B,EAAaiD,iBAAiB,GAEjDjD,EAAa5iB,WAGzBwiB,GAAkBA,IAAmBI,IACjCJ,EAKN9I,GAAuB,GAAhBA,EAAIha,SACPga,EAAI1Z,WAGL0Z,IAGRA,EAAMqgB,EAAIlmB,KAAOkmB,EAAIlmB,KAAK,GAAKkmB,EAAIqU,gBAG/B10B,EAAIjd,gBAAkB2B,EAAKR,IAAI/F,WAClC6hB,EAAMxI,GAGAwI,IA5DCxI,GA+DTusC,kBAAmB,SAAS5gB,EAAU6gB,GACrC,GAAiCrxC,GAAM6E,EAAnC9S,EAAOjK,KAAM4sB,EAAM3iB,EAAK2iB,IAAiB48B,IAU7C,IARAzsC,EAAO6P,EAAIgO,UACX8N,EAAW9b,EAAIwP,UAAUsM,GAAYz+B,EAAKm/B,WAAYxc,EAAIiO,SAC1D0uB,EAAS38B,EAAIwP,UAAUmtB,GAAUt/C,EAAKu2C,SAAU5zB,EAAIiO,SAEhD6N,GAAYA,GAAY3rB,GAC3BysC,EAAentD,KAAKqsC,GAGjBA,GAAY6gB,GAAU7gB,GAAY6gB,EAAQ,CAC7CrxC,EAAOwwB,CAGP,KADA,GAAI/I,GAAS,GAAI3G,GAAW0P,EAAU3rB,IAC9B7E,EAAOynB,EAAO9X,SAAW3P,GAAQqxC,GACpC38B,EAAIiO,QAAQ3iB,IACfsxC,EAAentD,KAAK6b,GASvB,MAJIqxC,IAAU7gB,GAAY6gB,GAAUA,GAAUxsC,GAC7CysC,EAAentD,KAAKktD,GAGdC,GAGRC,UAAW,WACV,GAAyCC,GAAaC,EAAlD/8B,EAAM5sB,KAAK4sB,IAAK47B,EAAMxoD,KAAK+nD,QAG/B,SAAKS,GAAQA,EAAIoB,YAAepB,EAAIqB,aAIpCH,EAAc98B,EAAIkT,YAClB4pB,EAAY78B,SAAS27B,EAAIoB,WAAYpB,EAAIsB,cACzCJ,EAAYp8B,UAAS,GAErBq8B,EAAa/8B,EAAIkT,YACjB6pB,EAAW98B,SAAS27B,EAAIqB,UAAWrB,EAAIuB,aACvCJ,EAAWr8B,UAAS,GAEbo8B,EAAY37B,sBAAsB27B,EAAY/2B,eAAgBg3B,IAAe,IAGrFnjB,UAAW,WACV,GAAIv8B,GAAOjK,KAAM4lC,EAAM37B,EAAKk/B,QAM5B,OAJIziC,GAAIN,OAAS,GAAIu/B,GAAW17B,EAAK2iB,KAAK4Z,UAAUZ,IACnD37B,EAAKi9C,OAAOthB,EAAK37B,EAAKw/C,aAGhB7jB,GAWRokB,gBAAiB,SAAS98C,EAAUpR,GACnC,GAAiBmuD,GAAbhgD,EAAOjK,IAgDX,OA9CKiK,GAAKigD,sBACTjgD,EAAKigD,uBACLD,KAEAhgD,EAAKpG,OAAOqjB,GAAG,aAAc,SAASnmB,GACrC,GAAImX,GAAOnX,EAAE8B,QAAS+pB,EAAM3iB,EAAK2iB,IAAKhF,EAAUgF,EAAIyP,WAAWnkB,EAAM,KAAM0U,EAAIgO,WAAYuvB,IAG3F9qC,GAAKpV,EAAKigD,oBAAqB,SAAS/yB,EAAWjqB,GAClDmS,EAAKuI,EAAS,SAAS1P,GACtB,GAAI0U,EAAIpM,GAAGtI,EAAMhL,GAWhB,MAVK+8C,GAAiB/8C,KAErBmS,EAAK8X,EAAW,SAASr7B,GACxBA,GAAS,GAAOoc,KAAMA,EAAMhL,SAAUA,EAAU0a,QAASA,MAG1DqiC,EAAiB/8C,GAAYiqB,GAG9BgzB,EAAiBj9C,GAAYiqB,GACtB,MAMV9X,EAAK4qC,EAAkB,SAAS9yB,EAAWjqB,GACrCi9C,EAAiBj9C,WACd+8C,GAAiB/8C,GAExBmS,EAAK8X,EAAW,SAASr7B,GACxBA,GAAS,GAAQoc,KAAMA,EAAMhL,SAAUA,EAAU0a,QAASA,YAQ1D3d,EAAKigD,oBAAoBh9C,KAC7BjD,EAAKigD,oBAAoBh9C,OAG1BjD,EAAKigD,oBAAoBh9C,GAAU7Q,KAAKP,GAEjCmO,GAGRmgD,mBAAoB,WAGnB,IAFA,GAAIC,GAAiBnyC,EAAOlY,KAAK4sB,IAAIgO,UAE9B1iB,GAAyB,QAAjBA,EAAK5J,UAAoB,CACvC,GAAI4J,EAAK0mC,aAAe1mC,EAAK2jB,aAAc,CAC1CwuB,EAAkBnyC,CAClB,OAGDA,EAAOA,EAAKrM,WAGb,MAAOw+C,IAGRC,eAAgB,SAAS/kC,EAAKglC,GAG7B,QAASxuB,GAAOxW,GAIf,IAHA,GAAIhoB,GAAI,EAAGC,EAAI,EAEXwgC,EAAezY,EACZyY,GAAgBA,EAAazyB,UACnChO,GAAKygC,EAAaC,YAAc,EAChCzgC,GAAKwgC,EAAaE,WAAa,EAC/BF,EAAeA,EAAaA,YAG7B,QAAQzgC,EAAGA,EAAGC,EAAGA,GAZlB,GAAIA,GAAGgtD,EAA6DC,EAAWC,EAA9DzgD,EAAOjK,KAAM4sB,EAAM3iB,EAAK2iB,IAAK7P,EAAO6P,EAAIgO,UAAiC+vB,EAAU,CAepG,IAAK/lB,EAASf,UAAUte,GAAxB,CAQA,GAJIglC,KAAe,IAClBI,EAAUplC,EAAI4W,cAGM,QAAjBpf,EAAKzO,SAAoB,CAC5B,GAAI+7C,GAAkBpgD,EAAKmgD,oBAC3B,IAAIC,EAQH,MAPA7sD,GAAIu+B,EAAOxW,GAAK/nB,EAAIu+B,EAAOsuB,GAAiB7sD,EAAImtD,EAChDD,EAAYL,EAAgBxuB,aAC5B4uB,EAAYJ,EAAgBxhD,gBACxBrL,EAAIitD,GAAajtD,EAAI,GAAKitD,EAAYC,KACzCL,EAAgBxhD,UAAYrL,EAAIitD,EAAYjtD,EAAIA,EAAIktD,EAAY,KAOnEF,EAAW59B,EAAI0O,YAAYrxB,EAAKpG,OAAO+mD,UACvCptD,EAAIovB,EAAImP,OAAOxW,GAAK/nB,EAAImtD,EACxBF,EAAYD,EAAShtD,EACrBktD,EAAYF,EAAS9sD,GACjBF,EAAIgtD,EAAShtD,GAAKA,EAAI,GAAKitD,EAAYC,IAC1CzgD,EAAKpG,OAAO+mD,SAASC,SAAS,EAAGrtD,EAAIitD,EAAYjtD,EAAIA,EAAIktD,EAAY,MAIvEI,aAAc,SAAS1iD,EAASQ,GAC/B5I,KAAKknD,OAAOvhB,EAAWuC,uBAAuB9/B,EAASQ,EAAS5I,KAAK6D,OAAOklC,YAG7E2e,cAAe,SAAS9hB,EAAK1tB,EAAM+D,GAClC,GAAIc,GAAO7E,EAAMynB,EAAS,GAAI3G,GAAW9gB,EAAM6E,GAC3CmqB,EAAsBlnC,KAAK4sB,IAAI9D,OAAO+W,qBAE1C,GAAG,CAEF,GAAqB,GAAjB3nB,EAAK3M,UAAiD,IAAhC8U,EAAKnI,EAAK2C,WAAW3e,OAO9C,YANI+f,EACH2pB,EAAI/Y,SAAS3U,EAAM,GAEnB0tB,EAAI5Y,OAAO9U,EAAMA,EAAK2C,UAAU3e,QAOlC,IAAIgrC,EAAoBhvB,EAAK5J,YAAc,YAAY7I,KAAKyS,EAAK5J,UAWhE,YAVI2N,EACH2pB,EAAI1Y,eAAehV,GAEE,MAAjBA,EAAK5J,SACRs3B,EAAIxY,aAAalV,GAEjB0tB,EAAIvY,YAAYnV,GAQnB,IAAIxR,EAAIhC,IAAMgC,EAAIhC,GAAK,IAAM1E,KAAK4sB,IAAIiO,QAAQ3iB,IAASlY,KAAK4sB,IAAI8S,QAAQxnB,GAOvE,YANI+D,EACH2pB,EAAI/Y,SAAS3U,EAAM,GAEnB0tB,EAAI5Y,OAAO9U,EAAM,UAKVA,EAAQ+D,EAAQ0jB,EAAO9X,OAAS8X,EAAO7X,OAG5B,SAAjB/K,EAAKzO,WACJ2N,EACH2pB,EAAI/Y,SAAS9P,EAAM,GAEnB6oB,EAAI5Y,OAAOjQ,EAAMA,EAAK/E,WAAW9b,UAKpCwrB,sBAAwB,WACvB,GAAIke,GAAM5lC,KAAKmpC,QACf,OAAOvD,GAAIhY,UAAYi3B,EAAcK,eAAetf,GAAK8B,iBAAiB,GAAK9B,EAAIle,yBAGpFlb,QAAS,WACRxM,KAAKyJ,IAAM,KACXzJ,KAAKwnD,iBAAiBh7C,YAIjBmtC,IAqBRp9C,EAAO,4BACN,8BACA,sBACE,SAAS6pD,EAAiBrkC,GAG5B,QAASgpC,GAAan+B,GAUrB5sB,KAAK0Z,QAAU,SAASsxC,EAAOC,GAa9B,QAAS/vB,GAAWhjB,GACnB,GAAIgzC,KAWJ,OATA7rC,GAAKuN,EAAIsO,WAAWhjB,GAAO,SAASgC,GACnC,GAAItT,GAAOsT,EAAK5L,SAASC,aAGC,KAAtB3H,EAAKhB,QAAQ,MAAuB,UAATgB,GAA6B,mBAATA,GAAqC,qBAARA,IAC/EskD,EAAQtkD,GAAQgmB,EAAIwO,UAAUljB,EAAMtR,MAI/BskD,EAWR,QAASC,GAAeC,EAAMC,GAC7B,GAAI9pD,GAAOqF,CAEX,KAAKA,IAAQwkD,GAEZ,GAAIA,EAAKr1C,eAAenP,GAAO,CAI9B,GAHArF,EAAQ8pD,EAAKzkD,GAGO,mBAATrF,GACV,OAAO,CAIR,IAAI6pD,EAAKxkD,IAASrF,EACjB,OAAO,QAID8pD,GAAKzkD,GAKd,IAAKA,IAAQykD,GAEZ,GAAIA,EAAKt1C,eAAenP,GACvB,OAAO,CAIT,QAAO,EAjER,MAAIokD,GAAM18C,UAAY28C,EAAM38C,aAqEvB68C,EAAejwB,EAAW8vB,GAAQ9vB,EAAW+vB,QAK7CE,EAAev+B,EAAI6M,WAAW7M,EAAIwO,UAAU4vB,EAAO,UAAWp+B,EAAI6M,WAAW7M,EAAIwO,UAAU6vB,EAAO,cAI/F7E,EAAgBe,eAAe6D,KAAW5E,EAAgBe,eAAe8D,OA5FnF,GAAI5rC,GAAO0C,EAAM1C,IAgGjB,OAAO0rC,KAwBRxuD,EAAO,uBACN,sBACE,SAASwlB,GAGX,QAASupC,GAAWznD,EAAQs1C,GAkB3B,QAASoS,GAAWhpD,GACnB,MAAOA,GAAImM,QAAQ,UAAW,IAlB/B,GAAI9H,GAAM4kD,EACWC,EAAgBC,EADf9+B,EAAM/oB,EAAO+oB,IAC/B++B,EAAa,EAKjB,IAHAD,EAAgB7nD,EAAOglB,SAAS+iC,eAG5BF,KAAkB,EACrB,MAAO,EAeR,IAXKA,IACJA,EAAgB,+IAUI,gBAAVvS,GAAoB,CAE9B,GADAA,EAASt1C,EAAOgoD,UAAU7mC,IAAIm0B,IACzBA,EACJ,MAGDA,GAASA,EAAO,GA2FjB,MAxFAvyC,GAAOuyC,EAAO2S,OAAS3S,EAAOlL,QAAU,OACxCud,EAAa5+B,EAAI9uB,OAAO8I,GAGxByY,EAAK85B,EAAO5uB,OAAQ,SAAShpB,EAAOqF,GACnCrF,EAAQgqD,EAAWhqD,GAEfA,GACHqrB,EAAIwQ,SAASouB,EAAY5kD,EAAMrF,KAKjC8d,EAAK85B,EAAO/iC,WAAY,SAAS7U,EAAOqF,GACvCrF,EAAQgqD,EAAWhqD,GAEfA,GACHqrB,EAAIuO,UAAUqwB,EAAY5kD,EAAMrF,KAKlC8d,EAAK85B,EAAO4S,QAAS,SAASxqD,GAC7BA,EAAQgqD,EAAWhqD,GAEdqrB,EAAI7J,SAASyoC,EAAYjqD,IAC7BqrB,EAAIhG,SAAS4kC,EAAYjqD,KAI3BsC,EAAOqI,KAAK,kBAGZ0gB,EAAI2Q,UAAUiuB,GAAaxR,SAAU,WAAYz6C,cACjDsE,EAAO+kC,UAAUrwB,YAAYizC,GAG7BC,EAAiB7+B,EAAIqP,SAASp4B,EAAO+kC,UAAW,YAAY,GAC5D6iB,EAAiB,MAAMhmD,KAAKgmD,GAAkBtiC,SAASsiC,EAAgB,IAAM,EAE7EpsC,EAAKqsC,EAAc5uD,MAAM,KAAM,SAAS8J,GACvC,GAAIrF,GAAQqrB,EAAIqP,SAASuvB,EAAY5kD,GAAM,EAG3C,MAAY,oBAARA,GAA8B,oCAAoCnB,KAAKlE,KAC1EA,EAAQqrB,EAAIqP,SAASp4B,EAAO+kC,UAAWhiC,GAAM,GAIP,WAAlCgmB,EAAI7D,MAAMxnB,GAAOgN,gBAKV,SAAR3H,GAGmC,WAAlCgmB,EAAI7D,MAAMxnB,GAAOgN,eAHtB,CASA,GAAY,aAAR3H,GACC,QAAQnB,KAAKlE,GAAQ,CACxB,GAAuB,IAAnBkqD,EACH,MAIDlqD,GAAQyqD,WAAWzqD,EAAO,KAAO,KAAKkE,KAAKlE,GAAS,IAAM,GAC1DA,EAASA,EAAQkqD,EAAkB,KAIzB,UAAR7kD,GAAoBrF,IACvBoqD,GAAc,kBAGfA,GAAc/kD,EAAO,IAAMrF,EAAQ,OAGpCsC,EAAOqI,KAAK,uBAIZ0gB,EAAI/G,OAAO2lC,GAEJG,EA1HR,GAAItsC,GAAO0C,EAAM1C,IA6HjB,QACCisC,WAAYA,KAsBd/uD,EAAO,qBACN,mBACA,uBACA,wBACE,SAAS6jB,EAAKwkB,EAAU9L,GAG1B,QAASmzB,GAAmBrlD,EAAMme,GACjC,GAAIhB,GAAQmoC,EAAiBtlD,EAExBmd,KACJmoC,EAAiBtlD,GAAQmd,MAG1BmoC,EAAiBtlD,GAAMvK,KAAK0oB,GAG7B,QAASonC,GAAYvlD,EAAM/C,GAC1Bwb,EAAK6sC,EAAiBtlD,GAAO,SAASme,GACrCA,EAAKlhB,KAdP,GAAIqoD,MAAuBt5C,EAASwN,EAAIxN,OAAQyM,EAAOe,EAAIf,IAyC3D,OAvBA4sC,GAAmB,MAAO,SAASpoD,GAGlC,QAASuoD,GAAcC,GACtB,MAAOC,GAAMD,EAAI36B,kBAAoBtR,EAAIxa,QAAQ2mD,EAAQF,EAAI36B,qBAG9D,QAAS86B,GAAQC,EAAMC,GACtB5zB,EAAE4zB,GAAM7mC,SACRiT,EAAE2zB,GAAM3mC,OAAO,YAAYA,OAAO4mC,EAAK10C,YARxC,GAAqCs0C,GAAOC,EAAxC3mB,EAAM/hC,EAAOqlC,UAAUC,QAW3BmjB,GAAQ1nB,EAASlB,eAAe,OAE3BkC,EAAIhY,YACR2+B,EAAS1oD,EAAOqlC,UAAUogB,oBAE1BjqC,EAAKzM,EAAOA,EAAO25C,EAAQD,GAAQF,GAAgB,SAASC,GAC3DG,EAAQH,EAAI36B,gBAAiB26B,SAM/BF,YAAaA,KA8Bf5vD,EAAO,qBACN,yBACA,yBACA,8BACA,2BACA,qBACA,sBACA,qBACE,SAASy8B,EAAY2M,EAAYygB,EAAiB2E,EAAchpC,EAAO4qC,EAASC,GAOlF,MAAO,UAASC,GAyBf,QAASC,GAAYlmD,GAKpB,MAJIA,GAAK2E,WACR3E,EAAOA,EAAK0H,YAGJu+C,EAAG/jC,OAAOinB,uBAAuBnpC,EAAK2H,eAGhD,QAASm4B,GAAYxuB,GACpB,MAAO,YAAYzS,KAAKyS,EAAK5J,UAG9B,QAASy+C,GAAc70C,GACtB,MAAOA,IAAQ,UAAUzS,KAAKyS,EAAK5J,UAGpC,QAAS+tB,GAAWnkB,EAAMhL,GACzB,MAAO0f,GAAIyP,WAAWnkB,EAAMhL,EAAU0f,EAAIgO,WAG3C,QAASoyB,GAAY90C,GACpB,MAAyB,KAAlBA,EAAK3M,UAA8B,eAAZ2M,EAAK1b,GAGpC,QAASywD,KACRC,GACCC,YACEjgD,SAAU,QAASqd,QAAS6iC,cAAiB,SAG/CC,eACEngD,SAAU,QAASqd,QAAS6iC,cAAiB,YAG/CE,eACEpgD,SAAU,QAASqd,QAAS6iC,cAAiB,YAG/CG,YACErgD,SAAU,eAAgB0gB,WAAW,EAAOm+B,QAAS,aAAcyB,iBAAiB,IAEpFtgD,SAAU,mDACVqd,QACCkjC,UAAW,QAEZC,SAAS,EACTC,aAAc,QAEdzgD,SAAU,YAAa0gB,WAAW,EAAOrD,QAAS/F,QAAS,UAG7DopC,cAEE1gD,SAAU,mDACVqd,QACCkjC,UAAW,UAEZC,SAAS,EACTC,aAAc,QAEdzgD,SAAU,eAAgB0gB,WAAW,EAAOm+B,QAAS,eAAgByB,iBAAiB,IACtFtgD,SAAU,MAAO0gB,WAAW,EAAOrD,QAAS+zB,QAAS,QAASuP,WAAY,OAAQC,YAAa,UAC/F5gD,SAAU,QAAS0gB,WAAW,EAAOrD,QAASsjC,WAAY,OAAQC,YAAa,UAGjFC,aACE7gD,SAAU,eAAgB0gB,WAAW,EAAOm+B,QAAS,cAAeyB,iBAAiB,IAErFtgD,SAAU,mDACVqd,QACCkjC,UAAW,SAEZC,SAAS,EACTC,aAAc,QAEdzgD,SAAU,YAAa0gB,WAAW,EAAOrD,QAAS/F,QAAS,WAG7DwpC,eAEE9gD,SAAU,mDACVqd,QACCkjC,UAAW,WAEZC,SAAS,EACTC,aAAc,QAIhBM,OACEhgB,OAAQ,SAAUpoB,OAAQ,QAC1BooB,OAAQ,OAAQ1jB,QAAS2jC,WAAY,UACrCjgB,OAAQ,IAAKpoB,OAAQ,QAGvBsoC,SACElgB,OAAQ,KAAMpoB,OAAQ,QACtBooB,OAAQ,OAAQ1jB,QAAS6jC,UAAW,YACpCngB,OAAQ,IAAKpoB,OAAQ,QAGvBwoC,YACEpgB,OAAQ,OAAQ1jB,QAAS+jC,eAAgB,aAAcC,OAAO,IAC9DtgB,OAAQ,IAAKpoB,OAAQ,QAGvB2oC,gBACEvgB,OAAQ,OAAQ1jB,QAAS+jC,eAAgB,gBAAiBC,OAAO,IACjEtgB,OAAQ,SAAUpoB,OAAQ,QAG5B4oC,WAAYxgB,OAAQ,OAAQ1jB,QAASR,MAAO,UAAW2kC,OAAO,EAAMC,gBAAgB,GACpFC,aAAc3gB,OAAQ,OAAQ1jB,QAASskC,gBAAiB,UAAWH,OAAO,EAAMC,gBAAgB,GAChGG,UAAW7gB,OAAQ,OAAQ1jB,QAASwkC,WAAY,WAChDC,UAAW/gB,OAAQ,OAAQ1jB,QAAS0kC,SAAU,WAC9CC,gBAAiBjhB,OAAQ,OAAQ73B,YAAaiO,QAAS,WACvD8qC,YAAarD,MAAO,aAAc7oC,QAAS,EAAG4C,OAAQ,OACtDupC,WAAYnhB,OAAQ,OACpBohB,aAAcphB,OAAQ,OACtBqhB,MAAOrhB,OAAQ,QAEf7V,MAAO6V,OAAQ,IAAK/gC,SAAU,IAAK2Y,OAAQ,MAAO/oB,OAAO,EAAMm+B,MAAM,EACpEs0B,QAAS,WACR,OAAO,GAGRC,SAAU,SAASjqC,EAAKkqC,EAAKC,GAC5BrwC,GAAKqwC,EAAM,SAASnuD,EAAOiO,GAC1Bod,EAAIuO,UAAU5V,EAAK/V,EAAKjO,OAK3BouD,eAEEziD,SAAU,gFACV2Y,OAAQ,MACR/oB,OAAO,EACP8yD,QAAQ,EACRC,cAAc,EACd50B,MAAM,IAEN/tB,SAAU,OAAQkJ,YAAa,QAAS,SAAUyP,OAAQ,QAAS/oB,OAAO,EAAM8yD,QAAQ,EAAO30B,MAAM,IACrG/tB,SAAU,IAAKkJ,YAAa,QAAS,SAAUtZ,OAAO,EAAO8yD,QAAQ,EAAO30B,MAAM,MAKrF5b,GAAK,qDAAqDviB,MAAM,MAAO,SAAS8J,GAC/EsmD,EAAStmD,GAAOklD,MAAOllD,EAAMif,OAAQ,UAItCqnC,EAASL,EAAGhkC,SAASinC,SAGtB,QAASC,KAERlD,EAAGmD,YAAY,SAAU,YAAa,QACtCnD,EAAGmD,YAAY,SAAU,cAAe,UACxCnD,EAAGmD,YAAY,SAAU,iBAAkB,YAG3C,KAAK,GAAI/zD,GAAI,EAAGA,GAAK,EAAGA,IACvB4wD,EAAGmD,YAAY,UAAY/zD,EAAG,IAAK,eAAe,EAAO,IAAMA,GAGhE4wD,GAAGmD,YAAY,WAAY,IAAK,eAAe,EAAO,MACtDnD,EAAGmD,YAAY,WAAY,IAAK,eAAe,EAAO,QACtDnD,EAAGmD,YAAY,WAAY,IAAK,eAAe,EAAO,YAYvD,QAAShrC,GAAIpe,GACZ,MAAOA,GAAOkpD,EAAQlpD,GAAQkpD,EAW/B,QAAS5C,GAAStmD,EAAMuyC,GACnBvyC,IACiB,gBAATA,GACVyY,GAAKzY,EAAM,SAASuyC,EAAQvyC,GAC3BsmD,EAAStmD,EAAMuyC,MAIhBA,EAASA,EAAOj9C,OAASi9C,GAAUA,GAEnC95B,GAAK85B,EAAQ,SAASA,GAGjBA,EAAOle,OAASpzB,IACnBsxC,EAAOle,MAAQke,EAAOjsC,UAInBisC,EAAOr8C,QAAU+K,IACpBsxC,EAAOr8C,OAASq8C,EAAOjsC,UAAYisC,EAAOlL,QAIvCkL,EAAOtzB,SAAWhe,GAASsxC,EAAOjsC,WAAaisC,EAAOlL,SACzDkL,EAAOtzB,OAAS,QAIbszB,EAAOjsC,UAAYisC,EAAOlL,SAC7BkL,EAAO8W,OAAQ,EACf9W,EAAO0W,cAAe,GAIO,gBAAnB1W,GAAO4S,UACjB5S,EAAO4S,QAAU5S,EAAO4S,QAAQjvD,MAAM,UAIxCgzD,EAAQlpD,GAAQuyC,IAWnB,QAAS+W,GAAWtpD,GAKnB,MAJIA,IAAQkpD,EAAQlpD,UACZkpD,GAAQlpD,GAGTkpD,EAGR,QAASK,GAAiCj4C,EAAMtR,GAC/C,GAAIwpD,GAAaprC,EAAIpe,EAErB,IAAIwpD,EACH,IAAK,GAAIn0D,GAAI,EAAGA,EAAIm0D,EAAWl0D,OAAQD,IACtC,GAAIm0D,EAAWn0D,GAAGyxD,WAAY,GAAS9gC,EAAIpM,GAAGtI,EAAMk4C,EAAWn0D,GAAGiR,UACjE,OAAO,CAKV,QAAO,EAGR,QAASmjD,GAAkBn4C,GAC1B,GAAIo4C,EAOJ,OALAzD,GAAGjgC,IAAIwP,UAAUlkB,EAAM,SAASsH,GAE/B,MADA8wC,GAAazD,EAAGjgC,IAAIqP,SAASzc,EAAG,mBACzB8wC,GAA6B,SAAfA,IAGfA,EAGR,QAASC,GAAyBr4C,GACjC,GAAIo2C,EACkB,KAAlBp2C,EAAK3M,UAAkB2M,EAAKrM,YAA2C,IAA7BqM,EAAKrM,WAAWN,WAC7D+iD,EAAiB+B,EAAkBn4C,EAAKrM,YACpCghD,EAAGjgC,IAAIqP,SAAS/jB,EAAM,UAAYo2C,EACrCzB,EAAGjgC,IAAIwQ,SAASllB,EAAM,kBAAmBo2C,GAC/BzB,EAAGjgC,IAAIqP,SAAS/jB,EAAM,qBAAuBo2C,GACvDzB,EAAGjgC,IAAIwQ,SAASllB,EAAM,kBAAmB,OAa5C,QAAS5b,GAAMsK,EAAM8oD,EAAMx3C,GAG1B,QAASs4C,GAAiBjrC,EAAKkqC,GAG9B,GAFAA,EAAMA,GAAOtW,EAET5zB,EAAK,CAWR,GAVIkqC,EAAID,UACPC,EAAID,SAASjqC,EAAKkqC,EAAKC,EAAMx3C,GAG9BmH,GAAKowC,EAAIllC,OAAQ,SAAShpB,EAAOqF,GAChCgmB,EAAIwQ,SAAS7X,EAAK3e,EAAM6pD,EAAYlvD,EAAOmuD,MAKxCD,EAAIllC,OAAQ,CACf,GAAImmC,GAAW9jC,EAAIwO,UAAU7V,EAAK,QAE9BmrC,IACHnrC,EAAI3W,aAAa,iBAAkB8hD,GAIrCrxC,GAAKowC,EAAIr5C,WAAY,SAAS7U,EAAOqF,GACpCgmB,EAAIuO,UAAU5V,EAAK3e,EAAM6pD,EAAYlvD,EAAOmuD,MAG7CrwC,GAAKowC,EAAI1D,QAAS,SAASxqD,GAC1BA,EAAQkvD,EAAYlvD,EAAOmuD,GAEtB9iC,EAAI7J,SAASwC,EAAKhkB,IACtBqrB,EAAIhG,SAASrB,EAAKhkB,MAOtB,QAASovD,KACR,QAASC,GAAiB30C,EAAOk1B,GAChC,GAAIxR,GAAS,GAAI3G,GAAWmY,EAC5B,KAAKj5B,EAAOynB,EAAOjT,QAASxU,EAAMA,EAAOynB,EAAOjT,QAAS,CACxD,GAAqB,GAAjBxU,EAAK3M,UAAiB2M,EAAKxQ,KAAKxL,OAAS,EAC5C,MAAOgc,EAGR,IAAIA,EAAKF,WAAW9b,OAAS,GAAKgc,GAAQ+D,GAAyB,MAAhB/D,EAAKsvB,QACvD,MAAOtvB,IAOV,GAAI0tB,GAAMinB,EAAG3jB,UAAUC,SACnBltB,EAAQ2pB,EAAIvX,eACZ8iB,EAAMvL,EAAInX,YAEd,IAAIxS,GAASk1B,GAAyB,IAAlBvL,EAAIjX,UAAiB,CACxC,GAAIkiC,GAASD,EAAiB30C,EAAOk1B,GACjCxiB,EAA+B,GAAnBkiC,EAAOtlD,SAAgBslD,EAAOnpD,KAAKxL,OAAS20D,EAAO74C,WAAW9b,MAE9E0pC,GAAI5Y,OAAO6jC,EAAQliC,GAGpB,MAAOiX,GAGR,QAASkrB,GAAclrB,EAAK+U,EAAUoW,GACrC,GAAsBC,GAAUC,EAA5BC,KAAqCnrD,GAAkB,CAG3DirD,GAAW7X,EAAOlL,QAAUkL,EAAO2S,MACnCmF,EAAUrkC,EAAI9uB,OAAOkzD,GACrBR,EAAiBS,GAEjBE,EAAW5vC,KAAKqkB,EAAK,SAAS/gB,GAM7B,QAASusC,GAAQl5C,GAChB,GAAI5J,GAAU+iD,EAAYC,EAAOltB,EAAyBmtB,CAc1D,OAZAA,GAAsBxrD,EACtBuI,EAAW4J,EAAK5J,SAASC,cACzB8iD,EAAan5C,EAAKrM,WAAWyC,SAASC,cAGhB,IAAlB2J,EAAK3M,UAAkBm1B,GAAmBxoB,KAC7Cq5C,EAAsBxrD,EACtBA,EAA+C,SAA7B26B,GAAmBxoB,GACrCksB,GAA0B,GAIvBotB,EAAKljD,EAAU,OAClBmjD,EAAiB,OAGbtY,EAAO2S,OACVl/B,EAAI/G,OAAO3N,KAOTihC,EAAOl2B,SAAWyuC,EAAUx5C,EAAMtR,EAAM8oD,QAC3C+B,EAAiB,GAMd1rD,IAAoBq+B,GAA2B+U,EAAO2S,QACxD3S,EAAOl2B,SAAW6pC,EAAYx+C,IAAa2d,GAAQolC,EAAYL,IAChE94C,EAAO0U,EAAIwS,OAAOlnB,EAAM84C,GACxBR,EAAiBt4C,GACjBg5C,EAAY70D,KAAK6b,QACjBu5C,EAAiB,IAKdtY,EAAOjsC,WAEVmS,GAAK+wC,EAAY,SAASjX,GAEzB,KAAI,aAAeA,IAAUA,EAAOvrB,YAAcyb,GAIlD,MAAIzc,GAAIpM,GAAGtI,EAAMihC,EAAOjsC,YAAc8/C,EAAY90C,IACjDs4C,EAAiBt4C,EAAMihC,GACvBmY,GAAQ,GACD,GAHR,UAQInY,EAAOlL,QAAUqjB,QACrBG,EAAiB,SAOf1rD,GAAoBq+B,IAA2BnY,GAAQ+kC,EAAU1iD,KAAa2d,GAAQolC,EAAYL,KACjGD,GAAmC,IAAlB74C,EAAK3M,UACC,IAA1B2M,EAAK2C,UAAU3e,QACkB,QAAjCgc,EAAK2C,UAAUyb,WAAW,IACzB02B,EAAY90C,IACXihC,EAAOlL,QAAWpT,GAAQ3iB,IAY7Bu5C,EAAiB,EAEjBpyC,GAAKwC,GAAK3J,EAAKF,YAAao5C,GAExBhtB,IACHr+B,EAAkBwrD,GAInBE,EAAiB,IAnBZA,IAEJA,EAAiB7kC,EAAIjG,MAAMsqC,EAAShkC,IACpC/U,EAAKrM,WAAWwX,aAAaouC,EAAgBv5C,GAC7Cg5C,EAAY70D,KAAKo1D,IAGlBA,EAAel5C,YAAYL,KAvF7B,GAAIu5C,EAwGJpyC,IAAKwF,EAAOusC,KAITjY,EAAOuV,SAAU,GACpBrvC,GAAK6xC,EAAa,SAASh5C,GAC1B,QAASk5C,GAAQl5C,GACM,MAAlBA,EAAK5J,UACRkiD,EAAiBt4C,EAAMihC,GAGxB95B,GAAKwC,GAAK3J,EAAKF,YAAao5C,GAG7BA,EAAQl5C,KAKVmH,GAAK6xC,EAAa,SAASh5C,GAG1B,QAASy5C,GAAcz5C,GACtB,GAAIxN,GAAQ,CAQZ,OANA2U,IAAKnH,EAAKF,WAAY,SAASE,GACzB05C,EAAiB15C,IAAUivC,GAAejvC,IAC9CxN,MAIKA,EAGR,QAASmnD,GAAY35C,GACpB,GAAIuU,GAAO9F,CAkBX,OAhBAtH,IAAKnH,EAAKF,WAAY,SAASE,GAC9B,GAAqB,GAAjBA,EAAK3M,WAAkB47C,GAAejvC,KAAU80C,EAAY90C,GAE/D,MADAuU,GAAQvU,EACD+U,KAKLR,IAAU06B,GAAe16B,IAAUqlC,EAAUrlC,EAAO0sB,KACvDxyB,EAAQiG,EAAIjG,MAAM8F,EAAOQ,IACzBujC,EAAiB7pC,GAEjBiG,EAAIle,QAAQiY,EAAOzO,EAAM6U,IACzBH,EAAI/G,OAAO4G,EAAO,IAGZ9F,GAASzO,EAjCjB,GAAI65C,EAyCJ,IALAA,EAAaJ,EAAcz5C,IAKtBg5C,EAAYh1D,OAAS,IAAM2+B,GAAQ3iB,KAAyB,IAAf65C,EAEjD,WADAnlC,GAAI/G,OAAO3N,EAAM,EAIlB,IAAIihC,EAAOlL,QAAUkL,EAAOl2B,QAAS,CAqBpC,GAnBKk2B,EAAOoV,OAAwB,IAAfwD,IACpB75C,EAAO25C,EAAY35C,IAIpBmH,GAAK+wC,EAAY,SAASjX,GAIzB95B,GAAKuN,EAAIxd,OAAO+pC,EAAOlL,OAAQ/1B,GAAO,SAASuU,GAC1C06B,GAAe16B,IAInBulC,EAAa7Y,EAAQuW,EAAMjjC,EAAO0sB,EAAOoV,MAAQ9hC,EAAQ,UAKvDilC,EAAUx5C,EAAKrM,WAAYjF,EAAM8oD,GAGpC,MAFA9iC,GAAI/G,OAAO3N,EAAM,GACjBA,EAAO,EACA6U,EAIJosB,GAAO8Y,oBACVrlC,EAAIwP,UAAUlkB,EAAKrM,WAAY,SAASwM,GACvC,GAAIq5C,EAAUr5C,EAAQzR,EAAM8oD,GAG3B,MAFA9iC,GAAI/G,OAAO3N,EAAM,GACjBA,EAAO,EACA6U,KAMN7U,GAAQihC,EAAO+Y,kBAAmB,IACrCh6C,EAAOi6C,EAAcC,EAAwBl6C,GAAOA,GACpDA,EAAOi6C,EAAcj6C,EAAMk6C,EAAwBl6C,EAAM6U,SAjS7D,GAAoD4tB,GAAU/U,EAA1DwqB,EAAaprC,EAAIpe,GAAOuyC,EAASiX,EAAW,GAAmB/mB,GAAenxB,GAAQgxB,EAAUG,aAuSpG,IAAgD,UAA5C3I,GAAmBwI,EAAUV,YAYjC,GAAI2Q,EAAQ,CACX,GAAIjhC,EACCA,EAAK3M,UACRq6B,EAAMhZ,EAAIkT,YACV8F,EAAI1Y,eAAehV,GACnB0tB,EAAIvY,YAAYnV,GAChB44C,EAAcuB,EAAUzsB,EAAKwqB,GAAa,MAAM,IAEhDU,EAAc54C,EAAM,MAAM,OAG3B,IAAKmxB,GAAgB8P,EAAOlL,SAAUrhB,EAAIxd,OAAO,+CAA+ClT,OA0B/Fo2D,EAAmB,QAAS1rD,EAAM8oD,OA1BqE,CAEvG,GAAI6C,GAAa1F,EAAG3jB,UAAUV,SAKzBgqB,MAAmBpC,EAAW,GAAGzC,cAAiB/gC,EAAIwP,UAAUm2B,EAAY3lC,EAAIiO,UACpFv+B,EAAM8zD,EAAW,GAAGzC,cAIrBd,EAAG3jB,UAAUge,OAAOyJ,KACpBhW,EAAWzR,EAAU2R,cACrBiW,EAAcuB,EAAUnpB,EAAUC,OAAOpc,IAAOqjC,GAAazV,GAGzDxB,EAAO5uB,SAAW4uB,EAAO5uB,OAAOR,OAASovB,EAAO5uB,OAAO+jC,kBAC1D/sC,GAAKgxC,EAAYhC,EAA0B,cAC3CA,EAAyBgC,IAG1BrpB,EAAU4R,eAAeH,GACzBY,EAAUrS,EAAUC,OAAOpc,KAC3B8/B,EAAGvjB,cAMLsjB,EAAMT,YAAYvlD,EAAMimD,QArDzB,CACC30C,EAAOgxB,EAAUV,SACjB,KAAK,GAAIvsC,GAAI,EAAGqO,EAAI8lD,EAAWl0D,OAAQD,EAAIqO,EAAGrO,IAC7C,GAAIm0D,EAAWn0D,GAAGuxD,iBAAmB5gC,EAAIpM,GAAGtI,EAAMk4C,EAAWn0D,GAAGiR,UAE/D,WADAsjD,GAAiBt4C,EAAMk4C,EAAWn0D,KA6DtC,QAAS4pB,GAAOjf,EAAM8oD,EAAMx3C,EAAMu6C,GAIjC,QAASrB,GAAQl5C,GAChB,GAAI5L,GAAUrQ,EAAGqO,EAAGinD,EAAqBntB,CAazC,IAVsB,IAAlBlsB,EAAK3M,UAAkBm1B,GAAmBxoB,KAC7Cq5C,EAAsBxrD,EACtBA,EAA+C,SAA7B26B,GAAmBxoB,GACrCksB,GAA0B,GAI3B93B,EAAWuV,GAAK3J,EAAKF,YAGjBjS,IAAoBq+B,EACvB,IAAKnoC,EAAI,EAAGqO,EAAI8lD,EAAWl0D,OAAQD,EAAIqO,IAClC0nD,EAAa5B,EAAWn0D,GAAIyzD,EAAMx3C,EAAMA,GADHjc,KAQ3C,GAAIk9C,EAAOle,MACN3uB,EAASpQ,OAAQ,CACpB,IAAKD,EAAI,EAAGqO,EAAIgC,EAASpQ,OAAQD,EAAIqO,EAAGrO,IACvCm1D,EAAQ9kD,EAASrQ,GAGdmoC,KACHr+B,EAAkBwrD,IAMtB,QAASmB,GAAenoD,GACvB,GAAIooD,EAgBJ,OAbAtzC,IAAKgd,EAAW9xB,EAAUsB,YAAY8W,UAAW,SAAStK,GACzD,GAAI8gC,EAGCwZ,IAA2B,UAAbt6C,EAAO7b,IAA+B,QAAb6b,EAAO7b,KAElD28C,EAASuY,EAAUr5C,EAAQzR,EAAM8oD,EAAM+C,GACnCtZ,GAAUA,EAAOr8C,SAAU,IAC9B61D,EAAat6C,MAKTs6C,EAGR,QAASC,GAAaD,EAAYpoD,EAAW3N,EAAQE,GACpD,GAAIub,GAAQsO,EAAOksC,EAAWC,EAAY72D,EAAG82D,CAG7C,IAAIJ,EAAY,CAGf,IAFAI,EAAmBJ,EAAW9mD,WAEzBwM,EAAS9N,EAAUsB,WAAYwM,GAAUA,GAAU06C,EAAkB16C,EAASA,EAAOxM,WAAY,CAGrG,IAFA8a,EAAQiG,EAAIjG,MAAMtO,EAAQ4U,IAErBhxB,EAAI,EAAGA,EAAIm0D,EAAWl0D,OAAQD,IAClC,GAAI+1D,EAAa5B,EAAWn0D,GAAIyzD,EAAM/oC,EAAOA,GAAQ,CACpDA,EAAQ,CACR,OAKEA,IACCksC,GACHlsC,EAAMpO,YAAYs6C,GAGdC,IACJA,EAAansC,GAGdksC,EAAYlsC,IAKV7pB,GAAWq8C,EAAO8W,OAAUp1B,GAAQ83B,KACvCpoD,EAAYqiB,EAAI9vB,MAAM61D,EAAYpoD,IAI/BsoD,IACHj2D,EAAOiP,WAAWwX,aAAawvC,EAAWj2D,GAC1Ck2D,EAAWv6C,YAAY3b,IAIzB,MAAO2N,GAGR,QAASyoD,GAAkBzoD,GAC1B,MAAOqoD,GAAaF,EAAenoD,GAAYA,EAAWA,GAAW,GAGtE,QAASmc,GAAOzK,GACf,GAAI/D,GAAO0U,EAAI5H,IAAI/I,EAAQ,SAAW,QACrCwD,EAAMvH,EAAK+D,EAAQ,aAAe,YAgBnC,OAXIkrC,IAAe1nC,KAClBA,EAAMA,EAAIxD,EAAQ,aAAe,cAId,GAAhBwD,EAAIlU,UAAqC,IAApBkU,EAAI/X,KAAKxL,SACjCujB,EAAMxD,EAAQ/D,EAAKwZ,iBAAmBxZ,EAAKpH,YAAcoH,EAAKpH,aAAeoH,EAAKwZ,iBAGnF9E,EAAI/G,OAAO3N,GAAM,GAEVuH,EAGR,QAASwzC,GAAertB,GACvB,GAAIvX,GAAgBI,EAChBiB,EAA0BkW,EAAIlW,uBAIlC,IAFAkW,EAAMysB,EAAUzsB,EAAKwqB,EAAYrjC,IAE7BosB,EAAOr8C,MAAO,CAIjB,GAHAuxB,EAAiB6kC,EAAattB,EAAK7Y,IACnC0B,EAAeykC,EAAattB,GAExBvX,GAAkBI,EAAc,CAmBnC,GAfI,eAAehpB,KAAK4oB,EAAe/f,WAAa+f,EAAezT,aAEjEyT,EAD8B,MAA3BA,EAAe/f,SACD+f,EAAezT,WAAWA,YAAcyT,EAExCA,EAAezT,YAAcyT,GAK5CqB,GACH,wBAAwBjqB,KAAKiqB,EAAwBphB,WACrDo4B,EAAYjY,IAAiBA,EAAa7T,aAC1C6T,EAAeA,EAAa7T,YAAc6T,GAGvC7B,EAAIgU,UAAUvS,EAAgBI,KAAkBoM,GAAQpM,KAC1DiY,EAAYrY,KAAoBqY,EAAYjY,GAI7C,MAHAJ,GAAiBrL,EAAKqL,EAAgB,QAAS7xB,GAAI,SAAUoqD,gBAAiB,aAC9EoM,EAAkB3kC,QAClBA,EAAiB3H,EAAOqG,IAKzBsB,GAAiBrL,EAAKqL,EAAgB,QAAS7xB,GAAI,SAAUoqD,gBAAiB,aAC9En4B,EAAezL,EAAKyL,EAAc,QAASjyB,GAAI,OAAQoqD,gBAAiB,aAGxEoM,EAAkB3kC,GAClB2kC,EAAkBvkC,GAGlBJ,EAAiB3H,EAAOqG,IACxB0B,EAAe/H,QAEf2H,GAAiBI,EAAeukC,EAAkB3kC,EAInDuX,GAAIvX,eAAiBA,EAAexiB,WAAawiB,EAAexiB,WAAawiB,EAC7EuX,EAAIrX,YAAcvS,GAAUqS,GAC5BuX,EAAInX,aAAeA,EAAa5iB,WAAa4iB,EAAa5iB,WAAa4iB,EACvEmX,EAAIjX,UAAY3S,GAAUyS,GAAgB,EAI3C0iC,EAAW5vC,KAAKqkB,EAAK,SAAS/gB,GAC7BxF,GAAKwF,EAAO,SAAS3M,GACpBk5C,EAAQl5C,GAGc,IAAlBA,EAAK3M,UAA+D,cAA7CshD,EAAGjgC,IAAIqP,SAAS/jB,EAAM,oBAChDA,EAAKrM,YAAqD,cAAvCwkD,EAAkBn4C,EAAKrM,aAC1CmmD,GACC/2B,MAAQ,EACRszB,OAAS,EACTtgB,OAAU,OACV1jB,QACC+jC,eAAkB,cAEjB,KAAMp2C,OA5Mb,GAAoDyiC,GAAU/U,EAA1DwqB,EAAaprC,EAAIpe,GAAOuyC,EAASiX,EAAW,GAAmBrqD,GAAkB,CAmNrF,IAAImS,EAUH,YATIA,EAAK3M,UACRq6B,EAAMhZ,EAAIkT,YACV8F,EAAI1Y,eAAehV,GACnB0tB,EAAIvY,YAAYnV,GAChB+6C,EAAertB,IAEfqtB,EAAe/6C,GAMjB,IAAgD,UAA5CwoB,GAAmBwI,EAAUV,WAa5BU,EAAUG,eAAkB8P,EAAOlL,SAAUrhB,EAAIxd,OAAO,+CAA+ClT,OAa3Go2D,EAAmB,SAAU1rD,EAAM8oD,EAAM+C,IAZzC9X,EAAWzR,EAAU2R,cACrBoY,EAAe/pB,EAAUC,OAAOpc,KAChCmc,EAAU4R,eAAeH,GAIrBxB,EAAOlL,QAAUjoC,EAAMY,EAAM8oD,EAAMxmB,EAAUE,aAChDmS,EAAUrS,EAAUC,QAAO,IAG5B0jB,EAAGvjB,mBAxBJ,CACCpxB,EAAOgxB,EAAUV,SACjB,KAAK,GAAIvsC,GAAI,EAAGqO,EAAI8lD,EAAWl0D,OAAQD,EAAIqO,KACtC8lD,EAAWn0D,GAAGuxD,kBACbwE,EAAa5B,EAAWn0D,GAAIyzD,EAAMx3C,EAAMA,IAFAjc,OAoChD,QAASk3D,GAAOvsD,EAAM8oD,EAAMx3C,GAC3B,GAAIu3C,GAAMzqC,EAAIpe,IAEVZ,EAAMY,EAAM8oD,EAAMx3C,IAAY,UAAYu3C,GAAI,KAAOA,EAAI,GAAG0D,OAG/D72D,EAAMsK,EAAM8oD,EAAMx3C,GAFlB2N,EAAOjf,EAAM8oD,EAAMx3C,GAgBrB,QAASw5C,GAAUx5C,EAAMtR,EAAM8oD,EAAM+C,GAGpC,QAASW,GAAWl7C,EAAMihC,EAAQka,GACjC,GAAI7jD,GAAKjO,EAAkCtF,EAA3BykB,EAAQy4B,EAAOka,EAG/B,IAAIla,EAAOoW,QACV,MAAOpW,GAAOoW,QAAQr3C,EAAMihC,EAAQka,EAIrC,IAAI3yC,EAEH,GAAIA,EAAMxkB,SAAW2L,GACpB,IAAK2H,IAAOkR,GACX,GAAIA,EAAM3K,eAAevG,GAAM,CAO9B,GALCjO,EADiB,eAAd8xD,EACKzmC,EAAIwO,UAAUljB,EAAM1I,GAEpBysB,EAAS/jB,EAAM1I,GAGpBijD,IAAYlxD,IAAU43C,EAAOoV,MAChC,MAGD,MAAMkE,GAAWtZ,EAAOoV,SAAWiD,EAAKjwD,EAAO+xD,EAAoB7C,EAAY/vC,EAAMlR,GAAMkgD,GAAOlgD,IACjG,YAMH,KAAKvT,EAAI,EAAGA,EAAIykB,EAAMxkB,OAAQD,IAC7B,GAAkB,eAAdo3D,EAA6BzmC,EAAIwO,UAAUljB,EAAMwI,EAAMzkB,IAAMggC,EAAS/jB,EAAMwI,EAAMzkB,IACrF,MAAOk9C,EAMX,OAAOA,GAzCR,GAA4BA,GAAQl9C,EAAG8vD,EAAnCqE,EAAaprC,EAAIpe,EA4CrB,IAAIwpD,GAAcl4C,EAEjB,IAAKjc,EAAI,EAAGA,EAAIm0D,EAAWl0D,OAAQD,IAIlC,GAHAk9C,EAASiX,EAAWn0D,GAGhB61D,EAAU55C,EAAMihC,IAAWia,EAAWl7C,EAAMihC,EAAQ,eAAiBia,EAAWl7C,EAAMihC,EAAQ,UAAW,CAE5G,GAAK4S,EAAU5S,EAAO4S,QACrB,IAAK9vD,EAAI,EAAGA,EAAI8vD,EAAQ7vD,OAAQD,IAC/B,IAAK2wB,EAAI7J,SAAS7K,EAAM6zC,EAAQ9vD,IAC/B,MAKH,OAAOk9C,IAeX,QAASnzC,GAAMY,EAAM8oD,EAAMx3C,GAG1B,QAASq7C,GAAar7C,GACrB,GAAI6E,GAAO6P,EAAIgO,SAEf,OAAI1iB,KAAS6E,IAKb7E,EAAO0U,EAAIwP,UAAUlkB,EAAM,SAASA,GACnC,QAAIi4C,EAAiCj4C,EAAMtR,KAIpCsR,EAAKrM,aAAekR,KAAU20C,EAAUx5C,EAAMtR,EAAM8oD,GAAM,MAI3DgC,EAAUx5C,EAAMtR,EAAM8oD,IAnB9B,GAAIvjC,EAuBJ,OAAIjU,GACIq7C,EAAar7C,IAIrBA,EAAOgxB,EAAUV,UACb+qB,EAAar7C,GACT6U,IAIRZ,EAAY+c,EAAUE,WAClBjd,GAAajU,GACZq7C,EAAapnC,GACTY,GAIFE,KAWR,QAASumC,GAASroD,EAAOukD,GACxB,GAAIrH,GAAcoL,KAAyBC,IAiB3C,OAdArL,GAAenf,EAAUE,WACzBxc,EAAIwP,UAAUisB,EAAc,SAASnwC,GACpC,GAAIjc,GAAG2K,CAEP,KAAK3K,EAAI,EAAGA,EAAIkP,EAAMjP,OAAQD,IAC7B2K,EAAOuE,EAAMlP,IAERy3D,EAAW9sD,IAAS8qD,EAAUx5C,EAAMtR,EAAM8oD,KAC9CgE,EAAW9sD,IAAQ,EACnB6sD,EAAmBp3D,KAAKuK,KAGxBgmB,EAAIgO,WAEA64B,EAWR,QAASE,GAAS/sD,GACjB,GAA4BulB,GAAWvE,EAAS3rB,EAAGsB,EAAG2P,EAAlDkjD,EAAaprC,EAAIpe,EAErB,IAAIwpD,EAIH,IAHAjkC,EAAY+c,EAAUE,WACtBxhB,EAAUyU,EAAWlQ,GAEhB5uB,EAAI6yD,EAAWl0D,OAAS,EAAGqB,GAAK,EAAGA,IAAK,CAK5C,GAJA2P,EAAWkjD,EAAW7yD,GAAG2P,UAIpBA,GAAYkjD,EAAW7yD,GAAGowD,aAC9B,MAAO5gC,GAGR,KAAK9wB,EAAI2rB,EAAQ1rB,OAAS,EAAGD,GAAK,EAAGA,IACpC,GAAI2wB,EAAIpM,GAAGoH,EAAQ3rB,GAAIiR,GACtB,MAAO6f,IAMX,MAAOE,IAWR,QAAS2mC,GAAc9D,EAASh0D,EAAU22D,GACzC,GAAIoB,EA6DJ,OA1DKC,KACJA,KACAD,KAEAhH,EAAG3lC,GAAG,aAAc,SAASnmB,GAC5B,GAAI6mB,GAAUyU,EAAWt7B,EAAE8B,SAAUkxD;AAGrCnsC,EAAU7F,EAAMF,KAAK+F,EAAS,SAAS1P,GACtC,MAAwB,IAAjBA,EAAK3M,WAAkB2M,EAAKzJ,aAAa,oBAIjD4Q,GAAKy0C,EAAkB,SAAS38B,EAAWgiB,GAC1C95B,GAAKuI,EAAS,SAAS1P,GACtB,MAAIw5C,GAAUx5C,EAAMihC,KAAYhiB,EAAUs7B,UACpCoB,EAAe1a,KAEnB95B,GAAK8X,EAAW,SAASr7B,GACxBA,GAAS,GAAOoc,KAAMA,EAAMihC,OAAQA,EAAQvxB,QAASA,MAGtDisC,EAAe1a,GAAUhiB,GAG1B48B,EAAe5a,GAAUhiB,GAClB,IAGJg5B,EAAiCj4C,EAAMihC,IAA3C,WAOF95B,GAAKw0C,EAAgB,SAAS18B,EAAWgiB,GACnC4a,EAAe5a,WACZ0a,GAAe1a,GAEtB95B,GAAK8X,EAAW,SAASr7B,GACxBA,GAAS,GAAQoc,KAAMnX,EAAE8B,QAASs2C,OAAQA,EAAQvxB,QAASA,YAQhEvI,GAAKywC,EAAQhzD,MAAM,KAAM,SAASq8C,GAC5B2a,EAAiB3a,KACrB2a,EAAiB3a,MACjB2a,EAAiB3a,GAAQsZ,QAAUA,GAGpCqB,EAAiB3a,GAAQ98C,KAAKP,KAGxBkE,KAaR,QAASsrD,GAAWnS,GACnB,MAAOwT,GAAQrB,WAAWuB,EAAI1T,GA2C/B,QAAS2Y,GAAU55C,EAAMihC,GAExB,MAAIqY,GAAKt5C,EAAMihC,EAAOlL,QACdlhB,GAIJykC,EAAKt5C,EAAMihC,EAAO2S,OACd/+B,GAIJosB,EAAOjsC,SACc,GAAjBgL,EAAK3M,UAAiBqhB,EAAIpM,GAAGtI,EAAMihC,EAAOjsC,UADlD,OAaD,QAASskD,GAAKwC,EAAM9oC,GAOnB,MANA8oC,GAAOA,GAAQ,GACf9oC,EAAOA,GAAQ,GAEf8oC,EAAO,IAAMA,EAAK1lD,UAAY0lD,GAC9B9oC,EAAO,IAAMA,EAAK5c,UAAY4c,GAEvB8oC,EAAKzlD,eAAiB2c,EAAK3c,cAYnC,QAAS0tB,GAAS/jB,EAAMtR,GACvB,MAAO0sD,GAAoB1mC,EAAIqP,SAAS/jB,EAAMtR,GAAOA,GAYtD,QAAS0sD,GAAoB/xD,EAAOqF,GAgBnC,MAdY,SAARA,GAA2B,mBAARA,IACtBrF,EAAQqrB,EAAI7D,MAAMxnB,IAIP,cAARqF,GAAiC,KAATrF,IAC3BA,EAAQ,QAIG,cAARqF,IACHrF,EAAQA,EAAMmN,QAAQ,UAAW,IAAIA,QAAQ,QAAS,MAGhD,GAAKnN,EAWb,QAASkvD,GAAYlvD,EAAOmuD,GAS3B,MARoB,gBAATnuD,GACVA,EAAQA,EAAMmuD,GACJA,IACVnuD,EAAQA,EAAMmN,QAAQ,UAAW,SAAS4R,EAAK1Z,GAC9C,MAAO8oD,GAAK9oD,IAAS0Z,KAIhB/e,EAGR,QAASqwD,GAAiB15C,GACzB,MAAOA,IAA0B,IAAlBA,EAAK3M,UAAkB,kBAAkB9F,KAAKyS,EAAK2C,WAGnE,QAASmI,GAAK9K,EAAMtR,EAAMuJ,GACzB,GAAI8S,GAAU2J,EAAI9uB,OAAO8I,EAAMuJ,EAK/B,OAHA+H,GAAKrM,WAAWwX,aAAaJ,EAAS/K,GACtC+K,EAAQ1K,YAAYL,GAEb+K,EAeR,QAASovC,GAAUzsB,EAAKuT,EAAQtzB,GAQ/B,QAASouC,GAAoBh4C,GAO5B,QAASi4C,GAAUh8C,GAClB,MAAwB,MAAjBA,EAAK5J,UAAoB4J,EAAKzJ,aAAa,oBAAsByJ,EAAKpH,YAP9E,GAAIvG,GAAW8N,EAAQqL,EAASC,EAAa5G,CAW7C,IATAxS,EAAY8N,EAAS4D,EAAQoS,EAAiBI,EAC9C9K,EAAc1H,EAAQ,kBAAoB,cAC1Cc,EAAO6P,EAAIgO,UAOe,GAAtBrwB,EAAUgB,WAAkBqmD,EAAiBrnD,KAC5C0R,EAAQsS,EAAc,EAAII,EAAYpkB,EAAUsQ,UAAU3e,QAC7D,MAAOqO,EAKT,QAAa,CAEZ,IAAK4uC,EAAO,GAAG0W,cAAgBh1B,GAAQxiB,GACtC,MAAOA,EAIR,KAAKqL,EAAUrL,EAAOsL,GAAcD,EAASA,EAAUA,EAAQC,GAC9D,IAAKwjC,GAAezjC,KAAakuC,EAAiBluC,KAAawwC,EAAUxwC,GACxE,MAAOrL,EAKT,IAAIA,GAAU0E,GAAQ1E,EAAOxM,YAAckR,EAAM,CAChDxS,EAAY8N,CACZ,OAGDA,EAASA,EAAOxM,WAGjB,MAAOtB,GAKR,QAAS4pD,GAASj8C,EAAMsP,GAKvB,IAJIA,IAAW3f,IACd2f,EAA2B,IAAlBtP,EAAK3M,SAAiB2M,EAAKhc,OAASgc,EAAKF,WAAW9b,QAGvDgc,GAAQA,EAAKquB,iBACnBruB,EAAOA,EAAKF,WAAWwP,GACnBtP,IACHsP,EAA2B,IAAlBtP,EAAK3M,SAAiB2M,EAAKhc,OAASgc,EAAKF,WAAW9b,OAG/D,QAAQgc,KAAMA,EAAMsP,OAAQA,GAwB7B,QAAS4sC,GAA0Bl8C,GAGlC,IAFA,GAAIG,GAASH,EAENG,GAAQ,CACd,GAAwB,IAApBA,EAAO9M,UAAkBm1B,GAAmBroB,GAC/C,MAAsC,UAA/BqoB,GAAmBroB,GAAsBA,EAASH,CAG1DG,GAASA,EAAOxM,WAGjB,MAAOqM,GAGR,QAASm8C,GAAiB9pD,EAAWid,EAAQvL,GAG5C,QAASq4C,GAAUp8C,EAAMsP,GACxB,GAAItpB,GAAKq2D,EAAMj0C,EAAMpI,EAAK2C,SAqB1B,OAnBqB,mBAAV2M,KACVA,EAASvL,EAAQqE,EAAIpkB,OAAS,GAG3B+f,GACH/d,EAAMoiB,EAAIgjB,YAAY,IAAK9b,GAC3B+sC,EAAOj0C,EAAIgjB,YAAY,IAAU9b,GACjCtpB,EAAMA,EAAMq2D,EAAOr2D,EAAMq2D,EAGrBr2D,QAAe2nB,GAClB3nB,MAGDA,EAAMoiB,EAAI1a,QAAQ,IAAK4hB,GACvB+sC,EAAOj0C,EAAI1a,QAAQ,IAAU4hB,GAC7BtpB,EAAMA,SAAeq2D,QAAer2D,EAAMq2D,GAAQr2D,EAAMq2D,GAGlDr2D,EAxBR,GAAIyhC,GAAQznB,EAAMha,EAAKs2D,CA2BvB,IAA2B,IAAvBjqD,EAAUgB,SAAgB,CAG7B,GAFArN,EAAMo2D,EAAU/pD,EAAWid,GAEvBtpB,OACH,OAAQqM,UAAWA,EAAWid,OAAQtpB,EAGvCs2D,GAAejqD,EAKhB,IADAo1B,EAAS,GAAI3G,GAAWzuB,EAAWqiB,EAAIwP,UAAU7xB,EAAWswB,KAAYgyB,EAAGjkB,WACnE1wB,EAAOynB,EAAO1jB,EAAQ,OAAS,WACtC,GAAsB,IAAlB/D,EAAK3M,UAIR,GAHAipD,EAAet8C,EACfha,EAAMo2D,EAAUp8C,GAEZha,OACH,OAAQqM,UAAW2N,EAAMsP,OAAQtpB,OAE5B,IAAI28B,GAAQ3iB,GAClB,KAIF,IAAIs8C,EAOH,MALChtC,GADGvL,EACM,EAEAu4C,EAAat4D,QAGfqO,UAAWiqD,EAAchtC,OAAQA,GAI3C,QAASitC,GAAqBlqD,EAAWmqD,GACxC,GAAI9sC,GAAS3rB,EAAGuB,EAAGm3D,CAOnB,KAL0B,GAAtBpqD,EAAUgB,UAAgD,IAA/BhB,EAAUsQ,UAAU3e,QAAgBqO,EAAUmqD,KAC5EnqD,EAAYA,EAAUmqD,IAGvB9sC,EAAUyU,EAAW9xB,GAChBtO,EAAI,EAAGA,EAAI2rB,EAAQ1rB,OAAQD,IAC/B,IAAKuB,EAAI,EAAGA,EAAI27C,EAAOj9C,OAAQsB,IAI9B,GAHAm3D,EAAYxb,EAAO37C,KAGf,aAAem3D,IAAaA,EAAU/mC,YAAcgY,EAAIhY,YAIxDhB,EAAIpM,GAAGoH,EAAQ3rB,GAAI04D,EAAUznD,UAChC,MAAO0a,GAAQ3rB,EAKlB,OAAOsO,GAGR,QAASqqD,GAAkBrqD,EAAWmqD,GACrC,GAAIx8C,GAAM6E,EAAO6P,EAAIgO,SAqBrB,IAlBKue,EAAO,GAAGl2B,UACd/K,EAAO0U,EAAIwP,UAAU7xB,EAAW4uC,EAAO,GAAG2S,MAAO/uC,IAI7C7E,IACJA,EAAO0U,EAAIwP,UAAgC,GAAtB7xB,EAAUgB,SAAgBhB,EAAUsB,WAAatB,EAAW,SAAS2N,GAEzF,MAAOA,IAAQ6E,GAAQ+vC,EAAY50C,MAKjCA,GAAQihC,EAAO,GAAGl2B,UACrB/K,EAAOmkB,EAAWnkB,EAAM,SAASyK,UAAU,IAAMzK,IAI7CA,EAGJ,IAFAA,EAAO3N,EAEA2N,EAAKw8C,KAAkB75B,GAAQ3iB,EAAKw8C,MAC1Cx8C,EAAOA,EAAKw8C,IAIRlD,EAAKt5C,EAAM,SAMjB,MAAOA,IAAQ3N,EApOhB,GAAIsqD,GAASC,EAAMxuB,EAClBjY,EAAiBuX,EAAIvX,eACrBE,EAAcqX,EAAIrX,YAClBE,EAAemX,EAAInX,aACnBE,EAAYiX,EAAIjX,SA0PjB,IA1L+B,GAA3BN,EAAe9iB,UAAiB8iB,EAAekY,kBAClDsuB,EAAUxmC,EAAerW,WAAW9b,OAAS,EAC7CmyB,EAAiBA,EAAerW,WAAWuW,EAAcsmC,EAAUA,EAAUtmC,GAE9C,GAA3BF,EAAe9iB,WAClBgjB,EAAc,IAKa,GAAzBE,EAAaljB,UAAiBkjB,EAAa8X,kBAC9CsuB,EAAUpmC,EAAazW,WAAW9b,OAAS,EAC3CuyB,EAAeA,EAAazW,WAAW2W,EAAYkmC,EAAUA,EAAUlmC,EAAY,GAEtD,GAAzBF,EAAaljB,WAChBojB,EAAYF,EAAa5T,UAAU3e,SAqJrCmyB,EAAiB+lC,EAA0B/lC,GAC3CI,EAAe2lC,EAA0B3lC,IAGrC04B,GAAe94B,EAAexiB,aAAes7C,GAAe94B,MAC/DA,EAAiB84B,GAAe94B,GAAkBA,EAAiBA,EAAexiB,WAClFwiB,EAAiBA,EAAevd,aAAeud,EAEhB,GAA3BA,EAAe9iB,WAClBgjB,EAAc,KAIZ44B,GAAe14B,EAAa5iB,aAAes7C,GAAe14B,MAC7DA,EAAe04B,GAAe14B,GAAgBA,EAAeA,EAAa5iB,WAC1E4iB,EAAeA,EAAaiD,iBAAmBjD,EAElB,GAAzBA,EAAaljB,WAChBojB,EAAYF,EAAavyB,SAIvBi9C,EAAO,GAAGlL,SACTrI,EAAIhY,YAEP0Y,EAAW+tB,EAAiBhmC,EAAgBE,GAAa,GACrD+X,IACHjY,EAAiBiY,EAAS/7B,UAC1BgkB,EAAc+X,EAAS9e,QAIxB8e,EAAW+tB,EAAiB5lC,EAAcE,GACtC2X,IACH7X,EAAe6X,EAAS/7B,UACxBokB,EAAY2X,EAAS9e,SAKvBstC,EAAOX,EAAS1lC,EAAcE,GAC1BmmC,EAAK58C,MAAM,CACd,KAAO48C,EAAK58C,MAAwB,IAAhB48C,EAAKttC,QAAgBstC,EAAK58C,KAAKwZ,iBAClDojC,EAAOX,EAASW,EAAK58C,KAAKwZ,gBAGvBojC,GAAK58C,MAAQ48C,EAAKttC,OAAS,GAA4B,IAAvBstC,EAAK58C,KAAK3M,UACI,MAAhDupD,EAAK58C,KAAK2C,UAAU8J,OAAOmwC,EAAKttC,OAAS,IAEtCstC,EAAKttC,OAAS,IACjBiH,EAAeqmC,EAAK58C,KACpBuW,EAAac,UAAUulC,EAAKttC,OAAS,IA0DzC,OAhDI2xB,EAAO,GAAGlL,QAAUkL,EAAO,GAAG0W,gBAC5B1W,EAAO,GAAGlL,QAAsC,GAA3B5f,EAAe9iB,UAAiC,IAAhBgjB,IACzDF,EAAiB4lC,GAAoB,IAGjC9a,EAAO,GAAGlL,QAAoC,GAAzBxf,EAAaljB,UAAiBojB,IAAcF,EAAa5T,UAAU3e,SAC5FuyB,EAAewlC,MAKb9a,EAAO,GAAGjsC,UAAYisC,EAAO,GAAGyW,SAAW3iC,KAAUksB,EAAO,GAAGlL,SAElE5f,EAAiBomC,EAAqBpmC,EAAgB,mBACtDI,EAAegmC,EAAqBhmC,EAAc,iBAI/C0qB,EAAO,GAAG2S,OAAS3S,EAAO,GAAGjsC,YAEhCmhB,EAAiBumC,EAAkBvmC,EAAgB,mBACnDI,EAAemmC,EAAkBnmC,EAAc,eAG3C0qB,EAAO,GAAG2S,QACRjxB,GAAQxM,KACZA,EAAiB4lC,GAAoB,IAGjCp5B,GAAQpM,KACZA,EAAewlC,OAMa,GAA3B5lC,EAAe9iB,WAClBgjB,EAAcvS,GAAUqS,GACxBA,EAAiBA,EAAexiB,YAIJ,GAAzB4iB,EAAaljB,WAChBojB,EAAY3S,GAAUyS,GAAgB,EACtCA,EAAeA,EAAa5iB,aAK5BwiB,eAAgBA,EAChBE,YAAaA,EACbE,aAAcA,EACdE,UAAWA,GAIb,QAASomC,GAAuB78C,EAAMihC,GACrC,MAAOA,GAAOuV,OAAyB,KAAhBx2C,EAAKsvB,QAc7B,QAASwqB,GAAa7Y,EAAQuW,EAAMx3C,EAAM88C,GACzC,GAAI/4D,GAAGkU,EAAO8kD,CAGd,KAAKnD,EAAU55C,EAAMihC,KAAY4b,EAAuB78C,EAAMihC,GAC7D,MAAOlsB,GAIR,IAAqB,OAAjBksB,EAAOtzB,OAkFV,IAhFAxG,GAAK85B,EAAO5uB,OAAQ,SAAShpB,EAAOqF,GACnCrF,EAAQ+xD,EAAoB7C,EAAYlvD,EAAOmuD,GAAO9oD,GAGlC,gBAATA,KACVA,EAAOrF,EACPyzD,EAAe,IAGZ7b,EAAOwV,iBAAoBqG,GAAgBxD,EAAKv1B,EAAS+4B,EAAcpuD,GAAOrF,KACjFqrB,EAAIwQ,SAASllB,EAAMtR,EAAM,IAG1BquD,EAAiB,IAIdA,GAAmD,KAAjCroC,EAAIwO,UAAUljB,EAAM,WACzCA,EAAK/I,gBAAgB,SACrB+I,EAAK/I,gBAAgB,mBAItBkQ,GAAK85B,EAAO/iC,WAAY,SAAS7U,EAAOqF,GACvC,GAAIsuD,EAUJ,IARA3zD,EAAQkvD,EAAYlvD,EAAOmuD,GAGP,gBAAT9oD,KACVA,EAAOrF,EACPyzD,EAAe,IAGXA,GAAgBxD,EAAK5kC,EAAIwO,UAAU45B,EAAcpuD,GAAOrF,GAAQ,CAEpE,GAAY,SAARqF,IACHrF,EAAQqrB,EAAIwO,UAAUljB,EAAMtR,GACxBrF,IAEH2zD,EAAW,GACX71C,GAAK9d,EAAMzE,MAAM,OAAQ,SAAS4hC,GAC7B,WAAWj5B,KAAKi5B,KACnBw2B,IAAaA,EAAW,IAAM,IAAMx2B,KAKlCw2B,IAEH,WADAtoC,GAAIuO,UAAUjjB,EAAMtR,EAAMsuD,EAOjB,UAARtuD,GACHsR,EAAK/I,gBAAgB,aAIlBgmD,GAAY1vD,KAAKmB,IACpBsR,EAAK/I,gBAAgB,YAAcvI,GAGpCsR,EAAK/I,gBAAgBvI,MAKvByY,GAAK85B,EAAO4S,QAAS,SAASxqD,GAC7BA,EAAQkvD,EAAYlvD,EAAOmuD,GAEtBsF,IAAgBpoC,EAAI7J,SAASiyC,EAAczzD,IAC/CqrB,EAAI9F,YAAY5O,EAAM3W,KAKxB4O,EAAQyc,EAAIsO,WAAWhjB,GAClBjc,EAAI,EAAGA,EAAIkU,EAAMjU,OAAQD,IAC7B,GAAuC,IAAnCkU,EAAMlU,GAAGqS,SAAS1I,QAAQ,KAC7B,MAAOqnB,GAMV,OAAqB,QAAjBksB,EAAOtzB,QACVuvC,EAAWl9C,EAAMihC,GACVpsB,IAFR,OAwBD,QAASqoC,GAAWl9C,EAAMihC,GAGzB,QAASrkC,GAAKoD,EAAM2P,EAAMwtC,GAGzB,MAFAn9C,GAAOk6C,EAAwBl6C,EAAM2P,EAAMwtC,IAEnCn9C,GAA0B,MAAjBA,EAAK5J,UAAoBusB,GAAQ3iB,GALnD,GAAkCo9C,GAA9BzpD,EAAaqM,EAAKrM,UAQlBstC,GAAO2S,QACL0G,GAaA3mD,GAAc+gB,EAAIgO,YAChBue,EAAOoc,YAAe/D,EAAKt5C,EAAMihC,EAAOoc,aAC5Cl2C,GAAKwC,GAAK3J,EAAKF,YAAa,SAASE,GAChC+T,GAAQumC,GAAiBt6C,EAAK5J,SAASC,eACrC+mD,EAIJA,EAAa/8C,YAAYL,IAHzBo9C,EAAetyC,EAAK9K,EAAMs6C,IAC1B5lC,EAAImQ,WAAWu4B,EAAczI,EAAGhkC,SAASmsB,0BAK1CsgB,EAAe,KAtBfz6B,GAAQ3iB,KAAU2iB,GAAQhvB,KACxBiJ,EAAKoD,EAAM+U,KAAWnY,EAAKoD,EAAK0C,WAAYmS,GAAM,IACtD7U,EAAKmL,aAAauJ,EAAI9uB,OAAO,MAAOoa,EAAK0C,YAGrC9F,EAAKoD,EAAM6U,KAAUjY,EAAKoD,EAAKiE,UAAW8Q,GAAO,IACrD/U,EAAKK,YAAYqU,EAAI9uB,OAAO,SAyB5Bq7C,EAAOjsC,UAAYisC,EAAOlL,SAAWujB,EAAKrY,EAAOlL,OAAQ/1B,IAI7D0U,EAAI/G,OAAO3N,EAAM,GAYlB,QAASk6C,GAAwBl6C,EAAM2P,EAAMwtC,GAC5C,GAAIn9C,EAGH,IAFA2P,EAAOA,EAAO,cAAgB,kBAEzB3P,EAAOm9C,EAAMn9C,EAAOA,EAAK2P,GAAO3P,EAAMA,EAAOA,EAAK2P,GACtD,GAAqB,GAAjB3P,EAAK3M,WAAkBqmD,EAAiB15C,GAC3C,MAAOA,GAcX,QAASi6C,GAAcrqC,EAAMD,GAG5B,QAAS2tC,GAAmBt9C,EAAMw8C,GACjC,IAAKhxC,EAAUxL,EAAMwL,EAASA,EAAUA,EAAQgxC,GAAe,CAC9D,GAAwB,GAApBhxC,EAAQnY,UAA8C,IAA7BmY,EAAQ7I,UAAU3e,OAC9C,MAAOgc,EAGR,IAAwB,GAApBwL,EAAQnY,WAAkB47C,GAAezjC,GAC5C,MAAOA,GAIT,MAAOxL,GAbR,GAAIwL,GAAS+xC,EAAYC,EAAe,GAAI3K,GAAan+B,EAiBzD,IAAI9E,GAAQD,IAEXC,EAAO0tC,EAAmB1tC,EAAM,mBAChCD,EAAO2tC,EAAmB3tC,EAAM,eAG5B6tC,EAAah8C,QAAQoO,EAAMD,IAAO,CAErC,IAAKnE,EAAUoE,EAAKhX,YAAa4S,GAAWA,GAAWmE,GACtD4tC,EAAa/xC,EACbA,EAAUA,EAAQ5S,YAClBgX,EAAKvP,YAAYk9C,EAWlB,OAPA7oC,GAAI/G,OAAOgC,GAGXxI,GAAKwC,GAAKgG,EAAK7P,YAAa,SAASE,GACpC4P,EAAKvP,YAAYL,KAGX4P,EAIT,MAAOD,GAGR,QAASqrC,GAAattB,EAAK3pB,GAC1B,GAAI1R,GAAWid,EAAQqtC,CAyBvB,OAvBAtqD,GAAYq7B,EAAI3pB,EAAQ,iBAAmB,gBAC3CuL,EAASoe,EAAI3pB,EAAQ,cAAgB,aAEX,GAAtB1R,EAAUgB,WACbspD,EAAUtqD,EAAUyN,WAAW9b,OAAS,GAEnC+f,GAASuL,GACbA,IAGDjd,EAAYA,EAAUyN,WAAWwP,EAASqtC,EAAUA,EAAUrtC,IAIpC,IAAvBjd,EAAUgB,UAAkB0Q,GAASuL,GAAUjd,EAAUsQ,UAAU3e,SACtEqO,EAAY,GAAIyuB,GAAWzuB,EAAWsiD,EAAGjkB,WAAW/gB,QAAUtd,GAIpC,IAAvBA,EAAUgB,UAAmB0Q,GAAoB,IAAXuL,IACzCjd,EAAY,GAAIyuB,GAAWzuB,EAAWsiD,EAAGjkB,WAAW9gB,QAAUvd,GAGxDA,EAGR,QAAS+nD,GAAmBpqD,EAAMtB,EAAM8oD,EAAM+C,GAI7C,QAASkD,GAAqBC,GAC7B,GAAIC,GAAiBjpC,EAAI9uB,OAAO,QAAStB,GAAIs5D,EAAkB9V,kBAAkB,EAAMx6B,MAAOuwC,EAAQ,YAAc,IAMpH,OAJIH,IACHC,EAAet9C,YAAYs0C,EAAG9jB,SAAS1X,eAAe2kC,KAGhDH,EAGR,QAASI,GAAsB/9C,EAAM2M,GACpC,KAAO3M,GAAM,CACZ,GAAuB,IAAlBA,EAAK3M,UAAkB2M,EAAK2C,YAAcm7C,IAAmB99C,EAAKF,WAAW9b,OAAS,EAC1F,OAAO,CAIJ2oB,IAA2B,IAAlB3M,EAAK3M,UACjBsZ,EAAMxoB,KAAK6b,GAGZA,EAAOA,EAAK0C,WAGb,OAAO,EAIR,QAASs7C,GAAwBh+C,GAChC,KAAOA,GAAM,CACZ,GAAIA,EAAK1b,KAAOs5D,EACf,MAAO59C,EAGRA,GAAOA,EAAKrM,YAKd,QAASsqD,GAAkBj+C,GAC1B,GAAIynB,EAEJ,IAAIznB,EAGH,IAFAynB,EAAS,GAAI3G,GAAW9gB,EAAMA,GAEzBA,EAAOynB,EAAOn0B,UAAW0M,EAAMA,EAAOynB,EAAO9X,OACjD,GAAsB,IAAlB3P,EAAK3M,SACR,MAAO2M,GAOX,QAASk+C,GAAqBl+C,EAAMm+C,GACnC,GAAI5pC,GAAOmZ,CAEX,IAAK1tB,EASJ0tB,EAAMsD,EAAUC,QAAO,GAEnB8sB,EAAsB/9C,IACrBm+C,KAAe,IAClBzwB,EAAI1Y,eAAehV,GACnB0tB,EAAIxY,aAAalV,IAGlB0U,EAAI/G,OAAO3N,KAEXuU,EAAQ0pC,EAAkBj+C,GAEtBuU,EAAM5R,UAAU8J,OAAO,KAAOqxC,KACjCvpC,EAAM2E,WAAW,EAAG,GAGhBwU,EAAIvX,gBAAkB5B,GAASmZ,EAAIrX,YAAc,GACpDqX,EAAI/Y,SAASJ,EAAOmZ,EAAIrX,YAAc,GAGnCqX,EAAInX,cAAgBhC,GAASmZ,EAAIjX,UAAY,GAChDiX,EAAI5Y,OAAOP,EAAOmZ,EAAIjX,UAAY,IAIpC/B,EAAI/G,OAAO3N,EAAM,IAGlBgxB,EAAUge,OAAOthB,OAlCjB,IAFA1tB,EAAOg+C,EAAwBhtB,EAAUE,aAEpClxB,EACJ,KAAQA,EAAO0U,EAAI5H,IAAI8wC,IACtBM,EAAqBl+C,GAAM,GAqC/B,QAASo+C,KACR,GAAI1wB,GAAKiwB,EAAgB3wB,EAAU1d,EAAQmzB,EAAUpwC,EAAWkS,CAEhEmpB,GAAMsD,EAAUC,QAAO,GACvB3hB,EAASoe,EAAIrX,YACbhkB,EAAYq7B,EAAIvX,eAChB5R,EAAOlS,EAAUsQ,UAEjBg7C,EAAiBK,EAAwBhtB,EAAUE,YAC/CysB,IACH3wB,EAAWixB,EAAkBN,IAI1Bp5C,GAAQ+K,EAAS,GAAKA,EAAS/K,EAAKvgB,QAAU,KAAKuJ,KAAKgX,EAAKkI,OAAO6C,KAAY,KAAK/hB,KAAKgX,EAAKkI,OAAO6C,EAAS,KAElHmzB,EAAWzR,EAAU2R,cAGrBjV,EAAItY,UAAS,GAGbsY,EAAMysB,EAAUzsB,EAAK5gB,EAAIpe,IACzBg/B,EAAMurB,EAAWr0D,MAAM8oC,GAGvBtpC,EAAMsK,EAAM8oD,EAAM9pB,GAGlBsD,EAAU4R,eAAeH,KAEpBkb,GAAkB3wB,EAASrqB,YAAcm7C,GAS7C15D,EAAMsK,EAAM8oD,EAAMmG,IARlBA,EAAiBF,GAAqB,GACtCzwB,EAAW2wB,EAAej7C,WAE1BgrB,EAAIxW,WAAWymC,GACfruC,EAAS,EAETlrB,EAAMsK,EAAM8oD,EAAMmG,IAMnB3sB,EAAUue,kBAAkBviB,EAAU1d,IAIxC,QAAS+uC,KACR,GAAkChsD,GAAWid,EAAQmzB,EACpD6b,EAAiBt+C,EAAMu+C,EAA0Bx6D,EAAG45D,EADjDjwB,EAAMsD,EAAUC,QAAO,GACSvhB,IAcpC,KAZArd,EAAYq7B,EAAIvX,eAChB7G,EAASoe,EAAIrX,YACbrW,EAAO3N,EAEmB,GAAtBA,EAAUgB,WACTic,GAAUjd,EAAUsQ,UAAU3e,SACjCs6D,GAAkB,GAGnBt+C,EAAOA,EAAKrM,YAGNqM,GAAM,CACZ,GAAIw5C,EAAUx5C,EAAMtR,EAAM8oD,EAAM+C,GAAU,CACzCgE,EAAav+C,CACb,OAGGA,EAAKpH,cACR0lD,GAAkB,GAGnB5uC,EAAQvrB,KAAK6b,GACbA,EAAOA,EAAKrM,WAIb,GAAK4qD,EAKL,GAAID,EAEH7b,EAAWzR,EAAU2R,cAGrBjV,EAAItY,UAAS,GAGbsY,EAAMysB,EAAUzsB,EAAK5gB,EAAIpe,IAAO,GAChCg/B,EAAMurB,EAAWr0D,MAAM8oC,GAGvB/f,EAAOjf,EAAM8oD,EAAM9pB,GAGnBsD,EAAU4R,eAAeH,OACnB,CAIN,IAHAkb,EAAiBF,IAEjBz9C,EAAO29C,EACF55D,EAAI2rB,EAAQ1rB,OAAS,EAAGD,GAAK,EAAGA,IACpCic,EAAKK,YAAYqU,EAAIjG,MAAMiB,EAAQ3rB,IAAI,IACvCic,EAAOA,EAAK0C,UAIb1C,GAAKK,YAAYqU,EAAIrkB,IAAI8oB,eAAe2kC,KACxC99C,EAAOA,EAAK0C,UAEZ,IAAIkxC,GAAQl/B,EAAIwP,UAAUq6B,EAAY3J,EAElChB,IAASl/B,EAAI8S,QAAQosB,GAExB2K,EAAW5qD,WAAWszB,aAAa02B,EAAgBY,GAGnD7pC,EAAI0C,YAAYumC,EAAgBY,GAIjCvtB,EAAUue,kBAAkBvvC,EAAM,GAG9B0U,EAAI8S,QAAQ+2B,IACf7pC,EAAI/G,OAAO4wC,IAOd,QAASC,KACR,GAAIb,EAEJA,GAAiBK,EAAwBhtB,EAAUE,YAC/CysB,IAAmBjpC,EAAI8S,QAAQm2B,IAClCt0C,GAAKs0C,EAAgB,SAAS39C,GACR,GAAjBA,EAAK3M,UAAiB2M,EAAK1b,KAAOs5D,GAAqBlpC,EAAI8S,QAAQxnB,IACtE0U,EAAIuO,UAAUjjB,EAAM,iBAAkB,OAErC,cAtPL,GAAI49C,GAAmB,aAAcC,EAAQlJ,EAAGhkC,SAAS8tC,WA2PpD9J,GAAG+J,kBAEPC,EAA2B,WAC1B,GAAgB56D,GAAZ4oB,IAEJ,IAAIoxC,EAAsBC,EAAwBhtB,EAAUE,YAAavkB,GAGxE,IADA5oB,EAAI4oB,EAAM3oB,OACHD,KACN2wB,EAAIuO,UAAUtW,EAAM5oB,GAAI,iBAAkB,MAK7C66D,EAAwB,SAAS/1D,GAChC,GAAIg2D,GAAUh2D,EAAEg2D,OAEhBX,KAGe,GAAXW,GAAgB7tB,EAAUG,eAAiBH,EAAUE,WAAWrwB,WAAai9C,IAChFI,EAAqBF,EAAwBhtB,EAAUE,aAIzC,IAAX2tB,GAA4B,IAAXA,GACpBX,EAAqBF,EAAwBhtB,EAAUE,aAGxDstB,KAID7J,EAAG3lC,GAAG,aAAc,SAASnmB,GACxBA,EAAEmoC,WACLwtB,MAGF7J,EAAG+J,iBAAkB,GAIV,SAAR1uD,EACHouD,IAEAC,IAOF,QAAShb,GAAU3V,GAClB,GAC4BoxB,GAC1Br3B,EAAQznB,EAAM2M,EAAOoyC,EAFnB1sD,EAAYq7B,EAAIvX,eAClB7G,EAASoe,EAAIrX,WAGf,KAAIqX,EAAIvX,gBAAkBuX,EAAInX,eACzBs+B,EAAcnnB,EAAIvX,eAAerW,WAAW4tB,EAAIrX,iBAM3B,GAAtBhkB,EAAUgB,UAAiBic,GAAUjd,EAAUsQ,UAAU3e,SAE5DsrB,EAASxL,GAAUzR,GACnBA,EAAYA,EAAUsB,WACtBmrD,GAAgB,GAIS,GAAtBzsD,EAAUgB,UAUb,IATAsZ,EAAQta,EAAUyN,WAClBzN,EAAYsa,EAAMllB,KAAKhB,IAAI6oB,EAAQ3C,EAAM3oB,OAAS,IAClDyjC,EAAS,GAAI3G,GAAWzuB,EAAWqiB,EAAIwP,UAAU7xB,EAAWqiB,EAAIiO,WAG5DrT,EAAS3C,EAAM3oB,OAAS,GAAK86D,IAChCr3B,EAAO9X,OAGH3P,EAAOynB,EAAOn0B,UAAW0M,EAAMA,EAAOynB,EAAO9X,OACjD,GAAqB,GAAjB3P,EAAK3M,WAAkBqmD,EAAiB15C,GAW3C,MARA++C,GAAUrqC,EAAI9uB,OAAO,KAAMkiD,iBAAkB,OAAQgW,IACrD99C,EAAKrM,WAAWwX,aAAa4zC,EAAS/+C,GAGtC0tB,EAAI/Y,SAAS3U,EAAM,GACnBgxB,EAAUge,OAAOthB,OACjBhZ,GAAI/G,OAAOoxC,GAh1Ef,GAYCnD,GACAjsD,EAEAivD,EACAD,EAhBG/G,KACHljC,EAAMigC,EAAGjgC,IACTsc,EAAY2jB,EAAG3jB,UACfioB,EAAa,GAAIxrB,GAAW/Y,GAC5BX,GAAU4gC,EAAG/jC,OAAOwnB,aACpBzV,GAAUjO,EAAIiO,QACd23B,GAAkB3F,EAAGhkC,SAASgtB,kBAC9B75B,GAAY4Q,EAAI5Q,UAChBg6C,GAAiB,SACjBb,GAAc,qBACdloC,IAAQ,EACRF,IAAO,EAGP2T,GAAqB9T,EAAI8T,mBAGzBymB,GAAiBf,EAAgBe,eAE9B9nC,GAAO0C,EAAM1C,KAChBwC,GAAOE,EAAMF,KACbN,GAAOQ,EAAMR,KACbF,GAASU,EAAMV,MA+rChBA,IAAOrhB,MACNglB,IAAKA,EACLkoC,SAAUA,EACVgD,WAAYA,EACZ5zD,MAAOA,EACPupB,OAAQA,EACRstC,OAAQA,EACRntD,MAAOA,EACPwtD,SAAUA,EACV9B,UAAWA,EACXiC,SAAUA,EACVC,cAAeA,EACftI,WAAYA,IAIb2B,IACA8C,IACAlD,EAAG3lC,GAAG,mBAAoB,SAASnmB,GAC9B81D,GAAwC,OAAZ91D,EAAEo4C,QACjC0d,MAGFhK,EAAG3lC,GAAG,kBAAmB,SAASnmB,GAC7B+1D,GACHA,EAAsB/1D,QA6nC1BxE,EAAO,uBACN,kBACA,eACE,SAASygD,EAAIt2C,GACf,MAAO,UAAS7C,GAGf,QAASmzC,KACR,MAAOnzC,GAAOyjD,WAAWlP,oBAG1B,QAAS8e,GAASnwC,GACjBljB,EAAOqzD,SAASnwC,GAGjB,QAASowC,GAAsBp2D,GAC9BkJ,EAAKmtD,QAAS,EACdntD,EAAK2a,OAAQ7jB,GAZd,GAAuCs2D,GAAgBC,EAAnDrtD,EAAOjK,KAAM2f,EAAQ,EAAGjY,KAAkD6vD,EAAQ,CA6VtF,OA7UA1zD,GAAOqjB,GAAG,OAAQ,WACjBjd,EAAK2a,QAIN/gB,EAAOqjB,GAAG,oBAAqB,SAASnmB,GACvC,GAAIy2D,GAAMz2D,EAAE02D,OAED,SAAPD,GAAwB,QAAPA,GAAwB,cAAPA,GACrCvtD,EAAKytD,iBAKP7zD,EAAOqjB,GAAG,cAAe,SAASnmB,GACjC,GAAIy2D,GAAMz2D,EAAE02D,OAED,SAAPD,GAAwB,QAAPA,GAAwB,cAAPA,GACrCL,EAAsBp2D,KAIxB8C,EAAOqjB,GAAG,wBAAyB,WAClCjd,EAAKytD,iBAGN7zD,EAAOqjB,GAAG,iCAAkCiwC,GAC5CtzD,EAAOqjB,GAAG,UAAWiwC,GAErBtzD,EAAOqjB,GAAG,QAAS,SAASnmB,GAC3B,GAAIg2D,GAAUh2D,EAAEg2D,OAIZh2D,GAAEiI,wBAID+tD,GAAW,IAAMA,GAAW,IAAQA,GAAW,IAAMA,GAAW,IAAkB,IAAXA,GAA4B,IAAXA,GAAiBh2D,EAAE87C,WAC/Gsa,IACAtzD,EAAOylC,gBAGO,IAAXytB,GAA4B,GAAXA,GAAiBrwD,EAAI5B,MAAmB,IAAXiyD,GAA4B,IAAXA,KAClElzD,EAAOylC,cAIJguB,GAAyBrtD,EAAKmtD,SAE5BvzD,EAAO8zD,YACXT,EAASxvD,EAAK,IAAMsvC,KAAgBtvC,EAAK,GAAG4e,SAGxCziB,EAAO8zD,WACV9zD,EAAOqI,KAAK,UAAW0rD,MAAOlwD,EAAK,GAAImwD,UAAW,QAIpDh0D,EAAOqI,KAAK,cACZorD,GAAwB,EACxBzzD,EAAOylC,kBAITzlC,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,GAAIg2D,GAAUh2D,EAAEg2D,OAIhB,KAAIh2D,EAAEiI,qBAAN,CAKA,GAAK+tD,GAAW,IAAMA,GAAW,IAAQA,GAAW,IAAMA,GAAW,IAAkB,IAAXA,EAK3E,YAJI9sD,EAAKmtD,QACRD,EAAsBp2D,GAOxB,IAAI+2D,GAAU/2D,EAAE87C,UAAY97C,EAAE+7C,QAAW/7C,EAAEwI,UACtCwtD,EAAU,IAAMA,EAAU,KAAkB,KAAXA,GAA6B,IAAXA,GAAkB9sD,EAAKmtD,QAAWU,IACzF7tD,EAAKytD,eACLztD,EAAKmtD,QAAS,EACdntD,EAAK2a,OAAQ7jB,GACbu2D,GAAwB,MAI1BzzD,EAAOqjB,GAAG,YAAa,SAASnmB,GAC3BkJ,EAAKmtD,QACRD,EAAsBp2D,KAKxB8C,EAAOmsD,YAAY,SAAU,GAAI,QACjCnsD,EAAOmsD,YAAY,sBAAuB,GAAI,QAE9CnsD,EAAOqjB,GAAG,+BAAgC,SAASnmB,GAC7CA,EAAEiI,sBACNnF,EAAOylC,gBAKTr/B,GAECvC,KAAMA,EAQN0vD,QAAQ,EAQRM,aAAc,WACRH,IACJF,EAAiBxzD,EAAOqlC,UAAU2R,YAAY,GAAG,KAYnDj2B,IAAK,SAASgzC,EAAOxwD,GACpB,GAAInL,GAA+B47D,EAA5BhvC,EAAWhlB,EAAOglB,QAKzB,IAHA+uC,EAAQA,MACRA,EAAMtxC,QAAU0wB,IAEZugB,GAAS1zD,EAAOC,QACnB,MAAO,KAIR,IADA+zD,EAAYnwD,EAAKiY,GACb9b,EAAOqI,KAAK,iBAAkB0rD,MAAOA,EAAOC,UAAWA,EAAWpwD,cAAeL,IAAQ4B,qBAC5F,MAAO,KAIR,IAAI6uD,GAAaA,EAAUvxC,SAAWsxC,EAAMtxC,QAC3C,MAAO,KASR,IALI5e,EAAKiY,KACRjY,EAAKiY,GAAO03C,eAAiBA,GAI1BxuC,EAASkvC,yBACRrwD,EAAKxL,OAAS2sB,EAASkvC,wBAAyB,CACnD,IAAK97D,EAAI,EAAGA,EAAIyL,EAAKxL,OAAS,EAAGD,IAChCyL,EAAKzL,GAAKyL,EAAKzL,EAAI,EAGpByL,GAAKxL,SACLyjB,EAAQjY,EAAKxL,OAKf07D,EAAMjd,SAAW92C,EAAOqlC,UAAU2R,YAAY,GAAG,GAG7Cl7B,EAAQjY,EAAKxL,OAAS,IACzBwL,EAAKxL,OAASyjB,EAAQ,GAGvBjY,EAAKrL,KAAKu7D,GACVj4C,EAAQjY,EAAKxL,OAAS,CAEtB,IAAIkG,IAAQw1D,MAAOA,EAAOC,UAAWA,EAAWpwD,cAAeL,EAS/D,OAPAvD,GAAOqI,KAAK,UAAW9J,GAEnBud,EAAQ,IACXu3C,GAAS,GACTrzD,EAAOqI,KAAK,SAAU9J,IAGhBw1D,GASRI,KAAM,WACL,GAAIJ,EAiBJ,OAfI3tD,GAAKmtD,SACRntD,EAAK2a,MACL3a,EAAKmtD,QAAS,GAGXz3C,EAAQ,IACXi4C,EAAQlwD,IAAOiY,GAEf9b,EAAOokD,WAAW2P,EAAMtxC,SAAU6yB,OAAQ,QAC1Ct1C,EAAOqlC,UAAU4R,eAAe8c,EAAMP,gBACtCH,GAAS,GAETrzD,EAAOqI,KAAK,QAAS0rD,MAAOA,KAGtBA,GASRK,KAAM,WACL,GAAIL,EAYJ,OAVIj4C,GAAQjY,EAAKxL,OAAS,IACzB07D,EAAQlwD,IAAOiY,GAEf9b,EAAOokD,WAAW2P,EAAMtxC,SAAU6yB,OAAQ,QAC1Ct1C,EAAOqlC,UAAU4R,eAAe8c,EAAMjd,UACtCuc,GAAS,GAETrzD,EAAOqI,KAAK,QAAS0rD,MAAOA,KAGtBA,GAQR3b,MAAO,WACNv0C,KACAiY,EAAQ,EACR1V,EAAKmtD,QAAS,EACdntD,EAAKvC,KAAOA,EACZ7D,EAAOqI,KAAK,eASbgsD,QAAS,WAER,MAAOv4C,GAAQ,GAAM1V,EAAKmtD,QAAU1vD,EAAK,IAAMsvC,KAAgBtvC,EAAK,GAAG4e,SASxE6xC,QAAS,WACR,MAAOx4C,GAAQjY,EAAKxL,OAAS,IAAM8D,KAAKo3D,QAazCgB,SAAU,SAASt8D,GAClBmO,EAAKytD,cAEL,KACCH,IACAz7D,IACC,QACDy7D,IAGD,MAAOttD,GAAK2a,OAYbyzC,MAAO,SAAUC,EAAWC,GAC3B,GAAIV,GAAWld,CAEX1wC,GAAKmuD,SAASE,KACjB3d,EAAWjzC,EAAKiY,GAAOg7B,SACvBkd,EAAYnwD,EAAKiY,EAAQ,GACzB9b,EAAOokD,WAAW4P,EAAUvxC,SAAU6yB,OAAQ,QAC9Ct1C,EAAOqlC,UAAU4R,eAAe+c,EAAUR,gBAEtCptD,EAAKmuD,SAASG,KACjB7wD,EAAKiY,EAAQ,GAAG03C,eAAiB1c,SA4BvCp+C,EAAO,oBACN,yBACA,yBACA,eACE,SAASy8B,EAAY2M,EAAYj/B,GACnC,GAAIyzB,GAAOzzB,EAAIhC,IAAMgC,EAAIhC,GAAK,EAE9B,OAAO,UAASb,GAKf,QAAS20D,GAAepuD,GAKvB,QAASquD,GAAcvgD,GACtB,MAAOA,IACN0U,EAAIiO,QAAQ3iB,KACX,yBAAyBzS,KAAKyS,EAAK5J,YACnC,qBAAqB7I,KAAKyS,EAAKsN,MAAMw0B,WACL,SAAjCptB,EAAI8T,mBAAmBxoB,GAGzB,QAASwuB,GAAYxuB,GACpB,MAAOA,IAAQ,oBAAoBzS,KAAKyS,EAAK5J,UAI9C,QAASoqD,GAAgB5M,GACxB,GAAI6M,EAEA/rC,GAAIiO,QAAQixB,KACf6M,EAASzvB,EAAUC,SACnB2iB,EAAMvzC,YAAYqU,EAAI9uB,OAAO,OAAQ,KAAM,MAC3CorC,EAAU95B,OAAO08C,GACjBA,EAAM3vC,UAAU4iB,UAAY,GAC5BmK,EAAUge,OAAOyR,IAKnB,QAASC,GAAoC9M,GAC5C,GAAoC7vD,GAAhCic,EAAO4zC,EAAO+M,IAElB,IAAK3gD,EAAL,CAKA,KAAQA,EAAOA,EAAK0C,YAAa,CAChC,GAAIgS,EAAIiO,QAAQ3iB,GACf,MAGoB,IAAjBA,EAAK3M,UAAkB27B,EAAoBhvB,EAAK5J,SAASC,gBAC5DsqD,EAAYx8D,KAAK6b,GAKnB,IADAjc,EAAI48D,EAAY38D,OACTD,KACNic,EAAO2gD,EAAY58D,IACdic,EAAKquB,iBAAoBruB,EAAK0C,YAAc1C,EAAKiE,WAA2C,KAA9BjE,EAAK0C,WAAWC,UAClF+R,EAAI/G,OAAO3N,GAGU,KAAjBA,EAAK5J,UAA4D,OAAxC4J,EAAKwE,WAAaxE,EAAKyC,cACnDiS,EAAI/G,OAAO3N,IAQf,QAAS4gD,GAAoB/7C,GAE5B,QAASg8C,GAA8B7gD,GACtC,KAAOA,GAAM,CACZ,GAAqB,GAAjBA,EAAK3M,UAAmC,GAAjB2M,EAAK3M,UAAiB2M,EAAKxQ,MAAQ,WAAWjC,KAAKyS,EAAKxQ,MAClF,MAAOwQ,EAGRA,GAAOA,EAAKpH,aAPd,GAAI6uB,GAAQznB,EAAM0tB,EAAsBozB,EAAjBC,EAAWl8C,CAWlC,IAAKA,EAAL,CAaA,GANIrW,EAAIhC,IAAMgC,EAAIhC,GAAK,GAAKw0D,GAAeA,EAAYt+C,YAClDs+C,EAAYt+C,YAAcs+C,EAAY/8C,WAA+C,MAAlC+8C,EAAYt+C,WAAW4sB,SAC7E5a,EAAI/G,OAAOqzC,EAAYt+C,YAIrB,eAAenV,KAAKsX,EAAKzO,UAAW,CACvC,GAAIsM,GAAam+C,EAA8Bh8C,EAAKnC,WAEhDA,IAAc,eAAenV,KAAKmV,EAAWtM,WAChDyO,EAAKsG,aAAauJ,EAAIrkB,IAAI8oB,eAAe,KAAWtU,EAAKnC,YAa3D,GATAgrB,EAAMhZ,EAAIkT,YAKLp5B,EAAIhC,IACRqY,EAAKypB,YAGFzpB,EAAKwpB,gBAAiB,CAGzB,IAFA5G,EAAS,GAAI3G,GAAWjc,EAAMA,GAEtB7E,EAAOynB,EAAOn0B,WAAY,CACjC,GAAqB,GAAjB0M,EAAK3M,SAAe,CACvBq6B,EAAI/Y,SAAS3U,EAAM,GACnB0tB,EAAI5Y,OAAO9U,EAAM,EACjB,OAGD,GAAI62B,EAAkC72B,EAAK5J,SAASC,eAAgB,CACnEq3B,EAAI1Y,eAAehV,GACnB0tB,EAAIxY,aAAalV,EACjB,OAGD+gD,EAAW/gD,EACXA,EAAOynB,EAAO9X,OAGV3P,IACJ0tB,EAAI/Y,SAASosC,EAAU,GACvBrzB,EAAI5Y,OAAOisC,EAAU,QAGD,MAAjBl8C,EAAKzO,SACJyO,EAAKjM,aAAe8b,EAAIiO,QAAQ9d,EAAKjM,gBAEnCxK,GAAgBA,EAAe,KACnC0yD,EAAUpsC,EAAI9uB,OAAO,MACrBif,EAAKlR,WAAWwX,aAAa21C,EAASj8C,IAGvC6oB,EAAI1Y,eAAenQ,GACnB6oB,EAAIxY,aAAarQ,KAEjB6oB,EAAIzY,cAAcpQ,GAClB6oB,EAAIvY,YAAYtQ,KAGjB6oB,EAAI/Y,SAAS9P,EAAM,GACnB6oB,EAAI5Y,OAAOjQ,EAAM,GAInBmsB,GAAUge,OAAOthB,GAGjBhZ,EAAI/G,OAAOmzC,GACX9vB,EAAUohB,eAAevtC,IAG1B,QAASo8C,GAAoBjhD,GAC5B,GAAIkhD,GAAsBvwC,EAASgtB,iBAE/BujB,IAAuBA,EAAoB7qD,gBAAkB2J,EAAKsvB,QAAQj5B,eAC7Eqe,EAAImQ,WAAW7kB,EAAM2Q,EAASmsB,yBAIhC,QAASqkB,GAAW9zC,GAEnBA,EAAIxM,UAAaohB,EAAmC,GAA5B,0BAKzB,QAASm/B,GAAe1yD,GACvB,GAAsBklD,GAAOyN,EAAYrR,EAArChwC,EAAO3N,EAAyCivD,EAAqB1wC,EAAOknB,uBAYhF,IAVIppC,GAA2B,SAAnB6yD,GACX3N,EAAQl/B,EAAI9uB,OAAO8I,GAAQ8yD,GAC3BP,EAAoBrN,IAEpBA,EAAQoN,EAAY91C,WAAU,GAG/B8kC,EAAY4D,EAGRjjC,EAAS8wC,eAAgB,EAC5B,EACC,IAAIH,EAAmBthD,EAAK5J,UAAW,CAEtC,GAAe,cAAX4J,EAAK1b,GACR,QAGD+8D,GAAarhD,EAAKkL,WAAU,GAC5BwJ,EAAIuO,UAAUo+B,EAAY,KAAM,IAE5BzN,EAAMvlB,iBACTgzB,EAAWhhD,YAAYuzC,EAAMlxC,YAC7BkxC,EAAMvzC,YAAYghD,KAElBrR,EAAYqR,EACZzN,EAAMvzC,YAAYghD,WAGXrhD,EAAOA,EAAKrM,aAAeqM,GAAQ0hD,EAQ9C,OAJKz/B,KACJ+tB,EAAUnvC,UAAY,2BAGhB+yC,EAIR,QAAS+N,GAA2B59C,GACnC,GAAI0jB,GAAQznB,EAAMtR,CAGlB,IAA0B,GAAtB2D,EAAUgB,WAAkB0Q,EAAQuL,EAAS,EAAIA,EAASjd,EAAUsQ,UAAU3e,QACjF,OAAO,CAIR,IAAIqO,EAAUsB,YAAcqtD,GAAeY,IAA+B79C,EACzE,OAAO,CAIR,IAAIA,GAA+B,GAAtB1R,EAAUgB,UAAiBhB,GAAa2uD,EAAYt+C,WAChE,OAAO,CAIR,IAA2B,UAAvBrQ,EAAU+D,UAAyB/D,EAAUmnB,iBAAyD,SAAtCnnB,EAAUmnB,gBAAgBpjB,SAC7F,MAAQwrD,KAA+B79C,IAAY69C,GAA8B79C,CAelF,KAXA0jB,EAAS,GAAI3G,GAAWzuB,EAAW2uD,GAGT,GAAtB3uD,EAAUgB,WACT0Q,GAAoB,IAAXuL,EACZmY,EAAO7X,OACI7L,GAASuL,GAAUjd,EAAUsQ,UAAU3e,QAClDyjC,EAAO9X,QAID3P,EAAOynB,EAAOn0B,WAAY,CACjC,GAAsB,IAAlB0M,EAAK3M,UAER,IAAK2M,EAAKzJ,aAAa,oBAEtB7H,EAAOsR,EAAK5J,SAASC,cACjB24B,EAAoBtgC,IAAkB,OAATA,GAChC,OAAO,MAGH,IAAsB,IAAlBsR,EAAK3M,WAAmB,eAAe9F,KAAKyS,EAAK2C,WAC3D,OAAO,CAGJoB,GACH0jB,EAAO7X,OAEP6X,EAAO9X,OAIT,OAAO,EAIR,QAASkyC,GAAkCxvD,EAAWid,GACrD,GAAIwyC,GAAUd,EAAa/sC,EAAWjU,EAAM2P,EAAMgtB,EAAevP,EAAYo0B,GAAgB,GAI7F,IADAR,EAActsC,EAAIwP,UAAU7xB,EAAWqiB,EAAIiO,UACtCq+B,IAAgBT,EAAcS,GAAc,CAShD,GARAA,EAAcA,GAAeU,EAG5B/kB,EADGqkB,GAAer1D,EAAO+kC,WAAalC,EAAYwyB,GAClCA,EAAY5qD,SAASC,cAErB2qD,EAAYrtD,WAAWyC,SAASC,eAG5C2qD,EAAY3yB,gBAMhB,MALAyzB,GAAWptC,EAAI9uB,OAAOwnC,GACtB6zB,EAAoBa,GACpBd,EAAY3gD,YAAYyhD,GACxBp0B,EAAI/Y,SAASmtC,EAAU,GACvBp0B,EAAI5Y,OAAOgtC,EAAU,GACdA,CAKR,KADA9hD,EAAO3N,EACA2N,EAAKrM,YAAcqtD,GACzBhhD,EAAOA,EAAKrM,UAIb,MAAOqM,IAAS0U,EAAIiO,QAAQ3iB,IAC3BiU,EAAYjU,EACZA,EAAOA,EAAKwZ,eAGb,IAAIvF,GAAarD,EAAOwnB,aAAauE,EAAevP,EAAU/2B,eAAgB,CAO7E,IANAyrD,EAAWptC,EAAI9uB,OAAOwnC,GACtB6zB,EAAoBa,GACpB7tC,EAAUtgB,WAAWwX,aAAa22C,EAAU7tC,GAG5CjU,EAAOiU,EACAjU,IAAS0U,EAAIiO,QAAQ3iB,IAC3B2P,EAAO3P,EAAKpH,YACZkpD,EAASzhD,YAAYL,GACrBA,EAAO2P,CAIR+d,GAAI/Y,SAAStiB,EAAWid,GACxBoe,EAAI5Y,OAAOziB,EAAWid,IAIxB,MAAOjd,GAIR,QAAS0vD,KACR,QAASC,GAAgBnoD,GAIxB,IAHA,GAAImG,GAAOiiD,EAAepoD,EAAQ,aAAe,aAG1CmG,GACe,GAAjBA,EAAK3M,UAIT2M,EAAOA,EAAKnG,EAAQ,cAAgB,kBAGrC,OAAOmG,KAASghD,EAGjB,QAASkB,KACR,GAAIC,GAAuBF,EAAetuD,UAE1C,OAAI,eAAepG,KAAK40D,EAAqB/rD,UACrC+rD,EAGDF,EAGR,GAAIA,GAAkBt2D,EAAO+kC,UAA7B,CAKA,GAAI0xB,GAA2BH,EAAetuD,WAAWyC,QACrD,gBAAe7I,KAAK60D,KACvBZ,EAAe,MAGhBM,EAAWN,EAAeJ,EAAeI,GAAgB9sC,EAAI9uB,OAAO,MAEhEo8D,GAAgB,IAASA,IACI,MAA5BI,EAEH1tC,EAAI0C,YAAY0qC,EAAUI,KAG1BxtC,EAAIle,QAAQsrD,EAAUG,GAEbD,GAAgB,GACM,MAA5BI,GAEH1tC,EAAI0C,YAAY0qC,EAAUI,KAC1BJ,EAASzhD,YAAYqU,EAAIrkB,IAAI8oB,eAAe,MAC5C2oC,EAASzhD,YAAY4hD,IAGrBA,EAAetuD,WAAWwX,aAAa22C,EAAUG,GAExCD,KAEVttC,EAAI0C,YAAY0qC,EAAUI,KAC1B1B,EAAgBsB,KAIhBG,EAAiBC,IACjBve,EAASjW,EAAInW,aACbosB,EAAO1uB,cAAc+rC,GACrBrd,EAAOxuB,YAAY8sC,GACnBtS,EAAWhM,EAAO7sB,kBAEE,MAAhB0qC,GAAwD,MAAhC7R,EAASjtC,WAAWtM,UAC/C0rD,EAAWnS,EAASjtC,WACpBgS,EAAI0C,YAAYu4B,EAAUsS,KAE1BvtC,EAAI0C,YAAYu4B,EAAUsS,GAC1BvtC,EAAI0C,YAAY0qC,EAAUG,KAI5BvtC,EAAI/G,OAAOqzC,GACXJ,EAAoBkB,GACpBO,EAAY31C,OAIb,QAAS41C,KACR32D,EAAOo9C,YAAY,mBAAmB,EAAO72C,GAI9C,QAASqwD,GAAsBviD,GAC9B,EACuB,KAAlBA,EAAK3M,WACR2M,EAAK2C,UAAY3C,EAAK2C,UAAUnM,QAAQ,WAAY,KAGrDwJ,EAAOA,EAAK0C,iBACJ1C,GAGV,QAASwiD,GAAgBxiD,GACxB,GAA0BG,GAAQuhD,EAA9B78C,EAAO6P,EAAIgO,SAIf,KADAviB,EAASH,EACFG,IAAW0E,GAA2C,UAAnC6P,EAAI8T,mBAAmBroB,IACT,SAAnCuU,EAAI8T,mBAAmBroB,KAC1BuhD,EAAevhD,GAGhBA,EAASA,EAAOxM,UAGjB,OAAOwM,KAAW0E,EAAO68C,EAAe78C,EAKzC,QAAS49C,GAAqB7O,GAC7B,GAAI3vC,EAGCge,KACJ2xB,EAAMtlB,YAGNrqB,EAAY2vC,EAAM3vC,UACbA,IAAc,mBAAmB1W,KAAKmnB,EAAIqP,SAAS9f,EAAW,SAAS,KAC3EyQ,EAAIhI,IAAIknC,EAAO,OAKlB,QAAS8O,KAGPZ,EADG,wBAAwBv0D,KAAKg0D,IAA0C,UAAtBoB,EACzCvB,EAAeI,GAEfJ,IAIRzwC,EAASiyC,8BAAgCrC,EAAc0B,IAAmBvtC,EAAI8S,QAAQw5B,GAEzFc,EAAWptC,EAAI9vB,MAAMq9D,EAAgBjB,GAErCtsC,EAAI0C,YAAY0qC,EAAUd,GAG3BJ,EAAoBkB,GAnerB,GAAIp0B,GAAKiW,EAAQ+d,EAAcrvD,EAAWid,EAAQ0xC,EAAa5yD,EAAcs2C,EAC5Eod,EAAUnS,EAAUsS,EAAgBV,EAAiBoB,EAAoBnB,EAAcI,CAwexF,IAHAl0B,EAAMsD,EAAUC,QAAO,IAGnB/+B,EAAIpB,qBAAR,CAKA,IAAK48B,EAAIhY,UAER,WADA/pB,GAAOo9C,YAAY,SA6BpB,IAxBA,GAAItb,GAAW/Y,GAAK4Z,UAAUZ,GAC9Br7B,EAAYq7B,EAAIvX,eAChB7G,EAASoe,EAAIrX,YACbmrC,GAAgB7wC,EAASkyC,iBAAmB,IAAM,KAAOlyC,EAASgtB,kBAClE6jB,EAAeA,EAAeA,EAAar0C,cAAgB,GAC3D/e,EAAesmB,EAAIrkB,IAAIjC,aACvBs2C,EAAWxyC,EAAIwyC,SAGW,GAAtBryC,EAAUgB,UAAiBhB,EAAUg8B,kBACxCuzB,EAA6BtyC,EAASjd,EAAUyN,WAAW9b,OAAS,EAEpEqO,EAAYA,EAAUyN,WAAWrY,KAAKhB,IAAI6oB,EAAQjd,EAAUyN,WAAW9b,OAAS,KAAOqO,EAEtFid,EADGsyC,GAAoD,GAAtBvvD,EAAUgB,SAClChB,EAAUsQ,UAAU3e,OAEpB,GAKX09D,EAAec,EAAgBnwD,GAG/B,CAOA,GAHAgwD,EAAY7C,gBAGP9qC,EAAIiO,QAAQ++B,IAAiBA,GAAgBhtC,EAAIgO,UAKrD,YAJK8+B,IAAgB9c,GACpB4d,IA4BF,KAnBKd,IAAiB9c,IAAe8c,GAAgB9c,KACpDryC,EAAYwvD,EAAkCxvD,EAAWid,IAI1D0xC,EAActsC,EAAIwP,UAAU7xB,EAAWqiB,EAAIiO,SAC3Cs/B,EAAiBjB,EAActsC,EAAIwP,UAAU88B,EAAYrtD,WAAY+gB,EAAIiO,SAAW,KAGpF4+B,EAAkBP,EAAcA,EAAY5qD,SAAS+W,cAAgB,GACrEw1C,EAAqBV,EAAiBA,EAAe7rD,SAAS+W,cAAgB,GAGpD,MAAtBw1C,GAA+BzwD,EAAIyyC,UACtCqc,EAAciB,EACdV,EAAkBoB,GAIf,eAAep1D,KAAKg0D,GAAkB,CACzC,IAAKC,GAAgB9c,EAEpB,WADA4d,IAKD,IAAI5tC,EAAI8S,QAAQw5B,GAEf,WADAe,KAMF,GAAuB,OAAnBR,GAA4B5wC,EAASmyC,aAAc,GACtD,IAAKpe,EAEJ,WADA4d,SAKD,KAAMd,IAAiB9c,GAA+B,MAAnB6c,GAA6BC,GAAgB9c,EAE/E,WADA4d,IAMEd,IAAgBR,IAAgBr1D,EAAO+kC,YAK3C8wB,EAAeA,GAAgB,IAG3BG,IACHe,IACUf,GAA2B,IAErCG,EAAWd,EAAYrtD,WAAWwX,aAAai2C,IAAkBJ,GACjER,EAAgBsB,GAChBlB,EAAoBI,KAGpBrd,EAASjW,EAAInW,aACbosB,EAAOxuB,YAAY6rC,GACnBrR,EAAWhM,EAAO7sB,kBAClByrC,EAAsB5S,GACtBmS,EAAWnS,EAASjtC,WACpBgS,EAAI0C,YAAYu4B,EAAUqR,GAC1BN,EAAoCoB,GACpCW,EAAqBzB,GAEjBtsC,EAAI8S,QAAQw5B,IACfG,EAAWH,GAGZc,EAASxzB,YAGL5Z,EAAI8S,QAAQs6B,IACfptC,EAAI/G,OAAOm0C,GACXY,KAEA9B,EAAoBkB,IAItBptC,EAAIuO,UAAU6+B,EAAU,KAAM,IAG9Bn2D,EAAOqI,KAAK,YAAa8tD,SAAUA,IAEnCO,EAAY31C,SAhoBb,GAAIgI,GAAM/oB,EAAO+oB,IAAKsc,EAAYrlC,EAAOqlC,UAAWrgB,EAAWhlB,EAAOglB,SAClE0xC,EAAc12D,EAAO02D,YAAazxC,EAASjlB,EAAOilB,OAAQoe,EAAsBpe,EAAO+W,sBAC1FkP,EAAoCjmB,EAAOqnB,mCAioB5CtsC,GAAOqjB,GAAG,UAAW,SAAS9c,GACV,IAAfA,EAAI2sD,SACHyB,EAAepuD,MAAS,GAC3BA,EAAIrB,sBAyBTxM,EAAO,yBAA2B,WACjC,MAAO,UAASsH,GAIf,QAAS4wC,KACR,GAA8D7O,GAC1DvX,EAAgBE,EAAaE,EAAcE,EAAW+lB,EACtDjB,EAA8BwnB,EAASC,EACvCrf,EAAQsf,EAAc3I,EAHtBt6C,EAAOgxB,EAAUE,WAAYhd,EAAWvoB,EAAO+kC,UAErCphB,WAKd,IAFAgrC,EAAkB3pC,EAASgtB,kBAEtB39B,GAA0B,IAAlBA,EAAK3M,UAAmBinD,EAArC,CAKA,KAAOt6C,GAAQA,GAAQkU,GAAU,CAChC,GAAI0oB,EAAc58B,EAAK5J,UACtB,MAGD4J,GAAOA,EAAKrM,WAKb,GADA+5B,EAAMsD,EAAUC,SACZvD,EAAI/Y,SAAU,CACjBwB,EAAiBuX,EAAIvX,eACrBE,EAAcqX,EAAIrX,YAClBE,EAAemX,EAAInX,aACnBE,EAAYiX,EAAIjX,SAEhB,KACCusC,EAAmBr3D,EAAOklC,SAAS9rB,gBAAkBmP,EACpD,MAAO3qB,SAKLmkC,GAAIlmB,OACPxH,EAAO0tB,EAAIlmB,KAAK,GAChBkmB,EAAM/hC,EAAOklC,SAASplC,KAAK4jC,kBAC3B3B,EAAI6B,kBAAkBvvB,IAGvBgjD,EAAmBt1B,EAAIqU,gBAAgB3xC,gBAAkBzE,EAAOklC,SAChE8S,EAASjW,EAAIoC,YACb6T,EAAOvuB,UAAS,GAChBiB,EAAcstB,EAAOzB,KAAK,YAAa5yB,MAElCq0B,EAAOjuB,YACXiuB,EAASjW,EAAIoC,YACb6T,EAAOvuB,UAAS,GAChBqB,EAAaktB,EAAOzB,KAAK,YAAa5yB,MAAgB+G,EAOxD,KAFArW,EAAOkU,EAASxR,WAChBugD,EAAe/uC,EAAS9d,SAASC,cAC1B2J,GAEN,IAAwB,IAAlBA,EAAK3M,UAAoC,GAAjB2M,EAAK3M,WAAkBupC,EAAc58B,EAAK5J,YACvEwa,EAAOwnB,aAAa6qB,EAAc3I,EAAgBjkD,eAAgB,CAElE,GAAsB,IAAlB2J,EAAK3M,UAA4C,IAA1B2M,EAAK2C,UAAU3e,OAAc,CACvDu3C,EAAWv7B,EACXA,EAAOA,EAAKpH,YACZ8b,EAAI/G,OAAO4tB,EACX,UAGIiB,IACJA,EAAgB9nB,EAAI9uB,OAAO00D,EAAiB3uD,EAAOglB,SAASmsB,yBAC5D98B,EAAKrM,WAAWwX,aAAaqxB,EAAex8B,GAC5C+iD,GAAU,GAGXxnB,EAAWv7B,EACXA,EAAOA,EAAKpH,YACZ4jC,EAAcn8B,YAAYk7B,OAE1BiB,GAAgB,KAChBx8B,EAAOA,EAAKpH,WAId,IAAImqD,GAAWC,EAAkB,CAChC,GAAIt1B,EAAI/Y,SACP+Y,EAAI/Y,SAASwB,EAAgBE,GAC7BqX,EAAI5Y,OAAOyB,EAAcE,GACzBua,EAAUge,OAAOthB,OAGjB,KACCA,EAAM/hC,EAAOklC,SAASplC,KAAK4jC,kBAC3B3B,EAAI6B,kBAAkBrb,GACtBwZ,EAAItY,UAAS,GACbsY,EAAI2V,UAAU,YAAahtB,GAEvBI,EAAY,GACfiX,EAAIw1B,QAAQ,YAAazsC,GAG1BiX,EAAIx2B,SACH,MAAO3N,IAKVoC,EAAOylC,gBA9GT,GAAIzgB,GAAWhlB,EAAOglB,SAAU+D,EAAM/oB,EAAO+oB,IAAKsc,EAAYrlC,EAAOqlC,UACjEpgB,EAASjlB,EAAOilB,OAAQgsB,EAAgBhsB,EAAO6R,kBAkH/C9R,GAASgtB,mBACZhyC,EAAOqjB,GAAG,aAAcutB,MAuB3Bl4C,EAAO,4BACN,mBACA,yBACA,uBACA,8BACA,+BACA,gCACE,SAASknD,EAAKzqB,EAAY4L,EAAUigB,EAAepf,EAAgBie,GASrE,QAAS2X,GAAWC,GACnB,MAAOA,GAAY,EAGpB,QAASC,GAAYD,GACpB,MAAOA,GAAY,EAGpB,QAASE,GAAStjD,EAAMojD,EAAWG,EAAarvC,EAAUG,GACzD,GAAIoT,GAAS,GAAI3G,GAAW9gB,EAAMkU,EAElC,IAAImvC,EAAYD,GAAY,CAC3B,GAAI72B,EAAuBvsB,KAC1BA,EAAOynB,EAAO7X,MAAK,GACf2zC,EAAYvjD,IACf,MAAOA,EAIT,MAAQA,EAAOynB,EAAO7X,KAAKyE,IAC1B,GAAIkvC,EAAYvjD,GACf,MAAOA,GAKV,GAAImjD,EAAWC,GAAY,CAC1B,GAAI72B,EAAuBvsB,KAC1BA,EAAOynB,EAAO9X,MAAK,GACf4zC,EAAYvjD,IACf,MAAOA,EAIT,MAAQA,EAAOynB,EAAO9X,KAAK0E,IAC1B,GAAIkvC,EAAYvjD,GACf,MAAOA,GAKV,MAAO,MAGR,QAASwjD,GAAexjD,EAAMkU,GAC7B,IAAKlU,EAAOA,EAAKrM,WAAYqM,GAAQA,GAAQkU,EAAUlU,EAAOA,EAAKrM,WAClE,GAAI24B,EAAsBtsB,GACzB,MAAOA,EAIT,OAAOkU,GAGR,QAASuvC,GAAezjD,EAAMkU,GAC7B,KAAOlU,GAAQA,GAAQkU,GAAU,CAChC,GAAIwvC,EAAY1jD,GACf,MAAOA,EAGRA,GAAOA,EAAKrM,WAGb,MAAO,MAGR,QAASgwD,GAAcC,EAAgBC,EAAgB3vC,GACtD,MAAOuvC,GAAeG,EAAevxD,YAAa6hB,IAAauvC,EAAeI,EAAexxD,YAAa6hB,GAG3G,QAAS4vC,GAAoBF,EAAgBC,EAAgB3vC,GAC5D,MAAOsvC,GAAeI,EAAevxD,YAAa6hB,IAAasvC,EAAeK,EAAexxD,YAAa6hB,GAG3G,QAAS6vC,GAA6BC,EAAgBjY,GACrD,GAAI15C,GAAWid,CAEf,OAAKy8B,IAIL15C,EAAY05C,EAAc15C,YAC1Bid,EAASy8B,EAAcz8B,SAElBqc,EAAUt5B,GAIRA,EAAUyN,WAAWwP,EAAS00C,GAH7B,MAPA,KAaT,QAASC,GAAYl2C,EAAQ/N,GAC5B,GAAI9R,GAAQ8R,EAAK5P,cAAcy3B,aAU/B,OARI9Z,IACH7f,EAAM8mB,eAAehV,GACrB9R,EAAMgnB,aAAalV,KAEnB9R,EAAM+mB,cAAcjV,GACpB9R,EAAMinB,YAAYnV,IAGZ9R,EAGR,QAASg2D,GAAmBhwC,EAAU4+B,EAAOC,GAC5C,MAAO0Q,GAAe3Q,EAAO5+B,IAAauvC,EAAe1Q,EAAO7+B,GAGjE,QAASiwC,GAAK98D,EAAM6sB,EAAUlU,GAC7B,GAAIwL,GAASC,CAQb,KALCA,EADGpkB,EACW,kBAEA,cAGR2Y,GAAQA,GAAQkU,GAAU,CAOhC,GANA1I,EAAUxL,EAAKyL,GAEXqhB,EAAiBthB,KACpBA,EAAUA,EAAQC,IAGf8gB,EAAuB/gB,GAAU,CACpC,GAAI04C,EAAmBhwC,EAAU1I,EAASxL,GACzC,MAAOwL,EAGR,OAGD,GAAIy+B,EAAiBz+B,GACpB,KAGDxL,GAAOA,EAAKrM,WAGb,MAAO,MAMR,QAASywD,GAAehB,EAAWlvC,EAAUhmB,GAC5C,GAAI8R,GAAM3N,EAAWid,EAAQ1K,EACzBy/C,EAAWta,EAAMoa,GAAM,EAAMjwC,GAC7BowC,EAAYva,EAAMoa,GAAM,EAAOjwC,EAKnC,IAHA7hB,EAAYnE,EAAMioB,eAClB7G,EAASphB,EAAMmoB,YAEXkX,EAAeX,sBAAsBv6B,GAAY,CAOpD,GANKs5B,EAAUt5B,KACdA,EAAYA,EAAUsB,YAGvBiR,EAAWvS,EAAUkE,aAAa,kBAElB,UAAZqO,IACH5E,EAAO3N,EAAUuG,YACb2zB,EAAuBvsB,IAC1B,MAAO+N,GAAO/N,EAIhB,IAAgB,SAAZ4E,IACH5E,EAAO3N,EAAUmnB,gBACb+S,EAAuBvsB,IAC1B,MAAOgO,GAAMhO,GAKhB,IAAK9R,EAAMwnB,UACV,MAAOxnB,EAGR,IAAIw+B,EAASP,OAAO95B,GAAY,CAC/B,GAAIy6B,EAAiBz6B,GAAY,CAChC,GAAkB,IAAd+wD,EAAiB,CAEpB,GADApjD,EAAOskD,EAAUjyD,GAEhB,MAAO0b,GAAO/N,EAIf,IADAA,EAAOqkD,EAAShyD,GAEf,MAAO2b,GAAMhO,GAIf,GAAIojD,OAAkB,CAErB,GADApjD,EAAOqkD,EAAShyD,GAEf,MAAO2b,GAAMhO,EAId,IADAA,EAAOskD,EAAUjyD,GAEhB,MAAO0b,GAAO/N,GAIhB,MAAO9R,GAGR,GAAIq/B,EAAeN,uBAAuB56B,IAAcid,GAAUjd,EAAU7C,KAAKxL,OAAS,EACzF,MAAkB,KAAdo/D,IACHpjD,EAAOskD,EAAUjyD,IAET0b,EAAO/N,GAIT9R,CAGR,IAAIq/B,EAAeL,yBAAyB76B,IAAcid,GAAU,EACnE,MAAI8zC,UACHpjD,EAAOqkD,EAAShyD,IAER2b,EAAMhO,GAIR9R,CAGR,IAAIohB,IAAWjd,EAAU7C,KAAKxL,OAE7B,MADAgc,GAAOskD,EAAUjyD,GACb2N,EACI+N,EAAO/N,GAGR9R,CAGR,IAAe,IAAXohB,EAEH,MADAtP,GAAOqkD,EAAShyD,GACZ2N,EACIgO,EAAMhO,GAGP9R,EAIT,MAAOA,GAGR,QAASq2D,GAA6BP,EAAgBjY,GACrD,MAAOxf,GAAuBw3B,EAA6BC,EAAgBjY,IAtQ5E,GAAIzf,GAAwBI,EAASJ,sBACpCC,EAAyBG,EAASH,uBAClCm3B,EAAch3B,EAASjB,iBAAiB,UAAW,wCACnDqB,EAAmBS,EAAeT,iBAClCid,EAAQwB,EAAIxB,MACZpe,EAAYe,EAASf,UACrBse,EAAmBuB,EAAevB,iBAiJ/Bl8B,EAASg8B,EAAMka,GAAa,GAC5Bj2C,EAAQ+7B,EAAMka,GAAa,EAiH/B,QACCd,WAAYA,EACZE,YAAaA,EACbC,SAAUA,EACVE,eAAgBA,EAChBC,eAAgBA,EAChBE,cAAeA,EACfG,oBAAqBA,EACrBU,6BAA8Bza,EAAMwa,EAA8B,GAClEE,4BAA6B1a,EAAMwa,MACnCH,eAAgBA,KA8BlB//D,EAAO,6BACN,uBACA,+BACA,8BACA,2BACA,mBACA,oBACE,SAASqoC,EAAU8e,EAAgBmB,EAAe+X,EAAYx8C,EAAKqjC,GAWrE,QAASpnB,GAAWnkB,EAAMkU,GAGzB,IAFA,GAAIxE,MAEG1P,GAAQA,GAAQkU,GACtBxE,EAAQvrB,KAAK6b,GACbA,EAAOA,EAAKrM,UAGb,OAAO+b,GAGR,QAASi1C,GAAYtyD,EAAWid,GAC/B,MAAIjd,GAAUg8B,iBAAmB/e,EAASjd,EAAUyN,WAAW9b,OACvDqO,EAAUyN,WAAWwP,GAGtB,KAGR,QAASs1C,GAA0BxB,EAAWpjD,GAC7C,GAAImjD,EAAWC,GAAY,CAC1B,GAAInZ,EAAiBjqC,EAAKwZ,mBAAqB2S,EAAOnsB,EAAKwZ,iBAC1D,MAAOmzB,GAAc5+B,OAAO/N,EAG7B,IAAImsB,EAAOnsB,GACV,MAAO2sC,GAAc3sC,EAAM,GAI7B,GAAIqjD,EAAYD,GAAY,CAC3B,GAAInZ,EAAiBjqC,EAAKpH,eAAiBuzB,EAAOnsB,EAAKpH,aACtD,MAAO+zC,GAAc3+B,MAAMhO,EAG5B,IAAImsB,EAAOnsB,GACV,MAAO2sC,GAAc3sC,EAAMA,EAAKxQ,KAAKxL,QAIvC,MAAIq/D,GAAYD,GACX/2B,EAAKrsB,GACD2sC,EAAc5+B,OAAO/N,GAGtB2sC,EAAc3+B,MAAMhO,GAGrB2sC,EAAc5+B,OAAO/N,GAI7B,QAAS6kD,GAAgB7kD,EAAMkU,GAC9B,GAAIvE,EAEJ,SAAK+c,EAASL,KAAKrsB,KAInB2P,EAAOm1C,EAAkB,EAAGnY,EAAc3+B,MAAMhO,GAAOkU,KAClDvE,IAIG+0C,EAAWf,cAAchX,EAAc5+B,OAAO/N,GAAO2sC,EAAc5+B,OAAO4B,GAAOuE,IAG1F,QAAS4wC,GAAkB1B,EAAW2B,EAAoB7wC,GACzD,GAAI7hB,GAAWid,EAAQtP,EAAM47B,EAAUopB,EACtCC,EAA6BlZ,CAE9B,KAAKpgB,EAAUzX,KAAc6wC,EAC5B,MAAO,KAOR,IAJAhZ,EAAgBgZ,EAChB1yD,EAAY05C,EAAc15C,YAC1Bid,EAASy8B,EAAcz8B,SAEnB6c,EAAO95B,GAAY,CACtB,GAAIgxD,EAAYD,IAAc9zC,EAAS,EACtC,MAAOq9B,GAAct6C,IAAaid,EAGnC,IAAI6zC,EAAWC,IAAc9zC,EAASjd,EAAUrO,OAC/C,MAAO2oD,GAAct6C,IAAaid,EAGnCtP,GAAO3N,MACD,CACN,GAAIgxD,EAAYD,IAAc9zC,EAAS,IACtCssB,EAAW+oB,EAAYtyD,EAAWid,EAAS,GACvC26B,EAAiBrO,IACpB,OAAK2O,EAAS3O,KACbopB,EAAYN,EAAWpB,SAAS1nB,EAAUwnB,EAAW5Y,EAA0B5O,IAE1EzP,EAAO64B,GACHrY,EAAcqY,EAAWA,EAAUx1D,KAAKxL,QAGzC2oD,EAAc3+B,MAAMg3C,GAIzB74B,EAAOyP,GACH+Q,EAAc/Q,EAAUA,EAASpsC,KAAKxL,QAGvC2oD,EAAc5+B,OAAO6tB,EAI9B,IAAIunB,EAAWC,IAAc9zC,EAASjd,EAAUyN,WAAW9b,SAC1D43C,EAAW+oB,EAAYtyD,EAAWid,GAC9B26B,EAAiBrO,IACpB,MAAIipB,GAAgBjpB,EAAU1nB,GACtB4wC,EAAkB1B,EAAWzW,EAAc3+B,MAAM4tB,GAAW1nB,IAG/Dq2B,EAAS3O,KACbopB,EAAYN,EAAWpB,SAAS1nB,EAAUwnB,EAAW5Y,EAA0B5O,IAE1EzP,EAAO64B,GACHrY,EAAcqY,EAAW,GAG1BrY,EAAc5+B,OAAOi3C,GAI1B74B,EAAOyP,GACH+Q,EAAc/Q,EAAU,GAGzB+Q,EAAc3+B,MAAM4tB,EAI7B57B,GAAO+rC,EAAczb,UAGtB,OAAK6yB,EAAWC,IAAcrX,EAAcS,WAAe6W,EAAYD,IAAcrX,EAAca,eAClG5sC,EAAO0kD,EAAWpB,SAAStjD,EAAMojD,EAAW7X,EAAI7B,UAAS,GAAOx1B,GAAU,GACtEs2B,EAAyBxqC,IACrB4kD,EAA0BxB,EAAWpjD,IAI9C47B,EAAW8oB,EAAWpB,SAAStjD,EAAMojD,EAAW5Y,EAA0Bt2B,GAE1E+wC,EAA8B/8C,EAAIxE,KAAKwE,EAAIxN,OAAOypB,EAAW9xB,EAAW6hB,GAAWqY,KAC/E04B,GAAiCrpB,GAAaqpB,EAA4BvxD,SAASkoC,GAUnFA,EACIgpB,EAA0BxB,EAAWxnB,GAGtC,KAZLmQ,EADGoX,EAAWC,GACEzW,EAAc3+B,MAAMi3C,GAEpBtY,EAAc5+B,OAAOk3C,IArKxC,GAAI14B,GAAyBG,EAASH,uBACrCJ,EAASO,EAASP,OAClBR,EAAYe,EAASf,UACrBU,EAAOK,EAASL,KAChB82B,EAAauB,EAAWvB,WACxBE,EAAcqB,EAAWrB,YACzBpZ,EAAmBuB,EAAevB,iBAClCM,EAAWiB,EAAejB,SAC1BC,EAA2BgB,EAAehB,wBA0K3C,OAAO,UAASt2B,GACf,OAUCvE,KAAM,SAASo8B,GACd,MAAO+Y,GAAkB,EAAG/Y,EAAe73B,IAY5CtE,KAAM,SAASm8B,GACd,MAAO+Y,MAAsB/Y,EAAe73B,QAwBhD7vB,EAAO,sBACN,qBACA,4BACA,+BACE,SAASwlB,EAAOq7C,EAAavY,GAC/B,GAAIwY,GAAiB,SAASxV,GAC7B,GAAIjtC,GAAaitC,EAASjtC,WACtBuB,EAAY0rC,EAAS1rC,SAYzB,OATIvB,IAAkC,SAApBA,EAAWhU,OAC5BgU,EAAaA,EAAWiN,MAIrB1L,GAAsC,eAAzBA,EAAUjC,KAAK,QAC/BiC,EAAYA,EAAU2L,SAGlBlN,GAAcA,IAAeuB,KAIP,OAApBvB,EAAWhU,MAAqC,OAApBgU,EAAWhU,OAG3C02D,EAAqB,SAAUC,GAClC,GAAI3iD,GAAa2iD,EAAY3iD,WACzBuB,EAAYohD,EAAYphD,SAW5B,OARIvB,IAAsC,SAAxBA,EAAWtM,UAC5BsM,EAAW/O,WAAWoE,YAAY2K,GAG/BuB,GAA8B,eAAjBA,EAAU3f,IAC1B2f,EAAUtQ,WAAWoE,YAAYkM,GAG3BohD,GAGJC,EAAgB,SAAS5wC,EAAK06B,EAAYO,GAC7C,GAAIzlC,GAAOklC,EAAWz7B,UAAUg8B,GAC5B0V,EAAc3wC,EAAIzK,eAAeC,EAErC,OAAOk7C,GAAmBC,IAGvBE,EAAY,SAASl4C,GACxB,MAAOxD,GAAMF,KAAK0D,EAAIvN,WAAY,SAASyU,GAC1C,MAA0B,OAAnBA,EAAMne,YAIXoxB,EAAU,SAAUna,GACvB,OAAQA,EAAI3K,YAGT8iD,EAAgB,SAAS/gC,GAC5B,MAAOA,GAAKzgC,OAAS,GAAKwjC,EAAQ/C,EAAKA,EAAKzgC,OAAS,IAAMygC,EAAKt6B,MAAM,MAASs6B,GAG5EghC,EAAc,SAAS/wC,EAAK1U,GAC/B,GAAIghD,GAActsC,EAAIwP,UAAUlkB,EAAM0U,EAAIiO,QAC1C,OAAOq+B,IAAwC,OAAzBA,EAAY5qD,SAAoB4qD,EAAc,MAGjE0E,EAAkB,SAAShxC,EAAK1U,GACnC,QAASylD,EAAY/wC,EAAK1U,IAGvB2lD,EAAW,SAAShyD,EAAY+5B,GACnC,GAAIk4B,GAAYl4B,EAAInW,aAChBsuC,EAAWn4B,EAAInW,YAKnB,OAHAquC,GAAU5wC,eAAerhB,GACzBkyD,EAAS1wC,YAAYxhB,IAGpBiyD,EAAU5uC,gBACV6uC,EAAS7uC,kBAIP8uC,EAAc,SAAS9lD,EAAMkU,GAChC,GAAI6xC,GAAWpZ,EAAc5+B,OAAO/N,GAChCgmD,EAAc,GAAId,GAAYhxC,GAC9B+xC,EAAcD,EAAYr2C,KAAKo2C,EAEnC,OAAOE,GAAcA,EAAYpZ,UAAY,MAG1CqZ,EAAa,SAASlmD,EAAMkU,GAC/B,GAAI6xC,GAAWpZ,EAAc3+B,MAAMhO,GAC/BgmD,EAAc,GAAId,GAAYhxC,GAC9B+xC,EAAcD,EAAYp2C,KAAKm2C,EAEnC,OAAOE,GAAcA,EAAYpZ,UAAY,MAG1CsZ,EAAe,SAASzhE,EAAQ+/B,EAAMvQ,EAAUwZ,GACnD,GAAIsgB,GAAQ2X,EAASjhE,EAAQgpC,GACzBhJ,EAAYhgC,EAAOiP,UASvB,OAPA+wB,GAAUvZ,aAAa6iC,EAAM,GAAItpD,GACjCmlB,EAAM1C,KAAKsd,EAAM,SAAS2hC,GACzB1hC,EAAUvZ,aAAai7C,EAAI1hE,KAE5BggC,EAAUvZ,aAAa6iC,EAAM,GAAItpD,GACjCggC,EAAU3sB,YAAYrT,GAEfwhE,EAAWzhC,EAAKA,EAAKzgC,OAAS,GAAIkwB,IAGtC/I,EAAe,SAASzmB,EAAQ+/B,EAAMvQ,GACzC,GAAIwQ,GAAYhgC,EAAOiP,UAMvB,OAJAkW,GAAM1C,KAAKsd,EAAM,SAASpX,GACzBqX,EAAUvZ,aAAakC,EAAK3oB,KAGtBohE,EAAYphE,EAAQwvB,IAGxBkD,EAAc,SAAS1yB,EAAQ+/B,EAAMvQ,EAAUQ,GAElD,MADAA,GAAI0C,YAAYqN,EAAKha,UAAW/lB,GACzBwhE,EAAWzhC,EAAK,GAAIvQ,IAGxBmyC,EAAgB,SAASjX,EAAY16B,EAAKgZ,EAAKiiB,GAClD,GAAI0V,GAAcC,EAAc5wC,EAAK06B,EAAYO,GAC7C2W,EAAWb,EAAY/wC,EAAKgZ,EAAIvX,gBAChCowC,EAASf,EAAcD,EAAUF,EAAY3iD,aAC7C8jD,EAAY,EAAGC,EAAM,EACrBvyC,EAAWQ,EAAIgO,UAEfgkC,EAAO,SAAS9hD,GACnB,GAAImhD,GAAWpZ,EAAcK,eAAetf,GACxCs4B,EAAc,GAAId,GAAYxwC,EAAIgO,WAClCikC,EAAS/hD,IAAa4hD,EAAYR,EAAYp2C,KAAKm2C,GAAYC,EAAYr2C,KAAKo2C,EAEpF,QAAOY,GAASlB,EAAY/wC,EAAKiyC,EAAOr2B,aAAeg2B,EAGxD,OAAII,GAAKF,GACDr7C,EAAam7C,EAAUC,EAAQryC,GAC5BwyC,EAAKD,GACRrvC,EAAYkvC,EAAUC,EAAQryC,EAAUQ,GAGzCyxC,EAAaG,EAAUC,EAAQryC,EAAUwZ,GAGjD,QACCy3B,eAAgBA,EAChBkB,cAAeA,EACfX,gBAAiBA,EACjBF,cAAeA,EACfD,UAAWA,KAsBblhE,EAAO,yBACN,cACA,qBACA,0BACA,4BACA,8BACA,2BACA,uBACA,sBACE,SAASmK,EAAKqb,EAAO81B,EAAYulB,EAAavY,EAAekG,EAAcnmB,EAAUk6B,GACvF,GAAIp4B,GAAc9B,EAASlB,eAAe,SAEtCq7B,EAAoB,SAASl7D,EAAQtC,EAAOy9D,GAM/C,QAASC,GAAoB78C,GAO5B,QAAS88C,GAAev7C,GACvB,MAAOpZ,GAAUoZ,IAAmD,GAAnCpZ,EAAUoZ,GAAapY,SAPzD,GAAIq6B,GAAKr7B,EAAWid,CAwBpB,OAtBAoe,GAAMsD,EAAUC,QAAO,GACvB5+B,EAAYq7B,EAAIvX,eAChB7G,EAASoe,EAAIrX,YAMa,GAAtBhkB,EAAUgB,WACTic,EAAS,EACZpF,EAAOA,EAAK1T,QAAQ,UAAW,KACpBwwD,EAAe,qBAC1B98C,EAAOA,EAAK1T,QAAQ,KAAM,WAGvB8Y,EAASjd,EAAUrO,OACtBkmB,EAAOA,EAAK1T,QAAQ,iBAAkB,KAC3BwwD,EAAe,iBAC1B98C,EAAOA,EAAK1T,QAAQ,qBAAsB,YAIrC0T,EAIR,QAAS+8C,KACR,GAAIv5B,GAAKr7B,EAAWid,CAEpBoe,GAAMsD,EAAUC,QAAO,GACvB5+B,EAAYq7B,EAAIvX,eAChB7G,EAASoe,EAAIrX,YAEa,GAAtBhkB,EAAUgB,UAAiBq6B,EAAIhY,YACH,MAA3BrjB,EAAU7C,KAAK8f,IAClBjd,EAAU6mB,WAAW5J,EAAQ,GAExB,cAAc/hB,KAAKlE,KACvBA,GAAS,MAE+B,MAA/BgJ,EAAU7C,KAAK8f,EAAS,KAClCjd,EAAU6mB,WAAW5J,EAAS,EAAG,GAE5B,cAAc/hB,KAAKlE,KACvBA,EAAQ,IAAMA,KAMlB,QAAS69D,KACR,GAAIC,EAAO,CACV,GAAItiD,GAAOlZ,EAAO+kC,UAAW8sB,EAAe,GAAI3K,GAAan+B,EAE7D7K,GAAM1C,KAAKuN,EAAIxd,OAAO,wBAAyB,SAAS8I,GACvD,IAAK,GAAIonD,GAAWpnD,EAAKrM,WAAYyzD,GAAYA,GAAYviD,EAAMuiD,EAAWA,EAASzzD,WAClF2tD,EAAmBthD,EAAK5J,SAASC,gBAAkBmnD,EAAah8C,QAAQ4lD,EAAUpnD,IACrF0U,EAAI/G,OAAO3N,GAAM,MAOtB,QAASqnD,GAAqB1X,GAG7B,IAFA,GAAI3vC,GAAO2vC,EAEH3vC,EAAOA,EAAKqJ,QACD,IAAdrJ,EAAKhQ,MACRgQ,EAAKgC,KAAK,oBAAqB,KAKlC,QAASslD,GAAsBj6C,GAC9BxD,EAAM1C,KAAKkG,EAAIhZ,qBAAqB,KAAM,SAASgZ,GAClDA,EAAIpW,gBAAgB,uBAItB,QAASswD,GAAiBvnD,GACzB,QAASA,EAAKzJ,aAAa,qBAG5B,QAASixD,GAAgBxnD,GACxB,MAAOA,KAASrU,EAAOilB,OAAOmnB,wBAAwB/3B,EAAK5J,UAG5D,QAASqxD,GAAsB/jB,GAG9B,QAASgkB,GAA8B1nD,GAGtC,IAFA,GAAI6E,GAAOlZ,EAAO+kC,UAEX1wB,GAAQA,IAAS6E,EAAM7E,EAAOA,EAAKrM,WACzC,GAA4C,UAAxChI,EAAO+oB,IAAI8T,mBAAmBxoB,GACjC,MAAOA,EAIT,OAAO,MAuCR,QAAS2nD,GAAiBj6B,GACzB,GAAIq4B,GAAWpZ,EAAcK,eAAetf,GACxCs4B,EAAc,GAAId,GAAYv5D,EAAO+kC,UAGzC,IADAq1B,EAAWC,EAAYr2C,KAAKo2C,GAE3B,MAAOA,GAASlZ,UAxDlB,GAAI+a,GAAwB5G,EAAa6G,CAczC,IAAKnkB,EAAL,CAQA,GAJA1S,EAAUohB,eAAe1O,GAGzBkkB,EAAyBF,EAA8BhkB,GAItD,MAFAhvB,GAAI/G,OAAO+1B,OACX1S,GAAU95B,OAAO0wD,EAKlBl6B,GAAMhZ,EAAIkT,YAGV5nB,EAAO0jC,EAAOlqB,gBACVxZ,GAAyB,GAAjBA,EAAK3M,UAChBq6B,EAAI/Y,SAAS3U,EAAMA,EAAK2C,UAAU3e,QAG7BwK,EAAIhC,KACRumD,EAAQrP,EAAO9qC,YACXm6C,GAA2B,GAAlBA,EAAM1/C,WAClB2M,EAAK6uC,WAAWkE,EAAMvjD,MACtBujD,EAAMp/C,WAAWoE,YAAYg7C,OAK/BrlB,EAAI1Y,eAAe0uB,GACnBhW,EAAIxY,aAAawuB,IAclBsd,EAActsC,EAAIwP,UAAUwf,EAAQhvB,EAAIiO,SACxCjO,EAAI/G,OAAO+1B,GAEPsd,GAAetsC,EAAI8S,QAAQw5B,KAC9Br1D,EAAOi1B,EAAEogC,GAAax7C,QAEtBkoB,EAAI/Y,SAASqsC,EAAa,GAC1BtzB,EAAI5Y,OAAOksC,EAAa,GAEnBxyB,EAAYwyB,IAAiBuG,EAAiBvG,MAAiB6G,EAAUF,EAAiBj6B,IAI9FhZ,EAAIhI,IAAIs0C,EAAatsC,EAAI9uB,OAAO,MAAOkiD,iBAAkB,QAHzDpa,EAAMm6B,EACNnzC,EAAI/G,OAAOqzC,KAMbhwB,EAAUge,OAAOthB,IA/KlB,GAAI0P,GAAQgS,EAAYz7C,EAAYugB,EAAUy7B,EAAUzlD,EACpDw5C,EAAQhW,EAAK1tB,EAAM+yC,EAAO+U,EAAcX,EACxC7F,EAAqB31D,EAAOilB,OAAOknB,wBACnC9G,EAAYrlC,EAAOqlC,UAAWtc,EAAM/oB,EAAO+oB,GAgL3C,SAAQnnB,KAAKlE,KAChBA,EAAQ09D,EAAoB19D,IAI7B+zC,EAASzxC,EAAOyxC,OAChB+pB,EAAQL,EAAQK,MAEhB/X,EAAa,GAAIzP,IAChBnG,SAAU7tC,EAAOglB,SAAS6oB,UACxB7tC,EAAOilB,QACVk3C,EAAe,yEAGf59D,GAAQkkB,QAAS/kB,EAAO43C,OAAQ,OAAQjQ,WAAW,GACnDrlC,EAAOqI,KAAK,mBAAoB9J,GAChCb,EAAQa,EAAKkkB,QAGT/kB,EAAMqE,QAAQ,kBACjBrE,GAAS,YAIVA,EAAQA,EAAMmN,QAAQ,cAAesxD,GAGrCp6B,EAAMsD,EAAUC,QAChB,IAAI82B,GAAer6B,EAAIvX,iBAAmBuX,EAAIqU,cAAgBrU,EAAIqU,gBAAkB,MAChFt2C,EAAOE,EAAO+kC,SACdq3B,KAAiBt8D,GAAQulC,EAAUG,eAClCzc,EAAIiO,QAAQl3B,EAAKiX,aAAe8kD,EAAgB/7D,EAAKiX,aAAegS,EAAI8S,QAAQ/7B,EAAKiX,cACxFgrB,EAAMhZ,EAAIkT,YACV8F,EAAI/Y,SAASlpB,EAAKiX,WAAY,GAC9BgrB,EAAI5Y,OAAOrpB,EAAKiX,WAAY,GAC5BsuB,EAAUge,OAAOthB,IAKdsD,EAAUG,gBAGdxlC,EAAOqlC,UAAUge,OAAOrjD,EAAOqlC,UAAUC,UACzCtlC,EAAOklC,SAASkY,YAAY,UAAU,EAAO,MAC7Cke,KAGDtzD,EAAaq9B,EAAUV,SAGvB,IAAI03B,IAAc/yD,QAAStB,EAAWyC,SAASC,cAAe7G,KAAMs3D,EAAQt3D,KAI5E,IAHAmgD,EAAWvS,EAAOtrB,MAAMzoB,EAAO2+D,GAG3BpB,EAAWzB,eAAexV,IAAaiX,EAAWlB,gBAAgBhxC,EAAK/gB,GAI1E,MAHA+5B,GAAMk5B,EAAWP,cAAcjX,EAAY16B,EAAK/oB,EAAOqlC,UAAUC,SAAU0e,GAC3EhkD,EAAOqlC,UAAUge,OAAOthB,OACxB/hC,GAAOqI,KAAK,aAAc9J,EAQ3B,IAJAm9D,EAAqB1X,GAGrB3vC,EAAO2vC,EAAS1rC,UACO,cAAnBjE,EAAKgC,KAAK,MAGb,IAFA0hC,EAAS1jC,EAEJA,EAAOA,EAAK4P,KAAM5P,EAAMA,EAAOA,EAAKqJ,MAAK,GAC7C,GAAiB,GAAbrJ,EAAKhQ,OAAc0kB,EAAIiO,QAAQ3iB,EAAKtR,MAAO,CAC1C/C,EAAOilB,OAAOwnB,aAAap4B,EAAKG,OAAOzR,KAAM,SAChDsR,EAAKG,OAAO8xB,OAAOyR,EAAQ1jC,EAAoB,OAAdA,EAAKtR,KAEvC,OAQH,GAHA/C,EAAOs8D,oBAAoBC,wBAAwBv0D,GAG9Cq0D,EAAWlqB,QAWT,CAiBN,IAZA9M,EAAU+e,WAAW+X,GACrBn0D,EAAaq9B,EAAUV,UACvBpc,EAAWvoB,EAAO+kC,UAGS,GAAvB/8B,EAAWN,SACdM,EAAaqM,EAAOkU,EAEpBlU,EAAOrM,EAIDqM,IAASkU,GACfvgB,EAAaqM,EACbA,EAAOA,EAAKrM,UAIbtK,GAAQsK,GAAcugB,EAAWA,EAASrT,UAAY6T,EAAIkS,aAAajzB,GACvEtK,EAAQ+lD,EAAWz7B,UAClBypB,EAAOtrB,MAENzoB,EAAMmN,QAAQ,oDAAqD,WAClE,MAAO44C,GAAWz7B,UAAUg8B,OAM3Bh8C,GAAcugB,EACjBQ,EAAIoQ,QAAQ5Q,EAAU7qB,GAEtBqrB,EAAIoS,aAAanzB,EAAYtK,OA/C9BA,GAAQ+lD,EAAWz7B,UAAUg8B,GAG7B3vC,EAAOrM,EAAW+O,WAClBqwC,EAAQp/C,EAAWsQ,WACdjE,GAASA,IAAS+yC,GAA2B,OAAlB/yC,EAAK5J,SACpCse,EAAIoQ,QAAQnxB,EAAYtK,GAExB2nC,EAAU+e,WAAW1mD,EA2CvB69D,KACAO,EAAsB/yC,EAAI5H,IAAI,eAC9Bw6C,EAAsB37D,EAAO+kC,WAC7B/kC,EAAOqI,KAAK,aAAc9J,GAC1ByB,EAAOw8D,aAGJC,EAAe,SAAU/+D,GAC5B,GAAIy9D,EAEJ,OAAqB,gBAAVz9D,IACVy9D,EAAUj9C,EAAMV,QACfk/C,MAAOh/D,EAAMg/D,MACb74D,MACC64D,MAAOh/D,EAAMg/D,QAEZh/D,IAGF+kB,QAAS/kB,EAAM+kB,QACf04C,QAASA,KAKV14C,QAAS/kB,EACTy9D,aAIET,EAAgB,SAAU16D,EAAQtC,GACrC,GAAIma,GAAS4kD,EAAa/+D,EAC1Bw9D,GAAkBl7D,EAAQ6X,EAAO4K,QAAS5K,EAAOsjD,SAGlD,QACCT,cAAeA,KAsBjBhiE,EAAO,0BACN,cACA,qBACA,yBACA,yBACA,yBACE,SAASmK,EAAKqb,EAAO4jB,EAAY3M,EAAYwnC,GAE/C,GAAInhD,GAAO0C,EAAM1C,KAAMgC,EAASU,EAAMV,OAClC1O,EAAMoP,EAAMpP,IAAKmP,EAAUC,EAAMD,QAASN,EAAUO,EAAMP,QAC1Di/C,EAAU/5D,EAAIhC,IAAMgC,EAAIhC,GAAK,GAC7BqoB,GAAO,EAAME,GAAQ,CAEzB,OAAO,UAASppB,GAuBf,QAASo9C,GAAYwW,EAASiJ,EAAIn/D,EAAOa,GACxC,GAAI8B,GAAMy8D,EAAe55C,EAAQ,CAOjC,IALK,mEAAmEthB,KAAKgyD,IAAcr1D,GAASA,EAAKw+D,YACxG/8D,EAAOmZ,QAGR5a,EAAOyB,EAAOqI,KAAK,qBAAsBurD,QAASA,EAASiJ,GAAIA,EAAIn/D,MAAOA,IACtEa,EAAK4G,qBACR,OAAO,CAIR,IADA23D,EAAgBlJ,EAAQlpD,cACnBrK,EAAO28D,EAASl7D,KAAKg7D,GAGzB,MAFAz8D,GAAKy8D,EAAeD,EAAIn/D,GACxBsC,EAAOqI,KAAK,eAAgBurD,QAASA,EAASiJ,GAAIA,EAAIn/D,MAAOA,KACtD,CAYR,IARA8d,EAAKxb,EAAOi9D,QAAS,SAASlgD,GAC7B,GAAIA,EAAEqgC,aAAergC,EAAEqgC,YAAYwW,EAASiJ,EAAIn/D,GAG/C,MAFAsC,GAAOqI,KAAK,eAAgBurD,QAASA,EAASiJ,GAAIA,EAAIn/D,MAAOA,IAC7DwlB,GAAQ,GACD,IAILA,EACH,MAAOA,EAIR,IAAIljB,EAAOk9D,OAASl9D,EAAOk9D,MAAM9f,aAAep9C,EAAOk9D,MAAM9f,YAAYwW,EAASiJ,EAAIn/D,GAErF,MADAsC,GAAOqI,KAAK,eAAgBurD,QAASA,EAASiJ,GAAIA,EAAIn/D,MAAOA,KACtD,CAIR,KACCwlB,EAAQljB,EAAOklC,SAASkY,YAAYwW,EAASiJ,EAAIn/D,GAChD,MAAOE,IAIT,QAAIslB,IACHljB,EAAOqI,KAAK,eAAgBurD,QAASA,EAASiJ,GAAIA,EAAIn/D,MAAOA,KACtD,GAaT,QAASy/D,GAAkBvJ,GAC1B,GAAIvzD,EAGJ,KAAIL,EAAOo9D,OAAOtiC,WAAlB,CAKA,GADA84B,EAAUA,EAAQlpD,cACbrK,EAAO28D,EAAS95C,MAAM0wC,GAC1B,MAAOvzD,GAAKuzD,EAIb,KACC,MAAO5zD,GAAOklC,SAASi4B,kBAAkBvJ,GACxC,MAAOh2D,IAIT,OAAO,GAUR,QAASy/D,GAAkBzJ,GAC1B,GAAIvzD,EAGJ,KAAIL,EAAOo9D,OAAOtiC,WAAlB,CAKA,GADA84B,EAAUA,EAAQlpD,cACbrK,EAAO28D,EAASt/D,MAAMk2D,GAC1B,MAAOvzD,GAAKuzD,EAIb,KACC,MAAO5zD,GAAOklC,SAASm4B,kBAAkBzJ,GACxC,MAAOh2D,MAYV,QAAS0/D,GAAYC,EAAcl5D,GAClCA,EAAOA,GAAQ,OAEfmX,EAAK+hD,EAAc,SAAStlE,EAAU27D,GACrCp4C,EAAKo4C,EAAQlpD,cAAczR,MAAM,KAAM,SAAS26D;AAC/CoJ,EAAS34D,GAAMuvD,GAAW37D,MAK7B,QAASulE,GAAW5J,EAAS37D,EAAU2O,GACtCgtD,EAAUA,EAAQlpD,cAClBsyD,EAASl7D,KAAK8xD,GAAW,SAASA,EAASiJ,EAAIn/D,EAAOa,GACrD,MAAOtG,GAASqF,KAAKsJ,GAAS5G,EAAQ68D,EAAIn/D,EAAOa,IAWnD,QAASk/D,GAAsB7J,GAG9B,GAFAA,EAAUA,EAAQlpD,cAEdsyD,EAASl7D,KAAK8xD,GACjB,OAAO,CAIR,KACC,MAAO5zD,GAAOklC,SAASu4B,sBAAsB7J,GAC5C,MAAOh2D,IAIT,OAAO,EAGR,QAAS8/D,GAAqB9J,EAAS37D,EAAU2O,GAChDgtD,EAAUA,EAAQlpD,cAClBsyD,EAAS95C,MAAM0wC,GAAW,WACzB,MAAO37D,GAASqF,KAAKsJ,GAAS5G,IAIhC,QAAS29D,GAAqB/J,EAAS37D,EAAU2O,GAChDgtD,EAAUA,EAAQlpD,cAClBsyD,EAASt/D,MAAMk2D,GAAW,WACzB,MAAO37D,GAASqF,KAAKsJ,GAAS5G,IAIhC,QAAS49D,GAAiBhK,GAEzB,MADAA,GAAUA,EAAQlpD,gBACTsyD,EAASl7D,KAAK8xD,GAkBxB,QAASiK,GAAkBjK,EAASiJ,EAAIn/D,GASvC,MARIm/D,KAAO/kE,IACV+kE,EAAKzzC,GAGF1rB,IAAU5F,IACb4F,EAAQ,MAGFsC,EAAOklC,SAASkY,YAAYwW,EAASiJ,EAAIn/D,GAGjD,QAASogE,GAAc/6D,GACtB,MAAOilD,GAAU7lD,MAAMY,GAGxB,QAASg7D,GAAah7D,EAAMrF,GAC3BsqD,EAAUsH,OAAOvsD,EAAMrF,GAASA,MAAOA,GAAS5F,GAChDkI,EAAOylC,cAGR,QAASu4B,GAAe35D,GACvByyC,EAAWzR,EAAU2R,YAAY3yC,GAGlC,QAASgzD,KACRhyB,EAAU4R,eAAeH,GAjP1B,GAAI/tB,GAAKsc,EAAW2iB,EAGnBlR,EAFAkmB,GAAY95C,SAAWphB,QAAUpE,UACjCsnB,EAAWhlB,EAAOglB,QAGnBhlB,GAAOqjB,GAAG,UAAW,WACpB0F,EAAM/oB,EAAO+oB,IACbsc,EAAYrlC,EAAOqlC,UACnBrgB,EAAWhlB,EAAOglB,SAClBgjC,EAAYhoD,EAAOgoD,YAgMpBxqC,EAAOrhB,MACNihD,YAAaA,EACb+f,kBAAmBA,EACnBE,kBAAmBA,EACnBI,sBAAuBA,EACvBH,YAAaA,EACbE,WAAYA,EACZE,qBAAsBA,EACtBC,qBAAsBA,EACtBC,iBAAkBA,IAmCnBN,GAECW,uCAAwC,aAGxCC,kCAAmC,WAClCl+D,EAAO02D,YAAY31C,OAGpBo9C,iBAAkB,SAASvK,GAC1B,GAA2BpgC,GAAvB9uB,EAAM1E,EAAOklC,QAGjB,KACC24B,EAAkBjK,GACjB,MAAOh2D,GAER41B,EAAStK,EASV,GALgB,UAAZ0qC,GAAwBlvD,EAAI05D,oBAAoBxK,KACnDpgC,GAAS,GAINA,IAAW9uB,EAAI+4D,sBAAsB7J,GAAU,CAClD,GAAIp9C,GAAMxW,EAAOq+D,UAChB,qHAIGx7D,GAAI5B,MACPuV,EAAMA,EAAI3L,QAAQ,UAAW,OAG9B7K,EAAOs+D,oBAAoBC,MAAM3lD,KAAMpC,EAAKnS,KAAM,YAKpDm6D,OAAQ,WACP,GAAIn5B,EAAUG,cAAe,CAC5B,GAAI9jB,GAAM2jB,EAAUV,SAKpB,aAJmB,KAAfjjB,EAAIiiB,SACP3jC,EAAO+oB,IAAI/G,OAAON,GAAK,IAMzBsmC,EAAUhmC,OAAO,SAIlBy8C,iEAAkE,SAAS7K,GAC1E,GAAI8K,GAAQ9K,EAAQtmC,UAAU,EAEjB,SAAToxC,IACHA,EAAQ,WAITljD,EAAK,4BAA4BviB,MAAM,KAAM,SAAS8J,GACjD27D,GAAS37D,GACZilD,EAAUhmC,OAAO,QAAUjf,KAIhB,QAAT27D,GACHX,EAAa,QAAUW,IAKzBC,wCAAyC,SAAS/K,GACjD,GAAIgL,GAASC,CAEbhB,GAAkBjK,GAKlBgL,EAAU71C,EAAIwP,UAAU8M,EAAUV,UAAW,SACzCi6B,IACHC,EAAaD,EAAQ52D,WAGjB,2BAA2BpG,KAAKi9D,EAAWp0D,YAC9CuzD,IACAj1C,EAAI9vB,MAAM4lE,EAAYD,GACtBvH,OAMHyH,4DAA6D,SAASlL,GACrEmK,EAAanK,IAIdmL,iCAAkC,SAASnL,EAASiJ,EAAIn/D,GACvDqgE,EAAanK,EAASl2D,IAGvBshE,SAAU,SAASpL,EAASiJ,EAAIn/D,GAC/B,GAAIuhE,GAAaC,CAGbxhE,IAAS,GAAKA,GAAS,IAC1BwhE,EAAYvhD,EAAQqH,EAASm6C,wBAC7BF,EAActhD,EAAQqH,EAASo6C,mBAG9B1hE,EADGuhE,EACKA,EAAYvhE,EAAQ,IAAMA,EAE1BwhE,EAAUxhE,EAAQ,IAAMA,GAIlCqgE,EAAanK,EAASl2D,IAGvB2hE,aAAc,SAASzL,GACtB5L,EAAUhmC,OAAO4xC,IAGlB0L,cAAe,WACdvB,EAAa,eAGdwB,YAAa,SAAS3L,EAASiJ,EAAIn/D,GAClC,MAAOqgE,GAAargE,GAAS,MAG9B8hE,WAAY,WACX,GAAI1oB,GAAWzR,EAAU2R,aAEzBh3C,GAAOokD,WAAWpkD,EAAOmzC,YAAY2B,QAAS5rB,KAAS4rB,QAAS5rB,IAEhEmc,EAAU4R,eAAeH,IAG1B2oB,cAAe,SAAS7L,EAASiJ,EAAIn/D,GACpC,GAAI2W,GAAO3W,GAAS2nC,EAAUV,SAG1BtwB,IAAQrU,EAAO+kC,YAClBi5B,IACAh+D,EAAO+oB,IAAI/G,OAAO3N,EAAM6U,GACxBmuC,MAIFqI,mBAAoB,SAAS9L,EAASiJ,EAAIn/D,GACzC,GAAI04B,GAAU,CAEdrN,GAAIwP,UAAU8M,EAAUV,UAAW,SAAStwB,GAC3C,GAAqB,GAAjBA,EAAK3M,UAAiB0uB,KAAa14B,EAEtC,MADA2nC,GAAU95B,OAAO8I,GACV+U,GAENppB,EAAO+kC,YAGX46B,cAAe,SAAS/L,EAASiJ,EAAIn/D,GACpC2nC,EAAU95B,OAAO7N,IAGlBkiE,iBAAkB,SAAShM,EAASiJ,EAAIn/D,GACvCi/D,EAAcjC,cAAc16D,EAAQtC,IAGrCmiE,iBAAkB,SAASjM,EAASiJ,EAAIn/D,GACvC2nC,EAAU+e,WAAW,mBACrBpkD,EAAOokD,WACNpkD,EAAOmzC,aAAatoC,QAAQ,mBAAoB,WAC/C,MAAOnN,OAKVoiE,gBAAiB,SAASlM,EAASiJ,EAAIn/D,GACtCqgE,EAAargE,IAGdqiE,cAAe,SAASnM,EAASiJ,EAAIn/D,GACpCsC,EAAOokD,WAAW1mD,IAGnBsiE,iBAAkB,SAASpM,GAC1B,GAAIqM,GAAaC,EAAYxiE,CAG7BuiE,GAAcj7C,EAASm7C,YACvBD,EAAa,YAAYp+D,KAAKm+D,GAC9BA,EAAc36C,SAAS26C,EAAa,IAE/B9C,EAAkB,wBAA2BA,EAAkB,qBA0BnEU,EAAkBjK,IAxBb5uC,EAASgtB,mBAAsBjpB,EAAIwP,UAAU8M,EAAUV,UAAW5b,EAAIiO,UAC1EgxB,EAAUvvD,MAAM,OAGjB+iB,EAAK6pB,EAAUogB,oBAAqB,SAASzmD,GAC5C,GAAwC,UAApC+pB,EAAI8T,mBAAmB79B,IAIH,MAApBA,EAAQyL,SAAkB,CAC7B,GAAI21D,GAAkBpgE,EAAOqgE,SAAS,qBAAqB,GAAS,SAAW,SAE/ED,IAA+D,OAA5Cr3C,EAAIqP,SAASp5B,EAAS,aAAa,GAAiB,QAAU,OAElE,WAAX40D,GACHl2D,EAAQ5B,KAAKjB,IAAI,EAAGyqB,SAAStmB,EAAQ2iB,MAAMy+C,IAAoB,EAAG,IAAMH,GACxEl3C,EAAIwQ,SAASv6B,EAASohE,EAAiB1iE,EAAQA,EAAQwiE,EAAa,MAEpExiE,EAAS4nB,SAAStmB,EAAQ2iB,MAAMy+C,IAAoB,EAAG,IAAMH,EAAeC,EAC5En3C,EAAIwQ,SAASv6B,EAASohE,EAAiB1iE,SAS5C4iE,WAAY,aAGZC,qBAAsB,WACrBvgE,EAAOo9C,YAAY,oBAAoB,EAAO,WAG/CojB,mBAAoB,WACnBxgE,EAAOygE,WAAazgE,EAAOygE,UAC3BzgE,EAAOw8D,aAGRkE,kBAAmB,SAAS9M,EAASiJ,EAAIn/D,GACxCsC,EAAOo9C,YAAY,oBAAoB,EAAO1/C,EAAMmN,QAAQ,mBAAoBw6B,EAAU8N,YAAYmC,OAAQ,YAG/GqrB,cAAe,SAAS/M,EAASiJ,EAAIn/D,GACpC,GAAIkjE,EAEgB,iBAATljE,KACVA,GAAS4b,KAAM5b,IAGhBkjE,EAAS73C,EAAIwP,UAAU8M,EAAUV,UAAW,KAG5CjnC,EAAM4b,KAAO5b,EAAM4b,KAAKzO,QAAQ,IAAK,OAGhC+1D,GAAWljE,EAAM4b,MACrB0uC,EAAUhmC,OAAO,QAIdtkB,EAAM4b,MACT0uC,EAAUvvD,MAAM,OAAQiF,EAAOkjE,IAIjCC,UAAW,WACV,GAA0B9+B,GAAtB7oB,EAAO6P,EAAIgO,SAEXsO,GAAUC,SAAStc,UACtB+Y,EAAMhZ,EAAIkT,YACV8F,EAAI/Y,SAAS9P,EAAM,GACnB6oB,EAAI5Y,OAAOjQ,EAAMA,EAAK/E,WAAW9b,QACjCgtC,EAAUge,OAAOthB,KAMjBA,EAAMsD,EAAUC,SACXvD,EAAIlmB,OACRkmB,EAAI6B,kBAAkB1qB,GACtB6oB,EAAIx2B,YAKPu1D,SAAU,WACTjD,EAAkB,SAKlB,IAAI/9D,GAAOE,EAAO+kC,SAEdhc,GAAI8S,QAAQ/7B,KACfE,EAAOokD,WAAW,IAEdtkD,EAAKiX,YAAcgS,EAAIiO,QAAQl3B,EAAKiX,YACvC/W,EAAOqlC,UAAUue,kBAAkB9jD,EAAKiX,WAAY,GAEpD/W,EAAOqlC,UAAUue,kBAAkB9jD,EAAM,KAK5CihE,eAAgB,WACf/gE,EAAOokD,WAAW,KAGnB4c,gBAAiB,SAASpN,EAASiJ,EAAIn/D,GAoCtC,QAASujE,KAIR,IAHA,GAAqD5sD,GAAjDynB,EAAS,GAAI3G,GAAWzuB,EAAW2uD,GACnChyB,EAAsBrjC,EAAOilB,OAAO+W,sBAEhC3nB,EAAOynB,EAAO9X,QACrB,GAAIqf,EAAoBhvB,EAAK5J,SAASC,gBAAkB2J,EAAKhc,OAAS,EACrE,OAAO,EAvCV,GACI6oE,GAAOC,EAASppB,EADhBxxC,EAAM7I,EAENqkC,EAAMsD,EAAUC,QAAO,EAC3B,IAAIxD,GAAW/Y,GAAK4Z,UAAUZ,EAE9B,IAAIpe,GAASoe,EAAIrX,YACbhkB,EAAYq7B,EAAIvX,cAGpB,IAA0B,GAAtB9jB,EAAUgB,UAAiBhB,EAAUg8B,gBAAiB,CACzD,GAAIuzB,GAA6BtyC,EAASjd,EAAUyN,WAAW9b,OAAS,CAExEqO,GAAYA,EAAUyN,WAAWrY,KAAKhB,IAAI6oB,EAAQjd,EAAUyN,WAAW9b,OAAS,KAAOqO,EAEtFid,EADGsyC,GAAoD,GAAtBvvD,EAAUgB,SAClChB,EAAUsQ,UAAU3e,OAEpB,EAIX,GAAIg9D,GAActsC,EAAIwP,UAAU7xB,EAAWqiB,EAAIiO,SAC3C4+B,EAAkBP,EAAcA,EAAY5qD,SAAS+W,cAAgB,GACrE80C,EAAiBjB,EAActsC,EAAIwP,UAAU88B,EAAYrtD,WAAY+gB,EAAIiO,SAAW,KACpFggC,EAAqBV,EAAiBA,EAAe7rD,SAAS+W,cAAgB,GAG9E4/C,EAAe76D,GAAOA,EAAIyyC,OACJ,OAAtBge,GAA+BoK,IAClC/L,EAAciB,EACdV,EAAkBoB,GAeftwD,GAAmC,GAAtBA,EAAUgB,UAAiBic,GAAUjd,EAAUsQ,UAAU3e,SAEpEukE,GAAYqE,MAChBC,EAAQn4C,EAAI9uB,OAAO,MACnB8nC,EAAIxW,WAAW21C,GACfn/B,EAAIzY,cAAc43C,GAClBn/B,EAAIvY,YAAY03C,GAChBC,GAAU,IAIZD,EAAQn4C,EAAI9uB,OAAO,MACnB8nC,EAAIxW,WAAW21C,EAGf,IAAIz+D,GAAesmB,EAAIrkB,IAAIjC,YAsB3B,OArBIm6D,IAA8B,OAAnBhH,KAA8BnzD,GAAgBA,EAAe,IAC3Ey+D,EAAMl5D,WAAWwX,aAAauJ,EAAIrkB,IAAI8oB,eAAe,MAAO0zC,GAI7DnpB,EAAShvB,EAAI9uB,OAAO,UAAY,UAChCinE,EAAMl5D,WAAWwX,aAAau4B,EAAQmpB,GACtC77B,EAAUohB,eAAe1O,GACzBhvB,EAAI/G,OAAO+1B,GAENopB,GAIJp/B,EAAI1Y,eAAe63C,GACnBn/B,EAAIxY,aAAa23C,KAJjBn/B,EAAIzY,cAAc43C,GAClBn/B,EAAIvY,YAAY03C,IAMjB77B,EAAUge,OAAOthB,GACjB/hC,EAAO02D,YAAY31C,MAEZmI,KAKTo0C,GAEC+D,qDAAsD,SAASzN,GAC9D,GAAI7wD,GAAO,QAAU6wD,EAAQtmC,UAAU,GACnCtM,EAAQqkB,EAAUG,eAAiBzc,EAAIwP,UAAU8M,EAAUV,UAAW5b,EAAIiO,UAAYqO,EAAUogB,oBAChG/kD,EAAUoO,EAAIkS,EAAO,SAAS3M,GACjC,QAAS2zC,EAAU6F,UAAUx5C,EAAMtR,IAEpC,OAAOkb,GAAQvd,EAASwoB,SAGzB41C,4DAA6D,SAASlL,GACrE,MAAOkK,GAAclK,IAGtB0L,cAAe,WACd,MAAOxB,GAAc,eAGtBwD,QAAS,WACR,GAAIjtD,EAEJ,IAAI2Q,EAASu8C,cAAe,CAC3B,IAAKltD,EAAO0U,EAAIwP,UAAU8M,EAAUE,WAAYxc,EAAIiO,WAAa1R,SAASjR,EAAKsN,MAAM6/C,YAAa,IAAM,EACvG,MAAOt4C,EAGR,KAAK7U,EAAO0U,EAAIwP,UAAU8M,EAAUsX,SAAU5zB,EAAIiO,WAAa1R,SAASjR,EAAKsN,MAAM6/C,YAAa,IAAM,EACrG,MAAOt4C,GAIT,MACCi0C,GAAkB,wBAClBA,EAAkB,uBAChBn4C,EAASu8C,iBAAmBx4C,EAAIwP,UAAU8M,EAAUV,UAAW,eAInEg6B,wCAAyC,SAAS/K,GACjD,GAAInjB,GAAO1nB,EAAIwP,UAAU8M,EAAUV,UAAW,QAE9C,OAAO8L,KAEO,wBAAZmjB,GAAsD,OAAjBnjB,EAAK9M,SAC9B,sBAAZiwB,GAAoD,OAAjBnjB,EAAK9M,WAGzC,SAGH25B,GACCmE,oBAAqB,SAAS7N,GAC7B,GAAep/C,GAAX9W,EAAQ,CAUZ,QARK8W,EAASuU,EAAIwP,UAAU8M,EAAUV,UAAW,WAE/CjnC,EADc,YAAXk2D,EACKp/C,EAAOmN,MAAMypC,SAEb52C,EAAOmN,MAAMupC,WAAWrgD,QAAQ,MAAO,KAAKA,QAAQ,UAAW,IAAIH,eAItEhN,IAEN,SAGH4/D,GACCoE,KAAM,WACL1hE,EAAO02D,YAAYvC,QAGpBwN,KAAM,WACL3hE,EAAO02D,YAAYtC,aAsBvB17D,EAAO,oBACN,sBACE,SAASwlB,GAkBX,QAAS0jD,GAAI9jD,EAAKkH,GACjB,GAAiB68C,GAASC,EAAtB17D,EAAOjK,IAQX,IANA2hB,EAAMtB,EAAKsB,GACXkH,EAAW5e,EAAK4e,SAAWA,MAC3B68C,EAAU78C,EAAS+8C,SAIf,yBAAyBngE,KAAKkc,IAAQ,QAAQlc,KAAKkc,GAEtD,YADA1X,EAAK47D,OAASlkD,EAIf,IAAImkD,GAA2C,IAAtBnkD,EAAI/b,QAAQ,KAGZ,KAArB+b,EAAI/b,QAAQ,MAAekgE,IAC9BnkD,GAAO+jD,EAAUA,EAAQK,UAAY,OAAS,QAAU,cAAgBpkD,GAIpE,iBAAiBlc,KAAKkc,KAC1BgkD,EAAW98C,EAAS+8C,SAAW/8C,EAAS+8C,SAASt+D,KAAO,GAAIm+D,GAAI3oD,SAASK,MAAM6oD,UAC5C,KAA/Bn9C,EAAS+8C,SAASG,SACrBpkD,EAAM,aAAe1X,EAAKg8D,UAAUN,EAAUhkD,IAE9CA,EAAM,oBAAoBhc,KAAKgc,GAC/BA,GAAQ+jD,GAAWA,EAAQK,UAAa,QAAU,cAAgB97D,EAAKg8D,UAAUN,EAAUhkD,EAAI,IAAMA,EAAI,KAK3GA,EAAMA,EAAIjT,QAAQ,MAAO,YAIzBiT,EAAM,mMAAmMhc,KAAKgc,GAE9MtC,EAAK6mD,EAAY,SAASrmD,EAAG5jB,GAC5B,GAAIkqE,GAAOxkD,EAAI1lB,EAGXkqE,KACHA,EAAOA,EAAKz3D,QAAQ,cAAe,OAGpCzE,EAAK4V,GAAKsmD,IAGPT,IACEz7D,EAAK87D,WACT97D,EAAK87D,SAAWL,EAAQK,UAGpB97D,EAAKm8D,WACTn8D,EAAKm8D,SAAWV,EAAQU,UAGpBn8D,EAAKo8D,MAAsB,aAAdp8D,EAAK8b,OACtB9b,EAAKo8D,KAAOX,EAAQW,MAGhBp8D,EAAK8b,MAAsB,aAAd9b,EAAK8b,OACtB9b,EAAK8b,KAAO2/C,EAAQ3/C,MAGrB9b,EAAK47D,OAAS,IAGXC,IACH77D,EAAK87D,SAAW,IAxFlB,GAAI1mD,GAAO0C,EAAM1C,KAAMgB,EAAO0B,EAAM1B,KAChC6lD,EAAa,uGAAuGppE,MAAM,KAC1HwpE,GACHC,IAAO,GACPC,KAAQ,GACRC,MAAS,IACTC,OAAU,GAuZX,OA/TAjB,GAAIxjE,WAOH0kE,QAAS,SAASr/D,GACjB,GAAI2C,GAAOjK,IAEXsH,GAAO,mBAAmB3B,KAAK2B,GAG/B2C,EAAK3C,KAAOA,EAAK,GACjB2C,EAAK+7D,UAAY1+D,EAAK,GACtB2C,EAAKmU,KAAO9W,EAAK,GAGjB2C,EAAK47D,OAAS,GACd57D,EAAK28D,UAaNC,WAAY,SAAS90B,GACpB,GAAiBsD,GAAbprC,EAAOjK,IAEX,IAAY,OAAR+xC,EACH,MAAOA,EAMR,IAHAA,EAAM,GAAI0zB,GAAI1zB,GAAM6zB,SAAU37D,IAGb,YAAZ8nC,EAAIhsB,MAAsB9b,EAAK8b,MAAQgsB,EAAIhsB,MAAQgsB,EAAIhsB,MAAS9b,EAAKo8D,MAAQt0B,EAAIs0B,MACpFp8D,EAAK87D,UAAYh0B,EAAIg0B,UAA6B,KAAjBh0B,EAAIg0B,SACtC,MAAOh0B,GAAI60B,QAGZ,IAAIE,GAAK78D,EAAK28D,SAAUG,EAAKh1B,EAAI60B,QAGjC,OAAIE,IAAMC,GAAmC,KAA5BD,EAAGniD,OAAOmiD,EAAG5qE,OAAS,IAAa4qE,EAAGp7C,OAAO,EAAGo7C,EAAG5qE,OAAS,IAAM6qE,EAC3ED,GAGRzxB,EAASprC,EAAK+8D,UAAU/8D,EAAK3C,KAAMyqC,EAAIzqC,MAGnCyqC,EAAI1tC,QACPgxC,GAAU,IAAMtD,EAAI1tC,OAIjB0tC,EAAI0yB,SACPpvB,GAAU,IAAMtD,EAAI0yB,QAGdpvB,IAcR4xB,WAAY,SAASl1B,EAAKm1B,GAGzB,MAFAn1B,GAAM,GAAI0zB,GAAI1zB,GAAM6zB,SAAU5lE,OAEvB+xC,EAAI60B,OAAOM,GAAUlnE,KAAKmnE,aAAap1B,KAY/Co1B,aAAc,SAASp1B,GACtB,GAAI/xC,KAAK+lB,MAAQgsB,EAAIhsB,MAAQ/lB,KAAK+lE,UAAYh0B,EAAIg0B,SAAU,CAC3D,GAAI/lE,KAAKqmE,MAAQt0B,EAAIs0B,KACpB,OAAO,CAGR,IAAIe,GAAcd,EAActmE,KAAK+lE,SACrC,IAAIqB,IAAiBpnE,KAAKqmE,MAAQe,KAAiBr1B,EAAIs0B,MAAQe,GAC9D,OAAO,EAIT,OAAO,GAURJ,UAAW,SAASr1D,EAAMrK,GACzB,GAAIoZ,GAAiCzkB,EAAGqO,EAA7B+8D,EAAa,EAAG5nD,EAAM,EAOjC,IAJA9N,EAAOA,EAAKwf,UAAU,EAAGxf,EAAK2xB,YAAY,MAC1C3xB,EAAOA,EAAK7U,MAAM,KAClB4jB,EAAQpZ,EAAKxK,MAAM,KAEf6U,EAAKzV,QAAUwkB,EAAMxkB,OACxB,IAAKD,EAAI,EAAGqO,EAAIqH,EAAKzV,OAAQD,EAAIqO,EAAGrO,IACnC,GAAIA,GAAKykB,EAAMxkB,QAAUyV,EAAK1V,IAAMykB,EAAMzkB,GAAI,CAC7CorE,EAAaprE,EAAI,CACjB,OAKH,GAAI0V,EAAKzV,OAASwkB,EAAMxkB,OACvB,IAAKD,EAAI,EAAGqO,EAAIoW,EAAMxkB,OAAQD,EAAIqO,EAAGrO,IACpC,GAAIA,GAAK0V,EAAKzV,QAAUyV,EAAK1V,IAAMykB,EAAMzkB,GAAI,CAC5CorE,EAAaprE,EAAI,CACjB,OAKH,GAAmB,IAAforE,EACH,MAAO//D,EAGR,KAAKrL,EAAI,EAAGqO,EAAIqH,EAAKzV,QAAUmrE,EAAa,GAAIprE,EAAIqO,EAAGrO,IACtDwjB,GAAO,KAGR,KAAKxjB,EAAIorE,EAAa,EAAG/8D,EAAIoW,EAAMxkB,OAAQD,EAAIqO,EAAGrO,IAEhDwjB,GADGxjB,GAAKorE,EAAa,EACd,IAAM3mD,EAAMzkB,GAEZykB,EAAMzkB,EAIf,OAAOwjB,IAURwmD,UAAW,SAASt0D,EAAMrK,GACzB,GAAIrL,GAAmBqrE,EAAIC,EAApBC,EAAK,EAAGloD,IAiBf,KAdAgoD,EAAK,MAAM7hE,KAAK6B,GAAQ,IAAM,GAC9BqK,EAAOA,EAAK7U,MAAM,KAClBwK,EAAOA,EAAKxK,MAAM,KAGlBuiB,EAAK1N,EAAM,SAAS81D,GACfA,GACHnoD,EAAEjjB,KAAKorE,KAIT91D,EAAO2N,EAGFrjB,EAAIqL,EAAKpL,OAAS,EAAGojB,KAAQrjB,GAAK,EAAGA,IAElB,IAAnBqL,EAAKrL,GAAGC,QAA4B,MAAZoL,EAAKrL,KAKjB,OAAZqL,EAAKrL,GAMLurE,EAAK,EACRA,IAIDloD,EAAEjjB,KAAKiL,EAAKrL,IAVXurE,IAgCF,OAnBAvrE,GAAI0V,EAAKzV,OAASsrE,EAIjBD,EADGtrE,GAAK,EACEqjB,EAAEqD,UAAU3T,KAAK,KAEjB2C,EAAKtP,MAAM,EAAGpG,GAAG+S,KAAK,KAAO,IAAMsQ,EAAEqD,UAAU3T,KAAK,KAIlC,IAAzBu4D,EAAQ3hE,QAAQ,OACnB2hE,EAAU,IAAMA,GAIbD,GAAMC,EAAQjkC,YAAY,OAASikC,EAAQrrE,OAAS,IACvDqrE,GAAWD,GAGLC,GASRX,OAAQ,SAASc,GAChB,GAAInoD,GAAGtV,EAAOjK,IAyCd,OAtCKiK,GAAK47D,SAAU6B,IACnBnoD,EAAI,GAECmoD,IAEHnoD,GADGtV,EAAK87D,SACH97D,EAAK87D,SAAW,MAEhB,KAGF97D,EAAKm8D,WACR7mD,GAAKtV,EAAKm8D,SAAW,KAGlBn8D,EAAK8b,OACRxG,GAAKtV,EAAK8b,MAGP9b,EAAKo8D,OACR9mD,GAAK,IAAMtV,EAAKo8D,OAIdp8D,EAAK3C,OACRiY,GAAKtV,EAAK3C,MAGP2C,EAAK5F,QACRkb,GAAK,IAAMtV,EAAK5F,OAGb4F,EAAKw6D,SACRllD,GAAK,IAAMtV,EAAKw6D,QAGjBx6D,EAAK47D,OAAStmD,GAGRtV,EAAK47D,SAIdJ,EAAIkC,aAAe,SAAS51B,GAC3B,GAAI7pC,GAAM3D,CASV,OAPAwtC,GAAMC,mBAAmBD,GAAKj1C,MAAM,KAEpCyH,EAAU,eAAeoB,KAAKosC,EAAI,IAC9BxtC,IACH2D,EAAO3D,EAAQ,KAIf2D,KAAMA,EACNR,KAAMqqC,EAAI,KAIZ0zB,EAAImC,mBAAqB,SAASC,GACjC,GAAIllC,EAiBJ,OAbCA,GADoC,IAAjCklC,EAAI9B,SAASngE,QAAQ,SAAkC,UAAjBiiE,EAAI9B,SACnC8B,EAAI1qD,KAEJ0qD,EAAI9B,SAAW,KAAO8B,EAAI9hD,KAAO8hD,EAAIC,SAG5C,yBAAyBriE,KAAKk9B,KACjCA,EAAUA,EAAQj0B,QAAQ,WAAY,IAAIA,QAAQ,gBAAiB,IAE9D,UAAUjJ,KAAKk9B,KACnBA,GAAW,MAINA,GAGD8iC,IA0BRlpE,EAAO,sBACN,sBACE,SAASwlB,GAKX,QAASgmD,MAJT,GAEIC,GAAaC,EAFb5oD,EAAO0C,EAAM1C,KAAMgC,EAASU,EAAMV,MA6ItC,OArIA0mD,GAAM1mD,OAAS2mD,EAAc,SAASxkD,GAIrC,QAASukD,KACR,GAAI9rE,GAAGisE,EAAQC,EAAOl+D,EAAOjK,IAG7B,KAAKioE,IAEAh+D,EAAKqZ,MACRrZ,EAAKqZ,KAAKhnB,MAAM2N,EAAMtN,WAIvBurE,EAASj+D,EAAKm+D,QAGb,IADAnsE,EAAIisE,EAAOhsE,OACJD,KACNksE,EAAQD,EAAOjsE,GACXksE,EAAM7kD,MACT6kD,EAAM7kD,KAAKhnB,MAAM2N,EAAMtN,WAQ5B,QAAS0rE,KACR,MAAOroE,MAKR,QAASsoE,GAAa1hE,EAAM/G,GAC3B,MAAO,YACN,GAAoCiB,GAAhCmJ,EAAOjK,KAAM8Y,EAAM7O,EAAKs+D,MAM5B,OAJAt+D,GAAKs+D,OAASA,EAAO3hE,GACrB9F,EAAMjB,EAAGvD,MAAM2N,EAAMtN,WACrBsN,EAAKs+D,OAASzvD,EAEPhY,GA1CT,GAA0CmB,GAAW2E,EAAM4hE,EAAvDv+D,EAAOjK,KAAMuoE,EAASt+D,EAAKhI,SAgD/BgmE,IAAe,EAGfhmE,EAAY,GAAIgI,GAChBg+D,GAAe,EAGXzkD,EAAK4kD,SACR/oD,EAAKmE,EAAK4kD,OAAQ,SAASD,GAC1B,IAAK,GAAIvhE,KAAQuhE,GACH,SAATvhE,IACH4c,EAAK5c,GAAQuhE,EAAMvhE,MAKlB2hE,EAAOH,SACV5kD,EAAK4kD,OAASG,EAAOH,OAAOn8D,OAAOuX,EAAK4kD,UAKtC5kD,EAAKilD,SACRppD,EAAKmE,EAAKilD,QAAQ3rE,MAAM,KAAM,SAAS8J,GACtC4c,EAAK5c,GAAQyhE,IAKX7kD,EAAKklD,YACRrpD,EAAKmE,EAAKklD,WAAW5rE,MAAM,KAAM,SAAS8J,GACzC,GAAI+hE,GAAY,IAAM/hE,CAEtB4c,GAAK5c,GAAQ,SAASrF,GACrB,GAAiBsG,GAAboC,EAAOjK,IAGX,OAAIuB,KAAUsG,GACboC,EAAK0+D,GAAapnE,EAEX0I,GAIDA,EAAK0+D,MAMXnlD,EAAKolD,SACRvpD,EAAKmE,EAAKolD,QAAS,SAAS1kE,EAAM0C,GACjCmhE,EAAMnhE,GAAQ1C,IAKZsf,EAAKqlD,UAAYN,EAAOM,WAC3BrlD,EAAKqlD,SAAWxnD,KAAWknD,EAAOM,SAAUrlD,EAAKqlD,UAIlD,KAAKjiE,IAAQ4c,GACZglD,EAAShlD,EAAK5c,GAEO,kBAAV4hE,IAAwBD,EAAO3hE,GACzC3E,EAAU2E,GAAQ0hE,EAAa1hE,EAAM4hE,GAErCvmE,EAAU2E,GAAQ4hE,CAapB,OARAT,GAAM9lE,UAAYA,EAGlB8lE,EAAMtlE,YAAcslE,EAGpBA,EAAM1mD,OAAS2mD,EAERD,GAGDA,IA0BRxrE,EAAO,gCACN,sBACE,SAASwlB,GASX,QAAS+mD,GAAWjgD,GAGnB,QAASlhB,KACR,OAAO,EAGR,QAASC,KACR,OAAO,EAiBR,QAASsE,GAAKtF,EAAMxE,GACnB,GAAIg1C,GAAUn7C,EAAGqO,EAAGxO,CAuCpB,IArCA8K,EAAOA,EAAK2H,cACZnM,EAAOA,MACPA,EAAK8F,KAAOtB,EAGPxE,EAAKxF,SACTwF,EAAKxF,OAAS6N,GAIVrI,EAAK2G,iBAET3G,EAAK2G,eAAiB,WACrB3G,EAAK4G,mBAAqBpB,GAI3BxF,EAAK8G,gBAAkB,WACtB9G,EAAK+G,qBAAuBvB,GAI7BxF,EAAKiH,yBAA2B,WAC/BjH,EAAKkH,8BAAgC1B,GAItCxF,EAAK4G,mBAAqBrB,EAC1BvF,EAAK+G,qBAAuBxB,EAC5BvF,EAAKkH,8BAAgC3B,GAGlCkhB,EAASkgD,YACZlgD,EAASkgD,WAAW3mE,GAGrBg1C,EAAW4xB,EAASpiE,GAEnB,IAAK3K,EAAI,EAAGqO,EAAI8sC,EAASl7C,OAAQD,EAAIqO,EAAGrO,IAAK,CAS5C,GARAH,EAAWs7C,EAASn7C,GAGhBH,EAASmtE,MACZ9hD,EAAIvgB,EAAM9K,EAASoI,MAIhB9B,EAAKkH,gCAER,MADAlH,GAAK8G,kBACE9G,CAIR,IAAItG,EAASoI,KAAK/C,KAAKsJ,EAAOrI,MAAU,EAEvC,MADAA,GAAK2G,iBACE3G,EAKV,MAAOA,GAgBR,QAAS8kB,GAAGtgB,EAAM9K,EAAUkqB,EAASqyC,GACpC,GAAIjhB,GAAUjsC,EAAOlP,CAMrB,IAJIH,KAAa,IAChBA,EAAW6L,GAGR7L,EAWH,IAVAA,GACCoI,KAAMpI,GAGHu8D,GACHt2C,EAAMV,OAAOvlB,EAAUu8D,GAGxBltD,EAAQvE,EAAK2H,cAAczR,MAAM,KACjCb,EAAIkP,EAAMjP,OACHD,KACN2K,EAAOuE,EAAMlP,GACbm7C,EAAW4xB,EAASpiE,GACfwwC,IACJA,EAAW4xB,EAASpiE,MACpBsiE,EAAYtiE,GAAM,IAGfof,EACHoxB,EAASr9B,QAAQje,GAEjBs7C,EAAS/6C,KAAKP,EAKjB,OAAOmO,GAoBR,QAASkd,GAAIvgB,EAAM9K,GAClB,GAAIG,GAAGm7C,EAAU+xB,EAAah+D,EAAOi+D,CAErC,IAAIxiE,EAGH,IAFAuE,EAAQvE,EAAK2H,cAAczR,MAAM,KACjCb,EAAIkP,EAAMjP,OACHD,KAAK,CAKX,GAJA2K,EAAOuE,EAAMlP,GACbm7C,EAAW4xB,EAASpiE,IAGfA,EAAM,CACV,IAAKuiE,IAAeH,GACnBE,EAAYC,GAAa,SAClBH,GAASG,EAGjB,OAAOl/D,GAGR,GAAImtC,EAAU,CAEb,GAAKt7C,EAKJ,IADAstE,EAAKhyB,EAASl7C,OACPktE,KACFhyB,EAASgyB,GAAIllE,OAASpI,IACzBs7C,EAAWA,EAAS/0C,MAAM,EAAG+mE,GAAIn9D,OAAOmrC,EAAS/0C,MAAM+mE,EAAK,IAC5DJ,EAASpiE,GAAQwwC,OAPnBA,GAASl7C,OAAS,CAYdk7C,GAASl7C,SACbgtE,EAAYtiE,GAAM,SACXoiE,GAASpiE,SAIb,CACN,IAAKA,IAAQoiE,GACZE,EAAYtiE,GAAM,EAGnBoiE,MAGD,MAAO/+D,GAiBR,QAASg/D,GAAKriE,EAAM9K,EAAUkqB,GAC7B,MAAOkB,GAAGtgB,EAAM9K,EAAUkqB,GAAUijD,MAAM,IAU3C,QAASzsD,GAAI5V,GAEZ,MADAA,GAAOA,EAAK2H,iBACFy6D,EAASpiE,IAAmC,IAA1BoiE,EAASpiE,GAAM1K,QA5O5C,GAAiBuO,GAAsBy+D,EAAnCj/D,EAAOjK,KAAagpE,IAUxBngD,GAAWA,MACXpe,EAAQoe,EAASpe,OAASR,EAC1Bi/D,EAAcrgD,EAASqgD,aAAevhE,EAoOtCsC,EAAKiC,KAAOA,EACZjC,EAAKid,GAAKA,EACVjd,EAAKkd,IAAMA,EACXld,EAAKg/D,KAAOA,EACZh/D,EAAKuS,IAAMA,EA7PZ,GAAI6sD,GAAetnD,EAAMtB,QACxB,mVAIA,IAuQD,OAJAqoD,GAAWQ,SAAW,SAAS1iE,GAC9B,QAASyiE,EAAaziE,EAAK2H,gBAGrBu6D,IAsBRvsE,EAAO,0BAA4B,WAQlC,QAASgtE,GAAQ1gD,GAChB7oB,KAAKlC,OAAS+qB,EAAS/qB,OAmDxB,MAxCAyrE,GAAQzrE,OAAS,SAAS0rE,EAAO5iE,GAChC,MAAO,IAAI2iE,IACVzrE,OAAQ,SAAS2rE,EAAYC,GAG5B,QAASC,GAAgB5oE,GACxB0oE,EAAWxkD,IAAIykD,EAAW3oE,EAAEQ,OAG7B,QAASqoE,GAAgB7oE,GACxByoE,EAAMvkD,IAAIre,EAAM7F,EAAEQ,OAPnB,GAAIynE,EAgCJ,OAtBAS,GAAWviD,GAAG,UAAYwiD,EAAWE,GACrCJ,EAAMtiD,GAAG,UAAYtgB,EAAM+iE,GAG3BX,EAAWS,EAAWI,UAEjBb,IACJA,EAAWS,EAAWI,aAEtBJ,EAAWviD,GAAG,UAAW,WAGxB,IAFA,GAAIjrB,GAAI+sE,EAAS9sE,OAEVD,KACN+sE,EAAS/sE,QAKZ+sE,EAAS3sE,KAAK,WACbmtE,EAAMriD,IAAI,UAAYvgB,EAAM+iE,KAGtBH,EAAMxkD,IAAIpe,OAKb2iE,IAoBRhtE,EAAO,2BACN,gCACE,SAASutE,GACX,QAASC,GAAmB5qD,GAY3B,MAXKA,GAAI6qD,mBACR7qD,EAAI6qD,iBAAmB,GAAIF,IAC1Br/D,MAAO0U,EACP+pD,YAAa,SAAStiE,EAAMmgB,GACvB+iD,EAAgBR,SAAS1iE,IAASuY,EAAI8qD,mBACzC9qD,EAAI8qD,kBAAkBrjE,EAAMmgB,OAMzB5H,EAAI6qD,iBAGZ,OAYC99D,KAAM,SAAStF,EAAMxE,EAAM8nE,GAC1B,GAAIjgE,GAAOjK,IAGX,IAAIiK,EAAKnG,SAAoB,WAAT8C,EACnB,MAAOxE,EAMR,IAHAA,EAAO2nE,EAAmB9/D,GAAMiC,KAAKtF,EAAMxE,EAAM8nE,GAG7CA,KAAW,GAASjgE,EAAKoO,OAE5B,IADA,GAAIA,GAASpO,EAAKoO,SACXA,IAAWjW,EAAK+G,wBACtBkP,EAAOnM,KAAKtF,EAAMxE,GAAM,GACxBiW,EAASA,EAAOA,QAIlB,OAAOjW,IAgBR8kB,GAAI,SAAStgB,EAAM9K,EAAUkqB,GAC5B,MAAO+jD,GAAmB/pE,MAAMknB,GAAGtgB,EAAM9K,EAAUkqB,IAoBpDmB,IAAK,SAASvgB,EAAM9K,GACnB,MAAOiuE,GAAmB/pE,MAAMmnB,IAAIvgB,EAAM9K,IAW3CmtE,KAAM,SAASriE,EAAM9K,GACpB,MAAOiuE,GAAmB/pE,MAAMipE,KAAKriE,EAAM9K,IAU5CquE,kBAAmB,SAASvjE,GAC3B,MAAOmjE,GAAmB/pE,MAAMwc,IAAI5V,OAuBvCrK,EAAO,iCACN,uBACA,0BACA,qBACA,sBACE,SAASgtE,EAASa,EAAYrC,EAAOhmD,GACvC,QAASsoD,GAAOnyD,GACf,MAAOA,GAAK3M,SAAW,EAIxB,QAAS08B,GAAQz3B,EAAGC,GACnB,GAAIg3D,GAAGlqD,CAGP,IAAI/M,IAAMC,EACT,OAAO,CAIR,IAAU,OAAND,GAAoB,OAANC,EACjB,MAAOD,KAAMC,CAId,IAAiB,gBAAND,IAA+B,gBAANC,GACnC,MAAOD,KAAMC,CAId,IAAIsR,EAAMjgB,QAAQ2O,GAAI,CACrB,GAAID,EAAEtU,SAAWuU,EAAEvU,OAClB,OAAO,CAIR,KADAurE,EAAIj3D,EAAEtU,OACCurE,KACN,IAAKx/B,EAAQz3B,EAAEi3D,GAAIh3D,EAAEg3D,IACpB,OAAO,EAMV,GAAI4C,EAAO75D,IAAM65D,EAAO55D,GACvB,MAAOD,KAAMC,CAId8M,KACA,KAAKkqD,IAAKh3D,GAAG,CACZ,IAAKw3B,EAAQz3B,EAAEi3D,GAAIh3D,EAAEg3D,IACpB,OAAO,CAGRlqD,GAAQkqD,IAAK,EAGd,IAAKA,IAAKj3D,GACT,IAAK+M,EAAQkqD,KAAOx/B,EAAQz3B,EAAEi3D,GAAIh3D,EAAEg3D,IACnC,OAAO,CAIT,QAAO,EAGR,MAAOM,GAAM1mD,QACZ+mD,QAASgC,GAQT9mD,KAAM,SAAS5b,GACd,GAAId,GAAMrF,CAEVmG,GAAOA,KAEP,KAAKd,IAAQc,GACZnG,EAAQmG,EAAKd,GAETrF,YAAiBgoE,KACpB7hE,EAAKd,GAAQrF,EAAMzD,OAAOkC,KAAM4G,GAIlC5G,MAAK0H,KAAOA,GAYbud,IAAK,SAASre,EAAMrF,GACnB,GAAIiO,GAAKpN,EAAMkoE,EAAWtqE,KAAK0H,KAAKd,EAMpC,IAJIrF,YAAiBgoE,KACpBhoE,EAAQA,EAAMzD,OAAOkC,KAAM4G,IAGR,gBAATA,GAAmB,CAC7B,IAAK4I,IAAO5I,GACX5G,KAAKilB,IAAIzV,EAAK5I,EAAK4I,GAGpB,OAAOxP,MAiBR,MAdKioC,GAAQqiC,EAAU/oE,KACtBvB,KAAK0H,KAAKd,GAAQrF,EAElBa,GACCxF,OAAQoD,KACR4G,KAAMA,EACNrF,MAAOA,EACP+oE,SAAUA,GAGXtqE,KAAKkM,KAAK,UAAYtF,EAAMxE,GAC5BpC,KAAKkM,KAAK,SAAU9J,IAGdpC,MAURglB,IAAK,SAASpe,GACb,MAAO5G,MAAK0H,KAAKd,IAUlB4V,IAAK,SAAS5V,GACb,MAAOA,KAAQ5G,MAAK0H,MAWrB9H,KAAM,SAASgH,GACd,MAAO2iE,GAAQzrE,OAAOkC,KAAM4G,IAS7B4F,QAAS,WACRxM,KAAKkM,KAAK,gBA8Cb3P,EAAO,uBACN,sBACE,SAASwrE,GAYX,QAASjjD,GAAO1F,GAGf,IAFA,GAAwCM,GAApC6qD,KAAkBtuE,EAAImjB,EAAMljB,OAEzBD,KACNyjB,EAAON,EAAMnjB,GAERyjB,EAAK8qD,YACTD,EAAYluE,KAAKqjB,GACjBA,EAAK8qD,UAAY,EAKnB,KADAvuE,EAAIsuE,EAAYruE,OACTD,WACCsuE,GAAYtuE,GAAGuuE,SAGvB,OAAOD,GAGR,GAMCE,GANGC,EAAa,0GAIbC,EAAU,sIACbC,EAAa,aAGVC,EAAW9C,EAAM1mD,QAQpBiC,KAAM,SAASpW,GAGd,QAAS49D,GAAkBlkE,GAC1B,GAAIA,EAGH,MAFAA,GAAOA,EAAK2H,cAEL,SAASmR,GACf,MAAgB,MAAT9Y,GAAgB8Y,EAAKxX,OAAStB,GAKxC,QAASmkE,GAAgBvuE,GACxB,GAAIA,EACH,MAAO,UAASkjB,GACf,MAAOA,GAAKsrD,QAAUxuE,GAKzB,QAASyuE,GAAqBlf,GAC7B,GAAIA,EAGH,MAFAA,GAAUA,EAAQjvD,MAAM,KAEjB,SAAS4iB,GAGf,IAFA,GAAIzjB,GAAI8vD,EAAQ7vD,OAETD,KACN,IAAKyjB,EAAKqsC,QAAQngD,SAASmgD,EAAQ9vD,IAClC,OAAO,CAIT,QAAO,GAKV,QAASivE,GAAkBtkE,EAAMukE,EAAK1vD,GACrC,GAAI7U,EACH,MAAO,UAAS8Y,GACf,GAAIne,GAAQme,EAAK9Y,GAAQ8Y,EAAK9Y,KAAU,EAExC,OAAQukE,GACC,MAARA,EAAc5pE,IAAUka,EAChB,OAAR0vD,EAAe5pE,EAAMqE,QAAQ6V,IAAU,EAC/B,OAAR0vD,GAAgB,IAAM5pE,EAAQ,KAAKqE,QAAQ,IAAM6V,EAAQ,MAAQ,EACzD,OAAR0vD,EAAe5pE,GAASka,EAChB,OAAR0vD,EAAwC,IAAzB5pE,EAAMqE,QAAQ6V,GACrB,OAAR0vD,GAAe5pE,EAAMmqB,OAAOnqB,EAAMrF,OAASuf,EAAMvf,UAAYuf,IAN9CA,GAYnB,QAAS2vD,GAAoBxkE,GAC5B,GAAIykE,EAEJ,IAAIzkE,EAGH,MAFAA,GAAO,wBAAwBjB,KAAKiB,GAE/BA,EAAK,IAcVykE,EAAeC,EAAY1kE,EAAK,OAEzB,SAAS8Y,GACf,OAAQ1Z,EAAM0Z,EAAM2rD,MAhBpBzkE,EAAOA,EAAK,GAEL,SAAS8Y,EAAMC,EAAOzjB,GAC5B,MAAgB,UAAT0K,EAA6B,IAAV+Y,EAChB,SAAT/Y,EAAkB+Y,IAAUzjB,EAAS,EAC5B,SAAT0K,EAAkB+Y,EAAQ,IAAM,EACvB,QAAT/Y,EAAiB+Y,EAAQ,IAAM,IAC/BD,EAAK9Y,IAAQ8Y,EAAK9Y,OAcvB,QAASyO,GAAQnI,EAAUuR,EAAS8sD,GAGnC,QAAS3mD,GAAIhS,GACRA,GACH6L,EAAQpiB,KAAKuW,GAJf,GAAIszC,EAqBJ,OAZAA,GAAQwkB,EAAW/kE,KAAKuH,EAASwB,QAAQk8D,EAAY,KAErDhmD,EAAIkmD,EAAkB5kB,EAAM,KAC5BthC,EAAImmD,EAAgB7kB,EAAM,KAC1BthC,EAAIqmD,EAAqB/kB,EAAM,KAC/BthC,EAAIsmD,EAAkBhlB,EAAM,GAAIA,EAAM,GAAIA,EAAM,KAChDthC,EAAIwmD,EAAoBllB,EAAM,KAG9BznC,EAAQrC,SAAW8pC,EAAM,GACzBznC,EAAQ8sD,OAASA,EAEV9sD,EAIR,QAAS6sD,GAAYp+D,EAAU4N,GAC9B,GAAgBu9C,GAAO9zD,EAAStI,EAA5BiqD,IAEJ,GAIC,IAHAykB,EAAQhlE,KAAK,IACbpB,EAAUomE,EAAQhlE,KAAKuH,GAEnB3I,IACH2I,EAAW3I,EAAQ,GACnB2hD,EAAM7pD,KAAKkI,EAAQ,IAEfA,EAAQ,IAAI,CACf8zD,EAAQ9zD,EAAQ,EAChB,aAGMA,EAOT,KALI8zD,GACHiT,EAAYjT,EAAOv9C,GAGpB5N,KACKjR,EAAI,EAAGA,EAAIiqD,EAAMhqD,OAAQD,IACb,KAAZiqD,EAAMjqD,IACTiR,EAAS7Q,KAAKgZ,EAAQ6wC,EAAMjqD,MAAyB,MAAjBiqD,EAAMjqD,EAAI,IAMhD,OAFA6e,GAAUze,KAAK6Q,GAER4N,EA5IR,GAAI9U,GAAQhG,KAAKgG,KA+IjBhG,MAAKwrE,WAAaF,EAAYp+D,OAW/BlH,MAAO,SAASylE,EAAS3wD,GACxB,GAAI7e,GAAGqO,EAAGohE,EAAIC,EAAIz+D,EAAUnQ,EAAIw4C,EAAI92B,EAASkB,EAAOzjB,EAAQ8pC,EAAUt7B,EAAOgV,CAG7E,KADA5E,EAAYA,GAAa9a,KAAKwrE,WACzBvvE,EAAI,EAAGqO,EAAIwQ,EAAU5e,OAAQD,EAAIqO,EAAGrO,IAAK,CAM7C,IALAiR,EAAW4N,EAAU7e,GACrB0vE,EAAKz+D,EAAShR,OACdwjB,EAAO+rD,EACP/gE,EAAQ,EAEHghE,EAAKC,EAAK,EAAGD,GAAM,EAAGA,IAG1B,IAFAjtD,EAAUvR,EAASw+D,GAEZhsD,GAAM,CAEZ,GAAIjB,EAAQrC,OAGX,IAFA4pB,EAAWtmB,EAAKrH,SAASqI,QACzBf,EAAQzjB,EAAS8pC,EAAS9pC,OACnByjB,KACFqmB,EAASrmB,KAAWD,IAM1B,IAAK3iB,EAAK,EAAGw4C,EAAK92B,EAAQviB,OAAQa,EAAKw4C,EAAIx4C,IAC1C,IAAK0hB,EAAQ1hB,GAAI2iB,EAAMC,EAAOzjB,GAAS,CACtCa,EAAKw4C,EAAK,CACV,OAIF,GAAIx4C,IAAOw4C,EAAI,CACd7qC,GACA,OAIA,GAAIghE,IAAOC,EAAK,EACf,KAIFjsD,GAAOA,EAAKrH,SAKd,GAAI3N,IAAUihE,EACb,OAAO,EAIT,OAAO,GAUR72D,KAAM,SAASvK,GAGd,QAAS+xB,GAAQ5b,EAAOxT,EAAUyS,GACjC,GAAI1jB,GAAGqO,EAAGvN,EAAIw4C,EAAI71B,EAAMjB,EAAUvR,EAASyS,EAE3C,KAAK1jB,EAAI,EAAGqO,EAAIoW,EAAMxkB,OAAQD,EAAIqO,EAAGrO,IAAK,CAIzC,IAHAyjB,EAAOgB,EAAMzkB,GAGRc,EAAK,EAAGw4C,EAAK92B,EAAQviB,OAAQa,EAAKw4C,EAAIx4C,IAC1C,IAAK0hB,EAAQ1hB,GAAI2iB,EAAMzjB,EAAGqO,GAAI,CAC7BvN,EAAKw4C,EAAK,CACV,OAKF,GAAIx4C,IAAOw4C,EAEN51B,GAASzS,EAAShR,OAAS,EAC9BqI,EAAQlI,KAAKqjB,GAGTA,EAAKgB,OACR4b,EAAQ5c,EAAKgB,QAASxT,EAAUyS,EAAQ,OAGpC,IAAIlB,EAAQ8sD,OAClB,MAIG7rD,GAAKgB,OACR4b,EAAQ5c,EAAKgB,QAASxT,EAAUyS,IAjCnC,GAAkB1jB,GAAGqO,EAAjB/F,KAAoBuW,EAAY9a,KAAKwrE,UAsCzC,IAAIjhE,EAAUmW,MAAO,CACpB,IAAKzkB,EAAI,EAAGqO,EAAIwQ,EAAU5e,OAAQD,EAAIqO,EAAGrO,IACxCqgC,EAAQ/xB,EAAUmW,QAAS5F,EAAU7e,GAAI,EAItCqO,GAAI,IACP/F,EAAUugB,EAAOvgB,IAUnB,MALKkmE,KAEJA,EAAaI,EAASJ,YAGhB,GAAIA,GAAWlmE,KAIxB,OAAOsmE,KAwBRtuE,EAAO,yBACN,qBACA,sBACA,sBACE,SAASwlB,EAAO8oD,EAAU9C,GAG5B,GAAI0C,GAAYmB,EAAOvvE,EAAO0F,MAAME,UAAU5F,KAAMgG,EAAQN,MAAME,UAAUI,KA0Z5E,OAxZAupE,IAOC1vE,OAAQ,EASRonB,KAAM,SAAS5C,GACVA,GACH1gB,KAAK4kB,IAAIlE,IAWXkE,IAAK,SAASlE,GACb,GAAIzW,GAAOjK,IAaX,OAVK+hB,GAAMjgB,QAAQ4e,GAOlBrkB,EAAKC,MAAM2N,EAAMyW,GANbA,YAAiB+pD,GACpBxgE,EAAK2a,IAAIlE,EAAMxB,WAEf7iB,EAAK8E,KAAK8I,EAAMyW,GAMXzW,GAWRgb,IAAK,SAASvE,GACb,GAAoCzkB,GAAhCgO,EAAOjK,KAAMoB,EAAM6I,EAAK/N,MAM5B,KAJA+N,EAAK/N,OAAS,EACd+N,EAAK2a,IAAIlE,GAGJzkB,EAAIgO,EAAK/N,OAAQD,EAAImF,EAAKnF,UACvBgO,GAAKhO,EAGb,OAAOgO,IAUR2I,OAAQ,SAAS1F,GAChB,GAAiBjR,GAAGqO,EAAiBoV,EAAM1Z,EAAvCiE,EAAOjK,KAAYuE,IAcvB,KAXwB,gBAAb2I,IACVA,EAAW,GAAI29D,GAAS39D,GAExBlH,EAAQ,SAAS0Z,GAChB,MAAOxS,GAASlH,MAAM0Z,KAIvB1Z,EAAQkH,EAGJjR,EAAI,EAAGqO,EAAIL,EAAK/N,OAAQD,EAAIqO,EAAGrO,IACnCyjB,EAAOzV,EAAKhO,GAER+J,EAAM0Z,IACTnb,EAAQlI,KAAKqjB,EAIf,OAAO,IAAI+qD,GAAWlmE,IAWvBlC,MAAO,WACN,MAAO,IAAIooE,GAAWpoE,EAAM/F,MAAM0D,KAAMrD,aAUzCkhB,GAAI,SAAS8B,GACZ,MAAOA,QAAe3f,KAAKqC,MAAMsd,GAAS3f,KAAKqC,MAAMsd,GAAQA,EAAQ,IAUtEN,KAAM,SAASvjB,GAGd,MAFAimB,GAAM1C,KAAKrf,KAAMlE,GAEVkE,MASRkf,QAAS,WACR,MAAO6C,GAAM7C,QAAQlf,OAUtB4F,QAAS,SAASs1C,GAGjB,IAFA,GAAIjxC,GAAOjK,KAAM/D,EAAIgO,EAAK/N,OAEnBD,KACFgO,EAAKhO,KAAOi/C,IAKjB,MAAOj/C,IASR0mB,QAAS,WACR,MAAO,IAAI8nD,GAAW1oD,EAAM7C,QAAQlf,MAAM2iB,YAU3CI,SAAU,SAAS2b,GAClB,QAAO1+B,KAAK,IAAKA,KAAK,GAAG+rD,QAAQngD,SAAS8yB,IAW3Clb,KAAM,SAAS5c,EAAMrF,GACpB,GAAiBsG,GAAO6X,EAApBzV,EAAOjK,IAEX,OAAIuB,KAAUsG,GACboC,EAAKoV,KAAK,SAASK,GACdA,EAAK9Y,IACR8Y,EAAK9Y,GAAMrF,KAIN0I,IAGRyV,EAAOzV,EAAK,GAERyV,GAAQA,EAAK9Y,GACT8Y,EAAK9Y,KADb,SAcDjB,KAAM,SAASiB,GACd,GAAIqD,GAAOjK,KAAMoC,EAAO2f,EAAM7C,QAAQviB,WAAW0F,MAAM,EAQvD,OANA4H,GAAKoV,KAAK,SAASK,GACdA,EAAK9Y,IACR8Y,EAAK9Y,GAAMtK,MAAMojB,EAAMtd,KAIlB6H,GASR4b,OAAQ,WAGP,IAFA,GAAI5pB,GAAI+D,KAAK9D,OAEND,KACN+D,KAAK/D,GAAG4pB,QAGT,OAAO7lB,OAUR4mB,SAAU,SAAS8X,GAClB,MAAO1+B,MAAKqf,KAAK,SAASK,GACzBA,EAAKqsC,QAAQnnC,IAAI8Z,MAWnB5X,YAAa,SAAS4X,GACrB,MAAO1+B,MAAKqf,KAAK,SAASK,GACzBA,EAAKqsC,QAAQlmC,OAAO6Y,OA2GvB3c,EAAM1C,KAAK,2DAA2DviB,MAAM,KAAM,SAAS8J,GAC1FglE,EAAMhlE,GAAQ,WACb,GAAIxE,GAAO2f,EAAM7C,QAAQviB,UAQzB,OANAqD,MAAKqf,KAAK,SAAS67B,GACdt0C,IAAQs0C,IACXA,EAAKt0C,GAAMtK,MAAM4+C,EAAM94C,KAIlBpC,QAKT+hB,EAAM1C,KAAK,uEAAuEviB,MAAM,KAAM,SAAS8J,GACtGglE,EAAMhlE,GAAQ,SAASrF,GACtB,MAAOvB,MAAKwjB,KAAK5c,EAAMrF,MAKzBkpE,EAAa1C,EAAM1mD,OAAOuqD,GAG1Bf,EAASJ,WAAaA,EAEfA,IAqBRluE,EAAO,uBACN,qBACA,wBACE,SAASwlB,EAAO+X,GAGlB,GAAIpvB,GAAQ,CAEZ,QACClO,GAAI,WACH,MAAO,QAAWkO,KAGnB5M,OAAQ,SAAS8I,EAAMuJ,EAAO7D,GAC7B,GAAIiZ,GAAM7hB,SAASsM,cAAcpJ,EAcjC,OAZAkzB,GAASwE,IAAIvB,WAAWxX,EAAKpV,GAEL,gBAAb7D,GACViZ,EAAIxM,UAAYzM,EAEhByV,EAAM1C,KAAK/S,EAAU,SAASmgB,GACzBA,EAAMlhB,UACTga,EAAIhN,YAAYkU,KAKZlH,GAGRpD,eAAgB,SAASC,GACxB,MAAO0X,GAASwE,IAAInc,eAAeC,IAGpCypD,cAAe,WACd,MAAO/xC,GAASwE,IAAIhD,eAGrBU,QAAS,SAASzW,GACjB,GAAI9lB,GAAOC,CAEX,IAAI6lB,EAAImC,sBAAuB,CAC9B,GAAItqB,GAAOmoB,EAAImC,uBAEfjoB,GAAQE,KAAKjB,IAAItB,EAAKqC,OAAUrC,EAAKitB,MAAQjtB,EAAKmC,KAAOgmB,EAAI2W,aAC7Dx8B,EAASC,KAAKjB,IAAItB,EAAKsC,QAAWtC,EAAKktB,OAASltB,EAAKktB,OAAS/E,EAAI4W,kBAElE18B,GAAQ8lB,EAAI2W,YACZx8B,EAAS6lB,EAAI4W,YAGd,QAAQ18B,MAAOA,EAAOC,OAAQA,IAG/Bq8B,OAAQ,SAASxW,EAAKxI,GACrB,MAAO+c,GAASwE,IAAIvC,OAAOxW,EAAKxI,IAGjCue,YAAa,SAAS7xB,GACrB,MAAOqwB,GAASwE,IAAIhD,YAAY7xB,IAGjCub,IAAK,SAASxoB,GACb,MAAOkH,UAASuK,eAAezR,IAGhCoqB,SAAU,SAASrB,EAAKmZ,GACvB,MAAO5E,GAASwE,IAAI1X,SAASrB,EAAKmZ,IAGnC5X,YAAa,SAASvB,EAAKmZ,GAC1B,MAAO5E,GAASwE,IAAIxX,YAAYvB,EAAKmZ,IAGtC3b,SAAU,SAASwC,EAAKmZ,GACvB,MAAO5E,GAASwE,IAAIvb,SAASwC,EAAKmZ,IAGnC7X,YAAa,SAAStB,EAAKmZ,EAAK3X,GAC/B,MAAO+S,GAASwE,IAAIzX,YAAYtB,EAAKmZ,EAAK3X,IAG3C5B,IAAK,SAASI,EAAK3e,EAAMrF,GACxB,MAAOu4B,GAASwE,IAAIlB,SAAS7X,EAAK3e,EAAMrF,IAGzCuqE,gBAAiB,SAASvmD,EAAK3e,GAC9B,MAAOkzB,GAASwE,IAAIrC,SAAS1W,EAAK3e,GAAM,IAGzCsgB,GAAI,SAAStqB,EAAQgK,EAAM9K,EAAU2O,GACpC,MAAOqvB,GAASwE,IAAI1+B,KAAKhD,EAAQgK,EAAM9K,EAAU2O,IAGlD0c,IAAK,SAASvqB,EAAQgK,EAAM9K,GAC3B,MAAOg+B,GAASwE,IAAIxyB,OAAOlP,EAAQgK,EAAM9K,IAG1CoQ,KAAM,SAAStP,EAAQgK,EAAMxE,GAC5B,MAAO03B,GAASwE,IAAIpyB,KAAKtP,EAAQgK,EAAMxE,IAGxC2pE,UAAW,SAASxmD,EAAKnD,GAExB0X,EAASwE,IAAItB,QAAQzX,EAAKnD,OAuB7B7lB,EAAO,yBACJ,WAGF,OASCyvE,SAAU,SAASzqE,GAClB,GAAIH,GAAK6xB,EAAQ,EAEjB,IAAK1xB,EAIL,MAAqB,gBAAVA,IACVA,EAAQA,GAAS,GAGhB/B,IAAK+B,EACLhC,KAAMgC,EACN+oB,OAAQ/oB,EACR8oB,MAAO9oB,KAITA,EAAQA,EAAMzE,MAAM,KACpBsE,EAAMG,EAAMrF,OAEA,IAARkF,EACHG,EAAM,GAAKA,EAAM,GAAKA,EAAM,GAAKA,EAAM,GACrB,IAARH,GACVG,EAAM,GAAKA,EAAM,GACjBA,EAAM,GAAKA,EAAM,IACC,IAARH,IACVG,EAAM,GAAKA,EAAM,KAIjB/B,IAAK2pB,SAAS5nB,EAAM,GAAI0xB,IAAU,EAClC5I,MAAOlB,SAAS5nB,EAAM,GAAI0xB,IAAU,EACpC3I,OAAQnB,SAAS5nB,EAAM,GAAI0xB,IAAU,EACrC1zB,KAAM4pB,SAAS5nB,EAAM,GAAI0xB,IAAU,KAIrCg5C,WAAY,SAAS1mD,EAAK2E,GACzB,QAAS+R,GAASr1B,GACjB,GAAIuF,GAAczI,SAASyI,WAE3B,OAAIA,IAEHvF,EAAOA,EAAK8H,QAAQ,SAAU,SAAS8B,GACtC,MAAO,IAAMA,IAGPrE,EAAYuZ,iBAAiBH,EAAK,MAAMI,iBAAiB/e,IAG1D2e,EAAIK,aAAahf,GAGzB,QAASslE,GAAQtlE,GAChB,GAAIrE,GAAMypD,WAAW/vB,EAASr1B,GAAO,GAErC,OAAOulE,OAAM5pE,GAAO,EAAIA,EAGzB,OACC/C,IAAK0sE,EAAQhiD,EAAS,YACtBG,MAAO6hD,EAAQhiD,EAAS,cACxBI,OAAQ4hD,EAAQhiD,EAAS,eACzB3qB,KAAM2sE,EAAQhiD,EAAS,kBAwB3B3tB,EAAO,wBACN,sBACE,SAASwlB,GAGX,QAAS+uB,MAUT,QAASs7B,GAAUC,GAClBrsE,KAAK0+B,OACL1+B,KAAK0+B,IAAI4tC,QACTtsE,KAAKqsE,SAAWA,GAAYv7B,EAC5B9wC,KAAKkqB,OAAS,GAgHf,MA7GAnI,GAAMV,OAAO+qD,EAAUnqE,WAQtB2iB,IAAK,SAAS8Z,GAOb,MANIA,KAAQ1+B,KAAK4L,SAAS8yB,KACzB1+B,KAAK0+B,IAAI4tC,KAAK5tC,IAAO,EACrB1+B,KAAK0+B,IAAIriC,KAAKqiC,GACd1+B,KAAKusE,WAGCvsE,MAUR6lB,OAAQ,SAAS6Y,GAChB,GAAI1+B,KAAK4L,SAAS8yB,GAAM,CACvB,IAAK,GAAIziC,GAAI,EAAGA,EAAI+D,KAAK0+B,IAAIxiC,QACxB8D,KAAK0+B,IAAIziC,KAAOyiC,EADgBziC,KAMrC+D,KAAK0+B,IAAI/qB,OAAO1X,EAAG,SACZ+D,MAAK0+B,IAAI4tC,KAAK5tC,GACrB1+B,KAAKusE,UAGN,MAAOvsE,OAWRmzD,OAAQ,SAASz0B,EAAK3X,GACrB,GAAIylD,GAAWxsE,KAAK4L,SAAS8yB,EAY7B,OAVI8tC,KAAazlD,IACZylD,EACHxsE,KAAK6lB,OAAO6Y,GAEZ1+B,KAAK4kB,IAAI8Z,GAGV1+B,KAAKusE,WAGCvsE,MAUR4L,SAAU,SAAS8yB,GAClB,QAAS1+B,KAAK0+B,IAAI4tC,KAAK5tC,IAUxB6tC,QAAS,iBACDvsE,MAAKysE,SACZzsE,KAAKqsE,SAASlrE,KAAKnB,SAKrBosE,EAAUnqE,UAAUC,SAAW,WAC9B,GAAIX,EAEJ,IAAIvB,KAAKysE,SACR,MAAOzsE,MAAKysE,QAGblrE,GAAQ,EACR,KAAK,GAAItF,GAAI,EAAGA,EAAI+D,KAAK0+B,IAAIxiC,OAAQD,IAChCA,EAAI,IACPsF,GAAS,KAGVA,GAASvB,KAAKkqB,OAASlqB,KAAK0+B,IAAIziC,EAGjC,OAAOsF,IAGD6qE,IAuBR7vE,EAAO,0BACN,sBACE,SAASkK,GACX,GAAqBimE,GAAjBC,IAEJ,QAQC/nD,IAAK,SAASs2B,GACb,GAAI7iC,GAAS6iC,EAAK7iC,QAElB,IAAIA,EAAQ,CACX,IAAKA,EAAOu0D,SAAWv0D,EAAOu0D,QAAQtD,WACrC,MAGIqD,GAAWt0D,EAAOw0D,OACtBF,EAAWt0D,EAAOw0D,KAAOx0D,GAGrBq0D,IACJA,GAA0B,EAE1BjmE,EAAM7D,sBAAsB,WAC3B,GAAIpG,GAAI0+C,CAERwxB,IAA0B,CAE1B,KAAKlwE,IAAMmwE,GACVzxB,EAAOyxB,EAAWnwE,GAEd0+C,EAAKn0B,MAAM/B,IAAI,aAClBk2B,EAAK4xB,QAIPH,OACEjpE,SAASC,SAYfkiB,OAAQ,SAASq1B,GACZyxB,EAAWzxB,EAAK2xB,YACZF,GAAWzxB,EAAK2xB,SA0B3BtwE,EAAO,sBACN,qBACA,qBACA,+BACA,gCACA,wBACA,sBACA,uBACA,sBACA,uBACA,0BACE,SAASwrE,EAAOhmD,EAAO+nD,EAAiBiD,EAAkBtC,EAAYrlB,EAAUtsB,EAAGk0C,EAAUZ,EAAWa,GAqlC1G,QAASlD,GAAmB5qD,GAoB3B,MAnBKA,GAAI6qD,mBACR7qD,EAAI6qD,iBAAmB,GAAIF,IAC1Br/D,MAAO0U,EACP+pD,YAAa,SAAStiE,EAAMmgB,GACvBA,GAAS+iD,EAAgBR,SAAS1iE,KAChCuY,EAAI+tD,gBACR/tD,EAAI+tD,kBAGL/tD,EAAI+tD,cAActmE,IAAQ,EAEtBuY,EAAI4H,MAAM/B,IAAI,aACjBmoD,EAAkBhuD,QAOhBA,EAAI6qD,iBAGZ,QAASmD,GAAkBC,GAG1B,QAASC,GAAStsE,GACjB,GAAI0qE,GAAU2B,EAAUE,cAAcvsE,EAAEnE,OAEpC6uE,IACHA,EAAQv/D,KAAKnL,EAAEmH,KAAMnH,GAIvB,QAASwsE,KACR,GAAIryB,GAAOsyB,EAAcC,cAErBvyB,KACHA,EAAKhvC,KAAK,cAAetP,OAAQs+C,EAAKwyB,UAEtCxyB,EAAKtzB,UAAUvI,KAAK,SAAS67B,GAC5BA,EAAKhvC,KAAK,cAAetP,OAAQs+C,EAAKwyB,YAGvCF,EAAcC,eAAiB,MAIjC,QAASE,GAAkB5sE,GAC1B,GAAgG9E,GAAG2rB,EAASgmD,EAAxG1yB,EAAOkyB,EAAUE,cAAcvsE,EAAEnE,QAASixE,EAAWL,EAAcC,eAAgBpxD,EAAM,CAG7F,IAAI6+B,IAAS2yB,EAAU,CAMtB,GALAL,EAAcC,eAAiBvyB,EAE/BtzB,EAAUszB,EAAKtzB,UAAU1I,UAAUyD,UACnCiF,EAAQvrB,KAAK6+C,GAET2yB,EAAU,CAIb,IAHAD,EAAcC,EAASjmD,UAAU1I,UAAUyD,UAC3CirD,EAAYvxE,KAAKwxE,GAEZxxD,EAAM,EAAGA,EAAMuxD,EAAY1xE,QAC3B0rB,EAAQvL,KAASuxD,EAAYvxD,GADMA,KAMxC,IAAKpgB,EAAI2xE,EAAY1xE,OAAS,EAAGD,GAAKogB,EAAKpgB,IAC1C4xE,EAAWD,EAAY3xE,GACvB4xE,EAAS3hE,KAAK,cACbtP,OAAQixE,EAASH,UAKpB,IAAKzxE,EAAIogB,EAAKpgB,EAAI2rB,EAAQ1rB,OAAQD,IACjCi/C,EAAOtzB,EAAQ3rB,GACfi/C,EAAKhvC,KAAK,cACTtP,OAAQs+C,EAAKwyB,WAMjB,QAASI,GAAc/sE,GACtBA,EAAEgI,iBAEY,cAAVhI,EAAEmH,MACLnH,EAAEs8C,aAAmBt8C,EAAEgtE,WAEnBhtE,EAAEitE,cACLjtE,EAAEq8C,aAAmBr8C,EAAEitE,eAGxBjtE,EAAEq8C,OAAS,EACXr8C,EAAEs8C,OAASt8C,EAAEktE,QAGdltE,EAAIqsE,EAAUlhE,KAAK,QAASnL,GA3E7B,GAAI9E,GAAGqO,EAAGsd,EAAS4lD,EAAenE,EAAcziE,CA+EhD,IADAyiE,EAAe+D,EAAUF,cACP,CAIjB,IAFAtlD,EAAUwlD,EAAUxlD,UAAU1I,UAC9B0I,EAAQ7N,QAAQqzD,GACXnxE,EAAI,EAAGqO,EAAIsd,EAAQ1rB,QAASsxE,GAAiBvxE,EAAIqO,EAAGrO,IACxDuxE,EAAgB5lD,EAAQ3rB,GAAGiyE,WAU5B,KANKV,IACJA,EAAgB5lD,EAAQA,EAAQ1rB,OAAS,IAAMkxE,GAIhDA,EAAUc,YAAcV,EACnBljE,EAAIrO,EAAGA,EAAI,EAAGA,EAAIqO,EAAGrO,IACzB2rB,EAAQ3rB,GAAGiyE,YAAcV,CAG1B,IAAIW,GAAqBX,EAAcY,UAClCD,KACJA,EAAqBX,EAAcY,cAIpC,KAAKxnE,IAAQyiE,GAAc,CAC1B,IAAKA,EACJ,OAAO,CAGK,WAATziE,GAAqBynE,GAWZ,eAATznE,GAAkC,eAATA,EAEvB4mE,EAAcc,iBAClBx1C,EAAE00C,EAAcE,SAASxmD,GAAG,aAAcqmD,GAAmBrmD,GAAG,YAAaymD,GAC7EH,EAAcc,eAAiB,GAErBH,EAAmBvnE,KAC9BkyB,EAAE00C,EAAcE,SAASxmD,GAAGtgB,EAAMymE,GAClCc,EAAmBvnE,IAAQ,GAI5ByiE,EAAaziE,IAAQ,GAtBhB2nE,EACHz1C,EAAEs0C,EAAUM,SAASxmD,GAAG,aAAc4mD,GAEtCh1C,EAAEs0C,EAAUM,SAASxmD,GAAG,iBAAkB4mD,KA3tC/C,GAGIU,GAHAD,EAA4B,gBAAkB7qE,UAC9C2qE,GAAuB,EACvBI,EAAc,OACLC,EAAY,EAErB9C,GACHhD,SACC6F,YAAaA,GAGdE,MAAO,WACN,MAAOH,GAAQI,KAShBH,YAAaA,EAmBbnrD,KAAM,SAASuF,GAGd,QAASgmD,GAAa9iB,GACrB,GAAI9vD,EAGJ,KADA8vD,EAAUA,EAAQjvD,MAAM,KACnBb,EAAI,EAAGA,EAAI8vD,EAAQ7vD,OAAQD,IAC/BgO,EAAK8hD,QAAQnnC,IAAImnC,EAAQ9vD,IAP3B,GAAiB8vD,GAAS+iB,EAAtB7kE,EAAOjK,IAWXiK,GAAK4e,SAAWA,EAAW9G,EAAMV,UAAWpX,EAAK4+D,SAAUhgD,GAG3D5e,EAAK4iE,IAAMhkD,EAASrsB,IAAO,QAAWkyE,IACtCzkE,EAAK8kE,OAASC,KAAMnmD,EAASmmD,MAC7B/kE,EAAKglE,aACLhlE,EAAK6uB,EAAIA,EAET7uB,EAAK8c,MAAQ,GAAIgmD,IAChBmC,SAAS,EACTC,QAAQ,EACR7xD,UAAU,EACV/b,MAAO,KAGR0I,EAAKvC,KAAO,GAAIqlE,GAAiBlkD,EAASnhB,MAE1CuC,EAAK8hD,QAAU,GAAIqgB,GAAU,WACxBniE,EAAK8c,MAAM/B,IAAI,cAClB/a,EAAKyjE,QAAQp1D,UAAYtY,KAAKkC,cAGhC+H,EAAK8hD,QAAQ7hC,OAASjgB,EAAKwkE,YAG3B1iB,EAAUljC,EAASkjC,QACfA,IACC9hD,EAAK4+D,WACRiG,EAAiB7kE,EAAK4+D,SAAS9c,QAE3B+iB,GAAkB/iB,GAAW+iB,GAChCD,EAAaC,IAIfD,EAAa9iB,IAGdhqC,EAAM1C,KAAK,gDAAgDviB,MAAM,KAAM,SAAS8J,GAC3EA,IAAQiiB,IACX5e,EAAKrD,GAAMiiB,EAASjiB,MAItBqD,EAAKid,GAAG,QAAS,WAChB,GAAIjd,EAAKqT,WACR,OAAO,IASTrT,EAAK4e,SAAWA,EAEhB5e,EAAKmlE,UAAYpC,EAAShB,SAASnjD,EAAS+C,QAC5C3hB,EAAKolE,WAAarC,EAAShB,SAASnjD,EAASymD,SAC7CrlE,EAAKslE,UAAYvC,EAAShB,SAASnjD,EAASk3B,QAExCl3B,EAAS2mD,QACZvlE,EAAKqd,QAKPohD,WAAY,cAQZ+G,gBAAiB,WAChB,MAAO/rE,UAASC,MAUjB2pE,cAAe,SAAS/nD,GAGvB,IAFA,GAAI21B,GAAM9nB,EAASpzB,KAAK46B,UAAU80C,gBAE3BnqD,GAAO6N,KACb8nB,EAAO9nB,EAAO7N,EAAI/oB,MAKlB+oB,EAAMA,EAAI1Z,UAGX,OAAOqvC,IAWRy0B,eAAgB,WACf,GAA2CP,GAAWQ,EAC9BnwE,EAAOC,EAAQmwE,EAAUC,EAAWC,EACxDC,EAAeC,EAAgBC,EAF/BjmE,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,SAC7BtD,EAAMtb,EAAKyjE,OAIf0B,GAAYnlE,EAAKmlE,UAAYnlE,EAAKmlE,WAAapC,EAASf,WAAW1mD,EAAK,UACxEtb,EAAKolE,WAAaplE,EAAKolE,YAAcrC,EAASf,WAAW1mD,EAAK,WAC9Dtb,EAAKslE,UAAYtlE,EAAKslE,WAAavC,EAASf,WAAW1mD,EAAK,UAC5D2qD,EAAc9qB,EAASppB,QAAQzW,GAG/ByqD,EAAgBnnD,EAASgnD,SACzBI,EAAiBpnD,EAASinD,UAC1BD,EAAWG,GAAiBE,EAAYzwE,MACxCqwE,EAAYG,GAAkBC,EAAYxwE,OAC1CD,EAAQopB,EAASppB,MACjBC,EAASmpB,EAASnpB,OAClBqwE,EAAalnD,EAASknD,WACtBA,EAAkC,mBAAdA,GAA4BA,GAActwE,IAAUC,EAExED,EAAQA,GAASowE,EACjBnwE,EAASA,GAAUowE,CAEnB,IAAIK,GAASf,EAAU7vE,KAAO6vE,EAAU/kD,MACpC+lD,EAAShB,EAAU5vE,IAAM4vE,EAAU9kD,OAEnC+lD,EAAOxnD,EAASynD,UAAY,MAC5BC,EAAO1nD,EAAS2nD,WAAa,KA0BjC,OAvBAvmE,GAAKwmE,YAAcb,GAClBryE,EAAGsrB,EAAStrB,GAAK,EACjBC,EAAGqrB,EAASrrB,GAAK,EACjBC,EAAGgC,EACH/B,EAAGgC,EACHywE,OAAQA,EACRC,OAAQA,EACRM,SAAUjxE,EAAQ0wE,EAClBQ,SAAUjxE,EAAS0wE,EACnBQ,OAAQnxE,EAAQ0wE,EAChBU,OAAQnxE,EAAS0wE,EACjBJ,cAAeA,GAAiB,EAChCC,eAAgBA,GAAkB,EAClCa,KAAMnxE,KAAKhB,IAAIkxE,EAAUQ,GACzBU,KAAMpxE,KAAKhB,IAAImxE,EAAWS,GAC1BF,KAAMA,EACNE,KAAMA,EACNR,WAAYA,EACZiB,QAAS,GAGV/mE,EAAKgnE,mBAEErB,GAURA,WAAY,SAASsB,GACpB,GAA6CC,GAAgB1oD,EAAM2oD,EAAYC,EAAaxpE,EAAOypE,EAA/FrnE,EAAOjK,KAAMuxE,EAAUtnE,EAAKwmE,WAQhC,OALKc,KACJA,EAAUtnE,EAAK0lE,kBAIZuB,GAEHE,EAAaG,EAAQpB,OACrBkB,EAAcE,EAAQnB,OAGlBc,EAAQ3zE,IAAMsK,IACjB0pE,EAAQh0E,EAAI2zE,EAAQ3zE,GAIjB2zE,EAAQ1zE,IAAMqK,IACjB0pE,EAAQ/zE,EAAI0zE,EAAQ1zE,GAIjB0zE,EAAQJ,OAASjpE,IACpB0pE,EAAQT,KAAOI,EAAQJ,MAIpBI,EAAQH,OAASlpE,IACpB0pE,EAAQR,KAAOG,EAAQH,MAIxBtoD,EAAOyoD,EAAQzzE,EACXgrB,IAAS5gB,IACZ4gB,EAAOA,EAAO8oD,EAAQT,KAAOS,EAAQT,KAAOroD,EAC5CA,EAAOA,EAAO8oD,EAAQlB,KAAOkB,EAAQlB,KAAO5nD,EAC5C8oD,EAAQ9zE,EAAIgrB,EACZ8oD,EAAQX,OAASnoD,EAAO2oD,GAIzB3oD,EAAOyoD,EAAQxzE,EACX+qB,IAAS5gB,IACZ4gB,EAAOA,EAAO8oD,EAAQR,KAAOQ,EAAQR,KAAOtoD,EAC5CA,EAAOA,EAAO8oD,EAAQhB,KAAOgB,EAAQhB,KAAO9nD,EAC5C8oD,EAAQ7zE,EAAI+qB,EACZ8oD,EAAQV,OAASpoD,EAAO4oD,GAIzB5oD,EAAOyoD,EAAQN,OACXnoD,IAAS5gB,IACZ4gB,EAAOA,EAAO8oD,EAAQT,KAAOM,EAAaG,EAAQT,KAAOM,EAAa3oD,EACtEA,EAAOA,EAAO8oD,EAAQlB,KAAOe,EAAaG,EAAQlB,KAAOe,EAAa3oD,EACtE8oD,EAAQX,OAASnoD,EACjB8oD,EAAQ9zE,EAAIgrB,EAAO2oD,GAIpB3oD,EAAOyoD,EAAQL,OACXpoD,IAAS5gB,IACZ4gB,EAAOA,EAAO8oD,EAAQR,KAAOM,EAAcE,EAAQR,KAAOM,EAAc5oD,EACxEA,EAAOA,EAAO8oD,EAAQhB,KAAOc,EAAcE,EAAQhB,KAAOc,EAAc5oD,EACxE8oD,EAAQV,OAASpoD,EACjB8oD,EAAQ7zE,EAAI+qB,EAAO4oD,GAIhBH,EAAQR,WAAa7oE,IACxB0pE,EAAQb,SAAWQ,EAAQR,UAIxBQ,EAAQP,WAAa9oE,IACxB0pE,EAAQZ,SAAWO,EAAQP,UAI5BQ,EAAiBlnE,EAAKgnE,gBAClBE,EAAe5zE,IAAMg0E,EAAQh0E,GAAK4zE,EAAe3zE,IAAM+zE,EAAQ/zE,GAClE2zE,EAAe1zE,IAAM8zE,EAAQ9zE,GAAK0zE,EAAezzE,IAAM6zE,EAAQ7zE,IAC/D4zE,EAAkB9C,EAAQ8C,gBAEtBA,GACCA,EAAgB3+D,MAAQ2+D,EAAgB3+D,IAAI1I,EAAK4iE,OACpDyE,EAAgBj1E,KAAK4N,GACrBqnE,EAAgB3+D,IAAI1I,EAAK4iE,MAAO,GAIlCsE,EAAe5zE,EAAIg0E,EAAQh0E,EAC3B4zE,EAAe3zE,EAAI+zE,EAAQ/zE,EAC3B2zE,EAAe1zE,EAAI8zE,EAAQ9zE,EAC3B0zE,EAAezzE,EAAI6zE,EAAQ7zE,GAGrBuM,GAGDsnE,GAQRC,QAAS,WACR,GAAiBhsD,GAAOisD,EAAWC,EAASt0E,EAAMgyE,EAC9CuC,EAASC,EAASC,EAAiBh0E,EAAO0D,EAD1C0I,EAAOjK,IAIXnC,GAAS6F,SAASq8B,YAA2B,SAASx+B,GACrD,MAAOA,IADwB5B,KAAK9B,MAIrC2nB,EAAQvb,EAAKyjE,QAAQloD,MACrBpoB,EAAO6M,EAAKwmE,YACZoB,EAAkB5nE,EAAK6nE,qBAEvB1C,EAAYnlE,EAAKmlE,UACjBuC,EAAUvC,EAAU7vE,KAAO6vE,EAAU/kD,MACrCunD,EAAUxC,EAAU5vE,IAAM4vE,EAAU9kD,OAEhCltB,EAAKG,IAAMs0E,EAAgBt0E,IAC9BioB,EAAMjmB,KAAO1B,EAAMT,EAAKG,GAAK,KAC7Bs0E,EAAgBt0E,EAAIH,EAAKG,GAGtBH,EAAKI,IAAMq0E,EAAgBr0E,IAC9BgoB,EAAMhmB,IAAM3B,EAAMT,EAAKI,GAAK,KAC5Bq0E,EAAgBr0E,EAAIJ,EAAKI,GAGtBJ,EAAKK,IAAMo0E,EAAgBp0E,IAC9B8D,EAAQ1D,EAAMT,EAAKK,EAAIk0E,GACvBnsD,EAAM/lB,OAAS8B,GAAS,EAAIA,EAAQ,GAAK,KACzCswE,EAAgBp0E,EAAIL,EAAKK,GAGtBL,EAAKM,IAAMm0E,EAAgBn0E,IAC9B6D,EAAQ1D,EAAMT,EAAKM,EAAIk0E,GACvBpsD,EAAM9lB,QAAU6B,GAAS,EAAIA,EAAQ,GAAK,KAC1CswE,EAAgBn0E,EAAIN,EAAKM,GAItBuM,EAAK8nE,UAAY30E,EAAKwzE,SAAWiB,EAAgBjB,SACpDrvE,EAAQ1D,EAAMT,EAAKwzE,QAEnBc,EAAUznE,EAAKyjE,MAAM,QACjBgE,IACHD,EAAYC,EAAQlsD,MACpBisD,EAAUhyE,OAAS8B,GAAS,EAAIA,EAAQ,GAAK,MAG9CswE,EAAgBjB,OAASxzE,EAAKwzE,QAG3B3mE,EAAK8nE,UAAY30E,EAAKyzE,SAAWgB,EAAgBhB,SACpDtvE,EAAQ1D,EAAMT,EAAKyzE,QAEnBa,EAAUA,GAAWznE,EAAKyjE,MAAM,QAC5BgE,IACHD,EAAYA,GAAaC,EAAQlsD,MACjCisD,EAAU/xE,QAAU6B,GAAS,EAAIA,EAAQ,GAAK,MAG/CswE,EAAgBhB,OAASzzE,EAAKyzE,QAG/B5mE,EAAK6nE,iBAAmBD,EACxB5nE,EAAKiC,KAAK,cAAe,IAM1B8lE,iBAAkB,WACjB,GAAI/nE,GAAOjK,IAEXiK,GAAKoO,SAAS45D,UAAY,KAE1B7sB,EAASjgC,IAAIlb,EAAKyjE,SAAUjuE,MAAO,GAAIC,OAAQ,KAE/CuK,EAAKwmE,YAAcxmE,EAAK6nE,iBAAmB7nE,EAAKgnE,gBAAkB,KAClEhnE,EAAK0lE,kBAcNzoD,GAAI,SAAStgB,EAAM9K,GAGlB,QAASo2E,GAAoBtrE,GAC5B,GAAI9K,GAAU2O,CAEd,OAAmB,gBAAR7D,GACHA,EAGD,SAAS7F,GAYf,MAXKjF,IACJmO,EAAKkoE,iBAAiB9yD,KAAK,SAAS67B,GACnC,GAAI/jB,GAAY+jB,EAAKryB,SAASsO,SAE9B,IAAIA,IAAcr7B,EAAWq7B,EAAUvwB,IAEtC,MADA6D,GAAQywC,GACD,IAKLp/C,EAMEA,EAASqF,KAAKsJ,EAAO1J,IAL3BA,EAAEqxE,OAASxrE,MACX5G,MAAKkM,KAAK,UAAWnL,KAvBxB,GAAIkJ,GAAOjK,IAiCX,OAFA+pE,GAAmB9/D,GAAMid,GAAGtgB,EAAMsrE,EAAoBp2E,IAE/CmO,GAaRkd,IAAK,SAASvgB,EAAM9K,GAEnB,MADAiuE,GAAmB/pE,MAAMmnB,IAAIvgB,EAAM9K,GAC5BkE,MAaRkM,KAAM,SAAStF,EAAMxE,EAAM8nE,GAC1B,GAAIjgE,GAAOjK,IAWX,IATAoC,EAAOA,MAEFA,EAAKqpE,UACTrpE,EAAKqpE,QAAUxhE,GAGhB7H,EAAO2nE,EAAmB9/D,GAAMiC,KAAKtF,EAAMxE,GAGvC8nE,KAAW,GAASjgE,EAAKoO,OAE5B,IADA,GAAIA,GAASpO,EAAKoO,SACXA,IAAWjW,EAAK+G,wBACtBkP,EAAOnM,KAAKtF,EAAMxE,GAAM,GACxBiW,EAASA,EAAOA,QAIlB,OAAOjW,IAUR+nE,kBAAmB,SAASvjE,GAC3B,MAAOmjE,GAAmB/pE,MAAMwc,IAAI5V,IAUrCghB,QAAS,SAAS1a,GACjB,GAAiBguC,GAAbjxC,EAAOjK,KAAY4nB,EAAU,GAAI6iD,EAGrC,KAAKvvB,EAAOjxC,EAAKoO,SAAU6iC,EAAMA,EAAOA,EAAK7iC,SAC5CuP,EAAQhD,IAAIs2B,EAQb,OAJIhuC,KACH0a,EAAUA,EAAQhV,OAAO1F,IAGnB0a,GAURuqD,eAAgB,SAASjlE,GACxB,MAAO,IAAIu9D,GAAWzqE,MAAM4kB,IAAI5kB,KAAK4nB,QAAQ1a,KAS9C2a,KAAM,WACL,GAAIwqD,GAAiBryE,KAAKqY,SAASqI,OAEnC,OAAO2xD,GAAeA,EAAezsE,QAAQ5F,MAAQ,IAStD8nB,KAAM,WACL,GAAIuqD,GAAiBryE,KAAKqY,SAASqI,OAEnC,OAAO2xD,GAAeA,EAAezsE,QAAQ5F,MAAQ,IAUtD+rE,UAAW,SAAS3pD,GAEnB,MADApiB,MAAKsyE,IAAIlwD,KAAKA,GACPpiB,MAUR0tE,MAAO,SAASvjD,GACf,GAAI3tB,GAAK2tB,EAASnqB,KAAK6sE,IAAM,IAAM1iD,EAASnqB,KAAK6sE,GAMjD,OAJK7sE,MAAKivE,UAAUzyE,KACnBwD,KAAKivE,UAAUzyE,GAAMs8B,EAAE,IAAMt8B,GAAI,IAG3BwD,KAAKivE,UAAUzyE,IASvB6qB,KAAM,WACL,MAAOrnB,MAAKkvE,SAAQ,IASrB5nD,KAAM,WACL,MAAOtnB,MAAKkvE,SAAQ,IASrBlyD,MAAO,WACN,IACChd,KAAK0tE,QAAQ1wD,QACZ,MAAOvb,IAIT,MAAOzB,OASRuyE,KAAM,WAGL,MAFAvyE,MAAK0tE,QAAQ6E,OAENvyE,MAWRwyE,KAAM,SAAS5rE,EAAMrF,GACpB,GAAI0I,GAAOjK,KAAMulB,EAAMtb,EAAKyjE,MAAMzjE,EAAKwoE,WAEvC,OAAqB,mBAAVlxE,GACH0I,EAAK8kE,MAAMnoE,IAGnBqD,EAAK8kE,MAAMnoE,GAAQrF,EAEf0I,EAAK8c,MAAM/B,IAAI,aAClBO,EAAI3W,aAAqB,QAARhI,EAAiBA,EAAO,QAAUA,EAAMrF,GAGnD0I,IAYR0gB,OAAQ,SAASlO,EAAMylD,GAKtB,MAJIA,MAAc,IACjBzlD,EAAOzc,KAAKkiE,UAAUzlD,KAGfA,GAAQ,IAAI/N,QAAQ,UAAW,SAAS1I,GAC/C,MAAO,KAAOA,EAAMswB,WAAW,GAAK,OAWtC4rC,UAAW,SAASzlD,GACnB,MAAO+xD,GAAQtM,UAAYsM,EAAQtM,UAAUzlD,GAAQA,GAUtDwJ,OAAQ,SAASvF,GAChB,GAAIzW,GAAOjK,KAAMqY,EAASpO,EAAKoO,QAM/B,OAJIA,IACHA,EAAO8xB,OAAOzpB,EAAOrI,EAAOqI,QAAQ9a,QAAQqE,IAAO,GAG7CA,GAURic,MAAO,SAASxF,GACf,GAAIzW,GAAOjK,KAAMqY,EAASpO,EAAKoO,QAM/B,OAJIA,IACHA,EAAO8xB,OAAOzpB,EAAOrI,EAAOqI,QAAQ9a,QAAQqE,IAGtCA,GASR4b,OAAQ,WACP,GAA6D6sD,GAAUz2E,EAAnEgO,EAAOjK,KAAMulB,EAAMtb,EAAKyjE,QAASr1D,EAASpO,EAAKoO,QAEnD,IAAIpO,EAAKyW,MAAO,CACf,GAAIiyD,GAAW1oE,EAAKyW,QAAQxB,SAE5B,KADAjjB,EAAI02E,EAASz2E,OACND,KACN02E,EAAS12E,GAAG4pB,SAIVxN,GAAUA,EAAOqI,QACpBgyD,KAEAr6D,EAAOqI,QAAQrB,KAAK,SAASK,GACxBA,IAASzV,GACZyoE,EAASr2E,KAAKqjB,KAIhBrH,EAAOqI,QAAQuE,IAAIytD,GACnBr6D,EAAO45D,UAAY,MAGhBhoE,EAAKikE,aAAejkE,EAAKikE,aAAejkE,GAC3C6uB,EAAEvT,GAAK4B,KAGR,IAAIiM,GAASnpB,EAAK2wB,UAAU80C,eAc5B,OAbIt8C,UACIA,GAAOnpB,EAAK4iE,KAGhBtnD,GAAOA,EAAI1Z,YACd0Z,EAAI1Z,WAAWoE,YAAYsV,GAG5Btb,EAAK8c,MAAM9B,IAAI,YAAY,GAC3Bhb,EAAK8c,MAAMva,UAEXvC,EAAKiC,KAAK,UAEHjC,GAUR2oE,aAAc,SAASrtD,GAGtB,MAFAuT,GAAEvT,GAAKU,OAAOjmB,KAAK6yE,cACnB7yE,KAAK8yE,aACE9yE,MAUR+yE,SAAU,SAASxtD,GAGlB,MAFAuT,GAAEvT,GAAOvlB,KAAKyvE,mBAAmB3pD,OAAO9lB,KAAK6yE,cAC7C7yE,KAAK8yE,aACE9yE,MAGRgzE,UAAW,aAGXC,OAAQ,aAGRJ,WAAY,WACX,MAAO,YAAc7yE,KAAK6sE,IAAM,YAAc7sE,KAAK+rD,QAAU,YAS9D+mB,WAAY,WACX,GAA2CvtD,GAAKiF,EAAKnS,EAAQzR,EAAMssE,EAA/DjpE,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,QAEjC5e,GAAKqoE,IAAMx5C,EAAE7uB,EAAKyjE,SAClBzjE,EAAK8c,MAAM9B,IAAI,YAAY,EAG3B,KAAKre,IAAQiiB,GACe,IAAvBjiB,EAAKhB,QAAQ,OAChBqE,EAAKid,GAAGtgB,EAAK8kB,OAAO,GAAI7C,EAASjiB,GAInC,IAAIqD,EAAKikE,YAAa,CACrB,IAAK71D,EAASpO,EAAKoO,UAAW66D,GAAoB76D,EAAQA,EAASA,EAAOA,SACzE66D,EAAmB76D,EAAO61D,WAG3B,IAAIgF,EACH,IAAKtsE,IAAQssE,GAAiBhG,cAC7BjjE,EAAKijE,cAActmE,IAAQ,EAK9BumE,EAAkBljE,GAEd4e,EAASrD,QACZD,EAAMtb,EAAKyjE,QACPnoD,IACHA,EAAI3W,aAAa,QAASia,EAASrD,OACnCD,EAAIC,MAAMkD,QAAUG,EAASrD,QAI3Bvb,EAAK4e,SAAS+C,SACjBpB,EAAMvgB,EAAKmlE,UACXnlE,EAAKqoE,IAAIntD,KACRguD,mBAAoB3oD,EAAIhrB,IACxB4zE,qBAAsB5oD,EAAIH,MAC1BgpD,sBAAuB7oD,EAAIF,OAC3BgpD,oBAAqB9oD,EAAIjrB,OAK3B,IAAIwd,GAAO9S,EAAK2wB,SACX7d,GAAK2yD,kBACT3yD,EAAK2yD,oBAGN3yD,EAAK2yD,gBAAgBzlE,EAAK4iE,KAAO5iE,CAEjC,KAAK,GAAIuF,KAAOvF,GAAK8kE,MACpB9kE,EAAKuoE,KAAKhjE,EAAKvF,EAAK8kE,MAAMv/D,GAGvBvF,GAAK8c,MAAM/B,IAAI,cAAe,IACjC/a,EAAKyjE,QAAQloD,MAAM84B,QAAU,QAG9Br0C,EAAKspE,aAELtpE,EAAK8c,MAAMG,GAAG,iBAAkB,SAASnmB,GACxC,GAAqByyE,GAAjBzsD,EAAQhmB,EAAEQ,KAEV0I,GAAK8c,MAAM/B,IAAI,cAClB/a,EAAKyjE,QAAQloD,MAAM84B,QAAUv3B,KAAU,EAAQ,OAAS,GAGxD9c,EAAKyjE,QAAQhmD,yBAId8rD,EAAavpE,EAAKoO,SACdm7D,IACHA,EAAWvB,UAAY,MAGxBhoE,EAAKiC,KAAK6a,EAAQ,OAAS,QAE3BkmD,EAAYroD,IAAI3a,KAGjBA,EAAKiC,KAAK,iBAAkB,IAG7BqnE,WAAY,aAUZjpB,eAAgB,SAASiY,GACxB,QAASkR,GAAUluD,EAAKgW,GACvB,GAAIh+B,GAAGC,EAAG6a,EAASkN,CAGnB,KADAhoB,EAAIC,EAAI,EACD6a,GAAUA,GAAUkjB,GAAWljB,EAAO9M,UAC5ChO,GAAK8a,EAAO4lB,YAAc;AAC1BzgC,GAAK6a,EAAO6lB,WAAa,EACzB7lB,EAASA,EAAO2lB,YAGjB,QAAQzgC,EAAGA,EAAGC,EAAGA,GAGlB,GACID,GAAGC,EAAGiC,EAAOC,EAAQg0E,EAAaC,EADlCpuD,EAAMvlB,KAAK0tE,QAAS9wC,EAAYrX,EAAI1Z,WAEpC3N,EAAMu1E,EAAUluD,EAAKqX,EAoBzB,OAlBAr/B,GAAIW,EAAIX,EACRC,EAAIU,EAAIV,EACRiC,EAAQ8lB,EAAI2W,YACZx8B,EAAS6lB,EAAI4W,aACbu3C,EAAc92C,EAAUjB,YACxBg4C,EAAe/2C,EAAUf,aAEZ,OAAT0mC,GACHhlE,GAAKm2E,EAAcj0E,EACnBjC,GAAKm2E,EAAej0E,GACD,UAAT6iE,IACVhlE,GAAMm2E,EAAc,EAAMj0E,EAAQ,EAClCjC,GAAMm2E,EAAe,EAAMj0E,EAAS,GAGrCk9B,EAAUn0B,WAAalL,EACvBq/B,EAAU/zB,UAAYrL,EAEfwC,MAGR46B,QAAS,WAGR,IAFA,GAAiBg5C,GAAb14B,EAAOl7C,KAAmB4nB,KAEvBszB,GAAM,CACZ,GAAIA,EAAK04B,YAAa,CACrBA,EAAc14B,EAAK04B,WACnB,OAGDhsD,EAAQvrB,KAAK6+C,GACb04B,EAAc14B,EACdA,EAAOA,EAAK7iC,SAGRu7D,IACJA,EAAc5zE,KAIf,KADA,GAAI/D,GAAI2rB,EAAQ1rB,OACTD,KACN2rB,EAAQ3rB,GAAG23E,YAAcA,CAG1B,OAAOA,IAcR9G,OAAQ,WACPG,EAAYpnD,OAAO7lB,KAEnB,IAAIqY,GAASrY,KAAKqY,QAKlB,OAJIA,GAAOu0D,UAAYv0D,EAAOu0D,QAAQtD,YACrCjxD,EAAOy0D,SAGD9sE,MAuPT,OAjLA+hB,GAAM1C,KAAK,2CAA2CviB,MAAM,KAAM,SAAS8J,GAC1EglE,EAAMhlE,GAAQ,SAASrF,GACtB,MAAyB,KAArB5E,UAAUT,OACN8D,KAAK+mB,MAAM/B,IAAIpe,IAGH,mBAATrF,IACVvB,KAAK+mB,MAAM9B,IAAIre,EAAMrF,GAGfvB,SAITwuE,EAAUzG,EAAM1mD,OAAOuqD,KA4LxBrvE,EAAO,wBAA0B,WAGhC,GAAgBs3E,GAAZC,IAEJ,QAQClvD,IAAK,SAAS1c,EAAM6rE,GACnBD,EAAM5rE,EAAKqG,eAAiBwlE,GAU7Bv3D,IAAK,SAAStU,GACb,QAAS4rE,EAAM5rE,EAAKqG,gBAkBrBzQ,OAAQ,SAASoK,EAAM2gB,GACtB,GAAImrD,GAAaptE,EAAMqtE,CAGvB,KAAKJ,EAAe,CACnBI,EAAYC,QAAQxT,EAEpB,KAAK95D,IAAQqtE,GACZH,EAAMltE,EAAK2H,eAAiB0lE,EAAUrtE,EAGvCitE,IAAgB,EAkBjB,GAdmB,gBAAR3rE,IACV2gB,EAAWA,MACXA,EAAS3gB,KAAOA,IAEhB2gB,EAAW3gB,EACXA,EAAO2gB,EAAS3gB,MAIjBA,EAAOA,EAAKqG,cACZylE,EAAcF,EAAM5rE,IAIf8rE,EACJ,KAAM,IAAI15D,OAAM,mCAAqCpS,EAQtD,OAHA8rE,GAAc,GAAIA,GAAYnrD,GAC9BmrD,EAAY9rE,KAAOA,EAEZ8rE,MAsBVz3E,EAAO,mCACJ,WASF,MAAO,UAASssB,GAGf,QAASgb,GAAU3rB,GAClB,MAAOA,IAA0B,IAAlBA,EAAK3M,SAoBrB,QAAS4oE,GAAQ5uD,GAGhB,MAFAA,GAAMA,GAAO6uD,EAETvwC,EAAUte,GACNA,EAAI9W,aAAa,QAGlB,KAWR,QAAS4lE,GAAc9uD,GAGtB,IAFA,GAAIypD,GAAM32D,EAASkN,GAAO6uD,EAElB/7D,EAASA,EAAOxM,YACvB,GAAKmjE,EAAOmF,EAAQ97D,GACnB,MAAO22D,GAYV,QAASsF,GAAY1tE,GACpB,GAAI2e,GAAM6uD,CAEV,IAAIvwC,EAAUte,GACb,MAAOA,GAAI9W,aAAa,QAAU7H,GAWpC,QAAS2tE,GAAmBhvD,GAC3B,GAAIiiB,GAAUjiB,EAAIiiB,QAAQniB,aAI1B,OAAkB,SAAXmiB,GAAiC,YAAXA,GAAoC,UAAXA,EAUvD,QAASgtC,GAASjvD,GACjB,SAAIgvD,EAAmBhvD,IAASA,EAAIiqD,WAIhC,2EAA2E/pE,KAAK0uE,EAAQ5uD,IAc7F,QAASkvD,GAAiBlvD,GAGzB,QAAS+W,GAAQ/W,GAChB,GAAoB,GAAhBA,EAAIha,UAAsC,QAArBga,EAAIC,MAAM84B,QAAnC,CAIIk2B,EAASjvD,IACZtL,EAAS5d,KAAKkpB,EAGf,KAAK,GAAItpB,GAAI,EAAGA,EAAIspB,EAAIvN,WAAW9b,OAAQD,IAC1CqgC,EAAQ/W,EAAIvN,WAAW/b,KAZzB,GAAIge,KAkBJ,OAFAqiB,GAAQ/W,GAAOxI,EAAK2wD,SAEbzzD,EAYR,QAASy6D,GAAkBC,GAC1B,GAAIC,GAAgBjC,CAEpBgC,GAAgBA,GAAiBE,EACjClC,EAAWgC,EAAc/sD,UAAU1I,UACnCyzD,EAAS54D,QAAQ46D,EAEjB,KAAK,GAAI14E,GAAI,EAAGA,EAAI02E,EAASz2E,SAC5B04E,EAAiBjC,EAAS12E,IAEtB24E,EAAe/rD,SAASisD,UAHQ74E,KAQrC,MAAO24E,GAUR,QAASG,GAAWJ,GACnB,GAAIC,GAAiBF,EAAkBC,GACnCK,EAAgBP,EAAiBG,EAAelH,QAEhDkH,GAAe/rD,SAASosD,cAAgB,iBAAmBL,GAC9DM,EAAiBN,EAAeO,cAAeH,GAE/CE,EAAiB,EAAGF,GAatB,QAASE,GAAiB74D,EAAKpC,GAW9B,MAVIoC,GAAM,EACTA,EAAMpC,EAAS/d,OAAS,EACdmgB,GAAOpC,EAAS/d,SAC1BmgB,EAAM,GAGHpC,EAASoC,IACZpC,EAASoC,GAAKW,QAGRX,EAUR,QAAS+4D,GAAUxjE,EAAKqI,GACvB,GAAIoC,MAAUu4D,EAAiBF,GAE/Bz6D,GAAWA,GAAYw6D,EAAiBG,EAAelH,QAEvD,KAAK,GAAIzxE,GAAI,EAAGA,EAAIge,EAAS/d,OAAQD,IAChCge,EAAShe,KAAOm4E,IACnB/3D,EAAMpgB,EAIRogB,IAAOzK,EACPgjE,EAAeO,cAAgBD,EAAiB74D,EAAKpC,GAQtD,QAAS1a,KACR,GAAI81E,GAAahB,GAEC,YAAdgB,EACHD,KAAcX,EAAiBL,EAAevoE,aACpCgpE,EAAex8D,SAASi9D,QAClC7oE,IAEA2oE,MASF,QAAS/qD,KACR,GAAI2kD,GAAOmF,IAAWkB,EAAahB,GAEjB,YAAdgB,EACHD,EAAU,EAAGX,EAAiBL,EAAevoE,aAC3B,YAARmjE,GAAoC,QAAdqG,GAAwBf,EAAY,YACpEiB,IAEAH,EAAU,GASZ,QAASI,KACRJ,MAQD,QAASK,KACR,GAAIzG,GAAOmF,IAAWkB,EAAahB,GAEvB,aAARrF,GAAoC,WAAdqG,EACzBE,IACkB,UAARvG,GAAoBsF,EAAY,YAC1CiB,GAAO/lE,IAAK,SAEZ4lE,EAAU,GAUZ,QAASM,GAAI30E,GACZ,GAAIs0E,GAAahB,GAEjB,IAAkB,WAAdgB,EAAyB,CAC5B,GAAI9vD,GAAMkvD,EAAiBI,EAAenH,MAAM,SAAS,EAErDnoD,IACHA,EAAIvI,YAGLo4D,GAAUr0E,EAAE67C,YAAgB,GAS9B,QAASnwC,KACRooE,EAAe3oE,KAAK,UASrB,QAASqpE,GAAM/C,GACdA,EAAOA,MACPqC,EAAe3oE,KAAK,SAAUtP,OAAQw3E,EAAgB5B,KAAMA,IA5T7D,GAA0B4B,GAAgBS,EAAtC93D,EAAO8L,EAAS9L,IAMpB,KACCq3D,EAAiB1wE,SAASuZ,cACzB,MAAOxb,GAER2yE,EAAiB1wE,SAASC,KAiX3B,MA9WAkxE,GAAiB93D,EAAKuwD,cAAc8G,GAkTpCr3D,EAAKmK,GAAG,UAAW,SAASnmB,GAC3B,QAAS40E,GAAuB50E,EAAGqP,GAE9BmkE,EAAmBH,IAIS,WAA5BD,EAAQC,IAIRhkE,EAAQrP,MAAO,GAClBA,EAAEgI,iBAIJ,IAAIhI,EAAEiI,qBAIN,OAAQjI,EAAEg2D,SACT,IAAK,IACJ4e,EAAuB50E,EAAGxB,EAC1B,MAED,KAAK,IACJo2E,EAAuB50E,EAAGspB,EAC1B,MAED,KAAK,IACJsrD,EAAuB50E,EAAGy0E,EAC1B,MAED,KAAK,IACJG,EAAuB50E,EAAG00E,EAC1B,MAED,KAAK,IACJhpE,GACA,MAED,KAAK,IACL,IAAK,IACL,IAAK,IACJkpE,EAAuB50E,EAAGw0E,EAC1B,MAED,KAAK,GACAG,EAAI30E,MAAO,GACdA,EAAEgI,oBAMNgU,EAAKmK,GAAG,UAAW,SAASnmB,GAC3BqzE,EAAiBrzE,EAAEnE,OACnBi4E,EAAiB9zE,EAAE0qE,WAInBsJ,WAAYA,MA0Bfx4E,EAAO,wBACN,qBACA,wBACA,sBACA,qBACA,gCACA,qBACA,uBACA,uBACA,0BACE,SAASiyE,EAAS/D,EAAYI,EAAU+K,EAASC,EAAoB9zD,EAAO+W,EAAGszC,EAAWa,GAG5F,GAAI6I,KAEJ,OAAOtH,GAAQntD,QAUdiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZA,EAAW5e,EAAK4e,SAEZA,EAASkrB,OACZ9pC,EAAK8c,MAAM9B,IAAI,SAAS,GAGzBhb,EAAK8rE,OAAS,GAAItL,GAEdxgE,EAAK0kE,SACR1kE,EAAK8hD,QAAQnnC,IAAI,OAGlB3a,EAAK+rE,YAAc,GAAI5J,GAAU,WAC5BniE,EAAK8c,MAAM/B,IAAI,cAClB/a,EAAKyjE,MAAM,QAAQp1D,UAAYtY,KAAKkC,cAGtC+H,EAAK+rE,YAAY9rD,OAASjgB,EAAKwkE,YAE/BxkE,EAAK8hD,QAAQnnC,IAAI,aACjB3a,EAAK+rE,YAAYpxD,IAAI,kBAEjBiE,EAASotD,cACZhsE,EAAK8hD,QAAQnnC,IAAIiE,EAASotD,cAG3BhsE,EAAK2iE,QAAUgJ,EAAQ93E,QAAQ+qB,EAASqtD,QAAU,IAAM,UAEpDjsE,EAAK4e,SAASnI,MACjBzW,EAAK2a,IAAI3a,EAAK4e,SAASnI,OAEvBzW,EAAK2a,IAAI3a,EAAKgpE,UAIfhpE,EAAK8nE,UAAW,GASjBrxD,MAAO,WACN,MAAO1gB,MAAK+1E,QAUbjhE,KAAM,SAAS5H,GAGd,MAFAA,GAAW4oE,EAAc5oE,GAAY4oE,EAAc5oE,IAAa,GAAI29D,GAAS39D,GAEtEA,EAAS4H,KAAK9U,OAWtB4kB,IAAK,SAASlE,GACb,GAAIzW,GAAOjK,IAIX,OAFAiK,GAAKyW,QAAQkE,IAAI3a,EAAKnM,OAAO4iB,IAAQrI,OAAOpO,GAErCA,GAWR+S,MAAO,SAASm5D,GACf,GAAiBC,GAAWC,EAAa31D,EAArCzW,EAAOjK,IAEX,OAAIm2E,KACHE,EAAcpsE,EAAKosE,aAAepsE,EAAK2d,UAAU/J,OAAO,GAAGw4D,iBAG1DA,GAAYtB,WAAW9qE,IAKzByW,EAAQzW,EAAK6K,KAAK,KAGd7K,EAAKqsE,WACR51D,EAAMkE,IAAI3a,EAAKqsE,UAAU51D,SAG1BA,EAAMrB,KAAK,SAAS67B,GACnB,MAAIA,GAAKryB,SAAS0tD,WACjBH,EAAY,MACL,QAGJl7B,EAAKs5B,WACR4B,EAAYA,GAAal7B,MAIvBk7B,GACHA,EAAUp5D,QAGJ/S,IAURyE,QAAS,SAAS8nE,EAASC,GAI1B,IAHA,GAAIz6B,GAASt7B,EAAQ1gB,KAAK0gB,QAASzkB,EAAIykB,EAAMxkB,OAGtCD,KACN,GAAIykB,EAAMzkB,KAAOu6E,EAAS,CACzB91D,EAAMzkB,GAAKw6E,CACX,OAIEx6E,GAAK,IAER+/C,EAAUy6B,EAAQ/I,QACd1xB,GACHA,EAAQnwC,WAAWoE,YAAY+rC,GAIhCA,EAAUw6B,EAAQ9I,QACd1xB,GACHA,EAAQnwC,WAAWoE,YAAY+rC,IAKjCy6B,EAAQp+D,OAAOrY,OAWhBlC,OAAQ,SAAS4iB,GAChB,GAAiBmI,GAAb5e,EAAOjK,KAAgB02E,IA4B3B,OAzBK30D,GAAMjgB,QAAQ4e,KAClBA,GAASA,IAIVqB,EAAM1C,KAAKqB,EAAO,SAAShB,GACtBA,IAEGA,YAAgB8uD,KAEF,gBAAR9uD,KACVA,GAAQxX,KAAMwX,IAIfmJ,EAAW9G,EAAMV,UAAWpX,EAAK4e,SAASP,SAAU5I,GACpDA,EAAKxX,KAAO2gB,EAAS3gB,KAAO2gB,EAAS3gB,MAAQwX,EAAKxX,MAAQ+B,EAAK4e,SAAS8tD,cACtE9tD,EAASP,SAAWO,EAASP,SAASpgB,KAAO,MAC/CwX,EAAOk2D,EAAQ93E,OAAO+qB,IAGvB6tD,EAAUr6E,KAAKqjB,MAIVg3D,GAQRE,UAAW,WACV,GAAI3sE,GAAOjK,IA0BX,OAvBAiK,GAAKyW,QAAQrB,KAAK,SAAS67B,EAAMv7B,GAChC,GAAIk3D,EAEJ37B,GAAK7iC,OAAOpO,GAEPixC,EAAKn0B,MAAM/B,IAAI,cACnB6xD,EAAe5sE,EAAKyjE,MAAM,QAGtBmJ,EAAatwC,iBAAmB5mB,GAASk3D,EAAa7+D,WAAW9b,OAAS,EAC7E48B,EAAE+9C,EAAa7+D,WAAW2H,IAAQsG,OAAOi1B,EAAK23B,cAE9C/5C,EAAE+9C,GAAc/wD,OAAOo1B,EAAK23B,cAG7B33B,EAAK43B,aACL7F,EAAYroD,IAAIs2B,MAIlBjxC,EAAK2iE,QAAQiC,aAAa5kE,EAAKyW,QAAQ9N,OAAO,aAC9C3I,EAAKgoE,UAAY,KAEVhoE,GAUR6b,OAAQ,SAASpF,GAChB,MAAO1gB,MAAK4kB,IAAIlE,GAAOk2D,aAUxB5wD,QAAS,SAAStF,GACjB,GAAIzW,GAAOjK,IAIX,OAFAiK,GAAKyW,QAAQuE,IAAIhb,EAAKnM,OAAO4iB,GAAOzU,OAAOhC,EAAKyW,QAAQxB,YAEjDjV,EAAK2sE,aAWbzsC,OAAQ,SAASzpB,EAAOf,EAAOsG,GAC9B,GAAiB6wD,GAAUC,EAAaC,EAApC/sE,EAAOjK,IAeX,OAbA0gB,GAAQzW,EAAKnM,OAAO4iB,GACpBo2D,EAAW7sE,EAAKyW,SAEXuF,GAAUtG,EAAQm3D,EAAS56E,OAAS,IACxCyjB,GAAS,GAGNA,GAAS,GAAKA,EAAQm3D,EAAS56E,SAClC66E,EAAcD,EAASz0E,MAAM,EAAGsd,GAAOT,UACvC83D,EAAaF,EAASz0E,MAAMsd,GAAOT,UACnC43D,EAAS7xD,IAAI8xD,EAAY9qE,OAAOyU,EAAOs2D,KAGjC/sE,EAAK2sE,aAYbK,SAAU,SAASvvE,GAClB,GAAIuC,GAAOjK,IAEX,KAAK,GAAI4G,KAAQc,GAChBuC,EAAK6K,KAAK,IAAMlO,GAAMrF,MAAMmG,EAAKd,GAGlC,OAAOqD,IAURitE,OAAQ,WACP,GAAIjtE,GAAOjK,KAAM0H,IAUjB,OARAuC,GAAK6K,KAAK,KAAKuK,KAAK,SAAS67B,GAC5B,GAAIt0C,GAAOs0C,EAAKt0C,OAAQrF,EAAQ25C,EAAK35C,OAEjCqF,IAAwB,mBAATrF,KAClBmG,EAAKd,GAAQrF,KAIRmG,GASRmrE,WAAY,WACX,GAAI5oE,GAAOjK,KAAMk2E,EAASjsE,EAAK2iE,QAASoC,EAAOhvE,KAAK6oB,SAASmmD,IAK7D,OAHA/kE,GAAK+oE,YACLkD,EAAOlD,UAAU/oE,GAGhB,YAAcA,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,KAAOijB,EAAO,UAAYhvE,KAAK6oB,SAASmmD,KAAO,IAAM,IAAM,aAClG/kE,EAAK4iE,IAAM,iBAAmB5iE,EAAK+rE,YAAc,MAC7D/rE,EAAK4e,SAASzG,MAAQ,IAAM8zD,EAAOrD,WAAW5oE,GAChD,gBAWH6oE,WAAY,WACX,GAAiBtoD,GAAbvgB,EAAOjK,IA4BX,OA1BAiK,GAAKyW,QAAQ/a,KAAK,cAClBsE,EAAKs+D,SAELt+D,EAAK2iE,QAAQkG,WAAW7oE,GACxBA,EAAK8c,MAAM9B,IAAI,YAAY,GAEvBhb,EAAK4e,SAASrD,OACjBvb,EAAKqoE,IAAIntD,IAAIlb,EAAK4e,SAASrD,OAGxBvb,EAAK4e,SAAS+C,SACjBpB,EAAMvgB,EAAKmlE,UACXnlE,EAAKqoE,IAAIntD,KACRguD,mBAAoB3oD,EAAIhrB,IACxB4zE,qBAAsB5oD,EAAIH,MAC1BgpD,sBAAuB7oD,EAAIF,OAC3BgpD,oBAAqB9oD,EAAIjrB,QAItB0K,EAAKoO,WACTpO,EAAKosE,YAAc,GAAIR,IACtB94D,KAAM9S,KAIDA,GAWR0lE,eAAgB,WACf,GAAI1lE,GAAOjK,KAAM4vE,EAAa3lE,EAAKs+D,QAKnC,OAFAt+D,GAAK2iE,QAAQnuC,OAAOx0B,GAEb2lE,GASRnxC,OAAQ,WACP,GAAIx0B,GAAOjK,KAAM5C,EAAO6M,EAAKwmE,YAAa0G,EAAWltE,EAAKgoE,SAE1D,KAAKkF,GAAYA,EAAS15E,GAAKL,EAAKK,GAAK05E,EAASz5E,GAAKN,EAAKM,EAI3D,MAHAuM,GAAK2iE,QAAQnuC,OAAOx0B,GACpB7M,EAAO6M,EAAK2lE,aACZ3lE,EAAKgoE,WAAa10E,EAAGH,EAAKG,EAAGC,EAAGJ,EAAKI,EAAGC,EAAGL,EAAKK,EAAGC,EAAGN,EAAKM,IACpD,GAeTovE,OAAQ,WACP,GAAI7wE,EAIJ,IAFAgxE,EAAYpnD,OAAO7lB,MAEfA,KAAKkvE,UAAW,CAOnB,IANAV,EAAQ8C,mBACR9C,EAAQ8C,gBAAgB3+D,OAExB3S,KAAKy+B,SACLxiC,EAAIuyE,EAAQ8C,gBAAgBp1E,OAErBD,KACNuyE,EAAQ8C,gBAAgBr1E,GAAGu1E,SAIC,UAAzBxxE,KAAK6oB,SAASqtD,QAA8C,UAAzBl2E,KAAK6oB,SAASqtD,QACpDl2E,KAAKwxE,UAGNhD,EAAQ8C,mBAGT,MAAOtxE,WAkCVzD,EAAO,yBACN,wBACE,SAASu8B,GAGX,QAASs+C,GAAgB7uE,GACxB,GAAIC,GAAiB7E,EAAM+6C,EAAa/iB,EACpCO,EAAa0iB,EAAc/iB,EAAcM,EAAcz9B,EAAMiB,KAAKjB,GAatE,OAXA8J,GAAkBD,EAAIC,gBACtB7E,EAAO4E,EAAI5E,KAEX+6C,EAAchgD,EAAI8J,EAAgBk2C,YAAa/6C,EAAK+6C,aACpD/iB,EAAcj9B,EAAI8J,EAAgBmzB,YAAah4B,EAAKg4B,aACpDO,EAAcx9B,EAAI8J,EAAgB0zB,YAAav4B,EAAKu4B,aAEpD0iB,EAAelgD,EAAI8J,EAAgBo2C,aAAcj7C,EAAKi7C,cACtD/iB,EAAen9B,EAAI8J,EAAgBqzB,aAAcl4B,EAAKk4B,cACtDM,EAAez9B,EAAI8J,EAAgB2zB,aAAcx4B,EAAKw4B,eAGrD18B,MAAOi/C,EAAcxiB,EAAcP,EAAc+iB,EACjDh/C,OAAQk/C,EAAeziB,EAAeN,EAAe+iB,GAIvD,QAASy4B,GAAoBt2E,GAC5B,GAAI0O,GAAMxT,CAEV,IAAI8E,EAAEu2E,eAEL,IADA7nE,EAAO,8CAA8C3S,MAAM,KACtDb,EAAI,EAAGA,EAAIwT,EAAKvT,OAAQD,IAC5B8E,EAAE0O,EAAKxT,IAAM8E,EAAEu2E,eAAe,GAAG7nE,EAAKxT,IAKzC,MAAO,UAASO,EAAIqsB,GAKnB,QAAS0uD,KACR,MAAOhvE,GAAI0F,eAAe4a,EAAStoB,QAAU/D,GAL9C,GAAIg7E,GAAoDC,EAAYx7D,EAAO9X,EAAMuzE,EAAMh6B,EAAQE,EAA5Er1C,EAAMsgB,EAASnlB,UAAYA,QAE9CmlB,GAAWA,MAMX5M,EAAQ,SAASlb,GAChB,GAAoCk/C,GAAW03B,EAA3CC,EAAUR,EAAgB7uE,EAE9B8uE,GAAoBt2E,GAEpBA,EAAEgI,iBACF0uE,EAAa12E,EAAE6c,OACfqiC,EAAYs3B,IACZ75B,EAAS38C,EAAE08C,QACXG,EAAS78C,EAAE48C,QAIVg6B,EADGj2E,OAAOgkB,iBACDhkB,OAAOgkB,iBAAiBu6B,EAAW,MAAMt6B,iBAAiB,UAE1Ds6B,EAAU43B,aAAaF,OAGjCH,EAAgB1+C,EAAE,SAAS3T,KAC1B60B,SAAU,WACVx6C,IAAK,EAAGD,KAAM,EACdE,MAAOm4E,EAAQn4E,MACfC,OAAQk4E,EAAQl4E,OAChBo4E,OAAQ,WACRnvD,QAAS,KACTgvD,OAAQA,IACNxxD,SAAS5d,EAAI5E,MAEhBm1B,EAAEvwB,GAAK2e,GAAG,sBAAuBwwD,GAAMxwD,GAAG,mBAAoB/iB,GAE9D0kB,EAAS5M,MAAMlb,IAGhB22E,EAAO,SAAS32E,GAGf,MAFAs2E,GAAoBt2E,GAEhBA,EAAE6c,SAAW65D,EACTtzE,EAAKpD,IAGbA,EAAEq8C,OAASr8C,EAAE08C,QAAUC,EACvB38C,EAAEs8C,OAASt8C,EAAE48C,QAAUC,EAEvB78C,EAAEgI,qBACF8f,GAAS6uD,KAAK32E,KAGfoD,EAAO,SAASpD,GACfs2E,EAAoBt2E,GAEpB+3B,EAAEvwB,GAAK4e,IAAI,sBAAuBuwD,GAAMvwD,IAAI,mBAAoBhjB,GAEhEqzE,EAAc3xD,SAEVgD,EAAS1kB,MACZ0kB,EAAS1kB,KAAKpD,IAShBf,KAAKwM,QAAU,WACdssB,EAAEy+C,KAAgBpwD,OAGnB2R,EAAEy+C,KAAgBrwD,GAAG,uBAAwBjL,MAsB/C1f,EAAO,yBACN,uBACA,yBACE,SAASu8B,EAAGi/C,GAGd,OACCz0D,KAAM,WACL,GAAIrZ,GAAOjK,IACXiK,GAAKid,GAAG,UAAWjd,EAAK+tE,eAGzBA,aAAc,WAGb,QAASC,KAGR,QAASC,GAAYC,EAAUC,EAASC,EAAUC,EAAiBC,EAAWC,GAC7E,GAAI3B,GAAc4B,EAAcC,EAC5BC,EAAeC,EAAY16B,EAAO9gD,EAClCy7E,EAAcC,CAGlB,IADAL,EAAexuE,EAAKyjE,MAAM,SAAWyK,GACnB,CAMjB,GALAU,EAAeT,EAAQ7pE,cACvBuqE,EAAgBT,EAAS9pE,cAEzBuqB,EAAE7uB,EAAKyjE,MAAM,WAAWvoD,IAAI0zD,EAAc5uE,EAAK2lE,aAAa0I,GAAmB,IAE1EC,EAEJ,WADAz/C,GAAE2/C,GAActzD,IAAI,UAAW,OAIhC2T,GAAE2/C,GAActzD,IAAI,UAAW,SAC/B0xD,EAAe5sE,EAAKyjE,MAAM,QAC1BgL,EAAiBzuE,EAAKyjE,MAAM,SAAWyK,EAAW,KAClDQ,EAAgB9B,EAAa,SAAWwB,GAAsB,EAATt4B,EACrD44B,GAAiBI,GAAcC,EAAaP,EAAa,SAAWD,GAAM,EAC1EI,EAAa/B,EAAa,SAAWwB,GACrCn6B,EAAQy6B,EAAgBC,EAExBx7E,KACAA,EAAKy7E,GAAgBhC,EAAa,SAAWuB,GAAWr4B,EACxD3iD,EAAK07E,GAAiBH,EACtB7/C,EAAE2/C,GAActzD,IAAI/nB,GAEpBA,KACAA,EAAKy7E,GAAgBhC,EAAa,SAAWuB,GAAWl6B,EACxD9gD,EAAK07E,GAAiBH,EAAgBz6B,EACtCplB,EAAE4/C,GAAgBvzD,IAAI/nB,IAnCxB,GAAI27E,GAAYC,EAAYtH,CAuC5BA,GAAUznE,EAAKyjE,MAAM,QACrBqL,EAAarH,EAAQhzB,YAAcgzB,EAAQ/1C,YAC3Cq9C,EAAatH,EAAQ9yB,aAAe8yB,EAAQ71C,aAE5Cq8C,EAAY,IAAK,OAAQ,QAAS,WAAYa,EAAY,UAC1Db,EAAY,IAAK,MAAO,SAAU,WAAYc,EAAY,SAG3D,QAASC,KACR,QAASC,GAAcf,EAAUC,EAASC,EAAUc,EAAcX,GACjE,GAAIY,GAAaC,EAASpvE,EAAK4iE,IAAM,UAAYsL,EAAUjuD,EAASjgB,EAAKwkE,WAEzE31C,GAAE7uB,EAAKyjE,SAAS5nD,OACf,YAAcuzD,EAAS,YAAcnvD,EAAS,aAAeA,EAAS,aAAeiuD,EAAW,cACjFkB,EAAS,aAAenvD,EAAS,iCAIjDjgB,EAAKqvE,WAAa,GAAIvB,GAAWsB,EAAS,KACzCp9D,MAAO,WACNm9D,EAAcnvE,EAAKyjE,MAAM,QAAQ,SAAW0K,GAC5Ct/C,EAAE,IAAMugD,GAAQzyD,SAASsD,EAAS,WAGnCwtD,KAAM,SAAS32E,GACd,GAAIm9C,GAAO66B,EAAYC,EAAYL,EAAe/I,EAAa3lE,EAAK2lE,YAEpEmJ,GAAanJ,EAAWc,SAAWd,EAAWgB,OAC9CoI,EAAapJ,EAAWe,SAAWf,EAAWiB,OAC9C8H,EAAgB1uE,EAAKyjE,MAAM,QAAQ,SAAW2K,GAAsB,EAATt4B,EAC3D44B,GAAiBI,GAAcC,EAAa/uE,EAAKyjE,MAAM,SAAWyK,GAAU,SAAWK,GAAM,EAE7Ft6B,EAAQy6B,EAAgB1uE,EAAKyjE,MAAM,QAAQ,SAAW2K,GACtDpuE,EAAKyjE,MAAM,QAAQ,SAAW0K,GAAWgB,EAAer4E,EAAE,QAAUo4E,GAAgBj7B,GAGrF/5C,KAAM,WACL20B,EAAE,IAAMugD,GAAQvyD,YAAYoD,EAAS,aAKxCjgB,EAAK8hD,QAAQnnC,IAAI,UAEjBs0D,EAAc,IAAK,MAAO,SAAU,IAAK,SACzCA,EAAc,IAAK,OAAQ,QAAS,IAAK,UAvF1C,GAAIjvE,GAAOjK,KAAM+/C,EAAS,CA0FtB91C,GAAK4e,SAAS0wD,aACZtvE,EAAKuvE,aACTvvE,EAAKuvE,YAAa,EAClBP,IAEAhvE,EAAKid,GAAG,QAAS,SAASnmB,GACzB,GAAI04E,GAASxvE,EAAKyjE,MAAM,OAExB+L,GAAOhxE,YAAgC,IAAjB1H,EAAEq8C,QAAU,GAClCq8B,EAAO5wE,WAAwB,GAAX9H,EAAEs8C,OAEtB46B,MAGDn/C,EAAE7uB,EAAKyjE,MAAM,SAASxmD,GAAG,SAAU+wD,IAGpCA,SA0BJ17E,EAAO,oBACN,uBACA,yBACE,SAASm9E,EAAWC,GAGtB,MAAOD,GAAUr4D,QAChBwnD,UACCqN,OAAQ,MACRD,aAAc,SAGf7N,QAASuR,GAQT9G,WAAY,WACX,GAAI5oE,GAAOjK,KAAMk2E,EAASjsE,EAAK2iE,QAASb,EAAY9hE,EAAK4e,SAASzG,IAmBlE,OAjBAnY,GAAK+oE,YACLkD,EAAOlD,UAAU/oE,GAEO,mBAAb8hE,GACVA,EACC,YAAc9hE,EAAK4iE,IAAM,iBAAmB5iE,EAAK+rE,YAAc,KAC9DE,EAAOrD,WAAW5oE,GACnB,UAGuB,kBAAb8hE,KACVA,EAAYA,EAAU5qE,KAAK8I,IAG5BA,EAAK8nE,UAAW,GAIhB,YAAc9nE,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,+CACpD9hD,EAAK2vE,cAAgB,IACtB7N,EACD,cAuBJxvE,EAAO,sBACN,uBACE,SAAS6oD,GAGX,QAASy0B,GAA0B3+B,EAAMkE,EAAW9hD,GACnD,GAAI0+C,GAAS99C,EAAKX,EAAGC,EAAGs8E,EAAOC,EAAOp8E,EAASC,EAASo8E,EAAUvxD,CA8DlE,OA5DAuxD,GAAW50B,EAAS9pB,cAGpBp9B,EAAMknD,EAASrpB,OAAOqjB,GACtB7hD,EAAIW,EAAIX,EACRC,EAAIU,EAAIV,EAEJ09C,EAAKn0B,MAAM/B,IAAI,UAAmE,UAAvDogC,EAAS0mB,gBAAgBpoE,SAASC,KAAM,cACtEpG,GAAKy8E,EAASz8E,EACdC,GAAKw8E,EAASx8E,GAIfw+C,EAAUd,EAAKwyB,QACfjlD,EAAO28B,EAASppB,QAAQggB,GACxB89B,EAAQrxD,EAAKhpB,MACbs6E,EAAQtxD,EAAK/oB,OAGb+oB,EAAO28B,EAASppB,QAAQojB,GACxBzhD,EAAU8qB,EAAKhpB,MACf7B,EAAU6qB,EAAK/oB,OAGfpC,GAAOA,GAAO,IAAIR,MAAM,IAGT,MAAXQ,EAAI,KACPE,GAAKI,GAGS,MAAXN,EAAI,KACPC,GAAKI,GAGS,MAAXL,EAAI,KACPE,GAAKmC,KAAK9B,MAAMD,EAAU,IAGZ,MAAXN,EAAI,KACPC,GAAKoC,KAAK9B,MAAMF,EAAU,IAIZ,MAAXL,EAAI,KACPE,GAAKu8E,GAGS,MAAXz8E,EAAI,KACPC,GAAKu8E,GAGS,MAAXx8E,EAAI,KACPE,GAAKmC,KAAK9B,MAAMk8E,EAAQ,IAGV,MAAXz8E,EAAI,KACPC,GAAKoC,KAAK9B,MAAMi8E,EAAQ,KAIxBv8E,EAAGA,EACHC,EAAGA,EACHC,EAAGq8E,EACHp8E,EAAGq8E,GAIL,OASCE,YAAa,SAAS10D,EAAKtnB,GAG1B,IAAK,GAFDi8E,GAAe90B,EAAS9pB,cAEnBr/B,EAAI,EAAGA,EAAIgC,EAAK/B,OAAQD,IAAK,CACrC,GAAIiC,GAAM27E,EAA0B75E,KAAMulB,EAAKtnB,EAAKhC,GAEpD,IAAI+D,KAAK+mB,MAAM/B,IAAI,UAClB,GAAI9mB,EAAIX,EAAI,GAAKW,EAAIX,EAAIW,EAAIT,EAAIy8E,EAAaz8E,GAAKS,EAAIV,EAAI,GAAKU,EAAIV,EAAIU,EAAIR,EAAIw8E,EAAax8E,EAC5F,MAAOO,GAAKhC,OAGb,IAAIiC,EAAIX,EAAI28E,EAAa38E,GAAKW,EAAIX,EAAIW,EAAIT,EAAIy8E,EAAaz8E,EAAIy8E,EAAa38E,GAC3EW,EAAIV,EAAI08E,EAAa18E,GAAKU,EAAIV,EAAIU,EAAIR,EAAIw8E,EAAax8E,EAAIw8E,EAAa18E,EACxE,MAAOS,GAAKhC,GAKf,MAAOgC,GAAK,IAWbk8E,QAAS,SAAS50D,EAAKjoB,GACJ,gBAAPA,KACVA,EAAM0C,KAAKi6E,YAAY10D,EAAKjoB,GAG7B,IAAIY,GAAM27E,EAA0B75E,KAAMulB,EAAKjoB,EAC/C,OAAO0C,MAAKo6E,OAAOl8E,EAAIX,EAAGW,EAAIV,IAW/B68E,OAAQ,SAASC,EAAIC,GACpB,GAAItwE,GAAOjK,KAAM5C,EAAO6M,EAAK2lE,YAI7B,OAFA3lE,GAAKmwE,OAAOh9E,EAAKG,EAAI+8E,EAAIl9E,EAAKI,EAAI+8E,GAE3BtwE,GAWRmwE,OAAQ,SAAS78E,EAAGC,GAInB,QAASg9E,GAAUj5E,EAAO7C,EAAK+pB,GAC9B,MAAIlnB,GAAQ,EACJ,EAGJA,EAAQknB,EAAO/pB,GAClB6C,EAAQ7C,EAAM+pB,EACPlnB,EAAQ,EAAI,EAAIA,GAGjBA,EAbR,GAAI0I,GAAOjK,IAgBX,IAAIiK,EAAK4e,SAAS4xD,oBAAqB,CACtC,GAAIP,GAAe90B,EAAS9pB,YAAY55B,QACpCkuE,EAAa3lE,EAAK2lE,YAEtBryE,GAAIi9E,EAAUj9E,EAAG28E,EAAaz8E,EAAIy8E,EAAa38E,EAAGqyE,EAAWnyE,GAC7DD,EAAIg9E,EAAUh9E,EAAG08E,EAAax8E,EAAIw8E,EAAa18E,EAAGoyE,EAAWlyE,GAY9D,MATIuM,GAAK8c,MAAM/B,IAAI,YAClB/a,EAAK2lE,YAAYryE,EAAGA,EAAGC,EAAGA,IAAIg0E,WAE9BvnE,EAAK4e,SAAStrB,EAAIA,EAClB0M,EAAK4e,SAASrrB,EAAIA,GAGnByM,EAAKiC,KAAK,QAAS3O,EAAGA,EAAGC,EAAGA,IAErByM,MAsBV1N,EAAO,wBACN,uBACE,SAAS6oD,GAGX,OAMCs1B,gBAAiB,WAChB16E,KAAKywE,YAAYV,YAAa,EAC9B/vE,KAAKiyE,UAAY,KACjBjyE,KAAK8sE,UAWN6N,SAAU,SAASl9E,EAAGC,GAErB,GAAID,GAAK,GAAKC,GAAK,EAAG,CACrB,GAAIN,GAAOgoD,EAASymB,eAEpBpuE,GAAIA,GAAK,EAAIA,EAAIL,EAAKK,EAAIA,EAC1BC,EAAIA,GAAK,EAAIA,EAAIN,EAAKM,EAAIA,EAI3B,MADAsC,MAAKywE,YAAYV,YAAa,EACvB/vE,KAAK4vE,YAAYkB,KAAMrzE,EAAGszE,KAAMrzE,EAAGD,EAAGA,EAAGC,EAAGA,IAAIovE,UAWxD8N,SAAU,SAASC,EAAIC,GACtB,GAAI7wE,GAAOjK,KAAM5C,EAAO6M,EAAK2lE,YAE7B,OAAO3lE,GAAK0wE,SAASv9E,EAAKK,EAAIo9E,EAAIz9E,EAAKM,EAAIo9E,OA0B9Cv+E,EAAO,yBACN,mBACA,qBACA,uBACA,sBACA,uBACA,sBACE,SAASw+E,EAAOC,EAASC,EAAW71B,EAAUtsB,EAAGryB,GAMnD,QAASm6B,GAAUsa,EAAM7iC,GACxB,KAAO6iC,GAAM,CACZ,GAAIA,GAAQ7iC,EACX,OAAO,CAGR6iC,GAAOA,EAAK7iC,UAId,QAAS6iE,GAAiBn6E,GAKzB,IAFA,GAAI9E,GAAIk/E,EAAcj/E,OAEfD,KAAK,CACX,GAAIm/E,GAAQD,EAAcl/E,GAAIo/E,EAAYD,EAAM9N,cAAcvsE,EAAEnE,OAEhE,IAAIw+E,EAAMvyD,SAASyyD,SAAU,CAC5B,GAAID,IACCz6C,EAAUy6C,EAAWD,IAAUA,EAAM/iE,WAAagjE,GACrD,QAIFt6E,GAAIq6E,EAAMlvE,KAAK,YAAatP,OAAQmE,EAAEnE,SACjCmE,EAAEiI,sBACNoyE,EAAM9zD,SAMV,QAASi0D,KAEHC,IACJA,EAAuB,SAASz6E,GAEf,GAAZA,EAAE6c,QAINs9D,EAAiBn6E,IAGlB+3B,EAAEp1B,UAAUwjB,GAAG,mBAAoBs0D,IAIrC,QAASC,KACHC,IACJA,EAAwB,WACvB,GAAIz/E,EAGJ,KADAA,EAAIk/E,EAAcj/E,OACXD,KACN0/E,EAAgBR,EAAcl/E,KAIhC68B,EAAEp3B,QAAQwlB,GAAG,SAAUw0D,IAIzB,QAASE,KACR,IAAKC,EAAqB,CACzB,GAAIp0D,GAAS/jB,SAAS8E,gBAAiBmzB,EAAclU,EAAOkU,YAAaE,EAAepU,EAAOoU,YAE/FggD,GAAsB,WAEhBn4E,SAASvB,KAAOw5B,GAAelU,EAAOkU,aAAeE,GAAgBpU,EAAOoU,eAChFF,EAAclU,EAAOkU,YACrBE,EAAepU,EAAOoU,aACtBigD,EAAWC,YAIbjjD,EAAEp3B,QAAQwlB,GAAG,SAAU20D,IAQzB,QAASF,GAAgBP,GAGxB,QAASY,GAAuBjoC,EAAOsJ,GAGtC,IAAK,GAFDhlC,GAEKpc,EAAI,EAAGA,EAAIk/E,EAAcj/E,OAAQD,IACzC,GAAIk/E,EAAcl/E,IAAMm/E,EAGvB,IAFA/iE,EAAS8iE,EAAcl/E,GAAGoc,SAEnBA,IAAWA,EAASA,EAAOA,WAC7BA,GAAU+iE,GACbD,EAAcl/E,GAAG83C,MAAMA,GAAOsmC,OAAO,EAAGh9B,GAAQm0B,UAXrD,GAAIyK,GAAU72B,EAAS9pB,cAAc99B,CAkBjC49E,GAAMvyD,SAASqzD,UACbd,EAAMr0D,MAAM/B,IAAI,SAQhBo2D,EAAMe,UAAYF,IACrBb,EAAMrnC,OAAM,GAAO67B,YAAYpyE,EAAG49E,EAAMe,YAAY3K,UACpDwK,GAAuB,EAAOZ,EAAMe,UAAYF,KATjDb,EAAMe,UAAYf,EAAMxL,aAAapyE,EAEjC49E,EAAMe,UAAYF,IACrBb,EAAMrnC,OAAM,GAAM67B,YAAYpyE,EAAG,IAAIg0E,UACrCwK,GAAuB,EAAMC,EAAUb,EAAMe,cAWjD,QAASC,GAAUx3D,EAAKs2B,GACvB,GAAIj/C,GAAyCogF,EAAtCvE,EAASgE,EAAWhE,QAAU,KAErC,IAAIlzD,EACH03D,EAAOjgF,KAAK6+C,OAIZ,KAFAj/C,EAAIqgF,EAAOpgF,OAEJD,KACFqgF,EAAOrgF,KAAOi/C,GACjBohC,EAAO3oE,OAAO1X,EAAG,EAKpB,IAAIqgF,EAAOpgF,OACV,IAAKD,EAAI,EAAGA,EAAIqgF,EAAOpgF,OAAQD,IAC1BqgF,EAAOrgF,GAAGsgF,QACbzE,IACAuE,EAAWC,EAAOrgF,IAGnBqgF,EAAOrgF,GAAGyxE,QAAQloD,MAAMsyD,OAASA,EACjCwE,EAAOrgF,GAAG67E,OAASA,EACnBA,GAIF,IAAI0E,GAAe1jD,EAAE,IAAMoiB,EAAKuzB,YAAc,cAAevzB,EAAKu0B,mBAAmB,EAEjF4M,GACHvjD,EAAE0jD,GAAcr3D,IAAI,UAAWk3D,EAASvE,OAAS,GACvC0E,IACVA,EAAa3wE,WAAWoE,YAAYusE,GACpCC,GAAW,GAGZX,EAAWY,cAAgB5E,EA2M5B,QAAS6E,GAAmBvB,GAC3B,GAAIn/E,EAGJ,KADAA,EAAIk/E,EAAcj/E,OACXD,KACFk/E,EAAcl/E,KAAOm/E,GACxBD,EAAcxnE,OAAO1X,EAAG,EAK1B,KADAA,EAAIqgF,EAAOpgF,OACJD,KACFqgF,EAAOrgF,KAAOm/E,GACjBkB,EAAO3oE,OAAO1X,EAAG,GAzXpB,GAAIu/E,GAAsBE,EAAuBG,EAChCY,EADqDtB,KAClEmB,KAmKAR,EAAaf,EAAM15D,QACtB+mD,QAAS4S,EAASC,GASlB33D,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZ5e,EAAKikE,YAAcjkE,EAEnBA,EAAK8hD,QAAQnnC,IAAI,cAGbiE,EAASyyD,WACZC,IACAK,IACAT,EAAc9+E,KAAK4N,IAGhB4e,EAASqzD,UACZT,IAEAxxE,EAAKid,GAAG,OAAQ,WACfy0D,EAAgB37E,SAIlBiK,EAAKid,GAAG,kBAAmB,SAASnmB,GACnC,GAAIA,EAAE0qE,SAAWxhE,EAAM,CACtB,GAAI2yE,GAAe1yD,EAASjgB,EAAKwkE,WAE7BxkE,GAAKsyE,QAAUE,IAClBG,EAAgB9jD,EAAE,IAAM5O,EAAS,cAAejgB,EAAKwlE,mBAChDmN,EAAc,KAClBA,EAAgB9jD,EACf,YAAc5O,EAAS,uBAAyBA,EAAS,SAAWA,EAAS,gBAC5E/D,SAASlc,EAAKwlE,oBAGjBhpE,EAAM5E,WAAW,WAChB+6E,EAAch2D,SAASsD,EAAS,MAChC4O,EAAE7uB,EAAKyjE,SAAS9mD,SAASsD,EAAS,QAGnCuyD,GAAW,GAGZL,GAAU,EAAMnyE,MAIlBA,EAAKid,GAAG,OAAQ,WACfjd,EAAK2d,UAAUvI,KAAK,SAAS67B,GAC5B,GAAIA,EAAKn0B,MAAM/B,IAAI,SAElB,MADA/a,GAAK8pC,OAAM,IACJ,MAKNlrB,EAASg0D,UACZ5yE,EAAK2vE,aAAe,eAAiB3vE,EAAKwkE,YAAc,gBACxDxkE,EAAK8hD,QAAQnnC,IAAI,WAAWA,IAAI,UAAUA,IAAI3a,EAAK0kE,QAAU,MAAQ,UAGtE1kE,EAAKuoE,KAAK,QAAS3pD,EAASi0D,WAC5B7yE,EAAKuoE,KAAK,aAAcvoE,EAAK4iE,KAC7B5iE,EAAKuoE,KAAK,cAAevoE,EAAK8yE,aAAe9yE,EAAK4iE,IAAM,UAGzD94B,MAAO,SAAShtB,GACf,GAAI9c,GAAOjK,IAEX,IAAIiK,EAAK8c,MAAM/B,IAAI,UAAY+B,EAAO,CACrC,GAAI9c,EAAK8c,MAAM/B,IAAI,YAAa,CAC/B,GAAIg1D,GAAW50B,EAAS9pB,aAEpBvU,GACH9c,EAAK2lE,aAAapyE,GAAKw8E,EAASx8E,EAEhCyM,EAAK2lE,aAAapyE,GAAKw8E,EAASx8E,EAIlCyM,EAAK8hD,QAAQoH,OAAO,QAASpsC,GAC7B9c,EAAK8c,MAAM9B,IAAI,QAAS8B,GAGzB,MAAO9c,IASRod,KAAM,WACL,GAAiBprB,GAAbgO,EAAOjK,KAAS+mB,EAAQ9c,EAAKs+D,QAGjC,KADAtsE,EAAIk/E,EAAcj/E,OACXD,KACFk/E,EAAcl/E,KAAOgO,IAS1B,MAJIhO,SACHk/E,EAAc9+E,KAAK4N,GAGb8c,GASRO,KAAM,WAIL,MAHAq1D,GAAmB38E,MACnBo8E,GAAU,EAAOp8E,MAEVA,KAAKuoE,UASbwT,QAAS,WACRD,EAAWC,WAQZiB,MAAO,WACN,GAAI/yE,GAAOjK,IAOX,OALKiK,GAAKiC,KAAK,SAASlD,uBACvBiB,EAAK4b,SACLu2D,GAAU,EAAOnyE,IAGXA,GAQR4b,OAAQ,WACP82D,EAAmB38E,MACnBA,KAAKuoE,UAGNuK,WAAY,WACX,GAAI7oE,GAAOjK,IAMX,OAJIiK,GAAK4e,SAASo0D,UACjBj9E,KAAK0tE,MAAM,QAAQ9+D,aAAa,OAAQ3E,EAAK4e,SAASo0D,UAGhDhzE,EAAKs+D,WA0Cd,OA/BAuT,GAAWC,QAAU,WAGpB,IAFA,GAAI9/E,GAAIk/E,EAAcj/E,OAEfD,KAAK,CACX,GAAIm/E,GAAQD,EAAcl/E,EAEtBm/E,IAASA,EAAMvyD,SAASyyD,WAC3BF,EAAM9zD,OACN6zD,EAAcxnE,OAAO1X,EAAG,MAuBpB6/E,IAsBRv/E,EAAO,qBACN,wBACA,mBACA,sBACA,uBACA,wBACA,sBACA,cACA,sBACE,SAASu/E,EAAYf,EAAO31B,EAAUtsB,EAAGi/C,EAAY/K,EAAUtmE,EAAKD,GAKtE,QAASy2E,GAAsBn2D,GAC9B,GAECo2D,GAFGC,EAAmB,2FACtBpD,EAAWlhD,EAAE,uBAAuB,EAGjCpyB,GAAI22E,oBAAqB,IAIxBrD,IACJA,EAAWt2E,SAASsM,cAAc,QAClCgqE,EAASprE,aAAa,OAAQ,YAC9BlL,SAAS6I,qBAAqB,QAAQ,GAAGgM,YAAYyhE,IAGtDmD,EAAenD,EAASvrE,aAAa,WACjC0uE,GAAuC,mBAAhBG,KAC1BA,EAAeH,GAGhBnD,EAASprE,aAAa,UAAWmY,EAAQq2D,EAAmBE,IAG7D,QAASC,GAA4B9O,GACpC,IAAK,GAAIxyE,GAAI,EAAGA,EAAIuhF,EAAQthF,OAAQD,IACnC,GAAIuhF,EAAQvhF,GAAGwhF,YACd,MAIF3kD,IAAGp1B,SAAS8E,gBAAiB9E,SAASC,OAAOmjB,YAAY2nD,EAAc,cAGxE,QAASiP,KAsBR,QAASC,KACR,GAAI1hF,GAAoC2zE,EAAjCxyE,EAAOgoD,EAASymB,eAEvB,KAAK5vE,EAAI,EAAGA,EAAIuhF,EAAQthF,OAAQD,IAC/B2zE,EAAa4N,EAAQvhF,GAAG2zE,aAExB4N,EAAQvhF,GAAGm+E,OACVoD,EAAQvhF,GAAG4sB,SAAStrB,GAAKoC,KAAKjB,IAAI,EAAGtB,EAAKK,EAAI,EAAImyE,EAAWnyE,EAAI,GACjE+/E,EAAQvhF,GAAG4sB,SAASrrB,GAAKmC,KAAKjB,IAAI,EAAGtB,EAAKM,EAAI,EAAIkyE,EAAWlyE,EAAI,IA7BpE,IAAKgJ,EAAIF,QAAS,CACjB,GAAIo3E,IACHngF,EAAGiE,OAAOg6B,WACVh+B,EAAGgE,OAAOk6B,YAGXn1B,GAAMrD,YAAY,WACjB,GAAI3F,GAAIiE,OAAOg6B,WACdh+B,EAAIgE,OAAOk6B,WAERgiD,GAASngF,GAAKA,GAAKmgF,EAASlgF,GAAKA,IACpCkgF,GACCngF,EAAGA,EACHC,EAAGA,GAGJo7B,EAAEp3B,QAAQ0lB,QAAQ,YAEjB,KAgBJ0R,EAAEp3B,QAAQwlB,GAAG,SAAUy2D,GAtExB,GAAIH,MAAcF,EAAe,GAyE7BO,EAAS/B,EAAWz6D,QACvBk7D,OAAO,EAEP1T,UACCj9C,OAAQ,EACRsqD,OAAQ,OACRD,aAAc,QACdjH,KAAM,SACN73C,WACC5Y,OAAQ,WACPve,KAAKkM,KAAK,UAAWxE,KAAM1H,KAAKk3E,YAGjC8F,MAAO,WACNh9E,KAAKg9E,WAWR15D,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GAER5e,EAAK0kE,SACR1kE,EAAK8hD,QAAQnnC,IAAI,OAGlB3a,EAAK8hD,QAAQnnC,IAAI,UACjB3a,EAAK+rE,YAAYpxD,IAAI,eACrB3a,EAAK8c,MAAM9B,IAAI,SAAS,GAGpB4D,EAASi1D,UACZ7zE,EAAKqsE,UAAY,GAAIyE,IACpB7E,OAAQ,OACRtqD,OAAQ,UACRmyD,QAAS,EACTzO,QAAS,GACT/M,MAAO,SACPyb,KAAM/zE,EAAK0kE,QAAU,QAAU,MAC/BrmD,UACCpgB,KAAM,UAEPwY,MAAOmI,EAASi1D,UAGjB7zE,EAAKqsE,UAAUvqB,QAAQnnC,IAAI,QAC3B3a,EAAKqsE,UAAUj+D,OAAOpO,IAGvBA,EAAKid,GAAG,QAAS,SAASnmB,GACzB,GAAIk9E,GAAah0E,EAAKwkE,YAAc,SAEhCrpB,EAASriC,SAAShiB,EAAEnE,OAAQqhF,IAAe74B,EAASriC,SAAShiB,EAAEnE,OAAOiP,WAAYoyE,KACrFh0E,EAAK+yE,UAIP/yE,EAAKid,GAAG,SAAU,WACjBjd,EAAK+yE,UAGN/yE,EAAKuoE,KAAK,cAAevoE,EAAK8yE,aAAe9yE,EAAK4iE,IAAM,SACxD5iE,EAAKuoE,KAAK,QAAS3pD,EAASq1D,OAC5Bj0E,EAAKwzE,aAAc,GASpBh/C,OAAQ,WACP,GAA6CmxC,GAAYnwE,EAAOlC,EAAG4gF,EAA/Dl0E,EAAOjK,KAAMs2E,EAAYrsE,EAAKqsE,SAE9BrsE,GAAKwzE,cACRxzE,EAAK2lE,WAAWxqB,EAASymB,iBACzB5hE,EAAK2lE,aAAae,SAAW1mE,EAAK2lE,aAAaiB,QAGhD5mE,EAAKs+D,SAELqH,EAAa3lE,EAAK2lE,aAGd3lE,EAAK4e,SAASq1D,QAAUj0E,EAAKwzE,cAChCh+E,EAAQmwE,EAAWwO,QACf3+E,EAAQmwE,EAAWnyE,IACtBF,EAAIqyE,EAAWryE,EAAIoC,KAAKjB,IAAI,EAAGe,EAAQ,GACvCwK,EAAK2lE,YAAYnyE,EAAGgC,EAAOlC,EAAGA,IAC9B4gF,GAAc,IAKZ7H,IACHA,EAAU1G,YAAYnyE,EAAGwM,EAAK2lE,aAAagB,SAASnyC,SAEpDh/B,EAAQ62E,EAAU1G,aAAakB,KAAOlB,EAAWO,OAC7C1wE,EAAQmwE,EAAWnyE,IACtBF,EAAIqyE,EAAWryE,EAAIoC,KAAKjB,IAAI,EAAGe,EAAQmwE,EAAWnyE,GAClDwM,EAAK2lE,YAAYnyE,EAAGgC,EAAOlC,EAAGA,IAC9B4gF,GAAc,IAKZA,GACHl0E,EAAKw0B,UAYPkxC,eAAgB,WACf,GAAyD0O,GAArDp0E,EAAOjK,KAAM4vE,EAAa3lE,EAAKs+D,SAAU6H,EAAS,CAGtD,IAAInmE,EAAK4e,SAASq1D,QAAUj0E,EAAKwzE,YAAa,CAC7CY,EAASp0E,EAAKyjE,MAAM,OAEpB,IAAIjlD,GAAO28B,EAASppB,QAAQqiD,EAE5BzO,GAAWwO,QAAU31D,EAAKhpB,MAC1BmwE,EAAW0O,QAAU71D,EAAK/oB,OAE1B0wE,GAAUR,EAAW0O,QAIlBr0E,EAAKqsE,YACRlG,GAAUnmE,EAAKqsE,UAAU1G,aAAalyE,GAGvCkyE,EAAWQ,QAAUA,EACrBR,EAAWmB,MAAQX,EAEnBR,EAAWlyE,GAAK0yE,CAEhB,IAAIhzE,GAAOgoD,EAASymB,eAKpB,OAHA+D,GAAWryE,EAAI0M,EAAK4e,SAAStrB,GAAKoC,KAAKjB,IAAI,EAAGtB,EAAKK,EAAI,EAAImyE,EAAWnyE,EAAI,GAC1EmyE,EAAWpyE,EAAIyM,EAAK4e,SAASrrB,GAAKmC,KAAKjB,IAAI,EAAGtB,EAAKM,EAAI,EAAIkyE,EAAWlyE,EAAI,GAEnEkyE,GASRiD,WAAY,WACX,GAAI5oE,GAAOjK,KAAMk2E,EAASjsE,EAAK2iE,QAASpwE,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,YACjE5lD,EAAW5e,EAAK4e,SAAU01D,EAAa,GAAIC,EAAa,GAAIp8D,EAAOyG,EAASzG,IA6BhF,OA3BAnY,GAAK+oE,YACLkD,EAAOlD,UAAU/oE,GAEb4e,EAASq1D,QACZK,EACC,YAAc/hF,EAAK,iBAAmB0tB,EAAS,yBAChC1tB,EAAK,kBAAoB0tB,EAAS,UAAYjgB,EAAK0gB,OAAO9B,EAASq1D,OAAS,kBAC5E1hF,EAAK,kBAAoB0tB,EAAS,6CACdA,EAAS,iFAO1CrB,EAASlH,MACZS,EAAO,gBAAkByG,EAASlH,IAAM,6BAGtB,mBAARS,KACVA,EAAO8zD,EAAOrD,WAAW5oE,IAGtBA,EAAKqsE,YACRkI,EAAav0E,EAAKqsE,UAAUzD,cAI5B,YAAcr2E,EAAK,YAAcyN,EAAK8hD,QAAU,+BAC9B9hD,EAAKwkE,YAAc,6BACnC8P,EACA,YAAc/hF,EAAK,iBAAmByN,EAAK+rE,YAAc,KACxD5zD,EACD,SACAo8D,EACD,gBAYHC,WAAY,SAAS13D,GACpB,GAA6D23D,GAA0C9O,EAAnG3lE,EAAOjK,KAAMwI,EAAkB9E,SAAS8E,gBAAgC0hB,EAASjgB,EAAKwkE,WAE1F,IAAI1nD,GAAS9c,EAAKwzE,YA+BjB,GA9BA3kD,EAAEp3B,QAAQwlB,GAAG,SAAU,WACtB,GAAIhkB,EAEJ,IAAI+G,EAAKwzE,YAER,GAAKiB,EAUCz0E,EAAK00E,SACT10E,EAAK00E,OAASl4E,EAAM5E,WAAW,WAC9B,GAAIzE,GAAOgoD,EAASymB,eACpB5hE,GAAKmwE,OAAO,EAAG,GAAGO,SAASv9E,EAAKK,EAAGL,EAAKM,GAExCuM,EAAK00E,OAAS,GACZ,SAhBe,CACnBz7E,GAAO,GAAI8H,OAAO2sB,SAElB,IAAIv6B,GAAOgoD,EAASymB,eACpB5hE,GAAKmwE,OAAO,EAAG,GAAGO,SAASv9E,EAAKK,EAAGL,EAAKM,IAEnC,GAAIsN,OAAO2sB,UAAaz0B,EAAO,KACnCw7E,GAAgB,MAepB9O,EAAa3lE,EAAK2lE,aAClB3lE,EAAKwzE,YAAc12D,EAEdA,EAOE,CACN9c,EAAK20E,UAAYrhF,EAAGqyE,EAAWryE,EAAGC,EAAGoyE,EAAWpyE,EAAGC,EAAGmyE,EAAWnyE,EAAGC,EAAGkyE,EAAWlyE,GAElFuM,EAAKmlE,UAAYpC,EAAShB,SAAS,KACnC/hE,EAAKyjE,MAAM,QAAQloD,MAAM84B,QAAU,OACnCsxB,EAAWQ,QAAUR,EAAW0O,QAAU,EAC1CxlD,GAAGtwB,EAAiB9E,SAASC,OAAOijB,SAASsD,EAAS,cACtDjgB,EAAK8hD,QAAQnnC,IAAI,aAEjB,IAAIxnB,GAAOgoD,EAASymB,eACpB5hE,GAAKmwE,OAAO,EAAG,GAAGO,SAASv9E,EAAKK,EAAGL,EAAKM,OAhBxCuM,GAAKmlE,UAAYpC,EAAShB,SAAS/hE,EAAK4e,SAAS+C,QACjD3hB,EAAKyjE,MAAM,QAAQloD,MAAM84B,QAAU,GACnCsxB,EAAWQ,QAAUR,EAAW0O,QAChCxlD,GAAGtwB,EAAiB9E,SAASC,OAAOmjB,YAAYoD,EAAS,cACzDjgB,EAAK8hD,QAAQlmC,OAAO,cACpB5b,EAAKmwE,OAAOnwE,EAAK20E,SAASrhF,EAAG0M,EAAK20E,SAASphF,GAAGm9E,SAAS1wE,EAAK20E,SAASnhF,EAAGwM,EAAK20E,SAASlhF,EAexF,OAAOuM,GAAK6iE,UAQbgG,WAAY,WACX,GAAiB10B,GAAbn0C,EAAOjK,IAEX6B,YAAW,WACVoI,EAAK8hD,QAAQnnC,IAAI,MACjB3a,EAAKiC,KAAK,SACR,GAEHjC,EAAKs+D,SAEDt+D,EAAKqsE,WACRrsE,EAAKqsE,UAAUxD,aAGhB7oE,EAAK+S,QAELhd,KAAK6+E,WAAa,GAAI9G,GAAW9tE,EAAK4iE,IAAM,UAC3C5wD,MAAO,WACNmiC,GACC7gD,EAAG0M,EAAK2lE,aAAaryE,EACrBC,EAAGyM,EAAK2lE,aAAapyE,IAIvBk6E,KAAM,SAAS32E,GACdkJ,EAAKmwE,OAAOh8B,EAAS7gD,EAAIwD,EAAEq8C,OAAQgB,EAAS5gD,EAAIuD,EAAEs8C,WAIpDpzC,EAAKid,GAAG,SAAU,SAASnmB,GACrBA,EAAEiI,sBACNiB,EAAK+yE,UAIPQ,EAAQnhF,KAAK4N,GACbizE,GAAsB,IASvB3+D,OAAQ,WACP,MAAOve,MAAKkM,KAAK,UAAWxE,KAAM1H,KAAKk3E,YASxCrxD,OAAQ,WACP,GAAiB5pB,GAAbgO,EAAOjK,IAUX,KARAiK,EAAK40E,WAAWryE,UAChBvC,EAAKs+D,SAEDt+D,EAAKqsE,WACRt2E,KAAKs2E,UAAUzwD,SAGhB5pB,EAAIuhF,EAAQthF,OACLD,KACFuhF,EAAQvhF,KAAOgO,GAClBuzE,EAAQ7pE,OAAO1X,EAAG,EAIpBihF,GAAsBM,EAAQthF,OAAS,GACvCqhF,EAA4BtzE,EAAKwkE,cASlCqQ,iBAAkB,WACjB,GAAIC,GAAM/+E,KAAK0tE,QAAQnhE,qBAAqB,UAAU,EACtD,OAAOwyE,GAAMA,EAAI/2D,cAAgB,OAMnC,OAFA01D,KAEOG,IAqBRthF,EAAO,yBACN,qBACE,SAASshF,GAGX,GAAImB,GAAanB,EAAOx8D,QAOvBiC,KAAM,SAASuF,GACdA,GACC+C,OAAQ,EACR0jD,QAAS,GACT4G,OAAQ,OACR8H,KAAM,SACNzb,MAAO,SACP0T,aAAc,QACdsD,YAAY,EACZuE,SAAU51E,KAAM,SAAUuU,KAAM,KAAM21D,OAAQ,MAC9C1xD,OACCxY,KAAM,QACN+2E,WAAW,EACX3O,SAAU,IACVE,UAAW,MAIbxwE,KAAKuoE,OAAO1/C,IAGb+/C,SAQCsW,GAAI,EASJC,UAAW,EASXC,OAAQ,EASRC,cAAe,EASfC,OAAQ,SAASz2D,GAGhB,QAAS02D,GAAa9iE,EAAM2a,EAAQooD,GACnC,OACCt3E,KAAM,SACNuU,KAAMA,EACNgjE,QAASD,EAAU,UAAY,GAC/BE,QAAS,SAAS3+E,GACjBA,EAAE0qE,QAAQ7jD,UAAU,GAAGo1D,QACvBlhF,EAASs7B,KATZ,GAAI0mD,GAAShiF,EAAW+sB,EAAS/sB,UAAY,YAc7C,QAAQ+sB,EAASi1D,SAChB,IAAKkB,GAAWG,UACfrB,GACCyB,EAAa,MAAM,GAAM,GACzBA,EAAa,UAAU,GAExB,MAED,KAAKP,GAAWI,OAChB,IAAKJ,GAAWK,cACfvB,GACCyB,EAAa,MAAO,GAAG,GACvBA,EAAa,KAAM,IAGhB12D,EAASi1D,SAAWkB,EAAWK,eAClCvB,EAAQzhF,KAAKkjF,EAAa,aAE3B,MAED,SACCzB,GACCyB,EAAa,MAAM,GAAM,IAK5B,MAAO,IAAI1B,IACVvO,QAAS,GACT/xE,EAAGsrB,EAAStrB,EACZC,EAAGqrB,EAASrrB,EACZqyE,SAAU,IACVC,UAAW,IACXoG,OAAQ,OACR8H,KAAM,SACNzb,MAAO,SACPub,QAASA,EACTI,MAAOr1D,EAASq1D,MAChBlP,KAAM,cACNtuD,OACCxY,KAAM,QACN+2E,WAAW,EACX3O,SAAU,IACVE,UAAW,IACX/zD,KAAMoM,EAASpM,MAEhBkjE,aAAc,WACb3/E,KAAKwyE,KAAK,cAAexyE,KAAK0gB,QAAQ,GAAGmsD,MAE1C+S,QAAS/2D,EAAS+2D,QAClBC,SAAU,WACT/jF,GAAS,MAERi3E,SAASrvE,SAASC,MAAMmpE,UAU5BgT,MAAO,SAASj3D,EAAU/sB,GAMzB,MALuB,gBAAZ+sB,KACVA,GAAYpM,KAAMoM,IAGnBA,EAAS/sB,SAAWA,EACbkjF,EAAWM,OAAOz2D,IAU1Bk3D,QAAS,SAASl3D,EAAU/sB,GAQ3B,MAPuB,gBAAZ+sB,KACVA,GAAYpM,KAAMoM,IAGnBA,EAAS/sB,SAAWA,EACpB+sB,EAASi1D,QAAUkB,EAAWG,UAEvBH,EAAWM,OAAOz2D,MAK5B,OAAOm2D,KAyCRziF,EAAO,yBACN,oBACA,yBACE,SAASshF,EAAQmB,GACnB,MAAO,UAASn7E,GAGf,QAASm8E,KACR,GAAIxC,EAAQthF,OACX,MAAOshF,GAAQA,EAAQthF,OAAS,GAIlC,QAAS+jF,GAAcx2E,GACtB5F,EAAOqI,KAAK,cACXzC,IAAKA,IAIP,QAASy2E,GAAez2E,GACvB5F,EAAOqI,KAAK,eACXzC,IAAKA,IAhBP,GAAIQ,GAAOjK,KAAMw9E,IAoBjBvzE,GAAKuzE,QAAUA,EAEf35E,EAAOqjB,GAAG,SAAU,WAGnB,IAFA,GAAIjrB,GAAIuhF,EAAQthF,OAETD,KACNuhF,EAAQvhF,GAAG+gF,UAiBb/yE,EAAKm4D,KAAO,SAAShgE,EAAM+9E,GAC1B,GAAI12E,EAiFJ,OA/EA5F,GAAOu8E,cAAcC,UAAUx8E,GAE/BzB,EAAK87E,MAAQ97E,EAAK87E,OAAS,IAG3B97E,EAAKuf,IAAMvf,EAAKuf,KAAOvf,EAAKgc,KACxBhc,EAAKuf,MACRvf,EAAK3C,MAAQ0pB,SAAS/mB,EAAK3C,OAAS,IAAK,IACzC2C,EAAK1C,OAASypB,SAAS/mB,EAAK1C,QAAU,IAAK,KAIxC0C,EAAKuB,OACRvB,EAAKse,OACJ4H,SAAUlmB,EAAKkmB,SACfpgB,KAAM9F,EAAKk+E,UAAY,OACvB5/D,MAAOte,EAAKuB,KACZ+D,KAAMtF,EAAKsF,KACXyvB,UAAW/0B,EAAKy+D,WAIbz+D,EAAKuf,KAAQvf,EAAK07E,UACtB17E,EAAK07E,UACHrhE,KAAM,KAAMgjE,QAAS,UAAWc,QAAS,WACzC92E,EAAIqL,KAAK,QAAQ,GAAGyJ,YAGpB9B,KAAM,SAAU8jE,QAAS,WACzB92E,EAAIuzE,YAKPvzE,EAAM,GAAIo0E,GAAOz7E,GACjBo7E,EAAQnhF,KAAKoN,GAEbA,EAAIyd,GAAG,QAAS,WAGf,IAFA,GAAIjrB,GAAIuhF,EAAQthF,OAETD,KACFuhF,EAAQvhF,KAAOwN,GAClB+zE,EAAQ7pE,OAAO1X,EAAG,EAIfuhF,GAAQthF,QACZ2H,EAAOmZ,QAGRkjE,EAAez2E,KAIZrH,EAAKsF,MACR+B,EAAIyd,GAAG,aAAc,WACpBlnB,KAAK8U,KAAK,KAAKuK,KAAK,SAAS67B,GAC5B,GAAIt0C,GAAOs0C,EAAKt0C,MAEZA,KAAQxE,GAAKsF,MAChBwzC,EAAK35C,MAAMa,EAAKsF,KAAKd,QAOzB6C,EAAI+2E,SAAWp+E,MACfqH,EAAI02E,OAASA,MAGU,IAAnB3C,EAAQthF,QACX2H,EAAOylC,cAGR7/B,EAAMA,EAAIspE,WAAWjG,SAErBmT,EAAcx2E,GAEPA,GAeRQ,EAAK61E,MAAQ,SAASW,EAAS3kF,EAAU2O,GACxC,GAAIhB,EAEJA,GAAMu1E,EAAWc,MAAMW,EAAS,WAC3B3kF,EACHA,EAASqF,KAAKsJ,GAASzK,MAEvB6D,EAAOmZ,UAITvT,EAAIyd,GAAG,QAAS,WACfg5D,EAAez2E,KAGhBw2E,EAAcx2E,IAoBfQ,EAAK81E,QAAU,SAASU,EAAS3kF,EAAU2O,GAC1C,GAAIhB,EAEJA,GAAMu1E,EAAWe,QAAQU,EAAS,SAAS15D,GAC1CjrB,EAASqF,KAAKsJ,GAASzK,KAAM+mB,KAG9Btd,EAAIyd,GAAG,QAAS,WACfg5D,EAAez2E,KAGhBw2E,EAAcx2E,IAQfQ,EAAK+yE,MAAQ,WACRgD,KACHA,IAAmBhD,SAcrB/yE,EAAKy2E,UAAY,WAChB,MAAOV,KAAqBA,IAAmBG,OAAS,MASzDl2E,EAAK02E,UAAY,SAASR,GACrBH,MACHA,IAAmBG,OAASA,IAU9Bl2E,EAAK22E,WAAa,WACjB,MAAOpD,OAyBVjhF,EAAO,sBACN,qBACA,sBACE,SAASiyE,EAASwM,GACpB,MAAOxM,GAAQntD,QACd+mD,QAAS4S,GAETnS,UACC9c,QAAS,4BASV8mB,WAAY,WACX,GAAI5oE,GAAOjK,KAAMkqB,EAASjgB,EAAKwkE,WAE/B,OACC,YAAcxkE,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,qCACpC7hC,EAAS,oCACTA,EAAS,kBAAoBjgB,EAAK0gB,OAAO1gB,EAAK8c,MAAM/B,IAAI,SAAW,gBAKvFuuD,WAAY,WACX,GAAItpE,GAAOjK,IAMX,OAJAiK,GAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrCkJ,EAAKyjE,QAAQvxD,UAAUpD,UAAY9O,EAAK0gB,OAAO5pB,EAAEQ,SAG3C0I,EAAKs+D,UAQbiJ,QAAS,WACR,GAAiBhsD,GAAOpoB,EAApB6M,EAAOjK,IAEXwlB,GAAQvb,EAAKyjE,QAAQloD,MACrBpoB,EAAO6M,EAAKwmE,YAEZjrD,EAAMjmB,KAAOnC,EAAKG,EAAI,KACtBioB,EAAMhmB,IAAMpC,EAAKI,EAAI,KACrBgoB,EAAMsyD,OAAS,YAuBlBv7E,EAAO,qBACN,qBACA,sBACE,SAASiyE,EAASqS,GAGpB,GAAIC,GAEAC,EAASvS,EAAQntD,QAUpBiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZA,EAAW5e,EAAK4e,SAChB5e,EAAKuqE,UAAW,EAEZ3rD,EAASi4D,SAAWC,EAAOC,YAAa,IAC3C/2E,EAAKid,GAAG,aAAc,SAASnmB,GAC9B,GAAI+/E,GAAU72E,EAAK62E,UAAU1G,cAE7B,IAAIr5E,EAAE0qE,SAAWxhE,EAAM,CACtB,GAAI3M,GAAMwjF,EAAQrkE,KAAKoM,EAASi4D,SAASz5D,OAAO4yD,YAAYhwE,EAAKyjE,SAAU,QAAS,QAAS,SAE7FoT,GAAQ/0B,QAAQoH,OAAO,YAAoB,SAAP71D,GACpCwjF,EAAQ/0B,QAAQoH,OAAO,aAAqB,SAAP71D,GACrCwjF,EAAQ/0B,QAAQoH,OAAO,aAAqB,SAAP71D,GAErCwjF,EAAQ3G,QAAQlwE,EAAKyjE,QAASpwE,OAE9BwjF,GAAQx5D,SAIVrd,EAAKid,GAAG,6BAA8B,WACrCjd,EAAK62E,UAAUx5D,UAIjBrd,EAAKuoE,KAAK,QAAS3pD,EAASi0D,WAAaj0D,EAASi4D,UASnDA,QAAS,WAMR,MALKA,KACJA,EAAU,GAAID,IAAS34E,KAAM,YAC7B44E,EAAQ/N,YAGF+N,GAQRhO,WAAY,WACX,GAAI7oE,GAAOjK,KAAM6oB,EAAW5e,EAAK4e,QAEjC5e,GAAKs+D,SAEAt+D,EAAKoO,WAAawQ,EAASppB,QAASopB,EAASnpB,SACjDuK,EAAK0lE,iBACL1lE,EAAKunE,WAGF3oD,EAAS0tD,WACZtsE,EAAK+S,SAIPu2D,WAAY,WAGX,QAAS0N,GAAQl6D,GAChB9c,EAAKuoE,KAAK,WAAYzrD,GACtB9c,EAAK8hD,QAAQoH,OAAO,WAAYpsC,GAGjC,QAASooD,GAAOpoD,GACf9c,EAAKuoE,KAAK,UAAWzrD,GACrB9c,EAAK8hD,QAAQoH,OAAO,SAAUpsC,GAT/B,GAAI9c,GAAOjK,IA4BX,OAhBAiK,GAAK8c,MAAMG,GAAG,kBAAmB,SAASnmB,GACzCkgF,EAAQlgF,EAAEQ,SAGX0I,EAAK8c,MAAMG,GAAG,gBAAiB,SAASnmB,GACvCouE,EAAOpuE,EAAEQ,SAGN0I,EAAK8c,MAAM/B,IAAI,aAClBi8D,GAAQ,GAGLh3E,EAAK8c,MAAM/B,IAAI,WAClBmqD,GAAO,GAGDllE,EAAKs+D,UASb1iD,OAAQ,WACP7lB,KAAKuoE,SAEDuY,IACHA,EAAQj7D,SACRi7D,EAAU,QAKb,OAAOC,KAsBRxkF,EAAO,uBACN,qBACE,SAASwkF,GAGX,MAAOA,GAAO1/D,QACbwnD,UACCtnE,MAAO,GAGR+hB,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZ5e,EAAK8hD,QAAQnnC,IAAI,YAEZ3a,EAAK4e,SAASjW,SAClB3I,EAAK4e,SAASjW,OAAS,SAASrR,GAC/B,MAAO5B,MAAK9B,MAAM0D,MAKrBsxE,WAAY,WACX,GAAI5oE,GAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASlqB,KAAKyuE,WAE9C,OACC,YAAcjyE,EAAK,YAAcyN,EAAK8hD,QAAU,iBAC9B7hC,EAAS,8BACRA,EAAS,gCAEVA,EAAS,wBAK7B4oD,WAAY,WACX,GAAI7oE,GAAOjK,IAKX,OAHAiK,GAAKs+D,SACLt+D,EAAK1I,MAAM0I,EAAK4e,SAAStnB,OAElB0I,GAGRspE,WAAY,WAGX,QAAS2N,GAAS3/E,GACjBA,EAAQ0I,EAAK4e,SAASjW,OAAOrR,GAC7B0I,EAAKyjE,QAAQvxD,UAAUpD,UAAYxX,EAAQ,IAC3C0I,EAAKyjE,QAAQ9yD,WAAWA,WAAW4K,MAAM/lB,MAAQ8B,EAAQ,IAL1D,GAAI0I,GAAOjK,IAcX,OANAiK,GAAK8c,MAAMG,GAAG,eAAgB,SAASnmB,GACtCmgF,EAASngF,EAAEQ,SAGZ2/E,EAASj3E,EAAK8c,MAAM/B,IAAI,UAEjB/a,EAAKs+D,cAyBfhsE,EAAO,2BACN,qBACA,qBACA,sBACA,sBACE,SAASiyE,EAASwM,EAASmG,EAAU16E,GACvC,MAAO+nE,GAAQntD,QACd+mD,QAAS4S,GAETnS,UACC9c,QAAS,uBAGVzoC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GAERA,EAASpM,MACZxS,EAAKwS,KAAKoM,EAASpM,MAGhBoM,EAASu4D,OACZn3E,EAAKm3E,KAAOv4D,EAASu4D,MAGlBv4D,EAASkB,QACZ9f,EAAK8f,MAAQlB,EAASkB,OAGnBlB,EAAS3gB,MACZ+B,EAAK8hD,QAAQnnC,IAAI,gBAAkBiE,EAAS3gB,MAGzC2gB,EAASw4D,UAAYx4D,EAASw4D,QAAU,GAAKx4D,EAASw4D,QAAU,KAAOx4D,EAASy4D,YACnFr3E,EAAKq3E,aAAc,GAEnBr3E,EAAK8hD,QAAQnnC,IAAI,aACjB3a,EAAKq3E,aAAc,GAGhBz4D,EAAS04D,cACZt3E,EAAKs3E,YAAc,GAAIJ,IAGxBl3E,EAAKid,GAAG,QAAS,SAASnmB,GACrBA,EAAEnE,OAAO0b,UAAU1S,QAAQqE,EAAKwkE,YAAc,cACjDxkE,EAAK+yE,WAWRnK,WAAY,WACX,GAAI5oE,GAAOjK,KAAMkqB,EAASjgB,EAAKwkE,YAAa2S,EAAO,GAAIE,EAAc,GAAIC,EAAc,GAAIC,EAAoB,EAkB/G,OAhBIv3E,GAAKm3E,OACRA,EAAO,aAAel3D,EAAS,OAAcA,EAAS,KAAOjgB,EAAKm3E,KAAO,UAGtEn3E,EAAK8f,QACRy3D,EAAoB,6BAA+Bv3E,EAAK8f,MAAQ,KAG7D9f,EAAKq3E,cACRA,EAAc,gCAAkCp3D,EAAS,wCAGtDjgB,EAAKs3E,cACRA,EAAct3E,EAAKs3E,YAAY1O,cAI/B,YAAc5oE,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,IAAMy1B,EAAoB,wBAC/EJ,EACA,eAAiBl3D,EAAS,uBAAyBjgB,EAAK8c,MAAM/B,IAAI,QAAU,SAC5Eu8D,EACAD,EACD,UAIFxO,WAAY,WACX,GAAI7oE,GAAOjK,IAMX,OAJAyG,GAAM5E,WAAW,WAChBoI,EAAKqoE,IAAI1rD,SAAS3c,EAAKwkE,YAAc,QAG/BxkE,EAAKs+D,UAGbgL,WAAY,WACX,GAAItpE,GAAOjK,IAQX,OANAiK,GAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrCkJ,EAAKyjE,QAAQ11D,WAAW,GAAGe,UAAYhY,EAAEQ,QAEtC0I,EAAKs3E,aACRt3E,EAAKs3E,YAAYhO,aAEXtpE,EAAKs+D,UAGbyU,MAAO,WACN,GAAI/yE,GAAOjK,IAMX,OAJKiK,GAAKiC,KAAK,SAASlD,sBACvBiB,EAAK4b,SAGC5b,GAQRunE,QAAS,WACR,GAAiBhsD,GAAOpoB,EAApB6M,EAAOjK,IAEXwlB,GAAQvb,EAAKyjE,QAAQloD,MACrBpoB,EAAO6M,EAAKwmE,YAEZjrD,EAAMjmB,KAAOnC,EAAKG,EAAI,KACtBioB,EAAMhmB,IAAMpC,EAAKI,EAAI,KACrBgoB,EAAMsyD,OAAS,YA4BlBv7E,EAAO,+BACN,0BACA,sBACE,SAASklF,EAAch7E,GACzB,MAAO,UAAS5C,GAGf,QAAS69E,KACR,GAAIC,EAAczlF,OACjB,MAAOylF,GAAcA,EAAczlF,OAAS,GAM9C,QAAS0lF,KACRn7E,EAAM7D,sBAAsB,WAC3Bi/E,IACAC,MAMF,QAASD,KACR,IAAK,GAAI5lF,GAAI,EAAGA,EAAI0lF,EAAczlF,OAAQD,IACzC0lF,EAAc1lF,GAAGm+E,OAAO,EAAG,GAI7B,QAAS0H,KACR,GAAIH,EAAczlF,OAAS,EAAG,CAC7B,GAAI6lF,GAAYJ,EAAct/E,MAAM,EAAG,GAAG,GACtCkI,EAAY1G,EAAOoqC,OAASpqC,EAAOm+E,aAAen+E,EAAOo+E,yBAE7D,IADAF,EAAU5H,QAAQ5vE,EAAW,SACzBo3E,EAAczlF,OAAS,EAC1B,IAAK,GAAID,GAAI,EAAGA,EAAI0lF,EAAczlF,OAAQD,IACzC0lF,EAAc1lF,GAAGk+E,QAAQwH,EAAc1lF,EAAI,GAAGyxE,QAAS,UAhC3D,GAAIzjE,GAAOjK,KAAM2hF,IAQjB13E,GAAK03E,cAAgBA,EA8BrB99E,EAAOqjB,GAAG,SAAU,WAGnB,IAFA,GAAIjrB,GAAI0lF,EAAczlF,OAEfD,KACN0lF,EAAc1lF,GAAG+gF,UAInBn5E,EAAOqjB,GAAG,eAAgB46D,GAC1Bj+E,EAAOqjB,GAAG,eAAgB06D,GAQ1B33E,EAAKm4D,KAAO,SAAShgE,GACpB,GAAI8/E,EAkCJ,OAhCAr+E,GAAOu8E,cAAcC,UAAUx8E,GAE/Bq+E,EAAQ,GAAIT,GAAar/E,GACzBu/E,EAActlF,KAAK6lF,GAGf9/E,EAAKi/E,QAAU,IAClBa,EAAMl+E,MAAQnC,WAAW,WACxBqgF,EAAMlF,SACJ56E,EAAKi/E,UAGTa,EAAMh7D,GAAG,QAAS,WACjB,GAAIjrB,GAAI0lF,EAAczlF,MAMtB,KAJIgmF,EAAMl+E,OACTH,EAAO+mD,SAAStnD,aAAa4+E,EAAMl+E,OAG7B/H,KACF0lF,EAAc1lF,KAAOimF,GACxBP,EAAchuE,OAAO1X,EAAG,EAI1B6lF,OAGDI,EAAMnP,WAEN+O,IAEOI,GAQRj4E,EAAK+yE,MAAQ,WACR0E,KACHA,IAAsB1E,SAUxB/yE,EAAKk4E,iBAAmB,WACvB,MAAOR,IAGR99E,EAAOqjB,GAAG,aAAc,WACvB,GAAIk7D,GAAiBv+E,EAAOglB,SAASw5D,eAEjCD,IACHv+E,EAAOs+D,oBAAoBC,MAC1B3lD,KAAM2lE,EACNl6E,KAAM,UACNm5E,QAAS,EACTD,KAAM,UA2BX7kF,EAAO,wBACN,wBACE,SAASu9B,GACX,QAASh8B,GAAOsuB,EAAUk2D,EAAY1oD,GAGrC,IAFA,GAAItyB,MAEGg7E,GAAcA,GAAcl2D,EAAUk2D,EAAaA,EAAWz2E,WACpEvE,EAAKjL,KAAKy9B,EAAS9d,UAAUsmE,EAAY1oD,GAG1C,OAAOtyB,GAGR,QAASlL,GAAQgwB,EAAU9kB,GAC1B,GAAIrL,GAAGic,EAAM5L,CAEb,KAAK4L,EAAOkU,EAAUnwB,EAAIqL,EAAKpL,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAGvD,GAFAqQ,EAAW4L,EAAKF,WAEZ1Q,EAAKrL,GAAKqQ,EAASpQ,OAAS,EAC/B,MAAO,KAGRgc,GAAO5L,EAAShF,EAAKrL,IAGtB,MAAOic,GAGR,OACCpa,OAAQA,EACR1B,QAASA,KAwBXG,EAAO,uBACN,kBACA,yBACA,yBACA,uBACA,oBACA,wBACA,cACA,qBACA,qBACA,+BACA,8BACA,6BACE,SAASygD,EAAIrX,EAAY3M,EAAYupD,EAAU54C,EAAMzT,EAAUxvB,EAAKqb,EAAOtb,EAAOg/B,EAAgBof,EAAeuY,GACnH,MAAO,UAASv5D,GAWf,QAAS2+E,GAAsBhrB,EAAKzwC,GACnC,IACCljB,EAAOklC,SAASkY,YAAYuW,GAAK,EAAOzwC,GACvC,MAAOtlB,KAQV,QAASghF,KACR,GAAIn8E,GAAezC,EAAOklC,SAASziC,YAEnC,OAAOA,GAAeA,EAAe,EAUtC,QAAS0C,GAAmBjI,GAC3B,MAAOA,GAAEiI,qBAWV,QAAS05E,GAAsB3hF,GAC9B,GAAI4hF,GAAeC,CAEf7hF,GAAE8hF,eACDh/E,EAAOqlC,UAAUG,eAAqC,OAApBtoC,EAAEnE,OAAO4qC,SAC9C0B,GAAU95B,OAAOrO,EAAEnE,QAGpB+lF,EAAgB9+E,EAAOqlC,UAAU8N,aAG7B2rC,EAAczmF,OAAS,IAC1B0mF,EAAkBE,GAAuBC,OAAOl/E,EAAOrH,IAAM,IAAMumF,OAAOJ,GAC1E5hF,EAAE8hF,aAAaG,QAAQC,GAAqBL,KAc/C,QAASM,GAAsBniF,GAC9B,GAAI6hF,EAEJ,OAAI7hF,GAAE8hF,eACLD,EAAkB7hF,EAAE8hF,aAAaM,QAAQF,IAErCL,GAAmBA,EAAgBh9E,QAAQk9E,KAAyB,IACvEF,EAAkBA,EAAgBl3D,OAAOo3D,GAAqB5mF,QAAQY,MAAM,MAG3EN,GAAIy1C,SAAS2wC,EAAgB,IAC7BxgE,KAAM6vB,SAAS2wC,EAAgB,MAK3B,KAUR,QAASQ,GAAwB98D,GAC5BziB,EAAOy9D,sBAAsB,6BAChCz9D,EAAOo9C,YAAY,6BAA6B,GAAQ36B,QAASA,IAEjEziB,EAAOo9C,YAAY,oBAAoB,EAAO36B,GA+BhD,QAAS+8D,KA2CR,QAASC,GAAaprE,GACrB,GAAI48B,GAAgBloB,EAAI9D,OAAO6R,mBAAoBvO,EAAWvoB,EAAO+kC,SAErE,IAAqB,MAAjB1wB,EAAK5J,SACR,OAAO,CAGR,MAAO4J,GAAQkU,IAAa0oB,EAAc58B,EAAK5J,UAAW4J,EAAOA,EAAKrM,WACrE,GAAIqM,EAAKpH,YACR,OAAO,CAIT,QAAO,EAGR,QAASyyE,GAA2Bv4B,EAAOC,GAC1C,GAAI/yC,EAEJ,KAAKA,EAAO8yC,EAAMl6C,YAAaoH,GAAQA,GAAQ+yC,EAAO/yC,EAAOA,EAAKpH,YACjE,IAAqB,GAAjBoH,EAAK3M,UAA8C,IAA7ButB,EAAEzY,KAAKnI,EAAKxQ,MAAMxL,SAIxCgc,IAAS+yC,EACZ,OAAO,CAIT,OAAO/yC,KAAS+yC,EAGjB,QAASu4B,GAActrE,EAAM4D,EAASqQ,GACrC,GAAIwT,GAAQn0B,EAASmoC,CAMrB,KAJAA,EAAmB/mB,EAAI9D,OAAO+W,sBAE9BF,EAAS,GAAI3G,GAAW7M,GAAajU,EAAMA,GAEnC1M,EAAUm0B,EAAO7jB,EAAU,OAAS,WAAY,CACvD,GAAI63B,EAAiBnoC,EAAQ8C,YAAcg1E,EAAa93E,GACvD,MAAOA,EAGR,IAAwB,GAApBA,EAAQD,UAAiBC,EAAQ9D,KAAKxL,OAAS,EAClD,MAAOsP,IAKV,QAASi4E,GAA6B79C,GACrC,GAAI89C,GAAYC,EAAUC,EAAiBC,EAAgBhwC,CAE3D,KAAIjO,EAAIhY,YAIR81D,EAAa92D,EAAIwP,UAAUuJ,EAAW6C,QAAQ5C,EAAIvX,eAAgBuX,EAAIrX,aAAc3B,EAAIiO,SACxF8oD,EAAW/2D,EAAIwP,UAAUuJ,EAAW6C,QAAQ5C,EAAInX,aAAcmX,EAAIjX,WAAY/B,EAAIiO,SAClFgZ,EAAoBhwC,EAAOilB,OAAOinB,uBAE9B2zC,GAAcC,GAIb9vC,EAAkB6vC,EAAWp1E,WAAculC,EAAkB8vC,EAASr1E,WAIhC,UAAvCse,EAAI8T,mBAAmBgjD,IAAgE,UAArC92D,EAAI8T,mBAAmBijD,IAwC7E,MApCA/9C,GAAI/W,iBAEJ+0D,EAAkBJ,EAAcE,GAAY,GAC5CG,EAAiBL,EAAcG,GAAU,GAEpC/2D,EAAI8S,QAAQikD,IAChB7qD,EAAE4qD,GAAY59D,OAAO69D,EAAS3rE,YAG/B8gB,EAAE6qD,GAAU99D,SAER+9D,EAC6B,GAA5BA,EAAgBr4E,SACa,MAA5Bq4E,EAAgBt1E,UACnBs3B,EAAI1Y,eAAe02D;AACnBh+C,EAAIxY,aAAaw2D,KAEjBh+C,EAAIzY,cAAcy2D,GAClBh+C,EAAIvY,YAAYu2D,KAGjBh+C,EAAI/Y,SAAS+2D,EAAiBA,EAAgBl8E,KAAKxL,QACnD0pC,EAAI5Y,OAAO42D,EAAiBA,EAAgBl8E,KAAKxL,SAExC2nF,IACqB,GAA3BA,EAAet4E,UAClBq6B,EAAI1Y,eAAe22D,GACnBj+C,EAAIxY,aAAay2D,KAEjBj+C,EAAI/Y,SAASg3D,EAAgB,GAC7Bj+C,EAAI5Y,OAAO62D,EAAgB,KAI7B36C,EAAUge,OAAOthB,IAEV,EAGR,QAASk+C,GAAoBl+C,EAAK6jB,GACjC,GAAIvB,GAAW67B,EAAiBC,EAAWC,EAAiB15E,EAAWid,CAEvE,KAAKoe,EAAIhY,UACR,MAAOgY,EAMR,IAHAr7B,EAAYq7B,EAAIvX,eAChB7G,EAASoe,EAAIrX,YAEa,GAAtBhkB,EAAUgB,SACb,GAAIk+C,GACH,GAAIjiC,EAASjd,EAAU7C,KAAKxL,OAC3B,MAAO0pC,OAGR,IAAIpe,EAAS,EACZ,MAAOoe,EAUV,IALAsiB,EAAYviB,EAAW6C,QAAQ5C,EAAIvX,eAAgBuX,EAAIrX,aACvDy1D,EAAYp3D,EAAIwP,UAAU8rB,EAAWt7B,EAAIiO,SACzCkpD,EAAkBP,EAAc3/E,EAAO+kC,UAAW6gB,EAAWvB,GAC7D+7B,EAAkBr3D,EAAIwP,UAAU2nD,EAAiBn3D,EAAIiO,UAEhDqtB,IAAc67B,EAClB,MAAOn+C,EAGR,IAAIq+C,GAAmBD,GAAaC,EACnC,GAAKx6B,EAoBE,CACN,IAAK85B,EAA2BS,EAAWC,GAC1C,MAAOr+C,EAGkB,IAAtBsiB,EAAU38C,SACa,MAAtB28C,EAAU55C,SACbs3B,EAAI1Y,eAAeg7B,GAEnBtiB,EAAIzY,cAAc+6B,GAGnBtiB,EAAI/Y,SAASq7B,EAAWA,EAAUxgD,KAAKxL,QAGR,GAA5B6nF,EAAgBx4E,SACnBq6B,EAAI5Y,OAAO+2D,EAAiB,GAE5Bn+C,EAAIxY,aAAa22D,OAtCH,CACf,IAAKR,EAA2BU,EAAiBD,GAChD,MAAOp+C,EAGwB,IAA5Bm+C,EAAgBx4E,SACa,MAA5Bw4E,EAAgBz1E,SACnBs3B,EAAI1Y,eAAe62D,GAEnBn+C,EAAIzY,cAAc42D,GAGnBn+C,EAAI/Y,SAASk3D,EAAiBA,EAAgBr8E,KAAKxL,QAG1B,GAAtBgsD,EAAU38C,SACbq6B,EAAI5Y,OAAOk7B,EAAW,GAEtBtiB,EAAIxY,aAAa86B,GAyBpB,MAAOtiB,GAGR,QAASs+C,GAA2Bz6B,GACnC,GAAI7jB,GAAMsD,EAAUC,QAIpB,IAFAvD,EAAMk+C,EAAoBl+C,EAAK6jB,GAE3Bg6B,EAA6B79C,GAChC,OAAO,EAUT,QAASu+C,GAA+B16B,EAAW7jB,GAIlD,QAASw+C,GAA0BC,EAAUnsE,GAsB5C,MArBAosE,GAAqBxrD,EAAE5gB,GAAM0P,UAAUhV,OAAO,SAASyJ,EAAKnE,GAC3D,QAASrU,EAAOilB,OAAOknB,wBAAwB93B,EAAK5J,YAGrDi2E,EAAcF,EAASjhE,WAAU,GAEjCkhE,EAAqBviE,EAAMpP,IAAI2xE,EAAoB,SAAS7tB,GAY3D,MAXAA,GAAaA,EAAWrzC,WAAU,GAE9BmhE,EAAYh+C,iBACfkwB,EAAWl+C,YAAYgsE,EAAY3pE,YACnC2pE,EAAYhsE,YAAYk+C,IAExB8tB,EAAYhsE,YAAYk+C,GAGzB8tB,EAAYhsE,YAAYk+C,GAEjBA,IAGJ6tB,EAAmBpoF,QACtBsoF,EAAK53D,EAAI9uB,OAAO,MAChBwmF,EAAmB,GAAG/rE,YAAYisE,GAClC53D,EAAIle,QAAQ61E,EAAaF,GAEzBz+C,EAAI1Y,eAAes3D,GACnB5+C,EAAIxY,aAAao3D,GACjB3gF,EAAOqlC,UAAUge,OAAOthB,GAEjB4+C,GAGD,KAGR,QAAS13B,GAAY50C,GACpB,MAAOA,IAAQrU,EAAOilB,OAAOinB,uBAAuB73B,EAAKsvB,SAzC1D,GAAIlgC,GAAM+8E,EAAUE,EAAaE,EAAgB/gE,EAChDnZ,EAAWid,EAAQg9D,EAAIF,CA2CxB,IAAK1+C,EAAIhY,YAITrjB,EAAYq7B,EAAIvX,eAChB7G,EAASoe,EAAIrX,YACb81D,EAAWz3D,EAAIwP,UAAU7xB,EAAWqiB,EAAIiO,SACnCiyB,EAAYu3B,IAIjB,GAA0B,GAAtB95E,EAAUgB,SAAe,CAE5B,GADAhB,EAAYA,EAAUyN,WAAWwP,GAC7Bjd,GAAkC,MAArBA,EAAUi9B,QAC1B,MASD,IALC9jB,EADG+lC,EACO46B,EAASvzE,YAETuzE,EAAS3yD,gBAGhB9E,EAAI8S,QAAQ2kD,IAAav3B,EAAYppC,IAAYkJ,EAAI8S,QAAQhc,IAC5D0gE,EAA0BC,EAAU95E,GAEvC,MADAqiB,GAAI/G,OAAOnC,IACJ,MAGH,IAA0B,GAAtBnZ,EAAUgB,SAAe,CAKnC,GAJAjE,EAAOi7E,EAASzkF,OAAOumF,EAAU95E,GACjCk6E,EAAiBJ,EAASjhE,WAAU,GACpC7Y,EAAYg4E,EAASnmF,QAAQqoF,EAAgBn9E,GAEzCmiD,EAAW,CACd,GAAIjiC,GAAUjd,EAAU7C,KAAKxL,OAC5B,MAGDqO,GAAU6mB,WAAW5J,EAAQ,OACvB,CACN,GAAIA,GAAU,EACb,MAGDjd,GAAU6mB,WAAW5J,EAAS,EAAG,GAGlC,GAAIoF,EAAI8S,QAAQ+kD,GACf,MAAOL,GAA0BC,EAAU95E,IAK9C,QAASm6E,GAAaj7B,GACrB,GAAIk7B,GAAkB/+C,EAAKq6B,CAEvBikB,GAA2Bz6B,KAI/B1nC,EAAM1C,KAAKxb,EAAO+kC,UAAUr8B,qBAAqB,KAAM,SAASgZ,GAE5C,QAAfA,EAAIiiB,SACPjiB,EAAI3W,aAAa,kBAAmB,IAIhC2W,EAAI4e,aAAa,mBAAqB5e,EAAI4e,aAAa,UAC3DtgC,EAAO+oB,IAAIuO,UAAU5V,EAAK,QAAS1hB,EAAO+oB,IAAIwO,UAAU7V,EAAK,YAK/Do/D,EAAmB,GAAIC,GAAiB,cACxCD,EAAiBE,QAAQhhF,EAAOklC,UAC/B+7C,WAAW,EACX1uE,YAAY,EACZ2uE,SAAS,EACTC,iBAAkB,WAGnBnhF,EAAOklC,SAASkY,YAAYwI,EAAY,gBAAkB,UAAU,EAAO,MAE3E7jB,EAAM/hC,EAAOqlC,UAAUC,SACvB82B,EAAer6B,EAAIvX,eAAexiB,WAElCkW,EAAM1C,KAAKslE,EAAiBM,cAAe,SAASC,GACnD,GAAKt4D,EAAIgU,UAAUskD,EAAOtoF,OAAQiH,EAAO+kC,WAAzC,CAKA,GAA4B,SAAxBs8C,EAAOC,cAA0B,CACpC,GAAI7a,GAAW4a,EAAOtoF,OAAO6R,aAAa,iBAEtC67D,GACH4a,EAAOtoF,OAAOgS,aAAa,QAAS07D,GAEpC4a,EAAOtoF,OAAOuS,gBAAgB,SAKhC4S,EAAM1C,KAAK6lE,EAAOE,WAAY,SAASltE,GACtC,GAAqB,QAAjBA,EAAK5J,WAAuB4J,EAAKzJ,aAAa,mBAAoB,CACrE,GAAI+Y,GAAQjd,CAER2N,IAAQ+nD,IACXz4C,EAASoe,EAAIrX,YACbhkB,EAAY2N,EAAK0C,YAGlBgS,EAAI/G,OAAO3N,GAAM,GAEb3N,IACHq7B,EAAI/Y,SAAStiB,EAAWid,GACxBoe,EAAI5Y,OAAOziB,EAAWid,GACtB3jB,EAAOqlC,UAAUge,OAAOthB,UAM5B++C,EAAiBU,aAGjBtjE,EAAM1C,KAAKxb,EAAO+oB,IAAIxd,OAAO,yBAA0B,SAASk2E,GAC/DA,EAAKn2E,gBAAgB,sBAravB,GACgDo2E,GAAaC,EADzDj9E,EAAM1E,EAAOklC,SAAUnc,EAAM/oB,EAAO+oB,IAAKsc,EAAYrlC,EAAOqlC,UAC5D07C,EAAmBljF,OAAOkjF,gBAIzBA,KACJW,GAAc,EAEdX,EAAmB,WAGlB,QAASa,GAAW1kF,GACnB,GAAInE,GAASmE,EAAE2kF,aAAe3kF,EAAEnE,MAChC+oF,GAAQtpF,MAAMO,OAAQA,EAAQwoF,YAAaxoF,KAG5C,QAASgpF,GAAa7kF,GACrB,GAAInE,GAASmE,EAAE2kF,aAAe3kF,EAAEnE,MAChC+oF,GAAQtpF,MAAMO,OAAQA,EAAQuoF,cAAepkF,EAAE88B,WAThD,GAAkBjhC,GAAd+oF,IAYJ3lF,MAAK6kF,QAAU,SAAS3sE,GACvBtb,EAASsb,EACTtb,EAAOkK,iBAAiB,qBAAsB2+E,GAAY,GAC1D7oF,EAAOkK,iBAAiB,8BAA+B2+E,GAAY,GACnE7oF,EAAOkK,iBAAiB,kBAAmB2+E,GAAY,GACvD7oF,EAAOkK,iBAAiB,kBAAmB8+E,GAAc,IAG1D5lF,KAAKqlF,WAAa,WACjBzoF,EAAOqK,oBAAoB,qBAAsBw+E,GAAY,GAC7D7oF,EAAOqK,oBAAoB,8BAA+Bw+E,GAAY,GACtE7oF,EAAOqK,oBAAoB,kBAAmBw+E,GAAY,GAC1D7oF,EAAOqK,oBAAoB,kBAAmB2+E,GAAc,IAG7D5lF,KAAKilF,YAAc,WAClB,MAAOU,MAoYV9hF,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,GAAI0oD,GAAY1oD,EAAEg2D,SAAWhoC,GAAQ82D,EAAe9kF,EAAE87C,SAAW97C,EAAEwI,OAEnE,KAAKP,EAAmBjI,KAAO0oD,GAAa1oD,EAAEg2D,SAAW5a,IAAY,CACpE,GAAIvW,GAAM/hC,EAAOqlC,UAAUC,SAAU5+B,EAAYq7B,EAAIvX,eAAgB7G,EAASoe,EAAIrX,WAGlF,IAAIk7B,GAAa1oD,EAAE67C,SAClB,MAGD,IAAIunC,EAA+B16B,EAAW7jB,GAE7C,WADA7kC,GAAEgI,gBAKH,KAAK88E,GAAgBjgD,EAAIhY,WAAmC,GAAtBrjB,EAAUgB,WAC3Ck+C,EAAYjiC,EAASjd,EAAU7C,KAAKxL,OAASsrB,EAAS,GACzD,MAIFzmB,GAAEgI,iBAEE88E,GACHhiF,EAAOqlC,UAAU6e,SAAS+9B,OAAO,SAAUr8B,EAAY,UAAY,WAAY1oD,EAAEwI,QAAU,eAAiB,QAG7Gm7E,EAAaj7B,MAKf5lD,EAAOqjB,GAAG,WAAY,SAASnmB,GAC9B,IAAKiI,EAAmBjI,KAAOmoC,EAAUG,eAAiBtoC,EAAEglF,SAAW,KAAO/oC,EAAGD,eAAeh8C,GAAI,CACnG,GAAI6kC,GAAK0+C,EAAoB0B,EAAcC,EAAa/9B,EAAWg+B,CAEnEtgD,GAAM/hC,EAAOqlC,UAAUC,SACvB+8C,EAAWpuE,OAAOC,aAAahX,EAAEglF,UACjChlF,EAAEgI,iBAGFu7E,EAAqBxrD,EAAE8M,EAAIvX,gBAAgBzG,UAAUhV,OAAO,SAASyJ,EAAKnE,GACzE,QAASrU,EAAOilB,OAAOknB,wBAAwB93B,EAAK5J,YAGrDo2E,GAAa,GAGbJ,EAAqBA,EAAmB1xE,OAAO,SAASyJ,EAAKnE,GAC5D,OAAQ4gB,EAAEltB,SAAS/H,EAAO+kC,UAAW1wB,KAIlCosE,EAAmBpoF,QACtB8pF,EAAep5D,EAAIzK,iBAEnBmiE,EAAmBjlE,KAAK,SAAShD,EAAKo6C,GACrCA,EAAaA,EAAWrzC,WAAU,GAE9B4iE,EAAaz/C,iBAChBkwB,EAAWl+C,YAAYytE,EAAaprE,YACpCorE,EAAaztE,YAAYk+C,KAEzBvO,EAAYuO,EACZuvB,EAAaztE,YAAYk+C,IAG1BuvB,EAAaztE,YAAYk+C,KAG1BvO,EAAU3vC,YAAY1U,EAAOklC,SAAS1X,eAAe60D,IAGrDD,EAAcr5D,EAAIwP,UAAUwJ,EAAIvX,eAAgBzB,EAAIiO,SAChDjO,EAAI8S,QAAQumD,GACfntD,EAAEmtD,GAAavoE,QAAQoI,OAAOkgE,GAE9BpgD,EAAIxW,WAAW42D,GAGhBpgD,EAAI/Y,SAASq7B,EAAUttC,WAAY,GACnCgrB,EAAI5Y,OAAOk7B,EAAUttC,WAAY,GACjC/W,EAAOqlC,UAAUge,OAAOthB,IAExB/hC,EAAOqlC,UAAU+e,WAAWi+B,MAK/BriF,EAAOw9D,WAAW,SAAU,WAC3BqjB,MAGD7gF,EAAOw9D,WAAW,gBAAiB,WAClCqjB,GAAa,KAIVa,IAIJ1hF,EAAOqjB,GAAG,YAAa,SAASnmB,GAC/BykF,EAAet8C,EAAUC,SACzBu5C,EAAsB3hF,KAGvB8C,EAAOqjB,GAAG,OAAQ,SAASnmB,GAC1B,IAAKiI,EAAmBjI,GAAI,CAC3B,GAAI6hF,GAAkBM,EAAsBniF,EAExC6hF,KACH7hF,EAAEgI,iBAMFtC,EAAM7C,iBAAiBC,EAAQ,WAC9B,GAAIsiF,GAAWxgD,EAAWuC,uBAAuBnnC,EAAExD,EAAGwD,EAAEvD,EAAG+K,EAEvDi9E,KACHt8C,EAAUge,OAAOs+B,GACjBA,EAAe,MAGhBd,IACAx7C,EAAUge,OAAOi/B,GACjB/C,EAAwBR,EAAgBxgE,YAM5Cve,EAAOqjB,GAAG,MAAO,SAASnmB,GACpBiI,EAAmBjI,KAAMA,EAAEqlF,eAAkBviF,EAAOqlC,UAAUG,gBAClEtoC,EAAEgI,iBACFhI,EAAEqlF,cAAcC,YAChBtlF,EAAEqlF,cAAcpD,QAAQ,YAAan/E,EAAOqlC,UAAU8N,cACtDj2C,EAAEqlF,cAAcpD,QAAQ,aAAcn/E,EAAOqlC,UAAU8N,YAAYmC,OAAQ,UAK3E1yC,EAAM7C,iBAAiBC,EAAQ,WAC9B6gF,GAAa,SAkBjB,QAAS4B,KACR,QAASC,GAAa3gD,GACrB,GAAIjiC,GAAOipB,GAAI9uB,OAAO,QAClB2oB,EAAWmf,EAAI1W,eAEnB,OADAvrB,GAAK4U,YAAYkO,GACVyiB,GAAUoe,WAAWz7B,UAAUloB,GAAOw1C,OAAQ,SAGtD,QAASqtC,GAAoB5gD,GAC5B,IAAKA,EAAI/Y,SAAU,CAClB,GAAI+Y,EAAIlmB,KACP,OAAO,CAGR,IAAI+mE,GAAU7gD,EAAIoC,WAElB,OADAy+C,GAAQh/C,kBAAkB5jC,EAAO+kC,WAC1BjD,EAAWkC,cAAcjC,EAAK6gD,GAGtC,GAAIv9C,GAAYq9C,EAAa3gD,GAEzB8gD,EAAS95D,GAAIkT,WACjB4mD,GAAO74D,WAAWhqB,EAAO+kC,UAEzB,IAAI+9C,GAAeJ,EAAaG,EAChC,OAAOx9C,KAAcy9C,EAGtB9iF,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,GAAyBsoC,GAAa1lC,EAAlCozD,EAAUh2D,EAAEg2D,OAGhB,KAAK/tD,EAAmBjI,KAAOg2D,GAAWhoC,IAAUgoC,GAAW5a,IAAY,CAK1E,GAJA9S,EAAcxlC,EAAOqlC,UAAUG,cAC/B1lC,EAAOE,EAAO+kC,UAGVS,IAAgBzc,GAAI8S,QAAQ/7B,GAC/B,MAID,KAAK0lC,IAAgBm9C,EAAoB3iF,EAAOqlC,UAAUC,UACzD,MAIDpoC,GAAEgI,iBACFlF,EAAOokD,WAAW,IAEdtkD,EAAKiX,YAAcgS,GAAIiO,QAAQl3B,EAAKiX,YACvC/W,EAAOqlC,UAAUue,kBAAkB9jD,EAAKiX,WAAY,GAEpD/W,EAAOqlC,UAAUue,kBAAkB9jD,EAAM,GAG1CE,EAAOylC,iBAUV,QAASo7B,KACR7gE,EAAO+iF,UAAUhiE,IAAI,SAAU,KAAM,aActC,QAASiiE,KACHhjF,EAAOglB,SAASi+D,kBAUpBl6D,GAAIhtB,KAAKiE,EAAOklC,SAAU,oBAAqB,SAAShoC,GACvD,GAAI6kC,EAEJ,IAAI7kC,EAAEnE,QAAUiH,EAAOklC,SAASvgC,gBAI/B,GAHAo9B,EAAMsD,GAAUC,SAChBtlC,EAAO+kC,UAAU5rB,QAEH,aAAVjc,EAAEmH,KAAqB,CAC1B,GAAIu9B,EAAeT,iBAAiBY,EAAIvX,gBACvC,MAID6a,IAAU4hB,aAAa/pD,EAAEqH,QAASrH,EAAE6H,aAEpCsgC,IAAUge,OAAOthB,KAgBtB,QAASmhD,KACRljF,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,IAAKiI,EAAmBjI,IAAMA,EAAEg2D,UAAY5a,GAAW,CAEtD,IAAKt4C,EAAO+kC,UAAUr8B,qBAAqB,MAAMrQ,OAChD,MAGD,IAAIgtC,GAAUG,eAAwD,IAAvCH,GAAUC,QAAO,GAAM5a,YAAmB,CACxE,GAAIrW,GAAOgxB,GAAUV,UACjB9W,EAAkBxZ,EAAKwZ,eAE3B,IAAqB,MAAjBxZ,EAAK5J,SAGR,MAFAse,IAAI/G,OAAO3N,OACXnX,GAAEgI,gBAIC2oB,IAAmBA,EAAgBpjB,UAAuD,OAA3CojB,EAAgBpjB,SAASC,gBAC3Eqe,GAAI/G,OAAO6L,GACX3wB,EAAEgI,sBAWP,QAASi+E,KAGHtlF,OAAOirB,MAAM1qB,UAAUylC,gBAC3B7jC,EAAOqjB,GAAG,YAAa,SAASnmB,GAC/B,IAAKiI,EAAmBjI,IAA4B,SAAtBA,EAAEnE,OAAO0R,SAAqB,CAC3D,GAAI3K,GAAOE,EAAO+kC,SAGlBjlC,GAAK4uE,OAGL9rE,EAAM7C,iBAAiBC,EAAQ,WAC9BF,EAAKqZ,aAWV,QAASiqE,KACRpjF,EAAOqjB,GAAG,QAAS,SAASnmB,GAC3B,GAAInE,GAASmE,EAAEnE,MAKX,cAAa6I,KAAK7I,EAAO0R,WAAsD,UAAzCse,GAAI+T,yBAAyB/jC,KACtEmE,EAAEgI,iBACFmgC,GAAU6e,SAASkB,iBAAiBrsD,EAAQ,EAAGA,EAAQ,GACvDiH,EAAOylC,eAGe,KAAnB1sC,EAAO0R,UAAmBse,GAAI7J,SAASnmB,EAAQ,qBAClDmE,EAAEgI,iBACFmgC,GAAU95B,OAAOxS,MAiBpB,QAASsqF,KACR,QAASC,KACR,GAAIC,GAAWx6D,GAAIsO,WAAWgO,GAAUE,WAAWhmB,WAAU,GAE7D,OAAO,YACN,GAAIxmB,GAASssC,GAAUE,UAEnBxsC,KAAWiH,EAAO+kC,YACrBhc,GAAIuO,UAAUv+B,EAAQ,QAAS,MAE/ByiB,EAAK+nE,EAAU,SAASltE,GACvBtd,EAAOyqF,iBAAiBntE,EAAKkJ,WAAU,QAM3C,QAASkkE,KACR,OAAQp+C,GAAUG,eACjBzc,GAAIwP,UAAU8M,GAAUE,WAAYxc,GAAIiO,UAAYjO,GAAIwP,UAAU8M,GAAUsX,SAAU5zB,GAAIiO,SAG5Fh3B,EAAOqjB,GAAG,WAAY,SAASnmB,GAC9B,GAAIwmF,EAEJ,KAAKv+E,EAAmBjI,KAAoB,GAAbA,EAAEg2D,SAA6B,IAAbh2D,EAAEg2D,UAAkBuwB,IAKpE,MAJAC,GAAkBJ,IAClBtjF,EAAOklC,SAASkY,YAAY,UAAU,EAAO,MAC7CsmC,IACAxmF,EAAEgI,kBACK,IAIT6jB,GAAIhtB,KAAKiE,EAAOklC,SAAU,MAAO,SAAShoC,GACzC,GAAIwmF,IAECv+E,EAAmBjI,IAAMumF,MAC7BC,EAAkBJ,IAElB1gF,EAAM7C,iBAAiBC,EAAQ,WAC9B0jF,SASJ,QAASC,KACR9jF,SAASC,KAAKiL,aAAa,OAAQ,eAOpC,QAAS64E,KACR5jF,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,IAAKiI,EAAmBjI,IAAMA,EAAEg2D,UAAY5a,IACvCjT,GAAUG,eAAwD,IAAvCH,GAAUC,QAAO,GAAM5a,YAAmB,CACxE,GAAImD,GAAkBwX,GAAUV,UAAU9W,eAC1C,IAAIA,GAAmBA,EAAgBpjB,UAAuD,UAA3CojB,EAAgBpjB,SAASC,cAE3E,MADAxN,GAAEgI,kBACK,KAWZ,QAAS2+E,KAEJjF,IAAoB,IAMxBD,EAAsB,6BAA6B,GACnD3+E,EAAO29C,cAAcnlD,KAAK,0CAC1BuwB,GAAIhG,SAAS/iB,EAAO+kC,UAAW,kBAG/B0M,GAAOf,cAAc,MAAO,SAAS1vB,GAGpC,IAFA,GAAsB8iE,GAASx2E,EAAG4zD,EAAOrhD,EAArCznB,EAAI4oB,EAAM3oB,OAEPD,KAGN,IAFA0rF,EAAU9iE,EAAM5oB,GAAGwuC,OAAO,MAC1Bt5B,EAAIw2E,EAAQzrF,OACLiV,KACN4zD,EAAQ4iB,EAAQx2E,GAGhBuS,EAAUqhD,EAAMj9C,KACZpE,GAA4B,IAAjBA,EAAQxb,MAAyD,MAA3Cwb,EAAQniB,MAAMojB,OAAOjB,EAAQniB,MAAQ,GACzEmiB,EAAQniB,OAAS,KAEjBwjE,EAAM1sD,OAAO8xB,OAAO,GAAIR,GAAK,QAAS,GAAIo7B,GAAO,GAAMxjE,MAAQ,OAOnE+lD,GAAW/S,cAAc,MAAO,SAAS1vB,GAGxC,IAFA,GAAsB8iE,GAASx2E,EAAG4zD,EAAOrhD,EAArCznB,EAAI4oB,EAAM3oB,OAEPD,KAGN,IAFA0rF,EAAU9iE,EAAM5oB,GAAGwuC,OAAO,MAC1Bt5B,EAAIw2E,EAAQzrF,OACLiV,KACN4zD,EAAQ4iB,EAAQx2E,GAChBuS,EAAUqhD,EAAMj9C,KACZpE,GAA2B,GAAhBA,EAAQxb,OACtBwb,EAAQniB,MAAQmiB,EAAQniB,MAAMmN,QAAQ,SAAU,QAUrD,QAASk5E,KACRh7D,GAAIhtB,KAAKiE,EAAO+kC,UAAW,UAAW,WACrC,GAAIrnC,GAAO2W,EAAOgxB,GAAUV,SAGP,QAAjBtwB,EAAK5J,YAEH/M,EAAQqrB,GAAIqP,SAAS/jB,EAAM,YAC/B0U,GAAIuO,UAAUjjB,EAAM,QAAS3W,EAAMmN,QAAQ,YAAa,KACxDke,GAAIwQ,SAASllB,EAAM,QAAS,MAIxB3W,EAAQqrB,GAAIqP,SAAS/jB,EAAM,aAC/B0U,GAAIuO,UAAUjjB,EAAM,SAAU3W,EAAMmN,QAAQ,YAAa,KACzDke,GAAIwQ,SAASllB,EAAM,SAAU,QAejC,QAAS2vE,KAERhkF,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,GAAI6kC,GAAKr7B,EAAWid,EAAQzK,EAAM1E,CAElC,KAAIrP,EAAmBjI,IAAMA,EAAEg2D,SAAW/Z,EAAGb,YAI7CvW,EAAMsD,GAAUC,SAChB5+B,EAAYq7B,EAAIvX,eAChB7G,EAASoe,EAAIrX,YACbxR,EAAO6P,GAAIgO,UACXviB,EAAS9N,EAEJq7B,EAAIhY,WAAwB,IAAXpG,GAAtB,CAIA,KAAOnP,GAAUA,EAAOxM,YAAcwM,EAAOxM,WAAW+O,YAAcvC,GAAUA,EAAOxM,YAAckR,GACpG1E,EAASA,EAAOxM,UAIM,gBAAnBwM,EAAOmvB,UAEV3jC,EAAOgoD,UAAUsH,OAAO,aAAc,KAAM96C,GAG5CutB,EAAMhZ,GAAIkT,YACV8F,EAAI/Y,SAAStiB,EAAW,GACxBq7B,EAAI5Y,OAAOziB,EAAW,GACtB2+B,GAAUge,OAAOthB,OAQpB,QAASkiD,KACR,QAASC,KACRC,IAEAxF,EAAsB,gBAAgB,GACtCA,EAAsB,4BAA4B,GAE7C35D,GAASq0B,iBACbslC,EAAsB,wBAAwB,GAI3C35D,GAASvE,UACbzgB,EAAOqjB,GAAG,8BAA+B6gE,GAc3C,QAASE,KACR,QAASC,KACR7oE,EAAKuN,GAAIxd,OAAO,KAAM,SAAS8I,GAC9B,GAAIrM,GAAaqM,EAAKrM,WAAYkR,EAAO6P,GAAIgO,SAE7C,IAAI/uB,EAAWsQ,YAAcjE,EAAM,CAClC,KAAOrM,IAAe+gB,GAAIiO,QAAQhvB,IAAa,CAC9C,GAAIA,EAAWA,WAAWsQ,YAActQ,GAAcA,IAAekR,EACpE,MAGDlR,GAAaA,EAAWA,WAGzB+gB,GAAIhI,IAAI/Y,EAAY,MAAOm0C,iBAAkB,OAKhDn8C,EAAOqjB,GAAG,yBAA0B,SAASnmB,GAC9B,cAAVA,EAAEmH,MAAsC,kBAAdnH,EAAE02D,SAC/BywB,MASH,QAASC,KACJt/D,GAASgtB,mBACZhyC,EAAOqjB,GAAG,OAAQ,WACjBs7D,EAAsB,4BAA6B35D,GAASgtB,qBAQ/D,QAASuyC,KACRvkF,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,GAAI6kC,EAEC58B,GAAmBjI,IAAMA,EAAEg2D,SAAW5a,KAC1CvW,EAAM/hC,EAAOklC,SAASG,UAAUnJ,cAC5B6F,GAAOA,EAAIlmB,OACd3e,EAAEgI,iBACFlF,EAAO02D,YAAY7C,eACnB9qC,GAAI/G,OAAO+f,EAAIlmB,KAAK,IACpB7b,EAAO02D,YAAY31C,UAWvB,QAASyjE,KACR,GAAIC,EAGA7F,MAAqB,KACxB6F,EAAiB,GACjBjpE,EAAK,0BAA0BviB,MAAM,KAAM,SAAS8J,EAAM3K,GACzDqsF,IAAmBrsF,EAAI,EAAI,IAAM,IAAM2K,EAAO,WAG/C/C,EAAO29C,cAAcnlD,KAAKisF,EAAiB,oCAQ7C,QAASC,KACJ9F,IAAoB,IACvBntC,GAAOf,cAAc,WAAY,SAAS1vB,GAGzC,IAFA,GAAsB3M,GAAMgtB,EAAxBjpC,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACbipC,EAAWhtB,EAAK0C,WAEZsqB,GACHhtB,EAAKgC,KAAK,qBAAsBgrB,EAAS3jC,SAK5C+lD,GAAW/S,cAAc,WAAY,SAAS1vB,GAG7C,IAFA,GAAsB3M,GAAMgtB,EAAU3jC,EAAlCtF,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACbipC,EAAWrgB,EAAM5oB,GAAG2e,WAEhBsqB,EACHA,EAAS3jC,MAAQ20B,EAASrL,OAAOqa,EAAS3jC,QAG1CA,EAAQ2W,EAAK9B,WAAWzD,IAAI,sBACxBpR,IACH2W,EAAKgC,KAAK,qBAAsB,MAChCgrB,EAAW,GAAIyE,GAAK,QAAS,GAC7BzE,EAAS3jC,MAAQA,EACjB2jC,EAAS4Q,KAAM,EACf59B,EAAK4N,OAAOof,QAWlB,QAASsjD,KAIR,QAASC,GAAalrF,EAAGC,GACxB,GAAIooC,GAAMjiC,EAAK4jC,iBAEf,KACC3B,EAAIgC,YAAYrqC,EAAGC,GAClB,MAAOiE,GAERmkC,EAAM,KAGP,MAAOA,GAIR,QAAS2D,GAAgBxoC,GACxB,GAAIolF,EAGAplF,GAAE6c,QAELuoE,EAAWsC,EAAa1nF,EAAExD,EAAGwD,EAAEvD,GAE3B2oF,IAECA,EAAShsC,iBAAiB,eAAgBuuC,GAAY,EACzDvC,EAAS3qC,YAAY,eAAgBktC,GAErCvC,EAAS3qC,YAAY,WAAYktC,GAGlCvC,EAAS/2E,WAGVu5E,IAKF,QAASA,KACR,GAAI/iD,GAAMr9B,EAAI2gC,UAAUnJ,aAGpB2oD,KAAa9iD,EAAIlmB,MAAoD,IAA5CkmB,EAAIuU,iBAAiB,aAAcvU,IAC/D8iD,EAASt5E,SAGVwd,GAAI9gB,OAAOvD,EAAK,UAAWogF,GAC3B/7D,GAAI9gB,OAAOvD,EAAK,YAAaghC,GAC7Bm/C,EAAWE,EAAU,EAnDtB,GAAoCA,GAASF,EAAUG,EAAnDtgF,EAAMqkB,GAAIrkB,IAAK5E,EAAO4E,EAAI5E,IAuD9B4E,GAAIC,gBAAgB03C,cAAe,EAGnCtzB,GAAIhtB,KAAK2I,EAAK,wBAAyB,SAASxH,GAC/C,GAA0B,SAAtBA,EAAEnE,OAAO0R,SAAqB,CAOjC,GANIs6E,GACHD,IAIDE,EAAUtgF,EAAIC,gBACVqgF,EAAQjqC,aAAeiqC,EAAQhtD,aAClC,MAGD+sD,GAAU,EAEVF,EAAWD,EAAa1nF,EAAExD,EAAGwD,EAAEvD,GAC3BkrF,IAEH97D,GAAIhtB,KAAK2I,EAAK,UAAWogF,GACzB/7D,GAAIhtB,KAAK2I,EAAK,YAAaghC,GAE3B3c,GAAIgO,UAAU5d,QACd0rE,EAASt5E,aAUb,QAAS05E,KAERjlF,EAAOqjB,GAAG,wBAAyB,SAASnmB,GAC1B,IAAbA,EAAEg2D,SAAkB/Z,EAAGD,eAAeh8C,IACzCmoC,GAAU1C,cAET,GAMJ,QAASuiD,KACRllF,EAAO29C,cAAcnlD,KACpB,mFAeF,QAAS2sF,KACHnlF,EAAOoqC,QACXpqC,EAAOqjB,GAAG,UAAW,WAChBxjB,SAASuZ,eAAiBvZ,SAASC,MACtCE,EAAO+mD,SAAS5tC,UAepB,QAASisE,KACHplF,EAAOoqC,SACXpqC,EAAO29C,cAAcnlD,KAAK,4BAC1BwH,EAAOqjB,GAAG,QAAS,SAASnmB,GAC3B,GAAI6kC,EAEJ,IAAyB,QAArB7kC,EAAEnE,OAAO0R,SAAoB,CAGhC,GAAI5H,EAAIhC,GAAK,GAEZ,WADAb,GAAO+kC,UAAU5rB,OAKlB4oB,GAAM/hC,EAAOqlC,UAAUC,SACvBtlC,EAAO+kC,UAAU5rB,QACjBnZ,EAAOqlC,UAAUge,OAAOthB,GACxB/hC,EAAOqlC,UAAU1C,YACjB3iC,EAAOylC,kBAUX,QAAS4/C,KACJxiF,EAAI5B,KACPjB,EAAOqjB,GAAG,UAAW,SAASnmB,IACzBi8C,EAAGD,eAAeh8C,IAAOA,EAAE67C,UAA0B,IAAb77C,EAAEg2D,SAA8B,IAAbh2D,EAAEg2D,UAChEh2D,EAAEgI,iBACFlF,EAAOqlC,UAAU6e,SAAS+9B,OAAO,OAAqB,IAAb/kF,EAAEg2D,QAAgB,WAAa,UAAW,mBASvF,QAASoyB,KACR3G,EAAsB,iBAAiB,GAQxC,QAAS4G,KACRvlF,EAAOqjB,GAAG,QAAS,SAASnmB,GAC3B,GAAIwkB,GAAMxkB,EAAEnE,MAEZ,GACC,IAAoB,MAAhB2oB,EAAIiiB,QAEP,WADAzmC,GAAEgI,uBAGMwc,EAAMA,EAAI1Z,cAGrBhI,EAAO29C,cAAcnlD,KAAK,mDAgE3B,QAASgtF,KACRxlF,EAAOqjB,GAAG,OAAQ,WACjBrjB,EAAO+oB,IAAIhtB,KAAKiE,EAAO+kC,UAAW,SAAU,SAAS7nC,GACpDA,EAAEgI,qBAaL,QAASugF,KACRh0C,GAAOf,cAAc,KAAM,SAAS1vB,GAGnC,IAFA,GAAI5oB,GAAI4oB,EAAM3oB,OAEPD,KACwB,6BAA1B4oB,EAAM5oB,GAAGie,KAAK,UACjB2K,EAAM5oB,GAAG4pB,WAUb,QAAS0jE,KACR1lF,EAAOqjB,GAAG,YAAa,SAASnmB,GAC/B2hF,EAAsB3hF,KAGvB8C,EAAOqjB,GAAG,OAAQ,SAASnmB,GAC1B,IAAKiI,EAAmBjI,GAAI,CAC3B,GAAI6hF,GAAkBM,EAAsBniF,EAE5C,IAAI6hF,GAAmBA,EAAgBpmF,IAAMqH,EAAOrH,GAAI,CACvDuE,EAAEgI,gBAEF,IAAI68B,GAAMD,EAAWuC,uBAAuBnnC,EAAExD,EAAGwD,EAAEvD,EAAGqG,EAAOklC,SAC7DG,IAAUge,OAAOthB,GACjBw9C,EAAwBR,EAAgBxgE,UAM5C,QAAS4lE,KACR,GAAIrkF,GAAM0U,CAGNsmB,OACHh7B,EAAOE,EAAO+kC,UACdvwB,EAAS1U,EAAKkI,WAEdwM,EAAOpI,YAAYtM,GACnB0U,EAAOE,YAAY5U,GAEnBA,EAAKqZ,SAIP,QAAS2hB,KACR,GAAI6pB,EAEJ,OAAKghC,KAKLhhC,EAAM3kD,EAAOqlC,UAAU6e,UACdS,IAAQA,EAAIK,YAAiC,IAAnBL,EAAIK,YAL/B,EAYT,QAAS4gC,KACR,QAASC,GAAqB7lF,GAC7B,GAAIq6D,GAAc,GAAId,GAAYv5D,EAAO+kC,WACrChD,EAAM/hC,EAAOqlC,UAAUC,SACvBwgD,EAAgB9kC,EAAcK,eAAetf,GAC7CgkD,EAAc/kC,EAAcM,aAAavf,EAE7C,QAAQ/hC,EAAOqlC,UAAUG,gBAAkB60B,EAAYp2C,KAAK6hE,KAAmBzrB,EAAYr2C,KAAK+hE,GAIjG/lF,EAAOqjB,GAAG,WAAY,SAAUnmB,IAC1BiI,EAAmBjI,KAAOmoC,GAAUG,eAAiBtoC,EAAEglF,SAAW,KAAO/oC,EAAGD,eAAeh8C,IAC3F2oF,EAAqB7lF,KACxB9C,EAAEgI,iBACFlF,EAAOokD,WAAWnwC,OAAOC,aAAahX,EAAEglF,WACxCliF,EAAOqlC,UAAU95B,OAAOvL,EAAO+kC,WAAW,GAC1C/kC,EAAOqlC,UAAU5b,UAAS,GAC1BzpB,EAAOylC,iBAKVzlC,EAAOqjB,GAAG,UAAW,SAAUnmB,GAC9B,GAAIg2D,GAAUh2D,EAAEg2D,OAEX/tD,GAAmBjI,IAAOg2D,GAAWhoC,IAAUgoC,GAAW5a,IAC1DutC,EAAqB7lF,KACxB9C,EAAEgI,iBACFlF,EAAOokD,WAAW,IAClBpkD,EAAOylC,iBAhoDX,GAAIjqB,GAAO0C,EAAM1C,KAAMyZ,EAAIj1B,EAAOi1B,EAC9BqjB,GAAYa,EAAGb,UAAWptB,GAASiuB,EAAGjuB,OAAQnC,GAAM/oB,EAAO+oB,IAAKsc,GAAYrlC,EAAOqlC,UACtFrgB,GAAWhlB,EAAOglB,SAAUysB,GAASzxC,EAAOyxC,OAAQgS,GAAazjD,EAAOyjD,WACrEkiC,GAAU9iF,EAAI7B,MAAOs1B,GAAOzzB,EAAIhC,GAAImlF,GAAWnjF,EAAIjC,OACnDq+E,GAAuB,0BACvBG,GAAsB9oD,GAAO,OAAS,KAssD1C,OApEA0tD,KACAvB,IAIK5/E,EAAItB,cACR0jF,IAIGe,KACHJ,IACApG,IACAwD,IACAI,IACAkB,IACAkB,IACA5B,IACA6B,IAKI5iF,EAAIT,KACP+iF,IACAC,IACAG,KAEA1kB,KAKEvqC,IAAQzzB,EAAIhC,GAAK,KACpBqiF,IACAS,IACAE,IACAE,IACAQ,IACAC,IACAE,IACAC,KAGG9hF,EAAIhC,IAAM,KACbukF,IACAxB,KAGG/gF,EAAIhC,KACPggE,IACAykB,IACAI,KAIGC,KACHC,IACA1C,IACAC,IACAE,IACAY,IACAG,IACAc,IACAG,IACAzB,MAIAO,uBAAwBA,EACxBrpD,SAAUA,MAuBbpiC,EAAO,4BACN,0BACA,uBACA,sBACE,SAAS6tE,EAAYtwC,EAAU/X,GAajC,QAAS+nE,GAAejmF,EAAQkmF,GAC/B,MAAiB,mBAAbA,EACIlmF,EAAOklC,UAKVllC,EAAOoqC,QAAU,iDAAiDxoC,KAAKskF,GACpElmF,EAAOklC,SAASvgC,gBAIpB3E,EAAOglB,SAASmhE,YACdnmF,EAAOomF,YACXpmF,EAAOomF,UAAY3rD,EAAIlvB,OAAOvL,EAAOglB,SAASmhE,YAAY,IAGpDnmF,EAAOomF,WAGRpmF,EAAO+kC,UAWf,QAASshD,GAAkBrmF,EAAQkmF,GAGlC,QAASI,GAAYtmF,GACpB,OAAQA,EAAO2rE,SAAW3rE,EAAOygB,SAHlC,GAAsD+oD,GAAlD+c,EAAeN,EAAejmF,EAAQkmF,EAU1C,IAJKlmF,EAAOwmF,YACXxmF,EAAOwmF,eAGJxmF,EAAOwmF,UAAUN,GAIrB,GAAIlmF,EAAOglB,SAASmhE,WAAY,CAkB/B,GAjBKM,IACJA,KACAzmF,EAAOu8E,cAAcl5D,GAAG,eAAgB,WACvC,GAAItgB,EAEJ,KAAK/C,EAAOu8E,cAAcmK,cACrBD,EAA0B,CAC7B,IAAK1jF,IAAQ0jF,GACZzmF,EAAO+oB,IAAI9gB,OAAOg+E,EAAejmF,EAAQ+C,GAG1C0jF,GAA2B,SAM3BA,EAAyBP,GAC5B,MAGD1c,GAAW,SAAStsE,GAGnB,IAFA,GAAInE,GAASmE,EAAEnE,OAAQ4tF,EAAU3mF,EAAOu8E,cAAcoK,QAASvuF,EAAIuuF,EAAQtuF,OAEpED,KAAK,CACX,GAAI0H,GAAO6mF,EAAQvuF,GAAG2sC,WAElBjlC,IAAS/G,GAAU0hC,EAAIsC,UAAUhkC,EAAQ+G,KACxCwmF,EAAYK,EAAQvuF,KACvBuuF,EAAQvuF,GAAGiQ,KAAK69E,EAAWhpF,KAM/BupF,EAAyBP,GAAa1c,EACtC/uC,EAAI1+B,KAAKwqF,EAAcL,EAAW1c,OAElCA,GAAW,SAAStsE,GACfopF,EAAYtmF,IACfA,EAAOqI,KAAK69E,EAAWhpF,IAIzBu9B,EAAI1+B,KAAKwqF,EAAcL,EAAW1c,GAClCxpE,EAAOwmF,UAAUN,GAAa1c,EAxGhC,GAAwBid,GAApBhsD,EAAMxE,EAASwE,IA4GfmsD,GAMHC,0BAA2B,WAC1B,GAAIzgF,GAAOjK,IAEX+hB,GAAM1C,KAAKpV,EAAK0gF,qBAAsB,SAAS/jF,GAC9CsjF,EAAkBjgF,EAAMrD,MAU1BqjE,kBAAmB,SAASrjE,EAAMmgB,GACjC,GAAI9c,GAAOjK,IAGC,UAAR4G,GAA2B,QAARA,IAInBmgB,EACC9c,EAAKu/B,YACR0gD,EAAkBjgF,EAAMrD,GAEnBqD,EAAK0gF,qBAGT1gF,EAAK0gF,qBAAqBtuF,KAAKuK,GAF/BqD,EAAK0gF,sBAAwB/jF,GAKrBqD,EAAKu/B,cACfv/B,EAAK2iB,IAAI9gB,OAAOg+E,EAAe7/E,EAAMrD,GAAOA,EAAMqD,EAAKogF,UAAUzjF,UAC1DqD,GAAKogF,UAAUzjF,MASxBgkF,sBAAuB,WACtB,GAAiBhkF,GAAbqD,EAAOjK,IAEX,IAAIiK,EAAKogF,UAAW,CACnB,IAAKzjF,IAAQqD,GAAKogF,UACjBpgF,EAAK2iB,IAAI9gB,OAAOg+E,EAAe7/E,EAAMrD,GAAOA,EAAMqD,EAAKogF,UAAUzjF,UAG3DqD,GAAKogF,UAGRpgF,EAAKgkC,SACThkC,EAAK2+B,UAAUhQ,OAAS,KACxB3uB,EAAK2iB,IAAI9gB,OAAO7B,EAAK2gD,UACrB3gD,EAAK2iB,IAAI9gB,OAAO7B,EAAK8+B,WAGtB9+B,EAAK2iB,IAAI9gB,OAAO7B,EAAK2+B,WACrB3+B,EAAK2iB,IAAI9gB,OAAO7B,EAAKipD,iBAMvB,OAFAu3B,GAAmB1oE,EAAMV,UAAW+oD,EAAYqgB,KAuBjDluF,EAAO,kBAAoB,WAC1B,QAASimF,GAAsB3+E,EAAQ2zD,EAAKzwC,GAC3C,IACCljB,EAAOklC,SAASkY,YAAYuW,GAAK,EAAOzwC,GACvC,MAAOtlB,KAKV,QAASopF,GAAahnF,GACrB,GAAIjH,GAAQwT,CAYZ,OAVAxT,GAASiH,EAAO+kC,UAEhBx4B,EAAU,SAASrP,GACd8C,EAAO+oB,IAAIyP,WAAWt7B,EAAEnE,OAAQ,KAAKV,OAAS,GACjD6E,EAAEgI,kBAIJlF,EAAO+oB,IAAIhtB,KAAKhD,EAAQ,QAASwT,IAGhCtE,OAAQ,WACPjI,EAAO+oB,IAAI9gB,OAAOlP,EAAQ,QAASwT,KAKtC,QAAS06E,GAAejnF,EAAQkjB,GAC3BljB,EAAOknF,gBACVlnF,EAAOknF,cAAcj/E,SACrBjI,EAAOknF,cAAgB,MAGpBhkE,GACHljB,EAAOknF,cAAgBF,EAAahnF,GACpCA,EAAOqlC,UAAUse,iBAAiB/H,iBAClC57C,EAAOygB,UAAW,EAClBzgB,EAAO+kC,UAAU7iC,iBAAkB,IAEnClC,EAAOygB,UAAW,EAClBzgB,EAAO+kC,UAAU7iC,iBAAkB,EACnCy8E,EAAsB3+E,EAAQ,gBAAgB,GAC9C2+E,EAAsB3+E,EAAQ,4BAA4B,GAC1D2+E,EAAsB3+E,EAAQ,wBAAwB,GACtDA,EAAOmZ,QACPnZ,EAAOylC,eAIT,QAAS0hD,GAAQnnF,EAAQ8nC,GACxB,GAAIs/C,GAAcpnF,EAAOygB,SAAW,WAAa,QAE7CqnB,IAAQs/C,IAIRpnF,EAAO2lC,YACVshD,EAAejnF,EAAgB,YAAR8nC,GAEvB9nC,EAAOqjB,GAAG,OAAQ,WACjB4jE,EAAejnF,EAAgB,YAAR8nC,KAKzB9nC,EAAOqI,KAAK,cAAey/B,KAAMA,KAGlC,OACCq/C,QAASA,KA0BXzuF,EAAO,qBACN,qBACA,eACE,SAASwlB,EAAOrb,GAClB,GAAI2Y,GAAO0C,EAAM1C,KAAMmC,EAAUO,EAAMP,QAEnC0pE,GACHC,GAAM,IACNC,IAAO,IACPC,IAAO,KAGJC,EAAgBvpE,EAAMtB,QAAQ,6BAElC,OAAO,UAAS5c,GAGf,QAAS0nF,GAAchwE,GACtB,GAAI/e,GAAIgT,EAAKg8E,IAGbnsE,GAAKmC,EAAQjG,EAAS,KAAM,SAASha,GAChCA,IAAS+pF,GACZE,EAASjqF,IAAS,EAGd,cAAckE,KAAKlE,GACtBiqF,EAASz0B,QAAU5tC,SAAS5nB,EAAO,KAEnCiqF,EAASzF,SAAWxkF,EAAM+0B,WAAW,GACrCk1D,EAASz0B,QAAUm0B,EAAc3pF,IAAUA,EAAM8jB,cAAciR,WAAW,MAM7E95B,GAAMgvF,EAASz0B,QACf,KAAKvnD,IAAO87E,GACPE,EAASh8E,GACZhT,EAAGH,KAAKmT,GAERg8E,EAASh8E,IAAO,CA0BlB,OAvBAg8E,GAAShvF,GAAKA,EAAGwS,KAAK,KAGlBw8E,EAASC,SACZD,EAASE,KAAM,EAEXhlF,EAAI5B,IACP0mF,EAAStwC,MAAO,EAEhBswC,EAAS57E,OAAQ,GAKf47E,EAASG,OACRjlF,EAAI5B,IACP0mF,EAASG,MAAO,GAEhBH,EAAStwC,MAAO,EAChBswC,EAASG,MAAO,IAIXH,EAGR,QAASI,GAAerwE,EAASswE,EAAMC,EAASrhF,GAC/C,GAAIm8E,EAQJ,OANAA,GAAY7kE,EAAMpP,IAAI6O,EAAQjG,EAAS,KAAMgwE,GAC7C3E,EAAUA,EAAU1qF,OAAS,GAAK6lB,EAAMV,OAAOulE,EAAUA,EAAU1qF,OAAS,IAC3EgI,KAAM4nF,EACNrhF,MAAOA,GAAS5G,IAGVke,EAAMV,OAAOulE,EAAU,IAC7BiF,KAAMhoF,EAAOq+D,UAAU2pB,GACvBE,YAAanF,EAAUvkF,MAAM,KAI/B,QAAS2pF,GAAYjrF,GACpB,MAAOA,GAAE+7C,QAAU/7C,EAAE87C,SAAW97C,EAAEwI,QAGnC,QAAS0iF,GAAclrF,GACtB,MAAOA,GAAEg2D,SAAW,KAAOh2D,EAAEg2D,SAAW,IAGzC,QAASm1B,GAAcnrF,EAAGyqF,GACzB,QAAKA,IAIDA,EAAStwC,MAAQn6C,EAAE87C,SAAW2uC,EAASG,MAAQ5qF,EAAEwI,UAIjDiiF,EAASE,KAAO3qF,EAAE+7C,QAAU0uC,EAAS57E,OAAS7O,EAAE67C,cAIhD77C,EAAEg2D,SAAWy0B,EAASz0B,SAAYh2D,EAAEglF,UAAYhlF,EAAEglF,UAAYyF,EAASzF,YAC1EhlF,EAAEgI,kBACK,MAMT,QAASojF,GAAsBX,GAC9B,MAAOA,GAAStnF,KAAOsnF,EAAStnF,KAAK/C,KAAKqqF,EAAS/gF,OAAS,KApG7D,GAAIR,GAAOjK,KAAM4mF,KAAgBwF,IAuGjCvoF,GAAOqjB,GAAG,yBAA0B,SAASnmB,IACvCirF,EAAYjrF,KAAMkrF,EAAclrF,IAAQA,EAAEiI,uBAC9CqW,EAAKunE,EAAW,SAAS4E,GACxB,GAAIU,EAAcnrF,EAAGyqF,GAOpB,MANAY,GAAkBZ,EAASO,YAAY1pF,MAAM,GAE/B,WAAVtB,EAAEmH,MACLikF,EAAsBX,IAGhB,IAILU,EAAcnrF,EAAGqrF,EAAgB,MACL,IAA3BA,EAAgBlwF,QACL,WAAV6E,EAAEmH,MACLikF,EAAsBC,EAAgB,IAIxCA,EAAgBx8E,YAenB3F,EAAK2a,IAAM,SAASrJ,EAASswE,EAAMC,EAASrhF,GAC3C,GAAI+sD,EAmBJ,OAjBAA,GAAMs0B,EAEiB,gBAAZA,GACVA,EAAU,WACTjoF,EAAOo9C,YAAYuW,GAAK,EAAO,OAEtBz1C,EAAMjgB,QAAQ01D,KACxBs0B,EAAU,WACTjoF,EAAOo9C,YAAYuW,EAAI,GAAIA,EAAI,GAAIA,EAAI,MAIzCn4C,EAAKmC,EAAQO,EAAM1B,KAAK9E,EAAQhN,gBAAiB,SAASgN,GACzD,GAAIiwE,GAAWI,EAAerwE,EAASswE,EAAMC,EAASrhF,EACtDm8E,GAAU4E,EAAShvF,IAAMgvF,KAGnB,GAURvhF,EAAK4b,OAAS,SAAStK,GACtB,GAAIiwE,GAAWI,EAAerwE,EAE9B,SAAIqrE,EAAU4E,EAAShvF,YACfoqF,GAAU4E,EAAShvF,KACnB,OAuCXD,EAAO,yBACN,uBACA,qBACA,oBACE,SAASwD,EAASgiB,EAAO0hC,GAC3B,MAAO,UAAS4oC,EAAcxjE,GAG7B,QAASyjE,GAASC,GACjB,GAAIjrE,GAAKkrE,CAWT,OATAA,IACCC,aAAc,MACdC,YAAa,MACbC,YAAa,MACbC,YAAa,OAGdtrE,EAAMkrE,EAAWD,EAASM,OAAO3kF,KAAKqG,gBAAkB,MAEjDg+E,EAAS/vF,KAAO,IAAM8kB,EAG9B,QAASwrE,GAASC,EAAOC,GACxB,MAAID,GACIA,EAAMr+E,QAAQ,MAAO,IAAM,IAAMs+E,EAAMt+E,QAAQ,MAAO,IAGvDs+E,EAGR,QAASC,GAAeV,GACvB,OACC/vF,GAAI+vF,EAAS/vF,GACbqwF,KAAMN,EAASM,KACfK,OAAQX,EAASW,OACjBC,SAAU1pC,EAAI7B,SAAS0qC,EAASC,KAIlC,QAASa,GAAeb,EAAUc,EAASC,EAASC,GACnD,GAAIC,GAAKC,CAETD,GAAM,GAAIE,gBACVF,EAAIprB,KAAK,OAAQv5C,EAASlH,KAC1B6rE,EAAIG,gBAAkB9kE,EAAS+kE,YAE/BJ,EAAIK,OAAOC,WAAa,SAAS/sF,GAChCwsF,EAASxsF,EAAEgtF,OAAShtF,EAAEitF,MAAQ,MAG/BR,EAAI30D,QAAU,WACby0D,EAAQ,2DAA6DE,EAAIp2D,SAG1Eo2D,EAAI50D,OAAS,WACZ,GAAIq1D,EAEJ,OAAkB,MAAdT,EAAIp2D,WACPk2D,GAAQ,eAAiBE,EAAIp2D,SAI9B62D,EAAOC,KAAKlkE,MAAMwjE,EAAIW,cAEjBF,GAAgC,gBAAjBA,GAAKnxE,aAKzBuwE,GAAQP,EAASjkE,EAASulE,SAAUH,EAAKnxE,eAJxCwwE,GAAQ,iBAAmBE,EAAIW,gBAOjCV,EAAW,GAAIY,UACfZ,EAAS3nE,OAAO,OAAQymE,EAASM,OAAQP,EAASC,IAElDiB,EAAIc,KAAKb,GAGV,QAASc,KACR,MAAO,IAAIxuF,GAAQ,SAAS3D,GAC3BA,QAIF,QAASoyF,GAAejC,EAAU5qE,GACjC,OACCA,IAAKA,EACL4qE,SAAUA,EACVn1D,QAAQ,GAIV,QAASq3D,GAAelC,EAAUnyE,GACjC,OACCuH,IAAK,GACL4qE,SAAUA,EACVn1D,QAAQ,EACRhd,MAAOA,GAIT,QAASs0E,GAAeC,EAASjzE,GAChCqG,EAAM1C,KAAKuvE,EAAgBD,GAAU,SAASvyF,GAC7CA,EAAQsf,WAGFkzE,GAAgBD,GAGxB,QAASE,GAAetC,EAAUn8E,EAAS0+E,GAG1C,MAFAzC,GAAa0C,YAAYxC,EAASoC,WAE3B,GAAI5uF,GAAQ,SAAS3D,GAC3B,GAAI4yF,GAAczB,EAEdz8C,EAAO,YAGX,KACC,GAAIm+C,GAAoB,WACnBD,IACHA,EAAahS,QACbuQ,EAAWz8C,IAITu8C,EAAU,SAAS1rE,GACtBstE,IACA5C,EAAa6C,aAAa3C,EAASoC,UAAWhtE,GAC9C+sE,EAAenC,EAASoC,UAAWH,EAAejC,EAAU5qE,IAC5DvlB,EAAQoyF,EAAejC,EAAU5qE,KAG9B2rE,EAAU,WACb2B,IACA5C,EAAa8C,aAAa5C,EAASoC,WACnCD,EAAenC,EAASoC,UAAWF,EAAelC,EAAUe,IAC5DlxF,EAAQqyF,EAAelC,EAAUe,IAGlCC,GAAW,SAAS6B,GACfA,EAAU,GAAKA,EAAU,MAIxBJ,IACJA,EAAeF,KAGhBE,EAAazN,YAAYhgF,MAAM6tF,KAGhCh/E,EAAQ68E,EAAeV,GAAWc,EAASC,EAASC,GACnD,MAAO9rF,GACRrF,EAAQqyF,EAAelC,EAAU9qF,EAAGg/E,aAKvC,QAAS4O,GAAiBj/E,GACzB,MAAOA,KAAYg9E,EAGpB,QAASkC,GAAsB/C,GAC9B,GAAIoC,GAAUpC,EAASoC,SAEvB,OAAO,IAAI5uF,GAAQ,SAAS3D,GAC3BwyF,EAAgBD,GAAWC,EAAgBD,OAC3CC,EAAgBD,GAAStyF,KAAKD,KAIhC,QAASmzF,GAAYC,EAAWV,GAK/B,MAJAU,GAAYztE,EAAMF,KAAK2tE,EAAW,SAASjD,GAC1C,OAAQF,EAAaoD,WAAWlD,EAASoC,aAGnC5uF,EAAQoC,IAAI4f,EAAMpP,IAAI68E,EAAW,SAASjD,GAChD,MAAOF,GAAaqD,UAAUnD,EAASoC,WACtCW,EAAsB/C,GAAYsC,EAAetC,EAAU1jE,EAASzY,QAAS0+E,MAIhF,QAASjB,GAAO2B,EAAWV,GAC1B,OAASjmE,EAASlH,KAAO0tE,EAAiBxmE,EAASzY,SAAYm+E,IAAagB,EAAYC,EAAWV,GAnLpG,GAAIF,KA4LJ,OANA/lE,GAAW9G,EAAMV,QAChBusE,aAAa,EAEbx9E,QAASg9E,GACPvkE,IAGFglE,OAAQA,MAuBXtxF,EAAO,4BACN,wBACE,SAASwD,GACX,QAAS4vF,GAAchuE,GACtB,MAAO,IAAI5hB,GAAQ,SAAS3D,GAC3B,GAAIoxF,GAAM,GAAIE,eAEdF,GAAIprB,KAAK,MAAOzgD,GAAK,GACrB6rE,EAAIoC,aAAe,OAEnBpC,EAAI50D,OAAS,WACO,KAAf54B,KAAKo3B,QACRh7B,EAAQ4D,KAAK6vF,WAIfrC,EAAIc,SAIN,QAAS3mB,GAAa51B,GACrB,GAAI7pC,GAAM3D,CASV,OAPAwtC,GAAMC,mBAAmBD,GAAKj1C,MAAM,KAEpCyH,EAAU,eAAeoB,KAAKosC,EAAI,IAC9BxtC,IACH2D,EAAO3D,EAAQ,KAIf2D,KAAMA,EACNR,KAAMqqC,EAAI,IAIZ,QAAS+9C,GAAc/9C,GACtB,MAAO,IAAIhyC,GAAQ,SAAS3D,GAC3B,GAAIkkB,GAAKjQ,EAAKpU,CAEd81C,GAAM41B,EAAa51B,EAGnB,KACCzxB,EAAMyvE,KAAKh+C,EAAIrqC,MACd,MAAO3G,GAER,WADA3E,GAAQ,GAAI4zF,WAMb,IAFA3/E,EAAM,GAAI4/E,YAAW3vE,EAAIpkB,QAEpBD,EAAI,EAAGA,EAAIoU,EAAInU,OAAQD,IAC3BoU,EAAIpU,GAAKqkB,EAAIgW,WAAWr6B,EAGzBG,GAAQ,GAAI4zF,OAAM3/E,IAAOnI,KAAM6pC,EAAI7pC,UAIrC,QAASgoF,GAAUvuE,GAClB,MAA6B,KAAzBA,EAAI/b,QAAQ,SACR+pF,EAAchuE,GAGO,IAAzBA,EAAI/b,QAAQ,SACRkqF,EAAcnuE,GAGf,KAGR,QAASwuE,GAActD,GACtB,MAAO,IAAI9sF,GAAQ,SAAS3D,GAC3B,GAAIg0F,GAAS,GAAIC,WAEjBD,GAAOE,UAAY,WAClBl0F,EAAQg0F,EAAO10E,SAGhB00E,EAAOG,cAAc1D,KAIvB,OACCqD,UAAWA,EACXC,cAAeA,EACfxoB,aAAcA,KAsBhBprE,EAAO,6BACN,uBACA,mBACA,mBACA,2BACA,eACE,SAASwD,EAASqgB,EAAKqjC,EAAK+sC,EAAa9pF,GAC3C,GAAIgE,GAAQ,CAEZ,OAAO,UAAS2hF,EAAcoE,GAG7B,QAASC,GAAQnrE,EAAKpF,GAGrB,QAASwwE,GAAgBrwC,EAAKlkD,GAC7B,GAAI8wF,GAAQX,CAEZ,OAAiC,KAA7BjsC,EAAI5mB,IAAI9zB,QAAQ,UACnB2mF,EAAWkE,EAAUG,SAAStwC,EAAI5mB,UAE9B6yD,GACHnwF,GACCkiB,MAAOgiC,EACPisC,SAAUA,OAObW,EAASsD,EAAY7oB,aAAarnB,EAAI5mB,KAAKhyB,KAC3C6kF,EAAWkE,EAAUI,UAAU,SAASC,GACvC,MAAOA,GAAe5D,WAAaA,SAGhCX,EACHnwF,GACCkiB,MAAOgiC,EACPisC,SAAUA,IAGXiE,EAAYN,UAAU5vC,EAAI5mB,KAAKz4B,KAAK,SAAS4rF,GAC5C,GAAIkE,GAAa,SAAYrmF,IAC5B6hF,EAAWkE,EAAU3yF,OAAOizF,EAAYlE,EAAMK,EAE/CuD,GAAU7rE,IAAI2nE,GAEdnwF,GACCkiB,MAAOgiC,EACPisC,SAAUA,QArCd,GAAIyE,GAAQC,CA4GZ,OAjEK9wE,KACJA,EAAYsjC,EAAI7B,UAAS,IAG1BovC,EAAS5wE,EAAIxN,OAAO2S,EAAIhZ,qBAAqB,OAAQ,SAAS+zC,GAC7D,GAAI5mB,GAAM4mB,EAAI5mB,GAEd,SAAKhzB,EAAIzB,WAILq7C,EAAInc,aAAa,qBAIjBmc,EAAInc,aAAa,6BAIhBzK,GAAOA,GAAOhzB,EAAIR,kBAIM,IAAzBwzB,EAAI9zB,QAAQ,UACPymF,EAAaoD,WAAW/1D,GAGJ,IAAzBA,EAAI9zB,QAAQ,UACRua,EAAUmgC,SAMnB2wC,EAAW7wE,EAAIzN,IAAIq+E,EAAQ,SAAS1wC,GACnC,GAAI4wC,EAEJ,OAAIC,GAAe7wC,EAAI5mB,KAGf,GAAI35B,GAAQ,SAAS3D,GAC3B+0F,EAAe7wC,EAAI5mB,KAAKz4B,KAAK,SAASmwF,GACrCh1F,GACCkiB,MAAOgiC,EACPisC,SAAU6E,EAAU7E,gBAMxB2E,EAAa,GAAInxF,GAAQ,SAAS3D,GACjCu0F,EAAgBrwC,EAAKlkD,KACnB6E,KAAK,SAASya,GAEhB,aADOy1E,GAAez1E,EAAO4C,MAAMob,KAC5Bhe,IACL,SAAS,SAAStB,GAEpB,aADO+2E,GAAe7wC,EAAI5mB,KACnBtf,IAGR+2E,EAAe7wC,EAAI5mB,KAAOw3D,EAEnBA,KAGDnxF,EAAQoC,IAAI8uF,GA/GpB,GAAIE,KAkHJ,QACCT,QAASA,MAuBZn0F,EAAO,0BACN,mBACA,oBACE,SAAS6jB,EAAKqjC,GAChB,MAAO,YAGN,QAAS3lD,GAAOtB,EAAIqwF,EAAMK,GACzB,OACC1wF,GAAIolD,EAASplD,GACbqwF,KAAMjrC,EAASirC,GACfK,OAAQtrC,EAASsrC,GACjByB,QAAS/sC,EAAS/7C,IAAIC,gBAAgB+mF,KAIxC,QAASjoE,GAAI2nE,GACPvnE,EAAIunE,EAAS/vF,OACjB+S,EAAMlT,KAAKkwF,GAIb,QAASvnE,GAAIxoB,GACZ,MAAOq0F,GAAU,SAASC,GACzB,MAAOA,GAAet0F,OAASA,IAIjC,QAASq0F,GAAU1wE,GAClB,MAAOC,GAAIxN,OAAOrD,EAAO4Q,GAAW,GAGrC,QAASywE,GAASjC,GACjB,MAAOkC,GAAU,SAAStE,GACzB,MAAOA,GAASoC,WAAaA,IAI/B,QAAS0C,GAAY1C,GACpBp/E,EAAQ6Q,EAAIxN,OAAOrD,EAAO,SAASg9E,GAClC,MAAIA,GAASoC,YAAcA,IAC1B9oF,IAAIyrF,gBAAgB/E,EAASoC,YACtB,KAOV,QAASniF,KACR4T,EAAIf,KAAK9P,EAAO,SAASuhF,GACxBjrF,IAAIyrF,gBAAgBR,EAAenC,aAGpCp/E,KAjDD,GAAIA,MAAYqyC,EAAW6B,EAAI7B,QAoD/B,QACC9jD,OAAQA,EACR8mB,IAAKA,EACLI,IAAKA,EACL4rE,SAAUA,EACVC,UAAWA,EACXQ,YAAaA,EACb7kF,QAASA,MAuBZjQ,EAAO,+BACJ,WACF,MAAO,YAIN,QAASg1F,GAAan6D,EAAQo6D,GAC7B,OACCp6D,OAAQA,EACRo6D,UAAWA,GAIb,QAASC,GAAW9C,GACnB,MAAOA,KAAW+C,GAGnB,QAASC,GAAahD,GACrB,GAAIjzE,GAASg2E,EAAgB/C,EAE7B,OAAOjzE,GAASA,EAAO81E,UAAY,KAGpC,QAAS9B,GAAUf,GAClB,QAAO8C,EAAW9C,IAAW+C,EAAgB/C,GAASv3D,SAAWw6D,EAGlE,QAASnC,GAAWd,GACnB,QAAO8C,EAAW9C,IAAW+C,EAAgB/C,GAASv3D,SAAWy6D,EAGlE,QAAS9C,GAAYJ,GACpB+C,EAAgB/C,GAAW4C,EAAaK,EAAS,MAGlD,QAAS1C,GAAaP,EAAS6C,GAC9BE,EAAgB/C,GAAW4C,EAAaM,EAAUL,GAGnD,QAASrC,GAAaR,SACd+C,GAAgB/C,GAGxB,QAASniF,KACRklF,KAzCD,GAAIE,GAAU,EAAGC,EAAW,EACxBH,IA2CJ,QACCD,WAAYA,EACZE,aAAcA,EACdjC,UAAWA,EACXD,WAAYA,EACZV,YAAaA,EACbG,aAAcA,EACdC,aAAcA,EACd3iF,QAASA,MAuBZjQ,EAAO,wBACN,mBACA,wBACA,4BACA,yBACA,6BACE,SAAS6jB,EAAK0xE,EAAUC,EAAcC,EAAWC,GACnD,MAAO,UAASpuF,GAIf,QAASquF,GAAWp2F,GACnB,MAAO,UAAS4f,GACf,MAAI7X,GAAOqlC,UACHptC,EAAS4f,OAQnB,QAASy2E,GAAc7rE,EAAS8rE,EAAQ1jF,GACvC,GAAIiR,GAAQ,CAEZ,GACCA,GAAQ2G,EAAQ1gB,QAAQwsF,EAAQzyE,GAE5BA,SACH2G,EAAUA,EAAQ6K,UAAU,EAAGxR,GAASjR,EAAU4X,EAAQoF,OAAO/L,EAAQyyE,EAAOl2F,QAChFyjB,GAASjR,EAAQxS,OAASk2F,EAAOl2F,OAAS,SAEnCyjB,OAET,OAAO2G,GAGR,QAAS+rE,GAAgB/rE,EAASgsE,EAAWC,GAI5C,MAHAjsE,GAAU6rE,EAAc7rE,EAAS,QAAUgsE,EAAY,IAAK,QAAUC,EAAiB,KACvFjsE,EAAU6rE,EAAc7rE,EAAS,iBAAmBgsE,EAAY,IAAK,iBAAmBC,EAAiB,KAK1G,QAASC,GAAsBF,EAAWC,GACzCnyE,EAAIf,KAAKxb,EAAO02D,YAAY7yD,KAAM,SAASkwD,GAC1CA,EAAMtxC,QAAU+rE,EAAgBz6B,EAAMtxC,QAASgsE,EAAWC,KAI5D,QAASzD,KACR,MAAOjrF,GAAOs+D,oBAAoBC,MACjC3lD,KAAM5Y,EAAOq+D,UAAU,sBACvBh6D,KAAM,OACNm5E,WACAE,aAAa,IAIf,QAASkR,GAAgBn0E,EAAOkzE,GAC/Bf,EAAUY,YAAY/yE,EAAMob,KAC5B84D,EAAsBl0E,EAAMob,IAAK83D,GAEjC3tF,EAAOi1B,EAAExa,GAAOpE,MACfwf,IAAK83D,EACLkB,eAAgB7uF,EAAO8uF,WAAWnB,EAAW,SAI/C,QAASoB,GAAa92F,GAUrB,MATK+2F,KACJA,EAAW,GAAIf,GAASzF,GACvB1qE,IAAKkH,EAASiqE,kBACd1E,SAAUvlE,EAASkqE,wBACnBnF,YAAa/kE,EAASmqE,0BACtB5iF,QAASyY,EAASoqE,yBAIbC,IAAgBjyF,KAAKixF,EAAW,SAASiB,GAC/C,GAAI3D,EAMJ,OAJAA,GAAYpvE,EAAIzN,IAAIwgF,EAAY,SAAS/B,GACxC,MAAOA,GAAU7E,WAGXsG,EAAShF,OAAO2B,EAAWV,GAAkB7tF,KAAKixF,EAAW,SAASx2E,GAkB5E,MAjBAA,GAAS0E,EAAIzN,IAAI+I,EAAQ,SAAS03E,EAAYzzE,GAC7C,GAAIrB,GAAQ60E,EAAWxzE,GAAOrB,KAM9B,OAJI80E,GAAWh8D,QAAUvzB,EAAOglB,SAASwqE,4BAA6B,GACrEZ,EAAgBn0E,EAAO80E,EAAWzxE,MAIlC9e,QAASyb,EACT8Y,OAAQg8D,EAAWh8D,UAIjBt7B,GACHA,EAAS4f,GAGHA,QAKV,QAAS43E,GAAiBx3F,GACzB,GAAI+sB,EAAS0qE,qBAAsB,EAClC,MAAOX,GAAa92F,GAItB,QAAS03F,GAAoBC,GAC5B,OAAO5qE,EAAS6qE,uBAAwB7qE,EAAS6qE,sBAAsBD,GAGxE,QAASP,KAKR,MAJKS,KACJA,EAAe,GAAI5B,GAAa1F,EAAcoE,IAGxCkD,EAAajD,QAAQ7sF,EAAO+kC,UAAW4qD,GAAqBvyF,KAAKixF,EAAW,SAASx2E,GAO3F,MANA0E,GAAIf,KAAK3D,EAAQ,SAASk4E,GACzBpB,EAAsBoB,EAAWt1E,MAAMob,IAAKk6D,EAAWrH,SAASoC,WAChEiF,EAAWt1E,MAAMob,IAAMk6D,EAAWrH,SAASoC,UAC3CiF,EAAWt1E,MAAMnP,gBAAgB,kBAG3BuM,KAIT,QAASlP,KACRikF,EAAUjkF,UACV6/E,EAAa7/E,UACbmnF,EAAed,EAAW,KAG3B,QAASgB,GAAgBvtE,GACxB,MAAOA,GAAQ5X,QAAQ,sBAAuB,SAAS1I,EAAO2oF,GAC7D,GAAI6C,GAAYnF,EAAasF,aAAahD,EAE1C,IAAI6C,EACH,MAAO,QAAUA,EAAY,GAG9B,IAAIjF,GAAWkE,EAAUG,SAASjC,EAQlC,OANKpC,KACJA,EAAWnsE,EAAIN,OAAOjc,EAAOu8E,cAAcoK,QAAS,SAAS9uE,EAAQ7X,GACpE,MAAO6X,IAAU7X,EAAOiwF,aAAarD,UAAUG,SAASjC,IACtD,OAGApC,EACI,aAAeA,EAASM,OAAO3kF,KAAO,WAAaqkF,EAASW,SAAW,IAGxElnF,IAzJT,GAAiC6sF,GAAUc,EAAvClD,EAAY,GAAIuB,GAAqCnpE,EAAWhlB,EAAOglB,SACvEwjE,EAAe,GAAI4F,EAiMvB,OArCApuF,GAAOqjB,GAAG,aAAc,WACnBrjB,EAAOglB,SAAS0qE,qBAAsB,EACzCD,IAEAJ,MAIFrvF,EAAOqjB,GAAG,iBAAkB,SAASnmB,GACpCA,EAAEulB,QAAUutE,EAAgB9yF,EAAEulB,WAG/BziB,EAAOqjB,GAAG,aAAc,SAASnmB,GAC5BA,EAAEgzF,aAA2B,OAAZhzF,EAAEo4C,SAIvBp4C,EAAEulB,QAAUutE,EAAgB9yF,EAAEulB,YAG/BziB,EAAOqjB,GAAG,aAAc,WACvBrjB,EAAOyxC,OAAOf,cAAc,MAAO,SAASy8C,GAC3C5wE,EAAIf,KAAK2xE,EAAQ,SAAS1wC,GACzB,GAAI5mB,GAAM4mB,EAAIpmC,KAAK,MAEnB,KAAIu2E,EAAUG,SAASl3D,GAAvB,CAIA,GAAI83D,GAAYnF,EAAasF,aAAaj4D,EACtC83D,IACHlxC,EAAIpmC,KAAK,MAAOs3E,WAOnBf,UAAWA,EACXmC,aAAcA,EACdU,iBAAkBA,EAClBJ,cAAeA,EACf1mF,QAASA,MAuBZjQ,EAAO,2BACN,+BACA,8BACA,uBACA,yBACA,uBACA,0BACA,sBACE,SAASkpC,EAAgBof,EAAejgB,EAAUe,EAAY7M,EAAG6qB,EAAYl9C,GAC/E,GAAIg+B,GAAyBG,EAASH,sBAEtC,OAAO,UAASrY,EAAUyO,GAGzB,QAASm5D,GAAsB97E,EAAM+N,GACpC,GACCwB,GAAQwsE,EAAShY,EAASl8B,EAAQm0C,EAD/B50F,EAAaqkD,EAAWr2B,SAASpV,EAAKwP,wBAAyBzB,EA8BnE,OA3BwB,QAApBmG,EAASob,SACZ/f,EAAS2E,EAAS9jB,cAAcE,gBAChCyrF,EAAU7nE,EAAS3jB,YAAcgf,EAAOhf,WACxCwzE,EAAU7vD,EAASvjB,WAAa4e,EAAO5e,YAEvCqrF,EAAW9nE,EAAS1E,wBACpBusE,EAAU7nE,EAAS3jB,WAAayrF,EAAS30F,KACzC08E,EAAU7vD,EAASvjB,UAAYqrF,EAAS10F,KAGzCF,EAAWC,MAAQ00F,EACnB30F,EAAW+qB,OAAS4pE,EACpB30F,EAAWE,KAAOy8E,EAClB38E,EAAWgrB,QAAU2xD,EACrB38E,EAAWG,MAAQ,EAEnBsgD,EAAS7nC,EAAKgkB,YAAchkB,EAAKyjB,YAE7BokB,EAAS,IACR95B,IACH85B,OAGDzgD,EAAWC,MAAQwgD,EACnBzgD,EAAW+qB,OAAS01B,GAGdzgD,EAGR,QAAS60F,KACR,GAAIC,GAA2Bl8E,EAAMwL,EAASznB,EAAGyL,CAGjD,KADA0sF,EAA4Bt7D,EAAE,2BAA4B1M,GACrDnwB,EAAI,EAAGA,EAAIm4F,EAA0Bl4F,OAAQD,IACjDic,EAAOk8E,EAA0Bn4F,GAEjCynB,EAAUxL,EAAKwZ,gBACX+T,EAAeN,uBAAuBzhB,KACzChc,EAAOgc,EAAQhc,KAEI,GAAfA,EAAKxL,OACRwnB,EAAQ7X,WAAWoE,YAAYyT,GAE/BA,EAAQ0N,WAAW1pB,EAAKxL,OAAS,EAAG,IAItCwnB,EAAUxL,EAAKpH,YACX20B,EAAeL,yBAAyB1hB,KAC3Chc,EAAOgc,EAAQhc,KAEI,GAAfA,EAAKxL,OACRwnB,EAAQ7X,WAAWoE,YAAYyT,GAE/BA,EAAQ0N,WAAW,EAAG,GAKzB,OAAO,MAGR,QAAS/J,GAAKpB,EAAQ/N,GACrB,GAAI5Y,GAAYsmC,EAAKr7B,CAIrB,OAFA+c,KAEIuT,EAAQ3iB,IACXstB,EAAqBC,EAAeJ,YAAY,IAAKntB,EAAM+N,GAC3D3mB,EAAa00F,EAAsB97E,EAAM+N,GACzC6S,EAAE0M,GAAoBrgB,IAAI,MAAO7lB,EAAWE,KAE5C60F,EAAmBv7D,EAAE,6DAA6D3T,IAAI7lB,GAAY6mB,SAASiG,GAEvGnG,GACHouE,EAAiBztE,SAAS,2BAG3B0tE,IAEA1uD,EAAM1tB,EAAK5P,cAAcy3B,cACzBx1B,EAAYi7B,EAAmB5qB,WAC/BgrB,EAAI/Y,SAAStiB,EAAW,GACxBq7B,EAAI5Y,OAAOziB,EAAW,GAgBhBq7B,IAdNJ,EAAqBC,EAAeR,aAAa/sB,EAAM+N,GACvD2f,EAAM1tB,EAAK5P,cAAcy3B,cAErB0E,EAAuBe,EAAmB10B,cAC7C80B,EAAI/Y,SAAS2Y,EAAoB,GACjCI,EAAI5Y,OAAOwY,EAAoB,KAE/BI,EAAI/Y,SAAS2Y,EAAoB,GACjCI,EAAI5Y,OAAOwY,EAAoB,IAGzBI,GAMT,QAASte,KACR6sE,IAEI3uD,IACHC,EAAe5f,OAAO2f,GACtBA,EAAqB,MAGlB6uD,IACHA,EAAiBxuE,SACjBwuE,EAAmB,MAGpB7wF,cAAc+wF,GAGf,QAASD,KACRC,EAAiB9tF,EAAMrD,YAAY,WAClC01B,EAAE,uBAAwB1M,GAAUvF,YAAY,4BAC9C,KAGJ,QAASra,KACR/F,EAAMjD,cAAc+wF,GAGrB,QAASC,KACR,MAAO,uOAxIR,GAAID,GAAgBF,EAAkB7uD,CA4JtC,QACCne,KAAMA,EACNC,KAAMA,EACNktE,OAAQA,EACRhoF,QAASA,MAwBZjQ,EAAO,0BACN,mBACA,uBACA,2BACE,SAAS6jB,EAAKwkB,EAAU+e,GAE1B,QAASjc,GAAexvB,GACvB,QAASu8E,GAAgBpwC,GACxB,MAAOjkC,GAAIzN,IAAI0xC,EAAa,SAAS/kD,GAIpC,MAHAA,GAAaqkD,EAAWh9B,MAAMrnB,GAC9BA,EAAW4Y,KAAOA,EAEX5Y,IAIT,GAAI8gB,EAAIte,QAAQoW,GACf,MAAOkI,GAAIN,OAAO5H,EAAM,SAASwD,EAAQxD,GACxC,MAAOwD,GAAOzP,OAAOy7B,EAAexvB,QAItC,IAAI0sB,EAASf,UAAU3rB,GACtB,MAAOu8E,GAAgBv8E,EAAKwvB,iBAG7B,IAAI9C,EAASP,OAAOnsB,GAAO,CAC1B,GAAI0tB,GAAM1tB,EAAK5P,cAAcy3B,aAK7B,OAHA6F,GAAI/Y,SAAS3U,EAAM,GACnB0tB,EAAI5Y,OAAO9U,EAAMA,EAAKxQ,KAAKxL,QAEpBu4F,EAAgB7uD,EAAI8B,mBAI7B,OAQCA,eAAgBA,KAuBlBnrC,EAAO,4BACN,mBACA,mBACA,yBACA,+BACA,2BACA,4BACA,8BACA,2BACE,SAASknD,EAAKrjC,EAAKs0E,EAAYhxC,EAAgBkZ,EAAYQ,EAAavY,EAAelB,GAGzF,QAASgxC,GAAUr5B,EAAWlvC,EAAUqvC,EAAavjD,GACpD,KAAQA,EAAO0kD,EAAWpB,SAAStjD,EAAMojD,EAAW5X,EAAehB,yBAA0Bt2B,IAC5F,GAAIqvC,EAAYvjD,GACf,OAKH,QAAS08E,GAAUt5B,EAAWu5B,EAAWC,EAAY1oE,EAAUqvC,EAAaxX,GAG3E,QAASr/B,GAAI1M,GACZ,GAAIjc,GAAGqD,EAAY+kD,CAOnB,KALAA,EAAcqwC,EAAWhtD,eAAexvB,GACpCojD,QACHjX,EAAcA,EAAY1hC,WAGtB1mB,EAAI,EAAGA,EAAIooD,EAAYnoD,OAAQD,IAEnC,GADAqD,EAAa+kD,EAAYpoD,IACrB64F,EAAWx1F,EAAYy1F,GAA3B,CAUA,GANIr5E,EAAOxf,OAAS,GAAK24F,EAAUv1F,EAAY8gB,EAAIxE,KAAKF,KACvDs5E,IAGD11F,EAAW01F,KAAOA,EAEdv5B,EAAYn8D,GACf,OAAO,CAGRoc,GAAOrf,KAAKiD,IA1Bd,GAAc4Y,GAAmB68E,EAA7BC,EAAO,EAASt5E,IA+BpB,QADAq5E,EAAmB30E,EAAIxE,KAAKqoC,EAAcvc,oBAK1CxvB,EAAO+rC,EAAczb,UACrB5jB,EAAI1M,GACJy8E,EAAUr5B,EAAWlvC,EAAUxH,EAAK1M,GAE7BwD,GAPCA,EAUT,QAASu5E,GAAgBC,EAAY51F,GACpC,MAAOA,GAAW01F,KAAOE,EAG1B,QAASC,GAAOD,EAAY51F,GAC3B,MAAOA,GAAW01F,OAASE,EAM5B,QAASE,GAAe95B,EAAWlvC,EAAUqvC,EAAavjD,GAIzD,QAASm9E,GAAcpxC,GACtB,MAAiB,IAAbqX,EACIl7C,EAAIxE,KAAKqoC,EAAcvc,kBAGxBtnB,EAAIxE,KAAKqoC,EAAcvc,kBAR/B,GAA6C4tD,GAAQC,EAAWV,EAC/D5wC,EAAsC3kD,EAAYy1F,EAD/C72B,EAAc,GAAId,GAAYhxC,GAClB1Q,KAAas5E,EAAO,CAUnB,IAAb15B,GACHg6B,EAASp3B,EAAYr2C,KACrB0tE,EAAY5xC,EAAWR,QACvB0xC,EAAYlxC,EAAWT,QACvBe,EAAgBY,EAAc3+B,MAAMhO,KAEpCo9E,EAASp3B,EAAYp2C,KACrBytE,EAAY5xC,EAAWT,QACvB2xC,EAAYlxC,EAAWR,QACvBc,EAAgBY,EAAc5+B,OAAO/N,IAGtC68E,EAAmBM,EAAcpxC,EAEjC,GACC,IAAKA,EAAce,cAInB1lD,EAAa+1F,EAAcpxC,IAEvB4wC,EAAUv1F,EAAYy1F,IAA1B,CAYA,GARIr5E,EAAOxf,OAAS,GAAKq5F,EAAUj2F,EAAY8gB,EAAIxE,KAAKF,KACvDs5E,IAGD11F,EAAaqkD,EAAWh9B,MAAMrnB,GAC9BA,EAAW06C,SAAWiK,EACtB3kD,EAAW01F,KAAOA,EAEdv5B,EAAYn8D,GACf,MAAOoc,EAGRA,GAAOrf,KAAKiD,SACH2kD,EAAgBqxC,EAAOrxC,GAEjC,OAAOvoC,GApHR,GAAIumC,GAAQwB,EAAIxB,MA6DZuzC,EAAUvzC,EAAM2yC,KAAejxC,EAAWT,QAASS,EAAWR,SAC9DsyC,EAAYxzC,EAAM2yC,EAAW,EAAGjxC,EAAWR,QAASQ,EAAWT,QAyDnE,QACCsyC,QAASA,EACTC,UAAWA,EAYXL,eAAgBA,EAEhBM,YAAazzC,EAAMgzC,GACnBE,OAAQlzC,EAAMkzC,MAsBhB54F,EAAO,2BACN,mBACA,mBACA,uBACA,yBACA,0BACA,2BACA,gCACE,SAASknD,EAAKrjC,EAAKwkB,EAAU8vD,EAAY/wC,EAAYiZ,EAAYlZ,GAKnE,QAASiyC,GAAmBr2F,EAAY8I,GACvC,MAAOzI,MAAKgoC,IAAIroC,EAAWC,KAAO6I,GAGnC,QAASwtF,GAAoBt2F,EAAY8I,GACxC,MAAOzI,MAAKgoC,IAAIroC,EAAW+qB,MAAQjiB,GAGpC,QAASytF,GAAsBxxC,EAAaj8C,GAC3C,QAAS0tF,GAAS1tF,EAAS9I,GAC1B,MAAO8I,IAAW9I,EAAWC,MAAQ6I,GAAW9I,EAAW+qB,MAG5D,MAAOjK,GAAIN,OAAOukC,EAAa,SAAS0xC,EAAez2F,GACtD,GAAI02F,GAAaC,CAKjB,OAHAD,GAAcr2F,KAAKhB,IAAIg3F,EAAmBI,EAAe3tF,GAAUwtF,EAAoBG,EAAe3tF,IACtG6tF,EAAct2F,KAAKhB,IAAIg3F,EAAmBr2F,EAAY8I,GAAUwtF,EAAoBt2F,EAAY8I,IAE5F0tF,EAAS1tF,EAAS9I,GACdA,EAGJw2F,EAAS1tF,EAAS2tF,GACdA,EAIJE,GAAeD,GAAevxD,EAAuBnlC,EAAW4Y,MAC5D5Y,EAGJ22F,EAAcD,EACV12F,EAGDy2F,IAIT,QAASnB,GAAUt5B,EAAWlvC,EAAUqvC,EAAavjD,GACpD,KAAQA,EAAOsjD,EAAStjD,EAAMojD,EAAW5X,EAAehB,yBAA0Bt2B,IACjF,GAAIqvC,EAAYvjD,GACf,OAKH,QAASg+E,GAAkB9pE,EAAU+pE,GAGpC,QAAS75D,GAAQ85D,EAAYl+E,GAC5B,GAAIm+E,EAQJ,OANAA,GAAYj2E,EAAIxN,OAAO8hF,EAAWhtD,eAAexvB,GAAO,SAAS5Y,GAChE,OAAQ82F,EAAW92F,EAAY62F,KAGhC9xC,EAAcA,EAAYp4C,OAAOoqF,GAEL,IAArBA,EAAUn6F,OAXlB,GAAImoD,KAkBJ,OAJAA,GAAYhoD,KAAK85F,GACjBvB,KAAcxoE,EAAU61B,EAAM3lB,EAASqnB,EAAWT,SAAUizC,EAAej+E,MAC3E08E,EAAU,EAAGxoE,EAAU61B,EAAM3lB,EAASqnB,EAAWR,SAAUgzC,EAAej+E,MAEnEmsC,EAGR,QAASiyC,GAAgClqE,GACxC,MAAOhM,GAAIxN,OAAOwN,EAAIlB,QAAQkN,EAAS7f,qBAAqB,MAAOk4B,GAGpE,QAAS8xD,GAAUj3F,EAAY8I,GAC9B,OACC8P,KAAM5Y,EAAW4Y,KACjB+N,OAAQ0vE,EAAmBr2F,EAAY8I,GAAWwtF,EAAoBt2F,EAAY8I,IAIpF,QAASouF,GAAapqE,EAAUhkB,EAASQ,GACxC,GAAI6tF,GAA+BC,CAQnC,OANAD,GAAgC/B,EAAWhtD,eAAe4uD,EAAgClqE,IAC1FqqE,EAAgCr2E,EAAIxN,OAAO6jF,EAA+B,SAASn3F,GAClF,MAAOsJ,IAAWtJ,EAAWE,KAAOoJ,GAAWtJ,EAAWgrB,SAG3DosE,EAAkBb,EAAsBY,EAA+BruF,GACnEsuF,IACHA,EAAkBb,EAAsBK,EAAkB9pE,EAAUsqE,GAAkBtuF,GAClFsuF,GAAmBjyD,EAAuBiyD,EAAgBx+E,OACtDq+E,EAAUG,EAAiBtuF,GAI7B,KArGR,GAAIq8B,GAAyBG,EAASH,uBACrC+2B,EAAWoB,EAAWpB,SACtBvZ,EAAQwB,EAAIxB,KAsGb,QACC4zC,sBAAuBA,EACvBK,kBAAmBA,EACnBM,aAAcA,KAsBhBj6F,EAAO,6BACN,uBACA,mBACA,oBACE,SACFqoC,EACAxkB,EACAqjC,GAKA,QAASngC,GAAKzf,GAKb,QAAS8yF,GAAYpxE,GACpB,MAAOkf,GAAuBlf,GAG/B,QAASqxE,GAAcjf,GACtB7+C,EAAEj1B,EAAO+kC,WAAWzjB,IAAI,SAAUwyD,GAGnC,QAASkf,GAAkBtxE,GAC1B,MAAIA,IAAOwB,EAAMlkB,UAAWgB,EAAO+oB,IAAIgU,UAAUrb,EAAKwB,EAAMlkB,WAIxD4hC,EAAuBlf,GAO5B,QAAS60B,GAAKr5C,GACb,GAAIq8C,GAAQC,EAAQn/C,EAAKssD,EACMssC,EAC9B1uF,EAASQ,EAASmuF,EADlBC,EAAY,EAAGj0C,EAAY,CAGX,KAAbhiD,EAAE6c,SAINw/B,EAASr8C,EAAE08C,QAAU12B,EAAM02B,QAC3BJ,EAASt8C,EAAE48C,QAAU52B,EAAM42B,QAC3Bm5C,EAAWn3F,KAAKjB,IAAIiB,KAAKgoC,IAAIyV,GAASz9C,KAAKgoC,IAAI0V,KAE1Ct2B,EAAMkwE,UAAYH,EAAW,KACjC/vE,EAAMkwE,UAAW,EACjBL,EAAc,WAEd7vE,EAAMJ,MAAQI,EAAMlkB,QAAQugB,WAAU,GAEtCllB,EAAM0uB,EAAImP,OAAOhV,EAAMlkB,SACvBkkB,EAAMmwE,KAAOnwE,EAAM3e,QAAUlK,EAAIX,EACjCwpB,EAAMowE,KAAOpwE,EAAMne,QAAU1K,EAAIV,EACjCupB,EAAMtnB,MAAQsnB,EAAMlkB,QAAQq5B,YAC5BnV,EAAMrnB,OAASqnB,EAAMlkB,QAAQs5B,aAE7BrD,EAAE/R,EAAMJ,OAAOxB,KACd1lB,MAAOsnB,EAAMtnB,MACbC,OAAQqnB,EAAMrnB,SACZwlB,WAAW,qBAEd6B,EAAMqwE,MAAQt+D,EAAE,SAAS3T,KACxB60B,SAAU,WACVrxB,QAAS,GACT0uE,SAAU,SACV53F,MAAOsnB,EAAMtnB,MACbC,OAAQqnB,EAAMrnB,SACZwa,MACF8lC,iBAAkB,MAClBE,aAAc,KACdo3C,gBAAiB,UACf1wE,SAAS,gCACXd,OAAOiB,EAAMJ,OACbR,SAAStiB,EAAO+kC,WAAW;AAE5B4hB,EAAW3mD,EAAO+oB,IAAI0O,YAAYz3B,EAAO+mD,UACzC7jC,EAAMwwE,KAAO/sC,EAAS/sD,EACtBspB,EAAMywE,KAAOhtC,EAAS9sD,GAGnBqpB,EAAMkwE,WACTpzF,EAAOs8D,oBAAoBs3B,gBAC3B5zF,EAAOqlC,UAAU4hB,aAAa/pD,EAAEqH,QAASrH,EAAE6H,SAE3CR,EAAU2e,EAAM3e,QAAUg1C,EAASr2B,EAAMmwE,KACzCtuF,EAAUme,EAAMne,QAAUy0C,EAAS,EAE/Bj1C,EAAU2e,EAAMtnB,MAAQsnB,EAAMwwE,OACjCP,EAAa5uF,EAAU2e,EAAMtnB,MAASsnB,EAAMwwE,MAGzC3uF,EAAUme,EAAMrnB,OAASqnB,EAAMywE,OAClCz0C,EAAan6C,EAAUme,EAAMrnB,OAAUqnB,EAAMywE,MAI7CT,EADgC,QAA7BlzF,EAAO+kC,UAAUt6B,SACHzK,EAAO+kC,UAAUlhB,yBAEhBnoB,KAAM,EAAGC,IAAK,GAGjCs5B,EAAE/R,EAAMqwE,OAAOjyE,KACd5lB,KAAM6I,EAAU2uF,EAAex3F,KAC/BC,IAAKoJ,EAAUmuF,EAAev3F,IAC9BC,MAAOsnB,EAAMtnB,MAAQu3F,EACrBt3F,OAAQqnB,EAAMrnB,OAASqjD,MAK1B,QAAS20C,GAAKttF,GACb,GAAIutF,EAEJ,IAAI5wE,EAAMkwE,WAETpzF,EAAOqlC,UAAUge,OAAOrjD,EAAOqlC,UAAU6e,SAAS7L,WAAW,IAEzD26C,EAAkBhzF,EAAOqlC,UAAUV,YAAY,CAClD,GAAIovD,GAAc7wE,EAAMlkB,OASxB,IANA80F,EAAU9zF,EAAOqI,KAAK,QACrB0rF,YAAaA,EACbxvF,QAASgC,EAAIhC,QACbQ,QAASwB,EAAIxB,UAGV+uF,EAAQ3uF,qBACX,MAGD4uF,GAAcD,EAAQC,YAEtB/zF,EAAO02D,YAAYnC,SAAS,WAC3Bv0D,EAAOg0F,cAAcjrE,EAAIkS,aAAa84D,IACtC9+D,EAAE/R,EAAMlkB,SAASgjB,WAKpB1hB,IAGD,QAAS8X,GAAMlb,GACd,GAAI+2F,GAAO1tF,CAIX,IAFAjG,IAEiB,IAAbpD,EAAE6c,SAINk6E,EAAQ13E,EAAItL,KAAKjR,EAAO+oB,IAAIyP,WAAWt7B,EAAEnE,QAAS6mD,EAAI1B,GAAGtd,EAAwBD,IAE7EmyD,EAAYmB,IAAQ,CAEvB,GADA1tF,EAAMvG,EAAOqI,KAAK,aAActP,OAAQk7F,IACpC1tF,EAAIpB,qBACP,MAGDnF,GAAOqjB,GAAG,YAAakzB,GACvBv2C,EAAOqjB,GAAG,UAAWwwE,GAEjBx4C,GAAgBD,IACnBryB,EAAIhtB,KAAKs/C,EAAc,YAAa9E,GACpCxtB,EAAIhtB,KAAKs/C,EAAc,UAAWw4C,IAGnC3wE,GACC02B,QAAS18C,EAAE08C,QACXE,QAAS58C,EAAE48C,QACXv1C,QAASrH,EAAEqH,QACXQ,QAAS7H,EAAE6H,QACX/F,QAASi1F,IAKZ,QAAS3zF,KACR20B,EAAE/R,EAAMqwE,OAAOvxE,SACf+wE,EAAc,MAEd/yF,EAAOsjB,IAAI,YAAaizB,GACxBv2C,EAAOsjB,IAAI,UAAWhjB,GAElB+6C,GAAgBD,IACnBryB,EAAI9gB,OAAOozC,EAAc,YAAa9E,GACtCxtB,EAAI9gB,OAAOozC,EAAc,UAAW/6C,IAGrC4iB,KAvLD,GAAI+R,GAAIj1B,EAAOi1B,EAAGomB,EAAex7C,SAChCu7C,EAAcp7C,EAAOklC,SACrBnc,EAAM/oB,EAAO+oB,IAAK7F,IAwLnBljB,GAAOqjB,GAAG,YAAajL,GAGvBpY,EAAOqjB,GAAG,OAAQ,SAASnmB,GAE1B,GAAIg3F,GAAkC,mBAAdh3F,GAAEqH,QAA0BvE,EAAOklC,SAASzB,iBAAiBvmC,EAAEqH,QAASrH,EAAE6H,SAAW,MAEzG67B,EAAuBszD,IAAetzD,EAAuB5gC,EAAO+oB,IAAI+T,yBAAyBo3D,MACpGh3F,EAAEgI,mBAtML,GAAI07B,GAAyBG,EAASH,uBACrCD,EAAwBI,EAASJ,qBA0MlC,QACClhB,KAAMA,KA6BR/mB,EAAO,8BACN,cACA,4BACA,8BACA,+BACA,2BACA,0BACA,2BACA,0BACA,uBACA,yBACA,0BACA,kBACA,mBACA,mBACA,qBACA,4BACA,qBACE,SACFmK,EAAK02D,EAAavY,EAAepf,EAAgBm3B,EAAYo7B,EAAWC,EACxEC,EAAWtzD,EAAUe,EAAYge,EAAY3G,EAAIyG,EAAKrjC,EAAK3Z,EAAO0xF,EAAmBtzD,GAUrF,QAASuzD,GAAuB9C,EAAQrxC,GACvC,KAAQA,EAAgBqxC,EAAOrxC,IAC9B,GAAIA,EAAce,YACjB,MAAOf,EAIT,OAAOA,GAGR,QAASo0C,GAAmBx0F,GAQ3B,QAASg3B,GAAQ3iB,GAChB,MAAOrU,GAAO+oB,IAAIiO,QAAQ3iB,GAG3B,QAASogF,GAASlyF,GAEbA,GACHvC,EAAOqlC,UAAUge,OAAO9gD,GAI1B,QAASi0C,KACR,MAAOx2C,GAAOqlC,UAAUC,SAGzB,QAASmhB,GAAepyC,EAAMqyC,GAC7B1mD,EAAOqlC,UAAUohB,eAAepyC,EAAMqyC,GAGvC,QAASguC,GAAUj9B,EAAWpjD,EAAM+N,GACnC,GAAIllB,EAQJ,OANAA,GAAI8C,EAAOqI,KAAK,aACftP,OAAQsb,EACRojD,UAAWA,EACXr1C,OAAQA,IAGLllB,EAAEiI,qBACE,MAGRshD,EAAepyC,EAAMojD,QAEdk9B,GAAUnxE,KAAKpB,EAAQ/N,IAG/B,QAAS2V,GAAW3V,GACnB,GAAInX,EAKJ,OAHAy3F,IAAUlxE,OAEVvmB,EAAI8C,EAAOqI,KAAK,wBAAyBtP,OAAQsb,IAC7CnX,EAAEiI,qBACE,KAGDyvF,EAAavgF,GAGrB,QAASugF,GAAavgF,GACrB,GAAI0tB,GAAM1tB,EAAK5P,cAAcy3B,aAI7B,OAFA6F,GAAI/X,WAAW3V,GAER0tB,EAGR,QAAS8yD,GAAsBC,EAAmBC,GACjD,GAAIC,GAAcj8B,EAAWf,cAAc88B,EAAmBC,EAG9D,SAAKC,IAAej0D,EAASL,KAAKo0D,EAAkBnwD,aAI7CqwD,EAGR,QAASC,GAA2Bx9B,EAAWl1D,GAG9C,MAFAA,GAAQw2D,EAAWN,eAAehB,EAAWlvC,GAAUhmB,GAEnDk1D,MACIzW,EAAcK,eAAe9+C,GAG9By+C,EAAcM,aAAa/+C,GAGnC,QAAS2yF,GAA6B3yF,GACrC,MAAOq/B,GAAeX,sBAAsB1+B,EAAMioB,gBAGnD,QAAS2qE,GAA0B19B,EAAW29B,EAAcC,EAAgC9yF,GAC3F,GAAI8R,GAAM+rC,EAAek1C,EAAmBC,CAE5C,QAAKhzF,EAAMwnB,YACV1V,EAAOqwB,EAAgBniC,GACnBq+B,EAAuBvsB,IACnBqgF,EAAUj9B,EAAWpjD,EAAMojD,QAIpC89B,EAA0BL,EAA6B3yF,GACvD69C,EAAgB60C,EAA2Bx9B,EAAWl1D,GAElD8yF,EAA+Bj1C,GAC3Bp2B,EAAWo2B,EAAczb,QAAQ8yB,SAGzCrX,EAAgBg1C,EAAah1C,IASzBi1C,EAA+Bj1C,GAC3Bs0C,EAAUj9B,EAAWrX,EAAczb,QAAQ8yB,OAA+B,GAAbA,IAIrE69B,EAAoBF,EAAah1C,GAC7Bi1C,EAA+BC,IAC9BT,EAAsBz0C,EAAek1C,GACjCZ,EAAUj9B,EAAW69B,EAAkB3wD,QAAQ8yB,OAA+B,GAAbA,GAItE89B,EACIC,EAAiBp1C,EAAcc,WAGhC,MAvBFq0C,EACIhzF,EAGD,MAsBT,QAASkzF,GAAwBh+B,EAAWi+B,EAAUnzF,GACrD,GAAI69C,GAAeu1C,EAAeC,EACjCC,EAAqBC,EAAiBvxF,EACtCwxF,EAAOC,EAAOC,CAgBf,IAdAA,EAA2BvxD,EAAgBniC,GAC3C69C,EAAgB60C,EAA2Bx9B,EAAWl1D,GACtDozF,EAAgBD,EAASntE,GAAU6rE,EAAWvC,YAAY,GAAIzxC,GAC9Dw1C,EAAoBr5E,EAAIxN,OAAO4mF,EAAevB,EAAW9C,OAAO,IAChEwE,EAAkBv5E,EAAIxE,KAAKqoC,EAAcvc,kBAErCg1B,EAA6BzY,KAChC61C,EAA2B71C,EAAczb,WAGtCm0B,EAA4B1Y,KAC/B61C,EAA2B71C,EAAczb,SAAQ,KAG7CmxD,EACJ,MAAO,KAMR,IAHAvxF,EAAUuxF,EAAgBp6F,KAE1Bm6F,EAAsBxB,EAAUrC,sBAAsB4D,EAAmBrxF,GACrEsxF,GACCj1D,EAAuBi1D,EAAoBxhF,MAI9C,MAHA0hF,GAAQj6F,KAAKgoC,IAAIv/B,EAAUsxF,EAAoBn6F,MAC/Cs6F,EAAQl6F,KAAKgoC,IAAIv/B,EAAUsxF,EAAoBrvE,OAExCkuE,EAAUj9B,EAAWo+B,EAAoBxhF,KAAM0hF,EAAQC,EAIhE,IAAIC,EAA0B,CAC7B,GAAIC,GAAiB9B,EAAW7C,eAAe95B,EAAWlvC,GAAU6rE,EAAWvC,YAAY,GAAIoE,EAG/F,IADAJ,EAAsBxB,EAAUrC,sBAAsBz1E,EAAIxN,OAAOmnF,EAAgB9B,EAAW9C,OAAO,IAAK/sF,GAEvG,MAAOixF,GAAiBK,EAAoB1/C,SAAS+K,UAItD,IADA20C,EAAsBt5E,EAAIxE,KAAKwE,EAAIxN,OAAOmnF,EAAgB9B,EAAW9C,OAAO,KAE3E,MAAOkE,GAAiBK,EAAoB1/C,SAAS+K,YAKxD,QAASi1C,GAAa1+B,EAAWl1D,GAGhC,QAAS6zF,KACR,GAAIjW,GAAYngF,EAAO+oB,IAAI9uB,OAAO+F,EAAOglB,SAASgtB,kBAMlD,SAJKnvC,EAAIhC,IAAMgC,EAAIhC,IAAM,MACxBs/E,EAAUjrE,UAAY,2BAGhBirE,EATR,GAAI33B,GAAK4R,EAAUjE,CAYnB,IAAI5zD,EAAMwnB,WAAa/pB,EAAOglB,SAASgtB,kBAAmB,CAEzD,GADAwW,EAAMxoD,EAAO+oB,IAAIwP,UAAUh2B,EAAMioB,eAAgB,QAC5Cg+B,EACJ,MAIA4R,GADgB,GAAb3C,EACQ4+B,GAA2Br1C,EAAcK,eAAe9+C,IAExD+zF,GAA2Bt1C,EAAcK,eAAe9+C,IAG/D63D,IACJjE,EAAWigC,IAEM,GAAb3+B,EACHz3D,EAAOi1B,EAAEuzB,GAAKnmC,MAAM8zC,GAEpBn2D,EAAOi1B,EAAEuzB,GAAKpmC,OAAO+zC,GAGtBn2D,EAAOqlC,UAAU95B,OAAO4qD,GAAU,GAClCn2D,EAAOqlC,UAAU5b,aAKpB,QAAS8sE,GAAM9+B,EAAW29B,EAAcC,EAAgC9yF,GACvE,GAAIi0F,EAGJ,QADAA,EAAWrB,EAA0B19B,EAAW29B,EAAcC,EAAgC9yF,IAEtFi0F,GAGRA,EAAWL,EAAa1+B,EAAWl1D,GAC/Bi0F,EACIA,EAGD,MAGR,QAASC,GAAMh/B,EAAWi+B,EAAUnzF,GACnC,GAAIi0F,EAGJ,QADAA,EAAWf,EAAwBh+B,EAAWi+B,EAAUnzF,IAEhDi0F,GAGRA,EAAWL,EAAa1+B,EAAWl1D,GAC/Bi0F,EACIA,EAGD,MAGR,QAASE,KACR,MAAOzhE,IAAE,qBAAqB,GAG/B,QAASsnC,GAAwBo6B,GAChCA,EAAsB1hE,GAAE0hE,GAEpBA,EAAoBtgF,KAAK,oBAC5Bs+E,GAAUlxE,OACVkzE,EAAoBt1E,WAAW,kBAC/Bs1E,EAAoBt1E,WAAW,kBAC/Bs1E,EAAoBt1E,WAAW,SAG/BozE,EAASj+C,KACTiQ,EAAekwC,EAAoB,KAIrC,QAASC,GAAmBr0F,GAC3B,GAAI69C,GAAey2C,CAKnB,OAHAt0F,GAAQw2D,EAAWN,eAAe,EAAGlwC,GAAUhmB,GAC/C69C,EAAgBY,EAAcK,eAAe9+C,GAEzCq+B,EAAuBwf,EAAczb,WACjC+vD,EAAU,EAAGt0C,EAAczb,WAAYyb,EAAcS,WAGzDjgB,EAAuBwf,EAAczb,SAAQ,IACzC+vD,EAAU,EAAGt0C,EAAczb,SAAQ,IAAO,IAIlDkyD,EAAS72F,EAAO+oB,IAAIwP,UAAU6nB,EAAczb,UAAWib,EAAI1B,GAAGtd,EAAwBD,IAClFC,EAAuBi2D,GACnBnC,EAAU,EAAGmC,GAAQ,IAG7BlC,GAAUlxE,OAEH,OAGR,QAAS+xE,GAAiBjzF,GACzB,GAAIu0F,EAEJ,OAAKv0F,IAAUA,EAAMwnB,WAIrB+sE,EAAaF,EAAmBr0F,GAC5Bu0F,EACIA,EAGDv0F,GARCA,EAWT,QAASw0F,GAA0B1iF,GAClC,GAAI2iF,GAAmBC,EAAmBC,EAAgBC,CAE1D,OAAKv2D,GAAuBvsB,IAIxBusB,EAAuBvsB,EAAKwZ,mBAC/BqpE,EAAiB7iF,EAAKwZ,iBAGvBopE,EAAoBX,GAA2Bt1C,EAAc5+B,OAAO/N,IAC/D4iF,IACJD,EAAoBX,GAA2Br1C,EAAc3+B,MAAMhO,KAGhE2iF,GAAqBh3D,EAAUg3D,EAAkBryD,aACpDwyD,EAAcH,EAAkBryD,WAGjC/C,EAAe5f,OAAO3N,EAAKwZ,iBAC3B+T,EAAe5f,OAAO3N,EAAKpH,aAC3BjN,EAAO+oB,IAAI/G,OAAO3N,GAClB+iF,IAEIp3F,EAAO+oB,IAAI8S,QAAQ77B,EAAO+kC,YAC7B/kC,EAAOokD,WAAW,QAClBpkD,GAAOmZ,SAIJ+9E,EACIl2C,EAAc3+B,MAAM60E,GAAgBh2C,UAGxCi2C,EACIn2C,EAAc5+B,OAAO+0E,GAAaj2C,UAGtC+1C,EACIA,EAAkB/1C,UAGtB81C,EACIA,EAAkB91C,UAGnB,MA3CC,KA8CT,QAASm2C,GAAgB5/B,EAAWq9B,EAAmBC,GACtD,GAAsBuC,GAAWC,EAASljF,EAAMmjF,EAA5CzuE,EAAM/oB,EAAO+oB,GAEjB,IAAI0uC,QACH,GAAIqB,EAA4Bi8B,IAAoB/9D,EAAQ+9D,EAAgBpwD,SAAQ,IACnF,MAAOoyD,GAA0BhC,EAAgBpwD,SAAQ,QAG1D,IAAIk0B,EAA6Bi8B,IAAsB99D,EAAQ89D,EAAkBnwD,WAChF,MAAOoyD,GAA0BjC,EAAkBnwD,UASrD,IALA6yD,EAAax3F,EAAOilB,OAAOinB,uBAC3BorD,EAAYvuE,EAAIwP,UAAUu8D,EAAkBnwD,UAAW5b,EAAIiO,SAC3DugE,EAAUxuE,EAAIwP,UAAUw8D,EAAgBpwD,UAAW5b,EAAIiO,SAGnDsgE,IAAcC,IAAYC,EAAWF,EAAU7sF,YAAc+sF,EAAWD,EAAQ9sF,UACnF,MAAO,KAGR,MAAQ4J,EAAOijF,EAAUvgF,YACxBwgF,EAAQ7iF,YAAYL,EAKrB,OAFArU,GAAO+oB,IAAI/G,OAAOs1E,GAEXvC,EAAgB7zC,UAGxB,QAASu2C,GAAgBhgC,EAAWigC,EAAUC,EAASp1F,GACtD,GAAI8R,GAAM+rC,EAAek1C,EAAmBsC,CAE5C,QAAKr1F,EAAMwnB,YACV1V,EAAOqwB,EAAgBniC,GACnBq+B,EAAuBvsB,IACnBmhF,EAAiBuB,EAA0B1iF,KAIpD+rC,EAAgB60C,EAA2Bx9B,EAAWl1D,GAElDo1F,EAAQv3C,IAAkBxe,EAAeX,sBAAsB1+B,EAAMioB,iBACxEotE,EAAmBngC,MAAkB4C,GAAYp2C,KAAKm8B,GAAiBia,GAAYr2C,KAAKo8B,GACjFw3C,EAAmBpC,EAAiBoC,EAAiB12C,WAAa3+C,GAGtEm1F,EAASt3C,GACLo1C,EAAiBuB,EAA0B32C,EAAczb,QAAQ8yB,UAGzE69B,EAAoB79B,MAAkB4C,GAAYp2C,KAAKm8B,GAAiBia,GAAYr2C,KAAKo8B,GACrFs3C,EAASpC,GACR79B,OACI4/B,EAAgB5/B,EAAWrX,EAAek1C,GAG3C+B,EAAgB5/B,EAAW69B,EAAmBl1C,GALtD,SASD,QAASy3C,KAQR,QAASC,GAASvxF,EAAKwxF,GACtB,GAAIx1F,GAAQw1F,EAAOvhD,IAEfj0C,KAAUgE,EAAIpB,uBACjBoB,EAAIrB,iBACJuvF,EAASlyF,IAIX,QAASy1F,GAAuB3jF,GAG/B,IAFA,GAAI6E,GAAOlZ,EAAO+kC,UAEX1wB,GAAQA,GAAQ6E,GAAM,CAC5B,GAAIynB,EAAsBtsB,IAASusB,EAAuBvsB,GACzD,MAAOA,EAGRA,GAAOA,EAAKrM,WAGb,MAAO,MAGR,QAASiwF,GAAgB1zF,EAASQ,EAASxC,GAC1C,OAAIA,EAAMwnB,WAIHxN,EAAIN,OAAO1Z,EAAMshC,iBAAkB,SAAS3gB,EAAO3pB,GACzD,MAAO2pB,IAAS48B,EAAWN,WAAWjmD,EAAMgL,EAASQ,KACnD,GA0HJ,QAASmzF,KACR,GAAIvX,GAAIkW,EAASmB,EAAuBh4F,EAAOqlC,UAAUV,UAErDhE,GAAsBk2D,IAAW7/D,EAAQ6/D,IAAW72F,EAAO+oB,IAAI8S,QAAQg7D,KAC1ElW,EAAK3gF,EAAO+oB,IAAI9uB,OAAO,MAAOkiD,iBAAkB,MAChDn8C,EAAOi1B,EAAE4hE,GAAQh9E,QAAQoI,OAAO0+D,GAChC3gF,EAAOqlC,UAAUge,OAAOrC,EAAc5+B,OAAOu+D,GAAIz/B,YAInD,QAASi3C,GAAqBj7F,GAC7B,GAAIy5F,GAAsBD,GAE1B,IAAKC,EAIL,MAAc,oBAAVz5F,EAAEmH,MACLnH,EAAEgI,iBACFhI,EAAEmI,sBACFk3D,GAAwBo6B,SAIY,UAAjCA,EAAoBzhF,WACvBqnD,EAAwBo6B,IAI1B,QAASyB,GAA2Bl7F,GACnC,GAAIm7F,EAEJ,QAAQn7F,EAAEg2D,SACT,IAAK/Z,GAAGjuB,OACPmtE,EAAUH,GACV,MAED,KAAK/+C,GAAGb,UACP+/C,EAAUH,IAIRG,GACHn7F,EAAEgI,iBA1MJ,GAAIshB,GAAQ43B,EAAMm4C,EAAO,EAAGF,GAA4Bx9B,GACpDn9D,EAAO0iD,EAAMm4C,KAAWD,GAA4Bx9B,GACpDw/B,EAAgBl6C,EAAMq5C,EAAiB,EAAG5+B,EAA8BC,GACxEy/B,EAAYn6C,EAAMq5C,KAAqB3+B,EAA6BD,GACpE8Y,EAAKvzB,EAAMq4C,KAAWrC,EAAWzC,SACjC/f,EAAOxzB,EAAMq4C,EAAO,EAAGrC,EAAWxC,UAqCtC5xF,GAAOqjB,GAAG,UAAW,WACpB,GAAI9gB,GAAQi0C,GAERj0C,GAAMwnB,WACT0qE,EAASmC,EAAmBr0F,MAI9BvC,EAAOqjB,GAAG,QAAS,SAASnmB,GAC3B,GAAIs7F,EAGJA,GAAsBR,EAAuB96F,EAAEnE,QAC3Cy/F,GACC53D,EAAuB43D,IAC1Bt7F,EAAEgI,kBAKL,IAAIuzF,GAAyB,SAAU/2E,GACtC,GAAI24C,GAAc,GAAId,GAAY73C,EAElC,KAAKA,EAAI3K,WACR,OAAO,CAGR,IAAIwjC,GAAWyG,EAAc5+B,OAAOV,EAAI3K,YACpCikD,EAASX,EAAYr2C,KAAKu2B,EAE9B,OAAOygB,KAAWnC,EAA6BmC,KAAYlC,EAA4BkC,IAGpFhD,EAAgB,SAAU7Q,EAAOC,GACpC,GAAIsxC,GAAS14F,EAAO+oB,IAAIwP,UAAU4uB,EAAOnnD,EAAO+oB,IAAIiO,SAChD2hE,EAAS34F,EAAO+oB,IAAIwP,UAAU6uB,EAAOpnD,EAAO+oB,IAAIiO,QACpD,OAAO0hE,KAAWC,GAMfC,EAAuB,SAAUna,EAAYp6B,GAChD,GAAIw0C,GAAc74F,EAAO+oB,IAAIwP,UAAUkmD,EAAYz+E,EAAO+oB,IAAIiO,SAC1D8hE,EAAa94F,EAAO+oB,IAAIwP,UAAU8rB,EAAWrkD,EAAO+oB,IAAIiO,QAE5D,OAAO6hE,KAAgB7gC,EAAc6gC,EAAaC,IAAeL,EAAuBI,GAGzF74F,GAAOqjB,GAAG,YAAa,SAASnmB,GAC/B,GAAIs7F,EAGJ,IADAA,EAAsBR,EAAuB96F,EAAEnE,QAE1C6nC,EAAuB43D,IAC1Bt7F,EAAEgI,iBACF6zF,EAA4B/uE,EAAWwuE,MAEvCpB,IAEKa,EAAgB/6F,EAAEqH,QAASrH,EAAE6H,QAAS/E,EAAOqlC,UAAUC,WAC3DtlC,EAAOqlC,UAAU4hB,aAAa/pD,EAAEqH,QAASrH,EAAE6H,cAGvC,CACNqyF,IACAzC,GAAUlxE,MAEV,IAAIivE,GAAY2B,EAAU1B,aAAapqE,GAAUrrB,EAAEqH,QAASrH,EAAE6H,QAC1D2tF,KACEkG,EAAqB17F,EAAEnE,OAAQ25F,EAAUr+E,QAC7CnX,EAAEgI,iBACFlF,EAAO+kC,UAAU5rB,QACjBs7E,EAASC,EAAU,EAAGhC,EAAUr+E,KAAMq+E,EAAUtwE,cAMpDpiB,EAAOqjB,GAAG,UAAW,SAASnmB,GAC7B,IAAIi8C,EAAGL,gBAAgB57C,GAIvB,OAAQA,EAAEg2D,SACT,IAAK/Z,GAAGT,MACPo/C,EAAS56F,EAAGspB,EACZ,MAED,KAAK2yB,GAAGZ,KACPu/C,EAAS56F,EAAG00E,EACZ,MAED,KAAKz4B,GAAGV,KACPq/C,EAAS56F,EAAGxB,EACZ,MAED,KAAKy9C,GAAGN,GACPi/C,EAAS56F,EAAGy0E,EACZ,MAED,KAAKx4B,GAAGjuB,OACP4sE,EAAS56F,EAAGo7F,EACZ,MAED,KAAKn/C,GAAGb,UACPw/C,EAAS56F,EAAGq7F,EACZ,MAED,SACK33D,EAAuB5gC,EAAOqlC,UAAUV,YAC3CznC,EAAEgI,oBAsDNlF,EAAOqjB,GAAG,yBAA0B,SAASnmB,GAC5Ci7F,EAAqBj7F,GACrBk7F,EAA2Bl7F,KACzB,GAEH8C,EAAOqjB,GAAG,MAAO,WAChB,GAAIhP,GAAOrU,EAAOqlC,UAAUV,SAExB/D,GAAuBvsB,IAC1BzR,EAAM7C,iBAAiBC,EAAQ,WAC9By0F,EAASe,EAAiBuB,EAA0B1iF,SAKvDrU,EAAOqjB,GAAG,oBAAqB,SAASnmB,GACvC,GAAI6kC,GAAM7kC,EAAEqF,KAEZ,IAAIy2F,GAA6B,CAChC,IAAKA,GAA4BhxF,WAEhC,YADAgxF,GAA8B,KAI/Bj3D,GAAMA,EAAInW,aACVmW,EAAI/X,WAAWgvE,IACf97F,EAAEqF,MAAQw/B,KAIZ/hC,EAAOqjB,GAAG,oBAAqB,SAASnmB,GACvC,GAAI6kC,EAEJA,GAAMg3D,EAA4B77F,EAAEqF,OAChCw/B,IACH7kC,EAAEqF,MAAQw/B,KAIZ/hC,EAAOqjB,GAAG,QAAS,WAElBzgB,EAAM7C,iBAAiBC,EAAQ,WAC9BA,EAAOqlC,UAAUge,OAAOmyC,EAAiBx1F,EAAOqlC,UAAUC,YACxD,KAGJgvD,EAAkB70E,KAAKzf,GAGxB,QAASi5F,KACR,GAAIvyE,GAAS1mB,EAAO29C,cAAeD,EAAY,mBAE/Ch3B,GAAOluB,KAAKm8F,GAAUhE,UACtBjqE,EAAOluB,KACNklD,EAAY,iGAMZA,EAAY,+CAGZA,EAAY,4CAMd,QAASw7C,GAAwBn3D,GAChC,MAAOH,GAAeT,iBAAiBY,EAAIvX,iBAAmBoX,EAAeT,iBAAiBY,EAAInX,cAGnG,QAASmuE,GAA4Bx2F,GACpC,GAAI8R,GAAsC8kF,EAAyBx0C,EAClEn6B,EAAgBE,EAAaI,EAAW5tB,EAAGkjD,EAAe2zC,EAAaqF,EAD9DnkE,EAAIj1B,EAAOi1B,EAAGlM,EAAM/oB,EAAO+oB,GAGrC,KAAKxmB,EAEJ,MADA60F,KACO,IAGR,IAAI70F,EAAMwnB,UAAW,CAGpB,GAFAqtE,KAEK8B,EAAwB32F,GAAQ,CAGpC,GAFA69C,EAAgB60C,EAA2B,EAAG1yF,GAE1Cq+B,EAAuBwf,EAAczb,WACxC,MAAO+vD,GAAU,EAAGt0C,EAAczb,WAAYyb,EAAcS,UAG7D,IAAIjgB,EAAuBwf,EAAczb,SAAQ,IAChD,MAAO+vD,GAAU,EAAGt0C,EAAczb,SAAQ,IAAO,GAInD,MAAO,MAcR,MAXAna,GAAiBjoB,EAAMioB,eACvBE,EAAcnoB,EAAMmoB,YACpBI,EAAYvoB,EAAMuoB,UAGa,GAA3BN,EAAe9iB,UAAgC,GAAfgjB,GAAoBkW,EAAuBpW,EAAexiB,cAC7FwiB,EAAiBA,EAAexiB,WAChC0iB,EAAc3B,EAAI5Q,UAAUqS,GAC5BA,EAAiBA,EAAexiB,YAGF,GAA3BwiB,EAAe9iB,UAClB0vF,IACO,OAGJtsE,GAAaJ,EAAc,IAC9BrW,EAAOmW,EAAerW,WAAWuW,IAG7BkW,EAAuBvsB,IAK5B0/E,EAAcqF,EAAkB/kF,EAAKkL,WAAU,GAC/CriB,EAAI8C,EAAOqI,KAAK,kBAAmBtP,OAAQsb,EAAM0/E,YAAaA,IAC1D72F,EAAEiI,sBACLiyF,IACO,OAGRrD,EAAc72F,EAAE62F,YAChBoF,EAA0BlkE,EAAE,IAAMokE,IACK,IAAnCF,EAAwB9gG,SAC3B8gG,EAA0BlkE,EACzB,oEACC5e,KAAK,KAAMgjF,IAEbF,EAAwB72E,SAAStiB,EAAO+kC,YAGzCxiC,EAAQvC,EAAO+oB,IAAIkT,YAGf83D,IAAgBqF,GAAmBv2F,EAAIhC,IAC1Cs4F,EAAwBt/E,QAAQoI,OAAO+e,EAAKF,MAAM7e,OAAO8xE,GAAa9xE,OAAO+e,EAAKF,MAClFv+B,EAAMymB,SAASmwE,EAAwB,GAAGpiF,WAAY,GACtDxU,EAAM4mB,OAAOgwE,EAAwB,GAAG7gF,UAAW,KAEnD6gF,EAAwBt/E,QAAQoI,OAAO,KAAUA,OAAO8xE,GAAa9xE,OAAO,KAC5E1f,EAAMymB,SAASmwE,EAAwB,GAAGpiF,WAAY,GACtDxU,EAAM4mB,OAAOgwE,EAAwB,GAAG7gF,UAAW,IAGpD6gF,EAAwB73E,KACvB3lB,IAAKotB,EAAImP,OAAO7jB,EAAMrU,EAAO+kC,WAAWprC,IAGzCw/F,EAAwB,GAAGhgF,QAC3BwrC,EAAM3kD,EAAOqlC,UAAU6e,SACvBS,EAAIQ,kBACJR,EAAI7M,SAASv1C,GAEbvC,EAAOi1B,EAAE,wBAAwB5T,WAAW,qBAC5ChN,EAAKtJ,aAAa,oBAAqB,GACvCiuF,GAA8B3kF,EAEvB9R,KA/CN60F,IACO,OAiDT,QAASA,KACJ4B,KACHA,GAA4B1tF,gBAAgB,qBAC5CtL,EAAOi1B,EAAE,IAAMokE,IAAiBr3E,SAChCg3E,GAA8B,MAIhC,QAASrwF,KACRgsF,GAAUhsF,UACVqwF,GAA8B,KAG/B,QAASpF,KACRe,GAAUlxE,OArzBX,GAKCu1E,IALGzwE,GAAWvoB,EAAO+kC,UAAWs1B,GAAc,GAAId,GAAYhxC,IAC3D8tE,GAA6Bj4C,EAAMm2C,EAAwBl6B,GAAYr2C,MACvEsyE,GAA6Bl4C,EAAMm2C,EAAwBl6B,GAAYp2C,MAC1E0wE,GAAY,GAAIR,GAAUn0F,EAAO+kC,UAAW/N,GAC5CqiE,GAAkB,OAASr5F,EAAO+oB,IAAIgS,WACT9F,GAAIj1B,EAAOi1B,CAwzBzC,OALIpyB,GAAIH,UACPm1F,IACAoB,MAIA18B,wBAAyBA,EACzBq3B,cAAeA,EACfjrF,QAASA,GAn1BX,GAAIy1C,GAAQwB,EAAIxB,MACfzd,EAAwBI,EAASJ,sBACjCC,EAAyBG,EAASH,uBAClCZ,EAAYe,EAASf,UACrB84B,EAA8BC,EAAWD,4BACzCD,EAA+BE,EAAWF,6BAC1Cn0B,EAAkB5C,EAAW4C,eAi1B9B,OAAO8vD,KAqBR97F,EAAO,uBACJ,WACF,GAAImO,GAAQ,EAER2C,EAAO,WACV,GAAI8vF,GAAM,WACT,MAAOx9F,MAAK9B,MAAsB,WAAhB8B,KAAKqV,UAAuB9S,SAAS,IAGxD,OAAO,IAAM8I,KAAKoyF,MAAMl7F,SAAS,IAAMi7F,IAAQA,IAAQA,KAGpDE,EAAO,SAAUnzE,GACpB,MAAOA,GAAUxf,KAAW2C,IAG7B,QACCgwF,KAAMA,KAgDR9gG,EAAO,kBACN,uBACA,uBACA,uBACA,qBACA,oBACA,yBACA,0BACA,wBACA,oBACA,sBACA,mBACA,sBACA,yBACA,mBACA,2BACA,yBACA,wBACA,8BACA,sBACA,yBACA,sBACA,cACA,qBACA,qBACA,2BACA,eACA,oBACA,uBACA,6BACA,qBACE,SACFu9B,EAAUjX,EAAUqf,EAAco7D,EAAY3zD,EAAM4zD,EAAe1lD,EACnE8B,EAAW6jD,EAAWC,EAAaC,EAAUC,EAAaC,EAC1Dn4B,EAAK3kC,EAAc52B,EAAY2zF,EAAeC,EAC9CttD,EAAQoH,EAAWmmD,EAAQr3F,EAAKqb,EAAOtb,EAAOgkF,EAAkBuT,EAAMC,EAAWC,EACjF7F,EAAoB8F,GAwBpB,QAASC,GAAO5hG,EAAIqsB,EAAUu3D,GAC7B,GAAiBie,GAAiB34B,EAAS44B,EAAvCr0F,EAAOjK,IAEXq+F,GAAkBp0F,EAAKo0F,gBAAkBje,EAAcme,gBACvD74B,EAAU0a,EAAcoe,QACxBF,EAAkBle,EAAcke,gBAWhCz1E,EAAWxH,GACV7kB,GAAIA,EACJukE,MAAO,SACP09B,YAAa,EACbC,aAAc,EACdC,UAAW,GACX79B,QAAS,GACT89B,kBAAmBP,EACnBQ,yBAAyB,EACzBC,cAAc,EACdC,oBAAoB,EACpBC,cAAc,EACdC,eAAe,EACfC,oBAAoB,EACpBhiD,iBAAiB,EACjB9J,QAAS,kBACT+rD,QAAQ,EACRn8B,uBAAwB,uDAGxBo8B,wBAAyB,oDACzBvpD,kBAAmB,IACnBwpD,cAAc,EACdC,mBAAmB,EACnBC,WAAW,EACXv7B,YAAa,OACboB,eAAe,EACfo6B,wBAAwB,EACxBhpD,OAAQ,SACRI,cAAe,4LAEfC,aAAc,4LAEdnF,UAAU,EACVoF,gBAAiB,QACjBtrB,cAAevhB,EAAK0oF,WACpBlnE,oBAAqBxhB,EACrBw1F,YAAY,GACVnB,EAAiBz1E,GAGhBy1E,GAAmBA,EAAgBoB,kBAAoB72E,EAAS62E,mBACnE72E,EAAS62E,iBAAmBr+E,KAAWi9E,EAAgBoB,iBAAkB72E,EAAS62E,mBAGnFz1F,EAAK4e,SAAWA,EAChBqZ,EAAaK,SAAW1Z,EAAS0Z,UAAY,KAC7CL,EAAaM,aAAe3Z,EAAS82E,cACrCz9D,EAAamB,QAAU+8C,EAAc/8C,QAQrCp5B,EAAKzN,GAAKqsB,EAASrsB,GAAKA,EASxByN,EAAKitD,UAAS,GAWdjtD,EAAK62D,WAcL72D,EAAK21F,gBAAkB,GAAIn6B,GAAI58C,EAAS+1E,mBAAqBP,GAC5Dz4B,SAAUF,IAeXz7D,EAAKu0F,QAAU94B,EAQfz7D,EAAK41F,cAQL51F,EAAKu3C,iBAGLv3C,EAAK28E,UAAY,GAAIqX,GAAUh0F,GAC/BA,EAAK61F,aACL71F,EAAK81F,eAAiB,GAAInC,GAAe3zF,GAErC4e,EAASjsB,SACZqN,EAAKm1C,UAAYv2B,EAASjsB,QAG3BqN,EAAKkgB,OAASi2D,EAAcj2D,OAC5BlgB,EAAKm2E,cAAgBA,EACrBn2E,EAAKgkC,OAASplB,EAASolB,OACvBhkC,EAAK4e,SAASi+D,iBAAmB78E,EAAKgkC,OAElCplB,EAASm3E,eACZt5F,EAAIkb,YAAciH,EAASm3E,aAAatxF,QAAQ,WAAY,KAGzDma,EAASo3E,qBAAsB,IAClCv5F,EAAI22E,kBAAmB,GAIxB+C,EAAcl0E,KAAK,cAAejC,GAClCA,EAAKi2F,aAAa,QAASj2F,GAW3BA,EAAK6uB,EAAIjW,EAASuF,iBAAiB,WAClC,OACCjb,QAASlD,EAAKgkC,OAAShkC,EAAK2+B,UAAY3+B,EAAK8+B,SAC7ClmC,QAASoH,EAAK2+B,aAvMjB,GAAItK,GAAMxE,EAASwE,IAAKkF,EAAetB,EAAasB,aAAcD,EAAgBrB,EAAaqB,cAC3FliB,EAASU,EAAMV,OAAQhC,EAAO0C,EAAM1C,KAAMmC,EAAUO,EAAMP,QAC1DM,EAAUC,EAAMD,QAASzB,EAAO0B,EAAM1B,KAAMjkB,EAAU2lB,EAAM3lB,QAC5D4Q,EAAQ9C,EAAW8C,MACnBw8E,EAAU9iF,EAAI7B,MAAOH,EAAKgC,EAAIhC,EAqkElC,OA73DA05F,GAAOn8F,WAMNgxE,OAAQ,WAGP,QAAStpE,KACR20B,EAAIxyB,OAAOpK,OAAQ,QAASiI,GAC5BM,EAAKgpE,SAwHN,QAASnxC,KACR,GAAIq+D,GAAer/D,EAAaA,YAUhC,IARIjY,EAAS0Z,UAAiC,MAArB1Z,EAAS0Z,WAAqB1Z,EAASu3E,eAC/Dv3E,EAASu3E,aAAen2F,EAAKm2E,cAAc/8C,QAAU,UAAYxa,EAAS0Z,SAAW,OAGlF1Z,EAASu3E,cACZD,EAAav7E,IAAIiE,EAASu3E,cAGvBv3E,EAASk4C,OAAkC,kBAAlBl4C,GAASk4C,OACT,KAA5Bl4C,EAASk4C,MAAMp8C,OAAO,KAAc6e,EAAarB,KAAKtZ,EAASk4C,OAAQ,CACvE,GAAIs/B,GAAWx3E,EAASy3E,SAGvBD,GADGA,EACQp2F,EAAK21F,gBAAgB34B,WAAWo5B,GAEhC,UAAYx3E,EAASk4C,MAAQ,SAAW52C,EAAS,MAG7DqZ,EAAazM,KAAKlO,EAASk4C,MAAOs/B,GAG/Bt+E,EAAMjgB,QAAQ+mB,EAASi4C,WAC1Bj4C,EAASi4C,QAAUj4C,EAASi4C,QAAQ9xD,KAAK,MAG1CqQ,EAAKwJ,EAAS62E,iBAAkB,SAAS/9E,EAAK/a,GAC7C28B,EAAcxM,KAAKnwB,EAAM+a,GACzBkH,EAASi4C,SAAW,IAAMl6D,IAG3ByY,EAAKwJ,EAASi4C,QAAQhkE,MAAM,QAAS,SAASyjG,GAG7C,GAFAA,EAASlgF,EAAKkgF,GAEVA,IAAWh9D,EAAcpB,KAAKo+D,GACjC,GAAwB,KAApBA,EAAO57E,OAAO,GAAW,CAC5B47E,EAASA,EAAO70E,OAAO,EAAG60E,EAAOrkG,OAEjC,IAAIO,GAAe8mC,EAAc9mC,aAAa8jG,EAE9ClhF,GAAK5iB,EAAc,SAASmmC,GAC3B,GAAI07D,IACHp0E,OAAQ,WACR2Y,SAAUD,EACVzY,OAAQ,UAAYA,EAAS,MAG9ByY,GAAMW,EAAcb,UAAU47D,EAAiB17D,GAC/CW,EAAcxM,KAAK6L,EAAIC,SAAUD,SAGlCW,GAAcxM,KAAKwpE,GAClBr2E,OAAQ,WACR2Y,SAAU09D,EACVp2E,OAAQ,UAAYA,EAAS,UAMjCg2E,EAAat+D,UAAU,WACjB53B,EAAKnG,SACTmG,EAAKqZ,SA5LR,GAAIrZ,GAAOjK,KAAM6oB,EAAW5e,EAAK4e,SAAUrsB,EAAKyN,EAAKzN,GAAI2tB,EAASlgB,EAAKkgB,MAQvE,KAAKnd,EAAMpD,UAEV,WADA00B,GAAI1+B,KAAK8B,OAAQ,QAASiI,EAK3B,IAAKM,EAAK+3E,cAKLt7E,EAAIX,gBAAT,CAKK8iB,EAASolB,OAIbhkC,EAAKgkC,QAAS,GAHdhkC,EAAKu2F,cAAgBv2F,EAAK+3E,aAAax8D,MAAMi7E,WAC7Cx2F,EAAK+3E,aAAax8D,MAAMi7E,WAAa,SAKtC,IAAIC,GAAOz2F,EAAK+3E,aAAa0e,MAAQpiE,EAAIlC,UAAU5/B,EAAI,OACnDkkG,KACHz2F,EAAK02F,YAAcD,EAGf73E,EAASw2E,eAAiB,kBAAkB55F,KAAKwE,EAAK+3E,aAAa1zE,YACtEgwB,EAAIhP,YAAYgP,EAAIxgC,OAAO,SAAUoK,KAAM,SAAUtB,KAAMpK,IAAMA,GACjEyN,EAAK22F,gBAAiB,GAIvB32F,EAAK42F,kBAAoB,SAAS9/F,GACjCkJ,EAAKiC,KAAKnL,EAAEmH,KAAMnH,IAGnBu9B,EAAI1+B,KAAK8gG,EAAM,eAAgBz2F,EAAK42F,mBAGpC52F,EAAKid,GAAG,QAAS,WAChBjd,EAAKg+C,WAAWh+C,EAAK62F,cAAe3nD,OAAQ,WAIzCtwB,EAASi2E,cAAiB4B,EAAKniF,OAAOhT,UAAam1F,EAAKniF,OAAOriB,QAAWwkG,EAAKK,gBAClFL,EAAKK,cAAgBL,EAAKniF,OAC1BmiF,EAAKniF,OAAS,WAIb,MAHAtU,GAAKm2E,cAAc4gB,cACnB/2F,EAAKitD,UAAS,GAEPwpC,EAAKK,cAAcL,MAwB7Bz2F,EAAKg3F,cAAgB,GAAIpD,GAAc5zF,GAWvCA,EAAKk4D,oBAAsB,GAAI27B,GAAoB7zF,GAE1B,OAArB4e,EAASq4E,UACZj3F,EAAKid,GAAG,aAAc,SAASnmB,GAC1BA,EAAEogG,OACLpgG,EAAEulB,QAAUgY,EAAI3T,OAAO5pB,EAAEulB,YAKxBuC,EAASg2E,yBACZ50F,EAAKid,GAAG,SAAU,WACbjd,EAAKu/B,aACRv/B,EAAKk3F,SAKJt4E,EAASk2E,qBACZ90F,EAAKm3F,cAAgB,YAChBn3F,EAAKu/B,aAAgBv/B,EAAKo3F,WAAcp3F,EAAK00B,YAChD10B,EAAKk3F,MAAMhoD,OAAQ,MAAOC,WAAW,EAAMkoD,WAAW,KAIxDr3F,EAAKm2E,cAAcl5D,GAAG,eAAgBjd,EAAKm3F,gBAyE5Cn3F,EAAKm2E,cAAcx7D,IAAI3a,GACvB63B,MAUDxe,KAAM,WAgCL,QAASi+E,GAAWhB,GACnB,GAAwCv9D,GAAWw+D,EAA/CC,EAASl+D,EAAcve,IAAIu7E,EAI/B,IAFAv9D,EAAYO,EAAcpB,KAAKo+D,IAAWt2F,EAAKo0F,gBAAgB3vF,QAAQ,MAAO,IAC9E6xF,EAASlgF,EAAKkgF,GACVkB,GAAU3/E,EAAQ4/E,EAAoBnB,QAAgB,CAKzD,GAJAlhF,EAAKkkB,EAAc9mC,aAAa8jG,GAAS,SAAS39D,GACjD2+D,EAAW3+D,KAGR34B,EAAK62D,QAAQy/B,GAChB,MAGDiB,GAAiB,GAAIC,GAAOx3F,EAAM+4B,EAAW/4B,EAAK6uB,GAElD7uB,EAAK62D,QAAQy/B,GAAUiB,EAEnBA,EAAel+E,OAClBk+E,EAAel+E,KAAKrZ,EAAM+4B,GAC1B0+D,EAAmBrlG,KAAKkkG,KAnD3B,GACI9iG,GAAGC,EAAGoyE,EAAWtwD,EAAGF,EAAGqiF,EAAOhgF,EAAKigF,EAAQC,EAAWC,EAAI7lG,EAD1DgO,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,SAAUtD,EAAMtb,EAAK+3E,aACW0f,IA6HjE,IA3HA1hG,KAAKogF,cAAc2hB,KAAKC,QAAQn5E,EAAS0Z,UACzCt4B,EAAK2kE,IAAM/lD,EAASo5E,QAAUjiG,KAAKogF,cAAc2hB,KAAKnzB,IAEtD/lD,EAASq5E,WAAar5E,EAASq5E,YAAc5jE,EAAIlD,UAAU7V,EAAK,aAActb,EAAKk4F,QAAQ,wBAWvFt5E,EAASk4C,QACiB,kBAAlBl4C,GAASk4C,OACnBl4C,EAASk4C,MAAQl4C,EAASk4C,MAAMryD,QAAQ,IAAK,IAC7CizF,EAAQn+D,EAAaxe,IAAI6D,EAASk4C,OAClC92D,EAAK82D,MAAQ,GAAI4gC,GAAM13F,EAAMu5B,EAAarB,KAAKtZ,EAASk4C,QAEpD92D,EAAK82D,MAAMz9C,MACdrZ,EAAK82D,MAAMz9C,KAAKrZ,EAAMu5B,EAAarB,KAAKtZ,EAASk4C,QAAU92D,EAAKo0F,gBAAgB3vF,QAAQ,MAAO,IAAKzE,EAAK6uB,IAG1G7uB,EAAK82D,MAAQl4C,EAASk4C,OA8BxB1hD,EAAKwJ,EAASi4C,QAAQpyD,QAAQ,MAAO,IAAI5R,MAAM,QAASykG,GAGpD14E,EAAS02E,WAAat1F,EAAK82D,QAC9B92D,EAAKm4F,WAAa78E,EAAIC,MAAM84B,QAEC,kBAAlBz1B,GAASk4C,OACnBtjE,EAAIorB,EAASppB,OAAS8lB,EAAIC,MAAM/lB,OAAS8lB,EAAI2W,YAC7Cx+B,EAAImrB,EAASnpB,QAAU6lB,EAAIC,MAAM9lB,QAAU6lB,EAAI4W,aAC/C2zC,EAAYjnD,EAASw5E,YAAc,IACnCP,EAAK,mBAEDA,EAAGr8F,KAAK,GAAKhI,KAChBA,EAAIkC,KAAKjB,IAAIyqB,SAAS1rB,EAAG,IAAK,MAG3BqkG,EAAGr8F,KAAK,GAAK/H,KAChBA,EAAIiC,KAAKjB,IAAIyqB,SAASzrB,EAAG,IAAKoyE,IAI/BxwD,EAAIrV,EAAK82D,MAAMuhC,UACdhgB,WAAY/8D,EACZ9lB,MAAOhC,EACPiC,OAAQhC,EACR0zE,WAAYvoD,EAAS41E,YACrBptB,YAAaxoD,EAAS61E,eAIlB71E,EAASi+D,mBACbppF,GAAK4hB,EAAEijF,cAAgB7kG,IAAkB,gBAALA,GAAiB4hB,EAAE+xD,aAAe,EAAK,IACvE3zE,EAAIoyE,IACPpyE,EAAIoyE,MAINxwD,EAAIuJ,EAASk4C,MAAM92D,EAAMsb,GAGrBjG,EAAEkjF,gBAAgBj3F,WACrB+T,EAAEkjF,gBAAkBljF,EAAEkjF,gBAAgBhmG,GAAK8iB,EAAEkjF,gBAAgBhmG,IAAMyN,EAAKzN,GAAK,WAI1E8iB,EAAEmjF,gBAAgBl3F,WACrB+T,EAAEmjF,gBAAkBnjF,EAAEmjF,gBAAgBjmG,GAAK8iB,EAAEmjF,gBAAgBjmG,IAAMyN,EAAKzN,GAAK,oBAI9EkB,EAAI4hB,EAAEijF,cAAgBh9E,EAAI4W,cAG3BlyB,EAAKu4F,gBAAkBljF,EAAEkjF,iBAItB35E,EAAS65E,aACZrjF,EAAKmC,EAAQqH,EAAS65E,aAAc,SAASC,GAC5C14F,EAAK41F,WAAWxjG,KAAK4N,EAAK21F,gBAAgB34B,WAAW07B,MAKnD95E,EAAS+5E,eACZ34F,EAAKu3C,cAAcnlD,KAAKwsB,EAAS+5E,eAI9B/5E,EAASi+D,iBAEZ,MADAvhE,GAAM/F,EAAIF,EAAI,KACPrV,EAAK44F,iBAoBb,IAjBA54F,EAAK64F,WAAaj6E,EAASuqB,QAAU,eAIjCvqB,EAAS+1E,mBAAqB30F,EAAKo0F,kBACtCp0F,EAAK64F,YAAc,eAAiB74F,EAAK21F,gBAAgBh5B,SAAW,SAIhElgE,EAAIP,YAAc0iB,EAAS42E,aAC/Bx1F,EAAK64F,YAAc,wDAGpB74F,EAAK64F,YAAc,yEAId,KAAKr9F,KAAK/B,SAASoZ,SAASK,MAChC,IAAKlhB,EAAI,EAAGA,EAAIgO,EAAK41F,WAAW3jG,OAAQD,IAAK,CAC5C,GAAI8mG,GAAS94F,EAAK41F,WAAW5jG,EAC7BgO,GAAK64F,YACJ,gDAEY/gF,EAAML,gBAAgBqhF,GAAU,OAE7C94F,EAAK61F,UAAUiD,IAAU,EAI3BnB,EAAS/4E,EAASm6E,SAAW,UACzBpB,EAAOh8F,QAAQ,WAClBg8F,EAAS33F,EAAKi6D,SAAS,UAAW,GAAI,QACtC09B,EAASA,EAAO33F,EAAKzN,KAAOolG,GAG7BC,EAAYh5E,EAASo6E,YAAc,GAC/BpB,EAAUj8F,QAAQ,WACrBi8F,EAAY53F,EAAKi6D,SAAS,aAAc,GAAI,QAC5C29B,EAAYA,EAAU53F,EAAKzN,KAAO,IAG/BqsB,EAASq6E,0BACZj5F,EAAK64F,YAAc,uDAAyDj6E,EAASq6E,wBAA0B,QAGhHj5F,EAAK64F,YAAc,oBAAsBlB,EACxC,6BAA+BC,EAC/B,cAAgB53F,EAAKzN,GAAK,sBAG3B,IAAI2mG,GAAiB,2DACkBz/F,SAAS0/F,OAAS,yCACfn5F,EAAKzN,GAAK,iFAIhDkH,UAAS0/F,QAAUtmF,SAASumF,UAE3B38F,EAAIhC,IAAMgC,EAAIhC,GAAK,KACtBid,EAAMwhF,EAMR,IAAIpkB,GAAMzgD,EAAIxgC,OAAO,UACpBtB,GAAIyN,EAAKzN,GAAK,OAEd8mG,YAAa,IACbC,kBAAmB,OACnBrlB,MAAOj0E,EAAKm2E,cAAcle,UACxB,0FAGF18C,OACC/lB,MAAO,OACPC,OAAQhC,EACR4gD,QAAS,UAkBX,IAdAygC,EAAInmD,OAAS,WACZmmD,EAAInmD,OAAS,KACb3uB,EAAKiC,KAAK,SAGXoyB,EAAInD,UAAU4jD,EAAK,MAAOp9D,GAAO,iBAEjC1X,EAAKu5F,qBAAuBlkF,EAAEmjF,gBAC9Bx4F,EAAKw5F,cAAgB1kB,EAErBv/D,EAAI8e,EAAI1Z,IAAItF,EAAEmjF,gBAAiB1jB,GAI3Br6E,EACH,IACCuF,EAAK8+B,SACJ,MAAOhoC,GACRye,EAAEka,IAAM/X,EAAMwhF,EAIZ7jF,EAAEkjF,kBACLlkE,EAAItZ,IAAI1F,EAAEkjF,iBAAiBh9E,MAAM84B,QAAUr0C,EAAKm4F,WAChDn4F,EAAKulE,OAASlxC,EAAIK,SAASrf,EAAEkjF,kBAG9Bv4F,EAAK+3E,aAAax8D,MAAM84B,QAAU,OAClChgB,EAAInD,UAAUlxB,EAAKzN,GAAI,eAAe,GAEjCmlB,GACJ1X,EAAK44F,kBAGNt9E,EAAM/F,EAAIF,EAAI,MAUfujF,gBAAiB,SAASa,GACzB,GAA+F//F,GAAMggG,EAAjG15F,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,SAAUu2B,EAAYn1C,EAAK+3E,aAAcz5E,EAAM0B,EAAK8+B,QAGhFlgB,GAASolB,SACbhkC,EAAK+3E,aAAax8D,MAAMi7E,WAAax2F,EAAKu2F,eAItCkD,GAAc76E,EAASi+D,mBAC3Bv+E,EAAI65D,OACJ75D,EAAIq7F,MAAM35F,EAAK64F,YACfv6F,EAAIy0E,SAGDn0D,EAASi+D,mBACZ78E,EAAKid,GAAG,SAAU,WACjB,GAAIuyD,GAASz5E,KAAK4oC,SAElBtK,GAAIxX,YAAY2yD,EAAQ,oBACxBn7C,EAAIxX,YAAY2yD,EAAQ,kBACxBn7C,EAAInD,UAAUs+C,EAAQ,kBAAmB,QAG1Cn7C,EAAI1X,SAASw4B,EAAW,oBACxBn1C,EAAK8d,gBAAkBxf,EAAMsgB,EAASg7E,kBAAoBngG,SAC1DuG,EAAK+d,cAAgBa,EAASi7E,gBAAkBpiG,OAChDuI,EAAK85F,YAAc3kD,EAGnBv2B,EAASg7E,iBAAmBh7E,EAASi7E,eAAiB,KAGtDj7E,EAASwrB,UAAY+K,EAAU9wC,SAASC,eAIzC5K,EAAOsG,EAAK2+B,UACZjlC,EAAK2Z,UAAW,EAChBrT,EAAKqa,SAAWuE,EAASvE,SAEpBra,EAAKqa,WACLra,EAAKgkC,QAAkD,UAAxC3P,EAAIrC,SAASt4B,EAAM,YAAY,KACjDA,EAAK6hB,MAAMw0B,SAAW,YAGvBr2C,EAAKoC,gBAAkBkE,EAAKi6D,SAAS,0BAA0B,IAGhEvgE,EAAK2Z,UAAW,EAEhBrT,EAAK6pF,aAAe,GAAIoK,GAAaj0F,GAQrCA,EAAK6e,OAAS,GAAI0nB,GAAO3nB,GAWzB5e,EAAK2iB,IAAM,GAAIkN,GAASvxB,GACvB+wB,aAAa,EACb9N,cAAevhB,EAAK0oF,WACpBlnE,oBAAqBxhB,EACrB+5F,WAAYn7E,EAASo7E,uBACrBC,aAAcr7E,EAASq7E,aACvB7mE,eAAe,EACfhC,aAAcpxB,EAAKgkC,OAAShkC,EAAK2+B,UAAY,KAC7CtM,QAASzT,EAASi+D,iBAClBh+D,OAAQ7e,EAAK6e,OACb6U,YAAa,SAAS58B,GACrBkJ,EAAKiC,KAAK,YAAanL,MAUzBkJ,EAAKqrC,OAAS,GAAIsC,GAAU/uB,EAAU5e,EAAK6e,QAG3C7e,EAAKqrC,OAAOd,mBAAmB,0BAA2B,SAAS3vB,EAAOje,GAGzE,IAFA,GAAsBsR,GAAsB3W,EAAOm3C,EAA/Cz8C,EAAI4oB,EAAM3oB,OAAc0wB,EAAM3iB,EAAK2iB,IAEhC3wB,KAMN,GALAic,EAAO2M,EAAM5oB,GACbsF,EAAQ2W,EAAKgC,KAAKtT,GAClB8xC,EAAe,YAAc9xC,GAGxBsR,EAAK9B,WAAWzD,IAAI+lC,GAAe,CAEvC,GAA+B,IAA3Bn3C,EAAMqE,QAAQ,UAA6C,IAA3BrE,EAAMqE,QAAQ,SACjD,QAGY,WAATgB,GACHrF,EAAQqrB,EAAI4M,eAAe5M,EAAI6M,WAAWl4B,GAAQ2W,EAAKtR,MAElDrF,EAAMrF,SACVqF,EAAQ,MAGT2W,EAAKgC,KAAKw+B,EAAcn3C,GACxB2W,EAAKgC,KAAKtT,EAAMrF,IACG,aAATqF,GACVsR,EAAKgC,KAAKw+B,EAAcn3C,GACxB2W,EAAKgC,KAAKtT,EAAM,OAEhBsR,EAAKgC,KAAKw+B,EAAczuC,EAAK0oF,WAAWpxF,EAAOqF,EAAMsR,EAAKtR,UAO9DqD,EAAKqrC,OAAOf,cAAc,SAAU,SAAS1vB,GAG5C,IAFA,GAAsB3M,GAAMhQ,EAAxBjM,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACbiM,EAAOgQ,EAAKgC,KAAK,SAAW,UACC,IAAzBhS,EAAKtC,QAAQ,SAChBsS,EAAKgC,KAAK,OAAQ,OAAShS,KAK9B+B,EAAKqrC,OAAOf,cAAc,SAAU,SAAS1vB,GAG5C,IAFA,GAAsB3M,GAAlBjc,EAAI4oB,EAAM3oB,OAEPD,KACNic,EAAO2M,EAAM5oB,GACbic,EAAKhQ,KAAO,EACZgQ,EAAKtR,KAAO,WACZsR,EAAK3W,MAAQ,UAAY2W,EAAK3W,MAAQ,OAIxC0I,EAAKqrC,OAAOf,cAAc,0BAA2B,SAAS1vB,GAG7D,IAFA,GAAsB3M,GAAlBjc,EAAI4oB,EAAM3oB,OAAcy3C,EAAmB1pC,EAAK6e,OAAO+W,sBAEpD5jC,KACNic,EAAO2M,EAAM5oB,GAETic,EAAKwnB,QAAQiU,KAChBz7B,EAAK4N,OAAO,GAAI6jB,GAAK,KAAM,IAAIY,YAAa,KAc/CtgC,EAAKq9C,WAAa,GAAIi2C,GAAc10E,EAAU5e,GAiB9CA,EAAKi/B,UAAY,GAAIyQ,GAAU1vC,EAAK2iB,IAAK3iB,EAAK2gD,SAAU3gD,EAAKq9C,WAAYr9C,GAQzEA,EAAK4hD,UAAY,GAAI2xC,GAAUvzF,GAW/BA,EAAKswD,YAAc,GAAIkjC,GAAYxzF,GAEnCA,EAAKk6F,YAAc,GAAIxG,GAAY1zF,GACnCA,EAAKm6F,SAAW,GAAI1G,GAASzzF,GAC7BA,EAAKo6F,sBAAwB,GAAI/G,GAAWrzF,GAC5CA,EAAKk2D,oBAAsB,GAAIk4B,GAAmBpuF,GAElDA,EAAKiC,KAAK,WAEL2c,EAASy7E,oBAAuBz7E,EAAS07E,mBAC7Ch8F,EAAI5E,KAAK6gG,YAAa,EACtBlmE,EAAInD,UAAUx3B,EAAM,aAAc,UAGnCsG,EAAKg3D,OAAS,GAAI88B,GAAO9zF,GACzBA,EAAKiC,KAAK,cAEN2c,EAAS47E,iBACZ9gG,EAAKiO,IAAMiX,EAAS47E,gBAGjB57E,EAAS67E,SACZ/gG,EAAK6hB,MAAMolD,WAAa,UAGrB/hD,EAAS87E,SACZ16F,EAAKid,GAAG,mBAAoB,SAASnmB,GACpCse,EAAKwJ,EAAS87E,QAAS,SAASppF,GAC/Bxa,EAAEulB,QAAUvlB,EAAEulB,QAAQ5X,QAAQ6M,EAAS,SAAS+E,GAC/C,MAAO,qBAAuByiE,OAAOziE,GAAO,YAMhDrW,EAAKid,GAAG,aAAc,WACrBjd,EAAKo2D,UAAUp2D,EAAK2+B,aAIjB/f,EAASy2E,mBACZr1F,EAAKid,GAAG,cAAe,SAASnmB,GAC/BA,EAAEulB,QAAUvlB,EAAEulB,QAAQ5X,QAAQ,oEAAqE,MAIrGzE,EAAK8sB,MAAM6tE,SAAS,EAAMzrD,OAAQ,SAClClvC,EAAK62F,aAAe72F,EAAK+sC,YAAYmC,OAAQ,QAY7ClvC,EAAKu/B,aAAc,EACnBv/B,EAAKygF,4BAELzgF,EAAKiC,KAAK,QACVjC,EAAK+S,OAAM,GACX/S,EAAKq/B,aAAas7D,SAAS,IAC3B36F,EAAKi2F,aAAa,yBAA0Bj2F,GAE5CA,EAAKid,GAAG,kCAAmC,SAASnmB,GACnDkJ,EAAK03C,UAAuB,qBAAX5gD,EAAEmH,OAIhB+B,EAAKu3C,cAActlD,OAAS,IAC/BynG,EAAiB,GAEjBtkF,EAAKpV,EAAKu3C,cAAe,SAASh8B,GACjCm+E,GAAkBn+E,EAAQ,SAG3Bvb,EAAK2iB,IAAIuR,SAASwlE,IAInBtkF,EAAKpV,EAAK41F,WAAY,SAASkD,GACzB94F,EAAK61F,UAAUiD,KACnB94F,EAAK2iB,IAAI4R,QAAQukE,GACjB94F,EAAK61F,UAAUiD,IAAU,KAKvBl6E,EAASg8E,YACZp+F,EAAM7C,iBAAiBqG,EAAM,WAC5B,GAAIpG,EAGHA,GADGglB,EAASg8E,cAAe,EAClB56F,EAEAA,EAAKm2E,cAAcp7D,IAAI6D,EAASg8E,YAGrChhG,EAAOw9F,WACXx9F,EAAOmZ,SAEN,KAIJoiC,EAAY72C,EAAM5E,EAAO,MAU1BqZ,MAAO,SAAS8nF,GAIf,QAASC,GAAuB7sF,GAC/B,MAAOjO,GAAK2iB,IAAIwP,UAAUlkB,EAAM,SAASA,GACxC,MAA6C,SAAtCjO,EAAK2iB,IAAI8T,mBAAmBxoB,KALrC,GAA+F0tB,GAC3Fya,EAAwD2kD,EADxD/6F,EAAOjK,KAAMkpC,EAAYj/B,EAAKi/B,UAAWnjC,EAAkBkE,EAAK4e,SAASi+D,iBAC7Dv+E,EAAM0B,EAAK8+B,SAAUplC,EAAOsG,EAAK2+B,SAQjD,KAAKk8D,EAAW,CAWf,GATAl/D,EAAMsD,EAAUC,SACZvD,EAAIlmB,OACP2gC,EAAaza,EAAIlmB,KAAK,IAGvBzV,EAAKg3D,OAAO+mB,yBAGZgd,EAAsBD,EAAuB77D,EAAUV,WACnDv+B,EAAK6uB,EAAEltB,SAASjI,EAAMqhG,GAIzB,MAHAA,GAAoBhoF,QACpBksB,EAAU1C,gBACVv8B,GAAKm2E,cAAcC,UAAUp2E,EAgB9B,IAXKlE,IAGCW,EAAIlC,OACRyF,EAAK2+B,UAAU5rB,QAGhB/S,EAAK2gD,SAAS5tC,SAIXwsE,GAAWzjF,EAAiB,CAE/B,GAAIpC,EAAK08E,UAER,IACC18E,EAAK08E,YACJ,MAAO5+E,GACRkC,EAAKqZ,YAGNrZ,GAAKqZ,OAGFjX,IACHmjC,EAAU1C,YAOR6Z,GAAcA,EAAW/3C,eAAiBC,IAC7Cq9B,EAAMr9B,EAAI5E,KAAK83C,qBACf7V,EAAI8V,WAAW2E,GACfza,EAAIx2B,UAINnF,EAAKm2E,cAAcC,UAAUp2E,IAW9Bi2F,aAAc,SAASt5F,GACtB,GAAiD6D,GAA7CR,EAAOjK,KAAMlE,EAAWmO,EAAK4e,SAASjiB,EAE1C,IAAK9K,EAkBL,MAbImO,GAAKg7F,iBAAmBx6F,EAAQR,EAAKg7F,eAAer+F,MACvD9K,EAAW2O,EAAMvG,KACjBuG,EAAQA,EAAMA,OAGS,gBAAb3O,KACV2O,EAAQ3O,EAAS4S,QAAQ,SAAU,IACnCjE,EAAQA,EAAQrO,EAAQqO,GAAS,EACjC3O,EAAWM,EAAQN,GACnBmO,EAAKg7F,eAAiBh7F,EAAKg7F,mBAC3Bh7F,EAAKg7F,eAAer+F,IAAS1C,KAAMpI,EAAU2O,MAAOA,IAG9C3O,EAASQ,MAAMmO,GAASR,EAAMlI,MAAME,UAAUI,MAAMlB,KAAKxE,UAAW,KAW5EulE,UAAW,SAASzlD,GACnB,GAAIE,GAAO3c,KAAK6oB,SAAS0Z,UAAY,KAAMw/D,EAAO/hG,KAAKogF,cAAc2hB,IAErE,OAAKtlF,IAILA,EAAOslF,EAAKr6F,KAAKiV,EAAO,IAAMF,IAASA,EAAK/N,QAAQ,kBAAmB,SAAS8B,EAAGC,GAClF,MAAOsxF,GAAKr6F,KAAKiV,EAAO,IAAMlM,IAAM,KAAOA,EAAI,MAGzCzQ,KAAKogF,cAAcle,UAAUzlD,IAP5B,IAiBT0lF,QAAS,SAASv7F,EAAMm3B,GACvB,MACC/9B,MAAKogF,cAAc2hB,KAAKr6F,MAAM1H,KAAK6oB,SAAS0Z,UAAY,MAAQ,IAAM37B,KACrEm3B,IAAepiC,EAAYoiC,EAAa,KAAOn3B,EAAO,MAmBzDs9D,SAAU,SAASt9D,EAAMm3B,EAAY71B,GACpC,GAAsEmtC,GAAlE9zC,EAAQqF,IAAQ5G,MAAK6oB,SAAW7oB,KAAK6oB,SAASjiB,GAAQm3B,CAE1D,OAAa,SAAT71B,GACHmtC,KAEqB,gBAAV9zC,GACV8d,EAAK9d,EAAMqE,QAAQ,KAAO,EAAIrE,EAAMzE,MAAM,6BAA+ByE,EAAMzE,MAAM,KAAM,SAASyE,GACnGA,EAAQA,EAAMzE,MAAM,KAEhByE,EAAMrF,OAAS,EAClBm5C,EAAOh1B,EAAK9e,EAAM,KAAO8e,EAAK9e,EAAM,IAEpC8zC,EAAOh1B,EAAK9e,EAAM,KAAO8e,EAAK9e,KAIhC8zC,EAAS9zC,EAGH8zC,GAGD9zC,GAUR+nC,YAAa,SAASlnC,GACrBpC,KAAKqkG,sBAAsB/6D,YAAYlnC,IA2BxC8iG,UAAW,SAASt+F,EAAMiiB,GACzB,GAAI5e,GAAOjK,IAEP6oB,GAAS2uC,MACZ3uC,EAAS03D,QAAU,WAClBt2E,EAAKg3C,YAAYp4B,EAAS2uC,OAIvB3uC,EAASpM,MAASoM,EAASu4D,OAC/Bv4D,EAASu4D,KAAOx6E,GAGjBqD,EAAK6zE,QAAU7zE,EAAK6zE,YACpBj1D,EAASi4D,QAAUj4D,EAASi4D,SAAWj4D,EAASq1D,MAChDj0E,EAAK6zE,QAAQl3E,GAAQiiB,GA4BtBs8E,YAAa,SAASv+F,EAAMiiB,GAC3B,GAAI5e,GAAOjK,IAEP6oB,GAAS2uC,MACZ3uC,EAAS03D,QAAU,WAClBt2E,EAAKg3C,YAAYp4B,EAAS2uC,OAI5BvtD,EAAKm7F,UAAYn7F,EAAKm7F,cACtBn7F,EAAKm7F,UAAUx+F,GAAQiiB,GAUxBw8E,kBAAmB,SAASllF,EAAWO,GACtC,GAAiBxT,GAAbjD,EAAOjK,IAEXiK,GAAKq7F,gBAAkBr7F,EAAKq7F,oBAGJ,gBAAbnlF,KACVjT,EAAWiT,EACXA,EAAY,SAASoF,GACpB,MAAOtb,GAAK2iB,IAAIpM,GAAG+E,EAAKrY,KAI1BjD,EAAKq7F,gBAAgBjpG,MACpBG,GAAI2hG,EAAKd,KAAK,QACdl9E,UAAWA,EACXO,MAAOA,KAyBT2gD,WAAY,SAASz6D,EAAM9K,EAAU2O,GASpCzK,KAAK+/F,eAAe1+B,WAAWz6D,EAAM9K,EAAU2O,IAYhD82D,qBAAsB,SAAS36D,EAAM9K,EAAU2O,GAO9CzK,KAAK+/F,eAAex+B,qBAAqB36D,EAAM9K,EAAU2O,IAY1D+2D,qBAAsB,SAAS56D,EAAM9K,EAAU2O,GAO9CzK,KAAK+/F,eAAev+B,qBAAqB56D,EAAM9K,EAAU2O,IAa1DulD,YAAa,SAASz0C,EAASswE,EAAMC,EAASrhF,GAC7CzK,KAAK4mF,UAAUhiE,IAAIrJ,EAASswE,EAAMC,EAASrhF,IAe5Cw2C,YAAa,SAASuW,EAAKkJ,EAAIn/D,EAAOa,GACrC,MAAOpC,MAAK+/F,eAAe9+C,YAAYuW,EAAKkJ,EAAIn/D,EAAOa,IAUxD4+D,kBAAmB,SAASxJ,GAC3B,MAAOx3D,MAAK+/F,eAAe/+B,kBAAkBxJ,IAU9C0J,kBAAmB,SAAS1J,GAC3B,MAAOx3D,MAAK+/F,eAAe7+B,kBAAkB1J,IAU9C8J,sBAAuB,SAAS9J,GAC/B,MAAOx3D,MAAK+/F,eAAez+B,sBAAsB9J,IAQlDnwC,KAAM,WACL,GAAIpd,GAAOjK,IAEPiK,GAAKulE,SACRvlE,EAAKulE,QAAS,EAEVvlE,EAAKgkC,OACRhkC,EAAK2+B,UAAU7iC,iBAAkB,GAEjCu4B,EAAIjX,KAAKpd,EAAKipD,gBACd50B,EAAIhX,KAAKrd,EAAKzN,KAGfyN,EAAK8sB,OACL9sB,EAAKiC,KAAK,UASZob,KAAM,WACL,GAAIrd,GAAOjK,KAAMuI,EAAM0B,EAAK8+B,QAEvB9+B,GAAKulE,SAEL9qE,GAAM6D,IAAQ0B,EAAKgkC,QACtB1lC,EAAI04C,YAAY,aAIjBh3C,EAAKk3F,OAEDl3F,EAAKgkC,QACRhkC,EAAK2+B,UAAU7iC,iBAAkB,EAG7BkE,GAAQA,EAAKm2E,cAAcmlB,gBAC9Bt7F,EAAKm2E,cAAcmlB,cAAgB,QAGpCjnE,EAAIhX,KAAKrd,EAAKipD,gBACd50B,EAAIlB,SAASnzB,EAAKzN,GAAI,UAAWyN,EAAKm4F,aAGvCn4F,EAAKulE,QAAS,EACdvlE,EAAKiC,KAAK,UAUZyyB,SAAU,WACT,QAAS3+B,KAAKwvE,QAqBfg2B,iBAAkB,SAASz+E,EAAO7jB,GACjClD,KAAKkM,KAAK,iBAAkB6a,MAAOA,EAAO7jB,KAAMA,KAYjD6zB,KAAM,SAAS30B,GACd,GAA0CggB,GAAtCnY,EAAOjK,KAAMulB,EAAMtb,EAAK+3E,YAE5B,IAAIz8D,EAaH,MAZAnjB,GAAOA,MACPA,EAAK20B,MAAO,EAEZ3U,EAAOnY,EAAKg+C,WAAW1iC,EAAIhkB,QAAU5F,EAAY4pB,EAAIhkB,MAAQgkB,EAAIxM,UAAW3W,GAC5EA,EAAKS,QAAU0iB,EAEVnjB,EAAKg3C,WACTnvC,EAAKiC,KAAK,cAAe9J,GAG1BA,EAAKS,QAAU0iB,EAAM,KAEdnD,GAaT++E,KAAM,SAAS/+F,GACd,GAA0CggB,GAAMs+E,EAA5Cz2F,EAAOjK,KAAMulB,EAAMtb,EAAK+3E,YAE5B,IAAKz8D,GAAQtb,EAAKu/B,YA8ClB,MA1CApnC,GAAOA,MACPA,EAAK++F,MAAO,EAEZ/+F,EAAKS,QAAU0iB,EACfnD,EAAOhgB,EAAKkkB,QAAUrc,EAAK+sC,WAAW50C,GAEjCA,EAAKg3C,WACTnvC,EAAKiC,KAAK,cAAe9J,GAIP,OAAfA,EAAK+2C,QACRlvC,EAAKiC,KAAK,iBAAkB9J,GAG7BggB,EAAOhgB,EAAKkkB,QAEP,kBAAkB7gB,KAAK8f,EAAIjX,UAgB/BiX,EAAIhkB,MAAQ6gB,GAdPnY,EAAKgkC,SACT1oB,EAAIxM,UAAYqJ,IAIZs+E,EAAOpiE,EAAIlC,UAAUnyB,EAAKzN,GAAI,UAClC6iB,EAAKqhF,EAAKzmF,SAAU,SAASsL,GAC5B,GAAIA,EAAI3e,MAAQqD,EAAKzN,GAEpB,MADA+oB,GAAIhkB,MAAQ6gB,GACL,KAQXhgB,EAAKS,QAAU0iB,EAAM,KAEjBnjB,EAAKk/F,aAAc,GACtBr3F,EAAKitD,UAAS,GAGR90C,GAwBR6lC,WAAY,SAAS3hC,EAASlkB,GAC7B,GAAwCg3D,GAAqBqsC,EAAzDx7F,EAAOjK,KAAM2D,EAAOsG,EAAK2+B,SAqE7B,OAlEAxmC,GAAOA,MACPA,EAAK+2C,OAAS/2C,EAAK+2C,QAAU,OAC7B/2C,EAAK6iB,KAAM,EACX7iB,EAAKkkB,QAAUA,EAGVlkB,EAAKg3C,WACTnvC,EAAKiC,KAAK,mBAAoB9J,GAG/BkkB,EAAUlkB,EAAKkkB,QAIQ,IAAnBA,EAAQpqB,QAAgB,QAAQuJ,KAAK6gB,IACxCm/E,EAAO/gG,GAAMA,EAAK,GAAK,GAAK,0BAIP,SAAjBf,EAAK2K,SACRgY,EAAU,WAAam/E,EAAO,aACpB,YAAYhgG,KAAK9B,EAAK2K,YAChCgY,EAAU,OAASm/E,EAAO,SAG3BrsC,EAAsBnvD,EAAK4e,SAASgtB,kBAGhCujB,GAAuBnvD,EAAK6e,OAAOwnB,aAAa3sC,EAAK2K,SAASC,cAAe6qD,EAAoB7qD,gBAEpG+X,EAAUm/E,EACVn/E,EAAUrc,EAAK2iB,IAAIqQ,WAAWm8B,EAAqBnvD,EAAK4e,SAASmsB,wBAAyB1uB,IAC/E5hB,GAAO4hB,IAElBA,EAAU,2BAGXrc,EAAK2iB,IAAIoQ,QAAQr5B,EAAM2iB,GAEvBrc,EAAKiC,KAAK,aAAc9J,KAGJ,QAAhBA,EAAK+2C,SACR7yB,EAAU,GAAIuxB,IACbnG,SAAUznC,EAAKynC,UACbznC,EAAK6e,QAAQ+C,UACf5hB,EAAKqrC,OAAOtrB,MAAM1D,GAAU2vB,eAAe,MAK7C7zC,EAAKkkB,QAAUjG,EAAKiG,GACpBrc,EAAK2iB,IAAIoQ,QAAQr5B,EAAMvB,EAAKkkB,SAGvBlkB,EAAKg3C,WACTnvC,EAAKiC,KAAK,aAAc9J,IAUnBA,EAAKkkB,SAoBb0wB,WAAY,SAAS50C,GACpB,GAAiBkkB,GAAbrc,EAAOjK,KAAe2D,EAAOsG,EAAK2+B,SAkCtC,OA/BAxmC,GAAOA,MACPA,EAAK+2C,OAAS/2C,EAAK+2C,QAAU,OAC7B/2C,EAAK4iB,KAAM,EACX5iB,EAAKk3C,UAAW,EAGXl3C,EAAKg3C,WACTnvC,EAAKiC,KAAK,mBAAoB9J,GAK9BkkB,EADkB,OAAflkB,EAAK+2C,OACElvC,EAAKq9C,WAAWlP,oBACD,QAAfh2C,EAAK+2C,OACLx1C,EAAK+Y,WAAa/Y,EAAKgX,YAEvB1Q,EAAKq9C,WAAWz7B,UAAUloB,EAAMvB,GAIxB,QAAfA,EAAK+2C,OACR/2C,EAAKkkB,QAAUjG,EAAKiG,GAEpBlkB,EAAKkkB,QAAUA,EAIXlkB,EAAKg3C,WACTnvC,EAAKiC,KAAK,aAAc9J,GAGlBA,EAAKkkB,SAUbuxE,cAAe,SAASvxE,EAASlkB,GAC5BA,IACHkkB,EAAUjF,GAAQiF,QAASA,GAAUlkB,IAGtCpC,KAAKihD,YAAY,oBAAoB,EAAO36B,IAgB7CqxC,QAAS,WACR,OAAQ33D,KAAK0lG,YAmBdxuC,SAAU,SAASnwC,GAClB,GAAI4+E,IAAY3lG,KAAK0lG,UAErB1lG,MAAK0lG,YAAc3+E,EAEfA,GAASA,GAAS4+E,GACrB3lG,KAAKkM,KAAK,UAUZ8+E,QAAS,SAASr/C,GACjBqyD,EAAKhT,QAAQhrF,KAAM2rC,IAUpBunB,aAAc,WACb,GAAIjpD,GAAOjK,IAMX,OAJKiK,GAAKM,YACTN,EAAKM,UAAY+zB,EAAItZ,IAAI/a,EAAKu4F,iBAAmBv4F,EAAKzN,GAAK,YAGrDyN,EAAKM,WAUb03E,wBAAyB,WACxB,MAAOjiF,MAAKwjG,sBASbxhB,WAAY,WAKX,MAJKhiF,MAAKo/C,YACTp/C,KAAKo/C,UAAY9gB,EAAItZ,IAAIhlB,KAAKxD,KAGxBwD,KAAKo/C,WASbwL,OAAQ,WACP,GAAiBrlC,GAAbtb,EAAOjK,IAUX,OARKiK,GAAK+d,gBACTzC,EAAMtb,EAAKw5F,cAEPl+E,IACHtb,EAAK+d,cAAgBzC,EAAIyC,gBAIpB/d,EAAK+d,eASb+gB,OAAQ,WACP,GAAiBt/B,GAAbQ,EAAOjK,IAUX,OARKiK,GAAK8d,kBACTte,EAAMQ,EAAK2gD,SAEPnhD,IACHQ,EAAK8d,gBAAkBte,EAAI/F,WAItBuG,EAAK8d,iBAUb6gB,QAAS,WACR,MAAO5oC,MAAK+jG,aAAe/jG,KAAK+oC,SAASplC,MAc1CgvF,WAAY,SAAShxE,EAAK/a,EAAM2e,GAC/B,GAAItb,GAAOjK,KAAM6oB,EAAW5e,EAAK4e,QAGjC,OAAIA,GAAS+8E,sBACL37F,EAAKi2F,aAAa,wBAAyBv+E,EAAK4D,GAAK,EAAM3e,IAI9DiiB,EAASm2E,cAAiBz5E,GAAuB,QAAhBA,EAAIjX,UAAgD,IAAzBqT,EAAI/b,QAAQ,UAAiC,IAAf+b,EAAIzlB,OAC3FylB,EAIJkH,EAASo2E,cACLh1F,EAAK21F,gBAAgB/4B,WAAWllD,GAIxCA,EAAM1X,EAAK21F,gBAAgB34B,WAAWtlD,EAAKkH,EAASq2E,qBAWrD7+B,UAAW,SAAS96C,GACnB,GAA2DmZ,GAAvDz0B,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,SAAU+D,EAAM3iB,EAAK2iB,GAEtDrH,GAAMA,GAAOtb,EAAK2+B,UAEd3+B,EAAKq6D,YAAc3oE,IACtBsO,EAAKq6D,UAAYz7C,EAASs2E,QAG3B9/E,EAAKuN,EAAIxd,OAAO,UAAWmW,GAAM,SAASA,GACzC,GAAIhkB,EAEJ,QAAQgkB,EAAIjX,UACX,IAAK,QAUJ,MATAowB,GAAM7V,EAASg9E,oBAAsB,iBACrCtkG,EAAQqrB,EAAIwO,UAAU7V,EAAK,eAErBhkB,GAAkB,KAATA,IAAiB0I,EAAKq6D,UAGpC13C,EAAI9F,YAAYvB,EAAKmZ,GAFrB9R,EAAIhG,SAASrB,EAAKmZ,GAOpB,KAAK,IAYJ,YAXK9R,EAAIwO,UAAU7V,EAAK,QAAQ,KAC/BhkB,EAAQqrB,EAAIwO,UAAU7V,EAAK,SAAWA,EAAI/oB,GAC1CkiC,EAAM7V,EAASi9E,qBAAuB,kBAElCvkG,GAAS0I,EAAKq6D,UACjB13C,EAAIhG,SAASrB,EAAKmZ,GAElB9R,EAAI9F,YAAYvB,EAAKmZ,QAQ1Bz0B,EAAKiC,KAAK,aAAcrJ,QAAS0iB,EAAK++C,UAAWr6D,EAAKq6D,aAQvDz+C,OAAQ,WACP,GAAI5b,GAAOjK,IAENiK,GAAKnG,UACTmG,EAAKk3F,OACLl3F,EAAKnG,QAAU,EACfmG,EAAK2gF,wBAGD3gF,EAAK22F,gBACRtiE,EAAIzY,OAAO5b,EAAK+3E,aAAalxE,aAGzB7G,EAAKgkC,SAGLvpC,GAAMA,EAAK,IACduF,EAAK8+B,SAASkY,YAAY,aAAa,EAAO,MAG/C3iB,EAAIlB,SAASnzB,EAAKzN,GAAI,UAAWyN,EAAKm4F,YACtCn4F,EAAK2+B,UAAUhQ,OAAS,MAGzB3uB,EAAKiC,KAAK,UAEVjC,EAAKm2E,cAAcv6D,OAAO5b,GAC1Bq0B,EAAIzY,OAAO5b,EAAKipD,gBAChBjpD,EAAKk2D,oBAAoB3zD,UACzBvC,EAAK6pF,aAAatnF,UAClBvC,EAAKuC,YAYPA,QAAS,SAASu5F,GACjB,GAAiBrF,GAAbz2F,EAAOjK,IAGX,KAAIiK,EAAKo3F,UAAT,CAMA,IAAK0E,IAAc97F,EAAKnG,QAEvB,WADAmG,GAAK4b,QAIDkgF,KACJ97F,EAAKm2E,cAAcj5D,IAAI,eAAgBld,EAAKm3F,eAGxCn3F,EAAK82D,OAAS92D,EAAK82D,MAAMv0D,SAC5BvC,EAAK82D,MAAMv0D,UAIZvC,EAAKi/B,UAAU18B,UACfvC,EAAK2iB,IAAIpgB,WAGVk0F,EAAOz2F,EAAK02F,YACRD,IACCA,EAAKK,gBACRL,EAAKniF,OAASmiF,EAAKK,cACnBL,EAAKK,cAAgB,MAGtBziE,EAAIxyB,OAAO40F,EAAM,eAAgBz2F,EAAK42F,oBAGvC52F,EAAKu5F,qBAAuBv5F,EAAK02F,YAAc12F,EAAKM,UAAYN,EAAKu4F,gBAAkB,KACvFv4F,EAAK85F,YAAc95F,EAAK8d,gBAAkB9d,EAAK+d,cAAgB,KAC/D/d,EAAKw5F,cAAgBx5F,EAAKm1C,UAAY,KAElCn1C,EAAKi/B,YACRj/B,EAAKi/B,UAAYj/B,EAAKi/B,UAAUz/B,IAAMQ,EAAKi/B,UAAUtc,IAAM3iB,EAAKi/B,UAAUtc,IAAIrkB,IAAM,MAGrF0B,EAAKo3F,UAAY,IAUlBzO,aAAc,SAAS92F,GACtB,MAAOkE,MAAK8zF,aAAalB,aAAa92F,IAKvCkqG,eAAgB,WACf,MAAOhmG,MAAK8zF,aAAaZ,kBAI3B7xE,EAAO+8E,EAAOn8F,UAAWwoF,GAElB2T,IAqBR7hG,EAAO,uBAAyB,WAG/B,GAAImL,MAAW4nD,EAAO,IAEtB,QAOC0yC,QAAS,SAASiE,GACbA,IACH32C,EAAO22C,EACPjmG,KAAK4uE,MAAM5uE,KAAK0H,KAAKu+F,IAAuC,QAA5BjmG,KAAK0H,KAAKu+F,GAASC,OAUrDC,QAAS,WACR,MAAO72C,IASRsf,KAAK,EASLhqD,IAAK,SAAS0qC,EAAM5uC,GACnB,GAAI0lF,GAAW1+F,EAAK4nD,EAEf82C,KACJ1+F,EAAK4nD,GAAQ82C,KAGd,KAAK,GAAIx/F,KAAQ8Z,GAChB0lF,EAASx/F,GAAQ8Z,EAAM9Z,EAGxB5G,MAAKgiG,QAAQ1yC,IAed4S,UAAW,SAASzlD,GACnB,GAAI2pF,EAOJ,IALAA,EAAW1+F,EAAK4nD,GACX82C,IACJA,MAGkB,mBAAR3pF,GACV,MAAOA,EAGR,IAAmB,gBAARA,IAAoBA,EAAKq5B,IACnC,MAAOr5B,GAAKq5B,GAGb,IAAIr5B,EAAKpgB,KAAM,CACd,GAAIsG,GAAS8Z,EAAKpa,MAAM,EAExBoa,IAAQ2pF,EAAS3pF,EAAK,KAAOA,EAAK,IAAI/N,QAAQ,gBAAiB,SAAS23F,EAAQC,GAC/E,MAAO3jG,GAAO2jG,KAIhB,OAAQF,EAAS3pF,IAASA,GAAM/N,QAAQ,iBAAkB,KAG3DhH,KAAMA,KAyBRnL,EAAO,wBACN,uBACA,qBACA,eACE,SAASu9B,EAAUrzB,EAAOC,GAS5B,QAAS6/F,GAAanmB,GACrB,QAASomB,KACR,IACC,MAAO9iG,UAASuZ,cACf,MAAOxb,GAGR,MAAOiC,UAASC,MAMlB,QAAS8iG,GAAe75E,EAAKgZ,GAC5B,GAAIA,GAAOA,EAAIvX,eAAgB,CAE9B,IAAKzB,EAAIgU,UAAUgF,EAAIvX,eAAgBzB,EAAIgO,aAAehO,EAAIgU,UAAUgF,EAAInX,aAAc7B,EAAIgO,WAC7F,MAGD,QACCvM,eAAgBuX,EAAIvX,eACpBE,YAAaqX,EAAIrX,YACjBE,aAAcmX,EAAInX,aAClBE,UAAWiX,EAAIjX,WAIjB,MAAOiX,GAGR,QAAS8gE,GAAc7iG,EAAQ82C,GAC9B,GAAI/U,EAUJ,OARI+U,GAAStsB,gBACZuX,EAAM/hC,EAAOklC,SAAShJ;AACtB6F,EAAI/Y,SAAS8tB,EAAStsB,eAAgBssB,EAASpsB,aAC/CqX,EAAI5Y,OAAO2tB,EAASlsB,aAAcksB,EAAShsB,YAE3CiX,EAAM+U,EAGA/U,EAGR,QAAS+gE,GAAYphF,GACpB,QAAS+Y,EAAIlC,UAAU7W,EAAKghF,EAAaK,mBAG1C,QAASlL,GAAe36F,GACvB,GAAI8C,GAAS9C,EAAE8C,MAEfA,GAAOqjB,GAAG,OAAQ,YAEbrjB,EAAOoqC,QAAUvnC,EAAIhC,MAEpB,sBAAwBhB,WAAYgD,EAAIhC,GAAK,EAChDb,EAAO+oB,IAAIhtB,KAAKiE,EAAO+kC,UAAW,mBAAoB,SAAS7nC,GAC9D,GAAIA,EAAEnE,QAAUiH,EAAO+kC,UAIvB,IACC/kC,EAAOilC,QAAUjlC,EAAOqlC,UAAUC,SACjC,MAAO1nC,OAMVoC,EAAOqjB,GAAG,2BAA4B,SAASnmB,GAC9C,GAAImX,GAAOsuF,GAGG,eAAVzlG,EAAEmH,MAAwBnH,EAAEwoC,kBAK5BrxB,GAAQA,EAAK1b,IAAMqH,EAAOrH,GAAK,SAClC0b,EAAOrU,EAAO+kC,WAGX/kC,EAAO+oB,IAAIgU,UAAU1oB,EAAMrU,EAAO+kC,aACrC/kC,EAAOilC,QAAUjlC,EAAOqlC,UAAUC,aAOjCziC,EAAIjC,SAAWoiG,IAClBA,EAAyB,WACxB,GAAItc,GAAenK,EAAcmK,YAEjC,IAAIA,GAAgBA,EAAarhD,UAAW,CAC3C,GAAItD,GAAM2kD,EAAarhD,UAAUC,QAG7BvD,KAAQA,EAAIhY,YACf/pB,EAAOilC,QAAUlD,KAKpBtH,EAAI1+B,KAAK8D,SAAU,kBAAmBmjG,OAKzChjG,EAAOqjB,GAAG,aAAc,WACvBrjB,EAAOilC,QAAU,OAIlBjlC,EAAOqjB,GAAG,YAAa,WACtBrjB,EAAOqlC,UAAUqf,kBAAoB,OAGtC1kD,EAAOqjB,GAAG,UAAW,WACpB,GAAiD4hB,GAA7Cy8D,EAAgBnlB,EAAcmlB,aAE9B1hG,GAAOqlC,UAAUqf,oBACpBzf,EAAU49D,EAAc7iG,EAAQA,EAAOqlC,UAAUqf,mBACjD1kD,EAAOqlC,UAAUqf,kBAAoB,KACrC1kD,EAAOqlC,UAAUge,OAAOpe,IAGrBy8D,GAAiB1hG,IAChB0hG,GACHA,EAAcr5F,KAAK,QAASq5F,cAAe1hG,IAG5Cu8E,EAAcC,UAAUx8E,GACxBu8E,EAAcmlB,cAAgB1hG,EAC9BA,EAAOqI,KAAK,SAAU46F,cAAevB,IACrC1hG,EAAOmZ,OAAM,IAGdnZ,EAAOilC,QAAU,OAGlBjlC,EAAOqjB,GAAG,WAAY,WACrBzgB,EAAM7C,iBAAiBC,EAAQ,WAC9B,GAAI0hG,GAAgBnlB,EAAcmlB,aAG7BoB,GAAYH,MAAuBjB,GAAiB1hG,IACxDA,EAAOqI,KAAK,QAASq5F,cAAe,OACpCnlB,EAAcmlB,cAAgB,KAG1B1hG,EAAOqlC,YACVrlC,EAAOqlC,UAAUqf,kBAAoB,WAQpCw+C,IACJA,EAAyB,SAAShmG,GACjC,GAA+CnE,GAA3C2tF,EAAenK,EAAcmK,YAEjC3tF,GAASmE,EAAEnE,OAEP2tF,GAAgB3tF,EAAO0L,eAAiB5E,WAGvC6mF,EAAarhD,WAAatsC,GAAU2tF,EAAa3hD,YACpD2hD,EAAarhD,UAAUqf,kBAAoBk+C,EAAelc,EAAa39D,IAAK29D,EAAazhD,UAItFlsC,GAAU8G,SAASC,MAASgjG,EAAY/pG,IAAWwjF,EAAcmlB,eAAiBhb,IACrFA,EAAar+E,KAAK,QAASq5F,cAAe,OAC1CnlB,EAAcmlB,cAAgB,QAKjCjnE,EAAI1+B,KAAK8D,SAAU,UAAWqjG,IAM3BljG,EAAOoqC,SAAW+4D,IACrBA,EAAyB,SAASjmG,GACjC,GAAIwpF,GAAenK,EAAcmK,aAAc39D,EAAM29D,EAAa39D,GAElE,IAAI29D,EAAat8C,QAAUrhB,IAAQA,EAAIgU,UAAU7/B,EAAEnE,OAAQ2tF,EAAa3hD,WAAY,CACnF,GAAIhD,GAAM2kD,EAAarhD,UAAUC,QAE5BvD,GAAIhY,YACR28D,EAAazhD,QAAUlD,KAK1BtH,EAAI1+B,KAAK8D,SAAU,UAAWsjG,IAIhC,QAASC,GAAyBlmG,GAC7Bq/E,EAAcmlB,eAAiBxkG,EAAE8C,SACpCu8E,EAAcmlB,cAAgB,MAG1BnlB,EAAcmK,eAClBjsD,EAAIxyB,OAAOpI,SAAU,kBAAmBmjG,GACxCvoE,EAAIxyB,OAAOpI,SAAU,UAAWqjG,GAChCzoE,EAAIxyB,OAAOpI,SAAU,UAAWsjG,GAChCH,EAAyBE,EAAyBC,EAAyB,MAI7E5mB,EAAcl5D,GAAG,YAAaw0E,GAC9Btb,EAAcl5D,GAAG,eAAgB+/E,GAnOlC,GAAIJ,GAAwBE,EAAwBC,EAAwB1oE,EAAMxE,EAASwE,GAkP3F,OALAioE,GAAaK,kBAAoB,SAASrhF,GAEzC,MAAOA,GAAIjN,UAAUpW,WAAW0D,QAAQ,cAGlC2gG,IAyBRhqG,EAAO,yBACN,iBACA,uBACA,uBACA,mBACA,cACA,qBACA,uBACA,0BACA,oBACA,wBACE,SAAS6hG,EAAQtlE,EAAGgB,EAAU2rC,EAAK/+D,EAAKqb,EAAOhiB,EAASqqE,EAAY88B,EAAMX,GAK5E,QAASY,GAAoBpmG,GAC5Bse,EAAK+nF,EAAc5c,QAAS,SAAS3mF,GACrB,WAAX9C,EAAEmH,KACLrE,EAAOqI,KAAK,eAAgBnL,GAE5B8C,EAAOqI,KAAK,eAAgBnL,KAK/B,QAASsmG,GAAmB7c,EAASzjE,GAChCA,IAAUugF,IACTvgF,EACH+R,EAAEp3B,QAAQwlB,GAAG,gBAAiBigF,GAE9BruE,EAAEp3B,QAAQylB,IAAI,gBAAiBggF,GAGhCG,EAAoBvgF,GAItB,QAASwgF,GAAqB1jG,GAC7B,GAAqC2jG,GAAjChd,EAAU4c,EAAc5c,cAErBA,GAAQ3mF,EAAOrH,GAEtB,KAAK,GAAIP,GAAI,EAAGA,EAAIuuF,EAAQtuF,OAAQD,IACnC,GAAIuuF,EAAQvuF,IAAM4H,EAAQ,CACzB2mF,EAAQ72E,OAAO1X,EAAG,GAClBurG,GAAkB,CAClB,OAcF,MATIJ,GAAc7c,cAAgB1mF,IACjCujG,EAAc7c,aAAeC,EAAQ,IAIlC4c,EAAc7B,eAAiB1hG,IAClCujG,EAAc7B,cAAgB,MAGxBiC,EAGR,QAASC,GAAqB5jG,GAU7B,MARIA,IAAUA,EAAO2lC,eAAiB3lC,EAAOqvD,gBAAkBrvD,EAAO+kC,WAAW/8B,aAChF07F,EAAqB1jG,GACrBA,EAAO+mF,wBACP/mF,EAAO2I,SAAQ,GACf3I,EAAOC,SAAU,EACjBD,EAAS,MAGHA,EA9DR,GAEyB6jG,GAAsBN,EAF3C9oE,EAAMxE,EAASwE,IACf9c,EAAUO,EAAMP,QAASnC,EAAO0C,EAAM1C,KAAMgC,EAASU,EAAMV,OAC3DsmF,EAAkB,EAAwCL,GAAoB,CAusBlF,OAxoBAF,IAOCtuE,EAAGA,EAQH8uE,aAAc,IAQdC,aAAc,MAQdC,YAAa,aAWbtd,WAQAuX,KAAMmF,EAWN3c,aAAc,KAEdwd,MAAO,WACN,GAAiB1kE,GAASk7D,EAA8ByJ,EAAStuE,EAA7DzvB,EAAOjK,KAAgCmqB,EAAS,EAiBpD,IAdAo0E,EAAkB94B,EAAImC,mBAAmBlkE,SAASoZ,UAI9C,yBAAyBrX,KAAK84F,KACjCA,EAAkBA,EAAgB7vF,QAAQ,WAAY,IAAIA,QAAQ,gBAAiB,IAE9E,UAAUjJ,KAAK84F,KACnBA,GAAmB,MAKrByJ,EAAUtmG,OAAOwyE,SAAWxyE,OAAOumG,eAElC5kE,EAAU2kE,EAAQr2F,MAAQq2F,EAAQ3kE,QAClClZ,EAAS69E,EAAQ79E,WACX,CAGN,IAAK,GADD4X,GAAUr+B,SAAS6I,qBAAqB,UACnCtQ,EAAI,EAAGA,EAAI8lC,EAAQ7lC,OAAQD,IAAK,CACxCy9B,EAAMqI,EAAQ9lC,GAAGy9B,GAMjB,IAAIwuE,GAAYxuE,EAAIvI,UAAUuI,EAAI4J,YAAY,KAC9C,IAAI,8CAA8C79B,KAAKi0B,GAAM,CACxDwuE,EAAUtiG,QAAQ,cACrBukB,EAAS,QAGVkZ,EAAU3J,EAAIvI,UAAU,EAAGuI,EAAI4J,YAAY,KAC3C,SAMGD,GAAW3/B,SAASykG,gBACxBzuE,EAAMh2B,SAASykG,cAAczuE,IAEzBA,EAAI9zB,QAAQ,cACfukB,EAAS,QAGVkZ,EAAU3J,EAAIvI,UAAU,EAAGuI,EAAI4J,YAAY,OAU7Cr5B,EAAKo5B,QAAU,GAAIoiC,GAAI84B,GAAiBt3B,WAAW5jC,GAQnDp5B,EAAKs0F,gBAAkBA,EAQvBt0F,EAAKu0F,QAAU,GAAI/4B,GAAIx7D,EAAKo5B,SAQ5Bp5B,EAAKkgB,OAASA,EAEdlgB,EAAKm+F,aAAe,GAAI7B,GAAat8F,IAStCme,iBAAkB,SAASk2E,GAC1B,GAAI37D,GAASxY,CAEbwY,GAAU27D,EAAgB34B,SACtBhjC,IACH3iC,KAAKqjC,QAAU,GAAIoiC,GAAIzlE,KAAKu+F,iBAAiBt3B,WAAWtkC,EAAQj0B,QAAQ,OAAQ,KAChF1O,KAAKw+F,QAAU,GAAI/4B,GAAIzlE,KAAKqjC,UAG7BlZ,EAASm0E,EAAgBn0E,OACrBm0E,EAAgBn0E,SACnBnqB,KAAKmqB,OAASA,GAGfnqB,KAAKs+F,gBAAkBA,GAsBxBh7E,KAAM,SAASuF,GASd,QAASw/E,GAAsBx/E,EAAUtD,GACxC,MAAOsD,GAASolB,QAAU1oB,EAAIiiB,QAAQj5B,eAAiB+5F,GAGxD,QAASC,GAAOluF,EAAKkL,GAEhB7jB,OAAOu/B,UAAYv/B,OAAO+D,MAC7B/D,OAAOu/B,QAAQC,IAAI7mB,EAAKkL,GAI1B,QAASijF,GAASjjF,GACjB,GAAI/oB,GAAK+oB,EAAI/oB,EAgBb,OAbKA,KACJA,EAAK+oB,EAAI3e,KAGRpK,EADGA,IAAO8hC,EAAItZ,IAAIxoB,GACb+oB,EAAI3e,KAGJ03B,EAAIM,WAGVrZ,EAAI3W,aAAa,KAAMpS,IAGjBA,EAGR,QAAS0jG,GAAat5F,GACrB,GAAI9K,GAAW+sB,EAASjiB,EAExB,IAAK9K,EAIL,MAAOA,GAASQ,MAAM2N,EAAMlI,MAAME,UAAUI,MAAMlB,KAAKxE,UAAW,IAGnE,QAASomB,GAASwC,EAAKjN,GACtB,MAAOA,GAAU7V,cAAgB6T,OAASgC,EAAU7S,KAAK8f,EAAIjN,WAAagmB,EAAIvb,SAASwC,EAAKjN,GAG7F,QAASmwF,GAAY5/E,GACpB,GAAIve,GAAGo+F,IAEP,IAAI7/E,EAASirD,MAKZ,MAJAz0D,GAAKwJ,EAASirD,MAAO,SAAS5rE,GAC7BwgG,EAAUA,EAAQz8F,OAAOqyB,EAAIlvB,OAAOlH,EAAKgF,aAGnCw7F,CACD,IAAI7/E,EAAS3b,SACnB,MAAOoxB,GAAIlvB,OAAOyZ,EAAS3b,SACrB,IAAI2b,EAASjsB,OACnB,OAAQisB,EAASjsB,OAIlB,QAAQisB,EAAS8iB,MAChB,IAAK,QACJrhC,EAAIue,EAAS5O,UAAY,GAErB3P,EAAEpO,OAAS,GACdmjB,EAAKmC,EAAQlX,GAAI,SAAS9N,GACzB,GAAI+oB,IAECA,EAAM+Y,EAAItZ,IAAIxoB,IAClBksG,EAAQrsG,KAAKkpB,GAEblG,EAAK3b,SAASilG,MAAO,SAAS/oF,GAC7BP,EAAKO,EAAE3F,SAAU,SAASlZ,GACrBA,EAAE6F,OAASpK,IACdA,EAAK,cAAgBmrG,IACrBrpE,EAAInD,UAAUp6B,EAAG,KAAMvE,GACvBksG,EAAQrsG,KAAK0E,SAOnB,MAED,KAAK,YACL,IAAK,qBACJse,EAAKif,EAAIlvB,OAAO,YAAa,SAASmW,GACjCsD,EAAS+/E,mBAAqB7lF,EAASwC,EAAKsD,EAAS+/E,oBAIpD//E,EAASggF,kBAAmB9lF,EAASwC,EAAKsD,EAASggF,kBACvDH,EAAQrsG,KAAKkpB,KAMjB,MAAOmjF,GAOR,QAASI,KAGR,QAASC,GAAavsG,EAAIqsB,EAAUu2B,GACnC,GAAIv7C,GAAS,GAAIu6F,GAAO5hG,EAAIqsB,EAAU5e,EAEtCugF,GAAQnuF,KAAKwH,GAEbA,EAAOqjB,GAAG,OAAQ,aACX8hF,IAAcN,EAAQxsG,QAC3B+sG,EAAeze,KAIjB3mF,EAAOu7C,UAAYv7C,EAAOu7C,WAAaA,EACvCv7C,EAAOovE,SAdR,GAAiCy1B,GAA7BM,EAAY,EAAGxe,IAuBnB,OANAlsD,GAAIxyB,OAAOpK,OAAQ,QAASonG,GAC5B5I,EAAa,cAEbwI,EAAU5vE,EAAEhU,OAAO2jF,EAAY5/E,IAG3BA,EAASirD,UACZz0D,GAAKwJ,EAASirD,MAAO,SAAS5rE,GAC7B6Z,EAAM1C,KAAKqpF,EAAS,SAASnjF,GAC5B,OAAI+Y,EAAI9d,GAAG+E,EAAKrd,EAAKgF,YACpB67F,EAAaP,EAASjjF,GAAMlE,KAAWwH,EAAU3gB,GAAOqd,IACjD,QAUXxD,EAAM1C,KAAKqpF,EAAS,SAASnjF,GAC5BkiF,EAAqBx9F,EAAK+a,IAAIO,EAAI/oB,OAGnCksG,EAAU3mF,EAAMF,KAAK6mF,EAAS,SAASnjF,GACtC,OAAQtb,EAAK+a,IAAIO,EAAI/oB,UAGtB6iB,GAAKqpF,EAAS,SAASnjF,GAClB8iF,EAAsBx/E,EAAUtD,GACnCgjF,EAAO,sEAAuEhjF,GAE9EwjF,EAAaP,EAASjjF,GAAMsD,EAAUtD,MAtKzC,GAAiB7J,GAAQ4sF,EAArBr+F,EAAOjK,IAEXsoG,GAAuBvmF,EAAMtB,QAC5B,iMAEA,IA0GD,IAAIwoF,GAAiB,SAASze,GAC7B9uE,EAAS8uE,EA8DV,OAHAvgF,GAAK4e,SAAWA,EAChByV,EAAI1+B,KAAK8B,OAAQ,QAASonG,GAEnB,GAAI/oG,GAAQ,SAAS3D,GACvBsf,EACHtf,EAAQsf,GAERutF,EAAiB,SAASze,GACzBpuF,EAAQouF,OAuBZxlE,IAAK,SAASxoB,GACb,MAAKG,WAAUT,OAIRM,IAAMwD,MAAKwqF,QAAUxqF,KAAKwqF,QAAQhuF,GAAM,KAHvCwD,KAAKwqF,SAad5lE,IAAK,SAAS/gB,GACb,GAAIoG,GAAOjK,KAAMwqF,EAAUvgF,EAAKugF,OA4BhC,OAzBAA,GAAQ3mF,EAAOrH,IAAMqH,EACrB2mF,EAAQnuF,KAAKwH,GAEbwjG,EAAmB7c,GAAS,GAI5BvgF,EAAKsgF,aAAe1mF,EAQpBoG,EAAKiC,KAAK,aAAcrI,OAAQA,IAE3B6jG,IACJA,EAAuB,WACtBz9F,EAAKiC,KAAK,iBAGXoyB,EAAI1+B,KAAK8B,OAAQ,eAAgBgmG,IAG3B7jG,GAWRklG,aAAc,SAASvsG,EAAIqsB,GAC1B,MAAO7oB,MAAK4kB,IAAI,GAAIw5E,GAAO5hG,EAAIqsB,EAAU7oB,QAuB1C6lB,OAAQ,SAAS3Y,GAChB,GAAiBjR,GAA2B4H,EAAxCoG,EAAOjK,KAASwqF,EAAUvgF,EAAKugF,OAGnC,EAAA,GAAKt9E,EASL,MAAuB,gBAAZA,IACVA,EAAWA,EAASA,UAAYA,MAEhCmS,GAAKif,EAAIlvB,OAAOlC,GAAW,SAASqY,GACnC1hB,EAAS2mF,EAAQjlE,EAAI/oB,IAEjBqH,GACHoG,EAAK4b,OAAOhiB,OAQfA,EAASqJ,EAGJs9E,EAAQ3mF,EAAOrH,KAUhB+qG,EAAqB1jG,IACxBoG,EAAKiC,KAAK,gBAAiBrI,OAAQA,IAG/B2mF,EAAQtuF,QACZoiC,EAAIxyB,OAAOpK,OAAQ,eAAgBgmG,GAGpC7jG,EAAOgiB,SAEPwhF,EAAmB7c,EAASA,EAAQtuF,OAAS,GAEtC2H,GArBC,KA3BP,KAAK5H,EAAIuuF,EAAQtuF,OAAS,EAAGD,GAAK,EAAGA,IACpCgO,EAAK4b,OAAO2kE,EAAQvuF,MA2DvBglD,YAAa,SAASuW,EAAKkJ,EAAIn/D,GAC9B,GAAI0I,GAAOjK,KAAM6D,EAASoG,EAAK+a,IAAIzjB,EAGnC,QAAQi2D,GACP,IAAK,eAKJ,MAJKvtD,GAAK+a,IAAIzjB,IACb,GAAI68F,GAAO78F,EAAO0I,EAAK4e,SAAU5e,GAAMgpE,UAGjC,CAER,KAAK,kBAKJ,MAJIpvE,IACHA,EAAOgiB,UAGD,CAER,KAAK,kBACJ,MAAKhiB,IAKDA,EAAO86B,WACV96B,EAAOwjB,OAEPxjB,EAAOyjB,QAGD,IAVNrd,EAAKg3C,YAAY,eAAgB,EAAG1/C,IAC7B,GAaV,QAAI0I,EAAKsgF,cACDtgF,EAAKsgF,aAAatpC,YAAYuW,EAAKkJ,EAAIn/D,IAchDy/F,YAAa,WACZ3hF,EAAKrf,KAAKwqF,QAAS,SAAS3mF,GAC3BA,EAAOs9F,UAWT+H,QAAS,SAAS55C,EAAM5uC,GACvBwmF,EAAKtiF,IAAI0qC,EAAM5uC,IAUhBwhD,UAAW,SAASzlD,GACnB,MAAOyqF,GAAKhlC,UAAUzlD,IASvB4jE,UAAW,SAASx8E,GACnB,GAAI0mF,GAAevqF,KAAKuqF,YAEpBvqF,MAAKuqF,cAAgB1mF,IACpB0mF,GACHA,EAAar+E,KAAK,cAAeP,cAAe9H,IAGjDA,EAAOqI,KAAK,YAAaP,cAAe4+E,KAGzCvqF,KAAKuqF,aAAe1mF,IAItBwd,EAAO+lF,EAAeh9B,GAEtBg9B,EAAcW,QAGdrmG,OAAOwyE,QAAUxyE,OAAOynG,QAAU/B,EAE3BA,IAqBR7qG,EAAO,uBACN,wBACA,sBACE,SAAS6qG,EAAerlF,GAC1B,GAAI1C,GAAO0C,EAAM1C,KAAMmC,EAAUO,EAAMP,OAEvC4lF,GAAclgF,GAAG,YAAa,SAASnmB,GACtC,GAAI8C,GAAS9C,EAAE8C,MAEfA,GAAOqjB,GAAG,UAAW,WAGpB,QAASkiF,GAAgBlxF,EAAMqS,GAC9BlL,EAAKkL,EAAQ,SAAShpB,EAAOqF,GACxBrF,GACHqrB,EAAIwQ,SAASllB,EAAMtR,EAAMrF,KAI3BqrB,EAAIwS,OAAOlnB,EAAM,QAGlB,QAASmxF,GAAQtoG,GAChB6rB,EAAM/oB,EAAO+oB,IAET/D,EAAS22E,wBACZngF,EAAKuN,EAAIxd,OAAO,gBAAiBrO,EAAEmX,MAAO,SAASA,GAClDuG,EAAQvG,EAAK5J,SAASC,eAAeqe,EAAK1U,KAjB7C,GAAIuG,GAASskD,EAAWn2C,EAAK/D,EAAWhlB,EAAOglB,QAsB3CA,GAASu8C,gBACZrC,EAAYvhD,EAAQqH,EAASu2E,yBAE7B3gF,GACC6qF,KAAM,SAAS18E,EAAK1U,GACnBkxF,EAAgBlxF,GACf22C,gBAAiB32C,EAAKsN,MAAMqpC,gBAC5B9kC,MAAO7R,EAAK6R,MACZglC,WAAY72C,EAAKqxF,KACjBt6C,SAAU8T,EAAU55C,SAASjR,EAAKuQ,KAAM,IAAM,MAIhDk6E,EAAG,SAAS/1E,EAAK1U,GAEe,UAA3BrU,EAAOglB,SAASC,QACnBsgF,EAAgBlxF,GACfo2C,eAAgB,eAKnBk7C,OAAQ,SAAS58E,EAAK1U,GACrBkxF,EAAgBlxF,GACfo2C,eAAgB,mBAKnBzqD,EAAOqjB,GAAG,wBAAyBmiF,UAqCvC9sG,EAAO,oBACN,0BACA,sBACE,SAAS6tE,EAAYroD,GACvB,GAAI0nF,IAQHnb,KAAM,SAASzlE,GAGd,QAAS6gF,MACH7gF,EAAS6P,OAA2B,GAAlB80D,EAAI1jF,YAAmBY,IAAU,KACnDme,EAASwkE,SAAW3iF,EAAQ,KAAuB,KAAd8iF,EAAIp2D,OAC5CvO,EAASwkE,QAAQlsF,KAAK0nB,EAAS8gF,cAAe,GAAKnc,EAAIW,aAAcX,EAAK3kE,GAChEA,EAASzO,OACnByO,EAASzO,MAAMjZ,KAAK0nB,EAAS+gF,YAAal/F,EAAQ,IAAQ,YAAc,UAAW8iF,EAAK3kE,GAGzF2kE,EAAM,MAEN3rF,WAAW6nG,EAAO,IAZpB,GAAIlc,GAAK9iF,EAAQ,CA2BjB,IAVAme,EAASpe,MAAQoe,EAASpe,OAASzK,KACnC6oB,EAAS8gF,cAAgB9gF,EAAS8gF,eAAiB9gF,EAASpe,MAC5Doe,EAAS+gF,YAAc/gF,EAAS+gF,aAAe/gF,EAASpe,MACxDoe,EAAS6P,MAAQ7P,EAAS6P,SAAU,EACpC7P,EAASnhB,KAAOmhB,EAASnhB,MAAQ,GAEjC+hG,EAAIv9F,KAAK,oBAAqB2c,SAAUA,IAExC2kE,EAAM,GAAIE,gBAED,CA2BR,GA1BIF,EAAIqc,kBACPrc,EAAIqc,iBAAiBhhF,EAASihF,cAG/Btc,EAAIprB,KAAKv5C,EAAS3gB,OAAS2gB,EAASnhB,KAAO,OAAS,OAAQmhB,EAASlH,IAAKkH,EAAS6P,OAE/E7P,EAASkhF,cACZvc,EAAIG,iBAAkB,GAGnB9kE,EAASihF,cACZtc,EAAIwc,iBAAiB,eAAgBnhF,EAASihF,cAG3CjhF,EAASohF,gBACZloF,EAAM1C,KAAKwJ,EAASohF,eAAgB,SAAStsF,GAC5C6vE,EAAIwc,iBAAiBrsF,EAAOnO,IAAKmO,EAAOpc,SAI1CisF,EAAIwc,iBAAiB,mBAAoB,kBAEzCxc,EAAMic,EAAIv9F,KAAK,cAAeshF,IAAKA,EAAK3kE,SAAUA,IAAW2kE,IAC7DA,EAAIc,KAAKzlE,EAASnhB,OAGbmhB,EAAS6P,MACb,MAAOgxE,IAIR7nG,YAAW6nG,EAAO,MAOrB,OAFA3nF,GAAMV,OAAOooF,EAAKr/B,GAEXq/B,IA2BRltG,EAAO,uBAAyB,WAC/B,QAASsvB,GAAUvM,EAAG4qF,GACrB,GAAIjuG,GAAG4jB,EAAGsqF,EAAGvjG,CAIb,IAFAsjG,EAAQA,GAAS,IAEP,OAAN5qF,EACH,MAAO,MAKR,IAFA6qF,QAAW7qF,GAEF,UAAL6qF,EAIH,MAHAtqF,GAAI,4BAGGqqF,EAAQ5qF,EAAE5Q,QAAQ,oCAAqC,SAAS8B,EAAGC,GAEzE,MAAc,MAAVy5F,GAAuB,MAAN15F,EACbA,GAGRvU,EAAI4jB,EAAEja,QAAQ6K,GAEVxU,EAAI,EACA,KAAO4jB,EAAE8E,OAAO1oB,EAAI,IAG5BuU,EAAIC,EAAE6lB,aAAap0B,SAAS,IAErB,MAAQ,OAAOivB,UAAU3gB,EAAEtU,QAAUsU,MACxC05F,CAGN,IAAS,UAALC,EAAe,CAClB,GAAI7qF,EAAEvJ,gBAAwD,mBAAtC/T,OAAOC,UAAUC,SAASf,KAAKme,GAAyB,CAC/E,IAAKrjB,EAAI,EAAG4jB,EAAI,IAAK5jB,EAAIqjB,EAAEpjB,OAAQD,IAClC4jB,IAAM5jB,EAAI,EAAI,IAAM,IAAM4vB,EAAUvM,EAAErjB,GAAIiuG,EAG3C,OAAOrqF,GAAI,IAGZA,EAAI,GAEJ,KAAKjZ,IAAQ0Y,GACRA,EAAEvJ,eAAenP,KACpBiZ,GAAuB,kBAAXP,GAAE1Y,IAAuBiZ,EAAE3jB,OAAS,EAAI,IAAMguG,EAAQA,GAAStjG,EAC1EsjG,EAAQ,IAAMr+E,EAAUvM,EAAE1Y,GAAOsjG,GAAS,GAI7C,OAAOrqF,GAAI,IAGZ,MAAO,GAAKP,EAGb,OASCuM,UAAWA,EASX7B,MAAO,SAASvN,GACf,IAEC,MAAO/a,QAAOoW,OAAOC,aAAa,KAAO,OAAO,IAAM0E,EAAO,KAC5D,MAAOhb,SAgDZlF,EAAO,4BACN,oBACA,mBACA,sBACE,SAAS2xF,EAAMub,EAAK1nF,GAGtB,QAASqoF,GAAYvhF,GACpB7oB,KAAK6oB,SAAWxH,KAAWwH,GAC3B7oB,KAAK0K,MAAQ,EAJd,GAAI2W,GAASU,EAAMV,MAkEnB,OAnDA+oF,GAAYC,QAAU,SAAS/qF,GAC9B,OAAO,GAAI8qF,IAAc9b,KAAKhvE,IAG/B8qF,EAAYnoG,WAOXqsF,KAAM,SAASlsF,GACd,GAAIkoG,GAAMloG,EAAKgY,MAAOmwF,EAAMnoG,EAAKirF,OAEjCjrF,GAAOif,EAAOrhB,KAAK6oB,SAAUzmB,GAE7BA,EAAKirF,QAAU,SAASpsE,EAAG1jB,GAC1B0jB,EAAIitE,EAAKlkE,MAAM/I,GAEC,mBAALA,KACVA,GACC7G,MAAO,sBAIL6G,EAAE7G,MACLkwF,EAAInpG,KAAKiB,EAAKwnG,aAAexnG,EAAKqI,MAAOwW,EAAE7G,MAAO7c,GAElDgtG,EAAIppG,KAAKiB,EAAKunG,eAAiBvnG,EAAKqI,MAAOwW,EAAEvF,SAI/CtZ,EAAKgY,MAAQ,SAASowF,EAAIjtG,GACrB+sG,GACHA,EAAInpG,KAAKiB,EAAKwnG,aAAexnG,EAAKqI,MAAO+/F,EAAIjtG,IAI/C6E,EAAKsF,KAAOwmF,EAAKriE,WAChBrvB,GAAI4F,EAAK5F,IAAM,IAAOwD,KAAK0K,QAC3B+/F,OAAQroG,EAAKqoG,OACbtqB,OAAQ/9E,EAAK+9E,SAId/9E,EAAK0nG,aAAe,mBAEpBL,EAAInb,KAAKlsF,KAIJgoG,IAeR7tG,EAAO,sBACN,wBACE,SAASu9B,GACX,OACC3C,aACAzsB,MAAO,EAEP4jF,KAAM,SAASzlE,GACd,GAAI5e,GAAOjK,KAAM4sB,EAAMkN,EAASwE,IAAK5zB,EAAQme,EAASne,QAAU/O,EAAYktB,EAASne,MAAQT,EAAKS,MAC9FlO,EAAK,iBAAmBkO,CAE5BT,GAAKktB,UAAUzsB,GAAS,SAASujF,GAChCrhE,EAAI/G,OAAOrpB,SACJyN,GAAKktB,UAAUzsB,GAEtBme,EAAS/sB,SAASmyF,IAGnBrhE,EAAIhI,IAAIgI,EAAIrkB,IAAI5E,KAAM,UACrBnH,GAAIA,EACJk9B,IAAK7Q,EAASlH,IACdzZ,KAAM,oBAGP+B,EAAKS,YAoCRnO,EAAO,+BAAiC,WAuBvC,QAASmuG,KACRj7F,IAEA,KAAK,GAAID,KAAOkR,GACfjR,EAAKpT,KAAKmT,EAGXm7F,GAAazuG,OAASuT,EAAKvT,OAM5B,QAAS66B,KAUR,QAASlP,GAAKspB,GACb,GAAI5vC,GAAOqpG,CAGX,OADAA,GAAUz5D,IAAQx1C,EAAYuC,EAAMizC,EAAMzpC,EAAK9B,QAAQ,IAAK1H,GACxD0sG,QAAkBA,EAAUljG,EAAKxL,OAC7B,MAGRqF,EAAQmG,EAAKypB,UAAUjzB,EAAK0sG,GAC5B1sG,EAAM0sG,EAAU,EAETrpG,GApBR,GAAIiO,GAAK9H,EAAMnG,EAAOrD,EAAM,CAK5B,IAHAwiB,KAGKmqF,EAAL,CAkBAC,EAAW/zE,KAAKg0E,GAChBrjG,EAAOojG,EAAWr8F,aAAas8F,IAAgB,EAE/C,GAAG,CACF,GAAIvjF,GAASK,GACb,IAAe,OAAXL,EACH,KAID,IADAhY,EAAMqY,EAAKsB,SAAS3B,EAAQ,KAAO,GACvB,OAARhY,EAAc,CAEjB,GADAgY,EAASK,IACM,OAAXL,EACH,KAGDjmB,GAAQsmB,EAAKsB,SAAS3B,EAAQ,KAAO,GAEjChY,IACHkR,EAAMlR,GAAOjO,UAGC,OAARiO,EAETk7F,MAMD,QAASvJ,KACR,GAAI5/F,GAAOmG,EAAO,EAGlB,IAAKmjG,EAAL,CAIA,IAAK,GAAIr7F,KAAOkR,GACfnf,EAAQmf,EAAMlR,GACd9H,IAASA,EAAO,IAAM,IAAM8H,EAAItT,OAAOgG,SAAS,IAAM,IAAMsN,EAAM,IAAMjO,EAAMrF,OAAOgG,SAAS,IAAM,IAAMX,CAG3GupG,GAAWl8F,aAAam8F,EAAarjG,EAErC,KACCojG,EAAW3J,KAAK4J,GACf,MAAOtpG,IAITipG,KA9GD,GAAIC,GAAcG,EAAYpqF,EAAOjR,EAAMs7F,EAAaF,CAGxD,KACC,GAAInpG,OAAOspG,aACV,MAAOA,cAEP,MAAOvpG,IA8KT,MA1KAspG,GAAc,UACdD,EAAapnG,SAAS8E,gBACtBqiG,IAAwBC,EAAWG,YAE/BJ,GACHC,EAAWG,YAAY,qBAiGxBN,GAiBCn7F,IAAK,SAASmQ,GACb,MAAOlQ,GAAKkQ,IAUburF,QAAS,SAAS17F,GACjB,MAAOA,KAAOkR,GAAQA,EAAMlR,GAAO,MAUpC27F,QAAS,SAAS37F,EAAKjO,GACtBmf,EAAMlR,GAAO,GAAKjO,EAClB4/F,KASDiK,WAAY,SAAS57F,SACbkR,GAAMlR,GACb2xF,KAQDllD,MAAO,WACNv7B,KACAygF,MAIFpqE,IAEO4zE,IAuBRpuG,EAAO,kBACN,uBACA,yBACA,2BACA,uBACA,qBACA,eACE,SAASu9B,EAAU5vB,EAAY42B,EAAcoB,EAAcngB,EAAOrb,GACpE,GAAIwtE,GAAUxyE,OAAOwyE,OAwBrB,OAhBAA,GAAQ51C,IAAMxE,EAASwE,IACvB41C,EAAQpzC,aAAeA,EAAaA,aACpCozC,EAAQ3wC,cAAgBrB,EAAaqB,cACrC2wC,EAAQ1wC,aAAetB,EAAasB,aAEpC0wC,EAAQtnD,IAAMsnD,EAAQtnD,QACtBsnD,EAAQtnD,IAAI5f,MAAQ9C,EAAW8C,MAE/B+U,EAAM1C,KAAK0C,EAAO,SAAS7d,EAAMsL,GAChC0kE,EAAQ1kE,GAAOtL,IAGhB6d,EAAM1C,KAAK,sCAAsCviB,MAAM,KAAM,SAAS8J,GACrEstE,EAAQttE,GAAQF,EAAIE,EAAK8kB,OAAO,GAAGnd,sBA6DrChS,EAAO,qBACN,qBACA,sBACE,SAASwrE,EAAOhmD,GAGlB,MAAOgmD,GAAM1mD,QACZwnD,UACCwiC,kBAAmB,QACnBC,iBAAkB,QASnBhoF,KAAM,SAASuF,GACd7oB,KAAK6oB,SAAW9G,EAAMV,UAAWrhB,KAAK6oE,SAAUhgD,IASjDmqD,UAAW,SAASzoE,GACnBA,EAAUyrE,YAAYpxD,IAAI5kB,KAAK6oB,SAAS0iF,iBAQzC18B,aAAc,SAASnuD,GACtB,GAA2C8qF,GAAYC,EAAW1pB,EAAW2pB,EAAzEzhG,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,QAEjC2iF,GAAa3iF,EAASwiF,kBACtBI,EAAY5iF,EAASyiF,iBAErB5qF,EAAMrB,KAAK,SAASK,GACnBA,EAAKqsC,QAAQlmC,OAAO2lF,GAAY3lF,OAAO4lF,GAAW7mF,IAAIiE,EAAS8iF,cAE3DjsF,EAAKwvD,YACH6S,IACJA,EAAYriE,GAGbgsF,EAAWhsF,KAITqiE,GACHA,EAAUh2B,QAAQnnC,IAAI4mF,GAGnBE,GACHA,EAAS3/C,QAAQnnC,IAAI6mF,IAUvB54B,WAAY,SAAStoE,GACpB,GAAIN,GAAOjK,KAAMoiB,EAAO,EAQxB,OANAnY,GAAK4kE,aAAatkE,EAAUmW,SAE5BnW,EAAUmW,QAAQrB,KAAK,SAASK,GAC/B0C,GAAQ1C,EAAKmzD,eAGPzwD,GASRqc,OAAQ,aASRq0C,WAAY,aAGZxJ,SAAU,WACT,OAAO,OAyBV/sE,EAAO,6BACN,qBACE,SAASqvG,GAGX,MAAOA,GAAOvqF,QACbwnD,UACC0iC,eAAgB,aAChBI,aAAc,mBASfltE,OAAQ,SAASl0B,GAChBA,EAAUmW,QAAQ9N,OAAO,YAAYyM,KAAK,SAAS67B,GAClD,GAAIryB,GAAWqyB,EAAKryB,QAEpBqyB,GAAK00B,YACJryE,EAAGsrB,EAAStrB,EACZC,EAAGqrB,EAASrrB,EACZC,EAAGorB,EAASprB,EACZC,EAAGmrB,EAASnrB,IAGTw9C,EAAKzc,QACRyc,EAAKzc,YAWRo0C,WAAY,SAAStoE,GACpB,MAAO,YAAcA,EAAUsiE,IAAM,mBAAqBtiE,EAAUkkE,YAAc,kBAAoBzuE,KAAKuoE,OAAOh+D,QA+BrHhO,EAAO,qBACN,qBACE,SAASwkF,GAGX,MAAOA,GAAO1/D,QACbwnD,UACC9c,QAAS,aACTijB,KAAM,UAYP1rD,KAAM,SAASuF,GACd,GAAiBJ,GAAbxe,EAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZA,EAAW5e,EAAK4e,SAEhBJ,EAAOxe,EAAK4e,SAASJ,KAErBxe,EAAKid,GAAG,kBAAmB,SAASnmB,GACnCA,EAAEgI,mBAGHkB,EAAKid,GAAG,aAAc,SAASnmB,GAC9BkJ,EAAKiC,KAAK,QAASnL,GACnBA,EAAEgI,mBAGC8f,EAAS42D,SACZx1E,EAAK8hD,QAAQnnC,IAAIiE,EAAS42D,SAGvBh3D,GACHxe,EAAK8hD,QAAQnnC,IAAI,OAAS6D,GAGvBI,EAASu4D,MACZn3E,EAAKm3E,KAAKv4D,EAASu4D,OAWrBA,KAAM,SAASA,GACd,MAAKzkF,WAAUT,QAIf8D,KAAK+mB,MAAM9B,IAAI,OAAQm8D,GAEhBphF,MALCA,KAAK+mB,MAAM/B,IAAI,SAaxBwsD,QAAS,WACR,GACCq6B,GADGC,EAAS9rG,KAAK0tE,QAAQ9yD,UAGtBkxF,KACHD,EAAWC,EAAOtmF,MAClBqmF,EAASpsG,MAAQosG,EAASnsG,OAAS,QAGpCM,KAAKuoE,UASNsK,WAAY,WACX,GACmCv0D,GAD/BrU,EAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,YAC1C2S,EAAOn3E,EAAK8c,MAAM/B,IAAI,QAAgBvI,EAAOxS,EAAK8c,MAAM/B,IAAI,QAAS+mF,EAAW,EAuBpF,OArBAztF,GAAQrU,EAAK4e,SAASvK,MAClBA,GACH8iE,EAAO,OAGa,gBAAT9iE,KACVA,EAAQ5c,OAAO2E,aAAeiY,EAAM,GAAKA,EAAM,IAGhDA,EAAQ,mCAAqCA,EAAQ,QAErDA,EAAQ,GAGL7B,IACHxS,EAAK8hD,QAAQnnC,IAAI,gBACjBmnF,EAAW,gBAAkB7hF,EAAS,QAAUjgB,EAAK0gB,OAAOlO,GAAQ,WAGrE2kE,EAAOn3E,EAAK4e,SAASu4D,KAAOl3D,EAAS,OAASA,EAAS,KAAOk3D,EAAO,GAGpE,YAAc5kF,EAAK,YAAcyN,EAAK8hD,QAAU,oCAAsCvvD,EAAK,8DAExF4kF,EAAO,aAAeA,EAAO,IAAM9iE,EAAQ,QAAU,IACtDytF,EACD,mBAKHx4B,WAAY,WAGX,QAASy4B,GAAcvvF,GACtB,GAAIwvF,GAAQnzE,EAAE,QAAUozE,EAASjiG,EAAKyjE,QAElCjxD,IACEwvF,EAAM,KACVnzE,EAAE,eAAgB7uB,EAAKyjE,SAAS5nD,OAAO,gBAAkBomF,EAAU,aACnED,EAAQnzE,EAAE,QAAUozE,EAASjiG,EAAKyjE,UAGnCu+B,EAAM7pF,KAAKnY,EAAK0gB,OAAOlO,KAEvBwvF,EAAMpmF,SAGP5b,EAAK8hD,QAAQoH,OAAO,iBAAkB12C,GAhBvC,GAAIxS,GAAOjK,KAAM84B,EAAI7uB,EAAK6uB,EAAGozE,EAAUjiG,EAAKwkE,YAAc,KA6C1D,OA1BAxkE,GAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrCirG,EAAcjrG,EAAEQ,SAGjB0I,EAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrC,GAAIqgF,GAAOrgF,EAAEQ,MAAO2oB,EAASjgB,EAAKwkE,WAElCxkE,GAAK4e,SAASu4D,KAAOA,EACrBA,EAAOA,EAAOl3D,EAAS,OAASA,EAAS,KAAOjgB,EAAK4e,SAASu4D,KAAO,EAErE,IAAI0qB,GAAS7hG,EAAKyjE,QAAQ9yD,WAAYuxF,EAAUL,EAAOv/F,qBAAqB,KAAK,EAE7E60E,IACE+qB,GAAWA,GAAWL,EAAOlxF,aACjCuxF,EAAUzoG,SAASsM,cAAc,KACjC87F,EAAOzoF,aAAa8oF,EAASL,EAAOlxF,aAGrCuxF,EAAQ7zF,UAAY8oE,GACV+qB,GACVL,EAAO77F,YAAYk8F,GAGpBH,EAAc/hG,EAAK8c,MAAM/B,IAAI,WAGvB/a,EAAKs+D,cAmCfhsE,EAAO,0BACN,wBACE,SAASm9E,GAGX,MAAOA,GAAUr4D,QAChBwnD,UACC8N,YAAa,SACb3H,KAAM,SASP6D,WAAY,WACX,GAAI5oE,GAAOjK,KAAMk2E,EAASjsE,EAAK2iE,OAM/B,OAJA3iE,GAAK8hD,QAAQnnC,IAAI,aACjB3a,EAAK+oE,YACLkD,EAAOlD,UAAU/oE,GAGhB,YAAcA,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,cACvC9hD,EAAK4iE,IAAM,WACvB5iE,EAAK4e,SAASzG,MAAQ,IAAM8zD,EAAOrD,WAAW5oE,GAChD,oBAkCL1N,EAAO,uBACN,qBACE,SAASwkF,GAGX,MAAOA,GAAO1/D,QACbwnD,UACC9c,QAAS,WACTijB,KAAM,WACNzxD,SAAS,GAUV+F,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GAEZ5e,EAAKid,GAAG,kBAAmB,SAASnmB,GACnCA,EAAEgI,mBAGHkB,EAAKid,GAAG,QAAS,SAASnmB,GACzBA,EAAEgI,iBAEGkB,EAAKqT,YACTrT,EAAKsT,SAAStT,EAAKsT,aAIrBtT,EAAKsT,QAAQtT,EAAK4e,SAAStL,UAU5BA,QAAS,SAASwJ,GACjB,MAAKpqB,WAAUT,QAIf8D,KAAK+mB,MAAM9B,IAAI,UAAW8B,GAEnB/mB,MALCA,KAAK+mB,MAAM/B,IAAI,YAexBzjB,MAAO,SAASwlB,GACf,MAAKpqB,WAAUT,OAIR8D,KAAKud,QAAQwJ,GAHZ/mB,KAAKud,WAYds1D,WAAY,WACX,GAAI5oE,GAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,WAE9C,OACC,YAAcjyE,EAAK,YAAcyN,EAAK8hD,QAAU,wCAA0CvvD,EAAK,gCAC/E0tB,EAAS,OAASA,EAAS,6BAC3B1tB,EAAK,eAAiB0tB,EAAS,UAAYjgB,EAAK0gB,OAAO1gB,EAAK8c,MAAM/B,IAAI,SAAW,iBAKnGuuD,WAAY,WAGX,QAASh2D,GAAQwJ,GAChB9c,EAAK8hD,QAAQoH,OAAO,UAAWpsC,GAC/B9c,EAAKuoE,KAAK,UAAWzrD,GAJtB,GAAI9c,GAAOjK,IA4CX,OArCAiK,GAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrCkJ,EAAKyjE,MAAM,MAAM9yD,WAAWlT,KAAOuC,EAAKi4D,UAAUnhE,EAAEQ,SAGrD0I,EAAK8c,MAAMG,GAAG,8BAA+B,SAASnmB,GACrDkJ,EAAKiC,KAAK,UACVqR,EAAQxc,EAAEQ,SAGX0I,EAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrC,GAAIqgF,GAAOrgF,EAAEQ,MAAO2oB,EAASjgB,EAAKwkE,WAElC,IAAmB,mBAAR2S,GACV,MAAOn3E,GAAK4e,SAASu4D,IAGtBn3E,GAAK4e,SAASu4D,KAAOA,EACrBA,EAAOA,EAAOl3D,EAAS,OAASA,EAAS,KAAOjgB,EAAK4e,SAASu4D,KAAO,EAErE,IAAI0qB,GAAS7hG,EAAKyjE,QAAQ9yD,WAAYuxF,EAAUL,EAAOv/F,qBAAqB,KAAK,EAE7E60E,IACE+qB,GAAWA,GAAWL,EAAOlxF,aACjCuxF,EAAUzoG,SAASsM,cAAc,KACjC87F,EAAOzoF,aAAa8oF,EAASL,EAAOlxF,aAGrCuxF,EAAQ7zF,UAAY8oE,GACV+qB,GACVL,EAAO77F,YAAYk8F,KAIjBliG,EAAK8c,MAAM/B,IAAI,YAClBzH,GAAQ,GAGFtT,EAAKs+D,cAyBfhsE,EAAO,uBACN,oBACA,qBACA,sBACA,wBACE,SAASwkF,EAAQnL,EAASxwB,EAAUtsB,GAGtC,MAAOioD,GAAO1/D,QAQbiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZA,EAAW5e,EAAK4e,SAEhB5e,EAAK8hD,QAAQnnC,IAAI,YACjB3a,EAAKmiG,UAAW,EAChBniG,EAAKwoE,WAAa,MAElB5pD,EAASwjF,KAAOxjF,EAASwjF,MAAQxjF,EAASlmB,OAEtCkmB,EAASwjF,OACZxjF,EAASu4D,KAAO,SAGjBn3E,EAAKid,GAAG,QAAS,SAASnmB,GACzB,GAAIwkB,GAAMxkB,EAAEnE,OAAQmgB,EAAO9S,EAAKyjE,OAEhC,IAAK50C,EAAEltB,SAASmR,EAAMwI,IAAQA,GAAOxI,EAIrC,KAAOwI,GAAOA,GAAOxI,GAChBwI,EAAI/oB,IAAM+oB,EAAI/oB,GAAGoJ,QAAQ,eAC5BqE,EAAKiC,KAAK,UAEN2c,EAASwjF,OACZpiG,EAAKqiG,WAEDvrG,EAAEyxE,MACLvoE,EAAKoiG,KAAK3rF,QAAQ,GAAG1D,UAKxBuI,EAAMA,EAAI1Z,aAKZ5B,EAAKid,GAAG,UAAW,SAASnmB,GACF,SAArBA,EAAEnE,OAAO0R,UAAoC,IAAbvN,EAAEg2D,SACrC9sD,EAAK2d,UAAUjF,UAAUtD,KAAK,SAAS67B,GACtC,GAAIqxD,GAAatiG,EAAK8c,MAAM/B,IAAI,SAAUwnF,EAAaviG,EAAKyjE,MAAM,OAAOnsE,KAUzE,IARAR,EAAEgI,iBAEFkB,EAAK8c,MAAM9B,IAAI,QAASunF,GAEpBD,GAAcC,GACjBviG,EAAKiC,KAAK,UAGPgvC,EAAKivB,kBAAkB,WAAajvB,EAAKg8B,OAE5C,MADAh8B,GAAKhvC,KAAK,UAAWxE,KAAMwzC,EAAKg8B,YACzB,MAMXjtE,EAAKid,GAAG,QAAS,SAASnmB,GACA,SAArBA,EAAEnE,OAAO0R,UACZrE,EAAK8c,MAAM9B,IAAI,QAASlkB,EAAEnE,OAAO2E,UAKpC+qG,SAAU,WACT,GAA2CD,GAAvCpiG,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,QAE5B5e,GAAKoiG,OACTA,EAAOxjF,EAASwjF,SAGZA,EAAKnwG,OACRmwG,GACCnkG,KAAM,OACNwY,MAAO2rF,GAGRA,EAAKnkG,KAAOmkG,EAAKnkG,MAAQ,OAG1B+B,EAAKoiG,KAAOz2B,EAAQ93E,OAAOuuG,GAAMh0F,OAAOpO,GAAM8oE,SAAS9oE,EAAKwlE,mBAC5DxlE,EAAKiC,KAAK,cACVjC,EAAKoiG,KAAKv/B,SACV7iE,EAAKoiG,KAAKnlF,GAAG,SAAU,SAASnmB,GAC3BA,EAAE0qE,UAAYxhE,EAAKoiG,MACtBpiG,EAAK+S,UAIP/S,EAAKoiG,KAAKnlF,GAAG,YAAa,SAASnmB,GAClCA,EAAE0qE,QAAQ/qD,QAAQrB,KAAK,SAAS67B,GAC/BA,EAAKi0B,OAAOj0B,EAAK35C,SAAW0I,EAAK1I,aAEhC2K,KAAK,QAERjC,EAAKoiG,KAAKnlF,GAAG,SAAU,SAASnmB,GAC/BkJ,EAAK1I,MAAMR,EAAE0qE,QAAQlqE,WAGtB0I,EAAKid,GAAG,UAAW,SAASnmB,GACW,SAAlCA,EAAEnE,OAAO4qC,QAAQniB,eACpBpb,EAAKoiG,KAAK/kF,SAIZrd,EAAKuoE,KAAK,YAAY,IAGvBvoE,EAAKoiG,KAAKhlF,OACVpd,EAAKoiG,KAAKz8B,YAAYnyE,EAAGwM,EAAK2lE,aAAanyE,IAC3CwM,EAAKoiG,KAAKlyB,QAAQlwE,EAAKyjE,QAASzjE,EAAK0kE,SAAW,QAAS,UAAY,QAAS,WAQ/E3xD,MAAO,WACNhd,KAAK0tE,MAAM,OAAO1wD,SAQnBw0D,QAAS,WACR,GACI/xE,GAAOgtG,EADPxiG,EAAOjK,KAAMulB,EAAMtb,EAAKyjE,QAASg/B,EAAUziG,EAAKyjE,MAAM,QAAStwE,EAAO6M,EAAK2lE,YAI9EnwE,GADGitG,EACKtvG,EAAKK,EAAI2nD,EAASppB,QAAQ0wE,GAASjtG,MAAQ,GAE3CrC,EAAKK,EAAI,EAIlB,IAAI8K,GAAM7E,QAYV,OAXI6E,GAAIpG,OAASoG,EAAIjC,cAAgBiC,EAAIjC,cAAgB,KACxDmmG,EAAcxiG,EAAK2lE,aAAalyE,EAAI,EAAK,MAG1Co7B,EAAEvT,EAAI3K,YAAYuK,KACjB1lB,MAAOA,EACPgtG,WAAYA,IAGbxiG,EAAKs+D,SAEEt+D,GASR6oE,WAAY,WACX,GAAI7oE,GAAOjK,IAOX,OALA84B,GAAE94B,KAAK0tE,MAAM,QAAQxmD,GAAG,SAAU,SAASnmB,GAC1CkJ,EAAK8c,MAAM9B,IAAI,QAASlkB,EAAEnE,OAAO2E,OACjC0I,EAAKiC,KAAK,SAAUnL,KAGdkJ,EAAKs+D,UASbsK,WAAY,WACX,GAEIuO,GAAM3kE,EAFNxS,EAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAKhkD,EAAW5e,EAAK4e,SAAUqB,EAASjgB,EAAKwkE,YACpEltE,EAAQ0I,EAAK8c,MAAM/B,IAAI,UAAY,GACvB2nF,EAAc,GAAIC,EAAa,EA0C/C,OAxCI,cAAgB/jF,KACnB+jF,GAAc,gBAAkB/jF,EAAS27E,WAAa,KAGnD37E,EAASL,YACZokF,GAAc,eAAiB/jF,EAASL,UAAY,KAGjDK,EAASJ,OACZmkF,GAAc,UAAY/jF,EAASJ,KAAO,KAGvCI,EAAS42D,UACZmtB,GAAc,UAAY/jF,EAAS42D,QAAU,KAG1Cx1E,EAAKqT,aACRsvF,GAAc,wBAGfxrB,EAAOv4D,EAASu4D,KACZA,GAAgB,SAARA,IACXA,EAAOl3D,EAAS,OAASA,EAAS,KAAOrB,EAASu4D,MAGnD3kE,EAAOxS,EAAK8c,MAAM/B,IAAI,SAElBo8D,GAAQ3kE,KACXkwF,EACC,YAAcnwG,EAAK,iBAAmB0tB,EAAS,OAASA,EAAS,iDAC/C1tB,EAAK,uDACZ,SAAR4kF,EAAkB,aAAeA,EAAO,SAAW,aAAel3D,EAAS,gBAC3EzN,GAAQ2kE,EAAO,IAAM,IAAM3kE,EAAO,IACpC,kBAIFxS,EAAK8hD,QAAQnnC,IAAI,aAIjB,YAAcpoB,EAAK,YAAcyN,EAAK8hD,QAAU,gBAC/BvvD,EAAK,gBAAkB0tB,EAAS,mBAChDjgB,EAAK0gB,OAAOppB,GAAO,GAAS,kBAAoBqrG,EAAa,iBAC7D3iG,EAAK0gB,OAAO9B,EAASgkF,aAAe,OACpCF,EACD,UAIFprG,MAAO,SAASA,GACf,MAAI5E,WAAUT,QACb8D,KAAK+mB,MAAM9B,IAAI,QAAS1jB,GACjBvB,OAIJA,KAAK+mB,MAAM/B,IAAI,aAClBhlB,KAAK+mB,MAAM9B,IAAI,QAASjlB,KAAK0tE,MAAM,OAAOnsE,OAGpCvB,KAAK+mB,MAAM/B,IAAI,WAGvBuuD,WAAY,WACX,GAAItpE,GAAOjK,IAYX,OAVAiK,GAAK8c,MAAMG,GAAG,eAAgB,SAASnmB,GAClCkJ,EAAKyjE,MAAM,OAAOnsE,OAASR,EAAEQ,QAChC0I,EAAKyjE,MAAM,OAAOnsE,MAAQR,EAAEQ,SAI9B0I,EAAK8c,MAAMG,GAAG,kBAAmB,SAASnmB,GACzCkJ,EAAKyjE,MAAM,OAAOpwD,SAAWvc,EAAEQ,QAGzB0I,EAAKs+D,UAGb1iD,OAAQ,WACPiT,EAAE94B,KAAK0tE,MAAM,QAAQvmD,MACrBnnB,KAAKuoE,cAyBRhsE,EAAO,uBACN,uBACE,SAASuwG,GAGX,MAAOA,GAASzrF,QAOfiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEX6oB,GAAS27E,YAAa,EAElB37E,EAASkkF,WACZlkF,EAASu4D,KAAO,QAGjBn3E,EAAKs+D,OAAO1/C,GAEZ5e,EAAK8hD,QAAQnnC,IAAI,YACjB3a,EAAKid,GAAG,0BAA2B,WAClCjd,EAAK+iG,aAAa/iG,EAAK1I,YAIzByrG,aAAc,SAASzrG,GACtB,GAAIgkB,GAAMvlB,KAAK0tE,QAAQnhE,qBAAqB,KAAK,EAEjD,IAAIgZ,EACH,IACCA,EAAIC,MAAMynF,WAAa1rG,EACtB,MAAOE,MAMX8xE,WAAY,WACX,GAAItpE,GAAOjK,IAQX,OANAiK,GAAK8c,MAAMG,GAAG,eAAgB,SAASnmB,GAClCkJ,EAAK8c,MAAM/B,IAAI,aAClB/a,EAAK+iG,aAAajsG,EAAEQ,SAIf0I,EAAKs+D,cAuBfhsE,EAAO,0BACN,oBACA,yBACE,SAAS2wG,EAAQpxB,GAGnB,MAAOoxB,GAAO7rF,QAMb8rF,UAAW,WACV,GAAIljG,GAAOjK,KAAM6oB,EAAW5e,EAAK4e,QAIjC,IAFA5e,EAAKklE,QAAO,GAEPllE,EAAKmxE,MA4BTnxE,EAAKmxE,MAAM/zD,WA5BK,CAChB,GAAI+lF,GAAgBvkF,EAASuyD,KAIzBgyB,GAAcllG,OACjBklG,GACCl3B,OAAQ,OACRx1D,MAAO0sF,IAITA,EAAcp+B,KAAOo+B,EAAcp+B,MAAQ,SAC3Co+B,EAAcvwB,SAAU,EACxBuwB,EAAc9xB,UAAW,EACzB8xB,EAAct4B,UAAW,EAEzB7qE,EAAKmxE,MAAQ,GAAIU,GAAWsxB,GAAelmF,GAAG,OAAQ,WACrDjd,EAAKklE,QAAO,KACVjoD,GAAG,SAAU,SAASnmB,GACxBA,EAAEmI,kBACFe,EAAK+S,QACL/S,EAAKojG,cACHh1F,OAAOpO,GAAM8oE,SAAS9oE,EAAKwlE,mBAE9BxlE,EAAKmxE,MAAMlvE,KAAK,QAChBjC,EAAKmxE,MAAMtO,SAKZ7iE,EAAKmxE,MAAMjB,QAAQlwE,EAAKyjE,QAAS7kD,EAASykF,eAAiBrjG,EAAK0kE,SAAW,QAAS,UAAY,QAAS,YAQ1G0+B,UAAW,WACV,GAAIpjG,GAAOjK,IAEPiK,GAAKmxE,OACRnxE,EAAKmxE,MAAM9zD,QASbwrD,WAAY,WACX,GAAI7oE,GAAOjK,IAeX,OAbAiK,GAAKuoE,KAAK,YAAY,GAEtBvoE,EAAKid,GAAG,QAAS,SAASnmB,GACrBA,EAAE0qE,UAAYxhE,IACbA,EAAKmxE,OAASnxE,EAAKmxE,MAAMlM,UAC5BjlE,EAAKojG,aAELpjG,EAAKkjG,YACLljG,EAAKmxE,MAAMp+D,QAAQjc,EAAEyxE,UAKjBvoE,EAAKs+D,UAGb1iD,OAAQ,WAMP,MALI7lB,MAAKo7E,QACRp7E,KAAKo7E,MAAMv1D,SACX7lB,KAAKo7E,MAAQ,MAGPp7E,KAAKuoE,cA0BfhsE,EAAO,0BACN,yBACA,wBACE,SAASgxG,EAAanoD,GAGxB,GAAI9mB,GAAM8mB,EAAS9mB,GAEnB,OAAOivE,GAAYlsF,QAOlBiC,KAAM,SAASuF,GACd7oB,KAAKuoE,OAAO1/C,GACZ7oB,KAAK+rD,QAAQnnC,IAAI,gBAUlBmF,MAAO,SAASA,GACf,MAAIA,IACH/pB,KAAKwtG,OAASzjF,EACd/pB,KAAK0tE,MAAM,WAAWloD,MAAMqpC,gBAAkB9kC,EACvC/pB,MAGDA,KAAKwtG,QASbC,WAAY,WAGX,MAFAztG,MAAKwtG,OAAS,KACdxtG,KAAK0tE,MAAM,WAAWloD,MAAMqpC,gBAAkB,KACvC7uD,MASR6yE,WAAY,WACX,GAAI5oE,GAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,YAAahyD,EAAOxS,EAAK8c,MAAM/B,IAAI,QAC7Eo8D,EAAOn3E,EAAK4e,SAASu4D,KAAOl3D,EAAS,OAASA,EAAS,KAAOjgB,EAAK4e,SAASu4D,KAAO,GACnF9iE,EAAQrU,EAAK4e,SAASvK,MAAQ,mCAAqCrU,EAAK4e,SAASvK,MAAQ,OAAS,GACrGytF,EAAW,EAOZ,OALItvF,KACHxS,EAAK8hD,QAAQnnC,IAAI,gBACjBmnF,EAAW,gBAAkB7hF,EAAS,QAAUjgB,EAAK0gB,OAAOlO,GAAQ,WAIpE,YAAcjgB,EAAK,YAAcyN,EAAK8hD,QAAU,6HAE7Cq1B,EAAO,aAAeA,EAAO,IAAM9iE,EAAQ,QAAU,IACtD,aAAe9hB,EAAK,oBAAsB0tB,EAAS,mBACnD6hF,EACD,yCACkC7hF,EAAS,gDAC1BA,EAAS,8BAW7B4oD,WAAY,WACX,GAAI7oE,GAAOjK,KAAM0tG,EAAiBzjG,EAAK4e,SAAS03D,OAehD,OAbAt2E,GAAKid,GAAG,QAAS,SAASnmB,GACrBA,EAAEyxE,MAAsB,QAAdzxE,EAAEyxE,KAAKhjE,KAIjBzO,EAAE0qE,SAAWxhE,GAASq0B,EAAIlC,UAAUr7B,EAAEnE,OAAQ,IAAMqN,EAAKwkE,YAAc,UAC1E1tE,EAAEsI,2BACFqkG,EAAevsG,KAAK8I,EAAMlJ,YAIrBkJ,GAAK4e,SAAS03D,QAEdt2E,EAAKs+D,cA2BfhsE,EAAO,wBAA0B,WAUhC,QAASoxG,GAAMpsG,GAGd,QAASqsG,GAAQ5kF,EAAGC,EAAGxY,GACtB,GAAI/S,GAAG6hB,EAAGM,EAAG4B,EAAGosF,EAAQC,CAYxB,OAVApwG,GAAI,EACJ6hB,EAAI,EACJM,EAAI,EACJmJ,GAAQ,IACRC,GAAQ,IACRxY,GAAQ,IAERo9F,EAASlvG,EAAIqqB,EAAGrqB,EAAIsqB,EAAGxY,IACvBq9F,EAASpvG,EAAIsqB,EAAGtqB,EAAIuqB,EAAGxY,IAEnBo9F,GAAUC,GACbjuF,EAAIguF,GAGHnwG,EAAG,EACH6hB,EAAG,EACHM,EAAO,IAAJA,KAKL4B,EAAKuH,GAAK6kF,EAAU5kF,EAAIxY,EAAMA,GAAKo9F,EAAU7kF,EAAIC,EAAIxY,EAAIuY,EACzDtrB,EAAKsrB,GAAK6kF,EAAU,EAAMp9F,GAAKo9F,EAAU,EAAI,EAC7CnwG,EAAI,IAAMA,EAAI+jB,GAAKqsF,EAASD,IAC5BtuF,GAAKuuF,EAASD,GAAUC,EACxBjuF,EAAIiuF,GAGHpwG,EAAGG,EAAMH,GACT6hB,EAAG1hB,EAAU,IAAJ0hB,GACTM,EAAGhiB,EAAU,IAAJgiB,KAIX,QAASkuF,GAASC,EAAKC,EAAYC,GAClC,GAAIC,GAAMC,EAAQ7wG,EAAGyI,CAQrB,IANAgoG,GAAO7kF,SAAS6kF,EAAK,KAAO,GAAK,IACjCC,EAAa9kF,SAAS8kF,EAAY,IAAM,IACxCC,EAAa/kF,SAAS+kF,EAAY,IAAM,IACxCD,EAAavvG,EAAI,EAAGC,EAAIsvG,EAAY,IACpCC,EAAaxvG,EAAI,EAAGC,EAAIuvG,EAAY,IAEjB,IAAfD,EAEH,YADAjlF,EAAIC,EAAIxY,EAAI5S,EAAM,IAAMqwG,GASzB,QALAC,EAAOH,EAAM,GACbI,EAASF,EAAaD,EACtB1wG,EAAI6wG,GAAU,EAAIzuG,KAAKgoC,IAAIwmE,EAAO,EAAI,IACtCnoG,EAAQkoG,EAAaE,EAEbzuG,KAAKu6C,MAAMi0D,IAClB,IAAK,GACJnlF,EAAIolF,EACJnlF,EAAI1rB,EACJkT,EAAI,CACJ,MAED,KAAK,GACJuY,EAAIzrB,EACJ0rB,EAAImlF,EACJ39F,EAAI,CACJ,MAED,KAAK,GACJuY,EAAI,EACJC,EAAImlF,EACJ39F,EAAIlT,CACJ,MAED,KAAK,GACJyrB,EAAI,EACJC,EAAI1rB,EACJkT,EAAI29F,CACJ,MAED,KAAK,GACJplF,EAAIzrB,EACJ0rB,EAAI,EACJxY,EAAI29F,CACJ,MAED,KAAK,GACJplF,EAAIolF,EACJnlF,EAAI,EACJxY,EAAIlT,CACJ,MAED,SACCyrB,EAAIC,EAAIxY,EAAI,EAGduY,EAAInrB,EAAM,KAAOmrB,EAAIhjB,IACrBijB,EAAIprB,EAAM,KAAOorB,EAAIjjB,IACrByK,EAAI5S,EAAM,KAAO4S,EAAIzK,IAStB,QAAS+iB,KACR,QAASG,GAAI3mB,GAGZ,MAFAA,GAAM4mB,SAAS5mB,EAAK,IAAIL,SAAS,IAE1BK,EAAIrG,OAAS,EAAIqG,EAAM,IAAMA,EAGrC,MAAO,IAAM2mB,EAAIF,GAAKE,EAAID,GAAKC,EAAIzY,GASpC,QAAS49F,KACR,OACCrlF,EAAGA,EACHC,EAAGA,EACHxY,EAAGA,GAUL,QAAS69F,KACR,MAAOV,GAAQ5kF,EAAGC,EAAGxY,GAiBtB,QAASuZ,GAAMzoB,GACd,GAAIgD,EA8BJ,OA5BoB,gBAAThD,GACN,KAAOA,IACVynB,EAAIznB,EAAMynB,EACVC,EAAI1nB,EAAM0nB,EACVxY,EAAIlP,EAAMkP,GACA,KAAOlP,IACjBwsG,EAASxsG,EAAM7D,EAAG6D,EAAMge,EAAGhe,EAAMse,IAG7Btb,EAAU,8DAA8DoB,KAAKpE,KACjFynB,EAAIG,SAAS5kB,EAAQ,GAAI,IACzB0kB,EAAIE,SAAS5kB,EAAQ,GAAI,IACzBkM,EAAI0Y,SAAS5kB,EAAQ,GAAI,MACdA,EAAU,oCAAoCoB,KAAKpE,KAC9DynB,EAAIG,SAAS5kB,EAAQ,GAAI,IACzB0kB,EAAIE,SAAS5kB,EAAQ,GAAI,IACzBkM,EAAI0Y,SAAS5kB,EAAQ,GAAI,MACdA,EAAU,2BAA2BoB,KAAKpE,MACrDynB,EAAIG,SAAS5kB,EAAQ,GAAKA,EAAQ,GAAI,IACtC0kB,EAAIE,SAAS5kB,EAAQ,GAAKA,EAAQ,GAAI,IACtCkM,EAAI0Y,SAAS5kB,EAAQ,GAAKA,EAAQ,GAAI,KAIxCykB,EAAIA,EAAI,EAAI,EAAKA,EAAI,IAAM,IAAMA,EACjCC,EAAIA,EAAI,EAAI,EAAKA,EAAI,IAAM,IAAMA,EACjCxY,EAAIA,EAAI,EAAI,EAAKA,EAAI,IAAM,IAAMA,EAE1BxG,EA7LR,GAAIA,GAAOjK,KAAMgpB,EAAI,EAAGC,EAAI,EAAGxY,EAAI,CAgM/BlP,IACHyoB,EAAMzoB,GAGP0I,EAAKokG,MAAQA,EACbpkG,EAAKqkG,MAAQA,EACbrkG,EAAK8e,MAAQA,EACb9e,EAAK+f,MAAQA,EAjNd,GAAIrrB,GAAMgB,KAAKhB,IAAKD,EAAMiB,KAAKjB,IAAKb,EAAQ8B,KAAK9B,KAoNjD,OAAO8vG,KAsBRpxG,EAAO,0BACN,oBACA,wBACA,sBACA,sBACE,SAASwkF,EAAQhJ,EAAY3yB,EAAUuoD,GAGzC,MAAO5sB,GAAO1/D,QACbwnD,UACC9c,QAAS,sBAUVzoC,KAAM,SAASuF,GACd7oB,KAAKuoE,OAAO1/C,IAGbiqD,WAAY,WAQX,QAAS/2C,GAAOxW,EAAKne,GACpB,GAAgC7J,GAAGC,EAA/BU,EAAMknD,EAASrpB,OAAOxW,EAQ1B,OANAhoB,GAAI6J,EAAMe,MAAQjK,EAAIX,EACtBC,EAAI4J,EAAMuB,MAAQzK,EAAIV,EAEtBD,EAAIoC,KAAKjB,IAAI,EAAGiB,KAAKhB,IAAIpB,EAAIgoB,EAAIoW,YAAa,IAC9Cn+B,EAAImC,KAAKjB,IAAI,EAAGiB,KAAKhB,IAAInB,EAAI+nB,EAAIsW,aAAc,KAG9Ct+B,EAAGA,EACHC,EAAGA,GAIL,QAAS+wG,GAAYC,EAAKC,GACzB,GAAIT,IAAO,IAAMQ,EAAI9wG,GAAK,GAE1B0nD,GAASjgC,IAAIupF,GACZlvG,IAAY,IAANwuG,EAAa,MAGfS,GACJrpD,EAASjgC,IAAIwpF,GACZpvG,KAAMivG,EAAIjvF,EAAI,IACd/f,IAAM,IAAMgvG,EAAI3uF,EAAK,MAIvB+uF,EAAUppF,MAAMynF,WAAa,GAAIU,IAAOpuF,EAAG,IAAKM,EAAG,IAAKniB,EAAG8wG,EAAI9wG,IAAIqrB,QACnE9e,EAAK8f,QAAQC,OAAOzK,EAAGivF,EAAIjvF,EAAGM,EAAG2uF,EAAI3uF,EAAGniB,EAAG8wG,EAAI9wG,IAGhD,QAASmxG,GAAyB9tG,GACjC,GAAI7C,EAEJA,GAAM69B,EAAO6yE,EAAW7tG,GACxBytG,EAAIjvF,EAAY,IAARrhB,EAAIX,EACZixG,EAAI3uF,EAAkB,KAAb,EAAI3hB,EAAIV,GAEjB+wG,EAAYC,GACZvkG,EAAKiC,KAAK,UAGX,QAAS4iG,GAAU/tG,GAClB,GAAI7C,EAEJA,GAAM69B,EAAOgzE,EAAYhuG,GACzBytG,EAAMzkF,EAAMukF,QACZE,EAAI9wG,EAAkB,KAAb,EAAIQ,EAAIV,GACjB+wG,EAAYC,GAAK,GACjBvkG,EAAKiC,KAAK,UA1DX,GAAuCsiG,GAAKO,EAAYL,EAAaE,EAAWD,EAA5E1kG,EAAOjK,KAAM+pB,EAAQ9f,EAAK8f,OAE9BglF,GAAa9kG,EAAKyjE,MAAM,KACxBghC,EAAczkG,EAAKyjE,MAAM,MACzBkhC,EAAY3kG,EAAKyjE,MAAM,MACvBihC,EAAa1kG,EAAKyjE,MAAM,OAwDxBzjE,EAAK+kG,SAAW,WACfR,EAAMzkF,EAAMukF,QACZC,EAAYC,IAGbvkG,EAAKs+D,SAELt+D,EAAKglG,cAAgB,GAAIl3B,GAAW9tE,EAAK4iE,IAAM,OAC9C5wD,MAAO4yF,EACPn3B,KAAMm3B,IAGP5kG,EAAKilG,aAAe,GAAIn3B,GAAW9tE,EAAK4iE,IAAM,MAC7C5wD,MAAO6yF,EACPp3B,KAAMo3B,IAGP7kG,EAAK+kG,YAGNG,IAAK,WACJ,MAAOnvG,MAAK+pB,QAAQskF,SAGrB9sG,MAAO,SAASA,GACf,GAAI0I,GAAOjK,IAEX,OAAIrD,WAAUT,QACb+N,EAAK8f,QAAQC,MAAMzoB,QAEf0I,EAAKmlG,WACRnlG,EAAK+kG,aAGC/kG,EAAK8f,QAAQhB,SAItBgB,MAAO,WAKN,MAJK/pB,MAAKwtG,SACTxtG,KAAKwtG,OAAS,GAAIG,IAGZ3tG,KAAKwtG,QASb36B,WAAY,WAIX,QAASw8B,KACR,GAAIpzG,GAAGqO,EAAcglG,EAAgBC,EAA3BntF,EAAO,EAIjB,KAFAktF,EAAiB,kFACjBC,EAAYC,EAAM1yG,MAAM,KACnBb,EAAI,EAAGqO,EAAIilG,EAAUrzG,OAAS,EAAGD,EAAIqO,EAAGrO,IAC5CmmB,GACC,eAAiB8H,EAAS,sCACZ,IAAM5f,EAAK,KACxBglG,EAAiBC,EAAUtzG,GAAK,gBAAkBszG,EAAUtzG,EAAI,GAAK,SAC5DqzG,EAAiBC,EAAUtzG,GAAK,gBAAkBszG,EAAUtzG,EAAI,GAAK,WAKjF,OAAOmmB,GAlBR,GAA2DqtF,GAAvDxlG,EAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,YAC1C+gC,EAAQ,0GAoBRE,EACH,uCAAyCF,EAAQ,2CACNA,EAAQ,IAUpD,OAPAC,GACC,YAAcjzG,EAAK,cAAgB0tB,EAAS,yBAA2BwlF,EAAkB,KACxFL,IACA,YAAc7yG,EAAK,eAAiB0tB,EAAS,qCAK9C,YAAc1tB,EAAK,YAAcyN,EAAK8hD,QAAU,cACjCvvD,EAAK,eAAiB0tB,EAAS,+BAC3BA,EAAS,qCACRA,EAAS,kCACX1tB,EAAK,gBAAkB0tB,EAAS,sCAC5BA,EAAS,wDAK9BulF,EACD,cAyBJlzG,EAAO,mBACN,qBACE,SAASwkF,GAGX,MAAOA,GAAO1/D,QAQbiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEN6oB,GAAS8mF,YACb9mF,EAAS8mF,UAAY,KAGtB1lG,EAAKs+D,OAAO1/C,GACZ5e,EAAK8hD,QAAQnnC,IAAI,QACjB3a,EAAKuqE,UAAW,EAEhBvqE,EAAKid,GAAG,QAAS,SAASnmB,GACzB,GAAI4e,GAAO/iB,EAASmE,EAAEnE,QAEjB+iB,EAAQ/iB,EAAO6R,aAAa,gBAChCxE,EAAKiC,KAAK,UAAW3K,MAAO0I,EAAK2lG,MAAMjwF,GAAQA,MAAOA,MAIxD1V,EAAK2lG,IAAI3lG,EAAK4e,SAAS+mF,MASxB5yF,MAAO,WACN,GAAI/S,GAAOjK,IAIX,OAFAiK,GAAKyjE,QAAQ9yD,WAAWoC,QAEjB/S,GASR2lG,IAAK,SAASA,GACb,MAAKjzG,WAAUT,QAIf8D,KAAK+mB,MAAM9B,IAAI,MAAO2qF,GAEf5vG,MALCA,KAAK+mB,MAAM/B,IAAI,QAcxB6tD,WAAY,WACX,GAAI5oE,GAAOjK,IAEX,OACC,YAAciK,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,KACrD9hD,EAAK4lG,iBAAiB5lG,EAAK8c,MAAM/B,IAAI,QACtC,UAIFuuD,WAAY,WACX,GAAItpE,GAAOjK,IAMX,OAJAiK,GAAK8c,MAAMG,GAAG,aAAc,SAASnmB,GACpCkJ,EAAK8hE,UAAU9hE,EAAK4lG,iBAAiB9uG,EAAEQ,UAGjC0I,EAAKs+D,UAGbsnC,iBAAkB,SAASnoG,GAC1B,GAAqCzL,GAAGqO,EAApCL,EAAOjK,KAAMkmD,EAAQx+C,MAAkB0a,EAAO,GAAI8H,EAASjgB,EAAKwkE,WAEpE,KAAKxyE,EAAI,EAAGqO,EAAI47C,EAAMhqD,OAAQD,EAAIqO,EAAGrO,IACpCmmB,IACEnmB,EAAI,EAAI,eAAiBiuB,EAAS,gCAAkCjgB,EAAK4e,SAAS8mF,UAAY,UAAY,IAC3G,6BAA+BzlF,EAAS,aAAejuB,GAAKqO,EAAI,EAAI,IAAM4f,EAAS,OAAS,IAAM,iBAClGjuB,EAAI,uBAAyBgO,EAAK4iE,IAAM,IAAM5wE,EAAI,iBAAmBA,EAAI,KAAOiqD,EAAMjqD,GAAG2K,KAAO,QAQlG,OAJKwb,KACJA,EAAO,eAAiB8H,EAAS,sBAG3B9H,OAuBV7lB,EAAO,0BACN,kBACA,yBACE,SAASuzG,EAAM1I,GACjB,MAAO0I,GAAKzuF,QAOXyxD,WAAY,WAGX,QAASn0C,GAASpZ,GACjB,GAAqB,IAAjBA,EAAIha,SAAgB,CACvB,GAAoB,MAAhBga,EAAIjX,UAAsBiX,EAAI9W,aAAa,kBAC9C,OAAO,CAGR,IAA0C,aAAtC8W,EAAI9W,aAAa,iBACpB,OAAO,EAIT,OAAO,EAbR,GAAIxE,GAAOjK,KAAM6D,EAASujG,EAAc7c,YA+CxC,OA/BI1mF,GAAOglB,SAASknF,eAAgB,IACnC9lG,EAAKid,GAAG,SAAU,SAASnmB,GAC1B8C,EAAOmZ,QACPnZ,EAAOqlC,UAAU95B,OAAOpP,KAAK4vG,MAAM7uG,EAAE4e,OAAO9c,SAC5CgB,EAAOylC,gBAGRzlC,EAAOqjB,GAAG,aAAc,SAASnmB,GAGhC,IAFA,GAAIivG,MAAiBpoF,EAAU7mB,EAAE6mB,QAAS3rB,EAAI2rB,EAAQ1rB,OAE/CD,KACN,GAA2B,GAAvB2rB,EAAQ3rB,GAAGsP,WAAkBozB,EAAS/W,EAAQ3rB,IAAK,CACtD,GAAImG,GAAOyB,EAAOqI,KAAK,eACtBtF,KAAMghB,EAAQ3rB,GAAGqS,SAASC,cAC1B3R,OAAQgrB,EAAQ3rB,IAOjB,IAJKmG,EAAK4G,sBACTgnG,EAAW3zG,MAAMuK,KAAMxE,EAAKwE,KAAM/D,QAAS+kB,EAAQ3rB,KAGhDmG,EAAK+G,uBACR,MAKHc,EAAK2lG,IAAII,MAIJ/lG,EAAKs+D,cAyBfhsE,EAAO,uBACN,wBACE,SAASm9E,GAGX,MAAOA,GAAUr4D,QAChBwnD,UACCqN,OAAQ,OACR3T,MAAO,SACPj6C,UACC2nF,KAAM,IAURp9B,WAAY,WACX,GAAI5oE,GAAOjK,KAAMk2E,EAASjsE,EAAK2iE,QAAS1iD,EAASjgB,EAAKwkE,WAKtD,OAHAxkE,GAAK8hD,QAAQnnC,IAAI,YACjBsxD,EAAOlD,UAAU/oE,GAGhB,YAAcA,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,kCACpD9hD,EAAK4e,SAASq1D,MAAS,YAAcj0E,EAAK4iE,IAAM,kBAAoB3iD,EAAS,UAC7EjgB,EAAK4e,SAASq1D,MAAQ,SAAY,IACnC,YAAcj0E,EAAK4iE,IAAM,iBAAmB5iE,EAAK+rE,YAAc,MAC7D/rE,EAAK4e,SAASzG,MAAQ,IAAM8zD,EAAOrD,WAAW5oE,GAChD,oBAoCL1N,EAAO,mBACN,uBACA,sBACA,sBACE,SAASm9E,EAAWw2B,EAAUnuF,GAGhC,MAAO23D,GAAUr4D,QAChBwnD,UACCoN,aAAc,OACdC,OAAQ,OACR5a,UAAW,SACXiH,MAAO,UACP0tC,KAAM,EACN3gC,QAAS,GACT6gC,SAAU,GACVpyB,QAAS,GACT5mD,WACC5Y,OAAQ,WACPve,KAAKue,YAURy0D,UAAW,WACV,GAAI/oE,GAAOjK,KAAM0gB,EAAQzW,EAAKyW,OAEzBzW,GAAK4e,SAASunF,mBAClBnmG,EAAK4e,SAASunF,kBACbl6B,OAAQ,OACRnG,WAAY,WACZznD,UAAW2nF,KAAM,KAKnBvvF,EAAMrB,KAAK,SAAS67B,GACnB,GAAIm1D,GAAUC,EAAQp1D,EAAKryB,SAASynF,KAEhCA,KACHD,EAAW,GAAIH,GAASnuF,EAAMV,QAC7BX,OACCxY,KAAM,QACN1L,GAAI0+C,EAAK2xB,IAAM,KACfpwD,KAAM6zF,EACNL,KAAM,EACNM,MAAOr1D,EAAK2xB,IACZvvD,SAAU49B,EAAK59B,aAEdrT,EAAK4e,SAASunF,mBAEjBC,EAASnoG,KAAO,WAChBgzC,EAAKs3B,KAAK,aAAct3B,EAAK2xB,IAAM,MAEF,mBAAtB3xB,GAAKryB,SAASonF,OACxB/0D,EAAKryB,SAASonF,KAAO,GAGtBhmG,EAAKyE,QAAQwsC,EAAMm1D,GACnBA,EAASzrF,IAAIs2B,OAWhB38B,OAAQ,WACP,MAAOve,MAAKkM,KAAK,UAAWxE,KAAM1H,KAAKk3E,YASxCpE,WAAY,WACX,GAAI7oE,GAAOjK,IAEXiK,GAAKs+D,SACLt+D,EAAKgtE,SAAShtE,EAAK4e,SAASnhB,OAG7B6rE,WAAY,WAKX,QAASi9B,KACR,GAAoCv0G,GAAGk0G,EAAUzvF,EAA7C+vF,EAAgB,EAAGC,IAEvB,IAAIzmG,EAAK4e,SAAS8nF,gBAAiB,EAoBnC,IAfCjwF,EADiC,YAA9BzW,EAAK4e,SAAS8nF,aACT1mG,EAAK6K,KAAK,YAEV7K,EAAKyW,QAGdA,EAAM9N,OAAO,YAAYyM,KAAK,SAASK,GACtC,GAAIkxF,GAAYlxF,EAAKgB,QAAQ,GAAImwF,EAAaD,EAAUljC,QAAQ/xC,WAEhE80E,GAAgBI,EAAaJ,EAAgBI,EAAaJ,EAC1DC,EAAOr0G,KAAKu0G,KAGbT,EAAWlmG,EAAK4e,SAASsnF,UAAY,EAErCl0G,EAAIy0G,EAAOx0G,OACJD,KACNy0G,EAAOz0G,GAAG4sB,SAASgnD,SAAW4gC,EAAgBN,EA5BhD,GAAIlmG,GAAOjK,IAEXiK,GAAKs+D,SA8BLt+D,EAAKid,GAAG,OAAQspF,GAChBA,SAwBHj0G,EAAO,uBACN,mBACE,SAASu0G,GAGX,MAAOA,GAAKzvF,QACXwnD,UACCoN,aAAc,WACdC,OAAQ,OACR5a,UAAW,SACXiH,MAAO,UACP0tC,KAAM,EACN3gC,QAAS,aACT6gC,SAAU,GACVpyB,QAAS,GACTnyD,OAAQ,GASTinD,WAAY,WACX,GAAI5oE,GAAOjK,KAAMk2E,EAASjsE,EAAK2iE,QAAS1iD,EAASjgB,EAAKwkE,WAKtD,OAHAxkE,GAAK+oE,YACLkD,EAAOlD,UAAU/oE,GAGhB,iBAAmBA,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,kCACzD9hD,EAAK4e,SAASq1D,MAAS,eAAiBj0E,EAAK4iE,IAAM,kBAAoB3iD,EAAS,mBAChFjgB,EAAK4e,SAASq1D,MAAQ,YAAe,IACtC,YAAcj0E,EAAK4iE,IAAM,iBAAmB5iE,EAAK+rE,YAAc,MAC7D/rE,EAAK4e,SAASzG,MAAQ,IAAM8zD,EAAOrD,WAAW5oE,GAChD,yBA2BL1N,EAAO,yBACN,sBACA,sBACE,SAASuwG,EAAU/qF,GAGrB,MAAO+qF,GAASzrF,QAOfiC,KAAM,SAASuF,GACd,GACIkoF,GAAgBC,EAAqBC,EADrChnG,EAAOjK,KAAM6D,EAASqwE,QAAQqW,aAAc2mB,EAAiBrtG,EAAOglB;AAGxEA,EAAS27E,YAAa,EAEtByM,EAA2BC,EAAeC,mBAAqBD,EAAeE,4BAC1EH,IACHA,EAA2BlvF,EAAMtB,QAAQwwF,EAA0B,SAG/DA,IAA4BA,EAAyBpoF,EAASwoF,YAClEL,EAAsBE,EAAeI,sBACjCN,GAAyBC,IAA4BA,EAAyBpoF,EAASwoF,WAkB1FL,EAAsBE,EAAeK,uBACjCP,GAAyBC,IAA4BA,EAAyBpoF,EAASwoF,YAC1FN,EAAiB,WAChBC,EACC/mG,EAAKyjE,MAAM,OAAOlxE,GAClByN,EAAK1I,QACLsnB,EAASwoF,SACT3vG,WAxBHqvG,EAAiB,WAChB,GAAIplB,GAAO1hF,EAAKiC,KAAK,cAAcy/E,IAEnCA,GAAO5pE,EAAMV,QAAQgwF,SAAUxoF,EAASwoF,UAAW1lB,GAGnDqlB,EAAoB7vG,KACnB0C,EACA,SAAStC,EAAOoqF,GACf1hF,EAAK1I,MAAMA,GAAO2K,KAAK,UAAWy/E,KAAMA,KAEzC1hF,EAAK1I,QACLoqF,KAmBAolB,IACHloF,EAASu4D,KAAO,SAChBv4D,EAASkkF,SAAWgE,GAGrB9mG,EAAKs+D,OAAO1/C,QAyBftsB,EAAO,wBACN,6BACE,SAASi1G,GAGX,MAAOA,GAAenwF,QAOrBod,OAAQ,SAASl0B,GAChB,GAAIknG,GAAiBlnG,EAAUqlE,aAAcP,EAAa9kE,EAAU8kE,UAEpE9kE,GAAUmW,QAAQ9N,OAAO,YAAYyM,KAAK,SAAS67B,GAClDA,EAAK00B,YACJryE,EAAG8xE,EAAW9vE,KACd/B,EAAG6xE,EAAW7vE,IACd/B,EAAGg0G,EAAe7gC,OAASvB,EAAWhlD,MAAQglD,EAAW9vE,KACzD7B,EAAG+zG,EAAe5gC,OAASxB,EAAW7vE,IAAM6vE,EAAW/kD,SAGpD4wB,EAAKzc,QACRyc,EAAKzc,gBA8BVliC,EAAO,yBACN,6BACE,SAASi1G,GAGX,MAAOA,GAAenwF,QAOrBod,OAAQ,SAASl0B,GAEhB,GAAItO,GAAGqO,EAAGoW,EAAO+wF,EAAgBC,EAAgBC,EAAcpvC,EAAOyb,EAAMD,EAAS6zB,EAAWC,EAAgBv2C,EAC5GpgB,EAAM42D,EAAgBC,EAAc9B,EAAyBxnF,EAAMupF,EAAS9zD,EAAO9gD,EAAMc,EAAK+zG,EAC9F55B,EAAU65B,EAAa95B,EAAS+5B,EAAaC,EAAYC,EAAeC,EAAeh6B,EACvFi6B,EAAeC,EAAoBC,EAAeC,EAAkBC,EAAiBC,EACrFC,EAAoBC,EAHsBC,KAI1Cr0G,EAAMiB,KAAKjB,IAAKC,EAAMgB,KAAKhB,GA2D/B,KAxDA+hB,EAAQnW,EAAUmW,QAAQ9N,OAAO,YACjC6+F,EAAiBlnG,EAAUqlE,aAC3B8hC,EAAiBnnG,EAAU8kE,WAC3BsiC,EAAepnG,EAAUse,SACzByyC,EAAY/wD,EAAUokE,QAAWgjC,EAAar2C,WAAa,eAAkBq2C,EAAar2C,UAC1FiH,EAAQovC,EAAapvC,MACrByb,EAAOzzE,EAAUokE,QAAWgjC,EAAa3zB,MAAQ,MAAS2zB,EAAa3zB,KACvED,EAAU4zB,EAAa5zB,SAAW,EAEjB,gBAAbziB,GAA4C,kBAAbA,IAClC56C,EAAQA,EAAMuE,IAAIvE,EAAMxB,UAAUyD,WAClC24C,EAAYA,EAAUx+D,MAAM,KAAK,IAIjB,UAAbw+D,GACH8c,EAAU,IACVC,EAAW,IACX65B,EAAc,OACdC,EAAc,OACdE,EAAgB,SAChBD,EAAa,MACbE,EAAgB,SAChBh6B,EAAkB,WAElBq6B,EAAkB,OAClBF,EAAgB,IAChBF,EAAgB,IAChBC,EAAqB,SACrBE,EAAmB,OACnBE,EAAiB,QACjBC,EAAqB,SACrBC,EAAuB,aAEvB16B,EAAU,IACVC,EAAW,IACX65B,EAAc,OACdC,EAAc,OACdE,EAAgB,SAChBD,EAAa,OACbE,EAAgB,SAChBh6B,EAAkB,WAElBq6B,EAAkB,MAClBF,EAAgB,IAChBF,EAAgB,IAChBC,EAAqB,SACrBE,EAAmB,OACnBE,EAAiB,SACjBC,EAAqB,SACrBC,EAAuB,YAIxBjB,EAAiBJ,EAAeY,GAAiBX,EAAeU,GAAcV,EAAeU,GAC7FH,EAAiBL,EAAY,EACxB31G,EAAI,EAAGqO,EAAIoW,EAAMxkB,OAAQD,EAAIqO,EAAGrO,IACpCi/C,EAAOx6B,EAAMzkB,GACb61G,EAAiB52D,EAAK00B,aACtBmiC,EAAe72D,EAAKryB,SACpBonF,EAAO8B,EAAa9B,KACpB4B,GAAmB51G,EAAIqO,EAAI,EAAIyzE,EAAU,EAErCkyB,EAAO,IACV2B,GAAa3B,EAGT6B,EAAeK,IAClBY,EAAa12G,KAAK6+C,GAGnB42D,EAAe7B,KAAOA,GAGvB4B,GAAkBC,EAAeI,GAGjCzpF,EAAOipF,EAAeiB,GAAmBb,EAAeY,GAAoBhB,EAAekB,GACvFnqF,EAAOwpF,IACVA,EAAiBxpF,EAsBnB,IAjBArrB,KACIy0G,EAAiB,EACpBz0G,EAAK80G,GAAeT,EAAeS,GAAeL,EAAiBJ,EAAea,GAElFl1G,EAAK80G,GAAeT,EAAeY,GAAiBR,EAAiBJ,EAAea,GAGrFl1G,EAAKs1G,GAAoBT,EAAiBR,EAAeoB,GAEzDz1G,EAAKk7E,GAAmBm5B,EAAeY,GAAiBR,EACxDz0G,EAAK01G,GAAwBb,EAC7B70G,EAAK0zE,KAAOnyE,EAAIvB,EAAK0zE,KAAM2gC,EAAephC,MAC1CjzE,EAAK2zE,KAAOpyE,EAAIvB,EAAK2zE,KAAM0gC,EAAelhC,MAC1CnzE,EAAK0zE,KAAOpyE,EAAItB,EAAK0zE,KAAM2gC,EAAezhC,eAC1C5yE,EAAK2zE,KAAOryE,EAAItB,EAAK2zE,KAAM0gC,EAAexhC,iBAGtCwhC,EAAe1hC,YAAe3yE,EAAK0zE,MAAQ2gC,EAAe3gC,MAAQ1zE,EAAK2zE,MAAQ0gC,EAAe1gC,KAAlG,CAqBA,IADA7yB,EAAQ2zD,EAAiBD,EACpB31G,EAAI,EAAGqO,EAAIyoG,EAAa72G,OAAQD,EAAIqO,EAAGrO,IAC3Ci/C,EAAO63D,EAAa92G,GACpB61G,EAAiB52D,EAAK00B,aACtBoiC,EAAUF,EAAeK,GACzB1pF,EAAOqpF,EAAeI,GAAeJ,EAAe7B,KAAO/xD,EAEvDz1B,EAAOupF,GACVH,GAAmBC,EAAeK,GAAeL,EAAeI,GAChEN,GAAaE,EAAe7B,KAC5B6B,EAAe7B,KAAO,EACtB6B,EAAekB,YAAchB,GAE7BF,EAAekB,YAAc,CA+B/B,KA1BA90D,EAAQ2zD,EAAiBD,EACzB1zG,EAAMwzG,EAAeU,GACrBh1G,KAGkB,IAAdw0G,IACS,OAAR5zB,EACH9/E,EAAM2zG,EAAiBH,EAAeU,GACpB,UAARp0B,GACV9/E,EAAMyB,KAAK9B,MACT4zG,EAAeY,GAAiB,GAAOZ,EAAeY,GAAiBR,GAAkB,GACvFH,EAAeU,GAEfl0G,EAAM,IACTA,EAAMwzG,EAAeU,KAEJ,WAARp0B,IACV9/E,EAAMwzG,EAAeU,GACrBr0B,EAAUp+E,KAAKu6C,MAAM23D,GAAkBnxF,EAAMxkB,OAAS,MAKxDkB,EAAKm1G,GAAiBb,EAAeiB,GAGhC12G,EAAI,EAAGqO,EAAIoW,EAAMxkB,OAAQD,EAAIqO,EAAGrO,IACpCi/C,EAAOx6B,EAAMzkB,GACb61G,EAAiB52D,EAAK00B,aACtBnnD,EAAOqpF,EAAekB,aAAelB,EAAeI,GAGtC,WAAV3vC,EACHnlE,EAAKm1G,GAAiB5yG,KAAK9B,MAAO4zG,EAAee,GAAsB,EAAMV,EAAeW,GAAiB,GACzF,YAAVlwC,GACVnlE,EAAKq1G,GAAiB/zG,EACrBozG,EAAeY,IAAqB,EACpCjB,EAAee,GAAsBd,EAAeiB,GAAmBjB,EAAekB,IAEvFx1G,EAAKm1G,GAAiBb,EAAeiB,IACjB,QAAVpwC,IACVnlE,EAAKm1G,GAAiBd,EAAee,GAAsBV,EAAeW,GAAiBf,EAAelyG,KAIvGsyG,EAAe7B,KAAO,IACzBxnF,GAAQqpF,EAAe7B,KAAO/xD,GAG/B9gD,EAAKi7E,GAAY5vD,EACjBrrB,EAAKg7E,GAAWl6E,EAChBg9C,EAAK00B,WAAWxyE,GAGZ89C,EAAKzc,QACRyc,EAAKzc,SAINvgC,GAAOuqB,EAAOs1D,MAzFd,IAPA3gF,EAAKK,EAAIL,EAAK0zE,KACd1zE,EAAKM,EAAIN,EAAK2zE,KAEdxmE,EAAUqlE,WAAWxyE,GACrB4C,KAAKy+B,OAAOl0B,GAGgB,OAAxBA,EAAU0nE,UAAoB,CACjC,GAAIuB,GAAajpE,EAAU8N,QACvBm7D,KACHA,EAAWvB,UAAY,KACvBuB,EAAW/0C,gBA8GjBliC,EAAO,yBACN,qBACE,SAASqvG,GACX,MAAOA,GAAOvqF,QACbwnD,UACC0iC,eAAgB,cAChBI,aAAc,mBACdsH,SAAU,SASXx0E,OAAQ,SAASl0B,GAChBA,EAAUmW,QAAQ9N,OAAO,YAAYyM,KAAK,SAAS67B,GAC9CA,EAAKzc,QACRyc,EAAKzc,YAKR6qC,SAAU,WACT,OAAO,OAuBV/sE,EAAO,6BACN,qBACA,oBACA,wBACA,qBACA,wBACA,eACE,SAASiyE,EAASuS,EAAQjF,EAAY/5D,EAAOqlF,EAAe1gG,GAiB9D,QAASwsG,GAAiBrvG,GAGzB,QAASsvG,GAA2BzyF,EAAO0yF,GAC1C,MAAO,YACN,GAAInpG,GAAOjK,IAEX6D,GAAOqjB,GAAG,aAAc,SAASnmB,GAChC,GAAI8qD,GAAYhoD,EAAOgoD,UACnBtqD,EAAQ,IAEZ8d,GAAKte,EAAE6mB,QAAS,SAAS1P,GAiBxB,GAhBAmH,EAAKqB,EAAO,SAAShB,GAWpB,GAVI0zF,EACCvnD,EAAU6F,UAAUx5C,EAAMk7F,GAAa7xG,MAAOme,EAAKne,UACtDA,EAAQme,EAAKne,OAGVsqD,EAAU6F,UAAUx5C,EAAMwH,EAAKne,SAClCA,EAAQme,EAAKne,OAIXA,EACH,OAAO,IAILA,EACH,OAAO,IAIT0I,EAAK1I,MAAMA,MAKd,QAAS8xG,GAAcvjD,GACtBA,EAAUA,EAAQphD,QAAQ,KAAM,IAAI5R,MAAM,IAG1C,KADA,GAAIb,GAAI6zD,EAAQ5zD,OACTD,KACN6zD,EAAQ7zD,GAAK6zD,EAAQ7zD,GAAGa,MAAM,IAG/B,OAAOgzD,GAGR,QAASwjD,KAsCR,QAASC,GAAWzjD,GACnB,GAAIu8C,KAEJ,IAAKv8C,EA2BL,MAvBAzwC,GAAKywC,EAAS,SAAS3W,GACtB,GAAIq6D,IACH/2F,KAAM08B,EAAO+kC,MACbkD,KAAMjoC,EAAOioC,KAGd,IAAIjoC,EAAOz4B,MACV8yF,EAASnH,KAAOkH,EAAWp6D,EAAOz4B,WAC5B,CACN,GAAI0yF,GAAaj6D,EAAOA,QAAU,SAAWzuC,GAExCyuC,GAAOA,SACXA,EAAOvyC,KAAOwsG,EACdK,EAAWp3G,KAAK88C,IAGjBq6D,EAASr6D,OAASi6D,EAClBI,EAASh8C,IAAMre,EAAOqe,IAGvB60C,EAAKhwG,KAAKm3G,KAGJnH,EAGR,QAASqH,KACR,GAAIrH,EAYJ,OAREA,GAAOkH,EAFL1vG,EAAOglB,SAAS8qF,oBACf9vG,EAAOglB,SAAS+qF,cACDC,EAAoB5nG,OAAOpI,EAAOglB,SAAS+qF,eAE3CC,EAGDhwG,EAAOglB,SAAS+qF,eAAiBC,GAhFrD,GAAInpG,GAAQ,EAAG+oG,KAEXI,IACF31B,MAAO,WAAYx9D,QAClBw9D,MAAO,YAAa/kC,OAAQ,OAC5B+kC,MAAO,YAAa/kC,OAAQ,OAC5B+kC,MAAO,YAAa/kC,OAAQ,OAC5B+kC,MAAO,YAAa/kC,OAAQ,OAC5B+kC,MAAO,YAAa/kC,OAAQ,OAC5B+kC,MAAO,YAAa/kC,OAAQ,SAG7B+kC,MAAO,SAAUx9D,QAChBw9D,MAAO,OAAQkD,KAAM,OAAQjoC,OAAQ,SACrC+kC,MAAO,SAAUkD,KAAM,SAAUjoC,OAAQ,WACzC+kC,MAAO,YAAakD,KAAM,YAAajoC,OAAQ,cAC/C+kC,MAAO,gBAAiBkD,KAAM,gBAAiBjoC,OAAQ,kBACvD+kC,MAAO,cAAekD,KAAM,cAAejoC,OAAQ,gBACnD+kC,MAAO,YAAakD,KAAM,YAAajoC,OAAQ,cAC/C+kC,MAAO,OAAQkD,KAAM,OAAQjoC,OAAQ,WAGtC+kC,MAAO,SAAUx9D,QAChBw9D,MAAO,YAAa/kC,OAAQ,MAC5B+kC,MAAO,aAAc/kC,OAAQ,eAC7B+kC,MAAO,MAAO/kC,OAAQ,QACtB+kC,MAAO,MAAO/kC,OAAQ,UAGvB+kC,MAAO,YAAax9D,QACnBw9D,MAAO,OAAQkD,KAAM,YAAajoC,OAAQ,cAC1C+kC,MAAO,SAAUkD,KAAM,cAAejoC,OAAQ,gBAC9C+kC,MAAO,QAASkD,KAAM,aAAcjoC,OAAQ,eAC5C+kC,MAAO,UAAWkD,KAAM,eAAgBjoC,OAAQ,kBA2DnD,OANAt1C,GAAOqjB,GAAG,OAAQ,WACjB7H,EAAKo0F,EAAY,SAASt6D,GACzBt1C,EAAOgoD,UAAUqB,SAAS/T,EAAOvyC,KAAMuyC,QAKxCjxC,KAAM,OACNwY,MAAOgzF,IACP/zB,aAAc,SAAS5+E,GACtB8C,EAAOqI,KAAK,qBAAsBu/D,QAAS1qE,EAAE0qE,WAE9CqoC,cACCC,SAAS,EAETC,UAAW,WACV,GAAIh0G,KAAK6oB,SAASswB,OACjB,MAAOt1C,GAAOgoD,UAAUP,WAAWtrD,KAAK6oB,SAASswB,SAInDwmC,aAAc,WACb,GAAI11E,GAAOjK,IAEXiK,GAAKoO,SAAS6O,GAAG,OAAQ,WACxB,GAAIksF,GAAY37C,CAEhB27C,GAAanpG,EAAK4e,SAASswB,OACvBi6D,IACHnpG,EAAKqT,UAAUzZ,EAAOgoD,UAAU8H,SAASy/C,IACzCnpG,EAAKklE,OAAOtrE,EAAOgoD,UAAU7lD,MAAMotG,KAGpC37C,EAAUxtD,EAAK4e,SAAS2uC,IACpBC,GACHxtD,EAAKklE,OAAOtrE,EAAOm9D,kBAAkBvJ,OAKxC8oB,QAAS,WACJvgF,KAAK6oB,SAASswB,QACjByoB,EAAa5hE,KAAK6oB,SAASswB,QAGxBn5C,KAAK6oB,SAAS2uC,KACjB3zD,EAAOo9C,YAAYjhD,KAAK6oB,SAAS2uC,QAStC,QAASy8C,GAAiBrtG,GACzB,MAAO,YACN,GAAIqD,GAAOjK,IAGP6D,GAAOgoD,UACVhoD,EAAOgoD,UAAU+H,cAAchtD,EAAM,SAASmgB,GAC7C9c,EAAKklE,OAAOpoD,KAGbljB,EAAOqjB,GAAG,OAAQ,WACjBrjB,EAAOgoD,UAAU+H,cAAchtD,EAAM,SAASmgB,GAC7C9c,EAAKklE,OAAOpoD,QAgEjB,QAASmtF,GAAoBhsG,GAC5B,MAAO,YAKN,QAASisG,KACR,QAAOtwG,EAAO02D,aAAc12D,EAAO02D,YAAYryD,KALhD,GAAI+B,GAAOjK,IAEXkI,GAAe,QAARA,EAAiB,UAAY,UAMpC+B,EAAKqT,UAAU62F,KACftwG,EAAOqjB,GAAG,qDAAsD,WAC/Djd,EAAKqT,SAASzZ,EAAOygB,WAAa6vF,QAKrC,QAASC,KACR,GAAInqG,GAAOjK,IAEX6D,GAAOqjB,GAAG,YAAa,SAASnmB,GAC/BkJ,EAAKklE,OAAOpuE,EAAEujE,aAGfr6D,EAAKklE,OAAOtrE,EAAOygE,WA2EpB,QAAS1C,GAAanS,GACjBA,EAAIgc,UACPhc,EAAMA,EAAIgc,QAAQlqE,SAGfkuD,GACH5rD,EAAOo9C,YAAY,mBAAmB,EAAOwO,GAnX/C,GAAI4kD,EA4LJA,GAAaf,IAsBbj0F,GACC4uC,KAAM,OACNE,OAAQ,SACRE,UAAW,YACXG,cAAe,gBACfY,UAAW,YACXC,YAAa,eACX,SAAS5yC,EAAM7V,GACjB/C,EAAOqhG,UAAUt+F,GAChBk6E,QAASrkE,EACTkjE,aAAcs0B,EAAiBrtG,GAC/B25E,QAAS,WACR3e,EAAah7D,QAMhByY,GACCi1F,SAAU,kBAAmB,WAC7B99D,QAAS,kBAAmB,UAC5B+9D,KAAM,MAAO,OACbC,MAAO,OAAQ,QACfj0C,OAAQ,QAAS,SACjBk0C,MAAO,OAAQ,WACfC,WAAY,aAAc,aAC1B/kD,cAAe,mBAAoB,gBACnCglD,WAAY,cAAe,sBAC3BC,aAAc,eAAgB,mBAC5B,SAASl1F,EAAM9Y,GACjB/C,EAAOqhG,UAAUt+F,GAChBk6E,QAASphE,EAAK,GACd83C,IAAK93C,EAAK,OAKZL,GACC8vC,YAAa,aAAc,iBAC3B0lD,SAAU,gBAAiB,qBAC3BC,SAAU,cAAe,uBACzB1lD,WAAY,YAAa,aACzBC,aAAc,cAAe,eAC7B9B,WAAY,aAAc,eAC1BK,aAAc,eAAgB,iBAC9BG,YAAa,cAAe,gBAC5BC,cAAe,UAAW,eAC1B+mD,WAAY,eAAgB,gBAC1B,SAASr1F,EAAM9Y,GACjB/C,EAAOqhG,UAAUt+F,GAChBk6E,QAASphE,EAAK,GACd83C,IAAK93C,EAAK,GACVigE,aAAcs0B,EAAiBrtG,OA+BjC/C,EAAOqhG,UAAU,QAChBpkB,QAAS,OACTnB,aAAcu0B,EAAoB,QAClC18C,IAAK,SAGN3zD,EAAOqhG,UAAU,QAChBpkB,QAAS,OACTnB,aAAcu0B,EAAoB,QAClC18C,IAAK,SAGN3zD,EAAOshG,YAAY,eAClB1oF,KAAM,eACN2kE,KAAM,cACN5pB,IAAK,mBAGN3zD,EAAOshG,YAAY,QAClB1oF,KAAM,OACN2kE,KAAM,OACNoK,SAAU,SACV7L,aAAcu0B,EAAoB,QAClC18C,IAAK,SAGN3zD,EAAOshG,YAAY,QAClB1oF,KAAM,OACN2kE,KAAM,OACNoK,SAAU,SACV7L,aAAcu0B,EAAoB,QAClC18C,IAAK,SAGN3zD,EAAOshG,YAAY,aAClB1oF,KAAM,cACNu4F,YAAY,EACZr1B,aAAcy0B,EACd58C,IAAK,uBAGN3zD,EAAOqhG,UAAU,UAChBpkB,QAAS,SACTM,KAAM,SACN5pB,IAAK,WAGNn4C,GACCk1F,KAAM,MAAO,MAAO,UACpBC,MAAO,OAAQ,OAAQ,UACvBj0C,OAAQ,QAAS,QAAS,UAC1Bm0C,WAAY,aAAc,YAAa,UACvCzmD,MAAO,OAAQ,OAAQ,UACvBE,QAAS,SAAU,SAAU,UAC7BE,WAAY,YAAa,aACzBG,eAAgB,gBAAiB,iBACjCY,WAAY,YAAa,aACzBC,aAAc,cAAe,eAC7BM,cAAe,mBAAoB,iBACjC,SAASjwC,EAAM9Y,GACjB/C,EAAOshG,YAAYv+F,GAClB6V,KAAMiD,EAAK,GACX0hE,KAAMx6E,EACN4kF,SAAU9rE,EAAK,GACf83C,IAAK93C,EAAK,OAIZ7b,EAAOqjB,GAAG,YAAa,WACtB40D,EAAWC,YAaZl4E,EAAOqhG,UAAU,eAChBh9F,KAAM,aACNuU,KAAM,UACN4vF,KAAMgI,IAGPxwG,EAAOqhG,UAAU,eAAgB,WAChC,GAAIxkF,MAAY6rC,EAAS8mD,EAAcxvG,EAAOglB,SAASosF,eACtD,6GAoBD,OAVA51F,GAAKktC,EAAQ,SAAST,GACrBprC,EAAMrkB,MACLogB,KAAMqvC,EAAM,GACZvqD,MAAOuqD,EAAM,GACbkoD,UAAW,WACV,MAAOnwG,GAAOgoD,UAAUP,WAAWQ,EAAM,UAM3C5jD,KAAM,UACNuU,KAAM8vC,EAAO,GAAG,GAChB5pD,OAAQ+d,EACRw0F,YAAY,EACZC,SAAUvzC,EACV+d,aAAcwzB,EAA2BzyF,MAI3C7c,EAAOqhG,UAAU,aAAc,WAC9B,GAAIkQ,GACH,ukBAkBG10F,KAAY20F,EAAQhC,EAAcxvG,EAAOglB,SAASysF,cAAgBF,EAUtE,OARA/1F,GAAKg2F,EAAO,SAAS/L,GACpB5oF,EAAMrkB,MACLogB,MAAOq5B,IAAKwzD,EAAK,IACjB/nG,MAAO+nG,EAAK,GACZ0K,UAAW1K,EAAK,GAAG1jG,QAAQ,aAAiB,eAAiB0jG,EAAK,GAAK,QAKxEphG,KAAM,UACNuU,KAAM,cACNqkE,QAAS,cACTn+E,OAAQ+d,EACRw0F,YAAY,EACZv1B,aAAcwzB,EAA2BzyF,EAAO,YAChDy0F,SAAU,SAASp0G,GACdA,EAAE0qE,QAAQ5iD,SAAStnB,OACtBsC,EAAOo9C,YAAY,YAAY,EAAOlgD,EAAE0qE,QAAQ5iD,SAAStnB,WAM7DsC,EAAOqhG,UAAU,iBAAkB,WAClC,GAAIxkF,MAAY60F,EAAyB,oCACrCC,EAAmB3xG,EAAOglB,SAAS2sF,kBAAoBD,CAa3D,OAXAl2F,GAAKm2F,EAAiB14G,MAAM,KAAM,SAAS4iB,GAC1C,GAAIjD,GAAOiD,EAAMne,EAAQme,EAErB/c,EAAS+c,EAAK5iB,MAAM,IACpB6F,GAAOzG,OAAS,IACnBugB,EAAO9Z,EAAO,GACdpB,EAAQoB,EAAO,IAEhB+d,EAAMrkB,MAAMogB,KAAMA,EAAMlb,MAAOA,OAI/B2G,KAAM,UACNuU,KAAM,aACNqkE,QAAS,aACTn+E,OAAQ+d,EACRw0F,YAAY,EACZv1B,aAAcwzB,EAA2BzyF,EAAO,YAChD6/D,QAAS,SAASx/E,GACbA,EAAE0qE,QAAQ5iD,SAAStnB,OACtBsC,EAAOo9C,YAAY,YAAY,EAAOlgD,EAAE0qE,QAAQ5iD,SAAStnB,WAM7DsC,EAAOshG,YAAY,WAClB1oF,KAAM,UACN4vF,KAAMgI,IA3fR,GAAIh1F,GAAO0C,EAAM1C,IAEjB+nF,GAAclgF,GAAG,YAAa,SAASnmB,GAClCA,EAAE8C,OAAO+qE,MACZJ,EAAQI,KAAM,GAGfskC,EAAiBnyG,EAAE8C,UAGpB2qE,EAAQtM,UAAY,SAASzlD,GAC5B,MAAO2qF,GAAcllC,UAAUzlD,IAGhCskE,EAAOC,UAAYt6E,EAAIT,MA4gBxB1J,EAAO,yBACN,6BACE,SAASi1G,GAGX,MAAOA,GAAenwF,QAOrBod,OAAQ,SAASl0B,GAChB,GAAIse,GAAU4sF,EAAMC,EAAMh1F,EAAO+wF,EAAgBhyG,EAAOC,EAAQtC,EAC/D00G,EAAgB52D,EAAM39C,EAAGC,EAAGm4G,EAAMC,EAAM7D,EAAcL,EAAgBnvC,EAAOszC,EAAUC,EAAUC,EAAQC,EAAQze,EAAMC,EACtFye,EAAcC,EAAeC,EAAgBC,EAAiBC,EAAah6F,EAA5Gi6F,KAAgBC,IAGjB1tF,GAAWte,EAAUse,SACrBnI,EAAQnW,EAAUmW,QAAQ9N,OAAO,YACjC6+F,EAAiBlnG,EAAUqlE,aAC3B8lC,EAAO7sF,EAAS2tF,SAAW72G,KAAK82G,KAAK92G,KAAK+2G,KAAKh2F,EAAMxkB,SACrDu5G,EAAO91G,KAAK82G,KAAK/1F,EAAMxkB,OAASw5G,GAChCG,EAAWhtF,EAASgtF,UAAYhtF,EAASk1D,SAAW,EACpD+3B,EAAWjtF,EAASitF,UAAYjtF,EAASk1D,SAAW,EACpDg4B,EAASltF,EAASktF,QAAUltF,EAAS05C,MACrCyzC,EAASntF,EAASmtF,QAAUntF,EAAS05C,MACrCmvC,EAAiBnnG,EAAU8kE,WAC3BgnC,EAAc,eAAiBxtF,GAAWA,EAASwtF,YAAc9rG,EAAUokE,QAEvEonC,GAA2B,gBAAVA,KACpBA,GAAUA,IAGPC,GAA2B,gBAAVA,KACpBA,GAAUA,GAIX,KAAKz4G,EAAI,EAAGA,EAAIm4G,EAAMn4G,IACrB+4G,EAAUj6G,KAAK,EAIhB,KAAKmB,EAAI,EAAGA,EAAIi4G,EAAMj4G,IACrB+4G,EAAWl6G,KAAK,EAIjB,KAAKmB,EAAI,EAAGA,EAAIi4G,EAAMj4G,IACrB,IAAKD,EAAI,EAAGA,EAAIm4G,IACfx6D,EAAOx6B,EAAMljB,EAAIk4G,EAAOn4G,GAGnB29C,GAJgB39C,IAQrBu0G,EAAiB52D,EAAK00B,aACtBqmC,EAAenE,EAAehhC,KAC9BolC,EAAgBpE,EAAe/gC,KAE/BulC,EAAU/4G,GAAK04G,EAAeK,EAAU/4G,GAAK04G,EAAeK,EAAU/4G,GACtEg5G,EAAW/4G,GAAK04G,EAAgBK,EAAW/4G,GAAK04G,EAAgBK,EAAW/4G,EAM7E,KADA24G,EAAiB1E,EAAe7gC,OAAS8gC,EAAenyG,KAAOmyG,EAAernF,MACzEktE,EAAO,EAAGh6F,EAAI,EAAGA,EAAIm4G,EAAMn4G,IAC/Bg6F,GAAQ+e,EAAU/4G,IAAMA,EAAI,EAAIs4G,EAAW,GAC3CM,IAAmB54G,EAAI,EAAIs4G,EAAW,GAAKS,EAAU/4G,EAKtD,KADA64G,EAAkB3E,EAAe5gC,OAAS6gC,EAAelyG,IAAMkyG,EAAepnF,OACzEktE,EAAO,EAAGh6F,EAAI,EAAGA,EAAIi4G,EAAMj4G,IAC/Bg6F,GAAQ+e,EAAW/4G,IAAMA,EAAI,EAAIs4G,EAAW,GAC5CM,IAAoB54G,EAAI,EAAIs4G,EAAW,GAAKS,EAAW/4G,EAmBxD,IAhBA+5F,GAAQma,EAAenyG,KAAOmyG,EAAernF,MAC7CmtE,GAAQka,EAAelyG,IAAMkyG,EAAepnF,OAG5CltB,KACAA,EAAK0zE,KAAOymB,GAAQka,EAAeh0G,EAAIg0G,EAAe7gC,QACtDxzE,EAAK2zE,KAAOymB,GAAQia,EAAe/zG,EAAI+zG,EAAe5gC,QAEtDzzE,EAAKszE,SAAWtzE,EAAK0zE,KAAO2gC,EAAethC,OAC3C/yE,EAAKuzE,SAAWvzE,EAAK2zE,KAAO0gC,EAAerhC,OAC3ChzE,EAAK0zE,KAAOnxE,KAAKhB,IAAIvB,EAAK0zE,KAAM2gC,EAAephC,MAC/CjzE,EAAK2zE,KAAOpxE,KAAKhB,IAAIvB,EAAK2zE,KAAM0gC,EAAelhC,MAC/CnzE,EAAK0zE,KAAOnxE,KAAKjB,IAAItB,EAAK0zE,KAAM2gC,EAAezhC,eAC/C5yE,EAAK2zE,KAAOpxE,KAAKjB,IAAItB,EAAK2zE,KAAM0gC,EAAexhC,iBAG3CwhC,EAAe1hC,YAAe3yE,EAAK0zE,MAAQ2gC,EAAe3gC,MAAQ1zE,EAAK2zE,MAAQ0gC,EAAe1gC,KAAlG,CAoBI0gC,EAAe1hC,aAClB3yE,EAAOmN,EAAUqlE,WAAWxyE,GAC5BA,EAAKszE,SAAWtzE,EAAK0zE,KAAO2gC,EAAethC,OAC3C/yE,EAAKuzE,SAAWvzE,EAAK2zE,KAAO0gC,EAAerhC,OAG5C,IAAIumC,EAGHA,GADqB,SAAlB9tF,EAAS+tF,MACJ,EAEAR,EAAkB,EAAIz2G,KAAKu6C,MAAMk8D,EAAkBX,GAAQ,CAIpE,IAAI7D,GAAY,EACZiF,EAAahuF,EAASguF,UAC1B,IAAIA,EACH,IAAKt5G,EAAI,EAAGA,EAAIs5G,EAAW36G,OAAQqB,IAClCq0G,GAAaiF,EAAWt5G,OAGzBq0G,GAAY8D,CAIb,IAAIx3D,GAAQi4D,EAAiBvE,CAC7B,KAAKr0G,EAAI,EAAGA,EAAIm4G,EAAMn4G,IACrB+4G,EAAU/4G,IAAMs5G,EAAaA,EAAWt5G,GAAK2gD,EAAQA,CAKtD,KADA03D,EAAOlE,EAAelyG,IACjBhC,EAAI,EAAGA,EAAIi4G,EAAMj4G,IAAK,CAI1B,IAHAm4G,EAAOjE,EAAenyG,KACtBG,EAAS62G,EAAW/4G,GAAKm5G,EAEpBp5G,EAAI,EAAGA,EAAIm4G,IAEdr5F,EADGg6F,EACG74G,EAAIk4G,EAAOA,EAAO,EAAIn4G,EAEtBC,EAAIk4G,EAAOn4G,EAGlB29C,EAAOx6B,EAAMrE,GAGR6+B,GAVgB39C,IAerBw0G,EAAe72D,EAAKryB,SACpBipF,EAAiB52D,EAAK00B,aACtBnwE,EAAQE,KAAKjB,IAAI43G,EAAU/4G,GAAIu0G,EAAe9hC,eAC9C8hC,EAAev0G,EAAIo4G,EACnB7D,EAAet0G,EAAIo4G,EAGnBrzC,EAAQwvC,EAAagE,SAAWA,EAAUA,EAAOx4G,IAAMw4G,EAAO,GAAM,MACvD,UAATxzC,EACHuvC,EAAev0G,EAAIo4G,EAAQl2G,EAAQ,EAAMqyG,EAAer0G,EAAI,EACzC,SAAT8kE,EACVuvC,EAAev0G,EAAIo4G,EAAOl2G,EAAQqyG,EAAer0G,EAC9B,WAAT8kE,IACVuvC,EAAer0G,EAAIgC,GAIpB8iE,EAAQwvC,EAAaiE,SAAWA,EAAUA,EAAOz4G,IAAMy4G,EAAO,GAAM,MACvD,UAATzzC,EACHuvC,EAAet0G,EAAIo4G,EAAQl2G,EAAS,EAAMoyG,EAAep0G,EAAI,EAC1C,UAAT6kE,EACVuvC,EAAet0G,EAAIo4G,EAAOl2G,EAASoyG,EAAep0G,EAC/B,WAAT6kE,IACVuvC,EAAep0G,EAAIgC,GAGpBw7C,EAAK00B,WAAWkiC,GAEhB6D,GAAQl2G,EAAQo2G,EAEZ36D,EAAKzc,QACRyc,EAAKzc,QAIPm3E,IAAQl2G,EAASo2G,OAnGjB,IAPA14G,EAAKK,EAAIL,EAAK0zE,KACd1zE,EAAKM,EAAIN,EAAK2zE,KAEdxmE,EAAUqlE,WAAWxyE,GACrB4C,KAAKy+B,OAAOl0B,GAGgB,OAAxBA,EAAU0nE,UAAoB,CACjC,GAAIuB,GAAajpE,EAAU8N,QACvBm7D,KACHA,EAAWvB,UAAY,KACvBuB,EAAW/0C,gBA4HjBliC,EAAO,qBACN,oBACA,sBACE,SAASwkF,EAAQt6E,GAGnB,MAAOs6E,GAAO1/D,QAObwxD,WAAY,WACX,GAAI5oE,GAAOjK,IAMX,OAJAiK,GAAK8hD,QAAQnnC,IAAI,UACjB3a,EAAKuqE,UAAW,EAIf,eAAiBvqE,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,yBACxD9hD,EAAK4e,SAASlH,KAAO,iBAAmB,+BAU3C+X,IAAK,SAASA,GACb15B,KAAK0tE,QAAQh0C,IAAMA,GAWpBtX,KAAM,SAASA,EAAMtmB,GACpB,GAAImO,GAAOjK,KAAM2D,EAAO3D,KAAK0tE,QAAQ1lD,cAActkB,SAASC,IAe5D,OAZKA,IAKJA,EAAKoV,UAAYqJ,EAEbtmB,GACHA,KAPD2K,EAAM5E,WAAW,WAChBoI,EAAKmY,KAAKA,KAULpiB,UAwBVzD,EAAO,sBACN,qBACE,SAASwkF,GAGX,MAAOA,GAAO1/D,QAQbiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZ5e,EAAK8hD,QAAQnnC,IAAI,UAAUA,IAAI,WAC/B3a,EAAKuqE,UAAW,GAGjBsiC,SAAU,SAASl/C,GAClB53D,KAAK+rD,QAAQlmC,OAAO,SACpB7lB,KAAK+rD,QAAQlmC,OAAO,WACpB7lB,KAAK+rD,QAAQlmC,OAAO,WACpB7lB,KAAK+rD,QAAQnnC,IAAIgzC,IAGlB68C,KAAM,SAAS1tF,GACd/mB,KAAK+mB,MAAM9B,IAAI,OAAQ8B,IASxB8rD,WAAY,WACX,GAAI5oE,GAAOjK,KAAMkqB,EAASjgB,EAAKwkE,WAE/B,OACC,YAAcxkE,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,cACvC9hD,EAAK4iE,IAAM,UACxB5iE,EAAK0gB,OAAO1gB,EAAK8c,MAAM/B,IAAI,SAC3B,iDACgBkF,EAAS,OAASA,EAAS,qCAO/CqpD,WAAY,WACX,GAAItpE,GAAOjK,IAkBX,OAhBAiK,GAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrCkJ,EAAKyjE,MAAM,QAAQ9yD,WAAWlT,KAAOuC,EAAK0gB,OAAO5pB,EAAEQ,OAE/C0I,EAAK8c,MAAM/B,IAAI,aAClB/a,EAAK+nE,qBAIP/nE,EAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrCkJ,EAAK8hD,QAAQoH,OAAO,WAAYpyD,EAAEQ,OAE9B0I,EAAK8c,MAAM/B,IAAI,aAClB/a,EAAK+nE,qBAIA/nE,EAAKs+D,cAyBfhsE,EAAO,oBACN,oBACA,uBACE,SAASwkF,EAAQ37B,GAGnB,MAAO27B,GAAO1/D,QAQbiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZ5e,EAAK8hD,QAAQnnC,IAAI,UAAUA,IAAI,SAC/B3a,EAAKuqE,UAAW,EAEZ3rD,EAASo2D,WACZh1E,EAAK8hD,QAAQnnC,IAAI,cAGdiE,EAASkuF,QACZ9sG,EAAK8hD,QAAQnnC,IAAI,WAYnB+qD,eAAgB,WACf,GAAI1lE,GAAOjK,KAAM4vE,EAAa3lE,EAAKs+D,QAEnC,IAAIt+D,EAAK4e,SAASo2D,UAAW,CAC5B,GAAIx2D,GAAO28B,EAASppB,QAAQ/xB,EAAKyjE,QAG7BjlD,GAAKhpB,MAAQmwE,EAAWS,OAC3BT,EAAWkB,KAAOlB,EAAWS,KAC7BpmE,EAAK8hD,QAAQnnC,IAAI,cAGlB3a,EAAKyjE,QAAQloD,MAAM/lB,MAAQmwE,EAAWkB,KAAO,KAC7ClB,EAAWonC,UAAYpnC,EAAWlyE,EAAIkyE,EAAWmB,KAAOpxE,KAAKhB,IAAIixE,EAAWW,KAAMnrB,EAASppB,QAAQ/xB,EAAKyjE,SAAShuE,QAGlH,MAAOkwE,IAQR4B,QAAS,WACR,GAAIvnE,GAAOjK,IAMX,OAJKiK,GAAK4e,SAASo2D,YAClBh1E,EAAKyjE,QAAQloD,MAAMinF,WAAaxiG,EAAK2lE,aAAalyE,EAAI,MAGhDuM,EAAKs+D,UAGbuuC,SAAU,SAASl/C,GAClB53D,KAAK+rD,QAAQlmC,OAAO,SACpB7lB,KAAK+rD,QAAQlmC,OAAO,WACpB7lB,KAAK+rD,QAAQlmC,OAAO,WACpB7lB,KAAK+rD,QAAQnnC,IAAIgzC,IASlBib,WAAY,WACX,GAAiBokC,GAAYC,EAAzBjtG,EAAOjK,KAA2BuwG,EAAQtmG,EAAK4e,SAAS0nF,KAU5D,QARKA,IAAU2G,EAAUjtG,EAAK4e,SAASquF,WACtCD,EAAahtG,EAAK2wB,UAAU9lB,KAAK,IAAMoiG,GAAS,GAE5CD,IACH1G,EAAQ0G,EAAWpqC,MAIjB0jC,EAEF,cAAgBtmG,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,KAAOwkD,EAAQ,SAAWA,EAAQ,IAAM,IAAM,IACrGtmG,EAAK0gB,OAAO1gB,EAAK8c,MAAM/B,IAAI,SAC5B,WAKD,aAAe/a,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,KACtD9hD,EAAK0gB,OAAO1gB,EAAK8c,MAAM/B,IAAI,SAC5B,WAIFuuD,WAAY,WACX,GAAItpE,GAAOjK,IAUX,OARAiK,GAAK8c,MAAMG,GAAG,cAAe,SAASnmB,GACrCkJ,EAAK8hE,UAAU9hE,EAAK0gB,OAAO5pB,EAAEQ,QAEzB0I,EAAK8c,MAAM/B,IAAI,aAClB/a,EAAK+nE,qBAIA/nE,EAAKs+D,cAuBfhsE,EAAO,sBACN,wBACE,SAASm9E,GAGX,MAAOA,GAAUr4D,QAChBwnD,UACCmG,KAAM,UACNkH,OAAQ,QAST5yD,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GACZ5e,EAAK8hD,QAAQnnC,IAAI,YAQlBkuD,WAAY,WACX,GAAI7oE,GAAOjK,IAMX,OAJAiK,GAAKyW,QAAQrB,KAAK,SAAS67B,GAC1BA,EAAK6Q,QAAQnnC,IAAI,kBAGX3a,EAAKs+D,cAwBfhsE,EAAO,sBACN,sBACE,SAAS46G,GAGX,MAAOA,GAAQ91F,QACdwnD,UACCmG,KAAM,UACNiH,aAAc,UACdnB,UAAU,EACVxsD,UACCpgB,KAAM,mBAyBV3L,EAAO,yBACN,oBACA,qBACA,sBACE,SAAS2wG,EAAQt3B,EAASwhC,GAI5B,QAASx2E,GAAU1oB,EAAMG,GACxB,KAAOH,GAAM,CACZ,GAAIG,IAAWH,EACd,OAAO,CAGRA,GAAOA,EAAKrM,WAGb,OAAO,EAGR,GAAIwrG,GAAanK,EAAO7rF,QAOvBiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKqtG,aAAc,EAEnBrtG,EAAKs+D,OAAO1/C,GACZA,EAAW5e,EAAK4e,SAEhB5e,EAAK8hD,QAAQnnC,IAAI,WAEbiE,EAASqsF,YACZjrG,EAAK8hD,QAAQnnC,IAAI,eAGlB3a,EAAKuoE,KAAK,YAAY,GAEtBvoE,EAAK8c,MAAM9B,IAAI,OAAQ4D,EAASwjF,MAAQpiG,EAAKgpE,WAQ9Cq5B,SAAU,WACT,GAAiBD,GAAbpiG,EAAOjK,IAEX,OAAIiK,GAAKoiG,MAAQpiG,EAAKoiG,KAAKn9B,UACnBjlE,EAAKstG,YAGRttG,EAAKoiG,OACTA,EAAOpiG,EAAK8c,MAAM/B,IAAI,YAGlBqnF,EAAKnwG,OACRmwG,GACCnkG,KAAM,OACNwY,MAAO2rF,GAGRA,EAAKnkG,KAAOmkG,EAAKnkG,MAAQ,OAGrBmkG,EAAKt5B,SAGT9oE,EAAKoiG,KAAOA,EAAKh0F,OAAOpO,GAAMod,OAAO0rD,WAFrC9oE,EAAKoiG,KAAOz2B,EAAQ93E,OAAOuuG,GAAMh0F,OAAOpO,GAAM8oE,WAK/C9oE,EAAKiC,KAAK,cACVjC,EAAKoiG,KAAKv/B,SACV7iE,EAAKoiG,KAAKnlF,GAAG,SAAU,SAASnmB,GAC3BA,EAAE0qE,QAAQpzD,WAAapO,EAAKoiG,OAC/BtrG,EAAEmI,kBACFe,EAAK+S,QACL/S,EAAKstG,cAKPttG,EAAKoiG,KAAKnlF,GAAG,SAAU,WACtBjd,EAAK+S,UAGN/S,EAAKoiG,KAAKnlF,GAAG,YAAa,SAASnmB,GAC9BA,EAAE0qE,SAAWxhE,EAAKoiG,MACrBpiG,EAAKutG,WAAqB,QAAVz2G,EAAEmH,MAGnB+B,EAAKuoE,KAAK,WAAsB,QAAVzxE,EAAEmH,QACtBgE,KAAK,SAGTjC,EAAKoiG,KAAKhlF,OACVpd,EAAKoiG,KAAKz8B,YAAYnyE,EAAGwM,EAAK2lE,aAAanyE,QAC3CwM,GAAKoiG,KAAKlyB,QAAQlwE,EAAKyjE,QAASzjE,EAAK0kE,SAAW,QAAS,UAAY,QAAS,YAQ/E4oC,SAAU,WACT,GAAIttG,GAAOjK,IAEPiK,GAAKoiG,OACRpiG,EAAKoiG,KAAK3rF,QAAQrB,KAAK,SAASK,GAC3BA,EAAK63F,UACR73F,EAAK63F,aAIPttG,EAAKoiG,KAAK/kF,SASZkwF,WAAY,SAASzwF,GACpB/mB,KAAK+rD,QAAQoH,OAAO,SAAUpsC,IAS/B8rD,WAAY,WACX,GAC+Bv0D,GAD3BrU,EAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,YAC1C2S,EAAOn3E,EAAK4e,SAASu4D,KAAa3kE,EAAOxS,EAAK8c,MAAM/B,IAAI,QAC3D+mF,EAAW,EAyBZ,OAvBAztF,GAAQrU,EAAK4e,SAASvK,MAClBA,GACH8iE,EAAO,OAGa,gBAAT9iE,KACVA,EAAQ5c,OAAO2E,aAAeiY,EAAM,GAAKA,EAAM,IAGhDA,EAAQ,mCAAqCA,EAAQ,QAErDA,EAAQ,GAGL7B,IACHxS,EAAK8hD,QAAQnnC,IAAI,gBACjBmnF,EAAW,gBAAkB7hF,EAAS,QAAUjgB,EAAK0gB,OAAOlO,GAAQ,WAGrE2kE,EAAOn3E,EAAK4e,SAASu4D,KAAOl3D,EAAS,OAASA,EAAS,KAAOk3D,EAAO,GAErEn3E,EAAKuoE,KAAK,OAAQvoE,EAAKoO,kBAAoB++F,GAAU,WAAa,UAGjE,YAAc56G,EAAK,YAAcyN,EAAK8hD,QAAU,oCAAsCvvD,EAAK,iBACzEA,EAAK,2DACpB4kF,EAAO,aAAeA,EAAO,IAAM9iE,EAAQ,QAAU,IACtDytF,EACA,cAAgB7hF,EAAS,8BAW7B4oD,WAAY,WACX,GAAI7oE,GAAOjK,IAiCX,OA/BAiK,GAAKid,GAAG,QAAS,SAASnmB,GACrBA,EAAE0qE,UAAYxhE,GAAQ22B,EAAU7/B,EAAEnE,OAAQqN,EAAKyjE,WAClDzjE,EAAKqiG,WAEDvrG,EAAEyxE,MACLvoE,EAAKoiG,KAAK3rF,QAAQ,GAAG1D,WAKxB/S,EAAKid,GAAG,aAAc,SAASnmB,GAC9B,GAAkD02G,GAA9CC,EAAW32G,EAAE0qE,QAASpzD,EAASpO,EAAKoO,QAEpCq/F,IAAYr/F,GAAUq/F,YAAoBL,IAAcK,EAASr/F,UAAYA,IAChFA,EAAOqI,QAAQ9N,OAAO,cAAcyM,KAAK,SAAS67B,GAC7CA,EAAKq8D,UAAYr8D,GAAQw8D,IACxBx8D,EAAKmxD,MAAQnxD,EAAKmxD,KAAKn9B,YAC1BuoC,GAAwB,GAGzBv8D,EAAKq8D,cAIHE,IACHC,EAAS16F,QACT06F,EAASpL,eAKLriG,EAAKs+D,UAGbgL,WAAY,WACX,GAAItpE,GAAOjK,IAUX,OARAiK,GAAK8c,MAAMG,GAAG,cAAe,WACxBjd,EAAKoiG,MACRpiG,EAAKoiG,KAAKxmF,SAGX5b,EAAKoiG,KAAO,OAGNpiG,EAAKs+D,UAQb1iD,OAAQ,WACP7lB,KAAKuoE,SAEDvoE,KAAKqsG,MACRrsG,KAAKqsG,KAAKxmF,WAKb,OAAOwxF,KAsBR96G,EAAO,uBACN,oBACA,qBACA,cACA,sBACE,SAASwkF,EAAQnL,EAASlvE,EAAKD,GAGjC,MAAOs6E,GAAO1/D,QACbwnD,UACCj9C,OAAQ,EACRojD,KAAM,YAYP1rD,KAAM,SAASuF,GACd,GAAiBpM,GAAbxS,EAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GAEZA,EAAW5e,EAAK4e,SAEhB5e,EAAK8hD,QAAQnnC,IAAI,aAEbiE,EAASwjF,MACZpiG,EAAK8hD,QAAQnnC,IAAI,oBAGdiE,EAASkrF,SACZ9pG,EAAK8hD,QAAQnnC,IAAI,qBAGlBnI,EAAOxS,EAAK8c,MAAM/B,IAAI,QACT,MAATvI,GAAyB,MAATA,IACnBxS,EAAK8hD,QAAQnnC,IAAI,iBACjB3a,EAAKuoE,KAAK,OAAQ,aAClBvoE,EAAK8c,MAAM9B,IAAI,OAAQ,MAGpB4D,EAASmsF,aACZ/qG,EAAKuoE,KAAK,OAAQ,oBAClBvoE,EAAK8hD,QAAQnnC,IAAI,sBACjBiE,EAASu4D,KAAO,YAGZv4D,EAASkrF,SAAYlrF,EAASmsF,YAClC/qG,EAAK8hD,QAAQnnC,IAAI,oBAGlB3a,EAAKid,GAAG,YAAa,SAASnmB,GAC7BA,EAAEgI,mBAGC8f,EAASwjF,OAASxjF,EAAS8uF,cAC9B1tG,EAAKuoE,KAAK,YAAY,IAUxBolC,SAAU,WACT,QAAS53G,KAAK6oB,SAASwjF,MAQxBC,SAAU,WACT,GAA2CD,GAAvCpiG,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,SAAgBxQ,EAASpO,EAAKoO,QAQ/D,IANAA,EAAOqI,QAAQrB,KAAK,SAAS67B,GACxBA,IAASjxC,GACZixC,EAAKq8D,aAIH1uF,EAASwjF,KAAM,CAClBA,EAAOpiG,EAAKoiG,KAEPA,EAsCJA,EAAKhlF,QArCLglF,EAAOxjF,EAASwjF,KAGZA,EAAKnwG,OACRmwG,GACCnkG,KAAM,OACNwY,MAAO2rF,GAGRA,EAAKnkG,KAAOmkG,EAAKnkG,MAAQ,OAGtBmQ,EAAOwQ,SAASirF,eACnBzH,EAAKyH,aAAez7F,EAAOwQ,SAASirF,cAGrCzH,EAAOpiG,EAAKoiG,KAAOz2B,EAAQ93E,OAAOuuG,GAAMh0F,OAAOpO,GAAM8oE,WACrDs5B,EAAKv/B,SACLu/B,EAAKnlF,GAAG,SAAU,SAASnmB,GAC1BA,EAAEmI,kBACFe,EAAK+S,QACLqvF,EAAK/kF,SAEN+kF,EAAKnlF,GAAG,YAAa,SAASnmB,GAC7BA,EAAE0qE,QAAQ/qD,QAAQrB,KAAK,SAAS67B,GAC/BA,EAAKi0B,OAAOj0B,EAAKryB,SAASrL,cAEzBtR,KAAK,QAERmgG,EAAKnlF,GAAG,OAAQ,SAASnmB,GACpBA,EAAE0qE,UAAY4gC,GACjBpiG,EAAK8hD,QAAQlmC,OAAO,cAItBwmF,EAAK/2B,SAAU,GAKhB+2B,EAAKwL,YAAcx/F,EAEnBg0F,EAAKtgD,QAAQnnC,IAAI,WAEjB,IAAItnB,GAAM+uG,EAAKpyB,YACdhwE,EAAKyjE,QACLzjE,EAAK0kE,SAAW,QAAS,QAAS,QAAS,UAAY,QAAS,QAAS,QAAS,SAGnF09B,GAAKlyB,QAAQlwE,EAAKyjE,QAASpwE,GAC3B+uG,EAAK/uG,IAAMA,EAEXA,EAAM,YAAcA,EACpB+uG,EAAKtgD,QAAQlmC,OAAOwmF,EAAKyL,UAAUlzF,IAAItnB,GACvC+uG,EAAKyL,SAAWx6G,EAEhB2M,EAAK8hD,QAAQnnC,IAAI,YACjB3a,EAAKuoE,KAAK,YAAY,KASxB+kC,SAAU,WACT,GAAIttG,GAAOjK,IAaX,OAXIiK,GAAKoiG,OACRpiG,EAAKoiG,KAAK3rF,QAAQrB,KAAK,SAASK,GAC3BA,EAAK63F,UACR73F,EAAK63F,aAIPttG,EAAKoiG,KAAK/kF,OACVrd,EAAKuoE,KAAK,YAAY,IAGhBvoE,GASR4oE,WAAY,WAKX,QAASklC,GAAgBvsB,GACxB,GAAIvvF,GAAGsF,EAAOmN,IAiBd,KAdCA,EADGhI,EAAI5B,KAEN4mF,IAAK,WACLxwC,KAAM,WACNtrC,MAAO,WACP+7E,KAAM,aAINA,KAAM,QAIRH,EAAWA,EAAS1uF,MAAM,KAErBb,EAAI,EAAGA,EAAIuvF,EAAStvF,OAAQD,IAChCsF,EAAQmN,EAAQ88E,EAASvvF,GAAGsS,eAExBhN,IACHiqF,EAASvvF,GAAKsF,EAIhB,OAAOiqF,GAASx8E,KAAK,KA9BtB,GAAI/E,GAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAKhkD,EAAW5e,EAAK4e,SAAUqB,EAASjgB,EAAKwkE,YAAahyD,EAAOxS,EAAK0gB,OAAO1gB,EAAK8c,MAAM/B,IAAI,SACnHo8D,EAAOn3E,EAAK4e,SAASu4D,KAAM9iE,EAAQ,GAAIktE,EAAW3iE,EAAS2iE,QA8C/D,OAdIpK,IACHn3E,EAAKoO,SAAS0zC,QAAQnnC,IAAI,kBAGvBiE,EAASvK,QACZA,EAAQ,mCAAqCuK,EAASvK,MAAQ,QAG3DktE,IACHA,EAAWusB,EAAgBvsB,IAG5BpK,EAAOl3D,EAAS,OAASA,EAAS,MAAQjgB,EAAK4e,SAASu4D,MAAQ,QAG/D,YAAc5kF,EAAK,YAAcyN,EAAK8hD,QAAU,oBACrC,MAATtvC,EAAe,aAAe2kE,EAAO,IAAM9iE,EAAQ,SAAgB,KAC1D,MAAT7B,EAAe,aAAejgB,EAAK,iBAAmB0tB,EAAS,SAAWzN,EAAO,UAAY,KAC7F+uE,EAAW,YAAchvF,EAAK,qBAAuB0tB,EAAS,kBAAoBshE,EAAW,SAAW,KACxG3iE,EAASwjF,KAAO,eAAiBniF,EAAS,gBAAkB,IAC9D,UASF4oD,WAAY,WACX,GAAI7oE,GAAOjK,KAAM6oB,EAAW5e,EAAK4e,SAE7BmrF,EAAYnrF,EAASmrF,SAKzB,IAJwB,kBAAbA,KACVA,EAAYA,EAAU7yG,KAAKnB,OAGxBg0G,EAAW,CACd,GAAIgE,GAAU/tG,EAAKyjE,MAAM,OACrBsqC,IACHA,EAAQppG,aAAa,QAASolG,GAyBhC,MArBA/pG,GAAKid,GAAG,mBAAoB,SAASnmB,GAChCA,EAAE0qE,UAAYxhE,IACZ4e,EAASwjF,MAAmB,UAAXtrG,EAAEmH,MAQvB+B,EAAKqiG,WAEDvrG,EAAEyxE,MACLvoE,EAAKoiG,KAAKrvF,OAAM,KAVjB/S,EAAKiC,KAAK,UAGVzF,EAAM7D,sBAAsB,WAC3BqH,EAAKoO,SAAS0jE,gBAYlB9xE,EAAKs+D,SAEEt+D,GAGRguG,MAAO,WACN,GAAIhuG,GAAOjK,IAQX,OANAiK,GAAKoO,SAASqI,QAAQrB,KAAK,SAAS67B,GACnCA,EAAK6Q,QAAQlmC,OAAO,cAGrB5b,EAAK8hD,QAAQoH,OAAO,YAAY,GAEzBlpD,GAGRklE,OAAQ,SAASpoD,GAKhB,MAJoB,mBAATA,IACV/mB,KAAKwyE,KAAK,UAAWzrD,GAGf/mB,KAAKuoE,OAAOxhD,IAQpBlB,OAAQ,WACP7lB,KAAKuoE,SAEDvoE,KAAKqsG,MACRrsG,KAAKqsG,KAAKxmF,cAwBdtpB,EAAO,uBACN,uBACA,qBACA,sBACE,SAASu8B,EAAG01C,EAAS/nE,GAUvB,MAAO,UAAS8e,EAAK0oB,GACpB,GAAiBlnB,GAA0C/iB,EAAvDiG,EAAOjK,KAAayuE,EAAcD,EAAQC,WAU9CxkE,GAAKod,KAAO,SAASnkB,EAAMpH,GAC1B,QAASm3E,KACHlsD,IACH+R,EAAEvT,GAAKO,OACN,eAAiB2oD,EAAc,YAAcxgC,EAAS,IAAMwgC,EAAc,kBAAoB,IAAM,YAGjG3yE,GACHA,KAeJ,MAVAmO,GAAKqd,OAELP,GAAQ,EAEJ7jB,EACHc,EAAQyC,EAAM5E,WAAWoxE,EAAQ/vE,GAEjC+vE,IAGMhpE,GASRA,EAAKqd,KAAO,WACX,GAAImF,GAAQlH,EAAIpJ,SAUhB,OARA1V,GAAMnD,aAAaU,GAEfyoB,GAASA,EAAMnU,UAAU1S,QAAQ,iBACpC6mB,EAAM5gB,WAAWoE,YAAYwc,GAG9B1F,GAAQ,EAED9c,MAwBV1N,EAAO,mBACN,wBACA,sBACA,sBACA,sBACE,SAASu/E,EAAYo8B,EAAUC,EAAUp2F,GAG3C,MAAO+5D,GAAWz6D,QACjBwnD,UACC8N,YAAa,WACb/qD,OAAQ,EACRsqD,OAAQ,QACRlH,KAAM,cACNiO,SAAU,OACVnI,UAAU,GASXxxD,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAUX,IARA6oB,EAASyyD,UAAW,EACpBzyD,EAAS4xD,qBAAsB,EAED,kBAAnB5xD,GAASnI,QACnBmI,EAASuvF,aAAevvF,EAASnI,MACjCmI,EAASnI,UAGNmI,EAASirF,aAGZ,IAFA,GAAIpzF,GAAQmI,EAASnI,MAAOzkB,EAAIykB,EAAMxkB,OAE/BD,KACNykB,EAAMzkB,GAAK8lB,EAAMV,UAAWwH,EAASirF,aAAcpzF,EAAMzkB,GAI3DgO,GAAKs+D,OAAO1/C,GACZ5e,EAAK8hD,QAAQnnC,IAAI,SAQlB4sD,QAAS,WAQR,MAPAxxE,MAAK+rD,QAAQoH,OAAO,cAAc,GAElCnzD,KAAKuoE,SAELvoE,KAAK0tE,QAAQloD,MAAM9lB,OAAS,GAC5BM,KAAK0tE,MAAM,QAAQloD,MAAM9lB,OAAS,GAE3BM,MAQRyM,OAAQ,WACP,GAAIxC,GAAOjK,IAEXiK,GAAK8xE,UACL9xE,EAAKiC,KAAK,WAQX6qB,KAAM,WAGL,QAASshF,KACJpuG,EAAKquG,WACRruG,EAAKquG,SAAShxF,OACdrd,EAAKquG,SAAW,MALlB,GAAiBp1G,GAAMq1G,EAAnBtuG,EAAOjK,IASXu4G,GAAUtuG,EAAK4e,SAASuvF,aACnBG,IAIAtuG,EAAKquG,WACTruG,EAAKquG,SAAW,GAAIH,GAASluG,EAAKyjE,MAAM,UAAS,IAErB,IAAxBzjE,EAAKyW,QAAQxkB,QAChB+N,EAAKquG,SAASjxF,OACdpd,EAAKiC,KAAK,YAEVjC,EAAKquG,SAASjxF,KAAK,IAAK,WACvBpd,EAAKyW,QAAQmF,SACb5b,EAAKiC,KAAK,aAIZjC,EAAKid,GAAG,aAAcmxF,IAGvBpuG,EAAKuuG,YAAct1G,GAAO,GAAI8H,OAAO2sB,UAErC1tB,EAAK4e,SAASuvF,aAAa,SAAS13F,GACnC,MAAqB,KAAjBA,EAAMxkB,WACT+N,GAAKqd,YAIFrd,EAAKuuG,cAAgBt1G,IAIzB+G,EAAKyjE,QAAQloD,MAAM/lB,MAAQ,GAC3BwK,EAAKyjE,MAAM,QAAQloD,MAAM/lB,MAAQ,GAEjC44G,IACApuG,EAAKyW,QAAQmF,SACb5b,EAAKyjE,MAAM,QAAQ30D,UAAY,GAE/B9O,EAAK2a,IAAIlE,GACTzW,EAAK2sE,YACL3sE,EAAKiC,KAAK,gBASZ6vE,QAAS,WACR,GAAI9xE,GAAOjK,IAIX,OAFAA,MAAK8U,KAAK,YAAYnP,KAAK,YAEpBsE,EAAKs+D,UAQbyK,UAAW,WACV,GAAI/oE,GAAOjK,IAmBX,OAjBAiK,GAAKyW,QAAQrB,KAAK,SAAS67B,GAC1B,GAAIryB,GAAWqyB,EAAKryB,QAEpB,IAAIA,EAASu4D,MAAQv4D,EAASvK,OAASuK,EAASmsF,WAE/C,MADA/qG,GAAKwuG,WAAY,GACV,IAILxuG,EAAK4e,SAASuvF,cACjBnuG,EAAKid,GAAG,aAAc,WACjBjd,EAAK4e,SAASuvF,cACjBnuG,EAAK8sB,SAKD9sB,EAAKs+D,cAwBfhsE,EAAO,sBACN,wBACA,mBACE,SAAS86G,EAAYqB,GAGvB,MAAOrB,GAAWh2F,QAQjBiC,KAAM,SAASuF,GAGd,QAAS8vF,GAAYC,GAEpB,IAAK,GAAI38G,GAAI,EAAGA,EAAI28G,EAAW18G,OAAQD,IAAK,CAG3C,GAFAuhB,EAAWo7F,EAAW38G,GAAGuhB,UAAYqL,EAAStnB,QAAUq3G,EAAW38G,GAAGsF,MAKrE,MAFAs3G,GAAeA,GAAgBD,EAAW38G,GAAGwgB,KAC7CxS,EAAK8c,MAAM9B,IAAI,QAAS2zF,EAAW38G,GAAGsF,QAC/B,CAIR,IAAIq3G,EAAW38G,GAAGowG,MACbsM,EAAYC,EAAW38G,GAAGowG,MAC7B,OAAO,GAhBX,GAAiB1pG,GAAQ6a,EAAUq7F,EAAcC,EAA7C7uG,EAAOjK,IAsBXiK,GAAKs+D,OAAO1/C,GACZA,EAAW5e,EAAK4e,SAEhB5e,EAAK8uG,QAAUp2G,EAASkmB,EAASlmB,OAC7BA,IAC0B,mBAAlBkmB,GAAStnB,OACnBo3G,EAAYh2G,IAIR6a,GAAY7a,EAAOzG,OAAS,IAChC28G,EAAel2G,EAAO,GAAG8Z,KACzBxS,EAAK8c,MAAM9B,IAAI,QAAStiB,EAAO,GAAGpB,QAGnC0I,EAAK8c,MAAM9B,IAAI,OAAQtiB,IAGxBsH,EAAK8c,MAAM9B,IAAI,OAAQ4D,EAASpM,MAAQo8F,GAExC5uG,EAAK8hD,QAAQnnC,IAAI,WAEjB3a,EAAKid,GAAG,SAAU,SAASnmB,GAC1B,GAAIm6C,GAAOn6C,EAAE0qE,OAETqtC,KACH/3G,EAAEi4G,YAAcF,GAGbjwF,EAASowF,SACZ/9D,EAAKi0B,QAAQj0B,EAAKi0B,UAElBllE,EAAK1I,MAAMR,EAAE0qE,QAAQlqE,SAGtBu3G,EAAe59D,KAWjBq4B,WAAY,WAGX,QAAS2lC,GAAyB7M,EAAM9qG,GACnC8qG,YAAgBqM,IACnBrM,EAAK3rF,QAAQrB,KAAK,SAAS67B,GACrBA,EAAK08D,YACT18D,EAAKi0B,OAAOj0B,EAAK35C,UAAYA,KAMjC,QAAS43G,GAAgBP,EAAYr3G,GACpC,GAAI63G,EAEJ,IAAKR,EAIL,IAAK,GAAI38G,GAAI,EAAGA,EAAI28G,EAAW18G,OAAQD,IAAK,CAC3C,GAAI28G,EAAW38G,GAAGsF,QAAUA,EAC3B,MAAOq3G,GAAW38G,EAGnB,IAAI28G,EAAW38G,GAAGowG,OACjB+M,EAAeD,EAAgBP,EAAW38G,GAAGowG,KAAM9qG,IAElD,MAAO63G,IA3BX,GAAInvG,GAAOjK,IA+CX,OAdAiK,GAAKid,GAAG,OAAQ,SAASnmB,GACxBm4G,EAAyBn4G,EAAE0qE,QAASxhE,EAAK1I,WAG1C0I,EAAK8c,MAAMG,GAAG,eAAgB,SAASnmB,GACtC,GAAIq4G,GAAeD,EAAgBlvG,EAAK8c,MAAM/B,IAAI,QAASjkB,EAAEQ,MAEzD63G,GACHnvG,EAAKwS,KAAK28F,EAAa38F,MAEvBxS,EAAKwS,KAAKxS,EAAK4e,SAASpM,QAInBxS,EAAKs+D,cAwBfhsE,EAAO,oBACN,uBACE,SAAS88G,GAGX,MAAOA,GAASh4F,QACfwnD,UACC9c,QAAS,QACTijB,KAAM,aAwBTzyE,EAAO,2BACN,oBACA,yBACE,SAASwkF,EAAQhJ,GAGnB,MAAOgJ,GAAO1/D,QAObwxD,WAAY,WACX,GAAI5oE,GAAOjK,KAAMkqB,EAASjgB,EAAKwkE,WAU/B,OARAxkE,GAAK8hD,QAAQnnC,IAAI,gBAEc,QAA3B3a,EAAK4e,SAASyyC,WACjBrxD,EAAK8hD,QAAQnnC,IAAI,qBAGlB3a,EAAKuqE,UAAW,EAGf,YAAcvqE,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,eACtC7hC,EAAS,OAASA,EAAS,wBAU7C4oD,WAAY,WACX,GAAI7oE,GAAOjK,IAEXiK,GAAKs+D,SAELt+D,EAAKqvG,iBAAmB,GAAIvhC,GAAW/3E,KAAK6sE,KAC3C5wD,MAAO,WACNhS,EAAKiC,KAAK,gBAGXwrE,KAAM,SAAS32E,GACiB,QAA3BkJ,EAAK4e,SAASyyC,YACjBv6D,EAAEq8C,OAAS,GAGZnzC,EAAKiC,KAAK,SAAUnL,IAGrBoD,KAAM,WACL8F,EAAKiC,KAAK,iBAKb2Z,OAAQ,WAKP,MAJI7lB,MAAKs5G,kBACRt5G,KAAKs5G,iBAAiB9sG,UAGhBxM,KAAKuoE,cAwBfhsE,EAAO,wBACN,qBACE,SAASwkF,GAGX,QAASw4B,GAAcC,GACtB,GAAIC,GAAa,EACjB,IAAID,EACH,IAAK,GAAIv9G,GAAI,EAAGA,EAAIu9G,EAAQt9G,OAAQD,IACnCw9G,GAAc,kBAAoBD,EAAQv9G,GAAK,KAAOu9G,EAAQv9G,GAAK,WAGrE,OAAOw9G,GAGR,MAAO14B,GAAO1/D,QACbwnD,UACC9c,QAAS,YACTijB,KAAM,YACNwqC,YASDl2F,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GAER5e,EAAK4e,SAASJ,OACjBxe,EAAKwe,KAAOxe,EAAK4e,SAASJ,MAGvBxe,EAAK4e,SAAS2wF,UACjBvvG,EAAKyvG,SAAWzvG,EAAK4e,SAAS2wF,SAG/BvvG,EAAKid,GAAG,UAAW,SAASnmB,GAC3B,GAAI6yE,EAEa,KAAb7yE,EAAEg2D,UACLh2D,EAAEgI,iBAGFkB,EAAK2d,UAAUjF,UAAUtD,KAAK,SAAS67B,GACtC,GAAIA,EAAKg8B,OAER,MADAtD,GAAc14B,GACP,IAKTjxC,EAAKiC,KAAK,UAAWxE,KAAMksE,EAAYsD,eAY1CsiC,QAAS,SAASzyF,GACjB,MAAKpqB,WAAUT,QAIf8D,KAAK+mB,MAAM9B,IAAI,UAAW8B,GAEnB/mB,MALCA,KAAK+mB,MAAM/B,IAAI,YAQxB6tD,WAAY,WACX,GAAiB2mC,GAAbvvG,EAAOjK,KAAeyoB,EAAO,EAQjC,OANA+wF,GAAUD,EAActvG,EAAKyvG,UAEzBzvG,EAAKwe,OACRA,EAAO,YAAcxe,EAAKwe,KAAO,KAIjC,eAAiBxe,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,IAAMtjC,EAAO,IACrE+wF,EACD,aAIFjmC,WAAY,WACX,GAAItpE,GAAOjK,IAMX,OAJAiK,GAAK8c,MAAMG,GAAG,iBAAkB,SAASnmB,GACxCkJ,EAAKyjE,QAAQ30D,UAAYwgG,EAAcx4G,EAAEQ,SAGnC0I,EAAKs+D,cAwBfhsE,EAAO,qBACN,oBACA,wBACA,uBACE,SAASwkF,EAAQhJ,EAAY3yB,GAG/B,QAASo1B,GAAUj5E,EAAOo4G,EAAQC,GASjC,MARIr4G,GAAQo4G,IACXp4G,EAAQo4G,GAGLp4G,EAAQq4G,IACXr4G,EAAQq4G,GAGFr4G,EAGR,QAASs4G,GAAYt2F,EAAI3c,EAAMrF,GAC9BgiB,EAAG3U,aAAa,QAAUhI,EAAMrF,GAGjC,QAASu4G,GAAmB5+D,EAAM35C,GACjC,GAAIw4G,GAAcC,EAAe3hC,EAAU4hC,EAAcC,EAAYC,CAEpC,MAA7Bj/D,EAAKryB,SAASuxF,aACjBH,EAAe,MACf5hC,EAAW,SACX2hC,EAAgB,MAEhBC,EAAe,OACf5hC,EAAW,QACX2hC,EAAgB,KAGjBG,EAAWj/D,EAAKwyB,MAAM,UACtBqsC,GAAgB7+D,EAAK00B,aAAaoqC,IAAkB,KAAO50D,EAASppB,QAAQm+E,GAAU9hC,GAEtF6hC,EAAcH,IAAiBx4G,EAAQ25C,EAAKm/D,YAAcn/D,EAAKo/D,UAAYp/D,EAAKm/D,YAAe,KAC/FF,EAAS30F,MAAMy0F,GAAgBC,EAC/BC,EAAS30F,MAAM9lB,OAASw7C,EAAK00B,aAAalyE,EAAI,KAE9Cm8G,EAAYM,EAAU,WAAY54G,GAClCs4G,EAAYM,EAAU,YAAa,GAAKj/D,EAAKryB,SAAS0xF,cAAch5G,IACpEs4G,EAAYM,EAAU,WAAYj/D,EAAKm/D,WACvCR,EAAYM,EAAU,WAAYj/D,EAAKo/D,WAGxC,MAAOv5B,GAAO1/D,QACbiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEN6oB,GAAS0xF,gBACb1xF,EAAS0xF,cAAgB,SAASh5G,GACjC,MAAO5B,MAAK9B,MAAc,IAAR0D,GAAe,MAInC0I,EAAKs+D,OAAO1/C,GACZ5e,EAAK8hD,QAAQnnC,IAAI,UAEW,KAAxBiE,EAASuxF,aACZnwG,EAAK8hD,QAAQnnC,IAAI,YAGlB3a,EAAKowG,UAAYxxF,EAAS2xF,UAAY,EACtCvwG,EAAKqwG,UAAYzxF,EAAS4xF,UAAY,IACtCxwG,EAAKywG,WAAazwG,EAAK8c,MAAM/B,IAAI,UAGlC6tD,WAAY,WACX,GAAI5oE,GAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,WAE9C,OACC,YAAcjyE,EAAK,YAAcyN,EAAK8hD,QAAU,cACjCvvD,EAAK,mBAAqB0tB,EAAS,2DAKpD1L,MAAO,WACNxe,KAAKuB,MAAMvB,KAAK06G,YAAYlpC,WAG7BsB,WAAY,WAIX,QAAS6nC,GAAWh8G,EAAKD,EAAK6D,GAC7B,OAAQA,EAAM5D,IAAQD,EAAMC,GAG7B,QAASi8G,GAAaj8G,EAAKD,EAAK6D,GAC/B,MAAQA,IAAO7D,EAAMC,GAAQA,EAG9B,QAASk8G,GAAeL,EAAUC,GACjC,QAASK,GAAMC,GACd,GAAIx5G,EAEJA,GAAQ0I,EAAK1I,QACbA,EAAQq5G,EAAaJ,EAAUC,EAAUE,EAAWH,EAAUC,EAAUl5G,GAAkB,IAARw5G,GAClFx5G,EAAQi5E,EAAUj5E,EAAOi5G,EAAUC,GAEnCxwG,EAAK1I,MAAMA,GAEX0I,EAAKiC,KAAK,aAAc3K,MAAOA,IAC/B0I,EAAKiC,KAAK,QAAS3K,MAAOA,IAC1B0I,EAAKiC,KAAK,WAAY3K,MAAOA,IAG9B0I,EAAKid,GAAG,UAAW,SAASnmB,GAC3B,OAAQA,EAAEg2D,SACT,IAAK,IACL,IAAK,IACJ+jD,KACA,MAED,KAAK,IACL,IAAK,IACJA,EAAM,MAMV,QAASE,GAAWR,EAAUC,EAAUN,GACvC,GAAI/7D,GAAU68D,EAAgBlB,EAAcmB,EAAW35G,CAEvD0I,GAAKkxG,YAAc,GAAIpjC,GAAW9tE,EAAK4iE,KACtCtsE,OAAQ0J,EAAK4iE,IAAM,UAEnB5wD,MAAO,SAASlb,GACfq9C,EAAWr9C,EAAEq6G,GACbH,EAAiB9xF,SAASlf,EAAKyjE,MAAM,UAAUloD,MAAMy0F,GAAe,IACpEF,GAAgB9vG,EAAK2lE,aAAaoqC,IAAkB,KAAO50D,EAASppB,QAAQm+E,GAAU9hC,GACtFpuE,EAAKiC,KAAK,aAAc3K,MAAOA,KAGhCm2E,KAAM,SAAS32E,GACd,GAAIg6G,GAAQh6G,EAAEq6G,GAAkBh9D,CAEhC88D,GAAY1gC,EAAUygC,EAAiBF,EAAO,EAAGhB,GACjDI,EAAS30F,MAAMy0F,GAAgBiB,EAAY,KAE3C35G,EAAQi5G,EAAYU,EAAYnB,GAAiBU,EAAWD,GAC5DvwG,EAAK1I,MAAMA,GAEX0I,EAAK62E,UAAUrkE,KAAK,GAAKxS,EAAK4e,SAAS0xF,cAAch5G,IAAQ8lB,OAAO8yD,QAAQggC,EAAU,SAEtFlwG,EAAKiC,KAAK,QAAS3K,MAAOA,KAG3B4C,KAAM,WACL8F,EAAK62E,UAAUx5D,OACfrd,EAAKiC,KAAK,WAAY3K,MAAOA,OAtEhC,GAAiBi5G,GAAUC,EAAUW,EACnCnB,EAAc5hC,EAAU2hC,EADtB/vG,EAAOjK,IA2EXw6G,GAAWvwG,EAAKowG,UAChBI,EAAWxwG,EAAKqwG,UAEiB,KAA7BrwG,EAAK4e,SAASuxF,aACjBgB,EAAiB,UACjBnB,EAAe,MACf5hC,EAAW,SACX2hC,EAAgB,MAEhBoB,EAAiB,UACjBnB,EAAe,OACf5hC,EAAW,QACX2hC,EAAgB,KAGjB/vG,EAAKs+D,SAELsyC,EAAeL,EAAUC,EAAUxwG,EAAKyjE,MAAM,WAC9CstC,EAAWR,EAAUC,EAAUxwG,EAAKyjE,MAAM,YAG3C8D,QAAS,WACRxxE,KAAKuoE,SACLuxC,EAAmB95G,KAAMA,KAAKuB,UAG/BgyE,WAAY,WACX,GAAItpE,GAAOjK,IAMX,OAJAiK,GAAK8c,MAAMG,GAAG,eAAgB,SAASnmB,GACtC+4G,EAAmB7vG,EAAMlJ,EAAEQ,SAGrB0I,EAAKs+D,cAwBfhsE,EAAO,qBACN,qBACE,SAASwkF,GAGX,MAAOA,GAAO1/D,QAObwxD,WAAY,WACX,GAAI5oE,GAAOjK,IAKX,OAHAiK,GAAK8hD,QAAQnnC,IAAI,UACjB3a,EAAKuqE,UAAW,EAET,YAAcvqE,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,gBAwBhExvD,EAAO,0BACN,wBACA,sBACA,wBACE,SAAS86G,EAAYjyD,EAAUtsB,GACjC,MAAOu+E,GAAWh2F,QACjBwnD,UACC9c,QAAS,sBACTijB,KAAM,UAQPwC,QAAS,WACR,GAA+D6pC,GAAeC,EAA1ErxG,EAAOjK,KAAMulB,EAAMtb,EAAKyjE,QAAStwE,EAAO6M,EAAK2lE,YAgBjD,OAdA3lE,GAAKs+D,SAEL8yC,EAAgB91F,EAAI3K,WACpB0gG,EAAgB/1F,EAAIpJ,UAEpB2c,EAAEuiF,GAAel2F,KAChB1lB,MAAOrC,EAAKK,EAAI2nD,EAASppB,QAAQs/E,GAAe77G,MAChDC,OAAQtC,EAAKM,EAAI,IAGlBo7B,EAAEwiF,GAAen2F,KAChBzlB,OAAQtC,EAAKM,EAAI,IAGXuM,GAQRutG,WAAY,SAASzwF,GACpB,GAAI9c,GAAOjK,IAEX84B,GAAE7uB,EAAKyjE,QAAQvxD,WAAW0K,YAAY5c,EAAKwkE,YAAc,SAAU1nD,IASpE8rD,WAAY,WACX,GAA2Dv0D,GAAvDrU,EAAOjK,KAAMxD,EAAKyN,EAAK4iE,IAAK3iD,EAASjgB,EAAKwkE,YAC1C2S,EAAOn3E,EAAK8c,MAAM/B,IAAI,QAASvI,EAAOxS,EAAK8c,MAAM/B,IAAI,QACxD+mF,EAAW,EAuBZ,OArBAztF,GAAQrU,EAAK4e,SAASvK,MAClBA,GACH8iE,EAAO,OAGa,gBAAT9iE,KACVA,EAAQ5c,OAAO2E,aAAeiY,EAAM,GAAKA,EAAM,IAGhDA,EAAQ,mCAAqCA,EAAQ,QAErDA,EAAQ,GAGT8iE,EAAOn3E,EAAK4e,SAASu4D,KAAOl3D,EAAS,OAASA,EAAS,KAAOk3D,EAAO,GAEjE3kE,IACHxS,EAAK8hD,QAAQnnC,IAAI,gBACjBmnF,EAAW,gBAAkB7hF,EAAS,QAAUjgB,EAAK0gB,OAAOlO,GAAQ,WAIpE,YAAcjgB,EAAK,YAAcyN,EAAK8hD,QAAU,oFAE7Cq1B,EAAO,aAAeA,EAAO,IAAM9iE,EAAQ,QAAU,IACtDytF,EACD,yCACkC7hF,EAAS,sCAEzCjgB,EAAKsxG,cAAgBn6B,EAAO,IAAW,IAAMn3E,EAAKsxG,aAAe,IAClE,cAAgBrxF,EAAS,8BAW7B4oD,WAAY,WACX,GAAI7oE,GAAOjK,KAAM0tG,EAAiBzjG,EAAK4e,SAAS03D,OAyBhD,OAvBAt2E,GAAKid,GAAG,QAAS,SAASnmB,GACzB,GAAImX,GAAOnX,EAAEnE,MAEb,IAAImE,EAAE0qE,SAAWzrE,KAEhB,KAAOkY,GAAM,CACZ,GAAKnX,EAAEyxE,MAAsB,QAAdzxE,EAAEyxE,KAAKhjE,KAAoC,UAAjB0I,EAAK5J,UAAwB4J,EAAKI,UAAU1S,QAAQ,YAO5F,MANA7E,GAAEsI,gCAEEqkG,GACHA,EAAevsG,KAAKnB,KAAMe,GAM5BmX,GAAOA,EAAKrM,oBAKR5B,GAAK4e,SAAS03D,QAEdt2E,EAAKs+D,cAwBfhsE,EAAO,0BACN,yBACE,SAASi/G,GAGX,MAAOA,GAAWn6F,QACjBwnD,UACC0iC,eAAgB,eAChBI,aAAc,oBACdsH,SAAU,SAGX3pC,SAAU,WACT,OAAO,OA0BV/sE,EAAO,uBACN,mBACA,uBACA,uBACE,SAASw+E,EAAOjiD,EAAGssB,GAGrB,MAAO21B,GAAM15D,QACZwnD,UACCqN,OAAQ,WACR5tD,UACCpgB,KAAM,UAURuzG,YAAa,SAASp/F,GACrB,GAAIq/F,EAEA17G,MAAK27G,cACRD,EAAe17G,KAAK0tE,MAAM1tE,KAAK27G,aAC/B7iF,EAAE4iF,GAAc50F,YAAY9mB,KAAKyuE,YAAc,UAC/CitC,EAAa9sG,aAAa,gBAAiB,UAG5C5O,KAAK27G,YAAc,IAAMt/F,EAEzBq/F,EAAe17G,KAAK0tE,MAAM,IAAMrxD,GAChCq/F,EAAa9sG,aAAa,gBAAiB,QAC3CkqB,EAAE4iF,GAAc90F,SAAS5mB,KAAKyuE,YAAc,UAE5CzuE,KAAK0gB,QAAQrE,GAAKgL,OAAOnb,KAAK,WAC9BlM,KAAK8sE,SAEL9sE,KAAK0gB,QAAQrB,KAAK,SAASK,EAAMzjB,GAC5BogB,GAAOpgB,GACVyjB,EAAK4H,UAWRurD,WAAY,WACX,GAAI5oE,GAAOjK,KAAMk2E,EAASjsE,EAAK2iE,QAASgvC,EAAW,GAAI1xF,EAASjgB,EAAKwkE,WAmBrE,OAjBAxkE,GAAK+oE,YACLkD,EAAOlD,UAAU/oE,GAEjBA,EAAKyW,QAAQrB,KAAK,SAAS67B,EAAMj/C,GAChC,GAAIO,GAAKyN,EAAK4iE,IAAM,KAAO5wE,CAE3Bi/C,GAAKs3B,KAAK,OAAQ,YAClBt3B,EAAKs3B,KAAK,aAAch2E,GAExBo/G,GACC,YAAcp/G,EAAK,YAAc0tB,EAAS,oDACQgxB,EAAK2xB,IAAM,yCAC5D5iE,EAAK0gB,OAAOuwB,EAAKryB,SAASq1D,OAC3B,WAKD,YAAcj0E,EAAK4iE,IAAM,YAAc5iE,EAAK8hD,QAAU,0CACvC9hD,EAAK4iE,IAAM,iBAAmB3iD,EAAS,wBACpD0xF,EACD,kBACc3xG,EAAK4iE,IAAM,iBAAmB5iE,EAAK+rE,YAAc,KAC9DE,EAAOrD,WAAW5oE,GACnB;EAUH6oE,WAAY,WACX,GAAI7oE,GAAOjK,IAEXiK,GAAKs+D,SAELt+D,EAAK4e,SAASgzF,UAAY5xG,EAAK4e,SAASgzF,WAAa,EACrD5xG,EAAKwxG,YAAYxxG,EAAK4e,SAASgzF,WAE/B77G,KAAKknB,GAAG,QAAS,SAASnmB,GACzB,GAAI+6G,GAAe/6G,EAAEnE,OAAOiP,UAE5B,IAAI9K,EAAEnE,OAAOiP,WAAWrP,IAAMyN,EAAK4iE,IAAM,QAGxC,IAFA,GAAI5wE,GAAI6/G,EAAa9jG,WAAW9b,OAEzBD,KACF6/G,EAAa9jG,WAAW/b,IAAM8E,EAAEnE,QACnCqN,EAAKwxG,YAAYx/G,MAetB0zE,eAAgB,WACf,GAAiBvyE,GAAM0zE,EAAMC,EAAzB9mE,EAAOjK,IAEX8wE,GAAO1rB,EAASppB,QAAQ/xB,EAAKyjE,MAAM,SAASjuE,MAC5CqxE,EAAOA,EAAO,EAAI,EAAIA,EACtBC,EAAO,EAEP9mE,EAAKyW,QAAQrB,KAAK,SAASK,GAC1BoxD,EAAOnxE,KAAKjB,IAAIoyE,EAAMpxD,EAAKkwD,aAAakB,MACxCC,EAAOpxE,KAAKjB,IAAIqyE,EAAMrxD,EAAKkwD,aAAamB,QAGzC9mE,EAAKyW,QAAQrB,KAAK,SAAS67B,GAC1BA,EAAKryB,SAAStrB,EAAI,EAClB29C,EAAKryB,SAASrrB,EAAI,EAClB09C,EAAKryB,SAASprB,EAAIqzE,EAClB51B,EAAKryB,SAASnrB,EAAIqzE,EAElB71B,EAAK00B,YACJryE,EAAG,EACHC,EAAG,EACHC,EAAGqzE,EACHpzE,EAAGqzE,KAIL,IAAIgrC,GAAQ32D,EAASppB,QAAQ/xB,EAAKyjE,MAAM,SAAShuE,MASjD,OAPAuK,GAAK4e,SAASgnD,SAAWiB,EACzB7mE,EAAK4e,SAASinD,UAAYiB,EAAOgrC,EAEjC3+G,EAAO6M,EAAKs+D,SACZnrE,EAAKgzE,QAAU2rC,EACf3+G,EAAKyzE,OAASzzE,EAAKM,EAAIN,EAAKgzE,OAErBhzE,OAwBVb,EAAO,sBACN,oBACA,qBACA,uBACE,SAASwkF,EAAQh/D,EAAOqjC,GAC1B,MAAO27B,GAAO1/D,QAUbiC,KAAM,SAASuF,GACd,GAAI5e,GAAOjK,IAEXiK,GAAKs+D,OAAO1/C,GAEZ5e,EAAK8hD,QAAQnnC,IAAI,WAEbiE,EAASo2D,UACZh1E,EAAK8hD,QAAQnnC,IAAI,cAEjB3a,EAAKid,GAAG,UAAW,SAASnmB,GAC3B,GAAI6yE,EAEa,KAAb7yE,EAAEg2D,UACLh2D,EAAEgI,iBAGFkB,EAAK2d,UAAUjF,UAAUtD,KAAK,SAAS67B,GACtC,GAAIA,EAAKg8B,OAER,MADAtD,GAAc14B,GACP,IAKTjxC,EAAKiC,KAAK,UAAWxE,KAAMksE,EAAYsD,cAIzCjtE,EAAKid,GAAG,QAAS,SAASnmB,GACzBkJ,EAAK8c,MAAM9B,IAAI,QAASlkB,EAAEnE,OAAO2E,WAUpCiwE,QAAS,WACR,GAAiBhsD,GAAOpoB,EAAMgyE,EAAWuC,EAAsBE,EAA3D5nE,EAAOjK,KAAuC4xE,EAAU,CAE5DpsD,GAAQvb,EAAKyjE,QAAQloD,MACrBpoB,EAAO6M,EAAKwmE,YACZoB,EAAkB5nE,EAAK6nE,oBAGvB,IAAIvpE,GAAM7E,QAgCV,QA/BKuG,EAAK4e,SAASo2D,WAAa12E,EAAIpG,OAASoG,EAAIjC,cAAgBiC,EAAIjC,cAAgB,KACpFkf,EAAMinF,WAAcrvG,EAAKM,EAAIk0E,EAAW,MAGzCxC,EAAYnlE,EAAKmlE,UACjBuC,EAAUvC,EAAU7vE,KAAO6vE,EAAU/kD,MAAQ,EAC7CunD,EAAUxC,EAAU5vE,IAAM4vE,EAAU9kD,QAAUrgB,EAAK4e,SAASo2D,UAAY,EAAI,GAExE7hF,EAAKG,IAAMs0E,EAAgBt0E,IAC9BioB,EAAMjmB,KAAOnC,EAAKG,EAAI,KACtBs0E,EAAgBt0E,EAAIH,EAAKG,GAGtBH,EAAKI,IAAMq0E,EAAgBr0E,IAC9BgoB,EAAMhmB,IAAMpC,EAAKI,EAAI,KACrBq0E,EAAgBr0E,EAAIJ,EAAKI,GAGtBJ,EAAKK,IAAMo0E,EAAgBp0E,IAC9B+nB,EAAM/lB,MAASrC,EAAKK,EAAIk0E,EAAW,KACnCE,EAAgBp0E,EAAIL,EAAKK,GAGtBL,EAAKM,IAAMm0E,EAAgBn0E,IAC9B8nB,EAAM9lB,OAAUtC,EAAKM,EAAIk0E,EAAW,KACpCC,EAAgBn0E,EAAIN,EAAKM,GAG1BuM,EAAK6nE,iBAAmBD,EACxB5nE,EAAKiC,KAAK,cAAe,GAElBjC,GASR4oE,WAAY,WACX,GAA2C1iE,GAAOoV,EAA9Ctb,EAAOjK,KAAM6oB,EAAW5e,EAAK4e,QA0BjC,OAxBA1Y,IACC3T,GAAIyN,EAAK4iE,IACTmvC,UAAW,KAGZj6F,EAAM1C,MACL,OAAQ,aAAc,YAAa,OAAQ,WAAY,MACvD,MAAO,OAAQ,OAAQ,UAAW,cAAe,WAAY,YAC3D,SAASzY,GACXuJ,EAAMvJ,GAAQiiB,EAASjiB,KAGpBqD,EAAKqT,aACRnN,EAAMmN,SAAW,YAGduL,EAAS42D,UACZtvE,EAAMjI,KAAO2gB,EAAS42D,SAGvBl6D,EAAM6/B,EAAStnD,OAAO+qB,EAASo2D,UAAY,WAAa,QAAS9uE,GACjEoV,EAAIhkB,MAAQ0I,EAAK8c,MAAM/B,IAAI,SAC3BO,EAAIjN,UAAYrO,EAAK8hD,QAEdxmC,EAAIwZ,WAGZx9B,MAAO,SAASA,GACf,MAAI5E,WAAUT,QACb8D,KAAK+mB,MAAM9B,IAAI,QAAS1jB,GACjBvB,OAIJA,KAAK+mB,MAAM/B,IAAI,aAClBhlB,KAAK+mB,MAAM9B,IAAI,QAASjlB,KAAK0tE,QAAQnsE,OAG/BvB,KAAK+mB,MAAM/B,IAAI,WAQvB8tD,WAAY,WACX,GAAI7oE,GAAOjK,IAEXiK,GAAKyjE,QAAQnsE,MAAQ0I,EAAK8c,MAAM/B,IAAI,SACpC/a,EAAKs+D,SAELt+D,EAAKqoE,IAAIprD,GAAG,SAAU,SAASnmB,GAC9BkJ,EAAK8c,MAAM9B,IAAI,QAASlkB,EAAEnE,OAAO2E,OACjC0I,EAAKiC,KAAK,SAAUnL,MAItBwyE,WAAY,WACX,GAAItpE,GAAOjK,IAYX,OAVAiK,GAAK8c,MAAMG,GAAG,eAAgB,SAASnmB,GAClCkJ,EAAKyjE,QAAQnsE,OAASR,EAAEQ,QAC3B0I,EAAKyjE,QAAQnsE,MAAQR,EAAEQ,SAIzB0I,EAAK8c,MAAMG,GAAG,kBAAmB,SAASnmB,GACzCkJ,EAAKyjE,QAAQpwD,SAAWvc,EAAEQ,QAGpB0I,EAAKs+D,UAGb1iD,OAAQ,WACP7lB,KAAKsyE,IAAInrD,MACTnnB,KAAKuoE,cAuBRhsE,EAAO,sBACJ,WAEF,GAAI4Q,GAAUnN,MAAQ0B,OAElBwyE,EAAU,WACb,MAAO/mE,GAAQ+mE,QAUhB,OAP8B,kBAAnB/mE,GAAQ5Q,SAEb4Q,EAAQ5Q,OAAO0/G,KACnB9uG,EAAQ5Q,OAAO,mBAAqB23E,SAOvCl3E,GAAQ,oBAAoB,uBAAuB,qBAAqB,cAAc,yBAAyB,qBAAqB,qBAAqB,uBAAuB,sBAAsB,yBAAyB,wBAAwB,uBAAuB,2BAA2B,uBAAuB,yBAAyB,oBAAoB,sBAAsB,yBAAyB,yBAAyB,sBAAsB,0BAA0B,yBAAyB,kBAAkB,+BAA+B,8BAA8B,wBAAwB,oBAAoB,sBAAsB,yBAAyB,mBAAmB,qBAAqB,+BAA+B,0BAA0B,sBAAsB,wBAAwB,yBAAyB,qBAAqB,qBAAqB,gCAAgC,uBAAuB,wBAAwB,wBAAwB,mBAAmB,qBAAqB,uBAAuB,wBAAwB,oBAAoB,wBAAwB,wBAAwB,qBAAqB,oBAAoB,sBAAsB,0BAA0B,8BAA8B,2BAA2B,oBAAoB,iBAAiB,oBAAoB,uBAAuB,wBAAwB,mBAAmB,oBAAoB,2BAA2B,qBAAqB,4BAA4B,iBAAiB,oBAAoB,4BAA4B,oBAAoB,yBAAyB,sBAAsB,sBAAsB,sBAAsB,yBAAyB,yBAAyB,qBAAqB,yBAAyB,kBAAkB,yBAAyB,sBAAsB,kBAAkB,sBAAsB,wBAAwB,uBAAuB,wBAAwB,wBAAwB,4BAA4B,wBAAwB,oBAAoB,qBAAqB,mBAAmB,qBAAqB,qBAAqB,wBAAwB,sBAAsB,sBAAsB,kBAAkB,qBAAqB,mBAAmB,0BAA0B,uBAAuB,oBAAoB,oBAAoB,yBAAyB,yBAAyB,sBAAsB,wBACv3EgD","file":"pageedit.min.js","sourcesContent":["// 4.4.0 (2016-06-30)\r\n\r\n/**\r\n * Compiled inline version. (Library mode)\r\n */\r\n\r\n/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\r\n/*globals $code */\r\n\r\n(function(exports, undefined) {\r\n\t\"use strict\";\r\n\r\n\tvar modules = {};\r\n\r\n\tfunction require(ids, callback) {\r\n\t\tvar module, defs = [];\r\n\r\n\t\tfor (var i = 0; i < ids.length; ++i) {\r\n\t\t\tmodule = modules[ids[i]] || resolve(ids[i]);\r\n\t\t\tif (!module) {\r\n\t\t\t\tthrow 'module definition dependecy not found: ' + ids[i];\r\n\t\t\t}\r\n\r\n\t\t\tdefs.push(module);\r\n\t\t}\r\n\r\n\t\tcallback.apply(null, defs);\r\n\t}\r\n\r\n\tfunction define(id, dependencies, definition) {\r\n\t\tif (typeof id !== 'string') {\r\n\t\t\tthrow 'invalid module definition, module id must be defined and be a string';\r\n\t\t}\r\n\r\n\t\tif (dependencies === undefined) {\r\n\t\t\tthrow 'invalid module definition, dependencies must be specified';\r\n\t\t}\r\n\r\n\t\tif (definition === undefined) {\r\n\t\t\tthrow 'invalid module definition, definition function must be specified';\r\n\t\t}\r\n\r\n\t\trequire(dependencies, function() {\r\n\t\t\tmodules[id] = definition.apply(null, arguments);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction defined(id) {\r\n\t\treturn !!modules[id];\r\n\t}\r\n\r\n\tfunction resolve(id) {\r\n\t\tvar target = exports;\r\n\t\tvar fragments = id.split(/[.\\/]/);\r\n\r\n\t\tfor (var fi = 0; fi < fragments.length; ++fi) {\r\n\t\t\tif (!target[fragments[fi]]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ttarget = target[fragments[fi]];\r\n\t\t}\r\n\r\n\t\treturn target;\r\n\t}\r\n\r\n\tfunction expose(ids) {\r\n\t\tvar i, target, id, fragments, privateModules;\r\n\r\n\t\tfor (i = 0; i < ids.length; i++) {\r\n\t\t\ttarget = exports;\r\n\t\t\tid = ids[i];\r\n\t\t\tfragments = id.split(/[.\\/]/);\r\n\r\n\t\t\tfor (var fi = 0; fi < fragments.length - 1; ++fi) {\r\n\t\t\t\tif (target[fragments[fi]] === undefined) {\r\n\t\t\t\t\ttarget[fragments[fi]] = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttarget = target[fragments[fi]];\r\n\t\t\t}\r\n\r\n\t\t\ttarget[fragments[fragments.length - 1]] = modules[id];\r\n\t\t}\r\n\t\t\r\n\t\t// Expose private modules for unit tests\r\n\t\tif (exports.AMDLC_TESTS) {\r\n\t\t\tprivateModules = exports.privateModules || {};\r\n\r\n\t\t\tfor (id in modules) {\r\n\t\t\t\tprivateModules[id] = modules[id];\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0; i < ids.length; i++) {\r\n\t\t\t\tdelete privateModules[ids[i]];\r\n\t\t\t}\r\n\r\n\t\t\texports.privateModules = privateModules;\r\n\t\t}\r\n\t}\r\n\r\n// Included from: js/tinymce/classes/geom/Rect.js\r\n\r\n/**\r\n * Rect.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Contains various tools for rect/position calculation.\r\n *\r\n * @class tinymce.geom.Rect\r\n */\r\ndefine(\"tinymce/geom/Rect\", [\r\n], function() {\r\n\t\"use strict\";\r\n\r\n\tvar min = Math.min, max = Math.max, round = Math.round;\r\n\r\n\t/**\r\n\t * Returns the rect positioned based on the relative position name\r\n\t * to the target rect.\r\n\t *\r\n\t * @method relativePosition\r\n\t * @param {Rect} rect Source rect to modify into a new rect.\r\n\t * @param {Rect} targetRect Rect to move relative to based on the rel option.\r\n\t * @param {String} rel Relative position. For example: tr-bl.\r\n\t */\r\n\tfunction relativePosition(rect, targetRect, rel) {\r\n\t\tvar x, y, w, h, targetW, targetH;\r\n\r\n\t\tx = targetRect.x;\r\n\t\ty = targetRect.y;\r\n\t\tw = rect.w;\r\n\t\th = rect.h;\r\n\t\ttargetW = targetRect.w;\r\n\t\ttargetH = targetRect.h;\r\n\r\n\t\trel = (rel || '').split('');\r\n\r\n\t\tif (rel[0] === 'b') {\r\n\t\t\ty += targetH;\r\n\t\t}\r\n\r\n\t\tif (rel[1] === 'r') {\r\n\t\t\tx += targetW;\r\n\t\t}\r\n\r\n\t\tif (rel[0] === 'c') {\r\n\t\t\ty += round(targetH / 2);\r\n\t\t}\r\n\r\n\t\tif (rel[1] === 'c') {\r\n\t\t\tx += round(targetW / 2);\r\n\t\t}\r\n\r\n\t\tif (rel[3] === 'b') {\r\n\t\t\ty -= h;\r\n\t\t}\r\n\r\n\t\tif (rel[4] === 'r') {\r\n\t\t\tx -= w;\r\n\t\t}\r\n\r\n\t\tif (rel[3] === 'c') {\r\n\t\t\ty -= round(h / 2);\r\n\t\t}\r\n\r\n\t\tif (rel[4] === 'c') {\r\n\t\t\tx -= round(w / 2);\r\n\t\t}\r\n\r\n\t\treturn create(x, y, w, h);\r\n\t}\r\n\r\n\t/**\r\n\t * Tests various positions to get the most suitable one.\r\n\t *\r\n\t * @method findBestRelativePosition\r\n\t * @param {Rect} rect Rect to use as source.\r\n\t * @param {Rect} targetRect Rect to move relative to.\r\n\t * @param {Rect} constrainRect Rect to constrain within.\r\n\t * @param {Array} rels Array of relative positions to test against.\r\n\t */\r\n\tfunction findBestRelativePosition(rect, targetRect, constrainRect, rels) {\r\n\t\tvar pos, i;\r\n\r\n\t\tfor (i = 0; i < rels.length; i++) {\r\n\t\t\tpos = relativePosition(rect, targetRect, rels[i]);\r\n\r\n\t\t\tif (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x &&\r\n\t\t\t\tpos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\r\n\t\t\t\treturn rels[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Inflates the rect in all directions.\r\n\t *\r\n\t * @method inflate\r\n\t * @param {Rect} rect Rect to expand.\r\n\t * @param {Number} w Relative width to expand by.\r\n\t * @param {Number} h Relative height to expand by.\r\n\t * @return {Rect} New expanded rect.\r\n\t */\r\n\tfunction inflate(rect, w, h) {\r\n\t\treturn create(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the intersection of the specified rectangles.\r\n\t *\r\n\t * @method intersect\r\n\t * @param {Rect} rect The first rectangle to compare.\r\n\t * @param {Rect} cropRect The second rectangle to compare.\r\n\t * @return {Rect} The intersection of the two rectangles or null if they don't intersect.\r\n\t */\r\n\tfunction intersect(rect, cropRect) {\r\n\t\tvar x1, y1, x2, y2;\r\n\r\n\t\tx1 = max(rect.x, cropRect.x);\r\n\t\ty1 = max(rect.y, cropRect.y);\r\n\t\tx2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\r\n\t\ty2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\r\n\r\n\t\tif (x2 - x1 < 0 || y2 - y1 < 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a rect clamped within the specified clamp rect. This forces the\r\n\t * rect to be inside the clamp rect.\r\n\t *\r\n\t * @method clamp\r\n\t * @param {Rect} rect Rectangle to force within clamp rect.\r\n\t * @param {Rect} clampRect Rectable to force within.\r\n\t * @param {Boolean} fixedSize True/false if size should be fixed.\r\n\t * @return {Rect} Clamped rect.\r\n\t */\r\n\tfunction clamp(rect, clampRect, fixedSize) {\r\n\t\tvar underflowX1, underflowY1, overflowX2, overflowY2,\r\n\t\t\tx1, y1, x2, y2, cx2, cy2;\r\n\r\n\t\tx1 = rect.x;\r\n\t\ty1 = rect.y;\r\n\t\tx2 = rect.x + rect.w;\r\n\t\ty2 = rect.y + rect.h;\r\n\t\tcx2 = clampRect.x + clampRect.w;\r\n\t\tcy2 = clampRect.y + clampRect.h;\r\n\r\n\t\tunderflowX1 = max(0, clampRect.x - x1);\r\n\t\tunderflowY1 = max(0, clampRect.y - y1);\r\n\t\toverflowX2 = max(0, x2 - cx2);\r\n\t\toverflowY2 = max(0, y2 - cy2);\r\n\r\n\t\tx1 += underflowX1;\r\n\t\ty1 += underflowY1;\r\n\r\n\t\tif (fixedSize) {\r\n\t\t\tx2 += underflowX1;\r\n\t\t\ty2 += underflowY1;\r\n\t\t\tx1 -= overflowX2;\r\n\t\t\ty1 -= overflowY2;\r\n\t\t}\r\n\r\n\t\tx2 -= overflowX2;\r\n\t\ty2 -= overflowY2;\r\n\r\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new rectangle object.\r\n\t *\r\n\t * @method create\r\n\t * @param {Number} x Rectangle x location.\r\n\t * @param {Number} y Rectangle y location.\r\n\t * @param {Number} w Rectangle width.\r\n\t * @param {Number} h Rectangle height.\r\n\t * @return {Rect} New rectangle object.\r\n\t */\r\n\tfunction create(x, y, w, h) {\r\n\t\treturn {x: x, y: y, w: w, h: h};\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new rectangle object form a clientRects object.\r\n\t *\r\n\t * @method fromClientRect\r\n\t * @param {ClientRect} clientRect DOM ClientRect object.\r\n\t * @return {Rect} New rectangle object.\r\n\t */\r\n\tfunction fromClientRect(clientRect) {\r\n\t\treturn create(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\r\n\t}\r\n\r\n\treturn {\r\n\t\tinflate: inflate,\r\n\t\trelativePosition: relativePosition,\r\n\t\tfindBestRelativePosition: findBestRelativePosition,\r\n\t\tintersect: intersect,\r\n\t\tclamp: clamp,\r\n\t\tcreate: create,\r\n\t\tfromClientRect: fromClientRect\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Promise.js\r\n\r\n/**\r\n * Promise.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * Promise polyfill under MIT license: https://github.com/taylorhakes/promise-polyfill\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/* eslint-disable */\r\n/* jshint ignore:start */\r\n\r\n/**\r\n * Modifed to be a feature fill and wrapped as tinymce module.\r\n */\r\ndefine(\"tinymce/util/Promise\", [], function() {\r\n\tif (window.Promise) {\r\n\t\treturn window.Promise;\r\n\t}\r\n\r\n\t// Use polyfill for setImmediate for performance gains\r\n\tvar asap = Promise.immediateFn || (typeof setImmediate === 'function' && setImmediate) ||\r\n\t\tfunction(fn) { setTimeout(fn, 1); };\r\n\r\n\t// Polyfill for Function.prototype.bind\r\n\tfunction bind(fn, thisArg) {\r\n\t\treturn function() {\r\n\t\t\tfn.apply(thisArg, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\tvar isArray = Array.isArray || function(value) { return Object.prototype.toString.call(value) === \"[object Array]\"; };\r\n\r\n\tfunction Promise(fn) {\r\n\t\tif (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\r\n\t\tif (typeof fn !== 'function') throw new TypeError('not a function');\r\n\t\tthis._state = null;\r\n\t\tthis._value = null;\r\n\t\tthis._deferreds = [];\r\n\r\n\t\tdoResolve(fn, bind(resolve, this), bind(reject, this));\r\n\t}\r\n\r\n\tfunction handle(deferred) {\r\n\t\tvar me = this;\r\n\t\tif (this._state === null) {\r\n\t\t\tthis._deferreds.push(deferred);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tasap(function() {\r\n\t\t\tvar cb = me._state ? deferred.onFulfilled : deferred.onRejected;\r\n\t\t\tif (cb === null) {\r\n\t\t\t\t(me._state ? deferred.resolve : deferred.reject)(me._value);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar ret;\r\n\t\t\ttry {\r\n\t\t\t\tret = cb(me._value);\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tdeferred.reject(e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdeferred.resolve(ret);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction resolve(newValue) {\r\n\t\ttry { //Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\r\n\t\t\tif (newValue === this) throw new TypeError('A promise cannot be resolved with itself.');\r\n\t\t\tif (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\r\n\t\t\t\tvar then = newValue.then;\r\n\t\t\t\tif (typeof then === 'function') {\r\n\t\t\t\t\tdoResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._state = true;\r\n\t\t\tthis._value = newValue;\r\n\t\t\tfinale.call(this);\r\n\t\t} catch (e) { reject.call(this, e); }\r\n\t}\r\n\r\n\tfunction reject(newValue) {\r\n\t\tthis._state = false;\r\n\t\tthis._value = newValue;\r\n\t\tfinale.call(this);\r\n\t}\r\n\r\n\tfunction finale() {\r\n\t\tfor (var i = 0, len = this._deferreds.length; i < len; i++) {\r\n\t\t\thandle.call(this, this._deferreds[i]);\r\n\t\t}\r\n\t\tthis._deferreds = null;\r\n\t}\r\n\r\n\tfunction Handler(onFulfilled, onRejected, resolve, reject){\r\n\t\tthis.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\r\n\t\tthis.onRejected = typeof onRejected === 'function' ? onRejected : null;\r\n\t\tthis.resolve = resolve;\r\n\t\tthis.reject = reject;\r\n\t}\r\n\r\n\t/**\r\n\t * Take a potentially misbehaving resolver function and make sure\r\n\t * onFulfilled and onRejected are only called once.\r\n\t *\r\n\t * Makes no guarantees about asynchrony.\r\n\t */\r\n\tfunction doResolve(fn, onFulfilled, onRejected) {\r\n\t\tvar done = false;\r\n\t\ttry {\r\n\t\t\tfn(function (value) {\r\n\t\t\t\tif (done) return;\r\n\t\t\t\tdone = true;\r\n\t\t\t\tonFulfilled(value);\r\n\t\t\t}, function (reason) {\r\n\t\t\t\tif (done) return;\r\n\t\t\t\tdone = true;\r\n\t\t\t\tonRejected(reason);\r\n\t\t\t});\r\n\t\t} catch (ex) {\r\n\t\t\tif (done) return;\r\n\t\t\tdone = true;\r\n\t\t\tonRejected(ex);\r\n\t\t}\r\n\t}\r\n\r\n\tPromise.prototype['catch'] = function (onRejected) {\r\n\t\treturn this.then(null, onRejected);\r\n\t};\r\n\r\n\tPromise.prototype.then = function(onFulfilled, onRejected) {\r\n\t\tvar me = this;\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\thandle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\r\n\t\t});\r\n\t};\r\n\r\n\tPromise.all = function () {\r\n\t\tvar args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\r\n\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\tif (args.length === 0) return resolve([]);\r\n\t\t\tvar remaining = args.length;\r\n\t\t\tfunction res(i, val) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (val && (typeof val === 'object' || typeof val === 'function')) {\r\n\t\t\t\t\t\tvar then = val.then;\r\n\t\t\t\t\t\tif (typeof then === 'function') {\r\n\t\t\t\t\t\t\tthen.call(val, function (val) { res(i, val); }, reject);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\targs[i] = val;\r\n\t\t\t\t\tif (--remaining === 0) {\r\n\t\t\t\t\t\tresolve(args);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\treject(ex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < args.length; i++) {\r\n\t\t\t\tres(i, args[i]);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tPromise.resolve = function (value) {\r\n\t\tif (value && typeof value === 'object' && value.constructor === Promise) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\treturn new Promise(function (resolve) {\r\n\t\t\tresolve(value);\r\n\t\t});\r\n\t};\r\n\r\n\tPromise.reject = function (value) {\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\treject(value);\r\n\t\t});\r\n\t};\r\n\r\n\tPromise.race = function (values) {\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\tfor(var i = 0, len = values.length; i < len; i++) {\r\n\t\t\t\tvalues[i].then(resolve, reject);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\treturn Promise;\r\n});\r\n\r\n/* jshint ignore:end */\r\n/* eslint-enable */\r\n\r\n// Included from: js/tinymce/classes/util/Delay.js\r\n\r\n/**\r\n * Delay.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Utility class for working with delayed actions like setTimeout.\r\n *\r\n * @class tinymce.util.Delay\r\n */\r\ndefine(\"tinymce/util/Delay\", [\r\n\t\"tinymce/util/Promise\"\r\n], function(Promise) {\r\n\tvar requestAnimationFramePromise;\r\n\r\n\tfunction requestAnimationFrame(callback, element) {\r\n\t\tvar i, requestAnimationFrameFunc = window.requestAnimationFrame, vendors = ['ms', 'moz', 'webkit'];\r\n\r\n\t\tfunction featurefill(callback) {\r\n\t\t\twindow.setTimeout(callback, 0);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\r\n\t\t\trequestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\r\n\t\t}\r\n\r\n\t\tif (!requestAnimationFrameFunc) {\r\n\t\t\trequestAnimationFrameFunc = featurefill;\r\n\t\t}\r\n\r\n\t\trequestAnimationFrameFunc(callback, element);\r\n\t}\r\n\r\n\tfunction wrappedSetTimeout(callback, time) {\r\n\t\tif (typeof time != 'number') {\r\n\t\t\ttime = 0;\r\n\t\t}\r\n\r\n\t\treturn setTimeout(callback, time);\r\n\t}\r\n\r\n\tfunction wrappedSetInterval(callback, time) {\r\n\t\tif (typeof time != 'number') {\r\n\t\t\ttime = 0;\r\n\t\t}\r\n\r\n\t\treturn setInterval(callback, time);\r\n\t}\r\n\r\n\tfunction wrappedClearTimeout(id) {\r\n\t\treturn clearTimeout(id);\r\n\t}\r\n\r\n\tfunction wrappedClearInterval(id) {\r\n\t\treturn clearInterval(id);\r\n\t}\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Requests an animation frame and fallbacks to a timeout on older browsers.\r\n\t\t *\r\n\t\t * @method requestAnimationFrame\r\n\t\t * @param {function} callback Callback to execute when a new frame is available.\r\n\t\t * @param {DOMElement} element Optional element to scope it to.\r\n\t\t */\r\n\t\trequestAnimationFrame: function(callback, element) {\r\n\t\t\tif (requestAnimationFramePromise) {\r\n\t\t\t\trequestAnimationFramePromise.then(callback);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\trequestAnimationFramePromise = new Promise(function(resolve) {\r\n\t\t\t\tif (!element) {\r\n\t\t\t\t\telement = document.body;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trequestAnimationFrame(resolve, element);\r\n\t\t\t}).then(callback);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets a timer in ms and executes the specified callback when the timer runs out.\r\n\t\t *\r\n\t\t * @method setTimeout\r\n\t\t * @param {function} callback Callback to execute when timer runs out.\r\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\r\n\t\t * @return {Number} Timeout id number.\r\n\t\t */\r\n\t\tsetTimeout: wrappedSetTimeout,\r\n\r\n\t\t/**\r\n\t\t * Sets an interval timer in ms and executes the specified callback at every interval of that time.\r\n\t\t *\r\n\t\t * @method setInterval\r\n\t\t * @param {function} callback Callback to execute when interval time runs out.\r\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\r\n\t\t * @return {Number} Timeout id number.\r\n\t\t */\r\n\t\tsetInterval: wrappedSetInterval,\r\n\r\n\t\t/**\r\n\t\t * Sets an editor timeout it's similar to setTimeout except that it checks if the editor instance is\r\n\t\t * still alive when the callback gets executed.\r\n\t\t *\r\n\t\t * @method setEditorTimeout\r\n\t\t * @param {tinymce.Editor} editor Editor instance to check the removed state on.\r\n\t\t * @param {function} callback Callback to execute when timer runs out.\r\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\r\n\t\t * @return {Number} Timeout id number.\r\n\t\t */\r\n\t\tsetEditorTimeout: function(editor, callback, time) {\r\n\t\t\treturn wrappedSetTimeout(function() {\r\n\t\t\t\tif (!editor.removed) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t}, time);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets an interval timer it's similar to setInterval except that it checks if the editor instance is\r\n\t\t * still alive when the callback gets executed.\r\n\t\t *\r\n\t\t * @method setEditorInterval\r\n\t\t * @param {function} callback Callback to execute when interval time runs out.\r\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\r\n\t\t * @return {Number} Timeout id number.\r\n\t\t */\r\n\t\tsetEditorInterval: function(editor, callback, time) {\r\n\t\t\tvar timer;\r\n\r\n\t\t\ttimer = wrappedSetInterval(function() {\r\n\t\t\t\tif (!editor.removed) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclearInterval(timer);\r\n\t\t\t\t}\r\n\t\t\t}, time);\r\n\r\n\t\t\treturn timer;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates throttled callback function that only gets executed once within the specified time.\r\n\t\t *\r\n\t\t * @method throttle\r\n\t\t * @param {function} callback Callback to execute when timer finishes.\r\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\r\n\t\t * @return {Function} Throttled function callback.\r\n\t\t */\r\n\t\tthrottle: function(callback, time) {\r\n\t\t\tvar timer, func;\r\n\r\n\t\t\tfunc = function() {\r\n\t\t\t\tvar args = arguments;\r\n\r\n\t\t\t\tclearTimeout(timer);\r\n\r\n\t\t\t\ttimer = wrappedSetTimeout(function() {\r\n\t\t\t\t\tcallback.apply(this, args);\r\n\t\t\t\t}, time);\r\n\t\t\t};\r\n\r\n\t\t\tfunc.stop = function() {\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t};\r\n\r\n\t\t\treturn func;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Clears an interval timer so it won't execute.\r\n\t\t *\r\n\t\t * @method clearInterval\r\n\t\t * @param {Number} Interval timer id number.\r\n\t\t */\r\n\t\tclearInterval: wrappedClearInterval,\r\n\r\n\t\t/**\r\n\t\t * Clears an timeout timer so it won't execute.\r\n\t\t *\r\n\t\t * @method clearTimeout\r\n\t\t * @param {Number} Timeout timer id number.\r\n\t\t */\r\n\t\tclearTimeout: wrappedClearTimeout\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/Env.js\r\n\r\n/**\r\n * Env.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class contains various environment constants like browser versions etc.\r\n * Normally you don't want to sniff specific browser versions but sometimes you have\r\n * to when it's impossible to feature detect. So use this with care.\r\n *\r\n * @class tinymce.Env\r\n * @static\r\n */\r\ndefine(\"tinymce/Env\", [], function() {\r\n\tvar nav = navigator, userAgent = nav.userAgent;\r\n\tvar opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;\r\n\r\n\tfunction matchMediaQuery(query) {\r\n\t\treturn \"matchMedia\" in window ? matchMedia(query).matches : false;\r\n\t}\r\n\r\n\topera = window.opera && window.opera.buildNumber;\r\n\tandroid = /Android/.test(userAgent);\r\n\twebkit = /WebKit/.test(userAgent);\r\n\tie = !webkit && !opera && (/MSIE/gi).test(userAgent) && (/Explorer/gi).test(nav.appName);\r\n\tie = ie && /MSIE (\\w+)\\./.exec(userAgent)[1];\r\n\tie11 = userAgent.indexOf('Trident/') != -1 && (userAgent.indexOf('rv:') != -1 || nav.appName.indexOf('Netscape') != -1) ? 11 : false;\r\n\tie12 = (userAgent.indexOf('Edge/') != -1 && !ie && !ie11) ? 12 : false;\r\n\tie = ie || ie11 || ie12;\r\n\tgecko = !webkit && !ie11 && /Gecko/.test(userAgent);\r\n\tmac = userAgent.indexOf('Mac') != -1;\r\n\tiDevice = /(iPad|iPhone)/.test(userAgent);\r\n\tfileApi = \"FormData\" in window && \"FileReader\" in window && \"URL\" in window && !!URL.createObjectURL;\r\n\tphone = matchMediaQuery(\"only screen and (max-device-width: 480px)\") && (android || iDevice);\r\n\ttablet = matchMediaQuery(\"only screen and (min-width: 800px)\") && (android || iDevice);\r\n\twindowsPhone = userAgent.indexOf('Windows Phone') != -1;\r\n\r\n\tif (ie12) {\r\n\t\twebkit = false;\r\n\t}\r\n\r\n\t// Is a iPad/iPhone and not on iOS5 sniff the WebKit version since older iOS WebKit versions\r\n\t// says it has contentEditable support but there is no visible caret.\r\n\tvar contentEditable = !iDevice || fileApi || userAgent.match(/AppleWebKit\\/(\\d*)/)[1] >= 534;\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Constant that is true if the browser is Opera.\r\n\t\t *\r\n\t\t * @property opera\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\topera: opera,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the browser is WebKit (Safari/Chrome).\r\n\t\t *\r\n\t\t * @property webKit\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\twebkit: webkit,\r\n\r\n\t\t/**\r\n\t\t * Constant that is more than zero if the browser is IE.\r\n\t\t *\r\n\t\t * @property ie\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\tie: ie,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the browser is Gecko.\r\n\t\t *\r\n\t\t * @property gecko\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\tgecko: gecko,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the os is Mac OS.\r\n\t\t *\r\n\t\t * @property mac\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\tmac: mac,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the os is iOS.\r\n\t\t *\r\n\t\t * @property iOS\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\tiOS: iDevice,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the os is android.\r\n\t\t *\r\n\t\t * @property android\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\tandroid: android,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the browser supports editing.\r\n\t\t *\r\n\t\t * @property contentEditable\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\tcontentEditable: contentEditable,\r\n\r\n\t\t/**\r\n\t\t * Transparent image data url.\r\n\t\t *\r\n\t\t * @property transparentSrc\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\ttransparentSrc: \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\",\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the browser can or can't place the caret after a inline block like an image.\r\n\t\t *\r\n\t\t * @property noCaretAfter\r\n\t\t * @type Boolean\r\n\t\t * @final\r\n\t\t */\r\n\t\tcaretAfter: ie != 8,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the browser supports native DOM Ranges. IE 9+.\r\n\t\t *\r\n\t\t * @property range\r\n\t\t * @type Boolean\r\n\t\t */\r\n\t\trange: window.getSelection && \"Range\" in window,\r\n\r\n\t\t/**\r\n\t\t * Returns the IE document mode for non IE browsers this will fake IE 10.\r\n\t\t *\r\n\t\t * @property documentMode\r\n\t\t * @type Number\r\n\t\t */\r\n\t\tdocumentMode: ie && !ie12 ? (document.documentMode || 7) : 10,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the browser has a modern file api.\r\n\t\t *\r\n\t\t * @property fileApi\r\n\t\t * @type Boolean\r\n\t\t */\r\n\t\tfileApi: fileApi,\r\n\r\n\t\t/**\r\n\t\t * Constant that is true if the browser supports contentEditable=false regions.\r\n\t\t *\r\n\t\t * @property ceFalse\r\n\t\t * @type Boolean\r\n\t\t */\r\n\t\tceFalse: (ie === false || ie > 8),\r\n\r\n\t\tdesktop: !phone && !tablet,\r\n\t\twindowsPhone: windowsPhone\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/EventUtils.js\r\n\r\n/**\r\n * EventUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*jshint loopfunc:true*/\r\n/*eslint no-loop-func:0 */\r\n\r\n/**\r\n * This class wraps the browsers native event logic with more convenient methods.\r\n *\r\n * @class tinymce.dom.EventUtils\r\n */\r\ndefine(\"tinymce/dom/EventUtils\", [\r\n\t\"tinymce/util/Delay\",\r\n\t\"tinymce/Env\"\r\n], function(Delay, Env) {\r\n\t\"use strict\";\r\n\r\n\tvar eventExpandoPrefix = \"mce-data-\";\r\n\tvar mouseEventRe = /^(?:mouse|contextmenu)|click/;\r\n\tvar deprecated = {\r\n\t\tkeyLocation: 1, layerX: 1, layerY: 1, returnValue: 1,\r\n\t\twebkitMovementX: 1, webkitMovementY: 1, keyIdentifier: 1\r\n\t};\r\n\r\n\t/**\r\n\t * Binds a native event to a callback on the speified target.\r\n\t */\r\n\tfunction addEvent(target, name, callback, capture) {\r\n\t\tif (target.addEventListener) {\r\n\t\t\ttarget.addEventListener(name, callback, capture || false);\r\n\t\t} else if (target.attachEvent) {\r\n\t\t\ttarget.attachEvent('on' + name, callback);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds a native event callback on the specified target.\r\n\t */\r\n\tfunction removeEvent(target, name, callback, capture) {\r\n\t\tif (target.removeEventListener) {\r\n\t\t\ttarget.removeEventListener(name, callback, capture || false);\r\n\t\t} else if (target.detachEvent) {\r\n\t\t\ttarget.detachEvent('on' + name, callback);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the event target based on shadow dom properties like path and deepPath.\r\n\t */\r\n\tfunction getTargetFromShadowDom(event, defaultTarget) {\r\n\t\tvar path, target = defaultTarget;\r\n\r\n\t\t// When target element is inside Shadow DOM we need to take first element from path\r\n\t\t// otherwise we'll get Shadow Root parent, not actual target element\r\n\r\n\t\t// Normalize target for WebComponents v0 implementation (in Chrome)\r\n\t\tpath = event.path;\r\n\t\tif (path && path.length > 0) {\r\n\t\t\ttarget = path[0];\r\n\t\t}\r\n\r\n\t\t// Normalize target for WebComponents v1 implementation (standard)\r\n\t\tif (event.deepPath) {\r\n\t\t\tpath = event.deepPath();\r\n\t\t\tif (path && path.length > 0) {\r\n\t\t\t\ttarget = path[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn target;\r\n\t}\r\n\r\n\t/**\r\n\t * Normalizes a native event object or just adds the event specific methods on a custom event.\r\n\t */\r\n\tfunction fix(originalEvent, data) {\r\n\t\tvar name, event = data || {}, undef;\r\n\r\n\t\t// Dummy function that gets replaced on the delegation state functions\r\n\t\tfunction returnFalse() {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Dummy function that gets replaced on the delegation state functions\r\n\t\tfunction returnTrue() {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Copy all properties from the original event\r\n\t\tfor (name in originalEvent) {\r\n\t\t\t// layerX/layerY is deprecated in Chrome and produces a warning\r\n\t\t\tif (!deprecated[name]) {\r\n\t\t\t\tevent[name] = originalEvent[name];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Normalize target IE uses srcElement\r\n\t\tif (!event.target) {\r\n\t\t\tevent.target = event.srcElement || document;\r\n\t\t}\r\n\r\n\t\t// Experimental shadow dom support\r\n\t\tif (Env.experimentalShadowDom) {\r\n\t\t\tevent.target = getTargetFromShadowDom(originalEvent, event.target);\r\n\t\t}\r\n\r\n\t\t// Calculate pageX/Y if missing and clientX/Y available\r\n\t\tif (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undef && originalEvent.clientX !== undef) {\r\n\t\t\tvar eventDoc = event.target.ownerDocument || document;\r\n\t\t\tvar doc = eventDoc.documentElement;\r\n\t\t\tvar body = eventDoc.body;\r\n\r\n\t\t\tevent.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) -\r\n\t\t\t\t(doc && doc.clientLeft || body && body.clientLeft || 0);\r\n\r\n\t\t\tevent.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) -\r\n\t\t\t\t(doc && doc.clientTop || body && body.clientTop || 0);\r\n\t\t}\r\n\r\n\t\t// Add preventDefault method\r\n\t\tevent.preventDefault = function() {\r\n\t\t\tevent.isDefaultPrevented = returnTrue;\r\n\r\n\t\t\t// Execute preventDefault on the original event object\r\n\t\t\tif (originalEvent) {\r\n\t\t\t\tif (originalEvent.preventDefault) {\r\n\t\t\t\t\toriginalEvent.preventDefault();\r\n\t\t\t\t} else {\r\n\t\t\t\t\toriginalEvent.returnValue = false; // IE\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Add stopPropagation\r\n\t\tevent.stopPropagation = function() {\r\n\t\t\tevent.isPropagationStopped = returnTrue;\r\n\r\n\t\t\t// Execute stopPropagation on the original event object\r\n\t\t\tif (originalEvent) {\r\n\t\t\t\tif (originalEvent.stopPropagation) {\r\n\t\t\t\t\toriginalEvent.stopPropagation();\r\n\t\t\t\t} else {\r\n\t\t\t\t\toriginalEvent.cancelBubble = true; // IE\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Add stopImmediatePropagation\r\n\t\tevent.stopImmediatePropagation = function() {\r\n\t\t\tevent.isImmediatePropagationStopped = returnTrue;\r\n\t\t\tevent.stopPropagation();\r\n\t\t};\r\n\r\n\t\t// Add event delegation states\r\n\t\tif (!event.isDefaultPrevented) {\r\n\t\t\tevent.isDefaultPrevented = returnFalse;\r\n\t\t\tevent.isPropagationStopped = returnFalse;\r\n\t\t\tevent.isImmediatePropagationStopped = returnFalse;\r\n\t\t}\r\n\r\n\t\t// Add missing metaKey for IE 8\r\n\t\tif (typeof event.metaKey == 'undefined') {\r\n\t\t\tevent.metaKey = false;\r\n\t\t}\r\n\r\n\t\treturn event;\r\n\t}\r\n\r\n\t/**\r\n\t * Bind a DOMContentLoaded event across browsers and executes the callback once the page DOM is initialized.\r\n\t * It will also set/check the domLoaded state of the event_utils instance so ready isn't called multiple times.\r\n\t */\r\n\tfunction bindOnReady(win, callback, eventUtils) {\r\n\t\tvar doc = win.document, event = {type: 'ready'};\r\n\r\n\t\tif (eventUtils.domLoaded) {\r\n\t\t\tcallback(event);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Gets called when the DOM is ready\r\n\t\tfunction readyHandler() {\r\n\t\t\tif (!eventUtils.domLoaded) {\r\n\t\t\t\teventUtils.domLoaded = true;\r\n\t\t\t\tcallback(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction waitForDomLoaded() {\r\n\t\t\t// Check complete or interactive state if there is a body\r\n\t\t\t// element on some iframes IE 8 will produce a null body\r\n\t\t\tif (doc.readyState === \"complete\" || (doc.readyState === \"interactive\" && doc.body)) {\r\n\t\t\t\tremoveEvent(doc, \"readystatechange\", waitForDomLoaded);\r\n\t\t\t\treadyHandler();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction tryScroll() {\r\n\t\t\ttry {\r\n\t\t\t\t// If IE is used, use the trick by Diego Perini licensed under MIT by request to the author.\r\n\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\r\n\t\t\t\tdoc.documentElement.doScroll(\"left\");\r\n\t\t\t} catch (ex) {\r\n\t\t\t\tDelay.setTimeout(tryScroll);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\treadyHandler();\r\n\t\t}\r\n\r\n\t\t// Use W3C method\r\n\t\tif (doc.addEventListener) {\r\n\t\t\tif (doc.readyState === \"complete\") {\r\n\t\t\t\treadyHandler();\r\n\t\t\t} else {\r\n\t\t\t\taddEvent(win, 'DOMContentLoaded', readyHandler);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Use IE method\r\n\t\t\taddEvent(doc, \"readystatechange\", waitForDomLoaded);\r\n\r\n\t\t\t// Wait until we can scroll, when we can the DOM is initialized\r\n\t\t\tif (doc.documentElement.doScroll && win.self === win.top) {\r\n\t\t\t\ttryScroll();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Fallback if any of the above methods should fail for some odd reason\r\n\t\taddEvent(win, 'load', readyHandler);\r\n\t}\r\n\r\n\t/**\r\n\t * This class enables you to bind/unbind native events to elements and normalize it's behavior across browsers.\r\n\t */\r\n\tfunction EventUtils() {\r\n\t\tvar self = this, events = {}, count, expando, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;\r\n\r\n\t\texpando = eventExpandoPrefix + (+new Date()).toString(32);\r\n\t\thasMouseEnterLeave = \"onmouseenter\" in document.documentElement;\r\n\t\thasFocusIn = \"onfocusin\" in document.documentElement;\r\n\t\tmouseEnterLeave = {mouseenter: 'mouseover', mouseleave: 'mouseout'};\r\n\t\tcount = 1;\r\n\r\n\t\t// State if the DOMContentLoaded was executed or not\r\n\t\tself.domLoaded = false;\r\n\t\tself.events = events;\r\n\r\n\t\t/**\r\n\t\t * Executes all event handler callbacks for a specific event.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Event} evt Event object.\r\n\t\t * @param {String} id Expando id value to look for.\r\n\t\t */\r\n\t\tfunction executeHandlers(evt, id) {\r\n\t\t\tvar callbackList, i, l, callback, container = events[id];\r\n\r\n\t\t\tcallbackList = container && container[evt.type];\r\n\t\t\tif (callbackList) {\r\n\t\t\t\tfor (i = 0, l = callbackList.length; i < l; i++) {\r\n\t\t\t\t\tcallback = callbackList[i];\r\n\r\n\t\t\t\t\t// Check if callback exists might be removed if a unbind is called inside the callback\r\n\t\t\t\t\tif (callback && callback.func.call(callback.scope, evt) === false) {\r\n\t\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Should we stop propagation to immediate listeners\r\n\t\t\t\t\tif (evt.isImmediatePropagationStopped()) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Binds a callback to an event on the specified target.\r\n\t\t *\r\n\t\t * @method bind\r\n\t\t * @param {Object} target Target node/window or custom object.\r\n\t\t * @param {String} names Name of the event to bind.\r\n\t\t * @param {function} callback Callback function to execute when the event occurs.\r\n\t\t * @param {Object} scope Scope to call the callback function on, defaults to target.\r\n\t\t * @return {function} Callback function that got bound.\r\n\t\t */\r\n\t\tself.bind = function(target, names, callback, scope) {\r\n\t\t\tvar id, callbackList, i, name, fakeName, nativeHandler, capture, win = window;\r\n\r\n\t\t\t// Native event handler function patches the event and executes the callbacks for the expando\r\n\t\t\tfunction defaultNativeHandler(evt) {\r\n\t\t\t\texecuteHandlers(fix(evt || win.event), id);\r\n\t\t\t}\r\n\r\n\t\t\t// Don't bind to text nodes or comments\r\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Create or get events id for the target\r\n\t\t\tif (!target[expando]) {\r\n\t\t\t\tid = count++;\r\n\t\t\t\ttarget[expando] = id;\r\n\t\t\t\tevents[id] = {};\r\n\t\t\t} else {\r\n\t\t\t\tid = target[expando];\r\n\t\t\t}\r\n\r\n\t\t\t// Setup the specified scope or use the target as a default\r\n\t\t\tscope = scope || target;\r\n\r\n\t\t\t// Split names and bind each event, enables you to bind multiple events with one call\r\n\t\t\tnames = names.split(' ');\r\n\t\t\ti = names.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tname = names[i];\r\n\t\t\t\tnativeHandler = defaultNativeHandler;\r\n\t\t\t\tfakeName = capture = false;\r\n\r\n\t\t\t\t// Use ready instead of DOMContentLoaded\r\n\t\t\t\tif (name === \"DOMContentLoaded\") {\r\n\t\t\t\t\tname = \"ready\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// DOM is already ready\r\n\t\t\t\tif (self.domLoaded && name === \"ready\" && target.readyState == 'complete') {\r\n\t\t\t\t\tcallback.call(scope, fix({type: name}));\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle mouseenter/mouseleaver\r\n\t\t\t\tif (!hasMouseEnterLeave) {\r\n\t\t\t\t\tfakeName = mouseEnterLeave[name];\r\n\r\n\t\t\t\t\tif (fakeName) {\r\n\t\t\t\t\t\tnativeHandler = function(evt) {\r\n\t\t\t\t\t\t\tvar current, related;\r\n\r\n\t\t\t\t\t\t\tcurrent = evt.currentTarget;\r\n\t\t\t\t\t\t\trelated = evt.relatedTarget;\r\n\r\n\t\t\t\t\t\t\t// Check if related is inside the current target if it's not then the event should\r\n\t\t\t\t\t\t\t// be ignored since it's a mouseover/mouseout inside the element\r\n\t\t\t\t\t\t\tif (related && current.contains) {\r\n\t\t\t\t\t\t\t\t// Use contains for performance\r\n\t\t\t\t\t\t\t\trelated = current.contains(related);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\twhile (related && related !== current) {\r\n\t\t\t\t\t\t\t\t\trelated = related.parentNode;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Fire fake event\r\n\t\t\t\t\t\t\tif (!related) {\r\n\t\t\t\t\t\t\t\tevt = fix(evt || win.event);\r\n\t\t\t\t\t\t\t\tevt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\r\n\t\t\t\t\t\t\t\tevt.target = current;\r\n\t\t\t\t\t\t\t\texecuteHandlers(evt, id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fake bubbling of focusin/focusout\r\n\t\t\t\tif (!hasFocusIn && (name === \"focusin\" || name === \"focusout\")) {\r\n\t\t\t\t\tcapture = true;\r\n\t\t\t\t\tfakeName = name === \"focusin\" ? \"focus\" : \"blur\";\r\n\t\t\t\t\tnativeHandler = function(evt) {\r\n\t\t\t\t\t\tevt = fix(evt || win.event);\r\n\t\t\t\t\t\tevt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\r\n\t\t\t\t\t\texecuteHandlers(evt, id);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Setup callback list and bind native event\r\n\t\t\t\tcallbackList = events[id][name];\r\n\t\t\t\tif (!callbackList) {\r\n\t\t\t\t\tevents[id][name] = callbackList = [{func: callback, scope: scope}];\r\n\t\t\t\t\tcallbackList.fakeName = fakeName;\r\n\t\t\t\t\tcallbackList.capture = capture;\r\n\t\t\t\t\t//callbackList.callback = callback;\r\n\r\n\t\t\t\t\t// Add the nativeHandler to the callback list so that we can later unbind it\r\n\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\r\n\r\n\t\t\t\t\t// Check if the target has native events support\r\n\r\n\t\t\t\t\tif (name === \"ready\") {\r\n\t\t\t\t\t\tbindOnReady(target, nativeHandler, self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\taddEvent(target, fakeName || name, nativeHandler, capture);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (name === \"ready\" && self.domLoaded) {\r\n\t\t\t\t\t\tcallback({type: name});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// If it already has an native handler then just push the callback\r\n\t\t\t\t\t\tcallbackList.push({func: callback, scope: scope});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttarget = callbackList = 0; // Clean memory for IE\r\n\r\n\t\t\treturn callback;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Unbinds the specified event by name, name and callback or all events on the target.\r\n\t\t *\r\n\t\t * @method unbind\r\n\t\t * @param {Object} target Target node/window or custom object.\r\n\t\t * @param {String} names Optional event name to unbind.\r\n\t\t * @param {function} callback Optional callback function to unbind.\r\n\t\t * @return {EventUtils} Event utils instance.\r\n\t\t */\r\n\t\tself.unbind = function(target, names, callback) {\r\n\t\t\tvar id, callbackList, i, ci, name, eventMap;\r\n\r\n\t\t\t// Don't bind to text nodes or comments\r\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\t// Unbind event or events if the target has the expando\r\n\t\t\tid = target[expando];\r\n\t\t\tif (id) {\r\n\t\t\t\teventMap = events[id];\r\n\r\n\t\t\t\t// Specific callback\r\n\t\t\t\tif (names) {\r\n\t\t\t\t\tnames = names.split(' ');\r\n\t\t\t\t\ti = names.length;\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tname = names[i];\r\n\t\t\t\t\t\tcallbackList = eventMap[name];\r\n\r\n\t\t\t\t\t\t// Unbind the event if it exists in the map\r\n\t\t\t\t\t\tif (callbackList) {\r\n\t\t\t\t\t\t\t// Remove specified callback\r\n\t\t\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\t\t\tci = callbackList.length;\r\n\t\t\t\t\t\t\t\twhile (ci--) {\r\n\t\t\t\t\t\t\t\t\tif (callbackList[ci].func === callback) {\r\n\t\t\t\t\t\t\t\t\t\tvar nativeHandler = callbackList.nativeHandler;\r\n\t\t\t\t\t\t\t\t\t\tvar fakeName = callbackList.fakeName, capture = callbackList.capture;\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Clone callbackList since unbind inside a callback would otherwise break the handlers loop\r\n\t\t\t\t\t\t\t\t\t\tcallbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\r\n\t\t\t\t\t\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\r\n\t\t\t\t\t\t\t\t\t\tcallbackList.fakeName = fakeName;\r\n\t\t\t\t\t\t\t\t\t\tcallbackList.capture = capture;\r\n\r\n\t\t\t\t\t\t\t\t\t\teventMap[name] = callbackList;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Remove all callbacks if there isn't a specified callback or there is no callbacks left\r\n\t\t\t\t\t\t\tif (!callback || callbackList.length === 0) {\r\n\t\t\t\t\t\t\t\tdelete eventMap[name];\r\n\t\t\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// All events for a specific element\r\n\t\t\t\t\tfor (name in eventMap) {\r\n\t\t\t\t\t\tcallbackList = eventMap[name];\r\n\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teventMap = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if object is empty, if it isn't then we won't remove the expando map\r\n\t\t\t\tfor (name in eventMap) {\r\n\t\t\t\t\treturn self;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Delete event object\r\n\t\t\t\tdelete events[id];\r\n\r\n\t\t\t\t// Remove expando from target\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// IE will fail here since it can't delete properties from window\r\n\t\t\t\t\tdelete target[expando];\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// IE will set it to null\r\n\t\t\t\t\ttarget[expando] = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Fires the specified event on the specified target.\r\n\t\t *\r\n\t\t * @method fire\r\n\t\t * @param {Object} target Target node/window or custom object.\r\n\t\t * @param {String} name Event name to fire.\r\n\t\t * @param {Object} args Optional arguments to send to the observers.\r\n\t\t * @return {EventUtils} Event utils instance.\r\n\t\t */\r\n\t\tself.fire = function(target, name, args) {\r\n\t\t\tvar id;\r\n\r\n\t\t\t// Don't bind to text nodes or comments\r\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\t// Build event object by patching the args\r\n\t\t\targs = fix(null, args);\r\n\t\t\targs.type = name;\r\n\t\t\targs.target = target;\r\n\r\n\t\t\tdo {\r\n\t\t\t\t// Found an expando that means there is listeners to execute\r\n\t\t\t\tid = target[expando];\r\n\t\t\t\tif (id) {\r\n\t\t\t\t\texecuteHandlers(args, id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Walk up the DOM\r\n\t\t\t\ttarget = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\r\n\t\t\t} while (target && !args.isPropagationStopped());\r\n\r\n\t\t\treturn self;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Removes all bound event listeners for the specified target. This will also remove any bound\r\n\t\t * listeners to child nodes within that target.\r\n\t\t *\r\n\t\t * @method clean\r\n\t\t * @param {Object} target Target node/window object.\r\n\t\t * @return {EventUtils} Event utils instance.\r\n\t\t */\r\n\t\tself.clean = function(target) {\r\n\t\t\tvar i, children, unbind = self.unbind;\r\n\r\n\t\t\t// Don't bind to text nodes or comments\r\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\t// Unbind any element on the specified target\r\n\t\t\tif (target[expando]) {\r\n\t\t\t\tunbind(target);\r\n\t\t\t}\r\n\r\n\t\t\t// Target doesn't have getElementsByTagName it's probably a window object then use it's document to find the children\r\n\t\t\tif (!target.getElementsByTagName) {\r\n\t\t\t\ttarget = target.document;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove events from each child element\r\n\t\t\tif (target && target.getElementsByTagName) {\r\n\t\t\t\tunbind(target);\r\n\r\n\t\t\t\tchildren = target.getElementsByTagName('*');\r\n\t\t\t\ti = children.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\ttarget = children[i];\r\n\r\n\t\t\t\t\tif (target[expando]) {\r\n\t\t\t\t\t\tunbind(target);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Destroys the event object. Call this on IE to remove memory leaks.\r\n\t\t */\r\n\t\tself.destroy = function() {\r\n\t\t\tevents = {};\r\n\t\t};\r\n\r\n\t\t// Legacy function for canceling events\r\n\t\tself.cancel = function(e) {\r\n\t\t\tif (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t}\r\n\r\n\tEventUtils.Event = new EventUtils();\r\n\tEventUtils.Event.bind(window, 'ready', function() {});\r\n\r\n\treturn EventUtils;\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/Sizzle.js\r\n\r\n/**\r\n * Sizzle.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n *\r\n * @ignore-file\r\n */\r\n\r\n/*jshint bitwise:false, expr:true, noempty:false, sub:true, eqnull:true, latedef:false, maxlen:255 */\r\n/*eslint-disable */\r\n\r\n/**\r\n * Sizzle CSS Selector Engine v@VERSION\r\n * http://sizzlejs.com/\r\n *\r\n * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors\r\n * Released under the MIT license\r\n * http://jquery.org/license\r\n *\r\n * Date: @DATE\r\n */\r\ndefine(\"tinymce/dom/Sizzle\", [], function() {\r\nvar i,\r\n\tsupport,\r\n\tExpr,\r\n\tgetText,\r\n\tisXML,\r\n\ttokenize,\r\n\tcompile,\r\n\tselect,\r\n\toutermostContext,\r\n\tsortInput,\r\n\thasDuplicate,\r\n\r\n\t// Local document vars\r\n\tsetDocument,\r\n\tdocument,\r\n\tdocElem,\r\n\tdocumentIsHTML,\r\n\trbuggyQSA,\r\n\trbuggyMatches,\r\n\tmatches,\r\n\tcontains,\r\n\r\n\t// Instance-specific data\r\n\texpando = \"sizzle\" + -(new Date()),\r\n\tpreferredDoc = window.document,\r\n\tdirruns = 0,\r\n\tdone = 0,\r\n\tclassCache = createCache(),\r\n\ttokenCache = createCache(),\r\n\tcompilerCache = createCache(),\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( a === b ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn 0;\r\n\t},\r\n\r\n\t// General-purpose constants\r\n\tstrundefined = typeof undefined,\r\n\tMAX_NEGATIVE = 1 << 31,\r\n\r\n\t// Instance methods\r\n\thasOwn = ({}).hasOwnProperty,\r\n\tarr = [],\r\n\tpop = arr.pop,\r\n\tpush_native = arr.push,\r\n\tpush = arr.push,\r\n\tslice = arr.slice,\r\n\t// Use a stripped-down indexOf if we can't use a native one\r\n\tindexOf = arr.indexOf || function( elem ) {\r\n\t\tvar i = 0,\r\n\t\t\tlen = this.length;\r\n\t\tfor ( ; i < len; i++ ) {\r\n\t\t\tif ( this[i] === elem ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\tbooleans = \"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",\r\n\r\n\t// Regular expressions\r\n\r\n\t// http://www.w3.org/TR/css3-selectors/#whitespace\r\n\twhitespace = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\r\n\r\n\t// http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier\r\n\tidentifier = \"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",\r\n\r\n\t// Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors\r\n\tattributes = \"\\\\[\" + whitespace + \"*(\" + identifier + \")(?:\" + whitespace +\r\n\t\t// Operator (capture 2)\r\n\t\t\"*([*^$|!~]?=)\" + whitespace +\r\n\t\t// \"Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]\"\r\n\t\t\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\" + identifier + \"))|)\" + whitespace +\r\n\t\t\"*\\\\]\",\r\n\r\n\tpseudos = \":(\" + identifier + \")(?:\\\\((\" +\r\n\t\t// To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:\r\n\t\t// 1. quoted (capture 3; capture 4 or capture 5)\r\n\t\t\"('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|\" +\r\n\t\t// 2. simple (capture 6)\r\n\t\t\"((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\" + attributes + \")*)|\" +\r\n\t\t// 3. anything else (capture 2)\r\n\t\t\".*\" +\r\n\t\t\")\\\\)|)\",\r\n\r\n\t// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter\r\n\trtrim = new RegExp( \"^\" + whitespace + \"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\" + whitespace + \"+$\", \"g\" ),\r\n\r\n\trcomma = new RegExp( \"^\" + whitespace + \"*,\" + whitespace + \"*\" ),\r\n\trcombinators = new RegExp( \"^\" + whitespace + \"*([>+~]|\" + whitespace + \")\" + whitespace + \"*\" ),\r\n\r\n\trattributeQuotes = new RegExp( \"=\" + whitespace + \"*([^\\\\]'\\\"]*?)\" + whitespace + \"*\\\\]\", \"g\" ),\r\n\r\n\trpseudo = new RegExp( pseudos ),\r\n\tridentifier = new RegExp( \"^\" + identifier + \"$\" ),\r\n\r\n\tmatchExpr = {\r\n\t\t\"ID\": new RegExp( \"^#(\" + identifier + \")\" ),\r\n\t\t\"CLASS\": new RegExp( \"^\\\\.(\" + identifier + \")\" ),\r\n\t\t\"TAG\": new RegExp( \"^(\" + identifier + \"|[*])\" ),\r\n\t\t\"ATTR\": new RegExp( \"^\" + attributes ),\r\n\t\t\"PSEUDO\": new RegExp( \"^\" + pseudos ),\r\n\t\t\"CHILD\": new RegExp( \"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\" + whitespace +\r\n\t\t\t\"*(even|odd|(([+-]|)(\\\\d*)n|)\" + whitespace + \"*(?:([+-]|)\" + whitespace +\r\n\t\t\t\"*(\\\\d+)|))\" + whitespace + \"*\\\\)|)\", \"i\" ),\r\n\t\t\"bool\": new RegExp( \"^(?:\" + booleans + \")$\", \"i\" ),\r\n\t\t// For use in libraries implementing .is()\r\n\t\t// We use this for POS matching in `select`\r\n\t\t\"needsContext\": new RegExp( \"^\" + whitespace + \"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\" +\r\n\t\t\twhitespace + \"*((?:-\\\\d)?\\\\d*)\" + whitespace + \"*\\\\)|)(?=[^-]|$)\", \"i\" )\r\n\t},\r\n\r\n\trinputs = /^(?:input|select|textarea|button)$/i,\r\n\trheader = /^h\\d$/i,\r\n\r\n\trnative = /^[^{]+\\{\\s*\\[native \\w/,\r\n\r\n\t// Easily-parseable/retrievable ID or TAG or CLASS selectors\r\n\trquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\r\n\r\n\trsibling = /[+~]/,\r\n\trescape = /'|\\\\/g,\r\n\r\n\t// CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters\r\n\trunescape = new RegExp( \"\\\\\\\\([\\\\da-f]{1,6}\" + whitespace + \"?|(\" + whitespace + \")|.)\", \"ig\" ),\r\n\tfunescape = function( _, escaped, escapedWhitespace ) {\r\n\t\tvar high = \"0x\" + escaped - 0x10000;\r\n\t\t// NaN means non-codepoint\r\n\t\t// Support: Firefox<24\r\n\t\t// Workaround erroneous numeric interpretation of +\"0x\"\r\n\t\treturn high !== high || escapedWhitespace ?\r\n\t\t\tescaped :\r\n\t\t\thigh < 0 ?\r\n\t\t\t\t// BMP codepoint\r\n\t\t\t\tString.fromCharCode( high + 0x10000 ) :\r\n\t\t\t\t// Supplemental Plane codepoint (surrogate pair)\r\n\t\t\t\tString.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );\r\n\t};\r\n\r\n// Optimize for push.apply( _, NodeList )\r\ntry {\r\n\tpush.apply(\r\n\t\t(arr = slice.call( preferredDoc.childNodes )),\r\n\t\tpreferredDoc.childNodes\r\n\t);\r\n\t// Support: Android<4.0\r\n\t// Detect silently failing push.apply\r\n\tarr[ preferredDoc.childNodes.length ].nodeType;\r\n} catch ( e ) {\r\n\tpush = { apply: arr.length ?\r\n\r\n\t\t// Leverage slice if possible\r\n\t\tfunction( target, els ) {\r\n\t\t\tpush_native.apply( target, slice.call(els) );\r\n\t\t} :\r\n\r\n\t\t// Support: IE<9\r\n\t\t// Otherwise append directly\r\n\t\tfunction( target, els ) {\r\n\t\t\tvar j = target.length,\r\n\t\t\t\ti = 0;\r\n\t\t\t// Can't trust NodeList.length\r\n\t\t\twhile ( (target[j++] = els[i++]) ) {}\r\n\t\t\ttarget.length = j - 1;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction Sizzle( selector, context, results, seed ) {\r\n\tvar match, elem, m, nodeType,\r\n\t\t// QSA vars\r\n\t\ti, groups, old, nid, newContext, newSelector;\r\n\r\n\tif ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {\r\n\t\tsetDocument( context );\r\n\t}\r\n\r\n\tcontext = context || document;\r\n\tresults = results || [];\r\n\r\n\tif ( !selector || typeof selector !== \"string\" ) {\r\n\t\treturn results;\r\n\t}\r\n\r\n\tif ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tif ( documentIsHTML && !seed ) {\r\n\r\n\t\t// Shortcuts\r\n\t\tif ( (match = rquickExpr.exec( selector )) ) {\r\n\t\t\t// Speed-up: Sizzle(\"#ID\")\r\n\t\t\tif ( (m = match[1]) ) {\r\n\t\t\t\tif ( nodeType === 9 ) {\r\n\t\t\t\t\telem = context.getElementById( m );\r\n\t\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\r\n\t\t\t\t\t// nodes that are no longer in the document (jQuery #6963)\r\n\t\t\t\t\tif ( elem && elem.parentNode ) {\r\n\t\t\t\t\t\t// Handle the case where IE, Opera, and Webkit return items\r\n\t\t\t\t\t\t// by name instead of ID\r\n\t\t\t\t\t\tif ( elem.id === m ) {\r\n\t\t\t\t\t\t\tresults.push( elem );\r\n\t\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Context is not a document\r\n\t\t\t\t\tif ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&\r\n\t\t\t\t\t\tcontains( context, elem ) && elem.id === m ) {\r\n\t\t\t\t\t\tresults.push( elem );\r\n\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t// Speed-up: Sizzle(\"TAG\")\r\n\t\t\t} else if ( match[2] ) {\r\n\t\t\t\tpush.apply( results, context.getElementsByTagName( selector ) );\r\n\t\t\t\treturn results;\r\n\r\n\t\t\t// Speed-up: Sizzle(\".CLASS\")\r\n\t\t\t} else if ( (m = match[3]) && support.getElementsByClassName ) {\r\n\t\t\t\tpush.apply( results, context.getElementsByClassName( m ) );\r\n\t\t\t\treturn results;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// QSA path\r\n\t\tif ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {\r\n\t\t\tnid = old = expando;\r\n\t\t\tnewContext = context;\r\n\t\t\tnewSelector = nodeType === 9 && selector;\r\n\r\n\t\t\t// qSA works strangely on Element-rooted queries\r\n\t\t\t// We can work around this by specifying an extra ID on the root\r\n\t\t\t// and working up from there (Thanks to Andrew Dupont for the technique)\r\n\t\t\t// IE 8 doesn't work on object elements\r\n\t\t\tif ( nodeType === 1 && context.nodeName.toLowerCase() !== \"object\" ) {\r\n\t\t\t\tgroups = tokenize( selector );\r\n\r\n\t\t\t\tif ( (old = context.getAttribute(\"id\")) ) {\r\n\t\t\t\t\tnid = old.replace( rescape, \"\\\\$&\" );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontext.setAttribute( \"id\", nid );\r\n\t\t\t\t}\r\n\t\t\t\tnid = \"[id='\" + nid + \"'] \";\r\n\r\n\t\t\t\ti = groups.length;\r\n\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\tgroups[i] = nid + toSelector( groups[i] );\r\n\t\t\t\t}\r\n\t\t\t\tnewContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;\r\n\t\t\t\tnewSelector = groups.join(\",\");\r\n\t\t\t}\r\n\r\n\t\t\tif ( newSelector ) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tpush.apply( results,\r\n\t\t\t\t\t\tnewContext.querySelectorAll( newSelector )\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn results;\r\n\t\t\t\t} catch(qsaError) {\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tif ( !old ) {\r\n\t\t\t\t\t\tcontext.removeAttribute(\"id\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// All others\r\n\treturn select( selector.replace( rtrim, \"$1\" ), context, results, seed );\r\n}\r\n\r\n/**\r\n * Create key-value caches of limited size\r\n * @returns {Function(string, Object)} Returns the Object data after storing it on itself with\r\n *\tproperty name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)\r\n *\tdeleting the oldest entry\r\n */\r\nfunction createCache() {\r\n\tvar keys = [];\r\n\r\n\tfunction cache( key, value ) {\r\n\t\t// Use (key + \" \") to avoid collision with native prototype properties (see Issue #157)\r\n\t\tif ( keys.push( key + \" \" ) > Expr.cacheLength ) {\r\n\t\t\t// Only keep the most recent entries\r\n\t\t\tdelete cache[ keys.shift() ];\r\n\t\t}\r\n\t\treturn (cache[ key + \" \" ] = value);\r\n\t}\r\n\treturn cache;\r\n}\r\n\r\n/**\r\n * Mark a function for special use by Sizzle\r\n * @param {Function} fn The function to mark\r\n */\r\nfunction markFunction( fn ) {\r\n\tfn[ expando ] = true;\r\n\treturn fn;\r\n}\r\n\r\n/**\r\n * Support testing using an element\r\n * @param {Function} fn Passed the created div and expects a boolean result\r\n */\r\nfunction assert( fn ) {\r\n\tvar div = document.createElement(\"div\");\r\n\r\n\ttry {\r\n\t\treturn !!fn( div );\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t} finally {\r\n\t\t// Remove from its parent by default\r\n\t\tif ( div.parentNode ) {\r\n\t\t\tdiv.parentNode.removeChild( div );\r\n\t\t}\r\n\t\t// release memory in IE\r\n\t\tdiv = null;\r\n\t}\r\n}\r\n\r\n/**\r\n * Adds the same handler for all of the specified attrs\r\n * @param {String} attrs Pipe-separated list of attributes\r\n * @param {Function} handler The method that will be applied\r\n */\r\nfunction addHandle( attrs, handler ) {\r\n\tvar arr = attrs.split(\"|\"),\r\n\t\ti = attrs.length;\r\n\r\n\twhile ( i-- ) {\r\n\t\tExpr.attrHandle[ arr[i] ] = handler;\r\n\t}\r\n}\r\n\r\n/**\r\n * Checks document order of two siblings\r\n * @param {Element} a\r\n * @param {Element} b\r\n * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b\r\n */\r\nfunction siblingCheck( a, b ) {\r\n\tvar cur = b && a,\r\n\t\tdiff = cur && a.nodeType === 1 && b.nodeType === 1 &&\r\n\t\t\t( ~b.sourceIndex || MAX_NEGATIVE ) -\r\n\t\t\t( ~a.sourceIndex || MAX_NEGATIVE );\r\n\r\n\t// Use IE sourceIndex if available on both nodes\r\n\tif ( diff ) {\r\n\t\treturn diff;\r\n\t}\r\n\r\n\t// Check if b follows a\r\n\tif ( cur ) {\r\n\t\twhile ( (cur = cur.nextSibling) ) {\r\n\t\t\tif ( cur === b ) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn a ? 1 : -1;\r\n}\r\n\r\n/**\r\n * Returns a function to use in pseudos for input types\r\n * @param {String} type\r\n */\r\nfunction createInputPseudo( type ) {\r\n\treturn function( elem ) {\r\n\t\tvar name = elem.nodeName.toLowerCase();\r\n\t\treturn name === \"input\" && elem.type === type;\r\n\t};\r\n}\r\n\r\n/**\r\n * Returns a function to use in pseudos for buttons\r\n * @param {String} type\r\n */\r\nfunction createButtonPseudo( type ) {\r\n\treturn function( elem ) {\r\n\t\tvar name = elem.nodeName.toLowerCase();\r\n\t\treturn (name === \"input\" || name === \"button\") && elem.type === type;\r\n\t};\r\n}\r\n\r\n/**\r\n * Returns a function to use in pseudos for positionals\r\n * @param {Function} fn\r\n */\r\nfunction createPositionalPseudo( fn ) {\r\n\treturn markFunction(function( argument ) {\r\n\t\targument = +argument;\r\n\t\treturn markFunction(function( seed, matches ) {\r\n\t\t\tvar j,\r\n\t\t\t\tmatchIndexes = fn( [], seed.length, argument ),\r\n\t\t\t\ti = matchIndexes.length;\r\n\r\n\t\t\t// Match elements found at the specified indexes\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\tif ( seed[ (j = matchIndexes[i]) ] ) {\r\n\t\t\t\t\tseed[j] = !(matches[j] = seed[j]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n/**\r\n * Checks a node for validity as a Sizzle context\r\n * @param {Element|Object=} context\r\n * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value\r\n */\r\nfunction testContext( context ) {\r\n\treturn context && typeof context.getElementsByTagName !== strundefined && context;\r\n}\r\n\r\n// Expose support vars for convenience\r\nsupport = Sizzle.support = {};\r\n\r\n/**\r\n * Detects XML nodes\r\n * @param {Element|Object} elem An element or a document\r\n * @returns {Boolean} True iff elem is a non-HTML XML node\r\n */\r\nisXML = Sizzle.isXML = function( elem ) {\r\n\t// documentElement is verified for cases where it doesn't yet exist\r\n\t// (such as loading iframes in IE - #4833)\r\n\tvar documentElement = elem && (elem.ownerDocument || elem).documentElement;\r\n\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n};\r\n\r\n/**\r\n * Sets document-related variables once based on the current document\r\n * @param {Element|Object} [doc] An element or document object to use to set the document\r\n * @returns {Object} Returns the current document\r\n */\r\nsetDocument = Sizzle.setDocument = function( node ) {\r\n\tvar hasCompare,\r\n\t\tdoc = node ? node.ownerDocument || node : preferredDoc,\r\n\t\tparent = doc.defaultView;\r\n\r\n\tfunction getTop(win) {\r\n\t\t// Edge throws a lovely Object expected if you try to get top on a detached reference see #2642\r\n\t\ttry {\r\n\t\t\treturn win.top;\r\n\t\t} catch (ex) {\r\n\t\t\t// Ignore\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// If no document and documentElement is available, return\r\n\tif ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {\r\n\t\treturn document;\r\n\t}\r\n\r\n\t// Set our document\r\n\tdocument = doc;\r\n\tdocElem = doc.documentElement;\r\n\r\n\t// Support tests\r\n\tdocumentIsHTML = !isXML( doc );\r\n\r\n\t// Support: IE>8\r\n\t// If iframe document is assigned to \"document\" variable and if iframe has been reloaded,\r\n\t// IE will throw \"permission denied\" error when accessing \"document\" variable, see jQuery #13936\r\n\t// IE6-8 do not support the defaultView property so parent will be undefined\r\n\tif ( parent && parent !== getTop(parent) ) {\r\n\t\t// IE11 does not have attachEvent, so all must suffer\r\n\t\tif ( parent.addEventListener ) {\r\n\t\t\tparent.addEventListener( \"unload\", function() {\r\n\t\t\t\tsetDocument();\r\n\t\t\t}, false );\r\n\t\t} else if ( parent.attachEvent ) {\r\n\t\t\tparent.attachEvent( \"onunload\", function() {\r\n\t\t\t\tsetDocument();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/* Attributes\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// Support: IE<8\r\n\t// Verify that getAttribute really returns attributes and not properties (excepting IE8 booleans)\r\n\tsupport.attributes = assert(function( div ) {\r\n\t\tdiv.className = \"i\";\r\n\t\treturn !div.getAttribute(\"className\");\r\n\t});\r\n\r\n\t/* getElement(s)By*\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// Check if getElementsByTagName(\"*\") returns only elements\r\n\tsupport.getElementsByTagName = assert(function( div ) {\r\n\t\tdiv.appendChild( doc.createComment(\"\") );\r\n\t\treturn !div.getElementsByTagName(\"*\").length;\r\n\t});\r\n\r\n\t// Support: IE<9\r\n\tsupport.getElementsByClassName = rnative.test( doc.getElementsByClassName );\r\n\r\n\t// Support: IE<10\r\n\t// Check if getElementById returns elements by name\r\n\t// The broken getElementById methods don't pick up programatically-set names,\r\n\t// so use a roundabout getElementsByName test\r\n\tsupport.getById = assert(function( div ) {\r\n\t\tdocElem.appendChild( div ).id = expando;\r\n\t\treturn !doc.getElementsByName || !doc.getElementsByName( expando ).length;\r\n\t});\r\n\r\n\t// ID find and filter\r\n\tif ( support.getById ) {\r\n\t\tExpr.find[\"ID\"] = function( id, context ) {\r\n\t\t\tif ( typeof context.getElementById !== strundefined && documentIsHTML ) {\r\n\t\t\t\tvar m = context.getElementById( id );\r\n\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\r\n\t\t\t\t// nodes that are no longer in the document #6963\r\n\t\t\t\treturn m && m.parentNode ? [ m ] : [];\r\n\t\t\t}\r\n\t\t};\r\n\t\tExpr.filter[\"ID\"] = function( id ) {\r\n\t\t\tvar attrId = id.replace( runescape, funescape );\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\treturn elem.getAttribute(\"id\") === attrId;\r\n\t\t\t};\r\n\t\t};\r\n\t} else {\r\n\t\t// Support: IE6/7\r\n\t\t// getElementById is not reliable as a find shortcut\r\n\t\tdelete Expr.find[\"ID\"];\r\n\r\n\t\tExpr.filter[\"ID\"] =  function( id ) {\r\n\t\t\tvar attrId = id.replace( runescape, funescape );\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\tvar node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode(\"id\");\r\n\t\t\t\treturn node && node.value === attrId;\r\n\t\t\t};\r\n\t\t};\r\n\t}\r\n\r\n\t// Tag\r\n\tExpr.find[\"TAG\"] = support.getElementsByTagName ?\r\n\t\tfunction( tag, context ) {\r\n\t\t\tif ( typeof context.getElementsByTagName !== strundefined ) {\r\n\t\t\t\treturn context.getElementsByTagName( tag );\r\n\t\t\t}\r\n\t\t} :\r\n\t\tfunction( tag, context ) {\r\n\t\t\tvar elem,\r\n\t\t\t\ttmp = [],\r\n\t\t\t\ti = 0,\r\n\t\t\t\tresults = context.getElementsByTagName( tag );\r\n\r\n\t\t\t// Filter out possible comments\r\n\t\t\tif ( tag === \"*\" ) {\r\n\t\t\t\twhile ( (elem = results[i++]) ) {\r\n\t\t\t\t\tif ( elem.nodeType === 1 ) {\r\n\t\t\t\t\t\ttmp.push( elem );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn tmp;\r\n\t\t\t}\r\n\t\t\treturn results;\r\n\t\t};\r\n\r\n\t// Class\r\n\tExpr.find[\"CLASS\"] = support.getElementsByClassName && function( className, context ) {\r\n\t\tif ( documentIsHTML ) {\r\n\t\t\treturn context.getElementsByClassName( className );\r\n\t\t}\r\n\t};\r\n\r\n\t/* QSA/matchesSelector\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// QSA and matchesSelector support\r\n\r\n\t// matchesSelector(:active) reports false when true (IE9/Opera 11.5)\r\n\trbuggyMatches = [];\r\n\r\n\t// qSa(:focus) reports false when true (Chrome 21)\r\n\t// We allow this because of a bug in IE8/9 that throws an error\r\n\t// whenever `document.activeElement` is accessed on an iframe\r\n\t// So, we allow :focus to pass through QSA all the time to avoid the IE error\r\n\t// See http://bugs.jquery.com/ticket/13378\r\n\trbuggyQSA = [];\r\n\r\n\tif ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {\r\n\t\t// Build QSA regex\r\n\t\t// Regex strategy adopted from Diego Perini\r\n\t\tassert(function( div ) {\r\n\t\t\t// Select is set to empty string on purpose\r\n\t\t\t// This is to test IE's treatment of not explicitly\r\n\t\t\t// setting a boolean content attribute,\r\n\t\t\t// since its presence should be enough\r\n\t\t\t// http://bugs.jquery.com/ticket/12359\r\n\t\t\tdiv.innerHTML = \"<select msallowcapture=''><option selected=''></option></select>\";\r\n\r\n\t\t\t// Support: IE8, Opera 11-12.16\r\n\t\t\t// Nothing should be selected when empty strings follow ^= or $= or *=\r\n\t\t\t// The test attribute must be unknown in Opera but \"safe\" for WinRT\r\n\t\t\t// http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section\r\n\t\t\tif ( div.querySelectorAll(\"[msallowcapture^='']\").length ) {\r\n\t\t\t\trbuggyQSA.push( \"[*^$]=\" + whitespace + \"*(?:''|\\\"\\\")\" );\r\n\t\t\t}\r\n\r\n\t\t\t// Support: IE8\r\n\t\t\t// Boolean attributes and \"value\" are not treated correctly\r\n\t\t\tif ( !div.querySelectorAll(\"[selected]\").length ) {\r\n\t\t\t\trbuggyQSA.push( \"\\\\[\" + whitespace + \"*(?:value|\" + booleans + \")\" );\r\n\t\t\t}\r\n\r\n\t\t\t// Webkit/Opera - :checked should return selected option elements\r\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\r\n\t\t\t// IE8 throws error here and will not see later tests\r\n\t\t\tif ( !div.querySelectorAll(\":checked\").length ) {\r\n\t\t\t\trbuggyQSA.push(\":checked\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassert(function( div ) {\r\n\t\t\t// Support: Windows 8 Native Apps\r\n\t\t\t// The type and name attributes are restricted during .innerHTML assignment\r\n\t\t\tvar input = doc.createElement(\"input\");\r\n\t\t\tinput.setAttribute( \"type\", \"hidden\" );\r\n\t\t\tdiv.appendChild( input ).setAttribute( \"name\", \"D\" );\r\n\r\n\t\t\t// Support: IE8\r\n\t\t\t// Enforce case-sensitivity of name attribute\r\n\t\t\tif ( div.querySelectorAll(\"[name=d]\").length ) {\r\n\t\t\t\trbuggyQSA.push( \"name\" + whitespace + \"*[*^$|!~]?=\" );\r\n\t\t\t}\r\n\r\n\t\t\t// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)\r\n\t\t\t// IE8 throws error here and will not see later tests\r\n\t\t\tif ( !div.querySelectorAll(\":enabled\").length ) {\r\n\t\t\t\trbuggyQSA.push( \":enabled\", \":disabled\" );\r\n\t\t\t}\r\n\r\n\t\t\t// Opera 10-11 does not throw on post-comma invalid pseudos\r\n\t\t\tdiv.querySelectorAll(\"*,:x\");\r\n\t\t\trbuggyQSA.push(\",.*:\");\r\n\t\t});\r\n\t}\r\n\r\n\tif ( (support.matchesSelector = rnative.test( (matches = docElem.matches ||\r\n\t\tdocElem.webkitMatchesSelector ||\r\n\t\tdocElem.mozMatchesSelector ||\r\n\t\tdocElem.oMatchesSelector ||\r\n\t\tdocElem.msMatchesSelector) )) ) {\r\n\r\n\t\tassert(function( div ) {\r\n\t\t\t// Check to see if it's possible to do matchesSelector\r\n\t\t\t// on a disconnected node (IE 9)\r\n\t\t\tsupport.disconnectedMatch = matches.call( div, \"div\" );\r\n\r\n\t\t\t// This should fail with an exception\r\n\t\t\t// Gecko does not error, returns false instead\r\n\t\t\tmatches.call( div, \"[s!='']:x\" );\r\n\t\t\trbuggyMatches.push( \"!=\", pseudos );\r\n\t\t});\r\n\t}\r\n\r\n\trbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join(\"|\") );\r\n\trbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join(\"|\") );\r\n\r\n\t/* Contains\r\n\t---------------------------------------------------------------------- */\r\n\thasCompare = rnative.test( docElem.compareDocumentPosition );\r\n\r\n\t// Element contains another\r\n\t// Purposefully does not implement inclusive descendent\r\n\t// As in, an element does not contain itself\r\n\tcontains = hasCompare || rnative.test( docElem.contains ) ?\r\n\t\tfunction( a, b ) {\r\n\t\t\tvar adown = a.nodeType === 9 ? a.documentElement : a,\r\n\t\t\t\tbup = b && b.parentNode;\r\n\t\t\treturn a === bup || !!( bup && bup.nodeType === 1 && (\r\n\t\t\t\tadown.contains ?\r\n\t\t\t\t\tadown.contains( bup ) :\r\n\t\t\t\t\ta.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16\r\n\t\t\t));\r\n\t\t} :\r\n\t\tfunction( a, b ) {\r\n\t\t\tif ( b ) {\r\n\t\t\t\twhile ( (b = b.parentNode) ) {\r\n\t\t\t\t\tif ( b === a ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t/* Sorting\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// Document order sorting\r\n\tsortOrder = hasCompare ?\r\n\tfunction( a, b ) {\r\n\r\n\t\t// Flag for duplicate removal\r\n\t\tif ( a === b ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\t// Sort on method existence if only one input has compareDocumentPosition\r\n\t\tvar compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\r\n\t\tif ( compare ) {\r\n\t\t\treturn compare;\r\n\t\t}\r\n\r\n\t\t// Calculate position if both inputs belong to the same document\r\n\t\tcompare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?\r\n\t\t\ta.compareDocumentPosition( b ) :\r\n\r\n\t\t\t// Otherwise we know they are disconnected\r\n\t\t\t1;\r\n\r\n\t\t// Disconnected nodes\r\n\t\tif ( compare & 1 ||\r\n\t\t\t(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {\r\n\r\n\t\t\t// Choose the first element that is related to our preferred document\r\n\t\t\tif ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tif ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\r\n\t\t\t// Maintain original order\r\n\t\t\treturn sortInput ?\r\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\r\n\t\t\t\t0;\r\n\t\t}\r\n\r\n\t\treturn compare & 4 ? -1 : 1;\r\n\t} :\r\n\tfunction( a, b ) {\r\n\t\t// Exit early if the nodes are identical\r\n\t\tif ( a === b ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tvar cur,\r\n\t\t\ti = 0,\r\n\t\t\taup = a.parentNode,\r\n\t\t\tbup = b.parentNode,\r\n\t\t\tap = [ a ],\r\n\t\t\tbp = [ b ];\r\n\r\n\t\t// Parentless nodes are either documents or disconnected\r\n\t\tif ( !aup || !bup ) {\r\n\t\t\treturn a === doc ? -1 :\r\n\t\t\t\tb === doc ? 1 :\r\n\t\t\t\taup ? -1 :\r\n\t\t\t\tbup ? 1 :\r\n\t\t\t\tsortInput ?\r\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\r\n\t\t\t\t0;\r\n\r\n\t\t// If the nodes are siblings, we can do a quick check\r\n\t\t} else if ( aup === bup ) {\r\n\t\t\treturn siblingCheck( a, b );\r\n\t\t}\r\n\r\n\t\t// Otherwise we need full lists of their ancestors for comparison\r\n\t\tcur = a;\r\n\t\twhile ( (cur = cur.parentNode) ) {\r\n\t\t\tap.unshift( cur );\r\n\t\t}\r\n\t\tcur = b;\r\n\t\twhile ( (cur = cur.parentNode) ) {\r\n\t\t\tbp.unshift( cur );\r\n\t\t}\r\n\r\n\t\t// Walk down the tree looking for a discrepancy\r\n\t\twhile ( ap[i] === bp[i] ) {\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\treturn i ?\r\n\t\t\t// Do a sibling check if the nodes have a common ancestor\r\n\t\t\tsiblingCheck( ap[i], bp[i] ) :\r\n\r\n\t\t\t// Otherwise nodes in our document sort first\r\n\t\t\tap[i] === preferredDoc ? -1 :\r\n\t\t\tbp[i] === preferredDoc ? 1 :\r\n\t\t\t0;\r\n\t};\r\n\r\n\treturn doc;\r\n};\r\n\r\nSizzle.matches = function( expr, elements ) {\r\n\treturn Sizzle( expr, null, null, elements );\r\n};\r\n\r\nSizzle.matchesSelector = function( elem, expr ) {\r\n\t// Set document vars if needed\r\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\r\n\t\tsetDocument( elem );\r\n\t}\r\n\r\n\t// Make sure that attribute selectors are quoted\r\n\texpr = expr.replace( rattributeQuotes, \"='$1']\" );\r\n\r\n\tif ( support.matchesSelector && documentIsHTML &&\r\n\t\t( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&\r\n\t\t( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {\r\n\r\n\t\ttry {\r\n\t\t\tvar ret = matches.call( elem, expr );\r\n\r\n\t\t\t// IE 9's matchesSelector returns false on disconnected nodes\r\n\t\t\tif ( ret || support.disconnectedMatch ||\r\n\t\t\t\t\t// As well, disconnected nodes are said to be in a document\r\n\t\t\t\t\t// fragment in IE 9\r\n\t\t\t\t\telem.document && elem.document.nodeType !== 11 ) {\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t} catch(e) {}\r\n\t}\r\n\r\n\treturn Sizzle( expr, document, null, [ elem ] ).length > 0;\r\n};\r\n\r\nSizzle.contains = function( context, elem ) {\r\n\t// Set document vars if needed\r\n\tif ( ( context.ownerDocument || context ) !== document ) {\r\n\t\tsetDocument( context );\r\n\t}\r\n\treturn contains( context, elem );\r\n};\r\n\r\nSizzle.attr = function( elem, name ) {\r\n\t// Set document vars if needed\r\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\r\n\t\tsetDocument( elem );\r\n\t}\r\n\r\n\tvar fn = Expr.attrHandle[ name.toLowerCase() ],\r\n\t\t// Don't get fooled by Object.prototype properties (jQuery #13807)\r\n\t\tval = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?\r\n\t\t\tfn( elem, name, !documentIsHTML ) :\r\n\t\t\tundefined;\r\n\r\n\treturn val !== undefined ?\r\n\t\tval :\r\n\t\tsupport.attributes || !documentIsHTML ?\r\n\t\t\telem.getAttribute( name ) :\r\n\t\t\t(val = elem.getAttributeNode(name)) && val.specified ?\r\n\t\t\t\tval.value :\r\n\t\t\t\tnull;\r\n};\r\n\r\nSizzle.error = function( msg ) {\r\n\tthrow new Error( \"Syntax error, unrecognized expression: \" + msg );\r\n};\r\n\r\n/**\r\n * Document sorting and removing duplicates\r\n * @param {ArrayLike} results\r\n */\r\nSizzle.uniqueSort = function( results ) {\r\n\tvar elem,\r\n\t\tduplicates = [],\r\n\t\tj = 0,\r\n\t\ti = 0;\r\n\r\n\t// Unless we *know* we can detect duplicates, assume their presence\r\n\thasDuplicate = !support.detectDuplicates;\r\n\tsortInput = !support.sortStable && results.slice( 0 );\r\n\tresults.sort( sortOrder );\r\n\r\n\tif ( hasDuplicate ) {\r\n\t\twhile ( (elem = results[i++]) ) {\r\n\t\t\tif ( elem === results[ i ] ) {\r\n\t\t\t\tj = duplicates.push( i );\r\n\t\t\t}\r\n\t\t}\r\n\t\twhile ( j-- ) {\r\n\t\t\tresults.splice( duplicates[ j ], 1 );\r\n\t\t}\r\n\t}\r\n\r\n\t// Clear input after sorting to release objects\r\n\t// See https://github.com/jquery/sizzle/pull/225\r\n\tsortInput = null;\r\n\r\n\treturn results;\r\n};\r\n\r\n/**\r\n * Utility function for retrieving the text value of an array of DOM nodes\r\n * @param {Array|Element} elem\r\n */\r\ngetText = Sizzle.getText = function( elem ) {\r\n\tvar node,\r\n\t\tret = \"\",\r\n\t\ti = 0,\r\n\t\tnodeType = elem.nodeType;\r\n\r\n\tif ( !nodeType ) {\r\n\t\t// If no nodeType, this is expected to be an array\r\n\t\twhile ( (node = elem[i++]) ) {\r\n\t\t\t// Do not traverse comment nodes\r\n\t\t\tret += getText( node );\r\n\t\t}\r\n\t} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\r\n\t\t// Use textContent for elements\r\n\t\t// innerText usage removed for consistency of new lines (jQuery #11153)\r\n\t\tif ( typeof elem.textContent === \"string\" ) {\r\n\t\t\treturn elem.textContent;\r\n\t\t} else {\r\n\t\t\t// Traverse its children\r\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\r\n\t\t\t\tret += getText( elem );\r\n\t\t\t}\r\n\t\t}\r\n\t} else if ( nodeType === 3 || nodeType === 4 ) {\r\n\t\treturn elem.nodeValue;\r\n\t}\r\n\t// Do not include comment or processing instruction nodes\r\n\r\n\treturn ret;\r\n};\r\n\r\nExpr = Sizzle.selectors = {\r\n\r\n\t// Can be adjusted by the user\r\n\tcacheLength: 50,\r\n\r\n\tcreatePseudo: markFunction,\r\n\r\n\tmatch: matchExpr,\r\n\r\n\tattrHandle: {},\r\n\r\n\tfind: {},\r\n\r\n\trelative: {\r\n\t\t\">\": { dir: \"parentNode\", first: true },\r\n\t\t\" \": { dir: \"parentNode\" },\r\n\t\t\"+\": { dir: \"previousSibling\", first: true },\r\n\t\t\"~\": { dir: \"previousSibling\" }\r\n\t},\r\n\r\n\tpreFilter: {\r\n\t\t\"ATTR\": function( match ) {\r\n\t\t\tmatch[1] = match[1].replace( runescape, funescape );\r\n\r\n\t\t\t// Move the given value to match[3] whether quoted or unquoted\r\n\t\t\tmatch[3] = ( match[3] || match[4] || match[5] || \"\" ).replace( runescape, funescape );\r\n\r\n\t\t\tif ( match[2] === \"~=\" ) {\r\n\t\t\t\tmatch[3] = \" \" + match[3] + \" \";\r\n\t\t\t}\r\n\r\n\t\t\treturn match.slice( 0, 4 );\r\n\t\t},\r\n\r\n\t\t\"CHILD\": function( match ) {\r\n\t\t\t/* matches from matchExpr[\"CHILD\"]\r\n\t\t\t\t1 type (only|nth|...)\r\n\t\t\t\t2 what (child|of-type)\r\n\t\t\t\t3 argument (even|odd|\\d*|\\d*n([+-]\\d+)?|...)\r\n\t\t\t\t4 xn-component of xn+y argument ([+-]?\\d*n|)\r\n\t\t\t\t5 sign of xn-component\r\n\t\t\t\t6 x of xn-component\r\n\t\t\t\t7 sign of y-component\r\n\t\t\t\t8 y of y-component\r\n\t\t\t*/\r\n\t\t\tmatch[1] = match[1].toLowerCase();\r\n\r\n\t\t\tif ( match[1].slice( 0, 3 ) === \"nth\" ) {\r\n\t\t\t\t// nth-* requires argument\r\n\t\t\t\tif ( !match[3] ) {\r\n\t\t\t\t\tSizzle.error( match[0] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// numeric x and y parameters for Expr.filter.CHILD\r\n\t\t\t\t// remember that false/true cast respectively to 0/1\r\n\t\t\t\tmatch[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === \"even\" || match[3] === \"odd\" ) );\r\n\t\t\t\tmatch[5] = +( ( match[7] + match[8] ) || match[3] === \"odd\" );\r\n\r\n\t\t\t// other types prohibit arguments\r\n\t\t\t} else if ( match[3] ) {\r\n\t\t\t\tSizzle.error( match[0] );\r\n\t\t\t}\r\n\r\n\t\t\treturn match;\r\n\t\t},\r\n\r\n\t\t\"PSEUDO\": function( match ) {\r\n\t\t\tvar excess,\r\n\t\t\t\tunquoted = !match[6] && match[2];\r\n\r\n\t\t\tif ( matchExpr[\"CHILD\"].test( match[0] ) ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\t// Accept quoted arguments as-is\r\n\t\t\tif ( match[3] ) {\r\n\t\t\t\tmatch[2] = match[4] || match[5] || \"\";\r\n\r\n\t\t\t// Strip excess characters from unquoted arguments\r\n\t\t\t} else if ( unquoted && rpseudo.test( unquoted ) &&\r\n\t\t\t\t// Get excess from tokenize (recursively)\r\n\t\t\t\t(excess = tokenize( unquoted, true )) &&\r\n\t\t\t\t// advance to the next closing parenthesis\r\n\t\t\t\t(excess = unquoted.indexOf( \")\", unquoted.length - excess ) - unquoted.length) ) {\r\n\r\n\t\t\t\t// excess is a negative index\r\n\t\t\t\tmatch[0] = match[0].slice( 0, excess );\r\n\t\t\t\tmatch[2] = unquoted.slice( 0, excess );\r\n\t\t\t}\r\n\r\n\t\t\t// Return only captures needed by the pseudo filter method (type and argument)\r\n\t\t\treturn match.slice( 0, 3 );\r\n\t\t}\r\n\t},\r\n\r\n\tfilter: {\r\n\r\n\t\t\"TAG\": function( nodeNameSelector ) {\r\n\t\t\tvar nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();\r\n\t\t\treturn nodeNameSelector === \"*\" ?\r\n\t\t\t\tfunction() { return true; } :\r\n\t\t\t\tfunction( elem ) {\r\n\t\t\t\t\treturn elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\r\n\t\t\t\t};\r\n\t\t},\r\n\r\n\t\t\"CLASS\": function( className ) {\r\n\t\t\tvar pattern = classCache[ className + \" \" ];\r\n\r\n\t\t\treturn pattern ||\r\n\t\t\t\t(pattern = new RegExp( \"(^|\" + whitespace + \")\" + className + \"(\" + whitespace + \"|$)\" )) &&\r\n\t\t\t\tclassCache( className, function( elem ) {\r\n\t\t\t\t\treturn pattern.test( typeof elem.className === \"string\" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute(\"class\") || \"\" );\r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\t\"ATTR\": function( name, operator, check ) {\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\tvar result = Sizzle.attr( elem, name );\r\n\r\n\t\t\t\tif ( result == null ) {\r\n\t\t\t\t\treturn operator === \"!=\";\r\n\t\t\t\t}\r\n\t\t\t\tif ( !operator ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresult += \"\";\r\n\r\n\t\t\t\treturn operator === \"=\" ? result === check :\r\n\t\t\t\t\toperator === \"!=\" ? result !== check :\r\n\t\t\t\t\toperator === \"^=\" ? check && result.indexOf( check ) === 0 :\r\n\t\t\t\t\toperator === \"*=\" ? check && result.indexOf( check ) > -1 :\r\n\t\t\t\t\toperator === \"$=\" ? check && result.slice( -check.length ) === check :\r\n\t\t\t\t\toperator === \"~=\" ? ( \" \" + result + \" \" ).indexOf( check ) > -1 :\r\n\t\t\t\t\toperator === \"|=\" ? result === check || result.slice( 0, check.length + 1 ) === check + \"-\" :\r\n\t\t\t\t\tfalse;\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t\"CHILD\": function( type, what, argument, first, last ) {\r\n\t\t\tvar simple = type.slice( 0, 3 ) !== \"nth\",\r\n\t\t\t\tforward = type.slice( -4 ) !== \"last\",\r\n\t\t\t\tofType = what === \"of-type\";\r\n\r\n\t\t\treturn first === 1 && last === 0 ?\r\n\r\n\t\t\t\t// Shortcut for :nth-*(n)\r\n\t\t\t\tfunction( elem ) {\r\n\t\t\t\t\treturn !!elem.parentNode;\r\n\t\t\t\t} :\r\n\r\n\t\t\t\tfunction( elem, context, xml ) {\r\n\t\t\t\t\tvar cache, outerCache, node, diff, nodeIndex, start,\r\n\t\t\t\t\t\tdir = simple !== forward ? \"nextSibling\" : \"previousSibling\",\r\n\t\t\t\t\t\tparent = elem.parentNode,\r\n\t\t\t\t\t\tname = ofType && elem.nodeName.toLowerCase(),\r\n\t\t\t\t\t\tuseCache = !xml && !ofType;\r\n\r\n\t\t\t\t\tif ( parent ) {\r\n\r\n\t\t\t\t\t\t// :(first|last|only)-(child|of-type)\r\n\t\t\t\t\t\tif ( simple ) {\r\n\t\t\t\t\t\t\twhile ( dir ) {\r\n\t\t\t\t\t\t\t\tnode = elem;\r\n\t\t\t\t\t\t\t\twhile ( (node = node[ dir ]) ) {\r\n\t\t\t\t\t\t\t\t\tif ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// Reverse direction for :only-* (if we haven't yet done so)\r\n\t\t\t\t\t\t\t\tstart = dir = type === \"only\" && !start && \"nextSibling\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstart = [ forward ? parent.firstChild : parent.lastChild ];\r\n\r\n\t\t\t\t\t\t// non-xml :nth-child(...) stores cache data on `parent`\r\n\t\t\t\t\t\tif ( forward && useCache ) {\r\n\t\t\t\t\t\t\t// Seek `elem` from a previously-cached index\r\n\t\t\t\t\t\t\touterCache = parent[ expando ] || (parent[ expando ] = {});\r\n\t\t\t\t\t\t\tcache = outerCache[ type ] || [];\r\n\t\t\t\t\t\t\tnodeIndex = cache[0] === dirruns && cache[1];\r\n\t\t\t\t\t\t\tdiff = cache[0] === dirruns && cache[2];\r\n\t\t\t\t\t\t\tnode = nodeIndex && parent.childNodes[ nodeIndex ];\r\n\r\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\r\n\r\n\t\t\t\t\t\t\t\t// Fallback to seeking `elem` from the start\r\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\r\n\r\n\t\t\t\t\t\t\t\t// When found, cache indexes on `parent` and break\r\n\t\t\t\t\t\t\t\tif ( node.nodeType === 1 && ++diff && node === elem ) {\r\n\t\t\t\t\t\t\t\t\touterCache[ type ] = [ dirruns, nodeIndex, diff ];\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Use previously-cached element index if available\r\n\t\t\t\t\t\t} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {\r\n\t\t\t\t\t\t\tdiff = cache[1];\r\n\r\n\t\t\t\t\t\t// xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Use the same loop as above to seek `elem` from the start\r\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\r\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {\r\n\t\t\t\t\t\t\t\t\t// Cache the index of each encountered element\r\n\t\t\t\t\t\t\t\t\tif ( useCache ) {\r\n\t\t\t\t\t\t\t\t\t\t(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif ( node === elem ) {\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Incorporate the offset, then check against cycle size\r\n\t\t\t\t\t\tdiff -= last;\r\n\t\t\t\t\t\treturn diff === first || ( diff % first === 0 && diff / first >= 0 );\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t},\r\n\r\n\t\t\"PSEUDO\": function( pseudo, argument ) {\r\n\t\t\t// pseudo-class names are case-insensitive\r\n\t\t\t// http://www.w3.org/TR/selectors/#pseudo-classes\r\n\t\t\t// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters\r\n\t\t\t// Remember that setFilters inherits from pseudos\r\n\t\t\tvar args,\r\n\t\t\t\tfn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||\r\n\t\t\t\t\tSizzle.error( \"unsupported pseudo: \" + pseudo );\r\n\r\n\t\t\t// The user may use createPseudo to indicate that\r\n\t\t\t// arguments are needed to create the filter function\r\n\t\t\t// just as Sizzle does\r\n\t\t\tif ( fn[ expando ] ) {\r\n\t\t\t\treturn fn( argument );\r\n\t\t\t}\r\n\r\n\t\t\t// But maintain support for old signatures\r\n\t\t\tif ( fn.length > 1 ) {\r\n\t\t\t\targs = [ pseudo, pseudo, \"\", argument ];\r\n\t\t\t\treturn Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?\r\n\t\t\t\t\tmarkFunction(function( seed, matches ) {\r\n\t\t\t\t\t\tvar idx,\r\n\t\t\t\t\t\t\tmatched = fn( seed, argument ),\r\n\t\t\t\t\t\t\ti = matched.length;\r\n\t\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\t\tidx = indexOf.call( seed, matched[i] );\r\n\t\t\t\t\t\t\tseed[ idx ] = !( matches[ idx ] = matched[i] );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}) :\r\n\t\t\t\t\tfunction( elem ) {\r\n\t\t\t\t\t\treturn fn( elem, 0, args );\r\n\t\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn fn;\r\n\t\t}\r\n\t},\r\n\r\n\tpseudos: {\r\n\t\t// Potentially complex pseudos\r\n\t\t\"not\": markFunction(function( selector ) {\r\n\t\t\t// Trim the selector passed to compile\r\n\t\t\t// to avoid treating leading and trailing\r\n\t\t\t// spaces as combinators\r\n\t\t\tvar input = [],\r\n\t\t\t\tresults = [],\r\n\t\t\t\tmatcher = compile( selector.replace( rtrim, \"$1\" ) );\r\n\r\n\t\t\treturn matcher[ expando ] ?\r\n\t\t\t\tmarkFunction(function( seed, matches, context, xml ) {\r\n\t\t\t\t\tvar elem,\r\n\t\t\t\t\t\tunmatched = matcher( seed, null, xml, [] ),\r\n\t\t\t\t\t\ti = seed.length;\r\n\r\n\t\t\t\t\t// Match elements unmatched by `matcher`\r\n\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\tif ( (elem = unmatched[i]) ) {\r\n\t\t\t\t\t\t\tseed[i] = !(matches[i] = elem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}) :\r\n\t\t\t\tfunction( elem, context, xml ) {\r\n\t\t\t\t\tinput[0] = elem;\r\n\t\t\t\t\tmatcher( input, null, xml, results );\r\n\t\t\t\t\treturn !results.pop();\r\n\t\t\t\t};\r\n\t\t}),\r\n\r\n\t\t\"has\": markFunction(function( selector ) {\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\treturn Sizzle( selector, elem ).length > 0;\r\n\t\t\t};\r\n\t\t}),\r\n\r\n\t\t\"contains\": markFunction(function( text ) {\r\n\t\t\ttext = text.replace( runescape, funescape );\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\treturn ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;\r\n\t\t\t};\r\n\t\t}),\r\n\r\n\t\t// \"Whether an element is represented by a :lang() selector\r\n\t\t// is based solely on the element's language value\r\n\t\t// being equal to the identifier C,\r\n\t\t// or beginning with the identifier C immediately followed by \"-\".\r\n\t\t// The matching of C against the element's language value is performed case-insensitively.\r\n\t\t// The identifier C does not have to be a valid language name.\"\r\n\t\t// http://www.w3.org/TR/selectors/#lang-pseudo\r\n\t\t\"lang\": markFunction( function( lang ) {\r\n\t\t\t// lang value must be a valid identifier\r\n\t\t\tif ( !ridentifier.test(lang || \"\") ) {\r\n\t\t\t\tSizzle.error( \"unsupported lang: \" + lang );\r\n\t\t\t}\r\n\t\t\tlang = lang.replace( runescape, funescape ).toLowerCase();\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\tvar elemLang;\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif ( (elemLang = documentIsHTML ?\r\n\t\t\t\t\t\telem.lang :\r\n\t\t\t\t\t\telem.getAttribute(\"xml:lang\") || elem.getAttribute(\"lang\")) ) {\r\n\r\n\t\t\t\t\t\telemLang = elemLang.toLowerCase();\r\n\t\t\t\t\t\treturn elemLang === lang || elemLang.indexOf( lang + \"-\" ) === 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} while ( (elem = elem.parentNode) && elem.nodeType === 1 );\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t}),\r\n\r\n\t\t// Miscellaneous\r\n\t\t\"target\": function( elem ) {\r\n\t\t\tvar hash = window.location && window.location.hash;\r\n\t\t\treturn hash && hash.slice( 1 ) === elem.id;\r\n\t\t},\r\n\r\n\t\t\"root\": function( elem ) {\r\n\t\t\treturn elem === docElem;\r\n\t\t},\r\n\r\n\t\t\"focus\": function( elem ) {\r\n\t\t\treturn elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\r\n\t\t},\r\n\r\n\t\t// Boolean properties\r\n\t\t\"enabled\": function( elem ) {\r\n\t\t\treturn elem.disabled === false;\r\n\t\t},\r\n\r\n\t\t\"disabled\": function( elem ) {\r\n\t\t\treturn elem.disabled === true;\r\n\t\t},\r\n\r\n\t\t\"checked\": function( elem ) {\r\n\t\t\t// In CSS3, :checked should return both checked and selected elements\r\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\r\n\t\t\tvar nodeName = elem.nodeName.toLowerCase();\r\n\t\t\treturn (nodeName === \"input\" && !!elem.checked) || (nodeName === \"option\" && !!elem.selected);\r\n\t\t},\r\n\r\n\t\t\"selected\": function( elem ) {\r\n\t\t\t// Accessing this property makes selected-by-default\r\n\t\t\t// options in Safari work properly\r\n\t\t\tif ( elem.parentNode ) {\r\n\t\t\t\telem.parentNode.selectedIndex;\r\n\t\t\t}\r\n\r\n\t\t\treturn elem.selected === true;\r\n\t\t},\r\n\r\n\t\t// Contents\r\n\t\t\"empty\": function( elem ) {\r\n\t\t\t// http://www.w3.org/TR/selectors/#empty-pseudo\r\n\t\t\t// :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),\r\n\t\t\t//   but not by others (comment: 8; processing instruction: 7; etc.)\r\n\t\t\t// nodeType < 6 works because attributes (2) do not appear as children\r\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\r\n\t\t\t\tif ( elem.nodeType < 6 ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\t\"parent\": function( elem ) {\r\n\t\t\treturn !Expr.pseudos[\"empty\"]( elem );\r\n\t\t},\r\n\r\n\t\t// Element/input types\r\n\t\t\"header\": function( elem ) {\r\n\t\t\treturn rheader.test( elem.nodeName );\r\n\t\t},\r\n\r\n\t\t\"input\": function( elem ) {\r\n\t\t\treturn rinputs.test( elem.nodeName );\r\n\t\t},\r\n\r\n\t\t\"button\": function( elem ) {\r\n\t\t\tvar name = elem.nodeName.toLowerCase();\r\n\t\t\treturn name === \"input\" && elem.type === \"button\" || name === \"button\";\r\n\t\t},\r\n\r\n\t\t\"text\": function( elem ) {\r\n\t\t\tvar attr;\r\n\t\t\treturn elem.nodeName.toLowerCase() === \"input\" &&\r\n\t\t\t\telem.type === \"text\" &&\r\n\r\n\t\t\t\t// Support: IE<8\r\n\t\t\t\t// New HTML5 attribute values (e.g., \"search\") appear with elem.type === \"text\"\r\n\t\t\t\t( (attr = elem.getAttribute(\"type\")) == null || attr.toLowerCase() === \"text\" );\r\n\t\t},\r\n\r\n\t\t// Position-in-collection\r\n\t\t\"first\": createPositionalPseudo(function() {\r\n\t\t\treturn [ 0 ];\r\n\t\t}),\r\n\r\n\t\t\"last\": createPositionalPseudo(function( matchIndexes, length ) {\r\n\t\t\treturn [ length - 1 ];\r\n\t\t}),\r\n\r\n\t\t\"eq\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n\t\t\treturn [ argument < 0 ? argument + length : argument ];\r\n\t\t}),\r\n\r\n\t\t\"even\": createPositionalPseudo(function( matchIndexes, length ) {\r\n\t\t\tvar i = 0;\r\n\t\t\tfor ( ; i < length; i += 2 ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t}),\r\n\r\n\t\t\"odd\": createPositionalPseudo(function( matchIndexes, length ) {\r\n\t\t\tvar i = 1;\r\n\t\t\tfor ( ; i < length; i += 2 ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t}),\r\n\r\n\t\t\"lt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n\t\t\tvar i = argument < 0 ? argument + length : argument;\r\n\t\t\tfor ( ; --i >= 0; ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t}),\r\n\r\n\t\t\"gt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n\t\t\tvar i = argument < 0 ? argument + length : argument;\r\n\t\t\tfor ( ; ++i < length; ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t})\r\n\t}\r\n};\r\n\r\nExpr.pseudos[\"nth\"] = Expr.pseudos[\"eq\"];\r\n\r\n// Add button/input type pseudos\r\nfor ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {\r\n\tExpr.pseudos[ i ] = createInputPseudo( i );\r\n}\r\nfor ( i in { submit: true, reset: true } ) {\r\n\tExpr.pseudos[ i ] = createButtonPseudo( i );\r\n}\r\n\r\n// Easy API for creating new setFilters\r\nfunction setFilters() {}\r\nsetFilters.prototype = Expr.filters = Expr.pseudos;\r\nExpr.setFilters = new setFilters();\r\n\r\ntokenize = Sizzle.tokenize = function( selector, parseOnly ) {\r\n\tvar matched, match, tokens, type,\r\n\t\tsoFar, groups, preFilters,\r\n\t\tcached = tokenCache[ selector + \" \" ];\r\n\r\n\tif ( cached ) {\r\n\t\treturn parseOnly ? 0 : cached.slice( 0 );\r\n\t}\r\n\r\n\tsoFar = selector;\r\n\tgroups = [];\r\n\tpreFilters = Expr.preFilter;\r\n\r\n\twhile ( soFar ) {\r\n\r\n\t\t// Comma and first run\r\n\t\tif ( !matched || (match = rcomma.exec( soFar )) ) {\r\n\t\t\tif ( match ) {\r\n\t\t\t\t// Don't consume trailing commas as valid\r\n\t\t\t\tsoFar = soFar.slice( match[0].length ) || soFar;\r\n\t\t\t}\r\n\t\t\tgroups.push( (tokens = []) );\r\n\t\t}\r\n\r\n\t\tmatched = false;\r\n\r\n\t\t// Combinators\r\n\t\tif ( (match = rcombinators.exec( soFar )) ) {\r\n\t\t\tmatched = match.shift();\r\n\t\t\ttokens.push({\r\n\t\t\t\tvalue: matched,\r\n\t\t\t\t// Cast descendant combinators to space\r\n\t\t\t\ttype: match[0].replace( rtrim, \" \" )\r\n\t\t\t});\r\n\t\t\tsoFar = soFar.slice( matched.length );\r\n\t\t}\r\n\r\n\t\t// Filters\r\n\t\tfor ( type in Expr.filter ) {\r\n\t\t\tif ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||\r\n\t\t\t\t(match = preFilters[ type ]( match ))) ) {\r\n\t\t\t\tmatched = match.shift();\r\n\t\t\t\ttokens.push({\r\n\t\t\t\t\tvalue: matched,\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tmatches: match\r\n\t\t\t\t});\r\n\t\t\t\tsoFar = soFar.slice( matched.length );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( !matched ) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t// Return the length of the invalid excess\r\n\t// if we're just parsing\r\n\t// Otherwise, throw an error or return tokens\r\n\treturn parseOnly ?\r\n\t\tsoFar.length :\r\n\t\tsoFar ?\r\n\t\t\tSizzle.error( selector ) :\r\n\t\t\t// Cache the tokens\r\n\t\t\ttokenCache( selector, groups ).slice( 0 );\r\n};\r\n\r\nfunction toSelector( tokens ) {\r\n\tvar i = 0,\r\n\t\tlen = tokens.length,\r\n\t\tselector = \"\";\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tselector += tokens[i].value;\r\n\t}\r\n\treturn selector;\r\n}\r\n\r\nfunction addCombinator( matcher, combinator, base ) {\r\n\tvar dir = combinator.dir,\r\n\t\tcheckNonElements = base && dir === \"parentNode\",\r\n\t\tdoneName = done++;\r\n\r\n\treturn combinator.first ?\r\n\t\t// Check against closest ancestor/preceding element\r\n\t\tfunction( elem, context, xml ) {\r\n\t\t\twhile ( (elem = elem[ dir ]) ) {\r\n\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\r\n\t\t\t\t\treturn matcher( elem, context, xml );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} :\r\n\r\n\t\t// Check against all ancestor/preceding elements\r\n\t\tfunction( elem, context, xml ) {\r\n\t\t\tvar oldCache, outerCache,\r\n\t\t\t\tnewCache = [ dirruns, doneName ];\r\n\r\n\t\t\t// We can't set arbitrary data on XML nodes, so they don't benefit from dir caching\r\n\t\t\tif ( xml ) {\r\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\r\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\r\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\r\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\r\n\t\t\t\t\t\touterCache = elem[ expando ] || (elem[ expando ] = {});\r\n\t\t\t\t\t\tif ( (oldCache = outerCache[ dir ]) &&\r\n\t\t\t\t\t\t\toldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {\r\n\r\n\t\t\t\t\t\t\t// Assign to newCache so results back-propagate to previous elements\r\n\t\t\t\t\t\t\treturn (newCache[ 2 ] = oldCache[ 2 ]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Reuse newcache so results back-propagate to previous elements\r\n\t\t\t\t\t\t\touterCache[ dir ] = newCache;\r\n\r\n\t\t\t\t\t\t\t// A match means we're done; a fail means we have to keep checking\r\n\t\t\t\t\t\t\tif ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n}\r\n\r\nfunction elementMatcher( matchers ) {\r\n\treturn matchers.length > 1 ?\r\n\t\tfunction( elem, context, xml ) {\r\n\t\t\tvar i = matchers.length;\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\tif ( !matchers[i]( elem, context, xml ) ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} :\r\n\t\tmatchers[0];\r\n}\r\n\r\nfunction multipleContexts( selector, contexts, results ) {\r\n\tvar i = 0,\r\n\t\tlen = contexts.length;\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tSizzle( selector, contexts[i], results );\r\n\t}\r\n\treturn results;\r\n}\r\n\r\nfunction condense( unmatched, map, filter, context, xml ) {\r\n\tvar elem,\r\n\t\tnewUnmatched = [],\r\n\t\ti = 0,\r\n\t\tlen = unmatched.length,\r\n\t\tmapped = map != null;\r\n\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tif ( (elem = unmatched[i]) ) {\r\n\t\t\tif ( !filter || filter( elem, context, xml ) ) {\r\n\t\t\t\tnewUnmatched.push( elem );\r\n\t\t\t\tif ( mapped ) {\r\n\t\t\t\t\tmap.push( i );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn newUnmatched;\r\n}\r\n\r\nfunction setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {\r\n\tif ( postFilter && !postFilter[ expando ] ) {\r\n\t\tpostFilter = setMatcher( postFilter );\r\n\t}\r\n\tif ( postFinder && !postFinder[ expando ] ) {\r\n\t\tpostFinder = setMatcher( postFinder, postSelector );\r\n\t}\r\n\treturn markFunction(function( seed, results, context, xml ) {\r\n\t\tvar temp, i, elem,\r\n\t\t\tpreMap = [],\r\n\t\t\tpostMap = [],\r\n\t\t\tpreexisting = results.length,\r\n\r\n\t\t\t// Get initial elements from seed or context\r\n\t\t\telems = seed || multipleContexts( selector || \"*\", context.nodeType ? [ context ] : context, [] ),\r\n\r\n\t\t\t// Prefilter to get matcher input, preserving a map for seed-results synchronization\r\n\t\t\tmatcherIn = preFilter && ( seed || !selector ) ?\r\n\t\t\t\tcondense( elems, preMap, preFilter, context, xml ) :\r\n\t\t\t\telems,\r\n\r\n\t\t\tmatcherOut = matcher ?\r\n\t\t\t\t// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,\r\n\t\t\t\tpostFinder || ( seed ? preFilter : preexisting || postFilter ) ?\r\n\r\n\t\t\t\t\t// ...intermediate processing is necessary\r\n\t\t\t\t\t[] :\r\n\r\n\t\t\t\t\t// ...otherwise use results directly\r\n\t\t\t\t\tresults :\r\n\t\t\t\tmatcherIn;\r\n\r\n\t\t// Find primary matches\r\n\t\tif ( matcher ) {\r\n\t\t\tmatcher( matcherIn, matcherOut, context, xml );\r\n\t\t}\r\n\r\n\t\t// Apply postFilter\r\n\t\tif ( postFilter ) {\r\n\t\t\ttemp = condense( matcherOut, postMap );\r\n\t\t\tpostFilter( temp, [], context, xml );\r\n\r\n\t\t\t// Un-match failing elements by moving them back to matcherIn\r\n\t\t\ti = temp.length;\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\tif ( (elem = temp[i]) ) {\r\n\t\t\t\t\tmatcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( seed ) {\r\n\t\t\tif ( postFinder || preFilter ) {\r\n\t\t\t\tif ( postFinder ) {\r\n\t\t\t\t\t// Get the final matcherOut by condensing this intermediate into postFinder contexts\r\n\t\t\t\t\ttemp = [];\r\n\t\t\t\t\ti = matcherOut.length;\r\n\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\tif ( (elem = matcherOut[i]) ) {\r\n\t\t\t\t\t\t\t// Restore matcherIn since elem is not yet a final match\r\n\t\t\t\t\t\t\ttemp.push( (matcherIn[i] = elem) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpostFinder( null, (matcherOut = []), temp, xml );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move matched elements from seed to results to keep them synchronized\r\n\t\t\t\ti = matcherOut.length;\r\n\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\tif ( (elem = matcherOut[i]) &&\r\n\t\t\t\t\t\t(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {\r\n\r\n\t\t\t\t\t\tseed[temp] = !(results[temp] = elem);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t// Add elements to results, through postFinder if defined\r\n\t\t} else {\r\n\t\t\tmatcherOut = condense(\r\n\t\t\t\tmatcherOut === results ?\r\n\t\t\t\t\tmatcherOut.splice( preexisting, matcherOut.length ) :\r\n\t\t\t\t\tmatcherOut\r\n\t\t\t);\r\n\t\t\tif ( postFinder ) {\r\n\t\t\t\tpostFinder( null, results, matcherOut, xml );\r\n\t\t\t} else {\r\n\t\t\t\tpush.apply( results, matcherOut );\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction matcherFromTokens( tokens ) {\r\n\tvar checkContext, matcher, j,\r\n\t\tlen = tokens.length,\r\n\t\tleadingRelative = Expr.relative[ tokens[0].type ],\r\n\t\timplicitRelative = leadingRelative || Expr.relative[\" \"],\r\n\t\ti = leadingRelative ? 1 : 0,\r\n\r\n\t\t// The foundational matcher ensures that elements are reachable from top-level context(s)\r\n\t\tmatchContext = addCombinator( function( elem ) {\r\n\t\t\treturn elem === checkContext;\r\n\t\t}, implicitRelative, true ),\r\n\t\tmatchAnyContext = addCombinator( function( elem ) {\r\n\t\t\treturn indexOf.call( checkContext, elem ) > -1;\r\n\t\t}, implicitRelative, true ),\r\n\t\tmatchers = [ function( elem, context, xml ) {\r\n\t\t\treturn ( !leadingRelative && ( xml || context !== outermostContext ) ) || (\r\n\t\t\t\t(checkContext = context).nodeType ?\r\n\t\t\t\t\tmatchContext( elem, context, xml ) :\r\n\t\t\t\t\tmatchAnyContext( elem, context, xml ) );\r\n\t\t} ];\r\n\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tif ( (matcher = Expr.relative[ tokens[i].type ]) ) {\r\n\t\t\tmatchers = [ addCombinator(elementMatcher( matchers ), matcher) ];\r\n\t\t} else {\r\n\t\t\tmatcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );\r\n\r\n\t\t\t// Return special upon seeing a positional matcher\r\n\t\t\tif ( matcher[ expando ] ) {\r\n\t\t\t\t// Find the next relative operator (if any) for proper handling\r\n\t\t\t\tj = ++i;\r\n\t\t\t\tfor ( ; j < len; j++ ) {\r\n\t\t\t\t\tif ( Expr.relative[ tokens[j].type ] ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn setMatcher(\r\n\t\t\t\t\ti > 1 && elementMatcher( matchers ),\r\n\t\t\t\t\ti > 1 && toSelector(\r\n\t\t\t\t\t\t// If the preceding token was a descendant combinator, insert an implicit any-element `*`\r\n\t\t\t\t\t\ttokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === \" \" ? \"*\" : \"\" })\r\n\t\t\t\t\t).replace( rtrim, \"$1\" ),\r\n\t\t\t\t\tmatcher,\r\n\t\t\t\t\ti < j && matcherFromTokens( tokens.slice( i, j ) ),\r\n\t\t\t\t\tj < len && matcherFromTokens( (tokens = tokens.slice( j )) ),\r\n\t\t\t\t\tj < len && toSelector( tokens )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tmatchers.push( matcher );\r\n\t\t}\r\n\t}\r\n\r\n\treturn elementMatcher( matchers );\r\n}\r\n\r\nfunction matcherFromGroupMatchers( elementMatchers, setMatchers ) {\r\n\tvar bySet = setMatchers.length > 0,\r\n\t\tbyElement = elementMatchers.length > 0,\r\n\t\tsuperMatcher = function( seed, context, xml, results, outermost ) {\r\n\t\t\tvar elem, j, matcher,\r\n\t\t\t\tmatchedCount = 0,\r\n\t\t\t\ti = \"0\",\r\n\t\t\t\tunmatched = seed && [],\r\n\t\t\t\tsetMatched = [],\r\n\t\t\t\tcontextBackup = outermostContext,\r\n\t\t\t\t// We must always have either seed elements or outermost context\r\n\t\t\t\telems = seed || byElement && Expr.find[\"TAG\"]( \"*\", outermost ),\r\n\t\t\t\t// Use integer dirruns iff this is the outermost matcher\r\n\t\t\t\tdirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),\r\n\t\t\t\tlen = elems.length;\r\n\r\n\t\t\tif ( outermost ) {\r\n\t\t\t\toutermostContext = context !== document && context;\r\n\t\t\t}\r\n\r\n\t\t\t// Add elements passing elementMatchers directly to results\r\n\t\t\t// Keep `i` a string if there are no elements so `matchedCount` will be \"00\" below\r\n\t\t\t// Support: IE<9, Safari\r\n\t\t\t// Tolerate NodeList properties (IE: \"length\"; Safari: <number>) matching elements by id\r\n\t\t\tfor ( ; i !== len && (elem = elems[i]) != null; i++ ) {\r\n\t\t\t\tif ( byElement && elem ) {\r\n\t\t\t\t\tj = 0;\r\n\t\t\t\t\twhile ( (matcher = elementMatchers[j++]) ) {\r\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\r\n\t\t\t\t\t\t\tresults.push( elem );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( outermost ) {\r\n\t\t\t\t\t\tdirruns = dirrunsUnique;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Track unmatched elements for set filters\r\n\t\t\t\tif ( bySet ) {\r\n\t\t\t\t\t// They will have gone through all possible matchers\r\n\t\t\t\t\tif ( (elem = !matcher && elem) ) {\r\n\t\t\t\t\t\tmatchedCount--;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Lengthen the array for every element, matched or not\r\n\t\t\t\t\tif ( seed ) {\r\n\t\t\t\t\t\tunmatched.push( elem );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Apply set filters to unmatched elements\r\n\t\t\tmatchedCount += i;\r\n\t\t\tif ( bySet && i !== matchedCount ) {\r\n\t\t\t\tj = 0;\r\n\t\t\t\twhile ( (matcher = setMatchers[j++]) ) {\r\n\t\t\t\t\tmatcher( unmatched, setMatched, context, xml );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( seed ) {\r\n\t\t\t\t\t// Reintegrate element matches to eliminate the need for sorting\r\n\t\t\t\t\tif ( matchedCount > 0 ) {\r\n\t\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\t\tif ( !(unmatched[i] || setMatched[i]) ) {\r\n\t\t\t\t\t\t\t\tsetMatched[i] = pop.call( results );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Discard index placeholder values to get only actual matches\r\n\t\t\t\t\tsetMatched = condense( setMatched );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add matches to results\r\n\t\t\t\tpush.apply( results, setMatched );\r\n\r\n\t\t\t\t// Seedless set matches succeeding multiple successful matchers stipulate sorting\r\n\t\t\t\tif ( outermost && !seed && setMatched.length > 0 &&\r\n\t\t\t\t\t( matchedCount + setMatchers.length ) > 1 ) {\r\n\r\n\t\t\t\t\tSizzle.uniqueSort( results );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Override manipulation of globals by nested matchers\r\n\t\t\tif ( outermost ) {\r\n\t\t\t\tdirruns = dirrunsUnique;\r\n\t\t\t\toutermostContext = contextBackup;\r\n\t\t\t}\r\n\r\n\t\t\treturn unmatched;\r\n\t\t};\r\n\r\n\treturn bySet ?\r\n\t\tmarkFunction( superMatcher ) :\r\n\t\tsuperMatcher;\r\n}\r\n\r\ncompile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {\r\n\tvar i,\r\n\t\tsetMatchers = [],\r\n\t\telementMatchers = [],\r\n\t\tcached = compilerCache[ selector + \" \" ];\r\n\r\n\tif ( !cached ) {\r\n\t\t// Generate a function of recursive functions that can be used to check each element\r\n\t\tif ( !match ) {\r\n\t\t\tmatch = tokenize( selector );\r\n\t\t}\r\n\t\ti = match.length;\r\n\t\twhile ( i-- ) {\r\n\t\t\tcached = matcherFromTokens( match[i] );\r\n\t\t\tif ( cached[ expando ] ) {\r\n\t\t\t\tsetMatchers.push( cached );\r\n\t\t\t} else {\r\n\t\t\t\telementMatchers.push( cached );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Cache the compiled function\r\n\t\tcached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );\r\n\r\n\t\t// Save selector and tokenization\r\n\t\tcached.selector = selector;\r\n\t}\r\n\treturn cached;\r\n};\r\n\r\n/**\r\n * A low-level selection function that works with Sizzle's compiled\r\n *  selector functions\r\n * @param {String|Function} selector A selector or a pre-compiled\r\n *  selector function built with Sizzle.compile\r\n * @param {Element} context\r\n * @param {Array} [results]\r\n * @param {Array} [seed] A set of elements to match against\r\n */\r\nselect = Sizzle.select = function( selector, context, results, seed ) {\r\n\tvar i, tokens, token, type, find,\r\n\t\tcompiled = typeof selector === \"function\" && selector,\r\n\t\tmatch = !seed && tokenize( (selector = compiled.selector || selector) );\r\n\r\n\tresults = results || [];\r\n\r\n\t// Try to minimize operations if there is no seed and only one group\r\n\tif ( match.length === 1 ) {\r\n\r\n\t\t// Take a shortcut and set the context if the root selector is an ID\r\n\t\ttokens = match[0] = match[0].slice( 0 );\r\n\t\tif ( tokens.length > 2 && (token = tokens[0]).type === \"ID\" &&\r\n\t\t\t\tsupport.getById && context.nodeType === 9 && documentIsHTML &&\r\n\t\t\t\tExpr.relative[ tokens[1].type ] ) {\r\n\r\n\t\t\tcontext = ( Expr.find[\"ID\"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];\r\n\t\t\tif ( !context ) {\r\n\t\t\t\treturn results;\r\n\r\n\t\t\t// Precompiled matchers will still verify ancestry, so step up a level\r\n\t\t\t} else if ( compiled ) {\r\n\t\t\t\tcontext = context.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tselector = selector.slice( tokens.shift().value.length );\r\n\t\t}\r\n\r\n\t\t// Fetch a seed set for right-to-left matching\r\n\t\ti = matchExpr[\"needsContext\"].test( selector ) ? 0 : tokens.length;\r\n\t\twhile ( i-- ) {\r\n\t\t\ttoken = tokens[i];\r\n\r\n\t\t\t// Abort if we hit a combinator\r\n\t\t\tif ( Expr.relative[ (type = token.type) ] ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ( (find = Expr.find[ type ]) ) {\r\n\t\t\t\t// Search, expanding context for leading sibling combinators\r\n\t\t\t\tif ( (seed = find(\r\n\t\t\t\t\ttoken.matches[0].replace( runescape, funescape ),\r\n\t\t\t\t\trsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context\r\n\t\t\t\t)) ) {\r\n\r\n\t\t\t\t\t// If seed is empty or no tokens remain, we can return early\r\n\t\t\t\t\ttokens.splice( i, 1 );\r\n\t\t\t\t\tselector = seed.length && toSelector( tokens );\r\n\t\t\t\t\tif ( !selector ) {\r\n\t\t\t\t\t\tpush.apply( results, seed );\r\n\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Compile and execute a filtering function if one is not provided\r\n\t// Provide `match` to avoid retokenization if we modified the selector above\r\n\t( compiled || compile( selector, match ) )(\r\n\t\tseed,\r\n\t\tcontext,\r\n\t\t!documentIsHTML,\r\n\t\tresults,\r\n\t\trsibling.test( selector ) && testContext( context.parentNode ) || context\r\n\t);\r\n\treturn results;\r\n};\r\n\r\n// One-time assignments\r\n\r\n// Sort stability\r\nsupport.sortStable = expando.split(\"\").sort( sortOrder ).join(\"\") === expando;\r\n\r\n// Support: Chrome 14-35+\r\n// Always assume duplicates if they aren't passed to the comparison function\r\nsupport.detectDuplicates = !!hasDuplicate;\r\n\r\n// Initialize against the default document\r\nsetDocument();\r\n\r\n// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)\r\n// Detached nodes confoundingly follow *each other*\r\nsupport.sortDetached = assert(function( div1 ) {\r\n\t// Should return 1, but returns 4 (following)\r\n\treturn div1.compareDocumentPosition( document.createElement(\"div\") ) & 1;\r\n});\r\n\r\n// Support: IE<8\r\n// Prevent attribute/property \"interpolation\"\r\n// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx\r\nif ( !assert(function( div ) {\r\n\tdiv.innerHTML = \"<a href='#'></a>\";\r\n\treturn div.firstChild.getAttribute(\"href\") === \"#\" ;\r\n}) ) {\r\n\taddHandle( \"type|href|height|width\", function( elem, name, isXML ) {\r\n\t\tif ( !isXML ) {\r\n\t\t\treturn elem.getAttribute( name, name.toLowerCase() === \"type\" ? 1 : 2 );\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Support: IE<9\r\n// Use defaultValue in place of getAttribute(\"value\")\r\nif ( !support.attributes || !assert(function( div ) {\r\n\tdiv.innerHTML = \"<input/>\";\r\n\tdiv.firstChild.setAttribute( \"value\", \"\" );\r\n\treturn div.firstChild.getAttribute( \"value\" ) === \"\";\r\n}) ) {\r\n\taddHandle( \"value\", function( elem, name, isXML ) {\r\n\t\tif ( !isXML && elem.nodeName.toLowerCase() === \"input\" ) {\r\n\t\t\treturn elem.defaultValue;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Support: IE<9\r\n// Use getAttributeNode to fetch booleans when getAttribute lies\r\nif ( !assert(function( div ) {\r\n\treturn div.getAttribute(\"disabled\") == null;\r\n}) ) {\r\n\taddHandle( booleans, function( elem, name, isXML ) {\r\n\t\tvar val;\r\n\t\tif ( !isXML ) {\r\n\t\t\treturn elem[ name ] === true ? name.toLowerCase() :\r\n\t\t\t\t\t(val = elem.getAttributeNode( name )) && val.specified ?\r\n\t\t\t\t\tval.value :\r\n\t\t\t\tnull;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// EXPOSE\r\nreturn Sizzle;\r\n});\r\n\r\n/*eslint-enable */\r\n\r\n// Included from: js/tinymce/classes/util/Arr.js\r\n\r\n/**\r\n * Arr.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Array utility class.\r\n *\r\n * @private\r\n * @class tinymce.util.Arr\r\n */\r\ndefine(\"tinymce/util/Arr\", [], function() {\r\n\tvar isArray = Array.isArray || function(obj) {\r\n\t\treturn Object.prototype.toString.call(obj) === \"[object Array]\";\r\n\t};\r\n\r\n\tfunction toArray(obj) {\r\n\t\tvar array = obj, i, l;\r\n\r\n\t\tif (!isArray(obj)) {\r\n\t\t\tarray = [];\r\n\t\t\tfor (i = 0, l = obj.length; i < l; i++) {\r\n\t\t\t\tarray[i] = obj[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn array;\r\n\t}\r\n\r\n\tfunction each(o, cb, s) {\r\n\t\tvar n, l;\r\n\r\n\t\tif (!o) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\ts = s || o;\r\n\r\n\t\tif (o.length !== undefined) {\r\n\t\t\t// Indexed arrays, needed for Safari\r\n\t\t\tfor (n = 0, l = o.length; n < l; n++) {\r\n\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Hashtables\r\n\t\t\tfor (n in o) {\r\n\t\t\t\tif (o.hasOwnProperty(n)) {\r\n\t\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tfunction map(array, callback) {\r\n\t\tvar out = [];\r\n\r\n\t\teach(array, function(item, index) {\r\n\t\t\tout.push(callback(item, index, array));\r\n\t\t});\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\tfunction filter(a, f) {\r\n\t\tvar o = [];\r\n\r\n\t\teach(a, function(v, index) {\r\n\t\t\tif (!f || f(v, index, a)) {\r\n\t\t\t\to.push(v);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn o;\r\n\t}\r\n\r\n\tfunction indexOf(a, v) {\r\n\t\tvar i, l;\r\n\r\n\t\tif (a) {\r\n\t\t\tfor (i = 0, l = a.length; i < l; i++) {\r\n\t\t\t\tif (a[i] === v) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfunction reduce(collection, iteratee, accumulator, thisArg) {\r\n\t\tvar i = 0;\r\n\r\n\t\tif (arguments.length < 3) {\r\n\t\t\taccumulator = collection[0];\r\n\t\t}\r\n\r\n\t\tfor (; i < collection.length; i++) {\r\n\t\t\taccumulator = iteratee.call(thisArg, accumulator, collection[i], i);\r\n\t\t}\r\n\r\n\t\treturn accumulator;\r\n\t}\r\n\r\n\tfunction findIndex(array, predicate, thisArg) {\r\n\t\tvar i, l;\r\n\r\n\t\tfor (i = 0, l = array.length; i < l; i++) {\r\n\t\t\tif (predicate.call(thisArg, array[i], i, array)) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfunction find(array, predicate, thisArg) {\r\n\t\tvar idx = findIndex(array, predicate, thisArg);\r\n\r\n\t\tif (idx !== -1) {\r\n\t\t\treturn array[idx];\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tfunction last(collection) {\r\n\t\treturn collection[collection.length - 1];\r\n\t}\r\n\r\n\treturn {\r\n\t\tisArray: isArray,\r\n\t\ttoArray: toArray,\r\n\t\teach: each,\r\n\t\tmap: map,\r\n\t\tfilter: filter,\r\n\t\tindexOf: indexOf,\r\n\t\treduce: reduce,\r\n\t\tfindIndex: findIndex,\r\n\t\tfind: find,\r\n\t\tlast: last\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Tools.js\r\n\r\n/**\r\n * Tools.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class contains various utlity functions. These are also exposed\r\n * directly on the tinymce namespace.\r\n *\r\n * @class tinymce.util.Tools\r\n */\r\ndefine(\"tinymce/util/Tools\", [\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Arr\"\r\n], function(Env, Arr) {\r\n\t/**\r\n\t * Removes whitespace from the beginning and end of a string.\r\n\t *\r\n\t * @method trim\r\n\t * @param {String} s String to remove whitespace from.\r\n\t * @return {String} New string with removed whitespace.\r\n\t */\r\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\r\n\r\n\tfunction trim(str) {\r\n\t\treturn (str === null || str === undefined) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if a object is of a specific type for example an array.\r\n\t *\r\n\t * @method is\r\n\t * @param {Object} obj Object to check type of.\r\n\t * @param {string} type Optional type to check for.\r\n\t * @return {Boolean} true/false if the object is of the specified type.\r\n\t */\r\n\tfunction is(obj, type) {\r\n\t\tif (!type) {\r\n\t\t\treturn obj !== undefined;\r\n\t\t}\r\n\r\n\t\tif (type == 'array' && Arr.isArray(obj)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn typeof obj == type;\r\n\t}\r\n\r\n\t/**\r\n\t * Makes a name/object map out of an array with names.\r\n\t *\r\n\t * @method makeMap\r\n\t * @param {Array/String} items Items to make map out of.\r\n\t * @param {String} delim Optional delimiter to split string by.\r\n\t * @param {Object} map Optional map to add items to.\r\n\t * @return {Object} Name/value map of items.\r\n\t */\r\n\tfunction makeMap(items, delim, map) {\r\n\t\tvar i;\r\n\r\n\t\titems = items || [];\r\n\t\tdelim = delim || ',';\r\n\r\n\t\tif (typeof items == \"string\") {\r\n\t\t\titems = items.split(delim);\r\n\t\t}\r\n\r\n\t\tmap = map || {};\r\n\r\n\t\ti = items.length;\r\n\t\twhile (i--) {\r\n\t\t\tmap[items[i]] = {};\r\n\t\t}\r\n\r\n\t\treturn map;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a class, subclass or static singleton.\r\n\t * More details on this method can be found in the Wiki.\r\n\t *\r\n\t * @method create\r\n\t * @param {String} s Class name, inheritance and prefix.\r\n\t * @param {Object} p Collection of methods to add to the class.\r\n\t * @param {Object} root Optional root object defaults to the global window object.\r\n\t * @example\r\n\t * // Creates a basic class\r\n\t * tinymce.create('tinymce.somepackage.SomeClass', {\r\n\t *     SomeClass: function() {\r\n\t *         // Class constructor\r\n\t *     },\r\n\t *\r\n\t *     method: function() {\r\n\t *         // Some method\r\n\t *     }\r\n\t * });\r\n\t *\r\n\t * // Creates a basic subclass class\r\n\t * tinymce.create('tinymce.somepackage.SomeSubClass:tinymce.somepackage.SomeClass', {\r\n\t *     SomeSubClass: function() {\r\n\t *         // Class constructor\r\n\t *         this.parent(); // Call parent constructor\r\n\t *     },\r\n\t *\r\n\t *     method: function() {\r\n\t *         // Some method\r\n\t *         this.parent(); // Call parent method\r\n\t *     },\r\n\t *\r\n\t *     'static': {\r\n\t *         staticMethod: function() {\r\n\t *             // Static method\r\n\t *         }\r\n\t *     }\r\n\t * });\r\n\t *\r\n\t * // Creates a singleton/static class\r\n\t * tinymce.create('static tinymce.somepackage.SomeSingletonClass', {\r\n\t *     method: function() {\r\n\t *         // Some method\r\n\t *     }\r\n\t * });\r\n\t */\r\n\tfunction create(s, p, root) {\r\n\t\tvar self = this, sp, ns, cn, scn, c, de = 0;\r\n\r\n\t\t// Parse : <prefix> <class>:<super class>\r\n\t\ts = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\r\n\t\tcn = s[3].match(/(^|\\.)(\\w+)$/i)[2]; // Class name\r\n\r\n\t\t// Create namespace for new class\r\n\t\tns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\r\n\r\n\t\t// Class already exists\r\n\t\tif (ns[cn]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Make pure static class\r\n\t\tif (s[2] == 'static') {\r\n\t\t\tns[cn] = p;\r\n\r\n\t\t\tif (this.onCreate) {\r\n\t\t\t\tthis.onCreate(s[2], s[3], ns[cn]);\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Create default constructor\r\n\t\tif (!p[cn]) {\r\n\t\t\tp[cn] = function() {};\r\n\t\t\tde = 1;\r\n\t\t}\r\n\r\n\t\t// Add constructor and methods\r\n\t\tns[cn] = p[cn];\r\n\t\tself.extend(ns[cn].prototype, p);\r\n\r\n\t\t// Extend\r\n\t\tif (s[5]) {\r\n\t\t\tsp = self.resolve(s[5]).prototype;\r\n\t\t\tscn = s[5].match(/\\.(\\w+)$/i)[1]; // Class name\r\n\r\n\t\t\t// Extend constructor\r\n\t\t\tc = ns[cn];\r\n\t\t\tif (de) {\r\n\t\t\t\t// Add passthrough constructor\r\n\t\t\t\tns[cn] = function() {\r\n\t\t\t\t\treturn sp[scn].apply(this, arguments);\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\t// Add inherit constructor\r\n\t\t\t\tns[cn] = function() {\r\n\t\t\t\t\tthis.parent = sp[scn];\r\n\t\t\t\t\treturn c.apply(this, arguments);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tns[cn].prototype[cn] = ns[cn];\r\n\r\n\t\t\t// Add super methods\r\n\t\t\tself.each(sp, function(f, n) {\r\n\t\t\t\tns[cn].prototype[n] = sp[n];\r\n\t\t\t});\r\n\r\n\t\t\t// Add overridden methods\r\n\t\t\tself.each(p, function(f, n) {\r\n\t\t\t\t// Extend methods if needed\r\n\t\t\t\tif (sp[n]) {\r\n\t\t\t\t\tns[cn].prototype[n] = function() {\r\n\t\t\t\t\t\tthis.parent = sp[n];\r\n\t\t\t\t\t\treturn f.apply(this, arguments);\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (n != cn) {\r\n\t\t\t\t\t\tns[cn].prototype[n] = f;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Add static methods\r\n\t\t/*jshint sub:true*/\r\n\t\t/*eslint dot-notation:0*/\r\n\t\tself.each(p['static'], function(f, n) {\r\n\t\t\tns[cn][n] = f;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction extend(obj, ext) {\r\n\t\tvar i, l, name, args = arguments, value;\r\n\r\n\t\tfor (i = 1, l = args.length; i < l; i++) {\r\n\t\t\text = args[i];\r\n\t\t\tfor (name in ext) {\r\n\t\t\t\tif (ext.hasOwnProperty(name)) {\r\n\t\t\t\t\tvalue = ext[name];\r\n\r\n\t\t\t\t\tif (value !== undefined) {\r\n\t\t\t\t\t\tobj[name] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t}\r\n\r\n\t/**\r\n\t * Executed the specified function for each item in a object tree.\r\n\t *\r\n\t * @method walk\r\n\t * @param {Object} o Object tree to walk though.\r\n\t * @param {function} f Function to call for each item.\r\n\t * @param {String} n Optional name of collection inside the objects to walk for example childNodes.\r\n\t * @param {String} s Optional scope to execute the function in.\r\n\t */\r\n\tfunction walk(o, f, n, s) {\r\n\t\ts = s || this;\r\n\r\n\t\tif (o) {\r\n\t\t\tif (n) {\r\n\t\t\t\to = o[n];\r\n\t\t\t}\r\n\r\n\t\t\tArr.each(o, function(o, i) {\r\n\t\t\t\tif (f.call(s, o, i, n) === false) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twalk(o, f, n, s);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a namespace on a specific object.\r\n\t *\r\n\t * @method createNS\r\n\t * @param {String} n Namespace to create for example a.b.c.d.\r\n\t * @param {Object} o Optional object to add namespace to, defaults to window.\r\n\t * @return {Object} New namespace object the last item in path.\r\n\t * @example\r\n\t * // Create some namespace\r\n\t * tinymce.createNS('tinymce.somepackage.subpackage');\r\n\t *\r\n\t * // Add a singleton\r\n\t * var tinymce.somepackage.subpackage.SomeSingleton = {\r\n\t *     method: function() {\r\n\t *         // Some method\r\n\t *     }\r\n\t * };\r\n\t */\r\n\tfunction createNS(n, o) {\r\n\t\tvar i, v;\r\n\r\n\t\to = o || window;\r\n\r\n\t\tn = n.split('.');\r\n\t\tfor (i = 0; i < n.length; i++) {\r\n\t\t\tv = n[i];\r\n\r\n\t\t\tif (!o[v]) {\r\n\t\t\t\to[v] = {};\r\n\t\t\t}\r\n\r\n\t\t\to = o[v];\r\n\t\t}\r\n\r\n\t\treturn o;\r\n\t}\r\n\r\n\t/**\r\n\t * Resolves a string and returns the object from a specific structure.\r\n\t *\r\n\t * @method resolve\r\n\t * @param {String} n Path to resolve for example a.b.c.d.\r\n\t * @param {Object} o Optional object to search though, defaults to window.\r\n\t * @return {Object} Last object in path or null if it couldn't be resolved.\r\n\t * @example\r\n\t * // Resolve a path into an object reference\r\n\t * var obj = tinymce.resolve('a.b.c.d');\r\n\t */\r\n\tfunction resolve(n, o) {\r\n\t\tvar i, l;\r\n\r\n\t\to = o || window;\r\n\r\n\t\tn = n.split('.');\r\n\t\tfor (i = 0, l = n.length; i < l; i++) {\r\n\t\t\to = o[n[i]];\r\n\r\n\t\t\tif (!o) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn o;\r\n\t}\r\n\r\n\t/**\r\n\t * Splits a string but removes the whitespace before and after each value.\r\n\t *\r\n\t * @method explode\r\n\t * @param {string} s String to split.\r\n\t * @param {string} d Delimiter to split by.\r\n\t * @example\r\n\t * // Split a string into an array with a,b,c\r\n\t * var arr = tinymce.explode('a, b,   c');\r\n\t */\r\n\tfunction explode(s, d) {\r\n\t\tif (!s || is(s, 'array')) {\r\n\t\t\treturn s;\r\n\t\t}\r\n\r\n\t\treturn Arr.map(s.split(d || ','), trim);\r\n\t}\r\n\r\n\tfunction _addCacheSuffix(url) {\r\n\t\tvar cacheSuffix = Env.cacheSuffix;\r\n\r\n\t\tif (cacheSuffix) {\r\n\t\t\turl += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\r\n\t\t}\r\n\r\n\t\treturn url;\r\n\t}\r\n\r\n\treturn {\r\n\t\ttrim: trim,\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the object is an array or not.\r\n\t\t *\r\n\t\t * @method isArray\r\n\t\t * @param {Object} obj Object to check.\r\n\t\t * @return {boolean} true/false state if the object is an array or not.\r\n\t\t */\r\n\t\tisArray: Arr.isArray,\r\n\r\n\t\tis: is,\r\n\r\n\t\t/**\r\n\t\t * Converts the specified object into a real JavaScript array.\r\n\t\t *\r\n\t\t * @method toArray\r\n\t\t * @param {Object} obj Object to convert into array.\r\n\t\t * @return {Array} Array object based in input.\r\n\t\t */\r\n\t\ttoArray: Arr.toArray,\r\n\t\tmakeMap: makeMap,\r\n\r\n\t\t/**\r\n\t\t * Performs an iteration of all items in a collection such as an object or array. This method will execure the\r\n\t\t * callback function for each item in the collection, if the callback returns false the iteration will terminate.\r\n\t\t * The callback has the following format: cb(value, key_or_index).\r\n\t\t *\r\n\t\t * @method each\r\n\t\t * @param {Object} o Collection to iterate.\r\n\t\t * @param {function} cb Callback function to execute for each item.\r\n\t\t * @param {Object} s Optional scope to execute the callback in.\r\n\t\t * @example\r\n\t\t * // Iterate an array\r\n\t\t * tinymce.each([1,2,3], function(v, i) {\r\n\t\t *     console.debug(\"Value: \" + v + \", Index: \" + i);\r\n\t\t * });\r\n\t\t *\r\n\t\t * // Iterate an object\r\n\t\t * tinymce.each({a: 1, b: 2, c: 3], function(v, k) {\r\n\t\t *     console.debug(\"Value: \" + v + \", Key: \" + k);\r\n\t\t * });\r\n\t\t */\r\n\t\teach: Arr.each,\r\n\r\n\t\t/**\r\n\t\t * Creates a new array by the return value of each iteration function call. This enables you to convert\r\n\t\t * one array list into another.\r\n\t\t *\r\n\t\t * @method map\r\n\t\t * @param {Array} array Array of items to iterate.\r\n\t\t * @param {function} callback Function to call for each item. It's return value will be the new value.\r\n\t\t * @return {Array} Array with new values based on function return values.\r\n\t\t */\r\n\t\tmap: Arr.map,\r\n\r\n\t\t/**\r\n\t\t * Filters out items from the input array by calling the specified function for each item.\r\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\r\n\t\t *\r\n\t\t * @method grep\r\n\t\t * @param {Array} a Array of items to loop though.\r\n\t\t * @param {function} f Function to call for each item. Include/exclude depends on it's return value.\r\n\t\t * @return {Array} New array with values imported and filtered based in input.\r\n\t\t * @example\r\n\t\t * // Filter out some items, this will return an array with 4 and 5\r\n\t\t * var items = tinymce.grep([1,2,3,4,5], function(v) {return v > 3;});\r\n\t\t */\r\n\t\tgrep: Arr.filter,\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the object is an array or not.\r\n\t\t *\r\n\t\t * @method isArray\r\n\t\t * @param {Object} obj Object to check.\r\n\t\t * @return {boolean} true/false state if the object is an array or not.\r\n\t\t */\r\n\t\tinArray: Arr.indexOf,\r\n\r\n\t\textend: extend,\r\n\t\tcreate: create,\r\n\t\twalk: walk,\r\n\t\tcreateNS: createNS,\r\n\t\tresolve: resolve,\r\n\t\texplode: explode,\r\n\t\t_addCacheSuffix: _addCacheSuffix\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/DomQuery.js\r\n\r\n/**\r\n * DomQuery.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class mimics most of the jQuery API:\r\n *\r\n * This is whats currently implemented:\r\n * - Utility functions\r\n * - DOM traversial\r\n * - DOM manipulation\r\n * - Event binding\r\n *\r\n * This is not currently implemented:\r\n * - Dimension\r\n * - Ajax\r\n * - Animation\r\n * - Advanced chaining\r\n *\r\n * @example\r\n * var $ = tinymce.dom.DomQuery;\r\n * $('p').attr('attr', 'value').addClass('class');\r\n *\r\n * @class tinymce.dom.DomQuery\r\n */\r\ndefine(\"tinymce/dom/DomQuery\", [\r\n\t\"tinymce/dom/EventUtils\",\r\n\t\"tinymce/dom/Sizzle\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/Env\"\r\n], function(EventUtils, Sizzle, Tools, Env) {\r\n\tvar doc = document, push = Array.prototype.push, slice = Array.prototype.slice;\r\n\tvar rquickExpr = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\r\n\tvar Event = EventUtils.Event, undef;\r\n\tvar skipUniques = Tools.makeMap('children,contents,next,prev');\r\n\r\n\tfunction isDefined(obj) {\r\n\t\treturn typeof obj !== 'undefined';\r\n\t}\r\n\r\n\tfunction isString(obj) {\r\n\t\treturn typeof obj === 'string';\r\n\t}\r\n\r\n\tfunction isWindow(obj) {\r\n\t\treturn obj && obj == obj.window;\r\n\t}\r\n\r\n\tfunction createFragment(html, fragDoc) {\r\n\t\tvar frag, node, container;\r\n\r\n\t\tfragDoc = fragDoc || doc;\r\n\t\tcontainer = fragDoc.createElement('div');\r\n\t\tfrag = fragDoc.createDocumentFragment();\r\n\t\tcontainer.innerHTML = html;\r\n\r\n\t\twhile ((node = container.firstChild)) {\r\n\t\t\tfrag.appendChild(node);\r\n\t\t}\r\n\r\n\t\treturn frag;\r\n\t}\r\n\r\n\tfunction domManipulate(targetNodes, sourceItem, callback, reverse) {\r\n\t\tvar i;\r\n\r\n\t\tif (isString(sourceItem)) {\r\n\t\t\tsourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\r\n\t\t} else if (sourceItem.length && !sourceItem.nodeType) {\r\n\t\t\tsourceItem = DomQuery.makeArray(sourceItem);\r\n\r\n\t\t\tif (reverse) {\r\n\t\t\t\tfor (i = sourceItem.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (i = 0; i < sourceItem.length; i++) {\r\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn targetNodes;\r\n\t\t}\r\n\r\n\t\tif (sourceItem.nodeType) {\r\n\t\t\ti = targetNodes.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tcallback.call(targetNodes[i], sourceItem);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn targetNodes;\r\n\t}\r\n\r\n\tfunction hasClass(node, className) {\r\n\t\treturn node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\r\n\t}\r\n\r\n\tfunction wrap(elements, wrapper, all) {\r\n\t\tvar lastParent, newWrapper;\r\n\r\n\t\twrapper = DomQuery(wrapper)[0];\r\n\r\n\t\telements.each(function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!all || lastParent != self.parentNode) {\r\n\t\t\t\tlastParent = self.parentNode;\r\n\t\t\t\tnewWrapper = wrapper.cloneNode(false);\r\n\t\t\t\tself.parentNode.insertBefore(newWrapper, self);\r\n\t\t\t\tnewWrapper.appendChild(self);\r\n\t\t\t} else {\r\n\t\t\t\tnewWrapper.appendChild(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn elements;\r\n\t}\r\n\r\n\tvar numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\r\n\tvar booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\r\n\tvar propFix = {\r\n\t\t'for': 'htmlFor',\r\n\t\t'class': 'className',\r\n\t\t'readonly': 'readOnly'\r\n\t};\r\n\tvar cssFix = {\r\n\t\t'float': 'cssFloat'\r\n\t};\r\n\r\n\tvar attrHooks = {}, cssHooks = {};\r\n\r\n\tfunction DomQuery(selector, context) {\r\n\t\t/*eslint new-cap:0 */\r\n\t\treturn new DomQuery.fn.init(selector, context);\r\n\t}\r\n\r\n\tfunction inArray(item, array) {\r\n\t\tvar i;\r\n\r\n\t\tif (array.indexOf) {\r\n\t\t\treturn array.indexOf(item);\r\n\t\t}\r\n\r\n\t\ti = array.length;\r\n\t\twhile (i--) {\r\n\t\t\tif (array[i] === item) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\r\n\r\n\tfunction trim(str) {\r\n\t\treturn (str === null || str === undef) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\r\n\t}\r\n\r\n\tfunction each(obj, callback) {\r\n\t\tvar length, key, i, undef, value;\r\n\r\n\t\tif (obj) {\r\n\t\t\tlength = obj.length;\r\n\r\n\t\t\tif (length === undef) {\r\n\t\t\t\t// Loop object items\r\n\t\t\t\tfor (key in obj) {\r\n\t\t\t\t\tif (obj.hasOwnProperty(key)) {\r\n\t\t\t\t\t\tvalue = obj[key];\r\n\t\t\t\t\t\tif (callback.call(value, key, value) === false) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Loop array items\r\n\t\t\t\tfor (i = 0; i < length; i++) {\r\n\t\t\t\t\tvalue = obj[i];\r\n\t\t\t\t\tif (callback.call(value, i, value) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tfunction grep(array, callback) {\r\n\t\tvar out = [];\r\n\r\n\t\teach(array, function(i, item) {\r\n\t\t\tif (callback(item, i)) {\r\n\t\t\t\tout.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\tfunction getElementDocument(element) {\r\n\t\tif (!element) {\r\n\t\t\treturn doc;\r\n\t\t}\r\n\r\n\t\tif (element.nodeType == 9) {\r\n\t\t\treturn element;\r\n\t\t}\r\n\r\n\t\treturn element.ownerDocument;\r\n\t}\r\n\r\n\tDomQuery.fn = DomQuery.prototype = {\r\n\t\tconstructor: DomQuery,\r\n\r\n\t\t/**\r\n\t\t * Selector for the current set.\r\n\t\t *\r\n\t\t * @property selector\r\n\t\t * @type String\r\n\t\t */\r\n\t\tselector: \"\",\r\n\r\n\t\t/**\r\n\t\t * Context used to create the set.\r\n\t\t *\r\n\t\t * @property context\r\n\t\t * @type Element\r\n\t\t */\r\n\t\tcontext: null,\r\n\r\n\t\t/**\r\n\t\t * Number of items in the current set.\r\n\t\t *\r\n\t\t * @property length\r\n\t\t * @type Number\r\n\t\t */\r\n\t\tlength: 0,\r\n\r\n\t\t/**\r\n\t\t * Constructs a new DomQuery instance with the specified selector or context.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @method init\r\n\t\t * @param {String/Array/DomQuery} selector Optional CSS selector/Array or array like object or HTML string.\r\n\t\t * @param {Document/Element} context Optional context to search in.\r\n\t\t */\r\n\t\tinit: function(selector, context) {\r\n\t\t\tvar self = this, match, node;\r\n\r\n\t\t\tif (!selector) {\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\tif (selector.nodeType) {\r\n\t\t\t\tself.context = self[0] = selector;\r\n\t\t\t\tself.length = 1;\r\n\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\tif (context && context.nodeType) {\r\n\t\t\t\tself.context = context;\r\n\t\t\t} else {\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\treturn DomQuery(selector).attr(context);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.context = context = document;\r\n\t\t\t}\r\n\r\n\t\t\tif (isString(selector)) {\r\n\t\t\t\tself.selector = selector;\r\n\r\n\t\t\t\tif (selector.charAt(0) === \"<\" && selector.charAt(selector.length - 1) === \">\" && selector.length >= 3) {\r\n\t\t\t\t\tmatch = [null, selector, null];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmatch = rquickExpr.exec(selector);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (match) {\r\n\t\t\t\t\tif (match[1]) {\r\n\t\t\t\t\t\tnode = createFragment(selector, getElementDocument(context)).firstChild;\r\n\r\n\t\t\t\t\t\twhile (node) {\r\n\t\t\t\t\t\t\tpush.call(self, node);\r\n\t\t\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnode = getElementDocument(context).getElementById(match[2]);\r\n\r\n\t\t\t\t\t\tif (!node) {\r\n\t\t\t\t\t\t\treturn self;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (node.id !== match[2]) {\r\n\t\t\t\t\t\t\treturn self.find(selector);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.length = 1;\r\n\t\t\t\t\t\tself[0] = node;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn DomQuery(context).find(selector);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.add(selector, false);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Converts the current set to an array.\r\n\t\t *\r\n\t\t * @method toArray\r\n\t\t * @return {Array} Array of all nodes in set.\r\n\t\t */\r\n\t\ttoArray: function() {\r\n\t\t\treturn Tools.toArray(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds new nodes to the set.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {Array/tinymce.dom.DomQuery} items Array of all nodes to add to set.\r\n\t\t * @param {Boolean} sort Optional sort flag that enables sorting of elements.\r\n\t\t * @return {tinymce.dom.DomQuery} New instance with nodes added.\r\n\t\t */\r\n\t\tadd: function(items, sort) {\r\n\t\t\tvar self = this, nodes, i;\r\n\r\n\t\t\tif (isString(items)) {\r\n\t\t\t\treturn self.add(DomQuery(items));\r\n\t\t\t}\r\n\r\n\t\t\tif (sort !== false) {\r\n\t\t\t\tnodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\r\n\t\t\t\tself.length = nodes.length;\r\n\t\t\t\tfor (i = 0; i < nodes.length; i++) {\r\n\t\t\t\t\tself[i] = nodes[i];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tpush.apply(self, DomQuery.makeArray(items));\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets/gets attributes on the elements in the current set.\r\n\t\t *\r\n\t\t * @method attr\r\n\t\t * @param {String/Object} name Name of attribute to get or an object with attributes to set.\r\n\t\t * @param {String} value Optional value to set.\r\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified attribute when only the name is specified.\r\n\t\t */\r\n\t\tattr: function(name, value) {\r\n\t\t\tvar self = this, hook;\r\n\r\n\t\t\tif (typeof name === \"object\") {\r\n\t\t\t\teach(name, function(name, value) {\r\n\t\t\t\t\tself.attr(name, value);\r\n\t\t\t\t});\r\n\t\t\t} else if (isDefined(value)) {\r\n\t\t\t\tthis.each(function() {\r\n\t\t\t\t\tvar hook;\r\n\r\n\t\t\t\t\tif (this.nodeType === 1) {\r\n\t\t\t\t\t\thook = attrHooks[name];\r\n\t\t\t\t\t\tif (hook && hook.set) {\r\n\t\t\t\t\t\t\thook.set(this, value);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (value === null) {\r\n\t\t\t\t\t\t\tthis.removeAttribute(name, 2);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.setAttribute(name, value, 2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (self[0] && self[0].nodeType === 1) {\r\n\t\t\t\t\thook = attrHooks[name];\r\n\t\t\t\t\tif (hook && hook.get) {\r\n\t\t\t\t\t\treturn hook.get(self[0], name);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (booleanMap[name]) {\r\n\t\t\t\t\t\treturn self.prop(name) ? name : undef;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvalue = self[0].getAttribute(name, 2);\r\n\r\n\t\t\t\t\tif (value === null) {\r\n\t\t\t\t\t\tvalue = undef;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes attributse on the elements in the current set.\r\n\t\t *\r\n\t\t * @method removeAttr\r\n\t\t * @param {String/Object} name Name of attribute to remove.\r\n\t\t * @return {tinymce.dom.DomQuery/String} Current set.\r\n\t\t */\r\n\t\tremoveAttr: function(name) {\r\n\t\t\treturn this.attr(name, null);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets/gets properties on the elements in the current set.\r\n\t\t *\r\n\t\t * @method attr\r\n\t\t * @param {String/Object} name Name of property to get or an object with properties to set.\r\n\t\t * @param {String} value Optional value to set.\r\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified property when only the name is specified.\r\n\t\t */\r\n\t\tprop: function(name, value) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tname = propFix[name] || name;\r\n\r\n\t\t\tif (typeof name === \"object\") {\r\n\t\t\t\teach(name, function(name, value) {\r\n\t\t\t\t\tself.prop(name, value);\r\n\t\t\t\t});\r\n\t\t\t} else if (isDefined(value)) {\r\n\t\t\t\tthis.each(function() {\r\n\t\t\t\t\tif (this.nodeType == 1) {\r\n\t\t\t\t\t\tthis[name] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (self[0] && self[0].nodeType && name in self[0]) {\r\n\t\t\t\t\treturn self[0][name];\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets/gets styles on the elements in the current set.\r\n\t\t *\r\n\t\t * @method css\r\n\t\t * @param {String/Object} name Name of style to get or an object with styles to set.\r\n\t\t * @param {String} value Optional value to set.\r\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified style when only the name is specified.\r\n\t\t */\r\n\t\tcss: function(name, value) {\r\n\t\t\tvar self = this, elm, hook;\r\n\r\n\t\t\tfunction camel(name) {\r\n\t\t\t\treturn name.replace(/-(\\D)/g, function(a, b) {\r\n\t\t\t\t\treturn b.toUpperCase();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction dashed(name) {\r\n\t\t\t\treturn name.replace(/[A-Z]/g, function(a) {\r\n\t\t\t\t\treturn '-' + a;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof name === \"object\") {\r\n\t\t\t\teach(name, function(name, value) {\r\n\t\t\t\t\tself.css(name, value);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (isDefined(value)) {\r\n\t\t\t\t\tname = camel(name);\r\n\r\n\t\t\t\t\t// Default px suffix on these\r\n\t\t\t\t\tif (typeof value === 'number' && !numericCssMap[name]) {\r\n\t\t\t\t\t\tvalue += 'px';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.each(function() {\r\n\t\t\t\t\t\tvar style = this.style;\r\n\r\n\t\t\t\t\t\thook = cssHooks[name];\r\n\t\t\t\t\t\tif (hook && hook.set) {\r\n\t\t\t\t\t\t\thook.set(this, value);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tthis.style[cssFix[name] || name] = value;\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (value === null || value === '') {\r\n\t\t\t\t\t\t\tif (style.removeProperty) {\r\n\t\t\t\t\t\t\t\tstyle.removeProperty(dashed(name));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tstyle.removeAttribute(name);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\telm = self[0];\r\n\r\n\t\t\t\t\thook = cssHooks[name];\r\n\t\t\t\t\tif (hook && hook.get) {\r\n\t\t\t\t\t\treturn hook.get(elm);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (elm.ownerDocument.defaultView) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\treturn elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\treturn undef;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (elm.currentStyle) {\r\n\t\t\t\t\t\treturn elm.currentStyle[camel(name)];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes all nodes in set from the document.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @return {tinymce.dom.DomQuery} Current set with the removed nodes.\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tvar self = this, node, i = this.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = self[i];\r\n\t\t\t\tEvent.clean(node);\r\n\r\n\t\t\t\tif (node.parentNode) {\r\n\t\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Empties all elements in set.\r\n\t\t *\r\n\t\t * @method empty\r\n\t\t * @return {tinymce.dom.DomQuery} Current set with the empty nodes.\r\n\t\t */\r\n\t\tempty: function() {\r\n\t\t\tvar self = this, node, i = this.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = self[i];\r\n\t\t\t\twhile (node.firstChild) {\r\n\t\t\t\t\tnode.removeChild(node.firstChild);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets or gets the HTML of the current set or first set node.\r\n\t\t *\r\n\t\t * @method html\r\n\t\t * @param {String} value Optional innerHTML value to set on each element.\r\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerHTML of the first element.\r\n\t\t */\r\n\t\thtml: function(value) {\r\n\t\t\tvar self = this, i;\r\n\r\n\t\t\tif (isDefined(value)) {\r\n\t\t\t\ti = self.length;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tself[i].innerHTML = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Workaround for \"Unknown runtime error\" when DIV is added to P on IE\r\n\t\t\t\t\tDomQuery(self[i]).empty().append(value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\treturn self[0] ? self[0].innerHTML : '';\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets or gets the text of the current set or first set node.\r\n\t\t *\r\n\t\t * @method text\r\n\t\t * @param {String} value Optional innerText value to set on each element.\r\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerText of the first element.\r\n\t\t */\r\n\t\ttext: function(value) {\r\n\t\t\tvar self = this, i;\r\n\r\n\t\t\tif (isDefined(value)) {\r\n\t\t\t\ti = self.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tif (\"innerText\" in self[i]) {\r\n\t\t\t\t\t\tself[i].innerText = value;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself[0].textContent = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\treturn self[0] ? (self[0].innerText || self[0].textContent) : '';\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Appends the specified node/html or node set to the current set nodes.\r\n\t\t *\r\n\t\t * @method append\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to append to each element in set.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\tappend: function() {\r\n\t\t\treturn domManipulate(this, arguments, function(node) {\r\n\t\t\t\t// Either element or Shadow Root\r\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\r\n\t\t\t\t\tthis.appendChild(node);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Prepends the specified node/html or node set to the current set nodes.\r\n\t\t *\r\n\t\t * @method prepend\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to prepend to each element in set.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\tprepend: function() {\r\n\t\t\treturn domManipulate(this, arguments, function(node) {\r\n\t\t\t\t// Either element or Shadow Root\r\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\r\n\t\t\t\t\tthis.insertBefore(node, this.firstChild);\r\n\t\t\t\t}\r\n\t\t\t}, true);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds the specified elements before current set nodes.\r\n\t\t *\r\n\t\t * @method before\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add before to each element in set.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\tbefore: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self[0] && self[0].parentNode) {\r\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\r\n\t\t\t\t\tthis.parentNode.insertBefore(node, this);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds the specified elements after current set nodes.\r\n\t\t *\r\n\t\t * @method after\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add after to each element in set.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\tafter: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self[0] && self[0].parentNode) {\r\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\r\n\t\t\t\t\tthis.parentNode.insertBefore(node, this.nextSibling);\r\n\t\t\t\t}, true);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Appends the specified set nodes to the specified selector/instance.\r\n\t\t *\r\n\t\t * @method appendTo\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to append the current set to.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set with the appended nodes.\r\n\t\t */\r\n\t\tappendTo: function(val) {\r\n\t\t\tDomQuery(val).append(this);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Prepends the specified set nodes to the specified selector/instance.\r\n\t\t *\r\n\t\t * @method prependTo\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to prepend the current set to.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set with the prepended nodes.\r\n\t\t */\r\n\t\tprependTo: function(val) {\r\n\t\t\tDomQuery(val).prepend(this);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Replaces the nodes in set with the specified content.\r\n\t\t *\r\n\t\t * @method replaceWith\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to replace nodes with.\r\n\t\t * @return {tinymce.dom.DomQuery} Set with replaced nodes.\r\n\t\t */\r\n\t\treplaceWith: function(content) {\r\n\t\t\treturn this.before(content).remove();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Wraps all elements in set with the specified wrapper.\r\n\t\t *\r\n\t\t * @method wrap\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\r\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\r\n\t\t */\r\n\t\twrap: function(content) {\r\n\t\t\treturn wrap(this, content);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Wraps all nodes in set with the specified wrapper. If the nodes are siblings all of them\r\n\t\t * will be wrapped in the same wrapper.\r\n\t\t *\r\n\t\t * @method wrapAll\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\r\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\r\n\t\t */\r\n\t\twrapAll: function(content) {\r\n\t\t\treturn wrap(this, content, true);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Wraps all elements inner contents in set with the specified wrapper.\r\n\t\t *\r\n\t\t * @method wrapInner\r\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\r\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\r\n\t\t */\r\n\t\twrapInner: function(content) {\r\n\t\t\tthis.each(function() {\r\n\t\t\t\tDomQuery(this).contents().wrapAll(content);\r\n\t\t\t});\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unwraps all elements by removing the parent element of each item in set.\r\n\t\t *\r\n\t\t * @method unwrap\r\n\t\t * @return {tinymce.dom.DomQuery} Set with unwrapped nodes.\r\n\t\t */\r\n\t\tunwrap: function() {\r\n\t\t\treturn this.parent().each(function() {\r\n\t\t\t\tDomQuery(this).replaceWith(this.childNodes);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Clones all nodes in set.\r\n\t\t *\r\n\t\t * @method clone\r\n\t\t * @return {tinymce.dom.DomQuery} Set with cloned nodes.\r\n\t\t */\r\n\t\tclone: function() {\r\n\t\t\tvar result = [];\r\n\r\n\t\t\tthis.each(function() {\r\n\t\t\t\tresult.push(this.cloneNode(true));\r\n\t\t\t});\r\n\r\n\t\t\treturn DomQuery(result);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds the specified class name to the current set elements.\r\n\t\t *\r\n\t\t * @method addClass\r\n\t\t * @param {String} className Class name to add.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\taddClass: function(className) {\r\n\t\t\treturn this.toggleClass(className, true);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the specified class name to the current set elements.\r\n\t\t *\r\n\t\t * @method removeClass\r\n\t\t * @param {String} className Class name to remove.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\tremoveClass: function(className) {\r\n\t\t\treturn this.toggleClass(className, false);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Toggles the specified class name on the current set elements.\r\n\t\t *\r\n\t\t * @method toggleClass\r\n\t\t * @param {String} className Class name to add/remove.\r\n\t\t * @param {Boolean} state Optional state to toggle on/off.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\ttoggleClass: function(className, state) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// Functions are not supported\r\n\t\t\tif (typeof className != 'string') {\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\tif (className.indexOf(' ') !== -1) {\r\n\t\t\t\teach(className.split(' '), function() {\r\n\t\t\t\t\tself.toggleClass(this, state);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tself.each(function(index, node) {\r\n\t\t\t\t\tvar existingClassName, classState;\r\n\r\n\t\t\t\t\tclassState = hasClass(node, className);\r\n\t\t\t\t\tif (classState !== state) {\r\n\t\t\t\t\t\texistingClassName = node.className;\r\n\r\n\t\t\t\t\t\tif (classState) {\r\n\t\t\t\t\t\t\tnode.className = trim((\" \" + existingClassName + \" \").replace(' ' + className + ' ', ' '));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnode.className += existingClassName ? ' ' + className : className;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the first item in set has the specified class.\r\n\t\t *\r\n\t\t * @method hasClass\r\n\t\t * @param {String} className Class name to check for.\r\n\t\t * @return {Boolean} True/false if the set has the specified class.\r\n\t\t */\r\n\t\thasClass: function(className) {\r\n\t\t\treturn hasClass(this[0], className);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes the callback function for each item DomQuery collection. If you return false in the\r\n\t\t * callback it will break the loop.\r\n\t\t *\r\n\t\t * @method each\r\n\t\t * @param {function} callback Callback function to execute for each item.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\teach: function(callback) {\r\n\t\t\treturn each(this, callback);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Binds an event with callback function to the elements in set.\r\n\t\t *\r\n\t\t * @method on\r\n\t\t * @param {String} name Name of the event to bind.\r\n\t\t * @param {function} callback Callback function to execute when the event occurs.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\ton: function(name, callback) {\r\n\t\t\treturn this.each(function() {\r\n\t\t\t\tEvent.bind(this, name, callback);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unbinds an event with callback function to the elements in set.\r\n\t\t *\r\n\t\t * @method off\r\n\t\t * @param {String} name Optional name of the event to bind.\r\n\t\t * @param {function} callback Optional callback function to execute when the event occurs.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\toff: function(name, callback) {\r\n\t\t\treturn this.each(function() {\r\n\t\t\t\tEvent.unbind(this, name, callback);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Triggers the specified event by name or event object.\r\n\t\t *\r\n\t\t * @method trigger\r\n\t\t * @param {String/Object} name Name of the event to trigger or event object.\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\ttrigger: function(name) {\r\n\t\t\treturn this.each(function() {\r\n\t\t\t\tif (typeof name == 'object') {\r\n\t\t\t\t\tEvent.fire(this, name.type, name);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tEvent.fire(this, name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Shows all elements in set.\r\n\t\t *\r\n\t\t * @method show\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\tshow: function() {\r\n\t\t\treturn this.css('display', '');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides all elements in set.\r\n\t\t *\r\n\t\t * @method hide\r\n\t\t * @return {tinymce.dom.DomQuery} Current set.\r\n\t\t */\r\n\t\thide: function() {\r\n\t\t\treturn this.css('display', 'none');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Slices the current set.\r\n\t\t *\r\n\t\t * @method slice\r\n\t\t * @param {Number} start Start index to slice at.\r\n\t\t * @param {Number} end Optional end index to end slice at.\r\n\t\t * @return {tinymce.dom.DomQuery} Sliced set.\r\n\t\t */\r\n\t\tslice: function() {\r\n\t\t\treturn new DomQuery(slice.apply(this, arguments));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Makes the set equal to the specified index.\r\n\t\t *\r\n\t\t * @method eq\r\n\t\t * @param {Number} index Index to set it equal to.\r\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\r\n\t\t */\r\n\t\teq: function(index) {\r\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Makes the set equal to first element in set.\r\n\t\t *\r\n\t\t * @method first\r\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\r\n\t\t */\r\n\t\tfirst: function() {\r\n\t\t\treturn this.eq(0);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Makes the set equal to last element in set.\r\n\t\t *\r\n\t\t * @method last\r\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\r\n\t\t */\r\n\t\tlast: function() {\r\n\t\t\treturn this.eq(-1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Finds elements by the specified selector for each element in set.\r\n\t\t *\r\n\t\t * @method find\r\n\t\t * @param {String} selector Selector to find elements by.\r\n\t\t * @return {tinymce.dom.DomQuery} Set with matches elements.\r\n\t\t */\r\n\t\tfind: function(selector) {\r\n\t\t\tvar i, l, ret = [];\r\n\r\n\t\t\tfor (i = 0, l = this.length; i < l; i++) {\r\n\t\t\t\tDomQuery.find(selector, this[i], ret);\r\n\t\t\t}\r\n\r\n\t\t\treturn DomQuery(ret);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Filters the current set with the specified selector.\r\n\t\t *\r\n\t\t * @method filter\r\n\t\t * @param {String/function} selector Selector to filter elements by.\r\n\t\t * @return {tinymce.dom.DomQuery} Set with filtered elements.\r\n\t\t */\r\n\t\tfilter: function(selector) {\r\n\t\t\tif (typeof selector == 'function') {\r\n\t\t\t\treturn DomQuery(grep(this.toArray(), function(item, i) {\r\n\t\t\t\t\treturn selector(i, item);\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\r\n\t\t\treturn DomQuery(DomQuery.filter(selector, this.toArray()));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Gets the current node or any parent matching the specified selector.\r\n\t\t *\r\n\t\t * @method closest\r\n\t\t * @param {String/Element/tinymce.dom.DomQuery} selector Selector or element to find.\r\n\t\t * @return {tinymce.dom.DomQuery} Set with closest elements.\r\n\t\t */\r\n\t\tclosest: function(selector) {\r\n\t\t\tvar result = [];\r\n\r\n\t\t\tif (selector instanceof DomQuery) {\r\n\t\t\t\tselector = selector[0];\r\n\t\t\t}\r\n\r\n\t\t\tthis.each(function(i, node) {\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tif (typeof selector == 'string' && DomQuery(node).is(selector)) {\r\n\t\t\t\t\t\tresult.push(node);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else if (node == selector) {\r\n\t\t\t\t\t\tresult.push(node);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn DomQuery(result);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the offset of the first element in set or sets the top/left css properties of all elements in set.\r\n\t\t *\r\n\t\t * @method offset\r\n\t\t * @param {Object} offset Optional offset object to set on each item.\r\n\t\t * @return {Object/tinymce.dom.DomQuery} Returns the first element offset or the current set if you specified an offset.\r\n\t\t */\r\n\t\toffset: function(offset) {\r\n\t\t\tvar elm, doc, docElm;\r\n\t\t\tvar x = 0, y = 0, pos;\r\n\r\n\t\t\tif (!offset) {\r\n\t\t\t\telm = this[0];\r\n\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\tdoc = elm.ownerDocument;\r\n\t\t\t\t\tdocElm = doc.documentElement;\r\n\r\n\t\t\t\t\tif (elm.getBoundingClientRect) {\r\n\t\t\t\t\t\tpos = elm.getBoundingClientRect();\r\n\t\t\t\t\t\tx = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\r\n\t\t\t\t\t\ty = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tleft: x,\r\n\t\t\t\t\ttop: y\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn this.css(offset);\r\n\t\t},\r\n\r\n\t\tpush: push,\r\n\t\tsort: [].sort,\r\n\t\tsplice: [].splice\r\n\t};\r\n\r\n\t// Static members\r\n\tTools.extend(DomQuery, {\r\n\t\t/**\r\n\t\t * Extends the specified object with one or more objects.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @method extend\r\n\t\t * @param {Object} target Target object to extend with new items.\r\n\t\t * @param {Object..} object Object to extend the target with.\r\n\t\t * @return {Object} Extended input object.\r\n\t\t */\r\n\t\textend: Tools.extend,\r\n\r\n\t\t/**\r\n\t\t * Creates an array out of an array like object.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @method makeArray\r\n\t\t * @param {Object} object Object to convert to array.\r\n\t\t * @return {Array} Array produced from object.\r\n\t\t */\r\n\t\tmakeArray: function(object) {\r\n\t\t\tif (isWindow(object) || object.nodeType) {\r\n\t\t\t\treturn [object];\r\n\t\t\t}\r\n\r\n\t\t\treturn Tools.toArray(object);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the index of the specified item inside the array.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @method inArray\r\n\t\t * @param {Object} item Item to look for.\r\n\t\t * @param {Array} array Array to look for item in.\r\n\t\t * @return {Number} Index of the item or -1.\r\n\t\t */\r\n\t\tinArray: inArray,\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified object is an array or not.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @method isArray\r\n\t\t * @param {Object} array Object to check if it's an array or not.\r\n\t\t * @return {Boolean} True/false if the object is an array.\r\n\t\t */\r\n\t\tisArray: Tools.isArray,\r\n\r\n\t\t/**\r\n\t\t * Executes the callback function for each item in array/object. If you return false in the\r\n\t\t * callback it will break the loop.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @method each\r\n\t\t * @param {Object} obj Object to iterate.\r\n\t\t * @param {function} callback Callback function to execute for each item.\r\n\t\t */\r\n\t\teach: each,\r\n\r\n\t\t/**\r\n\t\t * Removes whitespace from the beginning and end of a string.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @method trim\r\n\t\t * @param {String} str String to remove whitespace from.\r\n\t\t * @return {String} New string with removed whitespace.\r\n\t\t */\r\n\t\ttrim: trim,\r\n\r\n\t\t/**\r\n\t\t * Filters out items from the input array by calling the specified function for each item.\r\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @method grep\r\n\t\t * @param {Array} array Array of items to loop though.\r\n\t\t * @param {function} callback Function to call for each item. Include/exclude depends on it's return value.\r\n\t\t * @return {Array} New array with values imported and filtered based in input.\r\n\t\t * @example\r\n\t\t * // Filter out some items, this will return an array with 4 and 5\r\n\t\t * var items = DomQuery.grep([1, 2, 3, 4, 5], function(v) {return v > 3;});\r\n\t\t */\r\n\t\tgrep: grep,\r\n\r\n\t\t// Sizzle\r\n\t\tfind: Sizzle,\r\n\t\texpr: Sizzle.selectors,\r\n\t\tunique: Sizzle.uniqueSort,\r\n\t\ttext: Sizzle.getText,\r\n\t\tcontains: Sizzle.contains,\r\n\t\tfilter: function(expr, elems, not) {\r\n\t\t\tvar i = elems.length;\r\n\r\n\t\t\tif (not) {\r\n\t\t\t\texpr = \":not(\" + expr + \")\";\r\n\t\t\t}\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tif (elems[i].nodeType != 1) {\r\n\t\t\t\t\telems.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (elems.length === 1) {\r\n\t\t\t\telems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\r\n\t\t\t} else {\r\n\t\t\t\telems = DomQuery.find.matches(expr, elems);\r\n\t\t\t}\r\n\r\n\t\t\treturn elems;\r\n\t\t}\r\n\t});\r\n\r\n\tfunction dir(el, prop, until) {\r\n\t\tvar matched = [], cur = el[prop];\r\n\r\n\t\tif (typeof until != 'string' && until instanceof DomQuery) {\r\n\t\t\tuntil = until[0];\r\n\t\t}\r\n\r\n\t\twhile (cur && cur.nodeType !== 9) {\r\n\t\t\tif (until !== undefined) {\r\n\t\t\t\tif (cur === until) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof until == 'string' && DomQuery(cur).is(until)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (cur.nodeType === 1) {\r\n\t\t\t\tmatched.push(cur);\r\n\t\t\t}\r\n\r\n\t\t\tcur = cur[prop];\r\n\t\t}\r\n\r\n\t\treturn matched;\r\n\t}\r\n\r\n\tfunction sibling(node, siblingName, nodeType, until) {\r\n\t\tvar result = [];\r\n\r\n\t\tif (until instanceof DomQuery) {\r\n\t\t\tuntil = until[0];\r\n\t\t}\r\n\r\n\t\tfor (; node; node = node[siblingName]) {\r\n\t\t\tif (nodeType && node.nodeType !== nodeType) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (until !== undefined) {\r\n\t\t\t\tif (node === until) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof until == 'string' && DomQuery(node).is(until)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tresult.push(node);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction firstSibling(node, siblingName, nodeType) {\r\n\t\tfor (node = node[siblingName]; node; node = node[siblingName]) {\r\n\t\t\tif (node.nodeType == nodeType) {\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\teach({\r\n\t\t/**\r\n\t\t * Returns a new collection with the parent of each item in current collection matching the optional selector.\r\n\t\t *\r\n\t\t * @method parent\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\r\n\t\t */\r\n\t\tparent: function(node) {\r\n\t\t\tvar parent = node.parentNode;\r\n\r\n\t\t\treturn parent && parent.nodeType !== 11 ? parent : null;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a new collection with the all the parents of each item in current collection matching the optional selector.\r\n\t\t *\r\n\t\t * @method parents\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\r\n\t\t */\r\n\t\tparents: function(node) {\r\n\t\t\treturn dir(node, \"parentNode\");\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a new collection with next sibling of each item in current collection matching the optional selector.\r\n\t\t *\r\n\t\t * @method next\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the next element against.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\r\n\t\t */\r\n\t\tnext: function(node) {\r\n\t\t\treturn firstSibling(node, 'nextSibling', 1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a new collection with previous sibling of each item in current collection matching the optional selector.\r\n\t\t *\r\n\t\t * @method prev\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the previous element against.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\r\n\t\t */\r\n\t\tprev: function(node) {\r\n\t\t\treturn firstSibling(node, 'previousSibling', 1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns all child elements matching the optional selector.\r\n\t\t *\r\n\t\t * @method children\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the elements against.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\r\n\t\t */\r\n\t\tchildren: function(node) {\r\n\t\t\treturn sibling(node.firstChild, 'nextSibling', 1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns all child nodes matching the optional selector.\r\n\t\t *\r\n\t\t * @method contents\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to get the contents of.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\r\n\t\t */\r\n\t\tcontents: function(node) {\r\n\t\t\treturn Tools.toArray((node.nodeName === \"iframe\" ? node.contentDocument || node.contentWindow.document : node).childNodes);\r\n\t\t}\r\n\t}, function(name, fn) {\r\n\t\tDomQuery.fn[name] = function(selector) {\r\n\t\t\tvar self = this, result = [];\r\n\r\n\t\t\tself.each(function() {\r\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\r\n\r\n\t\t\t\tif (nodes) {\r\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\r\n\t\t\t\t\t\tresult.push.apply(result, nodes);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresult.push(nodes);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// If traversing on multiple elements we might get the same elements twice\r\n\t\t\tif (this.length > 1) {\r\n\t\t\t\tif (!skipUniques[name]) {\r\n\t\t\t\t\tresult = DomQuery.unique(result);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (name.indexOf('parents') === 0) {\r\n\t\t\t\t\tresult = result.reverse();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tresult = DomQuery(result);\r\n\r\n\t\t\tif (selector) {\r\n\t\t\t\treturn result.filter(selector);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t};\r\n\t});\r\n\r\n\teach({\r\n\t\t/**\r\n\t\t * Returns a new collection with the all the parents until the matching selector/element\r\n\t\t * of each item in current collection matching the optional selector.\r\n\t\t *\r\n\t\t * @method parentsUntil\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find parent of.\r\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\r\n\t\t */\r\n\t\tparentsUntil: function(node, until) {\r\n\t\t\treturn dir(node, \"parentNode\", until);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a new collection with all next siblings of each item in current collection matching the optional selector.\r\n\t\t *\r\n\t\t * @method nextUntil\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find next siblings on.\r\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\r\n\t\t */\r\n\t\tnextUntil: function(node, until) {\r\n\t\t\treturn sibling(node, 'nextSibling', 1, until).slice(1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a new collection with all previous siblings of each item in current collection matching the optional selector.\r\n\t\t *\r\n\t\t * @method prevUntil\r\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find previous siblings on.\r\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\r\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\r\n\t\t */\r\n\t\tprevUntil: function(node, until) {\r\n\t\t\treturn sibling(node, 'previousSibling', 1, until).slice(1);\r\n\t\t}\r\n\t}, function(name, fn) {\r\n\t\tDomQuery.fn[name] = function(selector, filter) {\r\n\t\t\tvar self = this, result = [];\r\n\r\n\t\t\tself.each(function() {\r\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\r\n\r\n\t\t\t\tif (nodes) {\r\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\r\n\t\t\t\t\t\tresult.push.apply(result, nodes);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresult.push(nodes);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// If traversing on multiple elements we might get the same elements twice\r\n\t\t\tif (this.length > 1) {\r\n\t\t\t\tresult = DomQuery.unique(result);\r\n\r\n\t\t\t\tif (name.indexOf('parents') === 0 || name === 'prevUntil') {\r\n\t\t\t\t\tresult = result.reverse();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tresult = DomQuery(result);\r\n\r\n\t\t\tif (filter) {\r\n\t\t\t\treturn result.filter(filter);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t};\r\n\t});\r\n\r\n\t/**\r\n\t * Returns true/false if the current set items matches the selector.\r\n\t *\r\n\t * @method is\r\n\t * @param {String} selector Selector to match the elements against.\r\n\t * @return {Boolean} True/false if the current set matches the selector.\r\n\t */\r\n\tDomQuery.fn.is = function(selector) {\r\n\t\treturn !!selector && this.filter(selector).length > 0;\r\n\t};\r\n\r\n\tDomQuery.fn.init.prototype = DomQuery.fn;\r\n\r\n\tDomQuery.overrideDefaults = function(callback) {\r\n\t\tvar defaults;\r\n\r\n\t\tfunction sub(selector, context) {\r\n\t\t\tdefaults = defaults || callback();\r\n\r\n\t\t\tif (arguments.length === 0) {\r\n\t\t\t\tselector = defaults.element;\r\n\t\t\t}\r\n\r\n\t\t\tif (!context) {\r\n\t\t\t\tcontext = defaults.context;\r\n\t\t\t}\r\n\r\n\t\t\treturn new sub.fn.init(selector, context);\r\n\t\t}\r\n\r\n\t\tDomQuery.extend(sub, this);\r\n\r\n\t\treturn sub;\r\n\t};\r\n\r\n\tfunction appendHooks(targetHooks, prop, hooks) {\r\n\t\teach(hooks, function(name, func) {\r\n\t\t\ttargetHooks[name] = targetHooks[name] || {};\r\n\t\t\ttargetHooks[name][prop] = func;\r\n\t\t});\r\n\t}\r\n\r\n\tif (Env.ie && Env.ie < 8) {\r\n\t\tappendHooks(attrHooks, 'get', {\r\n\t\t\tmaxlength: function(elm) {\r\n\t\t\t\tvar value = elm.maxLength;\r\n\r\n\t\t\t\tif (value === 0x7fffffff) {\r\n\t\t\t\t\treturn undef;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tsize: function(elm) {\r\n\t\t\t\tvar value = elm.size;\r\n\r\n\t\t\t\tif (value === 20) {\r\n\t\t\t\t\treturn undef;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\t'class': function(elm) {\r\n\t\t\t\treturn elm.className;\r\n\t\t\t},\r\n\r\n\t\t\tstyle: function(elm) {\r\n\t\t\t\tvar value = elm.style.cssText;\r\n\r\n\t\t\t\tif (value.length === 0) {\r\n\t\t\t\t\treturn undef;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tappendHooks(attrHooks, 'set', {\r\n\t\t\t'class': function(elm, value) {\r\n\t\t\t\telm.className = value;\r\n\t\t\t},\r\n\r\n\t\t\tstyle: function(elm, value) {\r\n\t\t\t\telm.style.cssText = value;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tif (Env.ie && Env.ie < 9) {\r\n\t\t/*jshint sub:true */\r\n\t\t/*eslint dot-notation: 0*/\r\n\t\tcssFix['float'] = 'styleFloat';\r\n\r\n\t\tappendHooks(cssHooks, 'set', {\r\n\t\t\topacity: function(elm, value) {\r\n\t\t\t\tvar style = elm.style;\r\n\r\n\t\t\t\tif (value === null || value === '') {\r\n\t\t\t\t\tstyle.removeAttribute('filter');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstyle.zoom = 1;\r\n\t\t\t\t\tstyle.filter = 'alpha(opacity=' + (value * 100) + ')';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tDomQuery.attrHooks = attrHooks;\r\n\tDomQuery.cssHooks = cssHooks;\r\n\r\n\treturn DomQuery;\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/Styles.js\r\n\r\n/**\r\n * Styles.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is used to parse CSS styles it also compresses styles to reduce the output size.\r\n *\r\n * @example\r\n * var Styles = new tinymce.html.Styles({\r\n *    url_converter: function(url) {\r\n *       return url;\r\n *    }\r\n * });\r\n *\r\n * styles = Styles.parse('border: 1px solid red');\r\n * styles.color = 'red';\r\n *\r\n * console.log(new tinymce.html.StyleSerializer().serialize(styles));\r\n *\r\n * @class tinymce.html.Styles\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/Styles\", [], function() {\r\n\treturn function(settings, schema) {\r\n\t\t/*jshint maxlen:255 */\r\n\t\t/*eslint max-len:0 */\r\n\t\tvar rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi,\r\n\t\t\turlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi,\r\n\t\t\tstyleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g,\r\n\t\t\ttrimRightRegExp = /\\s+$/,\r\n\t\t\tundef, i, encodingLookup = {}, encodingItems, validStyles, invalidStyles, invisibleChar = '\\uFEFF';\r\n\r\n\t\tsettings = settings || {};\r\n\r\n\t\tif (schema) {\r\n\t\t\tvalidStyles = schema.getValidStyles();\r\n\t\t\tinvalidStyles = schema.getInvalidStyles();\r\n\t\t}\r\n\r\n\t\tencodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\r\n\t\tfor (i = 0; i < encodingItems.length; i++) {\r\n\t\t\tencodingLookup[encodingItems[i]] = invisibleChar + i;\r\n\t\t\tencodingLookup[invisibleChar + i] = encodingItems[i];\r\n\t\t}\r\n\r\n\t\tfunction toHex(match, r, g, b) {\r\n\t\t\tfunction hex(val) {\r\n\t\t\t\tval = parseInt(val, 10).toString(16);\r\n\r\n\t\t\t\treturn val.length > 1 ? val : '0' + val; // 0 -> 00\r\n\t\t\t}\r\n\r\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t/**\r\n\t\t\t * Parses the specified RGB color value and returns a hex version of that color.\r\n\t\t\t *\r\n\t\t\t * @method toHex\r\n\t\t\t * @param {String} color RGB string value like rgb(1,2,3)\r\n\t\t\t * @return {String} Hex version of that RGB value like #FF00FF.\r\n\t\t\t */\r\n\t\t\ttoHex: function(color) {\r\n\t\t\t\treturn color.replace(rgbRegExp, toHex);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Parses the specified style value into an object collection. This parser will also\r\n\t\t\t * merge and remove any redundant items that browsers might have added. It will also convert non hex\r\n\t\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\r\n\t\t\t *\r\n\t\t\t * @method parse\r\n\t\t\t * @param {String} css Style value to parse for example: border:1px solid red;.\r\n\t\t\t * @return {Object} Object representation of that style like {border: '1px solid red'}\r\n\t\t\t */\r\n\t\t\tparse: function(css) {\r\n\t\t\t\tvar styles = {}, matches, name, value, isEncoded, urlConverter = settings.url_converter;\r\n\t\t\t\tvar urlConverterScope = settings.url_converter_scope || this;\r\n\r\n\t\t\t\tfunction compress(prefix, suffix, noJoin) {\r\n\t\t\t\t\tvar top, right, bottom, left;\r\n\r\n\t\t\t\t\ttop = styles[prefix + '-top' + suffix];\r\n\t\t\t\t\tif (!top) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tright = styles[prefix + '-right' + suffix];\r\n\t\t\t\t\tif (!right) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbottom = styles[prefix + '-bottom' + suffix];\r\n\t\t\t\t\tif (!bottom) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tleft = styles[prefix + '-left' + suffix];\r\n\t\t\t\t\tif (!left) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar box = [top, right, bottom, left];\r\n\t\t\t\t\ti = box.length - 1;\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tif (box[i] !== box[i + 1]) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (i > -1 && noJoin) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstyles[prefix + suffix] = i == -1 ? box[0] : box.join(' ');\r\n\t\t\t\t\tdelete styles[prefix + '-top' + suffix];\r\n\t\t\t\t\tdelete styles[prefix + '-right' + suffix];\r\n\t\t\t\t\tdelete styles[prefix + '-bottom' + suffix];\r\n\t\t\t\t\tdelete styles[prefix + '-left' + suffix];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Checks if the specific style can be compressed in other words if all border-width are equal.\r\n\t\t\t\t */\r\n\t\t\t\tfunction canCompress(key) {\r\n\t\t\t\t\tvar value = styles[key], i;\r\n\r\n\t\t\t\t\tif (!value) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvalue = value.split(' ');\r\n\t\t\t\t\ti = value.length;\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tif (value[i] !== value[0]) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstyles[key] = value[0];\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Compresses multiple styles into one style.\r\n\t\t\t\t */\r\n\t\t\t\tfunction compress2(target, a, b, c) {\r\n\t\t\t\t\tif (!canCompress(a)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!canCompress(b)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!canCompress(c)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Compress\r\n\t\t\t\t\tstyles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\r\n\t\t\t\t\tdelete styles[a];\r\n\t\t\t\t\tdelete styles[b];\r\n\t\t\t\t\tdelete styles[c];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Encodes the specified string by replacing all \\\" \\' ; : with _<num>\r\n\t\t\t\tfunction encode(str) {\r\n\t\t\t\t\tisEncoded = true;\r\n\r\n\t\t\t\t\treturn encodingLookup[str];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Decodes the specified string by replacing all _<num> with it's original value \\\" \\' etc\r\n\t\t\t\t// It will also decode the \\\" \\' if keep_slashes is set to fale or omitted\r\n\t\t\t\tfunction decode(str, keep_slashes) {\r\n\t\t\t\t\tif (isEncoded) {\r\n\t\t\t\t\t\tstr = str.replace(/\\uFEFF[0-9]/g, function(str) {\r\n\t\t\t\t\t\t\treturn encodingLookup[str];\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!keep_slashes) {\r\n\t\t\t\t\t\tstr = str.replace(/\\\\([\\'\\\";:])/g, \"$1\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn str;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction processUrl(match, url, url2, url3, str, str2) {\r\n\t\t\t\t\tstr = str || str2;\r\n\r\n\t\t\t\t\tif (str) {\r\n\t\t\t\t\t\tstr = decode(str);\r\n\r\n\t\t\t\t\t\t// Force strings into single quote format\r\n\t\t\t\t\t\treturn \"'\" + str.replace(/\\'/g, \"\\\\'\") + \"'\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\turl = decode(url || url2 || url3);\r\n\r\n\t\t\t\t\tif (!settings.allow_script_urls) {\r\n\t\t\t\t\t\tvar scriptUrl = url.replace(/[\\s\\r\\n]+/, '');\r\n\r\n\t\t\t\t\t\tif (/(java|vb)script:/i.test(scriptUrl)) {\r\n\t\t\t\t\t\t\treturn \"\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\r\n\t\t\t\t\t\t\treturn \"\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Convert the URL to relative/absolute depending on config\r\n\t\t\t\t\tif (urlConverter) {\r\n\t\t\t\t\t\turl = urlConverter.call(urlConverterScope, url, 'style');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Output new URL format\r\n\t\t\t\t\treturn \"url('\" + url.replace(/\\'/g, \"\\\\'\") + \"')\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (css) {\r\n\t\t\t\t\tcss = css.replace(/[\\u0000-\\u001F]/g, '');\r\n\r\n\t\t\t\t\t// Encode \\\" \\' % and ; and : inside strings so they don't interfere with the style parsing\r\n\t\t\t\t\tcss = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function(str) {\r\n\t\t\t\t\t\treturn str.replace(/[;:]/g, encode);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Parse styles\r\n\t\t\t\t\twhile ((matches = styleRegExp.exec(css))) {\r\n\t\t\t\t\t\tname = matches[1].replace(trimRightRegExp, '').toLowerCase();\r\n\t\t\t\t\t\tvalue = matches[2].replace(trimRightRegExp, '');\r\n\r\n\t\t\t\t\t\t// Decode escaped sequences like \\65 -> e\r\n\t\t\t\t\t\t/*jshint loopfunc:true*/\r\n\t\t\t\t\t\t/*eslint no-loop-func:0 */\r\n\t\t\t\t\t\tvalue = value.replace(/\\\\[0-9a-f]+/g, function(e) {\r\n\t\t\t\t\t\t\treturn String.fromCharCode(parseInt(e.substr(1), 16));\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif (name && value.length > 0) {\r\n\t\t\t\t\t\t\t// Don't allow behavior name or expression/comments within the values\r\n\t\t\t\t\t\t\tif (!settings.allow_script_urls && (name == \"behavior\" || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Opera will produce 700 instead of bold in their style values\r\n\t\t\t\t\t\t\tif (name === 'font-weight' && value === '700') {\r\n\t\t\t\t\t\t\t\tvalue = 'bold';\r\n\t\t\t\t\t\t\t} else if (name === 'color' || name === 'background-color') { // Lowercase colors like RED\r\n\t\t\t\t\t\t\t\tvalue = value.toLowerCase();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Convert RGB colors to HEX\r\n\t\t\t\t\t\t\tvalue = value.replace(rgbRegExp, toHex);\r\n\r\n\t\t\t\t\t\t\t// Convert URLs and force them into url('value') format\r\n\t\t\t\t\t\t\tvalue = value.replace(urlOrStrRegExp, processUrl);\r\n\t\t\t\t\t\t\tstyles[name] = isEncoded ? decode(value, true) : value;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstyleRegExp.lastIndex = matches.index + matches[0].length;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Compress the styles to reduce it's size for example IE will expand styles\r\n\t\t\t\t\tcompress(\"border\", \"\", true);\r\n\t\t\t\t\tcompress(\"border\", \"-width\");\r\n\t\t\t\t\tcompress(\"border\", \"-color\");\r\n\t\t\t\t\tcompress(\"border\", \"-style\");\r\n\t\t\t\t\tcompress(\"padding\", \"\");\r\n\t\t\t\t\tcompress(\"margin\", \"\");\r\n\t\t\t\t\tcompress2('border', 'border-width', 'border-style', 'border-color');\r\n\r\n\t\t\t\t\t// Remove pointless border, IE produces these\r\n\t\t\t\t\tif (styles.border === 'medium none') {\r\n\t\t\t\t\t\tdelete styles.border;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// IE 11 will produce a border-image: none when getting the style attribute from <p style=\"border: 1px solid red\"></p>\r\n\t\t\t\t\t// So let us assume it shouldn't be there\r\n\t\t\t\t\tif (styles['border-image'] === 'none') {\r\n\t\t\t\t\t\tdelete styles['border-image'];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn styles;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Serializes the specified style object into a string.\r\n\t\t\t *\r\n\t\t\t * @method serialize\r\n\t\t\t * @param {Object} styles Object to serialize as string for example: {border: '1px solid red'}\r\n\t\t\t * @param {String} elementName Optional element name, if specified only the styles that matches the schema will be serialized.\r\n\t\t\t * @return {String} String representation of the style object for example: border: 1px solid red.\r\n\t\t\t */\r\n\t\t\tserialize: function(styles, elementName) {\r\n\t\t\t\tvar css = '', name, value;\r\n\r\n\t\t\t\tfunction serializeStyles(name) {\r\n\t\t\t\t\tvar styleList, i, l, value;\r\n\r\n\t\t\t\t\tstyleList = validStyles[name];\r\n\t\t\t\t\tif (styleList) {\r\n\t\t\t\t\t\tfor (i = 0, l = styleList.length; i < l; i++) {\r\n\t\t\t\t\t\t\tname = styleList[i];\r\n\t\t\t\t\t\t\tvalue = styles[name];\r\n\r\n\t\t\t\t\t\t\tif (value !== undef && value.length > 0) {\r\n\t\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction isValid(name, elementName) {\r\n\t\t\t\t\tvar styleMap;\r\n\r\n\t\t\t\t\tstyleMap = invalidStyles['*'];\r\n\t\t\t\t\tif (styleMap && styleMap[name]) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstyleMap = invalidStyles[elementName];\r\n\t\t\t\t\tif (styleMap && styleMap[name]) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Serialize styles according to schema\r\n\t\t\t\tif (elementName && validStyles) {\r\n\t\t\t\t\t// Serialize global styles and element specific styles\r\n\t\t\t\t\tserializeStyles('*');\r\n\t\t\t\t\tserializeStyles(elementName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Output the styles in the order they are inside the object\r\n\t\t\t\t\tfor (name in styles) {\r\n\t\t\t\t\t\tvalue = styles[name];\r\n\r\n\t\t\t\t\t\tif (value !== undef && value.length > 0) {\r\n\t\t\t\t\t\t\tif (!invalidStyles || isValid(name, elementName)) {\r\n\t\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn css;\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/TreeWalker.js\r\n\r\n/**\r\n * TreeWalker.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * TreeWalker class enables you to walk the DOM in a linear manner.\r\n *\r\n * @class tinymce.dom.TreeWalker\r\n * @example\r\n * var walker = new tinymce.dom.TreeWalker(startNode);\r\n *\r\n * do {\r\n *     console.log(walker.current());\r\n * } while (walker.next());\r\n */\r\ndefine(\"tinymce/dom/TreeWalker\", [], function() {\r\n\t/**\r\n\t * Constructs a new TreeWalker instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method TreeWalker\r\n\t * @param {Node} startNode Node to start walking from.\r\n\t * @param {node} rootNode Optional root node to never walk out of.\r\n\t */\r\n\treturn function(startNode, rootNode) {\r\n\t\tvar node = startNode;\r\n\r\n\t\tfunction findSibling(node, startName, siblingName, shallow) {\r\n\t\t\tvar sibling, parent;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\t// Walk into nodes if it has a start\r\n\t\t\t\tif (!shallow && node[startName]) {\r\n\t\t\t\t\treturn node[startName];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Return the sibling if it has one\r\n\t\t\t\tif (node != rootNode) {\r\n\t\t\t\t\tsibling = node[siblingName];\r\n\t\t\t\t\tif (sibling) {\r\n\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Walk up the parents to look for siblings\r\n\t\t\t\t\tfor (parent = node.parentNode; parent && parent != rootNode; parent = parent.parentNode) {\r\n\t\t\t\t\t\tsibling = parent[siblingName];\r\n\t\t\t\t\t\tif (sibling) {\r\n\t\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction findPreviousNode(node, startName, siblingName, shallow) {\r\n\t\t\tvar sibling, parent, child;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\tsibling = node[siblingName];\r\n\t\t\t\tif (rootNode && sibling === rootNode) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (sibling) {\r\n\t\t\t\t\tif (!shallow) {\r\n\t\t\t\t\t\t// Walk up the parents to look for siblings\r\n\t\t\t\t\t\tfor (child = sibling[startName]; child; child = child[startName]) {\r\n\t\t\t\t\t\t\tif (!child[startName]) {\r\n\t\t\t\t\t\t\t\treturn child;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparent = node.parentNode;\r\n\t\t\t\tif (parent && parent !== rootNode) {\r\n\t\t\t\t\treturn parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the current node.\r\n\t\t *\r\n\t\t * @method current\r\n\t\t * @return {Node} Current node where the walker is.\r\n\t\t */\r\n\t\tthis.current = function() {\r\n\t\t\treturn node;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Walks to the next node in tree.\r\n\t\t *\r\n\t\t * @method next\r\n\t\t * @return {Node} Current node where the walker is after moving to the next node.\r\n\t\t */\r\n\t\tthis.next = function(shallow) {\r\n\t\t\tnode = findSibling(node, 'firstChild', 'nextSibling', shallow);\r\n\t\t\treturn node;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Walks to the previous node in tree.\r\n\t\t *\r\n\t\t * @method prev\r\n\t\t * @return {Node} Current node where the walker is after moving to the previous node.\r\n\t\t */\r\n\t\tthis.prev = function(shallow) {\r\n\t\t\tnode = findSibling(node, 'lastChild', 'previousSibling', shallow);\r\n\t\t\treturn node;\r\n\t\t};\r\n\r\n\t\tthis.prev2 = function(shallow) {\r\n\t\t\tnode = findPreviousNode(node, 'lastChild', 'previousSibling', shallow);\r\n\t\t\treturn node;\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/Range.js\r\n\r\n/**\r\n * Range.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Old IE Range.\r\n *\r\n * @private\r\n * @class tinymce.dom.Range\r\n */\r\ndefine(\"tinymce/dom/Range\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\t// Range constructor\r\n\tfunction Range(dom) {\r\n\t\tvar self = this,\r\n\t\t\tdoc = dom.doc,\r\n\t\t\tEXTRACT = 0,\r\n\t\t\tCLONE = 1,\r\n\t\t\tDELETE = 2,\r\n\t\t\tTRUE = true,\r\n\t\t\tFALSE = false,\r\n\t\t\tSTART_OFFSET = 'startOffset',\r\n\t\t\tSTART_CONTAINER = 'startContainer',\r\n\t\t\tEND_CONTAINER = 'endContainer',\r\n\t\t\tEND_OFFSET = 'endOffset',\r\n\t\t\textend = Tools.extend,\r\n\t\t\tnodeIndex = dom.nodeIndex;\r\n\r\n\t\tfunction createDocumentFragment() {\r\n\t\t\treturn doc.createDocumentFragment();\r\n\t\t}\r\n\r\n\t\tfunction setStart(n, o) {\r\n\t\t\t_setEndPoint(TRUE, n, o);\r\n\t\t}\r\n\r\n\t\tfunction setEnd(n, o) {\r\n\t\t\t_setEndPoint(FALSE, n, o);\r\n\t\t}\r\n\r\n\t\tfunction setStartBefore(n) {\r\n\t\t\tsetStart(n.parentNode, nodeIndex(n));\r\n\t\t}\r\n\r\n\t\tfunction setStartAfter(n) {\r\n\t\t\tsetStart(n.parentNode, nodeIndex(n) + 1);\r\n\t\t}\r\n\r\n\t\tfunction setEndBefore(n) {\r\n\t\t\tsetEnd(n.parentNode, nodeIndex(n));\r\n\t\t}\r\n\r\n\t\tfunction setEndAfter(n) {\r\n\t\t\tsetEnd(n.parentNode, nodeIndex(n) + 1);\r\n\t\t}\r\n\r\n\t\tfunction collapse(ts) {\r\n\t\t\tif (ts) {\r\n\t\t\t\tself[END_CONTAINER] = self[START_CONTAINER];\r\n\t\t\t\tself[END_OFFSET] = self[START_OFFSET];\r\n\t\t\t} else {\r\n\t\t\t\tself[START_CONTAINER] = self[END_CONTAINER];\r\n\t\t\t\tself[START_OFFSET] = self[END_OFFSET];\r\n\t\t\t}\r\n\r\n\t\t\tself.collapsed = TRUE;\r\n\t\t}\r\n\r\n\t\tfunction selectNode(n) {\r\n\t\t\tsetStartBefore(n);\r\n\t\t\tsetEndAfter(n);\r\n\t\t}\r\n\r\n\t\tfunction selectNodeContents(n) {\r\n\t\t\tsetStart(n, 0);\r\n\t\t\tsetEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);\r\n\t\t}\r\n\r\n\t\tfunction compareBoundaryPoints(h, r) {\r\n\t\t\tvar sc = self[START_CONTAINER], so = self[START_OFFSET], ec = self[END_CONTAINER], eo = self[END_OFFSET],\r\n\t\t\trsc = r.startContainer, rso = r.startOffset, rec = r.endContainer, reo = r.endOffset;\r\n\r\n\t\t\t// Check START_TO_START\r\n\t\t\tif (h === 0) {\r\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rsc, rso);\r\n\t\t\t}\r\n\r\n\t\t\t// Check START_TO_END\r\n\t\t\tif (h === 1) {\r\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rsc, rso);\r\n\t\t\t}\r\n\r\n\t\t\t// Check END_TO_END\r\n\t\t\tif (h === 2) {\r\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rec, reo);\r\n\t\t\t}\r\n\r\n\t\t\t// Check END_TO_START\r\n\t\t\tif (h === 3) {\r\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rec, reo);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction deleteContents() {\r\n\t\t\t_traverse(DELETE);\r\n\t\t}\r\n\r\n\t\tfunction extractContents() {\r\n\t\t\treturn _traverse(EXTRACT);\r\n\t\t}\r\n\r\n\t\tfunction cloneContents() {\r\n\t\t\treturn _traverse(CLONE);\r\n\t\t}\r\n\r\n\t\tfunction insertNode(n) {\r\n\t\t\tvar startContainer = this[START_CONTAINER],\r\n\t\t\t\tstartOffset = this[START_OFFSET], nn, o;\r\n\r\n\t\t\t// Node is TEXT_NODE or CDATA\r\n\t\t\tif ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {\r\n\t\t\t\tif (!startOffset) {\r\n\t\t\t\t\t// At the start of text\r\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, startContainer);\r\n\t\t\t\t} else if (startOffset >= startContainer.nodeValue.length) {\r\n\t\t\t\t\t// At the end of text\r\n\t\t\t\t\tdom.insertAfter(n, startContainer);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Middle, need to split\r\n\t\t\t\t\tnn = startContainer.splitText(startOffset);\r\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, nn);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Insert element node\r\n\t\t\t\tif (startContainer.childNodes.length > 0) {\r\n\t\t\t\t\to = startContainer.childNodes[startOffset];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (o) {\r\n\t\t\t\t\tstartContainer.insertBefore(n, o);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (startContainer.nodeType == 3) {\r\n\t\t\t\t\t\tdom.insertAfter(n, startContainer);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstartContainer.appendChild(n);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction surroundContents(n) {\r\n\t\t\tvar f = self.extractContents();\r\n\r\n\t\t\tself.insertNode(n);\r\n\t\t\tn.appendChild(f);\r\n\t\t\tself.selectNode(n);\r\n\t\t}\r\n\r\n\t\tfunction cloneRange() {\r\n\t\t\treturn extend(new Range(dom), {\r\n\t\t\t\tstartContainer: self[START_CONTAINER],\r\n\t\t\t\tstartOffset: self[START_OFFSET],\r\n\t\t\t\tendContainer: self[END_CONTAINER],\r\n\t\t\t\tendOffset: self[END_OFFSET],\r\n\t\t\t\tcollapsed: self.collapsed,\r\n\t\t\t\tcommonAncestorContainer: self.commonAncestorContainer\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Private methods\r\n\r\n\t\tfunction _getSelectedNode(container, offset) {\r\n\t\t\tvar child;\r\n\r\n\t\t\t// TEXT_NODE\r\n\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\r\n\t\t\tif (offset < 0) {\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\r\n\t\t\tchild = container.firstChild;\r\n\t\t\twhile (child && offset > 0) {\r\n\t\t\t\t--offset;\r\n\t\t\t\tchild = child.nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\tif (child) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\r\n\t\t\treturn container;\r\n\t\t}\r\n\r\n\t\tfunction _isCollapsed() {\r\n\t\t\treturn (self[START_CONTAINER] == self[END_CONTAINER] && self[START_OFFSET] == self[END_OFFSET]);\r\n\t\t}\r\n\r\n\t\tfunction _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {\r\n\t\t\tvar c, offsetC, n, cmnRoot, childA, childB;\r\n\r\n\t\t\t// In the first case the boundary-points have the same container. A is before B\r\n\t\t\t// if its offset is less than the offset of B, A is equal to B if its offset is\r\n\t\t\t// equal to the offset of B, and A is after B if its offset is greater than the\r\n\t\t\t// offset of B.\r\n\t\t\tif (containerA == containerB) {\r\n\t\t\t\tif (offsetA == offsetB) {\r\n\t\t\t\t\treturn 0; // equal\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offsetA < offsetB) {\r\n\t\t\t\t\treturn -1; // before\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the second case a child node C of the container of A is an ancestor\r\n\t\t\t// container of B. In this case, A is before B if the offset of A is less than or\r\n\t\t\t// equal to the index of the child node C and A is after B otherwise.\r\n\t\t\tc = containerB;\r\n\t\t\twhile (c && c.parentNode != containerA) {\r\n\t\t\t\tc = c.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\toffsetC = 0;\r\n\t\t\t\tn = containerA.firstChild;\r\n\r\n\t\t\t\twhile (n != c && offsetC < offsetA) {\r\n\t\t\t\t\toffsetC++;\r\n\t\t\t\t\tn = n.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offsetA <= offsetC) {\r\n\t\t\t\t\treturn -1; // before\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the third case a child node C of the container of B is an ancestor container\r\n\t\t\t// of A. In this case, A is before B if the index of the child node C is less than\r\n\t\t\t// the offset of B and A is after B otherwise.\r\n\t\t\tc = containerA;\r\n\t\t\twhile (c && c.parentNode != containerB) {\r\n\t\t\t\tc = c.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (c) {\r\n\t\t\t\toffsetC = 0;\r\n\t\t\t\tn = containerB.firstChild;\r\n\r\n\t\t\t\twhile (n != c && offsetC < offsetB) {\r\n\t\t\t\t\toffsetC++;\r\n\t\t\t\t\tn = n.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offsetC < offsetB) {\r\n\t\t\t\t\treturn -1; // before\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn 1; // after\r\n\t\t\t}\r\n\r\n\t\t\t// In the fourth case, none of three other cases hold: the containers of A and B\r\n\t\t\t// are siblings or descendants of sibling nodes. In this case, A is before B if\r\n\t\t\t// the container of A is before the container of B in a pre-order traversal of the\r\n\t\t\t// Ranges' context tree and A is after B otherwise.\r\n\t\t\tcmnRoot = dom.findCommonAncestor(containerA, containerB);\r\n\t\t\tchildA = containerA;\r\n\r\n\t\t\twhile (childA && childA.parentNode != cmnRoot) {\r\n\t\t\t\tchildA = childA.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (!childA) {\r\n\t\t\t\tchildA = cmnRoot;\r\n\t\t\t}\r\n\r\n\t\t\tchildB = containerB;\r\n\t\t\twhile (childB && childB.parentNode != cmnRoot) {\r\n\t\t\t\tchildB = childB.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (!childB) {\r\n\t\t\t\tchildB = cmnRoot;\r\n\t\t\t}\r\n\r\n\t\t\tif (childA == childB) {\r\n\t\t\t\treturn 0; // equal\r\n\t\t\t}\r\n\r\n\t\t\tn = cmnRoot.firstChild;\r\n\t\t\twhile (n) {\r\n\t\t\t\tif (n == childA) {\r\n\t\t\t\t\treturn -1; // before\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (n == childB) {\r\n\t\t\t\t\treturn 1; // after\r\n\t\t\t\t}\r\n\r\n\t\t\t\tn = n.nextSibling;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction _setEndPoint(st, n, o) {\r\n\t\t\tvar ec, sc;\r\n\r\n\t\t\tif (st) {\r\n\t\t\t\tself[START_CONTAINER] = n;\r\n\t\t\t\tself[START_OFFSET] = o;\r\n\t\t\t} else {\r\n\t\t\t\tself[END_CONTAINER] = n;\r\n\t\t\t\tself[END_OFFSET] = o;\r\n\t\t\t}\r\n\r\n\t\t\t// If one boundary-point of a Range is set to have a root container\r\n\t\t\t// other than the current one for the Range, the Range is collapsed to\r\n\t\t\t// the new position. This enforces the restriction that both boundary-\r\n\t\t\t// points of a Range must have the same root container.\r\n\t\t\tec = self[END_CONTAINER];\r\n\t\t\twhile (ec.parentNode) {\r\n\t\t\t\tec = ec.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tsc = self[START_CONTAINER];\r\n\t\t\twhile (sc.parentNode) {\r\n\t\t\t\tsc = sc.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (sc == ec) {\r\n\t\t\t\t// The start position of a Range is guaranteed to never be after the\r\n\t\t\t\t// end position. To enforce this restriction, if the start is set to\r\n\t\t\t\t// be at a position after the end, the Range is collapsed to that\r\n\t\t\t\t// position.\r\n\t\t\t\tif (_compareBoundaryPoints(self[START_CONTAINER], self[START_OFFSET], self[END_CONTAINER], self[END_OFFSET]) > 0) {\r\n\t\t\t\t\tself.collapse(st);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tself.collapse(st);\r\n\t\t\t}\r\n\r\n\t\t\tself.collapsed = _isCollapsed();\r\n\t\t\tself.commonAncestorContainer = dom.findCommonAncestor(self[START_CONTAINER], self[END_CONTAINER]);\r\n\t\t}\r\n\r\n\t\tfunction _traverse(how) {\r\n\t\t\tvar c, endContainerDepth = 0, startContainerDepth = 0, p, depthDiff, startNode, endNode, sp, ep;\r\n\r\n\t\t\tif (self[START_CONTAINER] == self[END_CONTAINER]) {\r\n\t\t\t\treturn _traverseSameContainer(how);\r\n\t\t\t}\r\n\r\n\t\t\tfor (c = self[END_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\r\n\t\t\t\tif (p == self[START_CONTAINER]) {\r\n\t\t\t\t\treturn _traverseCommonStartContainer(c, how);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t++endContainerDepth;\r\n\t\t\t}\r\n\r\n\t\t\tfor (c = self[START_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\r\n\t\t\t\tif (p == self[END_CONTAINER]) {\r\n\t\t\t\t\treturn _traverseCommonEndContainer(c, how);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t++startContainerDepth;\r\n\t\t\t}\r\n\r\n\t\t\tdepthDiff = startContainerDepth - endContainerDepth;\r\n\r\n\t\t\tstartNode = self[START_CONTAINER];\r\n\t\t\twhile (depthDiff > 0) {\r\n\t\t\t\tstartNode = startNode.parentNode;\r\n\t\t\t\tdepthDiff--;\r\n\t\t\t}\r\n\r\n\t\t\tendNode = self[END_CONTAINER];\r\n\t\t\twhile (depthDiff < 0) {\r\n\t\t\t\tendNode = endNode.parentNode;\r\n\t\t\t\tdepthDiff++;\r\n\t\t\t}\r\n\r\n\t\t\t// ascend the ancestor hierarchy until we have a common parent.\r\n\t\t\tfor (sp = startNode.parentNode, ep = endNode.parentNode; sp != ep; sp = sp.parentNode, ep = ep.parentNode) {\r\n\t\t\t\tstartNode = sp;\r\n\t\t\t\tendNode = ep;\r\n\t\t\t}\r\n\r\n\t\t\treturn _traverseCommonAncestors(startNode, endNode, how);\r\n\t\t}\r\n\r\n\t\tfunction _traverseSameContainer(how) {\r\n\t\t\tvar frag, s, sub, n, cnt, sibling, xferNode, start, len;\r\n\r\n\t\t\tif (how != DELETE) {\r\n\t\t\t\tfrag = createDocumentFragment();\r\n\t\t\t}\r\n\r\n\t\t\t// If selection is empty, just return the fragment\r\n\t\t\tif (self[START_OFFSET] == self[END_OFFSET]) {\r\n\t\t\t\treturn frag;\r\n\t\t\t}\r\n\r\n\t\t\t// Text node needs special case handling\r\n\t\t\tif (self[START_CONTAINER].nodeType == 3) { // TEXT_NODE\r\n\t\t\t\t// get the substring\r\n\t\t\t\ts = self[START_CONTAINER].nodeValue;\r\n\t\t\t\tsub = s.substring(self[START_OFFSET], self[END_OFFSET]);\r\n\r\n\t\t\t\t// set the original text node to its new value\r\n\t\t\t\tif (how != CLONE) {\r\n\t\t\t\t\tn = self[START_CONTAINER];\r\n\t\t\t\t\tstart = self[START_OFFSET];\r\n\t\t\t\t\tlen = self[END_OFFSET] - self[START_OFFSET];\r\n\r\n\t\t\t\t\tif (start === 0 && len >= n.nodeValue.length - 1) {\r\n\t\t\t\t\t\tn.parentNode.removeChild(n);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tn.deleteData(start, len);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Nothing is partially selected, so collapse to start point\r\n\t\t\t\t\tself.collapse(TRUE);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (how == DELETE) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (sub.length > 0) {\r\n\t\t\t\t\tfrag.appendChild(doc.createTextNode(sub));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn frag;\r\n\t\t\t}\r\n\r\n\t\t\t// Copy nodes between the start/end offsets.\r\n\t\t\tn = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]);\r\n\t\t\tcnt = self[END_OFFSET] - self[START_OFFSET];\r\n\r\n\t\t\twhile (n && cnt > 0) {\r\n\t\t\t\tsibling = n.nextSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag) {\r\n\t\t\t\t\tfrag.appendChild(xferNode);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Nothing is partially selected, so collapse to start point\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tself.collapse(TRUE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t}\r\n\r\n\t\tfunction _traverseCommonStartContainer(endAncestor, how) {\r\n\t\t\tvar frag, n, endIdx, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE) {\r\n\t\t\t\tfrag = createDocumentFragment();\r\n\t\t\t}\r\n\r\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\r\n\r\n\t\t\tif (frag) {\r\n\t\t\t\tfrag.appendChild(n);\r\n\t\t\t}\r\n\r\n\t\t\tendIdx = nodeIndex(endAncestor);\r\n\t\t\tcnt = endIdx - self[START_OFFSET];\r\n\r\n\t\t\tif (cnt <= 0) {\r\n\t\t\t\t// Collapse to just before the endAncestor, which\r\n\t\t\t\t// is partially selected.\r\n\t\t\t\tif (how != CLONE) {\r\n\t\t\t\t\tself.setEndBefore(endAncestor);\r\n\t\t\t\t\tself.collapse(FALSE);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn frag;\r\n\t\t\t}\r\n\r\n\t\t\tn = endAncestor.previousSibling;\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tsibling = n.previousSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag) {\r\n\t\t\t\t\tfrag.insertBefore(xferNode, frag.firstChild);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Collapse to just before the endAncestor, which\r\n\t\t\t// is partially selected.\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tself.setEndBefore(endAncestor);\r\n\t\t\t\tself.collapse(FALSE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t}\r\n\r\n\t\tfunction _traverseCommonEndContainer(startAncestor, how) {\r\n\t\t\tvar frag, startIdx, n, cnt, sibling, xferNode;\r\n\r\n\t\t\tif (how != DELETE) {\r\n\t\t\t\tfrag = createDocumentFragment();\r\n\t\t\t}\r\n\r\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\r\n\t\t\tif (frag) {\r\n\t\t\t\tfrag.appendChild(n);\r\n\t\t\t}\r\n\r\n\t\t\tstartIdx = nodeIndex(startAncestor);\r\n\t\t\t++startIdx; // Because we already traversed it\r\n\r\n\t\t\tcnt = self[END_OFFSET] - startIdx;\r\n\t\t\tn = startAncestor.nextSibling;\r\n\t\t\twhile (n && cnt > 0) {\r\n\t\t\t\tsibling = n.nextSibling;\r\n\t\t\t\txferNode = _traverseFullySelected(n, how);\r\n\r\n\t\t\t\tif (frag) {\r\n\t\t\t\t\tfrag.appendChild(xferNode);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t--cnt;\r\n\t\t\t\tn = sibling;\r\n\t\t\t}\r\n\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tself.setStartAfter(startAncestor);\r\n\t\t\t\tself.collapse(TRUE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t}\r\n\r\n\t\tfunction _traverseCommonAncestors(startAncestor, endAncestor, how) {\r\n\t\t\tvar n, frag, startOffset, endOffset, cnt, sibling, nextSibling;\r\n\r\n\t\t\tif (how != DELETE) {\r\n\t\t\t\tfrag = createDocumentFragment();\r\n\t\t\t}\r\n\r\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\r\n\t\t\tif (frag) {\r\n\t\t\t\tfrag.appendChild(n);\r\n\t\t\t}\r\n\r\n\t\t\tstartOffset = nodeIndex(startAncestor);\r\n\t\t\tendOffset = nodeIndex(endAncestor);\r\n\t\t\t++startOffset;\r\n\r\n\t\t\tcnt = endOffset - startOffset;\r\n\t\t\tsibling = startAncestor.nextSibling;\r\n\r\n\t\t\twhile (cnt > 0) {\r\n\t\t\t\tnextSibling = sibling.nextSibling;\r\n\t\t\t\tn = _traverseFullySelected(sibling, how);\r\n\r\n\t\t\t\tif (frag) {\r\n\t\t\t\t\tfrag.appendChild(n);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsibling = nextSibling;\r\n\t\t\t\t--cnt;\r\n\t\t\t}\r\n\r\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\r\n\r\n\t\t\tif (frag) {\r\n\t\t\t\tfrag.appendChild(n);\r\n\t\t\t}\r\n\r\n\t\t\tif (how != CLONE) {\r\n\t\t\t\tself.setStartAfter(startAncestor);\r\n\t\t\t\tself.collapse(TRUE);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t}\r\n\r\n\t\tfunction _traverseRightBoundary(root, how) {\r\n\t\t\tvar next = _getSelectedNode(self[END_CONTAINER], self[END_OFFSET] - 1), parent, clonedParent;\r\n\t\t\tvar prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != self[END_CONTAINER];\r\n\r\n\t\t\tif (next == root) {\r\n\t\t\t\treturn _traverseNode(next, isFullySelected, FALSE, how);\r\n\t\t\t}\r\n\r\n\t\t\tparent = next.parentNode;\r\n\t\t\tclonedParent = _traverseNode(parent, FALSE, FALSE, how);\r\n\r\n\t\t\twhile (parent) {\r\n\t\t\t\twhile (next) {\r\n\t\t\t\t\tprevSibling = next.previousSibling;\r\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, FALSE, how);\r\n\r\n\t\t\t\t\tif (how != DELETE) {\r\n\t\t\t\t\t\tclonedParent.insertBefore(clonedChild, clonedParent.firstChild);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tisFullySelected = TRUE;\r\n\t\t\t\t\tnext = prevSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent == root) {\r\n\t\t\t\t\treturn clonedParent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnext = parent.previousSibling;\r\n\t\t\t\tparent = parent.parentNode;\r\n\r\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);\r\n\r\n\t\t\t\tif (how != DELETE) {\r\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclonedParent = clonedGrandParent;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction _traverseLeftBoundary(root, how) {\r\n\t\t\tvar next = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]), isFullySelected = next != self[START_CONTAINER];\r\n\t\t\tvar parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;\r\n\r\n\t\t\tif (next == root) {\r\n\t\t\t\treturn _traverseNode(next, isFullySelected, TRUE, how);\r\n\t\t\t}\r\n\r\n\t\t\tparent = next.parentNode;\r\n\t\t\tclonedParent = _traverseNode(parent, FALSE, TRUE, how);\r\n\r\n\t\t\twhile (parent) {\r\n\t\t\t\twhile (next) {\r\n\t\t\t\t\tnextSibling = next.nextSibling;\r\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, TRUE, how);\r\n\r\n\t\t\t\t\tif (how != DELETE) {\r\n\t\t\t\t\t\tclonedParent.appendChild(clonedChild);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tisFullySelected = TRUE;\r\n\t\t\t\t\tnext = nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent == root) {\r\n\t\t\t\t\treturn clonedParent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnext = parent.nextSibling;\r\n\t\t\t\tparent = parent.parentNode;\r\n\r\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);\r\n\r\n\t\t\t\tif (how != DELETE) {\r\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclonedParent = clonedGrandParent;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction _traverseNode(n, isFullySelected, isLeft, how) {\r\n\t\t\tvar txtValue, newNodeValue, oldNodeValue, offset, newNode;\r\n\r\n\t\t\tif (isFullySelected) {\r\n\t\t\t\treturn _traverseFullySelected(n, how);\r\n\t\t\t}\r\n\r\n\t\t\t// TEXT_NODE\r\n\t\t\tif (n.nodeType == 3) {\r\n\t\t\t\ttxtValue = n.nodeValue;\r\n\r\n\t\t\t\tif (isLeft) {\r\n\t\t\t\t\toffset = self[START_OFFSET];\r\n\t\t\t\t\tnewNodeValue = txtValue.substring(offset);\r\n\t\t\t\t\toldNodeValue = txtValue.substring(0, offset);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toffset = self[END_OFFSET];\r\n\t\t\t\t\tnewNodeValue = txtValue.substring(0, offset);\r\n\t\t\t\t\toldNodeValue = txtValue.substring(offset);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (how != CLONE) {\r\n\t\t\t\t\tn.nodeValue = oldNodeValue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (how == DELETE) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewNode = dom.clone(n, FALSE);\r\n\t\t\t\tnewNode.nodeValue = newNodeValue;\r\n\r\n\t\t\t\treturn newNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (how == DELETE) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\treturn dom.clone(n, FALSE);\r\n\t\t}\r\n\r\n\t\tfunction _traverseFullySelected(n, how) {\r\n\t\t\tif (how != DELETE) {\r\n\t\t\t\treturn how == CLONE ? dom.clone(n, TRUE) : n;\r\n\t\t\t}\r\n\r\n\t\t\tn.parentNode.removeChild(n);\r\n\t\t}\r\n\r\n\t\tfunction toStringIE() {\r\n\t\t\treturn dom.create('body', null, cloneContents()).outerText;\r\n\t\t}\r\n\r\n\t\textend(self, {\r\n\t\t\t// Initial states\r\n\t\t\tstartContainer: doc,\r\n\t\t\tstartOffset: 0,\r\n\t\t\tendContainer: doc,\r\n\t\t\tendOffset: 0,\r\n\t\t\tcollapsed: TRUE,\r\n\t\t\tcommonAncestorContainer: doc,\r\n\r\n\t\t\t// Range constants\r\n\t\t\tSTART_TO_START: 0,\r\n\t\t\tSTART_TO_END: 1,\r\n\t\t\tEND_TO_END: 2,\r\n\t\t\tEND_TO_START: 3,\r\n\r\n\t\t\t// Public methods\r\n\t\t\tsetStart: setStart,\r\n\t\t\tsetEnd: setEnd,\r\n\t\t\tsetStartBefore: setStartBefore,\r\n\t\t\tsetStartAfter: setStartAfter,\r\n\t\t\tsetEndBefore: setEndBefore,\r\n\t\t\tsetEndAfter: setEndAfter,\r\n\t\t\tcollapse: collapse,\r\n\t\t\tselectNode: selectNode,\r\n\t\t\tselectNodeContents: selectNodeContents,\r\n\t\t\tcompareBoundaryPoints: compareBoundaryPoints,\r\n\t\t\tdeleteContents: deleteContents,\r\n\t\t\textractContents: extractContents,\r\n\t\t\tcloneContents: cloneContents,\r\n\t\t\tinsertNode: insertNode,\r\n\t\t\tsurroundContents: surroundContents,\r\n\t\t\tcloneRange: cloneRange,\r\n\t\t\ttoStringIE: toStringIE\r\n\t\t});\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t// Older IE versions doesn't let you override toString by it's constructor so we have to stick it in the prototype\r\n\tRange.prototype.toString = function() {\r\n\t\treturn this.toStringIE();\r\n\t};\r\n\r\n\treturn Range;\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/Entities.js\r\n\r\n/**\r\n * Entities.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*jshint bitwise:false */\r\n/*eslint no-bitwise:0 */\r\n\r\n/**\r\n * Entity encoder class.\r\n *\r\n * @class tinymce.html.Entities\r\n * @static\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/Entities\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\tvar makeMap = Tools.makeMap;\r\n\r\n\tvar namedEntities, baseEntities, reverseEntities,\r\n\t\tattrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\r\n\t\ttextCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\r\n\t\trawCharsRegExp = /[<>&\\\"\\']/g,\r\n\t\tentityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi,\r\n\t\tasciiMap = {\r\n\t\t\t128: \"\\u20AC\", 130: \"\\u201A\", 131: \"\\u0192\", 132: \"\\u201E\", 133: \"\\u2026\", 134: \"\\u2020\",\r\n\t\t\t135: \"\\u2021\", 136: \"\\u02C6\", 137: \"\\u2030\", 138: \"\\u0160\", 139: \"\\u2039\", 140: \"\\u0152\",\r\n\t\t\t142: \"\\u017D\", 145: \"\\u2018\", 146: \"\\u2019\", 147: \"\\u201C\", 148: \"\\u201D\", 149: \"\\u2022\",\r\n\t\t\t150: \"\\u2013\", 151: \"\\u2014\", 152: \"\\u02DC\", 153: \"\\u2122\", 154: \"\\u0161\", 155: \"\\u203A\",\r\n\t\t\t156: \"\\u0153\", 158: \"\\u017E\", 159: \"\\u0178\"\r\n\t\t};\r\n\r\n\t// Raw entities\r\n\tbaseEntities = {\r\n\t\t'\\\"': '&quot;', // Needs to be escaped since the YUI compressor would otherwise break the code\r\n\t\t\"'\": '&#39;',\r\n\t\t'<': '&lt;',\r\n\t\t'>': '&gt;',\r\n\t\t'&': '&amp;',\r\n\t\t'\\u0060': '&#96;'\r\n\t};\r\n\r\n\t// Reverse lookup table for raw entities\r\n\treverseEntities = {\r\n\t\t'&lt;': '<',\r\n\t\t'&gt;': '>',\r\n\t\t'&amp;': '&',\r\n\t\t'&quot;': '\"',\r\n\t\t'&apos;': \"'\"\r\n\t};\r\n\r\n\t// Decodes text by using the browser\r\n\tfunction nativeDecode(text) {\r\n\t\tvar elm;\r\n\r\n\t\telm = document.createElement(\"div\");\r\n\t\telm.innerHTML = text;\r\n\r\n\t\treturn elm.textContent || elm.innerText || text;\r\n\t}\r\n\r\n\t// Build a two way lookup table for the entities\r\n\tfunction buildEntitiesLookup(items, radix) {\r\n\t\tvar i, chr, entity, lookup = {};\r\n\r\n\t\tif (items) {\r\n\t\t\titems = items.split(',');\r\n\t\t\tradix = radix || 10;\r\n\r\n\t\t\t// Build entities lookup table\r\n\t\t\tfor (i = 0; i < items.length; i += 2) {\r\n\t\t\t\tchr = String.fromCharCode(parseInt(items[i], radix));\r\n\r\n\t\t\t\t// Only add non base entities\r\n\t\t\t\tif (!baseEntities[chr]) {\r\n\t\t\t\t\tentity = '&' + items[i + 1] + ';';\r\n\t\t\t\t\tlookup[chr] = entity;\r\n\t\t\t\t\tlookup[entity] = chr;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn lookup;\r\n\t\t}\r\n\t}\r\n\r\n\t// Unpack entities lookup where the numbers are in radix 32 to reduce the size\r\n\tnamedEntities = buildEntitiesLookup(\r\n\t\t'50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\r\n\t\t'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\r\n\t\t'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\r\n\t\t'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\r\n\t\t'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\r\n\t\t'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\r\n\t\t'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\r\n\t\t'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\r\n\t\t'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\r\n\t\t'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\r\n\t\t'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\r\n\t\t'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\r\n\t\t't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\r\n\t\t'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\r\n\t\t'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\r\n\t\t'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\r\n\t\t'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\r\n\t\t'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\r\n\t\t'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\r\n\t\t'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\r\n\t\t'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\r\n\t\t'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\r\n\t\t'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\r\n\t\t'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\r\n\t\t'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\r\n\r\n\tvar Entities = {\r\n\t\t/**\r\n\t\t * Encodes the specified string using raw entities. This means only the required XML base entities will be encoded.\r\n\t\t *\r\n\t\t * @method encodeRaw\r\n\t\t * @param {String} text Text to encode.\r\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\r\n\t\t * @return {String} Entity encoded text.\r\n\t\t */\r\n\t\tencodeRaw: function(text, attr) {\r\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\treturn baseEntities[chr] || chr;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Encoded the specified text with both the attributes and text entities. This function will produce larger text contents\r\n\t\t * since it doesn't know if the context is within a attribute or text node. This was added for compatibility\r\n\t\t * and is exposed as the DOMUtils.encode function.\r\n\t\t *\r\n\t\t * @method encodeAllRaw\r\n\t\t * @param {String} text Text to encode.\r\n\t\t * @return {String} Entity encoded text.\r\n\t\t */\r\n\t\tencodeAllRaw: function(text) {\r\n\t\t\treturn ('' + text).replace(rawCharsRegExp, function(chr) {\r\n\t\t\t\treturn baseEntities[chr] || chr;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Encodes the specified string using numeric entities. The core entities will be\r\n\t\t * encoded as named ones but all non lower ascii characters will be encoded into numeric entities.\r\n\t\t *\r\n\t\t * @method encodeNumeric\r\n\t\t * @param {String} text Text to encode.\r\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\r\n\t\t * @return {String} Entity encoded text.\r\n\t\t */\r\n\t\tencodeNumeric: function(text, attr) {\r\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\t// Multi byte sequence convert it to a single entity\r\n\t\t\t\tif (chr.length > 1) {\r\n\t\t\t\t\treturn '&#' + (((chr.charCodeAt(0) - 0xD800) * 0x400) + (chr.charCodeAt(1) - 0xDC00) + 0x10000) + ';';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Encodes the specified string using named entities. The core entities will be encoded\r\n\t\t * as named ones but all non lower ascii characters will be encoded into named entities.\r\n\t\t *\r\n\t\t * @method encodeNamed\r\n\t\t * @param {String} text Text to encode.\r\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\r\n\t\t * @param {Object} entities Optional parameter with entities to use.\r\n\t\t * @return {String} Entity encoded text.\r\n\t\t */\r\n\t\tencodeNamed: function(text, attr, entities) {\r\n\t\t\tentities = entities || namedEntities;\r\n\r\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\treturn baseEntities[chr] || entities[chr] || chr;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns an encode function based on the name(s) and it's optional entities.\r\n\t\t *\r\n\t\t * @method getEncodeFunc\r\n\t\t * @param {String} name Comma separated list of encoders for example named,numeric.\r\n\t\t * @param {String} entities Optional parameter with entities to use instead of the built in set.\r\n\t\t * @return {function} Encode function to be used.\r\n\t\t */\r\n\t\tgetEncodeFunc: function(name, entities) {\r\n\t\t\tentities = buildEntitiesLookup(entities) || namedEntities;\r\n\r\n\t\t\tfunction encodeNamedAndNumeric(text, attr) {\r\n\t\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\r\n\t\t\t\t\treturn baseEntities[chr] || entities[chr] || '&#' + chr.charCodeAt(0) + ';' || chr;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction encodeCustomNamed(text, attr) {\r\n\t\t\t\treturn Entities.encodeNamed(text, attr, entities);\r\n\t\t\t}\r\n\r\n\t\t\t// Replace + with , to be compatible with previous TinyMCE versions\r\n\t\t\tname = makeMap(name.replace(/\\+/g, ','));\r\n\r\n\t\t\t// Named and numeric encoder\r\n\t\t\tif (name.named && name.numeric) {\r\n\t\t\t\treturn encodeNamedAndNumeric;\r\n\t\t\t}\r\n\r\n\t\t\t// Named encoder\r\n\t\t\tif (name.named) {\r\n\t\t\t\t// Custom names\r\n\t\t\t\tif (entities) {\r\n\t\t\t\t\treturn encodeCustomNamed;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Entities.encodeNamed;\r\n\t\t\t}\r\n\r\n\t\t\t// Numeric\r\n\t\t\tif (name.numeric) {\r\n\t\t\t\treturn Entities.encodeNumeric;\r\n\t\t\t}\r\n\r\n\t\t\t// Raw encoder\r\n\t\t\treturn Entities.encodeRaw;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Decodes the specified string, this will replace entities with raw UTF characters.\r\n\t\t *\r\n\t\t * @method decode\r\n\t\t * @param {String} text Text to entity decode.\r\n\t\t * @return {String} Entity decoded string.\r\n\t\t */\r\n\t\tdecode: function(text) {\r\n\t\t\treturn text.replace(entityRegExp, function(all, numeric) {\r\n\t\t\t\tif (numeric) {\r\n\t\t\t\t\tif (numeric.charAt(0).toLowerCase() === 'x') {\r\n\t\t\t\t\t\tnumeric = parseInt(numeric.substr(1), 16);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnumeric = parseInt(numeric, 10);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Support upper UTF\r\n\t\t\t\t\tif (numeric > 0xFFFF) {\r\n\t\t\t\t\t\tnumeric -= 0x10000;\r\n\r\n\t\t\t\t\t\treturn String.fromCharCode(0xD800 + (numeric >> 10), 0xDC00 + (numeric & 0x3FF));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn asciiMap[numeric] || String.fromCharCode(numeric);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn reverseEntities[all] || namedEntities[all] || nativeDecode(all);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn Entities;\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/StyleSheetLoader.js\r\n\r\n/**\r\n * StyleSheetLoader.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles loading of external stylesheets and fires events when these are loaded.\r\n *\r\n * @class tinymce.dom.StyleSheetLoader\r\n * @private\r\n */\r\ndefine(\"tinymce/dom/StyleSheetLoader\", [\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/util/Delay\"\r\n], function(Tools, Delay) {\r\n\t\"use strict\";\r\n\r\n\treturn function(document, settings) {\r\n\t\tvar idCount = 0, loadedStates = {}, maxLoadTime;\r\n\r\n\t\tsettings = settings || {};\r\n\t\tmaxLoadTime = settings.maxLoadTime || 5000;\r\n\r\n\t\tfunction appendToHead(node) {\r\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(node);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Loads the specified css style sheet file and call the loadedCallback once it's finished loading.\r\n\t\t *\r\n\t\t * @method load\r\n\t\t * @param {String} url Url to be loaded.\r\n\t\t * @param {Function} loadedCallback Callback to be executed when loaded.\r\n\t\t * @param {Function} errorCallback Callback to be executed when failed loading.\r\n\t\t */\r\n\t\tfunction load(url, loadedCallback, errorCallback) {\r\n\t\t\tvar link, style, startTime, state;\r\n\r\n\t\t\tfunction passed() {\r\n\t\t\t\tvar callbacks = state.passed, i = callbacks.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tcallbacks[i]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate.status = 2;\r\n\t\t\t\tstate.passed = [];\r\n\t\t\t\tstate.failed = [];\r\n\t\t\t}\r\n\r\n\t\t\tfunction failed() {\r\n\t\t\t\tvar callbacks = state.failed, i = callbacks.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tcallbacks[i]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate.status = 3;\r\n\t\t\t\tstate.passed = [];\r\n\t\t\t\tstate.failed = [];\r\n\t\t\t}\r\n\r\n\t\t\t// Sniffs for older WebKit versions that have the link.onload but a broken one\r\n\t\t\tfunction isOldWebKit() {\r\n\t\t\t\tvar webKitChunks = navigator.userAgent.match(/WebKit\\/(\\d*)/);\r\n\t\t\t\treturn !!(webKitChunks && webKitChunks[1] < 536);\r\n\t\t\t}\r\n\r\n\t\t\t// Calls the waitCallback until the test returns true or the timeout occurs\r\n\t\t\tfunction wait(testCallback, waitCallback) {\r\n\t\t\t\tif (!testCallback()) {\r\n\t\t\t\t\t// Wait for timeout\r\n\t\t\t\t\tif ((new Date().getTime()) - startTime < maxLoadTime) {\r\n\t\t\t\t\t\tDelay.setTimeout(waitCallback);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfailed();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Workaround for WebKit that doesn't properly support the onload event for link elements\r\n\t\t\t// Or WebKit that fires the onload event before the StyleSheet is added to the document\r\n\t\t\tfunction waitForWebKitLinkLoaded() {\r\n\t\t\t\twait(function() {\r\n\t\t\t\t\tvar styleSheets = document.styleSheets, styleSheet, i = styleSheets.length, owner;\r\n\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tstyleSheet = styleSheets[i];\r\n\t\t\t\t\t\towner = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\r\n\t\t\t\t\t\tif (owner && owner.id === link.id) {\r\n\t\t\t\t\t\t\tpassed();\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, waitForWebKitLinkLoaded);\r\n\t\t\t}\r\n\r\n\t\t\t// Workaround for older Geckos that doesn't have any onload event for StyleSheets\r\n\t\t\tfunction waitForGeckoLinkLoaded() {\r\n\t\t\t\twait(function() {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Accessing the cssRules will throw an exception until the CSS file is loaded\r\n\t\t\t\t\t\tvar cssRules = style.sheet.cssRules;\r\n\t\t\t\t\t\tpassed();\r\n\t\t\t\t\t\treturn !!cssRules;\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}, waitForGeckoLinkLoaded);\r\n\t\t\t}\r\n\r\n\t\t\turl = Tools._addCacheSuffix(url);\r\n\r\n\t\t\tif (!loadedStates[url]) {\r\n\t\t\t\tstate = {\r\n\t\t\t\t\tpassed: [],\r\n\t\t\t\t\tfailed: []\r\n\t\t\t\t};\r\n\r\n\t\t\t\tloadedStates[url] = state;\r\n\t\t\t} else {\r\n\t\t\t\tstate = loadedStates[url];\r\n\t\t\t}\r\n\r\n\t\t\tif (loadedCallback) {\r\n\t\t\t\tstate.passed.push(loadedCallback);\r\n\t\t\t}\r\n\r\n\t\t\tif (errorCallback) {\r\n\t\t\t\tstate.failed.push(errorCallback);\r\n\t\t\t}\r\n\r\n\t\t\t// Is loading wait for it to pass\r\n\t\t\tif (state.status == 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Has finished loading and was success\r\n\t\t\tif (state.status == 2) {\r\n\t\t\t\tpassed();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Has finished loading and was a failure\r\n\t\t\tif (state.status == 3) {\r\n\t\t\t\tfailed();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Start loading\r\n\t\t\tstate.status = 1;\r\n\t\t\tlink = document.createElement('link');\r\n\t\t\tlink.rel = 'stylesheet';\r\n\t\t\tlink.type = 'text/css';\r\n\t\t\tlink.id = 'u' + (idCount++);\r\n\t\t\tlink.async = false;\r\n\t\t\tlink.defer = false;\r\n\t\t\tstartTime = new Date().getTime();\r\n\r\n\t\t\t// Feature detect onload on link element and sniff older webkits since it has an broken onload event\r\n\t\t\tif (\"onload\" in link && !isOldWebKit()) {\r\n\t\t\t\tlink.onload = waitForWebKitLinkLoaded;\r\n\t\t\t\tlink.onerror = failed;\r\n\t\t\t} else {\r\n\t\t\t\t// Sniff for old Firefox that doesn't support the onload event on link elements\r\n\t\t\t\t// TODO: Remove this in the future when everyone uses modern browsers\r\n\t\t\t\tif (navigator.userAgent.indexOf(\"Firefox\") > 0) {\r\n\t\t\t\t\tstyle = document.createElement('style');\r\n\t\t\t\t\tstyle.textContent = '@import \"' + url + '\"';\r\n\t\t\t\t\twaitForGeckoLinkLoaded();\r\n\t\t\t\t\tappendToHead(style);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Use the id owner on older webkits\r\n\t\t\t\twaitForWebKitLinkLoaded();\r\n\t\t\t}\r\n\r\n\t\t\tappendToHead(link);\r\n\t\t\tlink.href = url;\r\n\t\t}\r\n\r\n\t\tthis.load = load;\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/DOMUtils.js\r\n\r\n/**\r\n * DOMUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Utility class for various DOM manipulation and retrieval functions.\r\n *\r\n * @class tinymce.dom.DOMUtils\r\n * @example\r\n * // Add a class to an element by id in the page\r\n * tinymce.DOM.addClass('someid', 'someclass');\r\n *\r\n * // Add a class to an element by id inside the editor\r\n * tinymce.activeEditor.dom.addClass('someid', 'someclass');\r\n */\r\ndefine(\"tinymce/dom/DOMUtils\", [\r\n\t\"tinymce/dom/Sizzle\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/html/Styles\",\r\n\t\"tinymce/dom/EventUtils\",\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/dom/Range\",\r\n\t\"tinymce/html/Entities\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/dom/StyleSheetLoader\"\r\n], function(Sizzle, $, Styles, EventUtils, TreeWalker, Range, Entities, Env, Tools, StyleSheetLoader) {\r\n\t// Shorten names\r\n\tvar each = Tools.each, is = Tools.is, grep = Tools.grep, trim = Tools.trim;\r\n\tvar isIE = Env.ie;\r\n\tvar simpleSelectorRe = /^([a-z0-9],?)+$/i;\r\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/;\r\n\r\n\tfunction setupAttrHooks(domUtils, settings) {\r\n\t\tvar attrHooks = {}, keepValues = settings.keep_values, keepUrlHook;\r\n\r\n\t\tkeepUrlHook = {\r\n\t\t\tset: function($elm, value, name) {\r\n\t\t\t\tif (settings.url_converter) {\r\n\t\t\t\t\tvalue = settings.url_converter.call(settings.url_converter_scope || domUtils, value, name, $elm[0]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$elm.attr('data-mce-' + name, value).attr(name, value);\r\n\t\t\t},\r\n\r\n\t\t\tget: function($elm, name) {\r\n\t\t\t\treturn $elm.attr('data-mce-' + name) || $elm.attr(name);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tattrHooks = {\r\n\t\t\tstyle: {\r\n\t\t\t\tset: function($elm, value) {\r\n\t\t\t\t\tif (value !== null && typeof value === 'object') {\r\n\t\t\t\t\t\t$elm.css(value);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (keepValues) {\r\n\t\t\t\t\t\t$elm.attr('data-mce-style', value);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$elm.attr('style', value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tget: function($elm) {\r\n\t\t\t\t\tvar value = $elm.attr('data-mce-style') || $elm.attr('style');\r\n\r\n\t\t\t\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\r\n\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (keepValues) {\r\n\t\t\tattrHooks.href = attrHooks.src = keepUrlHook;\r\n\t\t}\r\n\r\n\t\treturn attrHooks;\r\n\t}\r\n\r\n\tfunction updateInternalStyleAttr(domUtils, $elm) {\r\n\t\tvar value = $elm.attr('style');\r\n\r\n\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\r\n\r\n\t\tif (!value) {\r\n\t\t\tvalue = null;\r\n\t\t}\r\n\r\n\t\t$elm.attr('data-mce-style', value);\r\n\t}\r\n\r\n\tfunction nodeIndex(node, normalized) {\r\n\t\tvar idx = 0, lastNodeType, nodeType;\r\n\r\n\t\tif (node) {\r\n\t\t\tfor (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\r\n\t\t\t\tnodeType = node.nodeType;\r\n\r\n\t\t\t\t// Normalize text nodes\r\n\t\t\t\tif (normalized && nodeType == 3) {\r\n\t\t\t\t\tif (nodeType == lastNodeType || !node.nodeValue.length) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tidx++;\r\n\t\t\t\tlastNodeType = nodeType;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn idx;\r\n\t}\r\n\r\n\t/**\r\n\t * Constructs a new DOMUtils instance. Consult the Wiki for more details on settings etc for this class.\r\n\t *\r\n\t * @constructor\r\n\t * @method DOMUtils\r\n\t * @param {Document} doc Document reference to bind the utility class to.\r\n\t * @param {settings} settings Optional settings collection.\r\n\t */\r\n\tfunction DOMUtils(doc, settings) {\r\n\t\tvar self = this, blockElementsMap;\r\n\r\n\t\tself.doc = doc;\r\n\t\tself.win = window;\r\n\t\tself.files = {};\r\n\t\tself.counter = 0;\r\n\t\tself.stdMode = !isIE || doc.documentMode >= 8;\r\n\t\tself.boxModel = !isIE || doc.compatMode == \"CSS1Compat\" || self.stdMode;\r\n\t\tself.styleSheetLoader = new StyleSheetLoader(doc);\r\n\t\tself.boundEvents = [];\r\n\t\tself.settings = settings = settings || {};\r\n\t\tself.schema = settings.schema;\r\n\t\tself.styles = new Styles({\r\n\t\t\turl_converter: settings.url_converter,\r\n\t\t\turl_converter_scope: settings.url_converter_scope\r\n\t\t}, settings.schema);\r\n\r\n\t\tself.fixDoc(doc);\r\n\t\tself.events = settings.ownEvents ? new EventUtils(settings.proxy) : EventUtils.Event;\r\n\t\tself.attrHooks = setupAttrHooks(self, settings);\r\n\t\tblockElementsMap = settings.schema ? settings.schema.getBlockElements() : {};\r\n\t\tself.$ = $.overrideDefaults(function() {\r\n\t\t\treturn {\r\n\t\t\t\tcontext: doc,\r\n\t\t\t\telement: self.getRoot()\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified element is a block element or not.\r\n\t\t *\r\n\t\t * @method isBlock\r\n\t\t * @param {Node/String} node Element/Node to check.\r\n\t\t * @return {Boolean} True/False state if the node is a block element or not.\r\n\t\t */\r\n\t\tself.isBlock = function(node) {\r\n\t\t\t// Fix for #5446\r\n\t\t\tif (!node) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// This function is called in module pattern style since it might be executed with the wrong this scope\r\n\t\t\tvar type = node.nodeType;\r\n\r\n\t\t\t// If it's a node then check the type and use the nodeName\r\n\t\t\tif (type) {\r\n\t\t\t\treturn !!(type === 1 && blockElementsMap[node.nodeName]);\r\n\t\t\t}\r\n\r\n\t\t\treturn !!blockElementsMap[node];\r\n\t\t};\r\n\t}\r\n\r\n\tDOMUtils.prototype = {\r\n\t\t$$: function(elm) {\r\n\t\t\tif (typeof elm == 'string') {\r\n\t\t\t\telm = this.get(elm);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.$(elm);\r\n\t\t},\r\n\r\n\t\troot: null,\r\n\r\n\t\tfixDoc: function(doc) {\r\n\t\t\tvar settings = this.settings, name;\r\n\r\n\t\t\tif (isIE && settings.schema) {\r\n\t\t\t\t// Add missing HTML 4/5 elements to IE\r\n\t\t\t\t('abbr article aside audio canvas ' +\r\n\t\t\t\t'details figcaption figure footer ' +\r\n\t\t\t\t'header hgroup mark menu meter nav ' +\r\n\t\t\t\t'output progress section summary ' +\r\n\t\t\t\t'time video').replace(/\\w+/g, function(name) {\r\n\t\t\t\t\tdoc.createElement(name);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Create all custom elements\r\n\t\t\t\tfor (name in settings.schema.getCustomElements()) {\r\n\t\t\t\t\tdoc.createElement(name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tclone: function(node, deep) {\r\n\t\t\tvar self = this, clone, doc;\r\n\r\n\t\t\t// TODO: Add feature detection here in the future\r\n\t\t\tif (!isIE || node.nodeType !== 1 || deep) {\r\n\t\t\t\treturn node.cloneNode(deep);\r\n\t\t\t}\r\n\r\n\t\t\tdoc = self.doc;\r\n\r\n\t\t\t// Make a HTML5 safe shallow copy\r\n\t\t\tif (!deep) {\r\n\t\t\t\tclone = doc.createElement(node.nodeName);\r\n\r\n\t\t\t\t// Copy attribs\r\n\t\t\t\teach(self.getAttribs(node), function(attr) {\r\n\t\t\t\t\tself.setAttrib(clone, attr.nodeName, self.getAttrib(node, attr.nodeName));\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn clone;\r\n\t\t\t}\r\n\r\n\t\t\treturn clone.firstChild;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the root node of the document. This is normally the body but might be a DIV. Parents like getParent will not\r\n\t\t * go above the point of this root node.\r\n\t\t *\r\n\t\t * @method getRoot\r\n\t\t * @return {Element} Root element for the utility class.\r\n\t\t */\r\n\t\tgetRoot: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\treturn self.settings.root_element || self.doc.body;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the viewport of the window.\r\n\t\t *\r\n\t\t * @method getViewPort\r\n\t\t * @param {Window} win Optional window to get viewport of.\r\n\t\t * @return {Object} Viewport object with fields x, y, w and h.\r\n\t\t */\r\n\t\tgetViewPort: function(win) {\r\n\t\t\tvar doc, rootElm;\r\n\r\n\t\t\twin = !win ? this.win : win;\r\n\t\t\tdoc = win.document;\r\n\t\t\trootElm = this.boxModel ? doc.documentElement : doc.body;\r\n\r\n\t\t\t// Returns viewport size excluding scrollbars\r\n\t\t\treturn {\r\n\t\t\t\tx: win.pageXOffset || rootElm.scrollLeft,\r\n\t\t\t\ty: win.pageYOffset || rootElm.scrollTop,\r\n\t\t\t\tw: win.innerWidth || rootElm.clientWidth,\r\n\t\t\t\th: win.innerHeight || rootElm.clientHeight\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the rectangle for a specific element.\r\n\t\t *\r\n\t\t * @method getRect\r\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\r\n\t\t * @return {object} Rectangle for specified element object with x, y, w, h fields.\r\n\t\t */\r\n\t\tgetRect: function(elm) {\r\n\t\t\tvar self = this, pos, size;\r\n\r\n\t\t\telm = self.get(elm);\r\n\t\t\tpos = self.getPos(elm);\r\n\t\t\tsize = self.getSize(elm);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tx: pos.x, y: pos.y,\r\n\t\t\t\tw: size.w, h: size.h\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the size dimensions of the specified element.\r\n\t\t *\r\n\t\t * @method getSize\r\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\r\n\t\t * @return {object} Rectangle for specified element object with w, h fields.\r\n\t\t */\r\n\t\tgetSize: function(elm) {\r\n\t\t\tvar self = this, w, h;\r\n\r\n\t\t\telm = self.get(elm);\r\n\t\t\tw = self.getStyle(elm, 'width');\r\n\t\t\th = self.getStyle(elm, 'height');\r\n\r\n\t\t\t// Non pixel value, then force offset/clientWidth\r\n\t\t\tif (w.indexOf('px') === -1) {\r\n\t\t\t\tw = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// Non pixel value, then force offset/clientWidth\r\n\t\t\tif (h.indexOf('px') === -1) {\r\n\t\t\t\th = 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tw: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\r\n\t\t\t\th: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a node by the specified selector function. This function will\r\n\t\t * loop through all parent nodes and call the specified function for each node.\r\n\t\t * If the function then returns true indicating that it has found what it was looking for, the loop execution will then end\r\n\t\t * and the node it found will be returned.\r\n\t\t *\r\n\t\t * @method getParent\r\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\r\n\t\t * @param {function} selector Selection function or CSS selector to execute on each node.\r\n\t\t * @param {Node} root Optional root element, never go below this point.\r\n\t\t * @return {Node} DOM Node or null if it wasn't found.\r\n\t\t */\r\n\t\tgetParent: function(node, selector, root) {\r\n\t\t\treturn this.getParents(node, selector, root, false);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a node list of all parents matching the specified selector function or pattern.\r\n\t\t * If the function then returns true indicating that it has found what it was looking for and that node will be collected.\r\n\t\t *\r\n\t\t * @method getParents\r\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\r\n\t\t * @param {function} selector Selection function to execute on each node or CSS pattern.\r\n\t\t * @param {Node} root Optional root element, never go below this point.\r\n\t\t * @return {Array} Array of nodes or null if it wasn't found.\r\n\t\t */\r\n\t\tgetParents: function(node, selector, root, collect) {\r\n\t\t\tvar self = this, selectorVal, result = [];\r\n\r\n\t\t\tnode = self.get(node);\r\n\t\t\tcollect = collect === undefined;\r\n\r\n\t\t\t// Default root on inline mode\r\n\t\t\troot = root || (self.getRoot().nodeName != 'BODY' ? self.getRoot().parentNode : null);\r\n\r\n\t\t\t// Wrap node name as func\r\n\t\t\tif (is(selector, 'string')) {\r\n\t\t\t\tselectorVal = selector;\r\n\r\n\t\t\t\tif (selector === '*') {\r\n\t\t\t\t\tselector = function(node) {\r\n\t\t\t\t\t\treturn node.nodeType == 1;\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tselector = function(node) {\r\n\t\t\t\t\t\treturn self.is(node, selectorVal);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\twhile (node) {\r\n\t\t\t\tif (node == root || !node.nodeType || node.nodeType === 9) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!selector || selector(node)) {\r\n\t\t\t\t\tif (collect) {\r\n\t\t\t\t\t\tresult.push(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn collect ? result : null;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the specified element by ID or the input element if it isn't a string.\r\n\t\t *\r\n\t\t * @method get\r\n\t\t * @param {String/Element} n Element id to look for or element to just pass though.\r\n\t\t * @return {Element} Element matching the specified id or null if it wasn't found.\r\n\t\t */\r\n\t\tget: function(elm) {\r\n\t\t\tvar name;\r\n\r\n\t\t\tif (elm && this.doc && typeof elm == 'string') {\r\n\t\t\t\tname = elm;\r\n\t\t\t\telm = this.doc.getElementById(elm);\r\n\r\n\t\t\t\t// IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick\r\n\t\t\t\tif (elm && elm.id !== name) {\r\n\t\t\t\t\treturn this.doc.getElementsByName(name)[1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn elm;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the next node that matches selector or function\r\n\t\t *\r\n\t\t * @method getNext\r\n\t\t * @param {Node} node Node to find siblings from.\r\n\t\t * @param {String/function} selector Selector CSS expression or function.\r\n\t\t * @return {Node} Next node item matching the selector or null if it wasn't found.\r\n\t\t */\r\n\t\tgetNext: function(node, selector) {\r\n\t\t\treturn this._findSib(node, selector, 'nextSibling');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the previous node that matches selector or function\r\n\t\t *\r\n\t\t * @method getPrev\r\n\t\t * @param {Node} node Node to find siblings from.\r\n\t\t * @param {String/function} selector Selector CSS expression or function.\r\n\t\t * @return {Node} Previous node item matching the selector or null if it wasn't found.\r\n\t\t */\r\n\t\tgetPrev: function(node, selector) {\r\n\t\t\treturn this._findSib(node, selector, 'previousSibling');\r\n\t\t},\r\n\r\n\t\t// #ifndef jquery\r\n\r\n\t\t/**\r\n\t\t * Selects specific elements by a CSS level 3 pattern. For example \"div#a1 p.test\".\r\n\t\t * This function is optimized for the most common patterns needed in TinyMCE but it also performs well enough\r\n\t\t * on more complex patterns.\r\n\t\t *\r\n\t\t * @method select\r\n\t\t * @param {String} selector CSS level 3 pattern to select/find elements by.\r\n\t\t * @param {Object} scope Optional root element/scope element to search in.\r\n\t\t * @return {Array} Array with all matched elements.\r\n\t\t * @example\r\n\t\t * // Adds a class to all paragraphs in the currently active editor\r\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\r\n\t\t *\r\n\t\t * // Adds a class to all spans that have the test class in the currently active editor\r\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('span.test'), 'someclass')\r\n\t\t */\r\n\t\tselect: function(selector, scope) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t/*eslint new-cap:0 */\r\n\t\t\treturn Sizzle(selector, self.get(scope) || self.settings.root_element || self.doc, []);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified element matches the specified css pattern.\r\n\t\t *\r\n\t\t * @method is\r\n\t\t * @param {Node/NodeList} elm DOM node to match or an array of nodes to match.\r\n\t\t * @param {String} selector CSS pattern to match the element against.\r\n\t\t */\r\n\t\tis: function(elm, selector) {\r\n\t\t\tvar i;\r\n\r\n\t\t\t// If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance\r\n\t\t\tif (elm.length === undefined) {\r\n\t\t\t\t// Simple all selector\r\n\t\t\t\tif (selector === '*') {\r\n\t\t\t\t\treturn elm.nodeType == 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Simple selector just elements\r\n\t\t\t\tif (simpleSelectorRe.test(selector)) {\r\n\t\t\t\t\tselector = selector.toLowerCase().split(/,/);\r\n\t\t\t\t\telm = elm.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\tfor (i = selector.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tif (selector[i] == elm) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Is non element\r\n\t\t\tif (elm.nodeType && elm.nodeType != 1) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar elms = elm.nodeType ? [elm] : elm;\r\n\r\n\t\t\t/*eslint new-cap:0 */\r\n\t\t\treturn Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\r\n\t\t},\r\n\r\n\t\t// #endif\r\n\r\n\t\t/**\r\n\t\t * Adds the specified element to another element or elements.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {String/Element/Array} parentElm Element id string, DOM node element or array of ids or elements to add to.\r\n\t\t * @param {String/Element} name Name of new element to add or existing element to add.\r\n\t\t * @param {Object} attrs Optional object collection with arguments to add to the new element(s).\r\n\t\t * @param {String} html Optional inner HTML contents to add for each element.\r\n\t\t * @param {Boolean} create Optional flag if the element should be created or added.\r\n\t\t * @return {Element/Array} Element that got created, or an array of created elements if multiple input elements\r\n\t\t * were passed in.\r\n\t\t * @example\r\n\t\t * // Adds a new paragraph to the end of the active editor\r\n\t\t * tinymce.activeEditor.dom.add(tinymce.activeEditor.getBody(), 'p', {title: 'my title'}, 'Some content');\r\n\t\t */\r\n\t\tadd: function(parentElm, name, attrs, html, create) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\treturn this.run(parentElm, function(parentElm) {\r\n\t\t\t\tvar newElm;\r\n\r\n\t\t\t\tnewElm = is(name, 'string') ? self.doc.createElement(name) : name;\r\n\t\t\t\tself.setAttribs(newElm, attrs);\r\n\r\n\t\t\t\tif (html) {\r\n\t\t\t\t\tif (html.nodeType) {\r\n\t\t\t\t\t\tnewElm.appendChild(html);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.setHTML(newElm, html);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn !create ? parentElm.appendChild(newElm) : newElm;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates a new element.\r\n\t\t *\r\n\t\t * @method create\r\n\t\t * @param {String} name Name of new element.\r\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\r\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\r\n\t\t * @return {Element} HTML DOM node element that got created.\r\n\t\t * @example\r\n\t\t * // Adds an element where the caret/selection is in the active editor\r\n\t\t * var el = tinymce.activeEditor.dom.create('div', {id: 'test', 'class': 'myclass'}, 'some content');\r\n\t\t * tinymce.activeEditor.selection.setNode(el);\r\n\t\t */\r\n\t\tcreate: function(name, attrs, html) {\r\n\t\t\treturn this.add(this.doc.createElement(name), name, attrs, html, 1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates HTML string for element. The element will be closed unless an empty inner HTML string is passed in.\r\n\t\t *\r\n\t\t * @method createHTML\r\n\t\t * @param {String} name Name of new element.\r\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\r\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\r\n\t\t * @return {String} String with new HTML element, for example: <a href=\"#\">test</a>.\r\n\t\t * @example\r\n\t\t * // Creates a html chunk and inserts it at the current selection/caret location\r\n\t\t * tinymce.activeEditor.selection.setContent(tinymce.activeEditor.dom.createHTML('a', {href: 'test.html'}, 'some line'));\r\n\t\t */\r\n\t\tcreateHTML: function(name, attrs, html) {\r\n\t\t\tvar outHtml = '', key;\r\n\r\n\t\t\toutHtml += '<' + name;\r\n\r\n\t\t\tfor (key in attrs) {\r\n\t\t\t\tif (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] != 'undefined') {\r\n\t\t\t\t\toutHtml += ' ' + key + '=\"' + this.encode(attrs[key]) + '\"';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// A call to tinymce.is doesn't work for some odd reason on IE9 possible bug inside their JS runtime\r\n\t\t\tif (typeof html != \"undefined\") {\r\n\t\t\t\treturn outHtml + '>' + html + '</' + name + '>';\r\n\t\t\t}\r\n\r\n\t\t\treturn outHtml + ' />';\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates a document fragment out of the specified HTML string.\r\n\t\t *\r\n\t\t * @method createFragment\r\n\t\t * @param {String} html Html string to create fragment from.\r\n\t\t * @return {DocumentFragment} Document fragment node.\r\n\t\t */\r\n\t\tcreateFragment: function(html) {\r\n\t\t\tvar frag, node, doc = this.doc, container;\r\n\r\n\t\t\tcontainer = doc.createElement(\"div\");\r\n\t\t\tfrag = doc.createDocumentFragment();\r\n\r\n\t\t\tif (html) {\r\n\t\t\t\tcontainer.innerHTML = html;\r\n\t\t\t}\r\n\r\n\t\t\twhile ((node = container.firstChild)) {\r\n\t\t\t\tfrag.appendChild(node);\r\n\t\t\t}\r\n\r\n\t\t\treturn frag;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes/deletes the specified element(s) from the DOM.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @param {String/Element/Array} node ID of element or DOM element object or array containing multiple elements/ids.\r\n\t\t * @param {Boolean} keepChildren Optional state to keep children or not. If set to true all children will be\r\n\t\t * placed at the location of the removed element.\r\n\t\t * @return {Element/Array} HTML DOM element that got removed, or an array of removed elements if multiple input elements\r\n\t\t * were passed in.\r\n\t\t * @example\r\n\t\t * // Removes all paragraphs in the active editor\r\n\t\t * tinymce.activeEditor.dom.remove(tinymce.activeEditor.dom.select('p'));\r\n\t\t *\r\n\t\t * // Removes an element by id in the document\r\n\t\t * tinymce.DOM.remove('mydiv');\r\n\t\t */\r\n\t\tremove: function(node, keepChildren) {\r\n\t\t\tnode = this.$$(node);\r\n\r\n\t\t\tif (keepChildren) {\r\n\t\t\t\tnode.each(function() {\r\n\t\t\t\t\tvar child;\r\n\r\n\t\t\t\t\twhile ((child = this.firstChild)) {\r\n\t\t\t\t\t\tif (child.nodeType == 3 && child.data.length === 0) {\r\n\t\t\t\t\t\t\tthis.removeChild(child);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.parentNode.insertBefore(child, this);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).remove();\r\n\t\t\t} else {\r\n\t\t\t\tnode.remove();\r\n\t\t\t}\r\n\r\n\t\t\treturn node.length > 1 ? node.toArray() : node[0];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the CSS style value on a HTML element. The name can be a camelcase string\r\n\t\t * or the CSS style name like background-color.\r\n\t\t *\r\n\t\t * @method setStyle\r\n\t\t * @param {String/Element/Array} elm HTML element/Array of elements to set CSS style value on.\r\n\t\t * @param {String} name Name of the style value to set.\r\n\t\t * @param {String} value Value to set on the style.\r\n\t\t * @example\r\n\t\t * // Sets a style value on all paragraphs in the currently active editor\r\n\t\t * tinymce.activeEditor.dom.setStyle(tinymce.activeEditor.dom.select('p'), 'background-color', 'red');\r\n\t\t *\r\n\t\t * // Sets a style value to an element by id in the current document\r\n\t\t * tinymce.DOM.setStyle('mydiv', 'background-color', 'red');\r\n\t\t */\r\n\t\tsetStyle: function(elm, name, value) {\r\n\t\t\telm = this.$$(elm).css(name, value);\r\n\r\n\t\t\tif (this.settings.update_styles) {\r\n\t\t\t\tupdateInternalStyleAttr(this, elm);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the current style or runtime/computed value of an element.\r\n\t\t *\r\n\t\t * @method getStyle\r\n\t\t * @param {String/Element} elm HTML element or element id string to get style from.\r\n\t\t * @param {String} name Style name to return.\r\n\t\t * @param {Boolean} computed Computed style.\r\n\t\t * @return {String} Current style or computed style value of an element.\r\n\t\t */\r\n\t\tgetStyle: function(elm, name, computed) {\r\n\t\t\telm = this.$$(elm);\r\n\r\n\t\t\tif (computed) {\r\n\t\t\t\treturn elm.css(name);\r\n\t\t\t}\r\n\r\n\t\t\t// Camelcase it, if needed\r\n\t\t\tname = name.replace(/-(\\D)/g, function(a, b) {\r\n\t\t\t\treturn b.toUpperCase();\r\n\t\t\t});\r\n\r\n\t\t\tif (name == 'float') {\r\n\t\t\t\tname = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';\r\n\t\t\t}\r\n\r\n\t\t\treturn elm[0] && elm[0].style ? elm[0].style[name] : undefined;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets multiple styles on the specified element(s).\r\n\t\t *\r\n\t\t * @method setStyles\r\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set styles on.\r\n\t\t * @param {Object} styles Name/Value collection of style items to add to the element(s).\r\n\t\t * @example\r\n\t\t * // Sets styles on all paragraphs in the currently active editor\r\n\t\t * tinymce.activeEditor.dom.setStyles(tinymce.activeEditor.dom.select('p'), {'background-color': 'red', 'color': 'green'});\r\n\t\t *\r\n\t\t * // Sets styles to an element by id in the current document\r\n\t\t * tinymce.DOM.setStyles('mydiv', {'background-color': 'red', 'color': 'green'});\r\n\t\t */\r\n\t\tsetStyles: function(elm, styles) {\r\n\t\t\telm = this.$$(elm).css(styles);\r\n\r\n\t\t\tif (this.settings.update_styles) {\r\n\t\t\t\tupdateInternalStyleAttr(this, elm);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes all attributes from an element or elements.\r\n\t\t *\r\n\t\t * @method removeAllAttribs\r\n\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to remove attributes from.\r\n\t\t */\r\n\t\tremoveAllAttribs: function(e) {\r\n\t\t\treturn this.run(e, function(e) {\r\n\t\t\t\tvar i, attrs = e.attributes;\r\n\t\t\t\tfor (i = attrs.length - 1; i >= 0; i--) {\r\n\t\t\t\t\te.removeAttributeNode(attrs.item(i));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the specified attribute of an element or elements.\r\n\t\t *\r\n\t\t * @method setAttrib\r\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attribute on.\r\n\t\t * @param {String} name Name of attribute to set.\r\n\t\t * @param {String} value Value to set on the attribute - if this value is falsy like null, 0 or '' it will remove\r\n\t\t * the attribute instead.\r\n\t\t * @example\r\n\t\t * // Sets class attribute on all paragraphs in the active editor\r\n\t\t * tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select('p'), 'class', 'myclass');\r\n\t\t *\r\n\t\t * // Sets class attribute on a specific element in the current page\r\n\t\t * tinymce.dom.setAttrib('mydiv', 'class', 'myclass');\r\n\t\t */\r\n\t\tsetAttrib: function(elm, name, value) {\r\n\t\t\tvar self = this, originalValue, hook, settings = self.settings;\r\n\r\n\t\t\tif (value === '') {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\r\n\t\t\telm = self.$$(elm);\r\n\t\t\toriginalValue = elm.attr(name);\r\n\r\n\t\t\tif (!elm.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\thook = self.attrHooks[name];\r\n\t\t\tif (hook && hook.set) {\r\n\t\t\t\thook.set(elm, value, name);\r\n\t\t\t} else {\r\n\t\t\t\telm.attr(name, value);\r\n\t\t\t}\r\n\r\n\t\t\tif (originalValue != value && settings.onSetAttrib) {\r\n\t\t\t\tsettings.onSetAttrib({\r\n\t\t\t\t\tattrElm: elm,\r\n\t\t\t\t\tattrName: name,\r\n\t\t\t\t\tattrValue: value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets two or more specified attributes of an element or elements.\r\n\t\t *\r\n\t\t * @method setAttribs\r\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attributes on.\r\n\t\t * @param {Object} attrs Name/Value collection of attribute items to add to the element(s).\r\n\t\t * @example\r\n\t\t * // Sets class and title attributes on all paragraphs in the active editor\r\n\t\t * tinymce.activeEditor.dom.setAttribs(tinymce.activeEditor.dom.select('p'), {'class': 'myclass', title: 'some title'});\r\n\t\t *\r\n\t\t * // Sets class and title attributes on a specific element in the current page\r\n\t\t * tinymce.DOM.setAttribs('mydiv', {'class': 'myclass', title: 'some title'});\r\n\t\t */\r\n\t\tsetAttribs: function(elm, attrs) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.$$(elm).each(function(i, node) {\r\n\t\t\t\teach(attrs, function(value, name) {\r\n\t\t\t\t\tself.setAttrib(node, name, value);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the specified attribute by name.\r\n\t\t *\r\n\t\t * @method getAttrib\r\n\t\t * @param {String/Element} elm Element string id or DOM element to get attribute from.\r\n\t\t * @param {String} name Name of attribute to get.\r\n\t\t * @param {String} defaultVal Optional default value to return if the attribute didn't exist.\r\n\t\t * @return {String} Attribute value string, default value or null if the attribute wasn't found.\r\n\t\t */\r\n\t\tgetAttrib: function(elm, name, defaultVal) {\r\n\t\t\tvar self = this, hook, value;\r\n\r\n\t\t\telm = self.$$(elm);\r\n\r\n\t\t\tif (elm.length) {\r\n\t\t\t\thook = self.attrHooks[name];\r\n\r\n\t\t\t\tif (hook && hook.get) {\r\n\t\t\t\t\tvalue = hook.get(elm, name);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = elm.attr(name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof value == 'undefined') {\r\n\t\t\t\tvalue = defaultVal || '';\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the absolute x, y position of a node. The position will be returned in an object with x, y fields.\r\n\t\t *\r\n\t\t * @method getPos\r\n\t\t * @param {Element/String} elm HTML element or element id to get x, y position from.\r\n\t\t * @param {Element} rootElm Optional root element to stop calculations at.\r\n\t\t * @return {object} Absolute position of the specified element object with x, y fields.\r\n\t\t */\r\n\t\tgetPos: function(elm, rootElm) {\r\n\t\t\tvar self = this, x = 0, y = 0, offsetParent, doc = self.doc, body = doc.body, pos;\r\n\r\n\t\t\telm = self.get(elm);\r\n\t\t\trootElm = rootElm || body;\r\n\r\n\t\t\tif (elm) {\r\n\t\t\t\t// Use getBoundingClientRect if it exists since it's faster than looping offset nodes\r\n\t\t\t\t// Fallback to offsetParent calculations if the body isn't static better since it stops at the body root\r\n\t\t\t\tif (rootElm === body && elm.getBoundingClientRect && $(body).css('position') === 'static') {\r\n\t\t\t\t\tpos = elm.getBoundingClientRect();\r\n\t\t\t\t\trootElm = self.boxModel ? doc.documentElement : body;\r\n\r\n\t\t\t\t\t// Add scroll offsets from documentElement or body since IE with the wrong box model will use d.body and so do WebKit\r\n\t\t\t\t\t// Also remove the body/documentelement clientTop/clientLeft on IE 6, 7 since they offset the position\r\n\t\t\t\t\tx = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - rootElm.clientLeft;\r\n\t\t\t\t\ty = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - rootElm.clientTop;\r\n\r\n\t\t\t\t\treturn {x: x, y: y};\r\n\t\t\t\t}\r\n\r\n\t\t\t\toffsetParent = elm;\r\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\r\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\r\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\r\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toffsetParent = elm.parentNode;\r\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\r\n\t\t\t\t\tx -= offsetParent.scrollLeft || 0;\r\n\t\t\t\t\ty -= offsetParent.scrollTop || 0;\r\n\t\t\t\t\toffsetParent = offsetParent.parentNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {x: x, y: y};\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Parses the specified style value into an object collection. This parser will also\r\n\t\t * merge and remove any redundant items that browsers might have added. It will also convert non-hex\r\n\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\r\n\t\t *\r\n\t\t * @method parseStyle\r\n\t\t * @param {String} cssText Style value to parse, for example: border:1px solid red;.\r\n\t\t * @return {Object} Object representation of that style, for example: {border: '1px solid red'}\r\n\t\t */\r\n\t\tparseStyle: function(cssText) {\r\n\t\t\treturn this.styles.parse(cssText);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Serializes the specified style object into a string.\r\n\t\t *\r\n\t\t * @method serializeStyle\r\n\t\t * @param {Object} styles Object to serialize as string, for example: {border: '1px solid red'}\r\n\t\t * @param {String} name Optional element name.\r\n\t\t * @return {String} String representation of the style object, for example: border: 1px solid red.\r\n\t\t */\r\n\t\tserializeStyle: function(styles, name) {\r\n\t\t\treturn this.styles.serialize(styles, name);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a style element at the top of the document with the specified cssText content.\r\n\t\t *\r\n\t\t * @method addStyle\r\n\t\t * @param {String} cssText CSS Text style to add to top of head of document.\r\n\t\t */\r\n\t\taddStyle: function(cssText) {\r\n\t\t\tvar self = this, doc = self.doc, head, styleElm;\r\n\r\n\t\t\t// Prevent inline from loading the same styles twice\r\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\r\n\t\t\t\tvar addedStyles = DOMUtils.DOM.addedStyles;\r\n\r\n\t\t\t\taddedStyles = addedStyles || [];\r\n\t\t\t\tif (addedStyles[cssText]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\taddedStyles[cssText] = true;\r\n\t\t\t\tDOMUtils.DOM.addedStyles = addedStyles;\r\n\t\t\t}\r\n\r\n\t\t\t// Create style element if needed\r\n\t\t\tstyleElm = doc.getElementById('mceDefaultStyles');\r\n\t\t\tif (!styleElm) {\r\n\t\t\t\tstyleElm = doc.createElement('style');\r\n\t\t\t\tstyleElm.id = 'mceDefaultStyles';\r\n\t\t\t\tstyleElm.type = 'text/css';\r\n\r\n\t\t\t\thead = doc.getElementsByTagName('head')[0];\r\n\t\t\t\tif (head.firstChild) {\r\n\t\t\t\t\thead.insertBefore(styleElm, head.firstChild);\r\n\t\t\t\t} else {\r\n\t\t\t\t\thead.appendChild(styleElm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Append style data to old or new style element\r\n\t\t\tif (styleElm.styleSheet) {\r\n\t\t\t\tstyleElm.styleSheet.cssText += cssText;\r\n\t\t\t} else {\r\n\t\t\t\tstyleElm.appendChild(doc.createTextNode(cssText));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Imports/loads the specified CSS file into the document bound to the class.\r\n\t\t *\r\n\t\t * @method loadCSS\r\n\t\t * @param {String} url URL to CSS file to load.\r\n\t\t * @example\r\n\t\t * // Loads a CSS file dynamically into the current document\r\n\t\t * tinymce.DOM.loadCSS('somepath/some.css');\r\n\t\t *\r\n\t\t * // Loads a CSS file into the currently active editor instance\r\n\t\t * tinymce.activeEditor.dom.loadCSS('somepath/some.css');\r\n\t\t *\r\n\t\t * // Loads a CSS file into an editor instance by id\r\n\t\t * tinymce.get('someid').dom.loadCSS('somepath/some.css');\r\n\t\t *\r\n\t\t * // Loads multiple CSS files into the current document\r\n\t\t * tinymce.DOM.loadCSS('somepath/some.css,somepath/someother.css');\r\n\t\t */\r\n\t\tloadCSS: function(url) {\r\n\t\t\tvar self = this, doc = self.doc, head;\r\n\r\n\t\t\t// Prevent inline from loading the same CSS file twice\r\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\r\n\t\t\t\tDOMUtils.DOM.loadCSS(url);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!url) {\r\n\t\t\t\turl = '';\r\n\t\t\t}\r\n\r\n\t\t\thead = doc.getElementsByTagName('head')[0];\r\n\r\n\t\t\teach(url.split(','), function(url) {\r\n\t\t\t\tvar link;\r\n\r\n\t\t\t\turl = Tools._addCacheSuffix(url);\r\n\r\n\t\t\t\tif (self.files[url]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.files[url] = true;\r\n\t\t\t\tlink = self.create('link', {rel: 'stylesheet', href: url});\r\n\r\n\t\t\t\t// IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug\r\n\t\t\t\t// This fix seems to resolve that issue by recalcing the document once a stylesheet finishes loading\r\n\t\t\t\t// It's ugly but it seems to work fine.\r\n\t\t\t\tif (isIE && doc.documentMode && doc.recalc) {\r\n\t\t\t\t\tlink.onload = function() {\r\n\t\t\t\t\t\tif (doc.recalc) {\r\n\t\t\t\t\t\t\tdoc.recalc();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlink.onload = null;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\thead.appendChild(link);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a class to the specified element or elements.\r\n\t\t *\r\n\t\t * @method addClass\r\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\r\n\t\t * @param {String} cls Class name to add to each element.\r\n\t\t * @return {String/Array} String with new class value or array with new class values for all elements.\r\n\t\t * @example\r\n\t\t * // Adds a class to all paragraphs in the active editor\r\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'myclass');\r\n\t\t *\r\n\t\t * // Adds a class to a specific element in the current page\r\n\t\t * tinymce.DOM.addClass('mydiv', 'myclass');\r\n\t\t */\r\n\t\taddClass: function(elm, cls) {\r\n\t\t\tthis.$$(elm).addClass(cls);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes a class from the specified element or elements.\r\n\t\t *\r\n\t\t * @method removeClass\r\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\r\n\t\t * @param {String} cls Class name to remove from each element.\r\n\t\t * @return {String/Array} String of remaining class name(s), or an array of strings if multiple input elements\r\n\t\t * were passed in.\r\n\t\t * @example\r\n\t\t * // Removes a class from all paragraphs in the active editor\r\n\t\t * tinymce.activeEditor.dom.removeClass(tinymce.activeEditor.dom.select('p'), 'myclass');\r\n\t\t *\r\n\t\t * // Removes a class from a specific element in the current page\r\n\t\t * tinymce.DOM.removeClass('mydiv', 'myclass');\r\n\t\t */\r\n\t\tremoveClass: function(elm, cls) {\r\n\t\t\tthis.toggleClass(elm, cls, false);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true if the specified element has the specified class.\r\n\t\t *\r\n\t\t * @method hasClass\r\n\t\t * @param {String/Element} elm HTML element or element id string to check CSS class on.\r\n\t\t * @param {String} cls CSS class to check for.\r\n\t\t * @return {Boolean} true/false if the specified element has the specified class.\r\n\t\t */\r\n\t\thasClass: function(elm, cls) {\r\n\t\t\treturn this.$$(elm).hasClass(cls);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Toggles the specified class on/off.\r\n\t\t *\r\n\t\t * @method toggleClass\r\n\t\t * @param {Element} elm Element to toggle class on.\r\n\t\t * @param {[type]} cls Class to toggle on/off.\r\n\t\t * @param {[type]} state Optional state to set.\r\n\t\t */\r\n\t\ttoggleClass: function(elm, cls, state) {\r\n\t\t\tthis.$$(elm).toggleClass(cls, state).each(function() {\r\n\t\t\t\tif (this.className === '') {\r\n\t\t\t\t\t$(this).attr('class', null);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Shows the specified element(s) by ID by setting the \"display\" style.\r\n\t\t *\r\n\t\t * @method show\r\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to show.\r\n\t\t */\r\n\t\tshow: function(elm) {\r\n\t\t\tthis.$$(elm).show();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides the specified element(s) by ID by setting the \"display\" style.\r\n\t\t *\r\n\t\t * @method hide\r\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to hide.\r\n\t\t * @example\r\n\t\t * // Hides an element by id in the document\r\n\t\t * tinymce.DOM.hide('myid');\r\n\t\t */\r\n\t\thide: function(elm) {\r\n\t\t\tthis.$$(elm).hide();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the element is hidden or not by checking the \"display\" style.\r\n\t\t *\r\n\t\t * @method isHidden\r\n\t\t * @param {String/Element} elm Id or element to check display state on.\r\n\t\t * @return {Boolean} true/false if the element is hidden or not.\r\n\t\t */\r\n\t\tisHidden: function(elm) {\r\n\t\t\treturn this.$$(elm).css('display') == 'none';\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a unique id. This can be useful when generating elements on the fly.\r\n\t\t * This method will not check if the element already exists.\r\n\t\t *\r\n\t\t * @method uniqueId\r\n\t\t * @param {String} prefix Optional prefix to add in front of all ids - defaults to \"mce_\".\r\n\t\t * @return {String} Unique id.\r\n\t\t */\r\n\t\tuniqueId: function(prefix) {\r\n\t\t\treturn (!prefix ? 'mce_' : prefix) + (this.counter++);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the specified HTML content inside the element or elements. The HTML will first be processed. This means\r\n\t\t * URLs will get converted, hex color values fixed etc. Check processHTML for details.\r\n\t\t *\r\n\t\t * @method setHTML\r\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set HTML inside of.\r\n\t\t * @param {String} html HTML content to set as inner HTML of the element.\r\n\t\t * @example\r\n\t\t * // Sets the inner HTML of all paragraphs in the active editor\r\n\t\t * tinymce.activeEditor.dom.setHTML(tinymce.activeEditor.dom.select('p'), 'some inner html');\r\n\t\t *\r\n\t\t * // Sets the inner HTML of an element by id in the document\r\n\t\t * tinymce.DOM.setHTML('mydiv', 'some inner html');\r\n\t\t */\r\n\t\tsetHTML: function(elm, html) {\r\n\t\t\telm = this.$$(elm);\r\n\r\n\t\t\tif (isIE) {\r\n\t\t\t\telm.each(function(i, target) {\r\n\t\t\t\t\tif (target.canHaveHTML === false) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove all child nodes, IE keeps empty text nodes in DOM\r\n\t\t\t\t\twhile (target.firstChild) {\r\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// IE will remove comments from the beginning\r\n\t\t\t\t\t\t// unless you padd the contents with something\r\n\t\t\t\t\t\ttarget.innerHTML = '<br>' + html;\r\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// IE sometimes produces an unknown runtime error on innerHTML if it's a div inside a p\r\n\t\t\t\t\t\t$('<div>').html('<br>' + html).contents().slice(1).appendTo(target);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn html;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\telm.html(html);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the outer HTML of an element.\r\n\t\t *\r\n\t\t * @method getOuterHTML\r\n\t\t * @param {String/Element} elm Element ID or element object to get outer HTML from.\r\n\t\t * @return {String} Outer HTML string.\r\n\t\t * @example\r\n\t\t * tinymce.DOM.getOuterHTML(editorElement);\r\n\t\t * tinymce.activeEditor.getOuterHTML(tinymce.activeEditor.getBody());\r\n\t\t */\r\n\t\tgetOuterHTML: function(elm) {\r\n\t\t\telm = this.get(elm);\r\n\r\n\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some orgaizations\r\n\t\t\treturn elm.nodeType == 1 && \"outerHTML\" in elm ? elm.outerHTML : $('<div>').append($(elm).clone()).html();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the specified outer HTML on an element or elements.\r\n\t\t *\r\n\t\t * @method setOuterHTML\r\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set outer HTML on.\r\n\t\t * @param {Object} html HTML code to set as outer value for the element.\r\n\t\t * @example\r\n\t\t * // Sets the outer HTML of all paragraphs in the active editor\r\n\t\t * tinymce.activeEditor.dom.setOuterHTML(tinymce.activeEditor.dom.select('p'), '<div>some html</div>');\r\n\t\t *\r\n\t\t * // Sets the outer HTML of an element by id in the document\r\n\t\t * tinymce.DOM.setOuterHTML('mydiv', '<div>some html</div>');\r\n\t\t */\r\n\t\tsetOuterHTML: function(elm, html) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.$$(elm).each(function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some organizations\r\n\t\t\t\t\tif (\"outerHTML\" in this) {\r\n\t\t\t\t\t\tthis.outerHTML = html;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Ignore\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// OuterHTML for IE it sometimes produces an \"unknown runtime error\"\r\n\t\t\t\tself.remove($(this).html(html), true);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Entity decodes a string. This method decodes any HTML entities, such as &aring;.\r\n\t\t *\r\n\t\t * @method decode\r\n\t\t * @param {String} s String to decode entities on.\r\n\t\t * @return {String} Entity decoded string.\r\n\t\t */\r\n\t\tdecode: Entities.decode,\r\n\r\n\t\t/**\r\n\t\t * Entity encodes a string. This method encodes the most common entities, such as <>\"&.\r\n\t\t *\r\n\t\t * @method encode\r\n\t\t * @param {String} text String to encode with entities.\r\n\t\t * @return {String} Entity encoded string.\r\n\t\t */\r\n\t\tencode: Entities.encodeAllRaw,\r\n\r\n\t\t/**\r\n\t\t * Inserts an element after the reference element.\r\n\t\t *\r\n\t\t * @method insertAfter\r\n\t\t * @param {Element} node Element to insert after the reference.\r\n\t\t * @param {Element/String/Array} referenceNode Reference element, element id or array of elements to insert after.\r\n\t\t * @return {Element/Array} Element that got added or an array with elements.\r\n\t\t */\r\n\t\tinsertAfter: function(node, referenceNode) {\r\n\t\t\treferenceNode = this.get(referenceNode);\r\n\r\n\t\t\treturn this.run(node, function(node) {\r\n\t\t\t\tvar parent, nextSibling;\r\n\r\n\t\t\t\tparent = referenceNode.parentNode;\r\n\t\t\t\tnextSibling = referenceNode.nextSibling;\r\n\r\n\t\t\t\tif (nextSibling) {\r\n\t\t\t\t\tparent.insertBefore(node, nextSibling);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparent.appendChild(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Replaces the specified element or elements with the new element specified. The new element will\r\n\t\t * be cloned if multiple input elements are passed in.\r\n\t\t *\r\n\t\t * @method replace\r\n\t\t * @param {Element} newElm New element to replace old ones with.\r\n\t\t * @param {Element/String/Array} oldElm Element DOM node, element id or array of elements or ids to replace.\r\n\t\t * @param {Boolean} keepChildren Optional keep children state, if set to true child nodes from the old object will be added\r\n\t\t * to new ones.\r\n\t\t */\r\n\t\treplace: function(newElm, oldElm, keepChildren) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\treturn self.run(oldElm, function(oldElm) {\r\n\t\t\t\tif (is(oldElm, 'array')) {\r\n\t\t\t\t\tnewElm = newElm.cloneNode(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (keepChildren) {\r\n\t\t\t\t\teach(grep(oldElm.childNodes), function(node) {\r\n\t\t\t\t\t\tnewElm.appendChild(node);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn oldElm.parentNode.replaceChild(newElm, oldElm);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renames the specified element and keeps its attributes and children.\r\n\t\t *\r\n\t\t * @method rename\r\n\t\t * @param {Element} elm Element to rename.\r\n\t\t * @param {String} name Name of the new element.\r\n\t\t * @return {Element} New element or the old element if it needed renaming.\r\n\t\t */\r\n\t\trename: function(elm, name) {\r\n\t\t\tvar self = this, newElm;\r\n\r\n\t\t\tif (elm.nodeName != name.toUpperCase()) {\r\n\t\t\t\t// Rename block element\r\n\t\t\t\tnewElm = self.create(name);\r\n\r\n\t\t\t\t// Copy attribs to new block\r\n\t\t\t\teach(self.getAttribs(elm), function(attrNode) {\r\n\t\t\t\t\tself.setAttrib(newElm, attrNode.nodeName, self.getAttrib(elm, attrNode.nodeName));\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Replace block\r\n\t\t\t\tself.replace(newElm, elm, 1);\r\n\t\t\t}\r\n\r\n\t\t\treturn newElm || elm;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Find the common ancestor of two elements. This is a shorter method than using the DOM Range logic.\r\n\t\t *\r\n\t\t * @method findCommonAncestor\r\n\t\t * @param {Element} a Element to find common ancestor of.\r\n\t\t * @param {Element} b Element to find common ancestor of.\r\n\t\t * @return {Element} Common ancestor element of the two input elements.\r\n\t\t */\r\n\t\tfindCommonAncestor: function(a, b) {\r\n\t\t\tvar ps = a, pe;\r\n\r\n\t\t\twhile (ps) {\r\n\t\t\t\tpe = b;\r\n\r\n\t\t\t\twhile (pe && ps != pe) {\r\n\t\t\t\t\tpe = pe.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ps == pe) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tps = ps.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (!ps && a.ownerDocument) {\r\n\t\t\t\treturn a.ownerDocument.documentElement;\r\n\t\t\t}\r\n\r\n\t\t\treturn ps;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Parses the specified RGB color value and returns a hex version of that color.\r\n\t\t *\r\n\t\t * @method toHex\r\n\t\t * @param {String} rgbVal RGB string value like rgb(1,2,3)\r\n\t\t * @return {String} Hex version of that RGB value like #FF00FF.\r\n\t\t */\r\n\t\ttoHex: function(rgbVal) {\r\n\t\t\treturn this.styles.toHex(Tools.trim(rgbVal));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes the specified function on the element by id or dom element node or array of elements/id.\r\n\t\t *\r\n\t\t * @method run\r\n\t\t * @param {String/Element/Array} elm ID or DOM element object or array with ids or elements.\r\n\t\t * @param {function} func Function to execute for each item.\r\n\t\t * @param {Object} scope Optional scope to execute the function in.\r\n\t\t * @return {Object/Array} Single object, or an array of objects if multiple input elements were passed in.\r\n\t\t */\r\n\t\trun: function(elm, func, scope) {\r\n\t\t\tvar self = this, result;\r\n\r\n\t\t\tif (typeof elm === 'string') {\r\n\t\t\t\telm = self.get(elm);\r\n\t\t\t}\r\n\r\n\t\t\tif (!elm) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tscope = scope || this;\r\n\t\t\tif (!elm.nodeType && (elm.length || elm.length === 0)) {\r\n\t\t\t\tresult = [];\r\n\r\n\t\t\t\teach(elm, function(elm, i) {\r\n\t\t\t\t\tif (elm) {\r\n\t\t\t\t\t\tif (typeof elm == 'string') {\r\n\t\t\t\t\t\t\telm = self.get(elm);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tresult.push(func.call(scope, elm, i));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\treturn func.call(scope, elm);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a NodeList with attributes for the element.\r\n\t\t *\r\n\t\t * @method getAttribs\r\n\t\t * @param {HTMLElement/string} elm Element node or string id to get attributes from.\r\n\t\t * @return {NodeList} NodeList with attributes.\r\n\t\t */\r\n\t\tgetAttribs: function(elm) {\r\n\t\t\tvar attrs;\r\n\r\n\t\t\telm = this.get(elm);\r\n\r\n\t\t\tif (!elm) {\r\n\t\t\t\treturn [];\r\n\t\t\t}\r\n\r\n\t\t\tif (isIE) {\r\n\t\t\t\tattrs = [];\r\n\r\n\t\t\t\t// Object will throw exception in IE\r\n\t\t\t\tif (elm.nodeName == 'OBJECT') {\r\n\t\t\t\t\treturn elm.attributes;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// IE doesn't keep the selected attribute if you clone option elements\r\n\t\t\t\tif (elm.nodeName === 'OPTION' && this.getAttrib(elm, 'selected')) {\r\n\t\t\t\t\tattrs.push({specified: 1, nodeName: 'selected'});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// It's crazy that this is faster in IE but it's because it returns all attributes all the time\r\n\t\t\t\tvar attrRegExp = /<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi;\r\n\t\t\t\telm.cloneNode(false).outerHTML.replace(attrRegExp, '').replace(/[\\w:\\-]+/gi, function(a) {\r\n\t\t\t\t\tattrs.push({specified: 1, nodeName: a});\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn attrs;\r\n\t\t\t}\r\n\r\n\t\t\treturn elm.attributes;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified node is to be considered empty or not.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * tinymce.DOM.isEmpty(node, {img: true});\r\n\t\t * @method isEmpty\r\n\t\t * @param {Object} elements Optional name/value object with elements that are automatically treated as non-empty elements.\r\n\t\t * @return {Boolean} true/false if the node is empty or not.\r\n\t\t */\r\n\t\tisEmpty: function(node, elements) {\r\n\t\t\tvar self = this, i, attributes, type, walker, name, brCount = 0;\r\n\r\n\t\t\tnode = node.firstChild;\r\n\t\t\tif (node) {\r\n\t\t\t\twalker = new TreeWalker(node, node.parentNode);\r\n\t\t\t\telements = elements || (self.schema ? self.schema.getNonEmptyElements() : null);\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\ttype = node.nodeType;\r\n\r\n\t\t\t\t\tif (type === 1) {\r\n\t\t\t\t\t\t// Ignore bogus elements\r\n\t\t\t\t\t\tif (node.getAttribute('data-mce-bogus')) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Keep empty elements like <img />\r\n\t\t\t\t\t\tname = node.nodeName.toLowerCase();\r\n\t\t\t\t\t\tif (elements && elements[name]) {\r\n\t\t\t\t\t\t\t// Ignore single BR elements in blocks like <p><br /></p> or <p><span><br /></span></p>\r\n\t\t\t\t\t\t\tif (name === 'br') {\r\n\t\t\t\t\t\t\t\tbrCount++;\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Keep elements with data-bookmark attributes or name attribute like <a name=\"1\"></a>\r\n\t\t\t\t\t\tattributes = self.getAttribs(node);\r\n\t\t\t\t\t\ti = attributes.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tname = attributes[i].nodeName;\r\n\t\t\t\t\t\t\tif (name === \"name\" || name === 'data-mce-bookmark') {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Keep comment nodes\r\n\t\t\t\t\tif (type == 8) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Keep non whitespace text nodes\r\n\t\t\t\t\tif ((type === 3 && !whiteSpaceRegExp.test(node.nodeValue))) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} while ((node = walker.next()));\r\n\t\t\t}\r\n\r\n\t\t\treturn brCount <= 1;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates a new DOM Range object. This will use the native DOM Range API if it's\r\n\t\t * available. If it's not, it will fall back to the custom TinyMCE implementation.\r\n\t\t *\r\n\t\t * @method createRng\r\n\t\t * @return {DOMRange} DOM Range object.\r\n\t\t * @example\r\n\t\t * var rng = tinymce.DOM.createRng();\r\n\t\t * alert(rng.startContainer + \",\" + rng.startOffset);\r\n\t\t */\r\n\t\tcreateRng: function() {\r\n\t\t\tvar doc = this.doc;\r\n\r\n\t\t\treturn doc.createRange ? doc.createRange() : new Range(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the index of the specified node within its parent.\r\n\t\t *\r\n\t\t * @method nodeIndex\r\n\t\t * @param {Node} node Node to look for.\r\n\t\t * @param {boolean} normalized Optional true/false state if the index is what it would be after a normalization.\r\n\t\t * @return {Number} Index of the specified node.\r\n\t\t */\r\n\t\tnodeIndex: nodeIndex,\r\n\r\n\t\t/**\r\n\t\t * Splits an element into two new elements and places the specified split\r\n\t\t * element or elements between the new ones. For example splitting the paragraph at the bold element in\r\n\t\t * this example <p>abc<b>abc</b>123</p> would produce <p>abc</p><b>abc</b><p>123</p>.\r\n\t\t *\r\n\t\t * @method split\r\n\t\t * @param {Element} parentElm Parent element to split.\r\n\t\t * @param {Element} splitElm Element to split at.\r\n\t\t * @param {Element} replacementElm Optional replacement element to replace the split element with.\r\n\t\t * @return {Element} Returns the split element or the replacement element if that is specified.\r\n\t\t */\r\n\t\tsplit: function(parentElm, splitElm, replacementElm) {\r\n\t\t\tvar self = this, r = self.createRng(), bef, aft, pa;\r\n\r\n\t\t\t// W3C valid browsers tend to leave empty nodes to the left/right side of the contents - this makes sense\r\n\t\t\t// but we don't want that in our code since it serves no purpose for the end user\r\n\t\t\t// For example splitting this html at the bold element:\r\n\t\t\t//   <p>text 1<span><b>CHOP</b></span>text 2</p>\r\n\t\t\t// would produce:\r\n\t\t\t//   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>\r\n\t\t\t// this function will then trim off empty edges and produce:\r\n\t\t\t//   <p>text 1</p><b>CHOP</b><p>text 2</p>\r\n\t\t\tfunction trimNode(node) {\r\n\t\t\t\tvar i, children = node.childNodes, type = node.nodeType;\r\n\r\n\t\t\t\tfunction surroundedBySpans(node) {\r\n\t\t\t\t\tvar previousIsSpan = node.previousSibling && node.previousSibling.nodeName == 'SPAN';\r\n\t\t\t\t\tvar nextIsSpan = node.nextSibling && node.nextSibling.nodeName == 'SPAN';\r\n\t\t\t\t\treturn previousIsSpan && nextIsSpan;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type == 1 && node.getAttribute('data-mce-type') == 'bookmark') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i = children.length - 1; i >= 0; i--) {\r\n\t\t\t\t\ttrimNode(children[i]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type != 9) {\r\n\t\t\t\t\t// Keep non whitespace text nodes\r\n\t\t\t\t\tif (type == 3 && node.nodeValue.length > 0) {\r\n\t\t\t\t\t\t// If parent element isn't a block or there isn't any useful contents for example \"<p>   </p>\"\r\n\t\t\t\t\t\t// Also keep text nodes with only spaces if surrounded by spans.\r\n\t\t\t\t\t\t// eg. \"<p><span>a</span> <span>b</span></p>\" should keep space between a and b\r\n\t\t\t\t\t\tvar trimmedLength = trim(node.nodeValue).length;\r\n\t\t\t\t\t\tif (!self.isBlock(node.parentNode) || trimmedLength > 0 || trimmedLength === 0 && surroundedBySpans(node)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (type == 1) {\r\n\t\t\t\t\t\t// If the only child is a bookmark then move it up\r\n\t\t\t\t\t\tchildren = node.childNodes;\r\n\r\n\t\t\t\t\t\t// TODO fix this complex if\r\n\t\t\t\t\t\tif (children.length == 1 && children[0] && children[0].nodeType == 1 &&\r\n\t\t\t\t\t\t\tchildren[0].getAttribute('data-mce-type') == 'bookmark') {\r\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(children[0], node);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Keep non empty elements or img, hr etc\r\n\t\t\t\t\t\tif (children.length || /^(br|hr|input|img)$/i.test(node.nodeName)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.remove(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\r\n\t\t\tif (parentElm && splitElm) {\r\n\t\t\t\t// Get before chunk\r\n\t\t\t\tr.setStart(parentElm.parentNode, self.nodeIndex(parentElm));\r\n\t\t\t\tr.setEnd(splitElm.parentNode, self.nodeIndex(splitElm));\r\n\t\t\t\tbef = r.extractContents();\r\n\r\n\t\t\t\t// Get after chunk\r\n\t\t\t\tr = self.createRng();\r\n\t\t\t\tr.setStart(splitElm.parentNode, self.nodeIndex(splitElm) + 1);\r\n\t\t\t\tr.setEnd(parentElm.parentNode, self.nodeIndex(parentElm) + 1);\r\n\t\t\t\taft = r.extractContents();\r\n\r\n\t\t\t\t// Insert before chunk\r\n\t\t\t\tpa = parentElm.parentNode;\r\n\t\t\t\tpa.insertBefore(trimNode(bef), parentElm);\r\n\r\n\t\t\t\t// Insert middle chunk\r\n\t\t\t\tif (replacementElm) {\r\n\t\t\t\t\tpa.insertBefore(replacementElm, parentElm);\r\n\t\t\t\t\t//pa.replaceChild(replacementElm, splitElm);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpa.insertBefore(splitElm, parentElm);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Insert after chunk\r\n\t\t\t\tpa.insertBefore(trimNode(aft), parentElm);\r\n\t\t\t\tself.remove(parentElm);\r\n\r\n\t\t\t\treturn replacementElm || splitElm;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds an event handler to the specified object.\r\n\t\t *\r\n\t\t * @method bind\r\n\t\t * @param {Element/Document/Window/Array} target Target element to bind events to.\r\n\t\t * handler to or an array of elements/ids/documents.\r\n\t\t * @param {String} name Name of event handler to add, for example: click.\r\n\t\t * @param {function} func Function to execute when the event occurs.\r\n\t\t * @param {Object} scope Optional scope to execute the function in.\r\n\t\t * @return {function} Function callback handler the same as the one passed in.\r\n\t\t */\r\n\t\tbind: function(target, name, func, scope) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (Tools.isArray(target)) {\r\n\t\t\t\tvar i = target.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\ttarget[i] = self.bind(target[i], name, func, scope);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\r\n\t\t\t// Collect all window/document events bound by editor instance\r\n\t\t\tif (self.settings.collect && (target === self.doc || target === self.win)) {\r\n\t\t\t\tself.boundEvents.push([target, name, func, scope]);\r\n\t\t\t}\r\n\r\n\t\t\treturn self.events.bind(target, name, func, scope || self);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the specified event handler by name and function from an element or collection of elements.\r\n\t\t *\r\n\t\t * @method unbind\r\n\t\t * @param {Element/Document/Window/Array} target Target element to unbind events on.\r\n\t\t * @param {String} name Event handler name, for example: \"click\"\r\n\t\t * @param {function} func Function to remove.\r\n\t\t * @return {bool/Array} Bool state of true if the handler was removed, or an array of states if multiple input elements\r\n\t\t * were passed in.\r\n\t\t */\r\n\t\tunbind: function(target, name, func) {\r\n\t\t\tvar self = this, i;\r\n\r\n\t\t\tif (Tools.isArray(target)) {\r\n\t\t\t\ti = target.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\ttarget[i] = self.unbind(target[i], name, func);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove any bound events matching the input\r\n\t\t\tif (self.boundEvents && (target === self.doc || target === self.win)) {\r\n\t\t\t\ti = self.boundEvents.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tvar item = self.boundEvents[i];\r\n\r\n\t\t\t\t\tif (target == item[0] && (!name || name == item[1]) && (!func || func == item[2])) {\r\n\t\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this.events.unbind(target, name, func);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Fires the specified event name with object on target.\r\n\t\t *\r\n\t\t * @method fire\r\n\t\t * @param {Node/Document/Window} target Target element or object to fire event on.\r\n\t\t * @param {String} name Name of the event to fire.\r\n\t\t * @param {Object} evt Event object to send.\r\n\t\t * @return {Event} Event object.\r\n\t\t */\r\n\t\tfire: function(target, name, evt) {\r\n\t\t\treturn this.events.fire(target, name, evt);\r\n\t\t},\r\n\r\n\t\t// Returns the content editable state of a node\r\n\t\tgetContentEditable: function(node) {\r\n\t\t\tvar contentEditable;\r\n\r\n\t\t\t// Check type\r\n\t\t\tif (!node || node.nodeType != 1) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\t// Check for fake content editable\r\n\t\t\tcontentEditable = node.getAttribute(\"data-mce-contenteditable\");\r\n\t\t\tif (contentEditable && contentEditable !== \"inherit\") {\r\n\t\t\t\treturn contentEditable;\r\n\t\t\t}\r\n\r\n\t\t\t// Check for real content editable\r\n\t\t\treturn node.contentEditable !== \"inherit\" ? node.contentEditable : null;\r\n\t\t},\r\n\r\n\t\tgetContentEditableParent: function(node) {\r\n\t\t\tvar root = this.getRoot(), state = null;\r\n\r\n\t\t\tfor (; node && node !== root; node = node.parentNode) {\r\n\t\t\t\tstate = this.getContentEditable(node);\r\n\r\n\t\t\t\tif (state !== null) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn state;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Destroys all internal references to the DOM to solve IE leak issues.\r\n\t\t *\r\n\t\t * @method destroy\r\n\t\t */\r\n\t\tdestroy: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// Unbind all events bound to window/document by editor instance\r\n\t\t\tif (self.boundEvents) {\r\n\t\t\t\tvar i = self.boundEvents.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tvar item = self.boundEvents[i];\r\n\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.boundEvents = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Restore sizzle document to window.document\r\n\t\t\t// Since the current document might be removed producing \"Permission denied\" on IE see #6325\r\n\t\t\tif (Sizzle.setDocument) {\r\n\t\t\t\tSizzle.setDocument();\r\n\t\t\t}\r\n\r\n\t\t\tself.win = self.doc = self.root = self.events = self.frag = null;\r\n\t\t},\r\n\r\n\t\tisChildOf: function(node, parent) {\r\n\t\t\twhile (node) {\r\n\t\t\t\tif (parent === node) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t// #ifdef debug\r\n\r\n\t\tdumpRng: function(r) {\r\n\t\t\treturn (\r\n\t\t\t\t'startContainer: ' + r.startContainer.nodeName +\r\n\t\t\t\t', startOffset: ' + r.startOffset +\r\n\t\t\t\t', endContainer: ' + r.endContainer.nodeName +\r\n\t\t\t\t', endOffset: ' + r.endOffset\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t// #endif\r\n\r\n\t\t_findSib: function(node, selector, name) {\r\n\t\t\tvar self = this, func = selector;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\t// If expression make a function of it using is\r\n\t\t\t\tif (typeof func == 'string') {\r\n\t\t\t\t\tfunc = function(node) {\r\n\t\t\t\t\t\treturn self.is(node, selector);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Loop all siblings\r\n\t\t\t\tfor (node = node[name]; node; node = node[name]) {\r\n\t\t\t\t\tif (func(node)) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Instance of DOMUtils for the current document.\r\n\t *\r\n\t * @static\r\n\t * @property DOM\r\n\t * @type tinymce.dom.DOMUtils\r\n\t * @example\r\n\t * // Example of how to add a class to some element by id\r\n\t * tinymce.DOM.addClass('someid', 'someclass');\r\n\t */\r\n\tDOMUtils.DOM = new DOMUtils(document);\r\n\tDOMUtils.nodeIndex = nodeIndex;\r\n\r\n\treturn DOMUtils;\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/ScriptLoader.js\r\n\r\n/**\r\n * ScriptLoader.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*globals console*/\r\n\r\n/**\r\n * This class handles asynchronous/synchronous loading of JavaScript files it will execute callbacks\r\n * when various items gets loaded. This class is useful to load external JavaScript files.\r\n *\r\n * @class tinymce.dom.ScriptLoader\r\n * @example\r\n * // Load a script from a specific URL using the global script loader\r\n * tinymce.ScriptLoader.load('somescript.js');\r\n *\r\n * // Load a script using a unique instance of the script loader\r\n * var scriptLoader = new tinymce.dom.ScriptLoader();\r\n *\r\n * scriptLoader.load('somescript.js');\r\n *\r\n * // Load multiple scripts\r\n * var scriptLoader = new tinymce.dom.ScriptLoader();\r\n *\r\n * scriptLoader.add('somescript1.js');\r\n * scriptLoader.add('somescript2.js');\r\n * scriptLoader.add('somescript3.js');\r\n *\r\n * scriptLoader.loadQueue(function() {\r\n *    alert('All scripts are now loaded.');\r\n * });\r\n */\r\ndefine(\"tinymce/dom/ScriptLoader\", [\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/util/Tools\"\r\n], function(DOMUtils, Tools) {\r\n\tvar DOM = DOMUtils.DOM;\r\n\tvar each = Tools.each, grep = Tools.grep;\r\n\r\n\tfunction ScriptLoader() {\r\n\t\tvar QUEUED = 0,\r\n\t\t\tLOADING = 1,\r\n\t\t\tLOADED = 2,\r\n\t\t\tstates = {},\r\n\t\t\tqueue = [],\r\n\t\t\tscriptLoadedCallbacks = {},\r\n\t\t\tqueueLoadedCallbacks = [],\r\n\t\t\tloading = 0,\r\n\t\t\tundef;\r\n\r\n\t\t/**\r\n\t\t * Loads a specific script directly without adding it to the load queue.\r\n\t\t *\r\n\t\t * @method load\r\n\t\t * @param {String} url Absolute URL to script to add.\r\n\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\r\n\t\t */\r\n\t\tfunction loadScript(url, callback) {\r\n\t\t\tvar dom = DOM, elm, id;\r\n\r\n\t\t\t// Execute callback when script is loaded\r\n\t\t\tfunction done() {\r\n\t\t\t\tdom.remove(id);\r\n\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\telm.onreadystatechange = elm.onload = elm = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\r\n\t\t\tfunction error() {\r\n\t\t\t\t/*eslint no-console:0 */\r\n\r\n\t\t\t\t// Report the error so it's easier for people to spot loading errors\r\n\t\t\t\tif (typeof console !== \"undefined\" && console.log) {\r\n\t\t\t\t\tconsole.log(\"Failed to load: \" + url);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// We can't mark it as done if there is a load error since\r\n\t\t\t\t// A) We don't want to produce 404 errors on the server and\r\n\t\t\t\t// B) the onerror event won't fire on all browsers.\r\n\t\t\t\t// done();\r\n\t\t\t}\r\n\r\n\t\t\tid = dom.uniqueId();\r\n\r\n\t\t\t// Create new script element\r\n\t\t\telm = document.createElement('script');\r\n\t\t\telm.id = id;\r\n\t\t\telm.type = 'text/javascript';\r\n\t\t\telm.src = Tools._addCacheSuffix(url);\r\n\r\n\t\t\t// Seems that onreadystatechange works better on IE 10 onload seems to fire incorrectly\r\n\t\t\tif (\"onreadystatechange\" in elm) {\r\n\t\t\t\telm.onreadystatechange = function() {\r\n\t\t\t\t\tif (/loaded|complete/.test(elm.readyState)) {\r\n\t\t\t\t\t\tdone();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\telm.onload = done;\r\n\t\t\t}\r\n\r\n\t\t\t// Add onerror event will get fired on some browsers but not all of them\r\n\t\t\telm.onerror = error;\r\n\r\n\t\t\t// Add script to document\r\n\t\t\t(document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if a script has been loaded or not.\r\n\t\t *\r\n\t\t * @method isDone\r\n\t\t * @param {String} url URL to check for.\r\n\t\t * @return {Boolean} true/false if the URL is loaded.\r\n\t\t */\r\n\t\tthis.isDone = function(url) {\r\n\t\t\treturn states[url] == LOADED;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Marks a specific script to be loaded. This can be useful if a script got loaded outside\r\n\t\t * the script loader or to skip it from loading some script.\r\n\t\t *\r\n\t\t * @method markDone\r\n\t\t * @param {string} url Absolute URL to the script to mark as loaded.\r\n\t\t */\r\n\t\tthis.markDone = function(url) {\r\n\t\t\tstates[url] = LOADED;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Adds a specific script to the load queue of the script loader.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {String} url Absolute URL to script to add.\r\n\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\r\n\t\t * @param {Object} scope Optional scope to execute callback in.\r\n\t\t */\r\n\t\tthis.add = this.load = function(url, callback, scope) {\r\n\t\t\tvar state = states[url];\r\n\r\n\t\t\t// Add url to load queue\r\n\t\t\tif (state == undef) {\r\n\t\t\t\tqueue.push(url);\r\n\t\t\t\tstates[url] = QUEUED;\r\n\t\t\t}\r\n\r\n\t\t\tif (callback) {\r\n\t\t\t\t// Store away callback for later execution\r\n\t\t\t\tif (!scriptLoadedCallbacks[url]) {\r\n\t\t\t\t\tscriptLoadedCallbacks[url] = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscriptLoadedCallbacks[url].push({\r\n\t\t\t\t\tfunc: callback,\r\n\t\t\t\t\tscope: scope || this\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.remove = function(url) {\r\n\t\t\tdelete states[url];\r\n\t\t\tdelete scriptLoadedCallbacks[url];\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Starts the loading of the queue.\r\n\t\t *\r\n\t\t * @method loadQueue\r\n\t\t * @param {function} callback Optional callback to execute when all queued items are loaded.\r\n\t\t * @param {Object} scope Optional scope to execute the callback in.\r\n\t\t */\r\n\t\tthis.loadQueue = function(callback, scope) {\r\n\t\t\tthis.loadScripts(queue, callback, scope);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Loads the specified queue of files and executes the callback ones they are loaded.\r\n\t\t * This method is generally not used outside this class but it might be useful in some scenarios.\r\n\t\t *\r\n\t\t * @method loadScripts\r\n\t\t * @param {Array} scripts Array of queue items to load.\r\n\t\t * @param {function} callback Optional callback to execute ones all items are loaded.\r\n\t\t * @param {Object} scope Optional scope to execute callback in.\r\n\t\t */\r\n\t\tthis.loadScripts = function(scripts, callback, scope) {\r\n\t\t\tvar loadScripts;\r\n\r\n\t\t\tfunction execScriptLoadedCallbacks(url) {\r\n\t\t\t\t// Execute URL callback functions\r\n\t\t\t\teach(scriptLoadedCallbacks[url], function(callback) {\r\n\t\t\t\t\tcallback.func.call(callback.scope);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tscriptLoadedCallbacks[url] = undef;\r\n\t\t\t}\r\n\r\n\t\t\tqueueLoadedCallbacks.push({\r\n\t\t\t\tfunc: callback,\r\n\t\t\t\tscope: scope || this\r\n\t\t\t});\r\n\r\n\t\t\tloadScripts = function() {\r\n\t\t\t\tvar loadingScripts = grep(scripts);\r\n\r\n\t\t\t\t// Current scripts has been handled\r\n\t\t\t\tscripts.length = 0;\r\n\r\n\t\t\t\t// Load scripts that needs to be loaded\r\n\t\t\t\teach(loadingScripts, function(url) {\r\n\t\t\t\t\t// Script is already loaded then execute script callbacks directly\r\n\t\t\t\t\tif (states[url] == LOADED) {\r\n\t\t\t\t\t\texecScriptLoadedCallbacks(url);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Is script not loading then start loading it\r\n\t\t\t\t\tif (states[url] != LOADING) {\r\n\t\t\t\t\t\tstates[url] = LOADING;\r\n\t\t\t\t\t\tloading++;\r\n\r\n\t\t\t\t\t\tloadScript(url, function() {\r\n\t\t\t\t\t\t\tstates[url] = LOADED;\r\n\t\t\t\t\t\t\tloading--;\r\n\r\n\t\t\t\t\t\t\texecScriptLoadedCallbacks(url);\r\n\r\n\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\r\n\t\t\t\t\t\t\tloadScripts();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// No scripts are currently loading then execute all pending queue loaded callbacks\r\n\t\t\t\tif (!loading) {\r\n\t\t\t\t\teach(queueLoadedCallbacks, function(callback) {\r\n\t\t\t\t\t\tcallback.func.call(callback.scope);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tqueueLoadedCallbacks.length = 0;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tloadScripts();\r\n\t\t};\r\n\t}\r\n\r\n\tScriptLoader.ScriptLoader = new ScriptLoader();\r\n\r\n\treturn ScriptLoader;\r\n});\r\n\r\n// Included from: js/tinymce/classes/AddOnManager.js\r\n\r\n/**\r\n * AddOnManager.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles the loading of themes/plugins or other add-ons and their language packs.\r\n *\r\n * @class tinymce.AddOnManager\r\n */\r\ndefine(\"tinymce/AddOnManager\", [\r\n\t\"tinymce/dom/ScriptLoader\",\r\n\t\"tinymce/util/Tools\"\r\n], function(ScriptLoader, Tools) {\r\n\tvar each = Tools.each;\r\n\r\n\tfunction AddOnManager() {\r\n\t\tvar self = this;\r\n\r\n\t\tself.items = [];\r\n\t\tself.urls = {};\r\n\t\tself.lookup = {};\r\n\t}\r\n\r\n\tAddOnManager.prototype = {\r\n\t\t/**\r\n\t\t * Returns the specified add on by the short name.\r\n\t\t *\r\n\t\t * @method get\r\n\t\t * @param {String} name Add-on to look for.\r\n\t\t * @return {tinymce.Theme/tinymce.Plugin} Theme or plugin add-on instance or undefined.\r\n\t\t */\r\n\t\tget: function(name) {\r\n\t\t\tif (this.lookup[name]) {\r\n\t\t\t\treturn this.lookup[name].instance;\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined;\r\n\t\t},\r\n\r\n\t\tdependencies: function(name) {\r\n\t\t\tvar result;\r\n\r\n\t\t\tif (this.lookup[name]) {\r\n\t\t\t\tresult = this.lookup[name].dependencies;\r\n\t\t\t}\r\n\r\n\t\t\treturn result || [];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Loads a language pack for the specified add-on.\r\n\t\t *\r\n\t\t * @method requireLangPack\r\n\t\t * @param {String} name Short name of the add-on.\r\n\t\t * @param {String} languages Optional comma or space separated list of languages to check if it matches the name.\r\n\t\t */\r\n\t\trequireLangPack: function(name, languages) {\r\n\t\t\tvar language = AddOnManager.language;\r\n\r\n\t\t\tif (language && AddOnManager.languageLoad !== false) {\r\n\t\t\t\tif (languages) {\r\n\t\t\t\t\tlanguages = ',' + languages + ',';\r\n\r\n\t\t\t\t\t// Load short form sv.js or long form sv_SE.js\r\n\t\t\t\t\tif (languages.indexOf(',' + language.substr(0, 2) + ',') != -1) {\r\n\t\t\t\t\t\tlanguage = language.substr(0, 2);\r\n\t\t\t\t\t} else if (languages.indexOf(',' + language + ',') == -1) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tScriptLoader.ScriptLoader.add(this.urls[name] + '/langs/' + language + '.js');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a instance of the add-on by it's short name.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {String} id Short name/id for the add-on.\r\n\t\t * @param {tinymce.Theme/tinymce.Plugin} addOn Theme or plugin to add.\r\n\t\t * @return {tinymce.Theme/tinymce.Plugin} The same theme or plugin instance that got passed in.\r\n\t\t * @example\r\n\t\t * // Create a simple plugin\r\n\t\t * tinymce.create('tinymce.plugins.TestPlugin', {\r\n\t\t *   TestPlugin: function(ed, url) {\r\n\t\t *   ed.on('click', function(e) {\r\n\t\t *      ed.windowManager.alert('Hello World!');\r\n\t\t *   });\r\n\t\t *   }\r\n\t\t * });\r\n\t\t *\r\n\t\t * // Register plugin using the add method\r\n\t\t * tinymce.PluginManager.add('test', tinymce.plugins.TestPlugin);\r\n\t\t *\r\n\t\t * // Initialize TinyMCE\r\n\t\t * tinymce.init({\r\n\t\t *  ...\r\n\t\t *  plugins: '-test' // Init the plugin but don't try to load it\r\n\t\t * });\r\n\t\t */\r\n\t\tadd: function(id, addOn, dependencies) {\r\n\t\t\tthis.items.push(addOn);\r\n\t\t\tthis.lookup[id] = {instance: addOn, dependencies: dependencies};\r\n\r\n\t\t\treturn addOn;\r\n\t\t},\r\n\r\n\t\tremove: function(name) {\r\n\t\t\tdelete this.urls[name];\r\n\t\t\tdelete this.lookup[name];\r\n\t\t},\r\n\r\n\t\tcreateUrl: function(baseUrl, dep) {\r\n\t\t\tif (typeof dep === \"object\") {\r\n\t\t\t\treturn dep;\r\n\t\t\t}\r\n\r\n\t\t\treturn {prefix: baseUrl.prefix, resource: dep, suffix: baseUrl.suffix};\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Add a set of components that will make up the add-on. Using the url of the add-on name as the base url.\r\n\t\t * This should be used in development mode.  A new compressor/javascript munger process will ensure that the\r\n\t\t * components are put together into the plugin.js file and compressed correctly.\r\n\t\t *\r\n\t\t * @method addComponents\r\n\t\t * @param {String} pluginName name of the plugin to load scripts from (will be used to get the base url for the plugins).\r\n\t\t * @param {Array} scripts Array containing the names of the scripts to load.\r\n\t\t */\r\n\t\taddComponents: function(pluginName, scripts) {\r\n\t\t\tvar pluginUrl = this.urls[pluginName];\r\n\r\n\t\t\teach(scripts, function(script) {\r\n\t\t\t\tScriptLoader.ScriptLoader.add(pluginUrl + \"/\" + script);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Loads an add-on from a specific url.\r\n\t\t *\r\n\t\t * @method load\r\n\t\t * @param {String} name Short name of the add-on that gets loaded.\r\n\t\t * @param {String} addOnUrl URL to the add-on that will get loaded.\r\n\t\t * @param {function} callback Optional callback to execute ones the add-on is loaded.\r\n\t\t * @param {Object} scope Optional scope to execute the callback in.\r\n\t\t * @example\r\n\t\t * // Loads a plugin from an external URL\r\n\t\t * tinymce.PluginManager.load('myplugin', '/some/dir/someplugin/plugin.js');\r\n\t\t *\r\n\t\t * // Initialize TinyMCE\r\n\t\t * tinymce.init({\r\n\t\t *  ...\r\n\t\t *  plugins: '-myplugin' // Don't try to load it again\r\n\t\t * });\r\n\t\t */\r\n\t\tload: function(name, addOnUrl, callback, scope) {\r\n\t\t\tvar self = this, url = addOnUrl;\r\n\r\n\t\t\tfunction loadDependencies() {\r\n\t\t\t\tvar dependencies = self.dependencies(name);\r\n\r\n\t\t\t\teach(dependencies, function(dep) {\r\n\t\t\t\t\tvar newUrl = self.createUrl(addOnUrl, dep);\r\n\r\n\t\t\t\t\tself.load(newUrl.resource, newUrl, undefined, undefined);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tif (scope) {\r\n\t\t\t\t\t\tcallback.call(scope);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcallback.call(ScriptLoader);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (self.urls[name]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof addOnUrl === \"object\") {\r\n\t\t\t\turl = addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\r\n\t\t\t}\r\n\r\n\t\t\tif (url.indexOf('/') !== 0 && url.indexOf('://') == -1) {\r\n\t\t\t\turl = AddOnManager.baseURL + '/' + url;\r\n\t\t\t}\r\n\r\n\t\t\tself.urls[name] = url.substring(0, url.lastIndexOf('/'));\r\n\r\n\t\t\tif (self.lookup[name]) {\r\n\t\t\t\tloadDependencies();\r\n\t\t\t} else {\r\n\t\t\t\tScriptLoader.ScriptLoader.add(url, loadDependencies, scope);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tAddOnManager.PluginManager = new AddOnManager();\r\n\tAddOnManager.ThemeManager = new AddOnManager();\r\n\r\n\treturn AddOnManager;\r\n});\r\n\r\n/**\r\n * TinyMCE theme class.\r\n *\r\n * @class tinymce.Theme\r\n */\r\n\r\n/**\r\n * This method is responsible for rendering/generating the overall user interface with toolbars, buttons, iframe containers etc.\r\n *\r\n * @method renderUI\r\n * @param {Object} obj Object parameter containing the targetNode DOM node that will be replaced visually with an editor instance.\r\n * @return {Object} an object with items like iframeContainer, editorContainer, sizeContainer, deltaWidth, deltaHeight.\r\n */\r\n\r\n/**\r\n * Plugin base class, this is a pseudo class that describes how a plugin is to be created for TinyMCE. The methods below are all optional.\r\n *\r\n * @class tinymce.Plugin\r\n * @example\r\n * tinymce.PluginManager.add('example', function(editor, url) {\r\n *     // Add a button that opens a window\r\n *     editor.addButton('example', {\r\n *         text: 'My button',\r\n *         icon: false,\r\n *         onclick: function() {\r\n *             // Open window\r\n *             editor.windowManager.open({\r\n *                 title: 'Example plugin',\r\n *                 body: [\r\n *                     {type: 'textbox', name: 'title', label: 'Title'}\r\n *                 ],\r\n *                 onsubmit: function(e) {\r\n *                     // Insert content when the window form is submitted\r\n *                     editor.insertContent('Title: ' + e.data.title);\r\n *                 }\r\n *             });\r\n *         }\r\n *     });\r\n *\r\n *     // Adds a menu item to the tools menu\r\n *     editor.addMenuItem('example', {\r\n *         text: 'Example plugin',\r\n *         context: 'tools',\r\n *         onclick: function() {\r\n *             // Open window with a specific url\r\n *             editor.windowManager.open({\r\n *                 title: 'TinyMCE site',\r\n *                 url: 'http://www.tinymce.com',\r\n *                 width: 800,\r\n *                 height: 600,\r\n *                 buttons: [{\r\n *                     text: 'Close',\r\n *                     onclick: 'close'\r\n *                 }]\r\n *             });\r\n *         }\r\n *     });\r\n * });\r\n */\r\n\r\n// Included from: js/tinymce/classes/dom/NodeType.js\r\n\r\n/**\r\n * NodeType.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Contains various node validation functions.\r\n *\r\n * @private\r\n * @class tinymce.dom.NodeType\r\n */\r\ndefine(\"tinymce/dom/NodeType\", [], function() {\r\n\tfunction isNodeType(type) {\r\n\t\treturn function(node) {\r\n\t\t\treturn !!node && node.nodeType == type;\r\n\t\t};\r\n\t}\r\n\r\n\tvar isElement = isNodeType(1);\r\n\r\n\tfunction matchNodeNames(names) {\r\n\t\tnames = names.toLowerCase().split(' ');\r\n\r\n\t\treturn function(node) {\r\n\t\t\tvar i, name;\r\n\r\n\t\t\tif (node && node.nodeType) {\r\n\t\t\t\tname = node.nodeName.toLowerCase();\r\n\r\n\t\t\t\tfor (i = 0; i < names.length; i++) {\r\n\t\t\t\t\tif (name === names[i]) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction matchStyleValues(name, values) {\r\n\t\tvalues = values.toLowerCase().split(' ');\r\n\r\n\t\treturn function(node) {\r\n\t\t\tvar i, cssValue;\r\n\r\n\t\t\tif (isElement(node)) {\r\n\t\t\t\tfor (i = 0; i < values.length; i++) {\r\n\t\t\t\t\tcssValue = getComputedStyle(node, null).getPropertyValue(name);\r\n\t\t\t\t\tif (cssValue === values[i]) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction hasPropValue(propName, propValue) {\r\n\t\treturn function(node) {\r\n\t\t\treturn isElement(node) && node[propName] === propValue;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction hasAttributeValue(attrName, attrValue) {\r\n\t\treturn function(node) {\r\n\t\t\treturn isElement(node) && node.getAttribute(attrName) === attrValue;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction isBogus(node) {\r\n\t\treturn isElement(node) && node.hasAttribute('data-mce-bogus');\r\n\t}\r\n\r\n\tfunction hasContentEditableState(value) {\r\n\t\treturn function(node) {\r\n\t\t\tif (isElement(node)) {\r\n\t\t\t\tif (node.contentEditable === value) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node.getAttribute('data-mce-contenteditable') === value) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tisText: isNodeType(3),\r\n\t\tisElement: isElement,\r\n\t\tisComment: isNodeType(8),\r\n\t\tisBr: matchNodeNames('br'),\r\n\t\tisContentEditableTrue: hasContentEditableState('true'),\r\n\t\tisContentEditableFalse: hasContentEditableState('false'),\r\n\t\tmatchNodeNames: matchNodeNames,\r\n\t\thasPropValue: hasPropValue,\r\n\t\thasAttributeValue: hasAttributeValue,\r\n\t\tmatchStyleValues: matchStyleValues,\r\n\t\tisBogus: isBogus\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/text/Zwsp.js\r\n\r\n/**\r\n * Zwsp.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * ....\r\n *\r\n * @private\r\n * @class tinymce.text.Zwsp\r\n * @example\r\n * var isZwsp = Zwsp.isZwsp('\\u200b');\r\n * var abc = Zwsp.trim('a\\u200bc');\r\n */\r\ndefine(\"tinymce/text/Zwsp\", [], function() {\r\n\tvar ZWSP = '\\u200b';\r\n\r\n\tfunction isZwsp(chr) {\r\n\t\treturn chr == ZWSP;\r\n\t}\r\n\r\n\tfunction trim(str) {\r\n\t\treturn str.replace(new RegExp(ZWSP, 'g'), '');\r\n\t}\r\n\r\n\treturn {\r\n\t\tisZwsp: isZwsp,\r\n\t\tZWSP: ZWSP,\r\n\t\ttrim: trim\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/CaretContainer.js\r\n\r\n/**\r\n * CaretContainer.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module handles caret containers. A caret container is a node that\r\n * holds the caret for positional purposes.\r\n *\r\n * @private\r\n * @class tinymce.caret.CaretContainer\r\n */\r\ndefine(\"tinymce/caret/CaretContainer\", [\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/text/Zwsp\"\r\n], function(NodeType, Zwsp) {\r\n\tvar isElement = NodeType.isElement,\r\n\t\tisText = NodeType.isText;\r\n\r\n\tfunction isCaretContainerBlock(node) {\r\n\t\tif (isText(node)) {\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\r\n\t\treturn isElement(node) && node.hasAttribute('data-mce-caret');\r\n\t}\r\n\r\n\tfunction isCaretContainerInline(node) {\r\n\t\treturn isText(node) && Zwsp.isZwsp(node.data);\r\n\t}\r\n\r\n\tfunction isCaretContainer(node) {\r\n\t\treturn isCaretContainerBlock(node) || isCaretContainerInline(node);\r\n\t}\r\n\r\n\tfunction insertInline(node, before) {\r\n\t\tvar doc, sibling, textNode, parentNode;\r\n\r\n\t\tdoc = node.ownerDocument;\r\n\t\ttextNode = doc.createTextNode(Zwsp.ZWSP);\r\n\t\tparentNode = node.parentNode;\r\n\r\n\t\tif (!before) {\r\n\t\t\tsibling = node.nextSibling;\r\n\t\t\tif (isText(sibling)) {\r\n\t\t\t\tif (isCaretContainer(sibling)) {\r\n\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (startsWithCaretContainer(sibling)) {\r\n\t\t\t\t\tsibling.splitText(1);\r\n\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (node.nextSibling) {\r\n\t\t\t\tparentNode.insertBefore(textNode, node.nextSibling);\r\n\t\t\t} else {\r\n\t\t\t\tparentNode.appendChild(textNode);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsibling = node.previousSibling;\r\n\t\t\tif (isText(sibling)) {\r\n\t\t\t\tif (isCaretContainer(sibling)) {\r\n\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (endsWithCaretContainer(sibling)) {\r\n\t\t\t\t\treturn sibling.splitText(sibling.data.length - 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tparentNode.insertBefore(textNode, node);\r\n\t\t}\r\n\r\n\t\treturn textNode;\r\n\t}\r\n\r\n\tfunction insertBlock(blockName, node, before) {\r\n\t\tvar doc, blockNode, parentNode;\r\n\r\n\t\tdoc = node.ownerDocument;\r\n\t\tblockNode = doc.createElement(blockName);\r\n\t\tblockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\r\n\t\tblockNode.setAttribute('data-mce-bogus', 'all');\r\n\t\tblockNode.appendChild(doc.createTextNode('\\u00a0'));\r\n\t\tparentNode = node.parentNode;\r\n\r\n\t\tif (!before) {\r\n\t\t\tif (node.nextSibling) {\r\n\t\t\t\tparentNode.insertBefore(blockNode, node.nextSibling);\r\n\t\t\t} else {\r\n\t\t\t\tparentNode.appendChild(blockNode);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tparentNode.insertBefore(blockNode, node);\r\n\t\t}\r\n\r\n\t\treturn blockNode;\r\n\t}\r\n\r\n\tfunction remove(caretContainerNode) {\r\n\t\tvar text;\r\n\r\n\t\tif (isElement(caretContainerNode) && isCaretContainer(caretContainerNode)) {\r\n\t\t\tif (caretContainerNode.innerHTML != '&nbsp;') {\r\n\t\t\t\tcaretContainerNode.removeAttribute('data-mce-caret');\r\n\t\t\t} else {\r\n\t\t\t\tif (caretContainerNode.parentNode) {\r\n\t\t\t\t\tcaretContainerNode.parentNode.removeChild(caretContainerNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isText(caretContainerNode)) {\r\n\t\t\ttext = Zwsp.trim(caretContainerNode.data);\r\n\r\n\t\t\tif (text.length === 0) {\r\n\t\t\t\tif (caretContainerNode.parentNode) {\r\n\t\t\t\t\tcaretContainerNode.parentNode.removeChild(caretContainerNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcaretContainerNode.nodeValue = text;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction startsWithCaretContainer(node) {\r\n\t\treturn isText(node) && node.data[0] == Zwsp.ZWSP;\r\n\t}\r\n\r\n\tfunction endsWithCaretContainer(node) {\r\n\t\treturn isText(node) && node.data[node.data.length - 1] == Zwsp.ZWSP;\r\n\t}\r\n\r\n\treturn {\r\n\t\tisCaretContainer: isCaretContainer,\r\n\t\tisCaretContainerBlock: isCaretContainerBlock,\r\n\t\tisCaretContainerInline: isCaretContainerInline,\r\n\t\tinsertInline: insertInline,\r\n\t\tinsertBlock: insertBlock,\r\n\t\tremove: remove,\r\n\t\tstartsWithCaretContainer: startsWithCaretContainer,\r\n\t\tendsWithCaretContainer: endsWithCaretContainer\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/RangeUtils.js\r\n\r\n/**\r\n * RangeUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class contains a few utility methods for ranges.\r\n *\r\n * @class tinymce.dom.RangeUtils\r\n */\r\ndefine(\"tinymce/dom/RangeUtils\", [\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/caret/CaretContainer\"\r\n], function(Tools, TreeWalker, NodeType, CaretContainer) {\r\n\tvar each = Tools.each,\r\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\r\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\r\n\r\n\tfunction getEndChild(container, index) {\r\n\t\tvar childNodes = container.childNodes;\r\n\r\n\t\tindex--;\r\n\r\n\t\tif (index > childNodes.length - 1) {\r\n\t\t\tindex = childNodes.length - 1;\r\n\t\t} else if (index < 0) {\r\n\t\t\tindex = 0;\r\n\t\t}\r\n\r\n\t\treturn childNodes[index] || container;\r\n\t}\r\n\r\n\tfunction RangeUtils(dom) {\r\n\t\t/**\r\n\t\t * Walks the specified range like object and executes the callback for each sibling collection it finds.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @method walk\r\n\t\t * @param {Object} rng Range like object.\r\n\t\t * @param {function} callback Callback function to execute for each sibling collection.\r\n\t\t */\r\n\t\tthis.walk = function(rng, callback) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset,\r\n\t\t\t\tancestor, startPoint,\r\n\t\t\t\tendPoint, node, parent, siblings, nodes;\r\n\r\n\t\t\t// Handle table cell selection the table plugin enables\r\n\t\t\t// you to fake select table cells and perform formatting actions on them\r\n\t\t\tnodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\r\n\t\t\tif (nodes.length > 0) {\r\n\t\t\t\teach(nodes, function(node) {\r\n\t\t\t\t\tcallback([node]);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Excludes start/end text node if they are out side the range\r\n\t\t\t *\r\n\t\t\t * @private\r\n\t\t\t * @param {Array} nodes Nodes to exclude items from.\r\n\t\t\t * @return {Array} Array with nodes excluding the start/end container if needed.\r\n\t\t\t */\r\n\t\t\tfunction exclude(nodes) {\r\n\t\t\t\tvar node;\r\n\r\n\t\t\t\t// First node is excluded\r\n\t\t\t\tnode = nodes[0];\r\n\t\t\t\tif (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\r\n\t\t\t\t\tnodes.splice(0, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Last node is excluded\r\n\t\t\t\tnode = nodes[nodes.length - 1];\r\n\t\t\t\tif (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\r\n\t\t\t\t\tnodes.splice(nodes.length - 1, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn nodes;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Collects siblings\r\n\t\t\t *\r\n\t\t\t * @private\r\n\t\t\t * @param {Node} node Node to collect siblings from.\r\n\t\t\t * @param {String} name Name of the sibling to check for.\r\n\t\t\t * @param {Node} end_node\r\n\t\t\t * @return {Array} Array of collected siblings.\r\n\t\t\t */\r\n\t\t\tfunction collectSiblings(node, name, end_node) {\r\n\t\t\t\tvar siblings = [];\r\n\r\n\t\t\t\tfor (; node && node != end_node; node = node[name]) {\r\n\t\t\t\t\tsiblings.push(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn siblings;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Find an end point this is the node just before the common ancestor root.\r\n\t\t\t *\r\n\t\t\t * @private\r\n\t\t\t * @param {Node} node Node to start at.\r\n\t\t\t * @param {Node} root Root/ancestor element to stop just before.\r\n\t\t\t * @return {Node} Node just before the root element.\r\n\t\t\t */\r\n\t\t\tfunction findEndPoint(node, root) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (node.parentNode == root) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t} while (node);\r\n\t\t\t}\r\n\r\n\t\t\tfunction walkBoundary(start_node, end_node, next) {\r\n\t\t\t\tvar siblingName = next ? 'nextSibling' : 'previousSibling';\r\n\r\n\t\t\t\tfor (node = start_node, parent = node.parentNode; node && node != end_node; node = parent) {\r\n\t\t\t\t\tparent = node.parentNode;\r\n\t\t\t\t\tsiblings = collectSiblings(node == start_node ? node : node[siblingName], siblingName);\r\n\r\n\t\t\t\t\tif (siblings.length) {\r\n\t\t\t\t\t\tif (!next) {\r\n\t\t\t\t\t\t\tsiblings.reverse();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcallback(exclude(siblings));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If index based start position then resolve it\r\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\r\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset];\r\n\t\t\t}\r\n\r\n\t\t\t// If index based end position then resolve it\r\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\r\n\t\t\t\tendContainer = getEndChild(endContainer, endOffset);\r\n\t\t\t}\r\n\r\n\t\t\t// Same container\r\n\t\t\tif (startContainer == endContainer) {\r\n\t\t\t\treturn callback(exclude([startContainer]));\r\n\t\t\t}\r\n\r\n\t\t\t// Find common ancestor and end points\r\n\t\t\tancestor = dom.findCommonAncestor(startContainer, endContainer);\r\n\r\n\t\t\t// Process left side\r\n\t\t\tfor (node = startContainer; node; node = node.parentNode) {\r\n\t\t\t\tif (node === endContainer) {\r\n\t\t\t\t\treturn walkBoundary(startContainer, ancestor, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node === ancestor) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Process right side\r\n\t\t\tfor (node = endContainer; node; node = node.parentNode) {\r\n\t\t\t\tif (node === startContainer) {\r\n\t\t\t\t\treturn walkBoundary(endContainer, ancestor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node === ancestor) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Find start/end point\r\n\t\t\tstartPoint = findEndPoint(startContainer, ancestor) || startContainer;\r\n\t\t\tendPoint = findEndPoint(endContainer, ancestor) || endContainer;\r\n\r\n\t\t\t// Walk left leaf\r\n\t\t\twalkBoundary(startContainer, startPoint, true);\r\n\r\n\t\t\t// Walk the middle from start to end point\r\n\t\t\tsiblings = collectSiblings(\r\n\t\t\t\tstartPoint == startContainer ? startPoint : startPoint.nextSibling,\r\n\t\t\t\t'nextSibling',\r\n\t\t\t\tendPoint == endContainer ? endPoint.nextSibling : endPoint\r\n\t\t\t);\r\n\r\n\t\t\tif (siblings.length) {\r\n\t\t\t\tcallback(exclude(siblings));\r\n\t\t\t}\r\n\r\n\t\t\t// Walk right leaf\r\n\t\t\twalkBoundary(endContainer, endPoint);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Splits the specified range at it's start/end points.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Range/RangeObject} rng Range to split.\r\n\t\t * @return {Object} Range position object.\r\n\t\t */\r\n\t\tthis.split = function(rng) {\r\n\t\t\tvar startContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset;\r\n\r\n\t\t\tfunction splitText(node, offset) {\r\n\t\t\t\treturn node.splitText(offset);\r\n\t\t\t}\r\n\r\n\t\t\t// Handle single text node\r\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 3) {\r\n\t\t\t\tif (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\r\n\t\t\t\t\tendContainer = splitText(startContainer, startOffset);\r\n\t\t\t\t\tstartContainer = endContainer.previousSibling;\r\n\r\n\t\t\t\t\tif (endOffset > startOffset) {\r\n\t\t\t\t\t\tendOffset = endOffset - startOffset;\r\n\t\t\t\t\t\tstartContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\r\n\t\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tendOffset = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Split startContainer text node if needed\r\n\t\t\t\tif (startContainer.nodeType == 3 && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\r\n\t\t\t\t\tstartContainer = splitText(startContainer, startOffset);\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Split endContainer text node if needed\r\n\t\t\t\tif (endContainer.nodeType == 3 && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\r\n\t\t\t\t\tendContainer = splitText(endContainer, endOffset).previousSibling;\r\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tstartContainer: startContainer,\r\n\t\t\t\tstartOffset: startOffset,\r\n\t\t\t\tendContainer: endContainer,\r\n\t\t\t\tendOffset: endOffset\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Normalizes the specified range by finding the closest best suitable caret location.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Range} rng Range to normalize.\r\n\t\t * @return {Boolean} True/false if the specified range was normalized or not.\r\n\t\t */\r\n\t\tthis.normalize = function(rng) {\r\n\t\t\tvar normalized, collapsed;\r\n\r\n\t\t\tfunction normalizeEndPoint(start) {\r\n\t\t\t\tvar container, offset, walker, body = dom.getRoot(), node, nonEmptyElementsMap;\r\n\t\t\t\tvar directionLeft, isAfterNode;\r\n\r\n\t\t\t\tfunction isTableCell(node) {\r\n\t\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction hasBrBeforeAfter(node, left) {\r\n\t\t\t\t\tvar walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || body);\r\n\r\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\r\n\t\t\t\t\t\tif (node.nodeName === \"BR\") {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction hasContentEditableFalseParent(node) {\r\n\t\t\t\t\twhile (node && node != body) {\r\n\t\t\t\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction isPrevNode(node, name) {\r\n\t\t\t\t\treturn node.previousSibling && node.previousSibling.nodeName == name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Walks the dom left/right to find a suitable text node to move the endpoint into\r\n\t\t\t\t// It will only walk within the current parent block or body and will stop if it hits a block or a BR/IMG\r\n\t\t\t\tfunction findTextNodeRelative(left, startNode) {\r\n\t\t\t\t\tvar walker, lastInlineElement, parentBlockContainer;\r\n\r\n\t\t\t\t\tstartNode = startNode || container;\r\n\t\t\t\t\tparentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\r\n\r\n\t\t\t\t\t// Lean left before the BR element if it's the only BR within a block element. Gecko bug: #6680\r\n\t\t\t\t\t// This: <p><br>|</p> becomes <p>|<br></p>\r\n\t\t\t\t\tif (left && startNode.nodeName == 'BR' && isAfterNode && dom.isEmpty(parentBlockContainer)) {\r\n\t\t\t\t\t\tcontainer = startNode.parentNode;\r\n\t\t\t\t\t\toffset = dom.nodeIndex(startNode);\r\n\t\t\t\t\t\tnormalized = true;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Walk left until we hit a text node we can move to or a block/br/img\r\n\t\t\t\t\twalker = new TreeWalker(startNode, parentBlockContainer);\r\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\r\n\t\t\t\t\t\t// Break if we hit a non content editable node\r\n\t\t\t\t\t\tif (dom.getContentEditableParent(node) === \"false\" || isCaretContainer(node)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Found text node that has a length\r\n\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\r\n\t\t\t\t\t\t\tcontainer = node;\r\n\t\t\t\t\t\t\toffset = left ? node.nodeValue.length : 0;\r\n\t\t\t\t\t\t\tnormalized = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Break if we find a block or a BR/IMG/INPUT etc\r\n\t\t\t\t\t\tif (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlastInlineElement = node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Only fetch the last inline element when in caret mode for now\r\n\t\t\t\t\tif (collapsed && lastInlineElement) {\r\n\t\t\t\t\t\tcontainer = lastInlineElement;\r\n\t\t\t\t\t\tnormalized = true;\r\n\t\t\t\t\t\toffset = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer = rng[(start ? 'start' : 'end') + 'Container'];\r\n\t\t\t\toffset = rng[(start ? 'start' : 'end') + 'Offset'];\r\n\t\t\t\tisAfterNode = container.nodeType == 1 && offset === container.childNodes.length;\r\n\t\t\t\tnonEmptyElementsMap = dom.schema.getNonEmptyElements();\r\n\t\t\t\tdirectionLeft = start;\r\n\r\n\t\t\t\tif (isCaretContainer(container)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (container.nodeType == 1 && offset > container.childNodes.length - 1) {\r\n\t\t\t\t\tdirectionLeft = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the container is a document move it to the body element\r\n\t\t\t\tif (container.nodeType === 9) {\r\n\t\t\t\t\tcontainer = dom.getRoot();\r\n\t\t\t\t\toffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the container is body try move it into the closest text node or position\r\n\t\t\t\tif (container === body) {\r\n\t\t\t\t\t// If start is before/after a image, table etc\r\n\t\t\t\t\tif (directionLeft) {\r\n\t\t\t\t\t\tnode = container.childNodes[offset > 0 ? offset - 1 : 0];\r\n\t\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\t\tif (isCaretContainer(node)) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName] || node.nodeName == \"TABLE\") {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Resolve the index\r\n\t\t\t\t\tif (container.hasChildNodes()) {\r\n\t\t\t\t\t\toffset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\r\n\t\t\t\t\t\tcontainer = container.childNodes[offset];\r\n\t\t\t\t\t\toffset = 0;\r\n\r\n\t\t\t\t\t\t// Don't normalize non collapsed selections like <p>[a</p><table></table>]\r\n\t\t\t\t\t\tif (!collapsed && container === body.lastChild && container.nodeName === 'TABLE') {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasContentEditableFalseParent(container) || isCaretContainer(container)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Don't walk into elements that doesn't have any child nodes like a IMG\r\n\t\t\t\t\t\tif (container.hasChildNodes() && !/TABLE/.test(container.nodeName)) {\r\n\t\t\t\t\t\t\t// Walk the DOM to find a text node to place the caret at or a BR\r\n\t\t\t\t\t\t\tnode = container;\r\n\t\t\t\t\t\t\twalker = new TreeWalker(container, body);\r\n\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\tif (isContentEditableFalse(node) || isCaretContainer(node)) {\r\n\t\t\t\t\t\t\t\t\tnormalized = false;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Found a text node use that position\r\n\t\t\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\r\n\t\t\t\t\t\t\t\t\toffset = directionLeft ? 0 : node.nodeValue.length;\r\n\t\t\t\t\t\t\t\t\tcontainer = node;\r\n\t\t\t\t\t\t\t\t\tnormalized = true;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Found a BR/IMG element that we can place the caret before\r\n\t\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell(node)) {\r\n\t\t\t\t\t\t\t\t\toffset = dom.nodeIndex(node);\r\n\t\t\t\t\t\t\t\t\tcontainer = node.parentNode;\r\n\r\n\t\t\t\t\t\t\t\t\t// Put caret after image when moving the end point\r\n\t\t\t\t\t\t\t\t\tif (node.nodeName == \"IMG\" && !directionLeft) {\r\n\t\t\t\t\t\t\t\t\t\toffset++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tnormalized = true;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} while ((node = (directionLeft ? walker.next() : walker.prev())));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Lean the caret to the left if possible\r\n\t\t\t\tif (collapsed) {\r\n\t\t\t\t\t// So this: <b>x</b><i>|x</i>\r\n\t\t\t\t\t// Becomes: <b>x|</b><i>x</i>\r\n\t\t\t\t\t// Seems that only gecko has issues with this\r\n\t\t\t\t\tif (container.nodeType === 3 && offset === 0) {\r\n\t\t\t\t\t\tfindTextNodeRelative(true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Lean left into empty inline elements when the caret is before a BR\r\n\t\t\t\t\t// So this: <i><b></b><i>|<br></i>\r\n\t\t\t\t\t// Becomes: <i><b>|</b><i><br></i>\r\n\t\t\t\t\t// Seems that only gecko has issues with this.\r\n\t\t\t\t\t// Special edge case for <p><a>x</a>|<br></p> since we don't want <p><a>x|</a><br></p>\r\n\t\t\t\t\tif (container.nodeType === 1) {\r\n\t\t\t\t\t\tnode = container.childNodes[offset];\r\n\r\n\t\t\t\t\t\t// Offset is after the containers last child\r\n\t\t\t\t\t\t// then use the previous child for normalization\r\n\t\t\t\t\t\tif (!node) {\r\n\t\t\t\t\t\t\tnode = container.childNodes[offset - 1];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (node && node.nodeName === 'BR' && !isPrevNode(node, 'A') &&\r\n\t\t\t\t\t\t\t!hasBrBeforeAfter(node) && !hasBrBeforeAfter(node, true)) {\r\n\t\t\t\t\t\t\tfindTextNodeRelative(true, node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Lean the start of the selection right if possible\r\n\t\t\t\t// So this: x[<b>x]</b>\r\n\t\t\t\t// Becomes: x<b>[x]</b>\r\n\t\t\t\tif (directionLeft && !collapsed && container.nodeType === 3 && offset === container.nodeValue.length) {\r\n\t\t\t\t\tfindTextNodeRelative(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set endpoint if it was normalized\r\n\t\t\t\tif (normalized) {\r\n\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcollapsed = rng.collapsed;\r\n\r\n\t\t\tnormalizeEndPoint(true);\r\n\r\n\t\t\tif (!collapsed) {\r\n\t\t\t\tnormalizeEndPoint();\r\n\t\t\t}\r\n\r\n\t\t\t// If it was collapsed then make sure it still is\r\n\t\t\tif (normalized && collapsed) {\r\n\t\t\t\trng.collapse(true);\r\n\t\t\t}\r\n\r\n\t\t\treturn normalized;\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Compares two ranges and checks if they are equal.\r\n\t *\r\n\t * @static\r\n\t * @method compareRanges\r\n\t * @param {DOMRange} rng1 First range to compare.\r\n\t * @param {DOMRange} rng2 First range to compare.\r\n\t * @return {Boolean} true/false if the ranges are equal.\r\n\t */\r\n\tRangeUtils.compareRanges = function(rng1, rng2) {\r\n\t\tif (rng1 && rng2) {\r\n\t\t\t// Compare native IE ranges\r\n\t\t\tif (rng1.item || rng1.duplicate) {\r\n\t\t\t\t// Both are control ranges and the selected element matches\r\n\t\t\t\tif (rng1.item && rng2.item && rng1.item(0) === rng2.item(0)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Both are text ranges and the range matches\r\n\t\t\t\tif (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Compare w3c ranges\r\n\t\t\t\treturn rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\t/**\r\n\t * Finds the closest selection rect tries to get the range from that.\r\n\t */\r\n\tfunction findClosestIeRange(clientX, clientY, doc) {\r\n\t\tvar element, rng, rects;\r\n\r\n\t\telement = doc.elementFromPoint(clientX, clientY);\r\n\t\trng = doc.body.createTextRange();\r\n\r\n\t\tif (!element || element.tagName == 'HTML') {\r\n\t\t\telement = doc.body;\r\n\t\t}\r\n\r\n\t\trng.moveToElementText(element);\r\n\t\trects = Tools.toArray(rng.getClientRects());\r\n\r\n\t\trects = rects.sort(function(a, b) {\r\n\t\t\ta = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\r\n\t\t\tb = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\r\n\r\n\t\t\treturn a - b;\r\n\t\t});\r\n\r\n\t\tif (rects.length > 0) {\r\n\t\t\tclientY = (rects[0].bottom + rects[0].top) / 2;\r\n\r\n\t\t\ttry {\r\n\t\t\t\trng.moveToPoint(clientX, clientY);\r\n\t\t\t\trng.collapse(true);\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// At least we tried\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the caret range for the given x/y location.\r\n\t *\r\n\t * @static\r\n\t * @method getCaretRangeFromPoint\r\n\t * @param {Number} clientX X coordinate for range\r\n\t * @param {Number} clientY Y coordinate for range\r\n\t * @param {Document} doc Document that x/y are relative to\r\n\t * @returns {Range} caret range\r\n\t */\r\n\tRangeUtils.getCaretRangeFromPoint = function(clientX, clientY, doc) {\r\n\t\tvar rng, point;\r\n\r\n\t\tif (doc.caretPositionFromPoint) {\r\n\t\t\tpoint = doc.caretPositionFromPoint(clientX, clientY);\r\n\t\t\trng = doc.createRange();\r\n\t\t\trng.setStart(point.offsetNode, point.offset);\r\n\t\t\trng.collapse(true);\r\n\t\t} else if (doc.caretRangeFromPoint) {\r\n\t\t\trng = doc.caretRangeFromPoint(clientX, clientY);\r\n\t\t} else if (doc.body.createTextRange) {\r\n\t\t\trng = doc.body.createTextRange();\r\n\r\n\t\t\ttry {\r\n\t\t\t\trng.moveToPoint(clientX, clientY);\r\n\t\t\t\trng.collapse(true);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\trng = findClosestIeRange(clientX, clientY, doc);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn rng;\r\n\t};\r\n\r\n\tRangeUtils.getSelectedNode = function(range) {\r\n\t\tvar startContainer = range.startContainer,\r\n\t\t\tstartOffset = range.startOffset;\r\n\r\n\t\tif (startContainer.hasChildNodes() && range.endOffset == startOffset + 1) {\r\n\t\t\treturn startContainer.childNodes[startOffset];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t};\r\n\r\n\tRangeUtils.getNode = function(container, offset) {\r\n\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\r\n\t\t\tif (offset >= container.childNodes.length) {\r\n\t\t\t\toffset = container.childNodes.length - 1;\r\n\t\t\t}\r\n\r\n\t\t\tcontainer = container.childNodes[offset];\r\n\t\t}\r\n\r\n\t\treturn container;\r\n\t};\r\n\r\n\treturn RangeUtils;\r\n});\r\n\r\n// Included from: js/tinymce/classes/NodeChange.js\r\n\r\n/**\r\n * NodeChange.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles the nodechange event dispatching both manual and through selection change events.\r\n *\r\n * @class tinymce.NodeChange\r\n * @private\r\n */\r\ndefine(\"tinymce/NodeChange\", [\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Delay\"\r\n], function(RangeUtils, Env, Delay) {\r\n\treturn function(editor) {\r\n\t\tvar lastRng, lastPath = [];\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the current element path has been changed or not.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @return {Boolean} True if the element path is the same false if it's not.\r\n\t\t */\r\n\t\tfunction isSameElementPath(startElm) {\r\n\t\t\tvar i, currentPath;\r\n\r\n\t\t\tcurrentPath = editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);\r\n\t\t\tif (currentPath.length === lastPath.length) {\r\n\t\t\t\tfor (i = currentPath.length; i >= 0; i--) {\r\n\t\t\t\t\tif (currentPath[i] !== lastPath[i]) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (i === -1) {\r\n\t\t\t\t\tlastPath = currentPath;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlastPath = currentPath;\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Gecko doesn't support the \"selectionchange\" event\r\n\t\tif (!('onselectionchange' in editor.getDoc())) {\r\n\t\t\teditor.on('NodeChange Click MouseUp KeyUp Focus', function(e) {\r\n\t\t\t\tvar nativeRng, fakeRng;\r\n\r\n\t\t\t\t// Since DOM Ranges mutate on modification\r\n\t\t\t\t// of the DOM we need to clone it's contents\r\n\t\t\t\tnativeRng = editor.selection.getRng();\r\n\t\t\t\tfakeRng = {\r\n\t\t\t\t\tstartContainer: nativeRng.startContainer,\r\n\t\t\t\t\tstartOffset: nativeRng.startOffset,\r\n\t\t\t\t\tendContainer: nativeRng.endContainer,\r\n\t\t\t\t\tendOffset: nativeRng.endOffset\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Always treat nodechange as a selectionchange since applying\r\n\t\t\t\t// formatting to the current range wouldn't update the range but it's parent\r\n\t\t\t\tif (e.type == 'nodechange' || !RangeUtils.compareRanges(fakeRng, lastRng)) {\r\n\t\t\t\t\teditor.fire('SelectionChange');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastRng = fakeRng;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// IE has a bug where it fires a selectionchange on right click that has a range at the start of the body\r\n\t\t// When the contextmenu event fires the selection is located at the right location\r\n\t\teditor.on('contextmenu', function() {\r\n\t\t\teditor.fire('SelectionChange');\r\n\t\t});\r\n\r\n\t\t// Selection change is delayed ~200ms on IE when you click inside the current range\r\n\t\teditor.on('SelectionChange', function() {\r\n\t\t\tvar startElm = editor.selection.getStart(true);\r\n\r\n\t\t\t// IE 8 will fire a selectionchange event with an incorrect selection\r\n\t\t\t// when focusing out of table cells. Click inside cell -> toolbar = Invalid SelectionChange event\r\n\t\t\tif (!Env.range && editor.selection.isCollapsed()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\r\n\t\t\t\teditor.nodeChanged({selectionChange: true});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Fire an extra nodeChange on mouseup for compatibility reasons\r\n\t\teditor.on('MouseUp', function(e) {\r\n\t\t\tif (!e.isDefaultPrevented()) {\r\n\t\t\t\t// Delay nodeChanged call for WebKit edge case issue where the range\r\n\t\t\t\t// isn't updated until after you click outside a selected image\r\n\t\t\t\tif (editor.selection.getNode().nodeName == 'IMG') {\r\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\r\n\t\t * need to update the UI states or element path etc.\r\n\t\t *\r\n\t\t * @method nodeChanged\r\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\r\n\t\t */\r\n\t\tthis.nodeChanged = function(args) {\r\n\t\t\tvar selection = editor.selection, node, parents, root;\r\n\r\n\t\t\t// Fix for bug #1896577 it seems that this can not be fired while the editor is loading\r\n\t\t\tif (editor.initialized && selection && !editor.settings.disable_nodechange && !editor.readonly) {\r\n\t\t\t\t// Get start node\r\n\t\t\t\troot = editor.getBody();\r\n\t\t\t\tnode = selection.getStart() || root;\r\n\r\n\t\t\t\t// Make sure the node is within the editor root or is the editor root\r\n\t\t\t\tif (node.ownerDocument != editor.getDoc() || !editor.dom.isChildOf(node, root)) {\r\n\t\t\t\t\tnode = root;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Edge case for <p>|<img></p>\r\n\t\t\t\tif (node.nodeName == 'IMG' && selection.isCollapsed()) {\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get parents and add them to object\r\n\t\t\t\tparents = [];\r\n\t\t\t\teditor.dom.getParent(node, function(node) {\r\n\t\t\t\t\tif (node === root) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tparents.push(node);\r\n\t\t\t\t});\r\n\r\n\t\t\t\targs = args || {};\r\n\t\t\t\targs.element = node;\r\n\t\t\t\targs.parents = parents;\r\n\r\n\t\t\t\teditor.fire('NodeChange', args);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/Node.js\r\n\r\n/**\r\n * Node.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is a minimalistic implementation of a DOM like node used by the DomParser class.\r\n *\r\n * @example\r\n * var node = new tinymce.html.Node('strong', 1);\r\n * someRoot.append(node);\r\n *\r\n * @class tinymce.html.Node\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/Node\", [], function() {\r\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/, typeLookup = {\r\n\t\t'#text': 3,\r\n\t\t'#comment': 8,\r\n\t\t'#cdata': 4,\r\n\t\t'#pi': 7,\r\n\t\t'#doctype': 10,\r\n\t\t'#document-fragment': 11\r\n\t};\r\n\r\n\t// Walks the tree left/right\r\n\tfunction walk(node, root_node, prev) {\r\n\t\tvar sibling, parent, startName = prev ? 'lastChild' : 'firstChild', siblingName = prev ? 'prev' : 'next';\r\n\r\n\t\t// Walk into nodes if it has a start\r\n\t\tif (node[startName]) {\r\n\t\t\treturn node[startName];\r\n\t\t}\r\n\r\n\t\t// Return the sibling if it has one\r\n\t\tif (node !== root_node) {\r\n\t\t\tsibling = node[siblingName];\r\n\r\n\t\t\tif (sibling) {\r\n\t\t\t\treturn sibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Walk up the parents to look for siblings\r\n\t\t\tfor (parent = node.parent; parent && parent !== root_node; parent = parent.parent) {\r\n\t\t\t\tsibling = parent[siblingName];\r\n\r\n\t\t\t\tif (sibling) {\r\n\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Constructs a new Node instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method Node\r\n\t * @param {String} name Name of the node type.\r\n\t * @param {Number} type Numeric type representing the node.\r\n\t */\r\n\tfunction Node(name, type) {\r\n\t\tthis.name = name;\r\n\t\tthis.type = type;\r\n\r\n\t\tif (type === 1) {\r\n\t\t\tthis.attributes = [];\r\n\t\t\tthis.attributes.map = {};\r\n\t\t}\r\n\t}\r\n\r\n\tNode.prototype = {\r\n\t\t/**\r\n\t\t * Replaces the current node with the specified one.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * someNode.replace(someNewNode);\r\n\t\t *\r\n\t\t * @method replace\r\n\t\t * @param {tinymce.html.Node} node Node to replace the current node with.\r\n\t\t * @return {tinymce.html.Node} The old node that got replaced.\r\n\t\t */\r\n\t\treplace: function(node) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (node.parent) {\r\n\t\t\t\tnode.remove();\r\n\t\t\t}\r\n\r\n\t\t\tself.insert(node, self);\r\n\t\t\tself.remove();\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Gets/sets or removes an attribute by name.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * someNode.attr(\"name\", \"value\"); // Sets an attribute\r\n\t\t * console.log(someNode.attr(\"name\")); // Gets an attribute\r\n\t\t * someNode.attr(\"name\", null); // Removes an attribute\r\n\t\t *\r\n\t\t * @method attr\r\n\t\t * @param {String} name Attribute name to set or get.\r\n\t\t * @param {String} value Optional value to set.\r\n\t\t * @return {String/tinymce.html.Node} String or undefined on a get operation or the current node on a set operation.\r\n\t\t */\r\n\t\tattr: function(name, value) {\r\n\t\t\tvar self = this, attrs, i, undef;\r\n\r\n\t\t\tif (typeof name !== \"string\") {\r\n\t\t\t\tfor (i in name) {\r\n\t\t\t\t\tself.attr(i, name[i]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\tif ((attrs = self.attributes)) {\r\n\t\t\t\tif (value !== undef) {\r\n\t\t\t\t\t// Remove attribute\r\n\t\t\t\t\tif (value === null) {\r\n\t\t\t\t\t\tif (name in attrs.map) {\r\n\t\t\t\t\t\t\tdelete attrs.map[name];\r\n\r\n\t\t\t\t\t\t\ti = attrs.length;\r\n\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\tif (attrs[i].name === name) {\r\n\t\t\t\t\t\t\t\t\tattrs = attrs.splice(i, 1);\r\n\t\t\t\t\t\t\t\t\treturn self;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn self;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Set attribute\r\n\t\t\t\t\tif (name in attrs.map) {\r\n\t\t\t\t\t\t// Set attribute\r\n\t\t\t\t\t\ti = attrs.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tif (attrs[i].name === name) {\r\n\t\t\t\t\t\t\t\tattrs[i].value = value;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tattrs.push({name: name, value: value});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tattrs.map[name] = value;\r\n\r\n\t\t\t\t\treturn self;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn attrs.map[name];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Does a shallow clones the node into a new node. It will also exclude id attributes since\r\n\t\t * there should only be one id per document.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * var clonedNode = node.clone();\r\n\t\t *\r\n\t\t * @method clone\r\n\t\t * @return {tinymce.html.Node} New copy of the original node.\r\n\t\t */\r\n\t\tclone: function() {\r\n\t\t\tvar self = this, clone = new Node(self.name, self.type), i, l, selfAttrs, selfAttr, cloneAttrs;\r\n\r\n\t\t\t// Clone element attributes\r\n\t\t\tif ((selfAttrs = self.attributes)) {\r\n\t\t\t\tcloneAttrs = [];\r\n\t\t\t\tcloneAttrs.map = {};\r\n\r\n\t\t\t\tfor (i = 0, l = selfAttrs.length; i < l; i++) {\r\n\t\t\t\t\tselfAttr = selfAttrs[i];\r\n\r\n\t\t\t\t\t// Clone everything except id\r\n\t\t\t\t\tif (selfAttr.name !== 'id') {\r\n\t\t\t\t\t\tcloneAttrs[cloneAttrs.length] = {name: selfAttr.name, value: selfAttr.value};\r\n\t\t\t\t\t\tcloneAttrs.map[selfAttr.name] = selfAttr.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclone.attributes = cloneAttrs;\r\n\t\t\t}\r\n\r\n\t\t\tclone.value = self.value;\r\n\t\t\tclone.shortEnded = self.shortEnded;\r\n\r\n\t\t\treturn clone;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Wraps the node in in another node.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * node.wrap(wrapperNode);\r\n\t\t *\r\n\t\t * @method wrap\r\n\t\t */\r\n\t\twrap: function(wrapper) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.parent.insert(wrapper, self);\r\n\t\t\twrapper.append(self);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unwraps the node in other words it removes the node but keeps the children.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * node.unwrap();\r\n\t\t *\r\n\t\t * @method unwrap\r\n\t\t */\r\n\t\tunwrap: function() {\r\n\t\t\tvar self = this, node, next;\r\n\r\n\t\t\tfor (node = self.firstChild; node;) {\r\n\t\t\t\tnext = node.next;\r\n\t\t\t\tself.insert(node, self, true);\r\n\t\t\t\tnode = next;\r\n\t\t\t}\r\n\r\n\t\t\tself.remove();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the node from it's parent.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * node.remove();\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @return {tinymce.html.Node} Current node that got removed.\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tvar self = this, parent = self.parent, next = self.next, prev = self.prev;\r\n\r\n\t\t\tif (parent) {\r\n\t\t\t\tif (parent.firstChild === self) {\r\n\t\t\t\t\tparent.firstChild = next;\r\n\r\n\t\t\t\t\tif (next) {\r\n\t\t\t\t\t\tnext.prev = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprev.next = next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parent.lastChild === self) {\r\n\t\t\t\t\tparent.lastChild = prev;\r\n\r\n\t\t\t\t\tif (prev) {\r\n\t\t\t\t\t\tprev.next = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext.prev = prev;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.parent = self.next = self.prev = null;\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Appends a new node as a child of the current node.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * node.append(someNode);\r\n\t\t *\r\n\t\t * @method append\r\n\t\t * @param {tinymce.html.Node} node Node to append as a child of the current one.\r\n\t\t * @return {tinymce.html.Node} The node that got appended.\r\n\t\t */\r\n\t\tappend: function(node) {\r\n\t\t\tvar self = this, last;\r\n\r\n\t\t\tif (node.parent) {\r\n\t\t\t\tnode.remove();\r\n\t\t\t}\r\n\r\n\t\t\tlast = self.lastChild;\r\n\t\t\tif (last) {\r\n\t\t\t\tlast.next = node;\r\n\t\t\t\tnode.prev = last;\r\n\t\t\t\tself.lastChild = node;\r\n\t\t\t} else {\r\n\t\t\t\tself.lastChild = self.firstChild = node;\r\n\t\t\t}\r\n\r\n\t\t\tnode.parent = self;\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Inserts a node at a specific position as a child of the current node.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * parentNode.insert(newChildNode, oldChildNode);\r\n\t\t *\r\n\t\t * @method insert\r\n\t\t * @param {tinymce.html.Node} node Node to insert as a child of the current node.\r\n\t\t * @param {tinymce.html.Node} ref_node Reference node to set node before/after.\r\n\t\t * @param {Boolean} before Optional state to insert the node before the reference node.\r\n\t\t * @return {tinymce.html.Node} The node that got inserted.\r\n\t\t */\r\n\t\tinsert: function(node, ref_node, before) {\r\n\t\t\tvar parent;\r\n\r\n\t\t\tif (node.parent) {\r\n\t\t\t\tnode.remove();\r\n\t\t\t}\r\n\r\n\t\t\tparent = ref_node.parent || this;\r\n\r\n\t\t\tif (before) {\r\n\t\t\t\tif (ref_node === parent.firstChild) {\r\n\t\t\t\t\tparent.firstChild = node;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tref_node.prev.next = node;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode.prev = ref_node.prev;\r\n\t\t\t\tnode.next = ref_node;\r\n\t\t\t\tref_node.prev = node;\r\n\t\t\t} else {\r\n\t\t\t\tif (ref_node === parent.lastChild) {\r\n\t\t\t\t\tparent.lastChild = node;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tref_node.next.prev = node;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode.next = ref_node.next;\r\n\t\t\t\tnode.prev = ref_node;\r\n\t\t\t\tref_node.next = node;\r\n\t\t\t}\r\n\r\n\t\t\tnode.parent = parent;\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get all children by name.\r\n\t\t *\r\n\t\t * @method getAll\r\n\t\t * @param {String} name Name of the child nodes to collect.\r\n\t\t * @return {Array} Array with child nodes matchin the specified name.\r\n\t\t */\r\n\t\tgetAll: function(name) {\r\n\t\t\tvar self = this, node, collection = [];\r\n\r\n\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\r\n\t\t\t\tif (node.name === name) {\r\n\t\t\t\t\tcollection.push(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn collection;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes all children of the current node.\r\n\t\t *\r\n\t\t * @method empty\r\n\t\t * @return {tinymce.html.Node} The current node that got cleared.\r\n\t\t */\r\n\t\tempty: function() {\r\n\t\t\tvar self = this, nodes, i, node;\r\n\r\n\t\t\t// Remove all children\r\n\t\t\tif (self.firstChild) {\r\n\t\t\t\tnodes = [];\r\n\r\n\t\t\t\t// Collect the children\r\n\t\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\r\n\t\t\t\t\tnodes.push(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove the children\r\n\t\t\t\ti = nodes.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tnode.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.firstChild = self.lastChild = null;\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the node is to be considered empty or not.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * node.isEmpty({img: true});\r\n\t\t * @method isEmpty\r\n\t\t * @param {Object} elements Name/value object with elements that are automatically treated as non empty elements.\r\n\t\t * @return {Boolean} true/false if the node is empty or not.\r\n\t\t */\r\n\t\tisEmpty: function(elements) {\r\n\t\t\tvar self = this, node = self.firstChild, i, name;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (node.type === 1) {\r\n\t\t\t\t\t\t// Ignore bogus elements\r\n\t\t\t\t\t\tif (node.attributes.map['data-mce-bogus']) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Keep empty elements like <img />\r\n\t\t\t\t\t\tif (elements[node.name]) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Keep bookmark nodes and name attribute like <a name=\"1\"></a>\r\n\t\t\t\t\t\ti = node.attributes.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tname = node.attributes[i].name;\r\n\t\t\t\t\t\t\tif (name === \"name\" || name.indexOf('data-mce-bookmark') === 0) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Keep comments\r\n\t\t\t\t\tif (node.type === 8) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Keep non whitespace text nodes\r\n\t\t\t\t\tif ((node.type === 3 && !whiteSpaceRegExp.test(node.value))) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} while ((node = walk(node, self)));\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Walks to the next or previous node and returns that node or null if it wasn't found.\r\n\t\t *\r\n\t\t * @method walk\r\n\t\t * @param {Boolean} prev Optional previous node state defaults to false.\r\n\t\t * @return {tinymce.html.Node} Node that is next to or previous of the current node.\r\n\t\t */\r\n\t\twalk: function(prev) {\r\n\t\t\treturn walk(this, null, prev);\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Creates a node of a specific type.\r\n\t *\r\n\t * @static\r\n\t * @method create\r\n\t * @param {String} name Name of the node type to create for example \"b\" or \"#text\".\r\n\t * @param {Object} attrs Name/value collection of attributes that will be applied to elements.\r\n\t */\r\n\tNode.create = function(name, attrs) {\r\n\t\tvar node, attrName;\r\n\r\n\t\t// Create node\r\n\t\tnode = new Node(name, typeLookup[name] || 1);\r\n\r\n\t\t// Add attributes if needed\r\n\t\tif (attrs) {\r\n\t\t\tfor (attrName in attrs) {\r\n\t\t\t\tnode.attr(attrName, attrs[attrName]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t};\r\n\r\n\treturn Node;\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/Schema.js\r\n\r\n/**\r\n * Schema.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Schema validator class.\r\n *\r\n * @class tinymce.html.Schema\r\n * @example\r\n *  if (tinymce.activeEditor.schema.isValidChild('p', 'span'))\r\n *    alert('span is valid child of p.');\r\n *\r\n *  if (tinymce.activeEditor.schema.getElementRule('p'))\r\n *    alert('P is a valid element.');\r\n *\r\n * @class tinymce.html.Schema\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/Schema\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\tvar mapCache = {}, dummyObj = {};\r\n\tvar makeMap = Tools.makeMap, each = Tools.each, extend = Tools.extend, explode = Tools.explode, inArray = Tools.inArray;\r\n\r\n\tfunction split(items, delim) {\r\n\t\treturn items ? items.split(delim || ' ') : [];\r\n\t}\r\n\r\n\t/**\r\n\t * Builds a schema lookup table\r\n\t *\r\n\t * @private\r\n\t * @param {String} type html4, html5 or html5-strict schema type.\r\n\t * @return {Object} Schema lookup table.\r\n\t */\r\n\tfunction compileSchema(type) {\r\n\t\tvar schema = {}, globalAttributes, blockContent;\r\n\t\tvar phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\r\n\r\n\t\tfunction add(name, attributes, children) {\r\n\t\t\tvar ni, i, attributesOrder, args = arguments;\r\n\r\n\t\t\tfunction arrayToMap(array, obj) {\r\n\t\t\t\tvar map = {}, i, l;\r\n\r\n\t\t\t\tfor (i = 0, l = array.length; i < l; i++) {\r\n\t\t\t\t\tmap[array[i]] = obj || {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn map;\r\n\t\t\t}\r\n\r\n\t\t\tchildren = children || [];\r\n\t\t\tattributes = attributes || \"\";\r\n\r\n\t\t\tif (typeof children === \"string\") {\r\n\t\t\t\tchildren = split(children);\r\n\t\t\t}\r\n\r\n\t\t\t// Split string children\r\n\t\t\tfor (i = 3; i < args.length; i++) {\r\n\t\t\t\tif (typeof args[i] === \"string\") {\r\n\t\t\t\t\targs[i] = split(args[i]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchildren.push.apply(children, args[i]);\r\n\t\t\t}\r\n\r\n\t\t\tname = split(name);\r\n\t\t\tni = name.length;\r\n\t\t\twhile (ni--) {\r\n\t\t\t\tattributesOrder = [].concat(globalAttributes, split(attributes));\r\n\t\t\t\tschema[name[ni]] = {\r\n\t\t\t\t\tattributes: arrayToMap(attributesOrder),\r\n\t\t\t\t\tattributesOrder: attributesOrder,\r\n\t\t\t\t\tchildren: arrayToMap(children, dummyObj)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction addAttrs(name, attributes) {\r\n\t\t\tvar ni, schemaItem, i, l;\r\n\r\n\t\t\tname = split(name);\r\n\t\t\tni = name.length;\r\n\t\t\tattributes = split(attributes);\r\n\t\t\twhile (ni--) {\r\n\t\t\t\tschemaItem = schema[name[ni]];\r\n\t\t\t\tfor (i = 0, l = attributes.length; i < l; i++) {\r\n\t\t\t\t\tschemaItem.attributes[attributes[i]] = {};\r\n\t\t\t\t\tschemaItem.attributesOrder.push(attributes[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Use cached schema\r\n\t\tif (mapCache[type]) {\r\n\t\t\treturn mapCache[type];\r\n\t\t}\r\n\r\n\t\t// Attributes present on all elements\r\n\t\tglobalAttributes = split(\"id accesskey class dir lang style tabindex title\");\r\n\r\n\t\t// Event attributes can be opt-in/opt-out\r\n\t\t/*eventAttributes = split(\"onabort onblur oncancel oncanplay oncanplaythrough onchange onclick onclose oncontextmenu oncuechange \" +\r\n\t\t\t\t\"ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended \" +\r\n\t\t\t\t\"onerror onfocus oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart \" +\r\n\t\t\t\t\"onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onpause onplay onplaying onprogress onratechange \" +\r\n\t\t\t\t\"onreset onscroll onseeked onseeking onseeking onselect onshow onstalled onsubmit onsuspend ontimeupdate onvolumechange \" +\r\n\t\t\t\t\"onwaiting\"\r\n\t\t);*/\r\n\r\n\t\t// Block content elements\r\n\t\tblockContent = split(\r\n\t\t\t\"address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul\"\r\n\t\t);\r\n\r\n\t\t// Phrasing content elements from the HTML5 spec (inline)\r\n\t\tphrasingContent = split(\r\n\t\t\t\"a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd \" +\r\n\t\t\t\"label map noscript object q s samp script select small span strong sub sup \" +\r\n\t\t\t\"textarea u var #text #comment\"\r\n\t\t);\r\n\r\n\t\t// Add HTML5 items to globalAttributes, blockContent, phrasingContent\r\n\t\tif (type != \"html4\") {\r\n\t\t\tglobalAttributes.push.apply(globalAttributes, split(\"contenteditable contextmenu draggable dropzone \" +\r\n\t\t\t\t\"hidden spellcheck translate\"));\r\n\t\t\tblockContent.push.apply(blockContent, split(\"article aside details dialog figure header footer hgroup section nav\"));\r\n\t\t\tphrasingContent.push.apply(phrasingContent, split(\"audio canvas command datalist mark meter output picture \" +\r\n\t\t\t\t\"progress time wbr video ruby bdi keygen\"));\r\n\t\t}\r\n\r\n\t\t// Add HTML4 elements unless it's html5-strict\r\n\t\tif (type != \"html5-strict\") {\r\n\t\t\tglobalAttributes.push(\"xml:lang\");\r\n\r\n\t\t\thtml4PhrasingContent = split(\"acronym applet basefont big font strike tt\");\r\n\t\t\tphrasingContent.push.apply(phrasingContent, html4PhrasingContent);\r\n\r\n\t\t\teach(html4PhrasingContent, function(name) {\r\n\t\t\t\tadd(name, \"\", phrasingContent);\r\n\t\t\t});\r\n\r\n\t\t\thtml4BlockContent = split(\"center dir isindex noframes\");\r\n\t\t\tblockContent.push.apply(blockContent, html4BlockContent);\r\n\r\n\t\t\t// Flow content elements from the HTML5 spec (block+inline)\r\n\t\t\tflowContent = [].concat(blockContent, phrasingContent);\r\n\r\n\t\t\teach(html4BlockContent, function(name) {\r\n\t\t\t\tadd(name, \"\", flowContent);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Flow content elements from the HTML5 spec (block+inline)\r\n\t\tflowContent = flowContent || [].concat(blockContent, phrasingContent);\r\n\r\n\t\t// HTML4 base schema TODO: Move HTML5 specific attributes to HTML5 specific if statement\r\n\t\t// Schema items <element name>, <specific attributes>, <children ..>\r\n\t\tadd(\"html\", \"manifest\", \"head body\");\r\n\t\tadd(\"head\", \"\", \"base command link meta noscript script style title\");\r\n\t\tadd(\"title hr noscript br\");\r\n\t\tadd(\"base\", \"href target\");\r\n\t\tadd(\"link\", \"href rel media hreflang type sizes hreflang\");\r\n\t\tadd(\"meta\", \"name http-equiv content charset\");\r\n\t\tadd(\"style\", \"media type scoped\");\r\n\t\tadd(\"script\", \"src async defer type charset\");\r\n\t\tadd(\"body\", \"onafterprint onbeforeprint onbeforeunload onblur onerror onfocus \" +\r\n\t\t\t\t\"onhashchange onload onmessage onoffline ononline onpagehide onpageshow \" +\r\n\t\t\t\t\"onpopstate onresize onscroll onstorage onunload\", flowContent);\r\n\t\tadd(\"address dt dd div caption\", \"\", flowContent);\r\n\t\tadd(\"h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn\", \"\", phrasingContent);\r\n\t\tadd(\"blockquote\", \"cite\", flowContent);\r\n\t\tadd(\"ol\", \"reversed start type\", \"li\");\r\n\t\tadd(\"ul\", \"\", \"li\");\r\n\t\tadd(\"li\", \"value\", flowContent);\r\n\t\tadd(\"dl\", \"\", \"dt dd\");\r\n\t\tadd(\"a\", \"href target rel media hreflang type\", phrasingContent);\r\n\t\tadd(\"q\", \"cite\", phrasingContent);\r\n\t\tadd(\"ins del\", \"cite datetime\", flowContent);\r\n\t\tadd(\"img\", \"src sizes srcset alt usemap ismap width height\");\r\n\t\tadd(\"iframe\", \"src name width height\", flowContent);\r\n\t\tadd(\"embed\", \"src type width height\");\r\n\t\tadd(\"object\", \"data type typemustmatch name usemap form width height\", flowContent, \"param\");\r\n\t\tadd(\"param\", \"name value\");\r\n\t\tadd(\"map\", \"name\", flowContent, \"area\");\r\n\t\tadd(\"area\", \"alt coords shape href target rel media hreflang type\");\r\n\t\tadd(\"table\", \"border\", \"caption colgroup thead tfoot tbody tr\" + (type == \"html4\" ? \" col\" : \"\"));\r\n\t\tadd(\"colgroup\", \"span\", \"col\");\r\n\t\tadd(\"col\", \"span\");\r\n\t\tadd(\"tbody thead tfoot\", \"\", \"tr\");\r\n\t\tadd(\"tr\", \"\", \"td th\");\r\n\t\tadd(\"td\", \"colspan rowspan headers\", flowContent);\r\n\t\tadd(\"th\", \"colspan rowspan headers scope abbr\", flowContent);\r\n\t\tadd(\"form\", \"accept-charset action autocomplete enctype method name novalidate target\", flowContent);\r\n\t\tadd(\"fieldset\", \"disabled form name\", flowContent, \"legend\");\r\n\t\tadd(\"label\", \"form for\", phrasingContent);\r\n\t\tadd(\"input\", \"accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate \" +\r\n\t\t\t\t\"formtarget height list max maxlength min multiple name pattern readonly required size src step type value width\"\r\n\t\t);\r\n\t\tadd(\"button\", \"disabled form formaction formenctype formmethod formnovalidate formtarget name type value\",\r\n\t\t\ttype == \"html4\" ? flowContent : phrasingContent);\r\n\t\tadd(\"select\", \"disabled form multiple name required size\", \"option optgroup\");\r\n\t\tadd(\"optgroup\", \"disabled label\", \"option\");\r\n\t\tadd(\"option\", \"disabled label selected value\");\r\n\t\tadd(\"textarea\", \"cols dirname disabled form maxlength name readonly required rows wrap\");\r\n\t\tadd(\"menu\", \"type label\", flowContent, \"li\");\r\n\t\tadd(\"noscript\", \"\", flowContent);\r\n\r\n\t\t// Extend with HTML5 elements\r\n\t\tif (type != \"html4\") {\r\n\t\t\tadd(\"wbr\");\r\n\t\t\tadd(\"ruby\", \"\", phrasingContent, \"rt rp\");\r\n\t\t\tadd(\"figcaption\", \"\", flowContent);\r\n\t\t\tadd(\"mark rt rp summary bdi\", \"\", phrasingContent);\r\n\t\t\tadd(\"canvas\", \"width height\", flowContent);\r\n\t\t\tadd(\"video\", \"src crossorigin poster preload autoplay mediagroup loop \" +\r\n\t\t\t\t\"muted controls width height buffered\", flowContent, \"track source\");\r\n\t\t\tadd(\"audio\", \"src crossorigin preload autoplay mediagroup loop muted controls buffered volume\", flowContent, \"track source\");\r\n\t\t\tadd(\"picture\", \"\", \"img source\");\r\n\t\t\tadd(\"source\", \"src srcset type media sizes\");\r\n\t\t\tadd(\"track\", \"kind src srclang label default\");\r\n\t\t\tadd(\"datalist\", \"\", phrasingContent, \"option\");\r\n\t\t\tadd(\"article section nav aside header footer\", \"\", flowContent);\r\n\t\t\tadd(\"hgroup\", \"\", \"h1 h2 h3 h4 h5 h6\");\r\n\t\t\tadd(\"figure\", \"\", flowContent, \"figcaption\");\r\n\t\t\tadd(\"time\", \"datetime\", phrasingContent);\r\n\t\t\tadd(\"dialog\", \"open\", flowContent);\r\n\t\t\tadd(\"command\", \"type label icon disabled checked radiogroup command\");\r\n\t\t\tadd(\"output\", \"for form name\", phrasingContent);\r\n\t\t\tadd(\"progress\", \"value max\", phrasingContent);\r\n\t\t\tadd(\"meter\", \"value min max low high optimum\", phrasingContent);\r\n\t\t\tadd(\"details\", \"open\", flowContent, \"summary\");\r\n\t\t\tadd(\"keygen\", \"autofocus challenge disabled form keytype name\");\r\n\t\t}\r\n\r\n\t\t// Extend with HTML4 attributes unless it's html5-strict\r\n\t\tif (type != \"html5-strict\") {\r\n\t\t\taddAttrs(\"script\", \"language xml:space\");\r\n\t\t\taddAttrs(\"style\", \"xml:space\");\r\n\t\t\taddAttrs(\"object\", \"declare classid code codebase codetype archive standby align border hspace vspace\");\r\n\t\t\taddAttrs(\"embed\", \"align name hspace vspace\");\r\n\t\t\taddAttrs(\"param\", \"valuetype type\");\r\n\t\t\taddAttrs(\"a\", \"charset name rev shape coords\");\r\n\t\t\taddAttrs(\"br\", \"clear\");\r\n\t\t\taddAttrs(\"applet\", \"codebase archive code object alt name width height align hspace vspace\");\r\n\t\t\taddAttrs(\"img\", \"name longdesc align border hspace vspace\");\r\n\t\t\taddAttrs(\"iframe\", \"longdesc frameborder marginwidth marginheight scrolling align\");\r\n\t\t\taddAttrs(\"font basefont\", \"size color face\");\r\n\t\t\taddAttrs(\"input\", \"usemap align\");\r\n\t\t\taddAttrs(\"select\", \"onchange\");\r\n\t\t\taddAttrs(\"textarea\");\r\n\t\t\taddAttrs(\"h1 h2 h3 h4 h5 h6 div p legend caption\", \"align\");\r\n\t\t\taddAttrs(\"ul\", \"type compact\");\r\n\t\t\taddAttrs(\"li\", \"type\");\r\n\t\t\taddAttrs(\"ol dl menu dir\", \"compact\");\r\n\t\t\taddAttrs(\"pre\", \"width xml:space\");\r\n\t\t\taddAttrs(\"hr\", \"align noshade size width\");\r\n\t\t\taddAttrs(\"isindex\", \"prompt\");\r\n\t\t\taddAttrs(\"table\", \"summary width frame rules cellspacing cellpadding align bgcolor\");\r\n\t\t\taddAttrs(\"col\", \"width align char charoff valign\");\r\n\t\t\taddAttrs(\"colgroup\", \"width align char charoff valign\");\r\n\t\t\taddAttrs(\"thead\", \"align char charoff valign\");\r\n\t\t\taddAttrs(\"tr\", \"align char charoff valign bgcolor\");\r\n\t\t\taddAttrs(\"th\", \"axis align char charoff valign nowrap bgcolor width height\");\r\n\t\t\taddAttrs(\"form\", \"accept\");\r\n\t\t\taddAttrs(\"td\", \"abbr axis scope align char charoff valign nowrap bgcolor width height\");\r\n\t\t\taddAttrs(\"tfoot\", \"align char charoff valign\");\r\n\t\t\taddAttrs(\"tbody\", \"align char charoff valign\");\r\n\t\t\taddAttrs(\"area\", \"nohref\");\r\n\t\t\taddAttrs(\"body\", \"background bgcolor text link vlink alink\");\r\n\t\t}\r\n\r\n\t\t// Extend with HTML5 attributes unless it's html4\r\n\t\tif (type != \"html4\") {\r\n\t\t\taddAttrs(\"input button select textarea\", \"autofocus\");\r\n\t\t\taddAttrs(\"input textarea\", \"placeholder\");\r\n\t\t\taddAttrs(\"a\", \"download\");\r\n\t\t\taddAttrs(\"link script img\", \"crossorigin\");\r\n\t\t\taddAttrs(\"iframe\", \"sandbox seamless allowfullscreen\"); // Excluded: srcdoc\r\n\t\t}\r\n\r\n\t\t// Special: iframe, ruby, video, audio, label\r\n\r\n\t\t// Delete children of the same name from it's parent\r\n\t\t// For example: form can't have a child of the name form\r\n\t\teach(split('a form meter progress dfn'), function(name) {\r\n\t\t\tif (schema[name]) {\r\n\t\t\t\tdelete schema[name].children[name];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Delete header, footer, sectioning and heading content descendants\r\n\t\t/*each('dt th address', function(name) {\r\n\t\t\tdelete schema[name].children[name];\r\n\t\t});*/\r\n\r\n\t\t// Caption can't have tables\r\n\t\tdelete schema.caption.children.table;\r\n\r\n\t\t// Delete scripts by default due to possible XSS\r\n\t\tdelete schema.script;\r\n\r\n\t\t// TODO: LI:s can only have value if parent is OL\r\n\r\n\t\t// TODO: Handle transparent elements\r\n\t\t// a ins del canvas map\r\n\r\n\t\tmapCache[type] = schema;\r\n\r\n\t\treturn schema;\r\n\t}\r\n\r\n\tfunction compileElementMap(value, mode) {\r\n\t\tvar styles;\r\n\r\n\t\tif (value) {\r\n\t\t\tstyles = {};\r\n\r\n\t\t\tif (typeof value == 'string') {\r\n\t\t\t\tvalue = {\r\n\t\t\t\t\t'*': value\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Convert styles into a rule list\r\n\t\t\teach(value, function(value, key) {\r\n\t\t\t\tstyles[key] = styles[key.toUpperCase()] = mode == 'map' ? makeMap(value, /[, ]/) : explode(value, /[, ]/);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn styles;\r\n\t}\r\n\r\n\t/**\r\n\t * Constructs a new Schema instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method Schema\r\n\t * @param {Object} settings Name/value settings object.\r\n\t */\r\n\treturn function(settings) {\r\n\t\tvar self = this, elements = {}, children = {}, patternElements = [], validStyles, invalidStyles, schemaItems;\r\n\t\tvar whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;\r\n\t\tvar blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;\r\n\t\tvar customElementsMap = {}, specialElements = {};\r\n\r\n\t\t// Creates an lookup table map object for the specified option or the default value\r\n\t\tfunction createLookupTable(option, default_value, extendWith) {\r\n\t\t\tvar value = settings[option];\r\n\r\n\t\t\tif (!value) {\r\n\t\t\t\t// Get cached default map or make it if needed\r\n\t\t\t\tvalue = mapCache[option];\r\n\r\n\t\t\t\tif (!value) {\r\n\t\t\t\t\tvalue = makeMap(default_value, ' ', makeMap(default_value.toUpperCase(), ' '));\r\n\t\t\t\t\tvalue = extend(value, extendWith);\r\n\r\n\t\t\t\t\tmapCache[option] = value;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Create custom map\r\n\t\t\t\tvalue = makeMap(value, /[, ]/, makeMap(value.toUpperCase(), /[, ]/));\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tsettings = settings || {};\r\n\t\tschemaItems = compileSchema(settings.schema);\r\n\r\n\t\t// Allow all elements and attributes if verify_html is set to false\r\n\t\tif (settings.verify_html === false) {\r\n\t\t\tsettings.valid_elements = '*[*]';\r\n\t\t}\r\n\r\n\t\tvalidStyles = compileElementMap(settings.valid_styles);\r\n\t\tinvalidStyles = compileElementMap(settings.invalid_styles, 'map');\r\n\t\tvalidClasses = compileElementMap(settings.valid_classes, 'map');\r\n\r\n\t\t// Setup map objects\r\n\t\twhiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object');\r\n\t\tselfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\r\n\t\tshortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' +\r\n\t\t\t'meta param embed source wbr track');\r\n\t\tboolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' +\r\n\t\t\t'noshade nowrap readonly selected autoplay loop controls');\r\n\t\tnonEmptyElementsMap = createLookupTable('non_empty_elements', 'td th iframe video audio object script', shortEndedElementsMap);\r\n\t\tmoveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', 'table', nonEmptyElementsMap);\r\n\t\ttextBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' +\r\n\t\t\t\t\t\t'blockquote center dir fieldset header footer article section hgroup aside nav figure');\r\n\t\tblockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' +\r\n\t\t\t\t\t\t'th tr td li ol ul caption dl dt dd noscript menu isindex option ' +\r\n\t\t\t\t\t\t'datalist select optgroup figcaption', textBlockElementsMap);\r\n\t\ttextInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' +\r\n\t\t\t\t\t\t\t\t\t\t'dfn code mark q sup sub samp');\r\n\r\n\t\teach((settings.special || 'script noscript style textarea').split(' '), function(name) {\r\n\t\t\tspecialElements[name] = new RegExp('<\\/' + name + '[^>]*>', 'gi');\r\n\t\t});\r\n\r\n\t\t// Converts a wildcard expression string to a regexp for example *a will become /.*a/.\r\n\t\tfunction patternToRegExp(str) {\r\n\t\t\treturn new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\r\n\t\t}\r\n\r\n\t\t// Parses the specified valid_elements string and adds to the current rules\r\n\t\t// This function is a bit hard to read since it's heavily optimized for speed\r\n\t\tfunction addValidElements(validElements) {\r\n\t\t\tvar ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder,\r\n\t\t\t\tprefix, outputName, globalAttributes, globalAttributesOrder, key, value,\r\n\t\t\t\telementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)\\])?$/,\r\n\t\t\t\tattrRuleRegExp = /^([!\\-])?(\\w+::\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,\r\n\t\t\t\thasPatternsRegExp = /[*?+]/;\r\n\r\n\t\t\tif (validElements) {\r\n\t\t\t\t// Split valid elements into an array with rules\r\n\t\t\t\tvalidElements = split(validElements, ',');\r\n\r\n\t\t\t\tif (elements['@']) {\r\n\t\t\t\t\tglobalAttributes = elements['@'].attributes;\r\n\t\t\t\t\tglobalAttributesOrder = elements['@'].attributesOrder;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Loop all rules\r\n\t\t\t\tfor (ei = 0, el = validElements.length; ei < el; ei++) {\r\n\t\t\t\t\t// Parse element rule\r\n\t\t\t\t\tmatches = elementRuleRegExp.exec(validElements[ei]);\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\t// Setup local names for matches\r\n\t\t\t\t\t\tprefix = matches[1];\r\n\t\t\t\t\t\telementName = matches[2];\r\n\t\t\t\t\t\toutputName = matches[3];\r\n\t\t\t\t\t\tattrData = matches[5];\r\n\r\n\t\t\t\t\t\t// Create new attributes and attributesOrder\r\n\t\t\t\t\t\tattributes = {};\r\n\t\t\t\t\t\tattributesOrder = [];\r\n\r\n\t\t\t\t\t\t// Create the new element\r\n\t\t\t\t\t\telement = {\r\n\t\t\t\t\t\t\tattributes: attributes,\r\n\t\t\t\t\t\t\tattributesOrder: attributesOrder\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Padd empty elements prefix\r\n\t\t\t\t\t\tif (prefix === '#') {\r\n\t\t\t\t\t\t\telement.paddEmpty = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remove empty elements prefix\r\n\t\t\t\t\t\tif (prefix === '-') {\r\n\t\t\t\t\t\t\telement.removeEmpty = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (matches[4] === '!') {\r\n\t\t\t\t\t\t\telement.removeEmptyAttrs = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Copy attributes from global rule into current rule\r\n\t\t\t\t\t\tif (globalAttributes) {\r\n\t\t\t\t\t\t\tfor (key in globalAttributes) {\r\n\t\t\t\t\t\t\t\tattributes[key] = globalAttributes[key];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tattributesOrder.push.apply(attributesOrder, globalAttributesOrder);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Attributes defined\r\n\t\t\t\t\t\tif (attrData) {\r\n\t\t\t\t\t\t\tattrData = split(attrData, '|');\r\n\t\t\t\t\t\t\tfor (ai = 0, al = attrData.length; ai < al; ai++) {\r\n\t\t\t\t\t\t\t\tmatches = attrRuleRegExp.exec(attrData[ai]);\r\n\t\t\t\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\t\t\t\tattr = {};\r\n\t\t\t\t\t\t\t\t\tattrType = matches[1];\r\n\t\t\t\t\t\t\t\t\tattrName = matches[2].replace(/::/g, ':');\r\n\t\t\t\t\t\t\t\t\tprefix = matches[3];\r\n\t\t\t\t\t\t\t\t\tvalue = matches[4];\r\n\r\n\t\t\t\t\t\t\t\t\t// Required\r\n\t\t\t\t\t\t\t\t\tif (attrType === '!') {\r\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired = element.attributesRequired || [];\r\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired.push(attrName);\r\n\t\t\t\t\t\t\t\t\t\tattr.required = true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Denied from global\r\n\t\t\t\t\t\t\t\t\tif (attrType === '-') {\r\n\t\t\t\t\t\t\t\t\t\tdelete attributes[attrName];\r\n\t\t\t\t\t\t\t\t\t\tattributesOrder.splice(inArray(attributesOrder, attrName), 1);\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Default value\r\n\t\t\t\t\t\t\t\t\tif (prefix) {\r\n\t\t\t\t\t\t\t\t\t\t// Default value\r\n\t\t\t\t\t\t\t\t\t\tif (prefix === '=') {\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault = element.attributesDefault || [];\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault.push({name: attrName, value: value});\r\n\t\t\t\t\t\t\t\t\t\t\tattr.defaultValue = value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Forced value\r\n\t\t\t\t\t\t\t\t\t\tif (prefix === ':') {\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced = element.attributesForced || [];\r\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced.push({name: attrName, value: value});\r\n\t\t\t\t\t\t\t\t\t\t\tattr.forcedValue = value;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Required values\r\n\t\t\t\t\t\t\t\t\t\tif (prefix === '<') {\r\n\t\t\t\t\t\t\t\t\t\t\tattr.validValues = makeMap(value, '?');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Check for attribute patterns\r\n\t\t\t\t\t\t\t\t\tif (hasPatternsRegExp.test(attrName)) {\r\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns = element.attributePatterns || [];\r\n\t\t\t\t\t\t\t\t\t\tattr.pattern = patternToRegExp(attrName);\r\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns.push(attr);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t// Add attribute to order list if it doesn't already exist\r\n\t\t\t\t\t\t\t\t\t\tif (!attributes[attrName]) {\r\n\t\t\t\t\t\t\t\t\t\t\tattributesOrder.push(attrName);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tattributes[attrName] = attr;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Global rule, store away these for later usage\r\n\t\t\t\t\t\tif (!globalAttributes && elementName == '@') {\r\n\t\t\t\t\t\t\tglobalAttributes = attributes;\r\n\t\t\t\t\t\t\tglobalAttributesOrder = attributesOrder;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Handle substitute elements such as b/strong\r\n\t\t\t\t\t\tif (outputName) {\r\n\t\t\t\t\t\t\telement.outputName = elementName;\r\n\t\t\t\t\t\t\telements[outputName] = element;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Add pattern or exact element\r\n\t\t\t\t\t\tif (hasPatternsRegExp.test(elementName)) {\r\n\t\t\t\t\t\t\telement.pattern = patternToRegExp(elementName);\r\n\t\t\t\t\t\t\tpatternElements.push(element);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\telements[elementName] = element;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setValidElements(validElements) {\r\n\t\t\telements = {};\r\n\t\t\tpatternElements = [];\r\n\r\n\t\t\taddValidElements(validElements);\r\n\r\n\t\t\teach(schemaItems, function(element, name) {\r\n\t\t\t\tchildren[name] = element.children;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Adds custom non HTML elements to the schema\r\n\t\tfunction addCustomElements(customElements) {\r\n\t\t\tvar customElementRegExp = /^(~)?(.+)$/;\r\n\r\n\t\t\tif (customElements) {\r\n\t\t\t\t// Flush cached items since we are altering the default maps\r\n\t\t\t\tmapCache.text_block_elements = mapCache.block_elements = null;\r\n\r\n\t\t\t\teach(split(customElements, ','), function(rule) {\r\n\t\t\t\t\tvar matches = customElementRegExp.exec(rule),\r\n\t\t\t\t\t\tinline = matches[1] === '~',\r\n\t\t\t\t\t\tcloneName = inline ? 'span' : 'div',\r\n\t\t\t\t\t\tname = matches[2];\r\n\r\n\t\t\t\t\tchildren[name] = children[cloneName];\r\n\t\t\t\t\tcustomElementsMap[name] = cloneName;\r\n\r\n\t\t\t\t\t// If it's not marked as inline then add it to valid block elements\r\n\t\t\t\t\tif (!inline) {\r\n\t\t\t\t\t\tblockElementsMap[name.toUpperCase()] = {};\r\n\t\t\t\t\t\tblockElementsMap[name] = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add elements clone if needed\r\n\t\t\t\t\tif (!elements[name]) {\r\n\t\t\t\t\t\tvar customRule = elements[cloneName];\r\n\r\n\t\t\t\t\t\tcustomRule = extend({}, customRule);\r\n\t\t\t\t\t\tdelete customRule.removeEmptyAttrs;\r\n\t\t\t\t\t\tdelete customRule.removeEmpty;\r\n\r\n\t\t\t\t\t\telements[name] = customRule;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add custom elements at span/div positions\r\n\t\t\t\t\teach(children, function(element, elmName) {\r\n\t\t\t\t\t\tif (element[cloneName]) {\r\n\t\t\t\t\t\t\tchildren[elmName] = element = extend({}, children[elmName]);\r\n\t\t\t\t\t\t\telement[name] = element[cloneName];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Adds valid children to the schema object\r\n\t\tfunction addValidChildren(validChildren) {\r\n\t\t\tvar childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\r\n\r\n\t\t\t// Invalidate the schema cache if the schema is mutated\r\n\t\t\tmapCache[settings.schema] = null;\r\n\r\n\t\t\tif (validChildren) {\r\n\t\t\t\teach(split(validChildren, ','), function(rule) {\r\n\t\t\t\t\tvar matches = childRuleRegExp.exec(rule), parent, prefix;\r\n\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\tprefix = matches[1];\r\n\r\n\t\t\t\t\t\t// Add/remove items from default\r\n\t\t\t\t\t\tif (prefix) {\r\n\t\t\t\t\t\t\tparent = children[matches[2]];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tparent = children[matches[2]] = {'#comment': {}};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tparent = children[matches[2]];\r\n\r\n\t\t\t\t\t\teach(split(matches[3], '|'), function(child) {\r\n\t\t\t\t\t\t\tif (prefix === '-') {\r\n\t\t\t\t\t\t\t\tdelete parent[child];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tparent[child] = {};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getElementRule(name) {\r\n\t\t\tvar element = elements[name], i;\r\n\r\n\t\t\t// Exact match found\r\n\t\t\tif (element) {\r\n\t\t\t\treturn element;\r\n\t\t\t}\r\n\r\n\t\t\t// No exact match then try the patterns\r\n\t\t\ti = patternElements.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\telement = patternElements[i];\r\n\r\n\t\t\t\tif (element.pattern.test(name)) {\r\n\t\t\t\t\treturn element;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!settings.valid_elements) {\r\n\t\t\t// No valid elements defined then clone the elements from the schema spec\r\n\t\t\teach(schemaItems, function(element, name) {\r\n\t\t\t\telements[name] = {\r\n\t\t\t\t\tattributes: element.attributes,\r\n\t\t\t\t\tattributesOrder: element.attributesOrder\r\n\t\t\t\t};\r\n\r\n\t\t\t\tchildren[name] = element.children;\r\n\t\t\t});\r\n\r\n\t\t\t// Switch these on HTML4\r\n\t\t\tif (settings.schema != \"html5\") {\r\n\t\t\t\teach(split('strong/b em/i'), function(item) {\r\n\t\t\t\t\titem = split(item, '/');\r\n\t\t\t\t\telements[item[1]].outputName = item[0];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add default alt attribute for images, removed since alt=\"\" is treated as presentational.\r\n\t\t\t// elements.img.attributesDefault = [{name: 'alt', value: ''}];\r\n\r\n\t\t\t// Remove these if they are empty by default\r\n\t\t\teach(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function(name) {\r\n\t\t\t\tif (elements[name]) {\r\n\t\t\t\t\telements[name].removeEmpty = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Padd these by default\r\n\t\t\teach(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption'), function(name) {\r\n\t\t\t\telements[name].paddEmpty = true;\r\n\t\t\t});\r\n\r\n\t\t\t// Remove these if they have no attributes\r\n\t\t\teach(split('span'), function(name) {\r\n\t\t\t\telements[name].removeEmptyAttrs = true;\r\n\t\t\t});\r\n\r\n\t\t\t// Remove these by default\r\n\t\t\t// TODO: Reenable in 4.1\r\n\t\t\t/*each(split('script style'), function(name) {\r\n\t\t\t\tdelete elements[name];\r\n\t\t\t});*/\r\n\t\t} else {\r\n\t\t\tsetValidElements(settings.valid_elements);\r\n\t\t}\r\n\r\n\t\taddCustomElements(settings.custom_elements);\r\n\t\taddValidChildren(settings.valid_children);\r\n\t\taddValidElements(settings.extended_valid_elements);\r\n\r\n\t\t// Todo: Remove this when we fix list handling to be valid\r\n\t\taddValidChildren('+ol[ul|ol],+ul[ul|ol]');\r\n\r\n\t\t// Delete invalid elements\r\n\t\tif (settings.invalid_elements) {\r\n\t\t\teach(explode(settings.invalid_elements), function(item) {\r\n\t\t\t\tif (elements[item]) {\r\n\t\t\t\t\tdelete elements[item];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// If the user didn't allow span only allow internal spans\r\n\t\tif (!getElementRule('span')) {\r\n\t\t\taddValidElements('span[!data-mce-type|*]');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Name/value map object with valid parents and children to those parents.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * children = {\r\n\t\t *    div:{p:{}, h1:{}}\r\n\t\t * };\r\n\t\t * @field children\r\n\t\t * @type Object\r\n\t\t */\r\n\t\tself.children = children;\r\n\r\n\t\t/**\r\n\t\t * Name/value map object with valid styles for each element.\r\n\t\t *\r\n\t\t * @method getValidStyles\r\n\t\t * @type Object\r\n\t\t */\r\n\t\tself.getValidStyles = function() {\r\n\t\t\treturn validStyles;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Name/value map object with valid styles for each element.\r\n\t\t *\r\n\t\t * @method getInvalidStyles\r\n\t\t * @type Object\r\n\t\t */\r\n\t\tself.getInvalidStyles = function() {\r\n\t\t\treturn invalidStyles;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Name/value map object with valid classes for each element.\r\n\t\t *\r\n\t\t * @method getValidClasses\r\n\t\t * @type Object\r\n\t\t */\r\n\t\tself.getValidClasses = function() {\r\n\t\t\treturn validClasses;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with boolean attributes.\r\n\t\t *\r\n\t\t * @method getBoolAttrs\r\n\t\t * @return {Object} Name/value lookup map for boolean attributes.\r\n\t\t */\r\n\t\tself.getBoolAttrs = function() {\r\n\t\t\treturn boolAttrMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with block elements.\r\n\t\t *\r\n\t\t * @method getBlockElements\r\n\t\t * @return {Object} Name/value lookup map for block elements.\r\n\t\t */\r\n\t\tself.getBlockElements = function() {\r\n\t\t\treturn blockElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with text block elements. Such as: p,h1-h6,div,address\r\n\t\t *\r\n\t\t * @method getTextBlockElements\r\n\t\t * @return {Object} Name/value lookup map for block elements.\r\n\t\t */\r\n\t\tself.getTextBlockElements = function() {\r\n\t\t\treturn textBlockElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map of inline text format nodes for example strong/span or ins.\r\n\t\t *\r\n\t\t * @method getTextInlineElements\r\n\t\t * @return {Object} Name/value lookup map for text format elements.\r\n\t\t */\r\n\t\tself.getTextInlineElements = function() {\r\n\t\t\treturn textInlineElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with short ended elements such as BR or IMG.\r\n\t\t *\r\n\t\t * @method getShortEndedElements\r\n\t\t * @return {Object} Name/value lookup map for short ended elements.\r\n\t\t */\r\n\t\tself.getShortEndedElements = function() {\r\n\t\t\treturn shortEndedElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with self closing tags such as <li>.\r\n\t\t *\r\n\t\t * @method getSelfClosingElements\r\n\t\t * @return {Object} Name/value lookup map for self closing tags elements.\r\n\t\t */\r\n\t\tself.getSelfClosingElements = function() {\r\n\t\t\treturn selfClosingElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with elements that should be treated as contents regardless if it has text\r\n\t\t * content in them or not such as TD, VIDEO or IMG.\r\n\t\t *\r\n\t\t * @method getNonEmptyElements\r\n\t\t * @return {Object} Name/value lookup map for non empty elements.\r\n\t\t */\r\n\t\tself.getNonEmptyElements = function() {\r\n\t\t\treturn nonEmptyElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with elements that the caret should be moved in front of after enter is\r\n\t\t * pressed\r\n\t\t *\r\n\t\t * @method getMoveCaretBeforeOnEnterElements\r\n\t\t * @return {Object} Name/value lookup map for elements to place the caret in front of.\r\n\t\t */\r\n\t\tself.getMoveCaretBeforeOnEnterElements = function() {\r\n\t\t\treturn moveCaretBeforeOnEnterElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with elements where white space is to be preserved like PRE or SCRIPT.\r\n\t\t *\r\n\t\t * @method getWhiteSpaceElements\r\n\t\t * @return {Object} Name/value lookup map for white space elements.\r\n\t\t */\r\n\t\tself.getWhiteSpaceElements = function() {\r\n\t\t\treturn whiteSpaceElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns a map with special elements. These are elements that needs to be parsed\r\n\t\t * in a special way such as script, style, textarea etc. The map object values\r\n\t\t * are regexps used to find the end of the element.\r\n\t\t *\r\n\t\t * @method getSpecialElements\r\n\t\t * @return {Object} Name/value lookup map for special elements.\r\n\t\t */\r\n\t\tself.getSpecialElements = function() {\r\n\t\t\treturn specialElements;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified element and it's child is valid or not\r\n\t\t * according to the schema.\r\n\t\t *\r\n\t\t * @method isValidChild\r\n\t\t * @param {String} name Element name to check for.\r\n\t\t * @param {String} child Element child to verify.\r\n\t\t * @return {Boolean} True/false if the element is a valid child of the specified parent.\r\n\t\t */\r\n\t\tself.isValidChild = function(name, child) {\r\n\t\t\tvar parent = children[name];\r\n\r\n\t\t\treturn !!(parent && parent[child]);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified element name and optional attribute is\r\n\t\t * valid according to the schema.\r\n\t\t *\r\n\t\t * @method isValid\r\n\t\t * @param {String} name Name of element to check.\r\n\t\t * @param {String} attr Optional attribute name to check for.\r\n\t\t * @return {Boolean} True/false if the element and attribute is valid.\r\n\t\t */\r\n\t\tself.isValid = function(name, attr) {\r\n\t\t\tvar attrPatterns, i, rule = getElementRule(name);\r\n\r\n\t\t\t// Check if it's a valid element\r\n\t\t\tif (rule) {\r\n\t\t\t\tif (attr) {\r\n\t\t\t\t\t// Check if attribute name exists\r\n\t\t\t\t\tif (rule.attributes[attr]) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if attribute matches a regexp pattern\r\n\t\t\t\t\tattrPatterns = rule.attributePatterns;\r\n\t\t\t\t\tif (attrPatterns) {\r\n\t\t\t\t\t\ti = attrPatterns.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tif (attrPatterns[i].pattern.test(name)) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// No match\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified element is valid or not\r\n\t\t * according to the schema.\r\n\t\t *\r\n\t\t * @method getElementRule\r\n\t\t * @param {String} name Element name to check for.\r\n\t\t * @return {Object} Element object or undefined if the element isn't valid.\r\n\t\t */\r\n\t\tself.getElementRule = getElementRule;\r\n\r\n\t\t/**\r\n\t\t * Returns an map object of all custom elements.\r\n\t\t *\r\n\t\t * @method getCustomElements\r\n\t\t * @return {Object} Name/value map object of all custom elements.\r\n\t\t */\r\n\t\tself.getCustomElements = function() {\r\n\t\t\treturn customElementsMap;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Parses a valid elements string and adds it to the schema. The valid elements\r\n\t\t * format is for example \"element[attr=default|otherattr]\".\r\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\r\n\t\t *\r\n\t\t * @method addValidElements\r\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\r\n\t\t */\r\n\t\tself.addValidElements = addValidElements;\r\n\r\n\t\t/**\r\n\t\t * Parses a valid elements string and sets it to the schema. The valid elements\r\n\t\t * format is for example \"element[attr=default|otherattr]\".\r\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\r\n\t\t *\r\n\t\t * @method setValidElements\r\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\r\n\t\t */\r\n\t\tself.setValidElements = setValidElements;\r\n\r\n\t\t/**\r\n\t\t * Adds custom non HTML elements to the schema.\r\n\t\t *\r\n\t\t * @method addCustomElements\r\n\t\t * @param {String} custom_elements Comma separated list of custom elements to add.\r\n\t\t */\r\n\t\tself.addCustomElements = addCustomElements;\r\n\r\n\t\t/**\r\n\t\t * Parses a valid children string and adds them to the schema structure. The valid children\r\n\t\t * format is for example: \"element[child1|child2]\".\r\n\t\t *\r\n\t\t * @method addValidChildren\r\n\t\t * @param {String} valid_children Valid children elements string to parse\r\n\t\t */\r\n\t\tself.addValidChildren = addValidChildren;\r\n\r\n\t\tself.elements = elements;\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/SaxParser.js\r\n\r\n/**\r\n * SaxParser.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*eslint max-depth:[2, 9] */\r\n\r\n/**\r\n * This class parses HTML code using pure JavaScript and executes various events for each item it finds. It will\r\n * always execute the events in the right order for tag soup code like <b><p></b></p>. It will also remove elements\r\n * and attributes that doesn't fit the schema if the validate setting is enabled.\r\n *\r\n * @example\r\n * var parser = new tinymce.html.SaxParser({\r\n *     validate: true,\r\n *\r\n *     comment: function(text) {\r\n *         console.log('Comment:', text);\r\n *     },\r\n *\r\n *     cdata: function(text) {\r\n *         console.log('CDATA:', text);\r\n *     },\r\n *\r\n *     text: function(text, raw) {\r\n *         console.log('Text:', text, 'Raw:', raw);\r\n *     },\r\n *\r\n *     start: function(name, attrs, empty) {\r\n *         console.log('Start:', name, attrs, empty);\r\n *     },\r\n *\r\n *     end: function(name) {\r\n *         console.log('End:', name);\r\n *     },\r\n *\r\n *     pi: function(name, text) {\r\n *         console.log('PI:', name, text);\r\n *     },\r\n *\r\n *     doctype: function(text) {\r\n *         console.log('DocType:', text);\r\n *     }\r\n * }, schema);\r\n * @class tinymce.html.SaxParser\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/SaxParser\", [\r\n\t\"tinymce/html/Schema\",\r\n\t\"tinymce/html/Entities\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Schema, Entities, Tools) {\r\n\tvar each = Tools.each;\r\n\r\n\t/**\r\n\t * Returns the index of the end tag for a specific start tag. This can be\r\n\t * used to skip all children of a parent element from being processed.\r\n\t *\r\n\t * @private\r\n\t * @method findEndTag\r\n\t * @param {tinymce.html.Schema} schema Schema instance to use to match short ended elements.\r\n\t * @param {String} html HTML string to find the end tag in.\r\n\t * @param {Number} startIndex Indext to start searching at should be after the start tag.\r\n\t * @return {Number} Index of the end tag.\r\n\t */\r\n\tfunction findEndTag(schema, html, startIndex) {\r\n\t\tvar count = 1, index, matches, tokenRegExp, shortEndedElements;\r\n\r\n\t\tshortEndedElements = schema.getShortEndedElements();\r\n\t\ttokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\r\n\t\ttokenRegExp.lastIndex = index = startIndex;\r\n\r\n\t\twhile ((matches = tokenRegExp.exec(html))) {\r\n\t\t\tindex = tokenRegExp.lastIndex;\r\n\r\n\t\t\tif (matches[1] === '/') { // End element\r\n\t\t\t\tcount--;\r\n\t\t\t} else if (!matches[1]) { // Start element\r\n\t\t\t\tif (matches[2] in shortEndedElements) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\r\n\t\t\tif (count === 0) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn index;\r\n\t}\r\n\r\n\t/**\r\n\t * Constructs a new SaxParser instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method SaxParser\r\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\r\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\r\n\t */\r\n\tfunction SaxParser(settings, schema) {\r\n\t\tvar self = this;\r\n\r\n\t\tfunction noop() {}\r\n\r\n\t\tsettings = settings || {};\r\n\t\tself.schema = schema = schema || new Schema();\r\n\r\n\t\tif (settings.fix_self_closing !== false) {\r\n\t\t\tsettings.fix_self_closing = true;\r\n\t\t}\r\n\r\n\t\t// Add handler functions from settings and setup default handlers\r\n\t\teach('comment cdata text start end pi doctype'.split(' '), function(name) {\r\n\t\t\tif (name) {\r\n\t\t\t\tself[name] = settings[name] || noop;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * Parses the specified HTML string and executes the callbacks for each item it finds.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * new SaxParser({...}).parse('<b>text</b>');\r\n\t\t * @method parse\r\n\t\t * @param {String} html Html string to sax parse.\r\n\t\t */\r\n\t\tself.parse = function(html) {\r\n\t\t\tvar self = this, matches, index = 0, value, endRegExp, stack = [], attrList, i, text, name;\r\n\t\t\tvar isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;\r\n\t\t\tvar validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\r\n\t\t\tvar attributesRequired, attributesDefault, attributesForced;\r\n\t\t\tvar anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;\r\n\t\t\tvar decode = Entities.decode, fixSelfClosing, filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster');\r\n\t\t\tvar scriptUriRegExp = /((java|vb)script|mhtml):/i, dataUriRegExp = /^data:/i;\r\n\r\n\t\t\tfunction processEndTag(name) {\r\n\t\t\t\tvar pos, i;\r\n\r\n\t\t\t\t// Find position of parent of the same type\r\n\t\t\t\tpos = stack.length;\r\n\t\t\t\twhile (pos--) {\r\n\t\t\t\t\tif (stack[pos].name === name) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Found parent\r\n\t\t\t\tif (pos >= 0) {\r\n\t\t\t\t\t// Close all the open elements\r\n\t\t\t\t\tfor (i = stack.length - 1; i >= pos; i--) {\r\n\t\t\t\t\t\tname = stack[i];\r\n\r\n\t\t\t\t\t\tif (name.valid) {\r\n\t\t\t\t\t\t\tself.end(name.name);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove the open elements from the stack\r\n\t\t\t\t\tstack.length = pos;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction parseAttribute(match, name, value, val2, val3) {\r\n\t\t\t\tvar attrRule, i, trimRegExp = /[\\s\\u0000-\\u001F]+/g;\r\n\r\n\t\t\t\tname = name.toLowerCase();\r\n\t\t\t\tvalue = name in fillAttrsMap ? name : decode(value || val2 || val3 || ''); // Handle boolean attribute than value attribute\r\n\r\n\t\t\t\t// Validate name and value pass through all data- attributes\r\n\t\t\t\tif (validate && !isInternalElement && name.indexOf('data-') !== 0) {\r\n\t\t\t\t\tattrRule = validAttributesMap[name];\r\n\r\n\t\t\t\t\t// Find rule by pattern matching\r\n\t\t\t\t\tif (!attrRule && validAttributePatterns) {\r\n\t\t\t\t\t\ti = validAttributePatterns.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tattrRule = validAttributePatterns[i];\r\n\t\t\t\t\t\t\tif (attrRule.pattern.test(name)) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// No rule matched\r\n\t\t\t\t\t\tif (i === -1) {\r\n\t\t\t\t\t\t\tattrRule = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// No attribute rule found\r\n\t\t\t\t\tif (!attrRule) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Validate value\r\n\t\t\t\t\tif (attrRule.validValues && !(value in attrRule.validValues)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Block any javascript: urls or non image data uris\r\n\t\t\t\tif (filteredUrlAttrs[name] && !settings.allow_script_urls) {\r\n\t\t\t\t\tvar uri = value.replace(trimRegExp, '');\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Might throw malformed URI sequence\r\n\t\t\t\t\t\turi = decodeURIComponent(uri);\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Fallback to non UTF-8 decoder\r\n\t\t\t\t\t\turi = unescape(uri);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (scriptUriRegExp.test(uri)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!settings.allow_html_data_urls && dataUriRegExp.test(uri) && !/^data:image\\//i.test(uri)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add attribute to list and map\r\n\t\t\t\tattrList.map[name] = value;\r\n\t\t\t\tattrList.push({\r\n\t\t\t\t\tname: name,\r\n\t\t\t\t\tvalue: value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Precompile RegExps and map objects\r\n\t\t\ttokenRegExp = new RegExp('<(?:' +\r\n\t\t\t\t'(?:!--([\\\\w\\\\W]*?)-->)|' + // Comment\r\n\t\t\t\t'(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + // CDATA\r\n\t\t\t\t'(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + // DOCTYPE\r\n\t\t\t\t'(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + // PI\r\n\t\t\t\t'(?:\\\\/([^>]+)>)|' + // End element\r\n\t\t\t\t'(?:([A-Za-z0-9\\\\-_\\\\:\\\\.]+)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + // Start element\r\n\t\t\t')', 'g');\r\n\r\n\t\t\tattrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\r\n\r\n\t\t\t// Setup lookup tables for empty elements and boolean attributes\r\n\t\t\tshortEndedElements = schema.getShortEndedElements();\r\n\t\t\tselfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\r\n\t\t\tfillAttrsMap = schema.getBoolAttrs();\r\n\t\t\tvalidate = settings.validate;\r\n\t\t\tremoveInternalElements = settings.remove_internals;\r\n\t\t\tfixSelfClosing = settings.fix_self_closing;\r\n\t\t\tspecialElements = schema.getSpecialElements();\r\n\r\n\t\t\twhile ((matches = tokenRegExp.exec(html))) {\r\n\t\t\t\t// Text\r\n\t\t\t\tif (index < matches.index) {\r\n\t\t\t\t\tself.text(decode(html.substr(index, matches.index - index)));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ((value = matches[6])) { // End element\r\n\t\t\t\t\tvalue = value.toLowerCase();\r\n\r\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\r\n\t\t\t\t\tif (value.charAt(0) === ':') {\r\n\t\t\t\t\t\tvalue = value.substr(1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tprocessEndTag(value);\r\n\t\t\t\t} else if ((value = matches[7])) { // Start element\r\n\t\t\t\t\tvalue = value.toLowerCase();\r\n\r\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\r\n\t\t\t\t\tif (value.charAt(0) === ':') {\r\n\t\t\t\t\t\tvalue = value.substr(1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tisShortEnded = value in shortEndedElements;\r\n\r\n\t\t\t\t\t// Is self closing tag for example an <li> after an open <li>\r\n\t\t\t\t\tif (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\r\n\t\t\t\t\t\tprocessEndTag(value);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Validate element\r\n\t\t\t\t\tif (!validate || (elementRule = schema.getElementRule(value))) {\r\n\t\t\t\t\t\tisValidElement = true;\r\n\r\n\t\t\t\t\t\t// Grab attributes map and patters when validation is enabled\r\n\t\t\t\t\t\tif (validate) {\r\n\t\t\t\t\t\t\tvalidAttributesMap = elementRule.attributes;\r\n\t\t\t\t\t\t\tvalidAttributePatterns = elementRule.attributePatterns;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Parse attributes\r\n\t\t\t\t\t\tif ((attribsValue = matches[8])) {\r\n\t\t\t\t\t\t\tisInternalElement = attribsValue.indexOf('data-mce-type') !== -1; // Check if the element is an internal element\r\n\r\n\t\t\t\t\t\t\t// If the element has internal attributes then remove it if we are told to do so\r\n\t\t\t\t\t\t\tif (isInternalElement && removeInternalElements) {\r\n\t\t\t\t\t\t\t\tisValidElement = false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tattrList = [];\r\n\t\t\t\t\t\t\tattrList.map = {};\r\n\r\n\t\t\t\t\t\t\tattribsValue.replace(attrRegExp, parseAttribute);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tattrList = [];\r\n\t\t\t\t\t\t\tattrList.map = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Process attributes if validation is enabled\r\n\t\t\t\t\t\tif (validate && !isInternalElement) {\r\n\t\t\t\t\t\t\tattributesRequired = elementRule.attributesRequired;\r\n\t\t\t\t\t\t\tattributesDefault = elementRule.attributesDefault;\r\n\t\t\t\t\t\t\tattributesForced = elementRule.attributesForced;\r\n\t\t\t\t\t\t\tanyAttributesRequired = elementRule.removeEmptyAttrs;\r\n\r\n\t\t\t\t\t\t\t// Check if any attribute exists\r\n\t\t\t\t\t\t\tif (anyAttributesRequired && !attrList.length) {\r\n\t\t\t\t\t\t\t\tisValidElement = false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Handle forced attributes\r\n\t\t\t\t\t\t\tif (attributesForced) {\r\n\t\t\t\t\t\t\t\ti = attributesForced.length;\r\n\t\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\t\tattr = attributesForced[i];\r\n\t\t\t\t\t\t\t\t\tname = attr.name;\r\n\t\t\t\t\t\t\t\t\tattrValue = attr.value;\r\n\r\n\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\r\n\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\r\n\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Handle default attributes\r\n\t\t\t\t\t\t\tif (attributesDefault) {\r\n\t\t\t\t\t\t\t\ti = attributesDefault.length;\r\n\t\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\t\tattr = attributesDefault[i];\r\n\t\t\t\t\t\t\t\t\tname = attr.name;\r\n\r\n\t\t\t\t\t\t\t\t\tif (!(name in attrList.map)) {\r\n\t\t\t\t\t\t\t\t\t\tattrValue = attr.value;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\r\n\t\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\r\n\t\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Handle required attributes\r\n\t\t\t\t\t\t\tif (attributesRequired) {\r\n\t\t\t\t\t\t\t\ti = attributesRequired.length;\r\n\t\t\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t\t\tif (attributesRequired[i] in attrList.map) {\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// None of the required attributes where found\r\n\t\t\t\t\t\t\t\tif (i === -1) {\r\n\t\t\t\t\t\t\t\t\tisValidElement = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Invalidate element if it's marked as bogus\r\n\t\t\t\t\t\t\tif ((attr = attrList.map['data-mce-bogus'])) {\r\n\t\t\t\t\t\t\t\tif (attr === 'all') {\r\n\t\t\t\t\t\t\t\t\tindex = findEndTag(schema, html, tokenRegExp.lastIndex);\r\n\t\t\t\t\t\t\t\t\ttokenRegExp.lastIndex = index;\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tisValidElement = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (isValidElement) {\r\n\t\t\t\t\t\t\tself.start(value, attrList, isShortEnded);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisValidElement = false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Treat script, noscript and style a bit different since they may include code that looks like elements\r\n\t\t\t\t\tif ((endRegExp = specialElements[value])) {\r\n\t\t\t\t\t\tendRegExp.lastIndex = index = matches.index + matches[0].length;\r\n\r\n\t\t\t\t\t\tif ((matches = endRegExp.exec(html))) {\r\n\t\t\t\t\t\t\tif (isValidElement) {\r\n\t\t\t\t\t\t\t\ttext = html.substr(index, matches.index - index);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tindex = matches.index + matches[0].length;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext = html.substr(index);\r\n\t\t\t\t\t\t\tindex = html.length;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (isValidElement) {\r\n\t\t\t\t\t\t\tif (text.length > 0) {\r\n\t\t\t\t\t\t\t\tself.text(text, true);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tself.end(value);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttokenRegExp.lastIndex = index;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Push value on to stack\r\n\t\t\t\t\tif (!isShortEnded) {\r\n\t\t\t\t\t\tif (!attribsValue || attribsValue.indexOf('/') != attribsValue.length - 1) {\r\n\t\t\t\t\t\t\tstack.push({name: value, valid: isValidElement});\r\n\t\t\t\t\t\t} else if (isValidElement) {\r\n\t\t\t\t\t\t\tself.end(value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if ((value = matches[1])) { // Comment\r\n\t\t\t\t\t// Padd comment value to avoid browsers from parsing invalid comments as HTML\r\n\t\t\t\t\tif (value.charAt(0) === '>') {\r\n\t\t\t\t\t\tvalue = ' ' + value;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!settings.allow_conditional_comments && value.substr(0, 3) === '[if') {\r\n\t\t\t\t\t\tvalue = ' ' + value;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.comment(value);\r\n\t\t\t\t} else if ((value = matches[2])) { // CDATA\r\n\t\t\t\t\tself.cdata(value);\r\n\t\t\t\t} else if ((value = matches[3])) { // DOCTYPE\r\n\t\t\t\t\tself.doctype(value);\r\n\t\t\t\t} else if ((value = matches[4])) { // PI\r\n\t\t\t\t\tself.pi(value, matches[5]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tindex = matches.index + matches[0].length;\r\n\t\t\t}\r\n\r\n\t\t\t// Text\r\n\t\t\tif (index < html.length) {\r\n\t\t\t\tself.text(decode(html.substr(index)));\r\n\t\t\t}\r\n\r\n\t\t\t// Close any open elements\r\n\t\t\tfor (i = stack.length - 1; i >= 0; i--) {\r\n\t\t\t\tvalue = stack[i];\r\n\r\n\t\t\t\tif (value.valid) {\r\n\t\t\t\t\tself.end(value.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tSaxParser.findEndTag = findEndTag;\r\n\r\n\treturn SaxParser;\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/DomParser.js\r\n\r\n/**\r\n * DomParser.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class parses HTML code into a DOM like structure of nodes it will remove redundant whitespace and make\r\n * sure that the node tree is valid according to the specified schema.\r\n * So for example: <p>a<p>b</p>c</p> will become <p>a</p><p>b</p><p>c</p>\r\n *\r\n * @example\r\n * var parser = new tinymce.html.DomParser({validate: true}, schema);\r\n * var rootNode = parser.parse('<h1>content</h1>');\r\n *\r\n * @class tinymce.html.DomParser\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/DomParser\", [\r\n\t\"tinymce/html/Node\",\r\n\t\"tinymce/html/Schema\",\r\n\t\"tinymce/html/SaxParser\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Node, Schema, SaxParser, Tools) {\r\n\tvar makeMap = Tools.makeMap, each = Tools.each, explode = Tools.explode, extend = Tools.extend;\r\n\r\n\t/**\r\n\t * Constructs a new DomParser instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method DomParser\r\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\r\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\r\n\t */\r\n\treturn function(settings, schema) {\r\n\t\tvar self = this, nodeFilters = {}, attributeFilters = [], matchedNodes = {}, matchedAttributes = {};\r\n\r\n\t\tsettings = settings || {};\r\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\r\n\t\tsettings.root_name = settings.root_name || 'body';\r\n\t\tself.schema = schema = schema || new Schema();\r\n\r\n\t\tfunction fixInvalidChildren(nodes) {\r\n\t\t\tvar ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\r\n\t\t\tvar nonEmptyElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;\r\n\r\n\t\t\tnonSplitableElements = makeMap('tr,td,th,tbody,thead,tfoot,table');\r\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\r\n\t\t\ttextBlockElements = schema.getTextBlockElements();\r\n\t\t\tspecialElements = schema.getSpecialElements();\r\n\r\n\t\t\tfor (ni = 0; ni < nodes.length; ni++) {\r\n\t\t\t\tnode = nodes[ni];\r\n\r\n\t\t\t\t// Already removed or fixed\r\n\t\t\t\tif (!node.parent || node.fixed) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the invalid element is a text block and the text block is within a parent LI element\r\n\t\t\t\t// Then unwrap the first text block and convert other sibling text blocks to LI elements similar to Word/Open Office\r\n\t\t\t\tif (textBlockElements[node.name] && node.parent.name == 'li') {\r\n\t\t\t\t\t// Move sibling text blocks after LI element\r\n\t\t\t\t\tsibling = node.next;\r\n\t\t\t\t\twhile (sibling) {\r\n\t\t\t\t\t\tif (textBlockElements[sibling.name]) {\r\n\t\t\t\t\t\t\tsibling.name = 'li';\r\n\t\t\t\t\t\t\tsibling.fixed = true;\r\n\t\t\t\t\t\t\tnode.parent.insert(sibling, node.parent);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = sibling.next;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Unwrap current text block\r\n\t\t\t\t\tnode.unwrap(node);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get list of all parent nodes until we find a valid parent to stick the child into\r\n\t\t\t\tparents = [node];\r\n\t\t\t\tfor (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) &&\r\n\t\t\t\t\t!nonSplitableElements[parent.name]; parent = parent.parent) {\r\n\t\t\t\t\tparents.push(parent);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Found a suitable parent\r\n\t\t\t\tif (parent && parents.length > 1) {\r\n\t\t\t\t\t// Reverse the array since it makes looping easier\r\n\t\t\t\t\tparents.reverse();\r\n\r\n\t\t\t\t\t// Clone the related parent and insert that after the moved node\r\n\t\t\t\t\tnewParent = currentNode = self.filterNode(parents[0].clone());\r\n\r\n\t\t\t\t\t// Start cloning and moving children on the left side of the target node\r\n\t\t\t\t\tfor (i = 0; i < parents.length - 1; i++) {\r\n\t\t\t\t\t\tif (schema.isValidChild(currentNode.name, parents[i].name)) {\r\n\t\t\t\t\t\t\ttempNode = self.filterNode(parents[i].clone());\r\n\t\t\t\t\t\t\tcurrentNode.append(tempNode);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttempNode = currentNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (childNode = parents[i].firstChild; childNode && childNode != parents[i + 1];) {\r\n\t\t\t\t\t\t\tnextNode = childNode.next;\r\n\t\t\t\t\t\t\ttempNode.append(childNode);\r\n\t\t\t\t\t\t\tchildNode = nextNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcurrentNode = tempNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!newParent.isEmpty(nonEmptyElements)) {\r\n\t\t\t\t\t\tparent.insert(newParent, parents[0], true);\r\n\t\t\t\t\t\tparent.insert(node, newParent);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tparent.insert(node, parents[0], true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the element is empty by looking through it's contents and special treatment for <p><br /></p>\r\n\t\t\t\t\tparent = parents[0];\r\n\t\t\t\t\tif (parent.isEmpty(nonEmptyElements) || parent.firstChild === parent.lastChild && parent.firstChild.name === 'br') {\r\n\t\t\t\t\t\tparent.empty().remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (node.parent) {\r\n\t\t\t\t\t// If it's an LI try to find a UL/OL for it or wrap it\r\n\t\t\t\t\tif (node.name === 'li') {\r\n\t\t\t\t\t\tsibling = node.prev;\r\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\r\n\t\t\t\t\t\t\tsibling.append(node);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = node.next;\r\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\r\n\t\t\t\t\t\t\tsibling.insert(node, sibling.firstChild, true);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('ul', 1)));\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Try wrapping the element in a DIV\r\n\t\t\t\t\tif (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\r\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('div', 1)));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// We failed wrapping it, then remove or unwrap it\r\n\t\t\t\t\t\tif (specialElements[node.name]) {\r\n\t\t\t\t\t\t\tnode.empty().remove();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnode.unwrap();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Runs the specified node though the element and attributes filters.\r\n\t\t *\r\n\t\t * @method filterNode\r\n\t\t * @param {tinymce.html.Node} Node the node to run filters on.\r\n\t\t * @return {tinymce.html.Node} The passed in node.\r\n\t\t */\r\n\t\tself.filterNode = function(node) {\r\n\t\t\tvar i, name, list;\r\n\r\n\t\t\t// Run element filters\r\n\t\t\tif (name in nodeFilters) {\r\n\t\t\t\tlist = matchedNodes[name];\r\n\r\n\t\t\t\tif (list) {\r\n\t\t\t\t\tlist.push(node);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmatchedNodes[name] = [node];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Run attribute filters\r\n\t\t\ti = attributeFilters.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tname = attributeFilters[i].name;\r\n\r\n\t\t\t\tif (name in node.attributes.map) {\r\n\t\t\t\t\tlist = matchedAttributes[name];\r\n\r\n\t\t\t\t\tif (list) {\r\n\t\t\t\t\t\tlist.push(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmatchedAttributes[name] = [node];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Adds a node filter function to the parser, the parser will collect the specified nodes by name\r\n\t\t * and then execute the callback ones it has finished parsing the document.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\r\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t *\t\t\tconsole.log(nodes[i].name);\r\n\t\t *\t\t}\r\n\t\t * });\r\n\t\t * @method addNodeFilter\r\n\t\t * @method {String} name Comma separated list of nodes to collect.\r\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\r\n\t\t */\r\n\t\tself.addNodeFilter = function(name, callback) {\r\n\t\t\teach(explode(name), function(name) {\r\n\t\t\t\tvar list = nodeFilters[name];\r\n\r\n\t\t\t\tif (!list) {\r\n\t\t\t\t\tnodeFilters[name] = list = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlist.push(callback);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Adds a attribute filter function to the parser, the parser will collect nodes that has the specified attributes\r\n\t\t * and then execute the callback ones it has finished parsing the document.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\r\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t *\t\t\tconsole.log(nodes[i].name);\r\n\t\t *\t\t}\r\n\t\t * });\r\n\t\t * @method addAttributeFilter\r\n\t\t * @method {String} name Comma separated list of nodes to collect.\r\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\r\n\t\t */\r\n\t\tself.addAttributeFilter = function(name, callback) {\r\n\t\t\teach(explode(name), function(name) {\r\n\t\t\t\tvar i;\r\n\r\n\t\t\t\tfor (i = 0; i < attributeFilters.length; i++) {\r\n\t\t\t\t\tif (attributeFilters[i].name === name) {\r\n\t\t\t\t\t\tattributeFilters[i].callbacks.push(callback);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributeFilters.push({name: name, callbacks: [callback]});\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Parses the specified HTML string into a DOM like node tree and returns the result.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * var rootNode = new DomParser({...}).parse('<b>text</b>');\r\n\t\t * @method parse\r\n\t\t * @param {String} html Html string to sax parse.\r\n\t\t * @param {Object} args Optional args object that gets passed to all filter functions.\r\n\t\t * @return {tinymce.html.Node} Root node containing the tree.\r\n\t\t */\r\n\t\tself.parse = function(html, args) {\r\n\t\t\tvar parser, rootNode, node, nodes, i, l, fi, fl, list, name, validate;\r\n\t\t\tvar blockElements, startWhiteSpaceRegExp, invalidChildren = [], isInWhiteSpacePreservedElement;\r\n\t\t\tvar endWhiteSpaceRegExp, allWhiteSpaceRegExp, isAllWhiteSpaceRegExp, whiteSpaceElements;\r\n\t\t\tvar children, nonEmptyElements, rootBlockName;\r\n\r\n\t\t\targs = args || {};\r\n\t\t\tmatchedNodes = {};\r\n\t\t\tmatchedAttributes = {};\r\n\t\t\tblockElements = extend(makeMap('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\r\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\r\n\t\t\tchildren = schema.children;\r\n\t\t\tvalidate = settings.validate;\r\n\t\t\trootBlockName = \"forced_root_block\" in args ? args.forced_root_block : settings.forced_root_block;\r\n\r\n\t\t\twhiteSpaceElements = schema.getWhiteSpaceElements();\r\n\t\t\tstartWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\r\n\t\t\tendWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\r\n\t\t\tallWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\r\n\t\t\tisAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\r\n\r\n\t\t\tfunction addRootBlocks() {\r\n\t\t\t\tvar node = rootNode.firstChild, next, rootBlockNode;\r\n\r\n\t\t\t\t// Removes whitespace at beginning and end of block so:\r\n\t\t\t\t// <p> x </p> -> <p>x</p>\r\n\t\t\t\tfunction trim(rootBlockNode) {\r\n\t\t\t\t\tif (rootBlockNode) {\r\n\t\t\t\t\t\tnode = rootBlockNode.firstChild;\r\n\t\t\t\t\t\tif (node && node.type == 3) {\r\n\t\t\t\t\t\t\tnode.value = node.value.replace(startWhiteSpaceRegExp, '');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = rootBlockNode.lastChild;\r\n\t\t\t\t\t\tif (node && node.type == 3) {\r\n\t\t\t\t\t\t\tnode.value = node.value.replace(endWhiteSpaceRegExp, '');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if rootBlock is valid within rootNode for example if P is valid in H1 if H1 is the contentEditabe root\r\n\t\t\t\tif (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tnext = node.next;\r\n\r\n\t\t\t\t\tif (node.type == 3 || (node.type == 1 && node.name !== 'p' &&\r\n\t\t\t\t\t\t!blockElements[node.name] && !node.attr('data-mce-type'))) {\r\n\t\t\t\t\t\tif (!rootBlockNode) {\r\n\t\t\t\t\t\t\t// Create a new root block element\r\n\t\t\t\t\t\t\trootBlockNode = createNode(rootBlockName, 1);\r\n\t\t\t\t\t\t\trootBlockNode.attr(settings.forced_root_block_attrs);\r\n\t\t\t\t\t\t\trootNode.insert(rootBlockNode, node);\r\n\t\t\t\t\t\t\trootBlockNode.append(node);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trootBlockNode.append(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttrim(rootBlockNode);\r\n\t\t\t\t\t\trootBlockNode = null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttrim(rootBlockNode);\r\n\t\t\t}\r\n\r\n\t\t\tfunction createNode(name, type) {\r\n\t\t\t\tvar node = new Node(name, type), list;\r\n\r\n\t\t\t\tif (name in nodeFilters) {\r\n\t\t\t\t\tlist = matchedNodes[name];\r\n\r\n\t\t\t\t\tif (list) {\r\n\t\t\t\t\t\tlist.push(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmatchedNodes[name] = [node];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\r\n\t\t\tfunction removeWhitespaceBefore(node) {\r\n\t\t\t\tvar textNode, textNodeNext, textVal, sibling, blockElements = schema.getBlockElements();\r\n\r\n\t\t\t\tfor (textNode = node.prev; textNode && textNode.type === 3;) {\r\n\t\t\t\t\ttextVal = textNode.value.replace(endWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\t// Found a text node with non whitespace then trim that and break\r\n\t\t\t\t\tif (textVal.length > 0) {\r\n\t\t\t\t\t\ttextNode.value = textVal;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttextNodeNext = textNode.next;\r\n\r\n\t\t\t\t\t// Fix for bug #7543 where bogus nodes would produce empty\r\n\t\t\t\t\t// text nodes and these would be removed if a nested list was before it\r\n\t\t\t\t\tif (textNodeNext) {\r\n\t\t\t\t\t\tif (textNodeNext.type == 3 && textNodeNext.value.length) {\r\n\t\t\t\t\t\t\ttextNode = textNode.prev;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!blockElements[textNodeNext.name] && textNodeNext.name != 'script' && textNodeNext.name != 'style') {\r\n\t\t\t\t\t\t\ttextNode = textNode.prev;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsibling = textNode.prev;\r\n\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction cloneAndExcludeBlocks(input) {\r\n\t\t\t\tvar name, output = {};\r\n\r\n\t\t\t\tfor (name in input) {\r\n\t\t\t\t\tif (name !== 'li' && name != 'p') {\r\n\t\t\t\t\t\toutput[name] = input[name];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn output;\r\n\t\t\t}\r\n\r\n\t\t\tparser = new SaxParser({\r\n\t\t\t\tvalidate: validate,\r\n\t\t\t\tallow_script_urls: settings.allow_script_urls,\r\n\t\t\t\tallow_conditional_comments: settings.allow_conditional_comments,\r\n\r\n\t\t\t\t// Exclude P and LI from DOM parsing since it's treated better by the DOM parser\r\n\t\t\t\tself_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\r\n\r\n\t\t\t\tcdata: function(text) {\r\n\t\t\t\t\tnode.append(createNode('#cdata', 4)).value = text;\r\n\t\t\t\t},\r\n\r\n\t\t\t\ttext: function(text, raw) {\r\n\t\t\t\t\tvar textNode;\r\n\r\n\t\t\t\t\t// Trim all redundant whitespace on non white space elements\r\n\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\r\n\t\t\t\t\t\ttext = text.replace(allWhiteSpaceRegExp, ' ');\r\n\r\n\t\t\t\t\t\tif (node.lastChild && blockElements[node.lastChild.name]) {\r\n\t\t\t\t\t\t\ttext = text.replace(startWhiteSpaceRegExp, '');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Do we need to create the node\r\n\t\t\t\t\tif (text.length !== 0) {\r\n\t\t\t\t\t\ttextNode = createNode('#text', 3);\r\n\t\t\t\t\t\ttextNode.raw = !!raw;\r\n\t\t\t\t\t\tnode.append(textNode).value = text;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tcomment: function(text) {\r\n\t\t\t\t\tnode.append(createNode('#comment', 8)).value = text;\r\n\t\t\t\t},\r\n\r\n\t\t\t\tpi: function(name, text) {\r\n\t\t\t\t\tnode.append(createNode(name, 7)).value = text;\r\n\t\t\t\t\tremoveWhitespaceBefore(node);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tdoctype: function(text) {\r\n\t\t\t\t\tvar newNode;\r\n\r\n\t\t\t\t\tnewNode = node.append(createNode('#doctype', 10));\r\n\t\t\t\t\tnewNode.value = text;\r\n\t\t\t\t\tremoveWhitespaceBefore(node);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tstart: function(name, attrs, empty) {\r\n\t\t\t\t\tvar newNode, attrFiltersLen, elementRule, attrName, parent;\r\n\r\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\r\n\t\t\t\t\tif (elementRule) {\r\n\t\t\t\t\t\tnewNode = createNode(elementRule.outputName || name, 1);\r\n\t\t\t\t\t\tnewNode.attributes = attrs;\r\n\t\t\t\t\t\tnewNode.shortEnded = empty;\r\n\r\n\t\t\t\t\t\tnode.append(newNode);\r\n\r\n\t\t\t\t\t\t// Check if node is valid child of the parent node is the child is\r\n\t\t\t\t\t\t// unknown we don't collect it since it's probably a custom element\r\n\t\t\t\t\t\tparent = children[node.name];\r\n\t\t\t\t\t\tif (parent && children[newNode.name] && !parent[newNode.name]) {\r\n\t\t\t\t\t\t\tinvalidChildren.push(newNode);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tattrFiltersLen = attributeFilters.length;\r\n\t\t\t\t\t\twhile (attrFiltersLen--) {\r\n\t\t\t\t\t\t\tattrName = attributeFilters[attrFiltersLen].name;\r\n\r\n\t\t\t\t\t\t\tif (attrName in attrs.map) {\r\n\t\t\t\t\t\t\t\tlist = matchedAttributes[attrName];\r\n\r\n\t\t\t\t\t\t\t\tif (list) {\r\n\t\t\t\t\t\t\t\t\tlist.push(newNode);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tmatchedAttributes[attrName] = [newNode];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Trim whitespace before block\r\n\t\t\t\t\t\tif (blockElements[name]) {\r\n\t\t\t\t\t\t\tremoveWhitespaceBefore(newNode);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Change current node if the element wasn't empty i.e not <br /> or <img />\r\n\t\t\t\t\t\tif (!empty) {\r\n\t\t\t\t\t\t\tnode = newNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check if we are inside a whitespace preserved element\r\n\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\r\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tend: function(name) {\r\n\t\t\t\t\tvar textNode, elementRule, text, sibling, tempNode;\r\n\r\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\r\n\t\t\t\t\tif (elementRule) {\r\n\t\t\t\t\t\tif (blockElements[name]) {\r\n\t\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\r\n\t\t\t\t\t\t\t\t// Trim whitespace of the first node in a block\r\n\t\t\t\t\t\t\t\ttextNode = node.firstChild;\r\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\r\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\r\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\r\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.next;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\r\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\r\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\r\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\r\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Trim whitespace of the last node in a block\r\n\t\t\t\t\t\t\t\ttextNode = node.lastChild;\r\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\r\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(endWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\r\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\r\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.prev;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\r\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\r\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\r\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\r\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Trim start white space\r\n\t\t\t\t\t\t\t// Removed due to: #5424\r\n\t\t\t\t\t\t\t/*textNode = node.prev;\r\n\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\r\n\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\r\n\r\n\t\t\t\t\t\t\t\tif (text.length > 0)\r\n\t\t\t\t\t\t\t\t\ttextNode.value = text;\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\ttextNode.remove();\r\n\t\t\t\t\t\t\t}*/\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check if we exited a whitespace preserved element\r\n\t\t\t\t\t\tif (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\r\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Handle empty nodes\r\n\t\t\t\t\t\tif (elementRule.removeEmpty || elementRule.paddEmpty) {\r\n\t\t\t\t\t\t\tif (node.isEmpty(nonEmptyElements)) {\r\n\t\t\t\t\t\t\t\tif (elementRule.paddEmpty) {\r\n\t\t\t\t\t\t\t\t\tnode.empty().append(new Node('#text', '3')).value = '\\u00a0';\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// Leave nodes that have a name like <a name=\"name\">\r\n\t\t\t\t\t\t\t\t\tif (!node.attributes.map.name && !node.attributes.map.id) {\r\n\t\t\t\t\t\t\t\t\t\ttempNode = node.parent;\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (blockElements[node.name]) {\r\n\t\t\t\t\t\t\t\t\t\t\tnode.empty().remove();\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tnode.unwrap();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tnode = tempNode;\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = node.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, schema);\r\n\r\n\t\t\trootNode = node = new Node(args.context || settings.root_name, 11);\r\n\r\n\t\t\tparser.parse(html);\r\n\r\n\t\t\t// Fix invalid children or report invalid children in a contextual parsing\r\n\t\t\tif (validate && invalidChildren.length) {\r\n\t\t\t\tif (!args.context) {\r\n\t\t\t\t\tfixInvalidChildren(invalidChildren);\r\n\t\t\t\t} else {\r\n\t\t\t\t\targs.invalid = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Wrap nodes in the root into block elements if the root is body\r\n\t\t\tif (rootBlockName && (rootNode.name == 'body' || args.isRootContent)) {\r\n\t\t\t\taddRootBlocks();\r\n\t\t\t}\r\n\r\n\t\t\t// Run filters only when the contents is valid\r\n\t\t\tif (!args.invalid) {\r\n\t\t\t\t// Run node filters\r\n\t\t\t\tfor (name in matchedNodes) {\r\n\t\t\t\t\tlist = nodeFilters[name];\r\n\t\t\t\t\tnodes = matchedNodes[name];\r\n\r\n\t\t\t\t\t// Remove already removed children\r\n\t\t\t\t\tfi = nodes.length;\r\n\t\t\t\t\twhile (fi--) {\r\n\t\t\t\t\t\tif (!nodes[fi].parent) {\r\n\t\t\t\t\t\t\tnodes.splice(fi, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (i = 0, l = list.length; i < l; i++) {\r\n\t\t\t\t\t\tlist[i](nodes, name, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Run attribute filters\r\n\t\t\t\tfor (i = 0, l = attributeFilters.length; i < l; i++) {\r\n\t\t\t\t\tlist = attributeFilters[i];\r\n\r\n\t\t\t\t\tif (list.name in matchedAttributes) {\r\n\t\t\t\t\t\tnodes = matchedAttributes[list.name];\r\n\r\n\t\t\t\t\t\t// Remove already removed children\r\n\t\t\t\t\t\tfi = nodes.length;\r\n\t\t\t\t\t\twhile (fi--) {\r\n\t\t\t\t\t\t\tif (!nodes[fi].parent) {\r\n\t\t\t\t\t\t\t\tnodes.splice(fi, 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\r\n\t\t\t\t\t\t\tlist.callbacks[fi](nodes, list.name, args);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn rootNode;\r\n\t\t};\r\n\r\n\t\t// Remove <br> at end of block elements Gecko and WebKit injects BR elements to\r\n\t\t// make it possible to place the caret inside empty blocks. This logic tries to remove\r\n\t\t// these elements and keep br elements that where intended to be there intact\r\n\t\tif (settings.remove_trailing_brs) {\r\n\t\t\tself.addNodeFilter('br', function(nodes) {\r\n\t\t\t\tvar i, l = nodes.length, node, blockElements = extend({}, schema.getBlockElements());\r\n\t\t\t\tvar nonEmptyElements = schema.getNonEmptyElements(), parent, lastParent, prev, prevName;\r\n\t\t\t\tvar elementRule, textNode;\r\n\r\n\t\t\t\t// Remove brs from body element as well\r\n\t\t\t\tblockElements.body = 1;\r\n\r\n\t\t\t\t// Must loop forwards since it will otherwise remove all brs in <p>a<br><br><br></p>\r\n\t\t\t\tfor (i = 0; i < l; i++) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tparent = node.parent;\r\n\r\n\t\t\t\t\tif (blockElements[node.parent.name] && node === parent.lastChild) {\r\n\t\t\t\t\t\t// Loop all nodes to the left of the current node and check for other BR elements\r\n\t\t\t\t\t\t// excluding bookmarks since they are invisible\r\n\t\t\t\t\t\tprev = node.prev;\r\n\t\t\t\t\t\twhile (prev) {\r\n\t\t\t\t\t\t\tprevName = prev.name;\r\n\r\n\t\t\t\t\t\t\t// Ignore bookmarks\r\n\t\t\t\t\t\t\tif (prevName !== \"span\" || prev.attr('data-mce-type') !== 'bookmark') {\r\n\t\t\t\t\t\t\t\t// Found a non BR element\r\n\t\t\t\t\t\t\t\tif (prevName !== \"br\") {\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Found another br it's a <br><br> structure then don't remove anything\r\n\t\t\t\t\t\t\t\tif (prevName === 'br') {\r\n\t\t\t\t\t\t\t\t\tnode = null;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tprev = prev.prev;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\t\tnode.remove();\r\n\r\n\t\t\t\t\t\t\t// Is the parent to be considered empty after we removed the BR\r\n\t\t\t\t\t\t\tif (parent.isEmpty(nonEmptyElements)) {\r\n\t\t\t\t\t\t\t\telementRule = schema.getElementRule(parent.name);\r\n\r\n\t\t\t\t\t\t\t\t// Remove or padd the element depending on schema rule\r\n\t\t\t\t\t\t\t\tif (elementRule) {\r\n\t\t\t\t\t\t\t\t\tif (elementRule.removeEmpty) {\r\n\t\t\t\t\t\t\t\t\t\tparent.remove();\r\n\t\t\t\t\t\t\t\t\t} else if (elementRule.paddEmpty) {\r\n\t\t\t\t\t\t\t\t\t\tparent.empty().append(new Node('#text', 3)).value = '\\u00a0';\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Replaces BR elements inside inline elements like <p><b><i><br></i></b></p>\r\n\t\t\t\t\t\t// so they become <p><b><i>&nbsp;</i></b></p>\r\n\t\t\t\t\t\tlastParent = node;\r\n\t\t\t\t\t\twhile (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\r\n\t\t\t\t\t\t\tlastParent = parent;\r\n\r\n\t\t\t\t\t\t\tif (blockElements[parent.name]) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tparent = parent.parent;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (lastParent === parent) {\r\n\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\r\n\t\t\t\t\t\t\ttextNode.value = '\\u00a0';\r\n\t\t\t\t\t\t\tnode.replace(textNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Force anchor names closed, unless the setting \"allow_html_in_named_anchor\" is explicitly included.\r\n\t\tif (!settings.allow_html_in_named_anchor) {\r\n\t\t\tself.addAttributeFilter('id,name', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, sibling, prevSibling, parent, node;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tif (node.name === 'a' && node.firstChild && !node.attr('href')) {\r\n\t\t\t\t\t\tparent = node.parent;\r\n\r\n\t\t\t\t\t\t// Move children after current node\r\n\t\t\t\t\t\tsibling = node.lastChild;\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\tprevSibling = sibling.prev;\r\n\t\t\t\t\t\t\tparent.insert(sibling, node);\r\n\t\t\t\t\t\t\tsibling = prevSibling;\r\n\t\t\t\t\t\t} while (sibling);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (settings.validate && schema.getValidClasses()) {\r\n\t\t\tself.addAttributeFilter('class', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, node, classList, ci, className, classValue;\r\n\t\t\t\tvar validClasses = schema.getValidClasses(), validClassesMap, valid;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tclassList = node.attr('class').split(' ');\r\n\t\t\t\t\tclassValue = '';\r\n\r\n\t\t\t\t\tfor (ci = 0; ci < classList.length; ci++) {\r\n\t\t\t\t\t\tclassName = classList[ci];\r\n\t\t\t\t\t\tvalid = false;\r\n\r\n\t\t\t\t\t\tvalidClassesMap = validClasses['*'];\r\n\t\t\t\t\t\tif (validClassesMap && validClassesMap[className]) {\r\n\t\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvalidClassesMap = validClasses[node.name];\r\n\t\t\t\t\t\tif (!valid && validClassesMap && validClassesMap[className]) {\r\n\t\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (valid) {\r\n\t\t\t\t\t\t\tif (classValue) {\r\n\t\t\t\t\t\t\t\tclassValue += ' ';\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tclassValue += className;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!classValue.length) {\r\n\t\t\t\t\t\tclassValue = null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode.attr('class', classValue);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/Writer.js\r\n\r\n/**\r\n * Writer.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is used to write HTML tags out it can be used with the Serializer or the SaxParser.\r\n *\r\n * @class tinymce.html.Writer\r\n * @example\r\n * var writer = new tinymce.html.Writer({indent: true});\r\n * var parser = new tinymce.html.SaxParser(writer).parse('<p><br></p>');\r\n * console.log(writer.getContent());\r\n *\r\n * @class tinymce.html.Writer\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/Writer\", [\r\n\t\"tinymce/html/Entities\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Entities, Tools) {\r\n\tvar makeMap = Tools.makeMap;\r\n\r\n\t/**\r\n\t * Constructs a new Writer instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method Writer\r\n\t * @param {Object} settings Name/value settings object.\r\n\t */\r\n\treturn function(settings) {\r\n\t\tvar html = [], indent, indentBefore, indentAfter, encode, htmlOutput;\r\n\r\n\t\tsettings = settings || {};\r\n\t\tindent = settings.indent;\r\n\t\tindentBefore = makeMap(settings.indent_before || '');\r\n\t\tindentAfter = makeMap(settings.indent_after || '');\r\n\t\tencode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\r\n\t\thtmlOutput = settings.element_format == \"html\";\r\n\r\n\t\treturn {\r\n\t\t\t/**\r\n\t\t\t * Writes the a start element such as <p id=\"a\">.\r\n\t\t\t *\r\n\t\t\t * @method start\r\n\t\t\t * @param {String} name Name of the element.\r\n\t\t\t * @param {Array} attrs Optional attribute array or undefined if it hasn't any.\r\n\t\t\t * @param {Boolean} empty Optional empty state if the tag should end like <br />.\r\n\t\t\t */\r\n\t\t\tstart: function(name, attrs, empty) {\r\n\t\t\t\tvar i, l, attr, value;\r\n\r\n\t\t\t\tif (indent && indentBefore[name] && html.length > 0) {\r\n\t\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\r\n\t\t\t\t\t\thtml.push('\\n');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\thtml.push('<', name);\r\n\r\n\t\t\t\tif (attrs) {\r\n\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\r\n\t\t\t\t\t\tattr = attrs[i];\r\n\t\t\t\t\t\thtml.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!empty || htmlOutput) {\r\n\t\t\t\t\thtml[html.length] = '>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\thtml[html.length] = ' />';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (empty && indent && indentAfter[name] && html.length > 0) {\r\n\t\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\r\n\t\t\t\t\t\thtml.push('\\n');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Writes the a end element such as </p>.\r\n\t\t\t *\r\n\t\t\t * @method end\r\n\t\t\t * @param {String} name Name of the element.\r\n\t\t\t */\r\n\t\t\tend: function(name) {\r\n\t\t\t\tvar value;\r\n\r\n\t\t\t\t/*if (indent && indentBefore[name] && html.length > 0) {\r\n\t\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\t\tif (value.length > 0 && value !== '\\n')\r\n\t\t\t\t\t\thtml.push('\\n');\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\thtml.push('</', name, '>');\r\n\r\n\t\t\t\tif (indent && indentAfter[name] && html.length > 0) {\r\n\t\t\t\t\tvalue = html[html.length - 1];\r\n\r\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\r\n\t\t\t\t\t\thtml.push('\\n');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Writes a text node.\r\n\t\t\t *\r\n\t\t\t * @method text\r\n\t\t\t * @param {String} text String to write out.\r\n\t\t\t * @param {Boolean} raw Optional raw state if true the contents wont get encoded.\r\n\t\t\t */\r\n\t\t\ttext: function(text, raw) {\r\n\t\t\t\tif (text.length > 0) {\r\n\t\t\t\t\thtml[html.length] = raw ? text : encode(text);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Writes a cdata node such as <![CDATA[data]]>.\r\n\t\t\t *\r\n\t\t\t * @method cdata\r\n\t\t\t * @param {String} text String to write out inside the cdata.\r\n\t\t\t */\r\n\t\t\tcdata: function(text) {\r\n\t\t\t\thtml.push('<![CDATA[', text, ']]>');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Writes a comment node such as <!-- Comment -->.\r\n\t\t\t *\r\n\t\t\t * @method cdata\r\n\t\t\t * @param {String} text String to write out inside the comment.\r\n\t\t\t */\r\n\t\t\tcomment: function(text) {\r\n\t\t\t\thtml.push('<!--', text, '-->');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Writes a PI node such as <?xml attr=\"value\" ?>.\r\n\t\t\t *\r\n\t\t\t * @method pi\r\n\t\t\t * @param {String} name Name of the pi.\r\n\t\t\t * @param {String} text String to write out inside the pi.\r\n\t\t\t */\r\n\t\t\tpi: function(name, text) {\r\n\t\t\t\tif (text) {\r\n\t\t\t\t\thtml.push('<?', name, ' ', encode(text), '?>');\r\n\t\t\t\t} else {\r\n\t\t\t\t\thtml.push('<?', name, '?>');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (indent) {\r\n\t\t\t\t\thtml.push('\\n');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Writes a doctype node such as <!DOCTYPE data>.\r\n\t\t\t *\r\n\t\t\t * @method doctype\r\n\t\t\t * @param {String} text String to write out inside the doctype.\r\n\t\t\t */\r\n\t\t\tdoctype: function(text) {\r\n\t\t\t\thtml.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Resets the internal buffer if one wants to reuse the writer.\r\n\t\t\t *\r\n\t\t\t * @method reset\r\n\t\t\t */\r\n\t\t\treset: function() {\r\n\t\t\t\thtml.length = 0;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns the contents that got serialized.\r\n\t\t\t *\r\n\t\t\t * @method getContent\r\n\t\t\t * @return {String} HTML contents that got written down.\r\n\t\t\t */\r\n\t\t\tgetContent: function() {\r\n\t\t\t\treturn html.join('').replace(/\\n$/, '');\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/html/Serializer.js\r\n\r\n/**\r\n * Serializer.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is used to serialize down the DOM tree into a string using a Writer instance.\r\n *\r\n *\r\n * @example\r\n * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\r\n * @class tinymce.html.Serializer\r\n * @version 3.4\r\n */\r\ndefine(\"tinymce/html/Serializer\", [\r\n\t\"tinymce/html/Writer\",\r\n\t\"tinymce/html/Schema\"\r\n], function(Writer, Schema) {\r\n\t/**\r\n\t * Constructs a new Serializer instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method Serializer\r\n\t * @param {Object} settings Name/value settings object.\r\n\t * @param {tinymce.html.Schema} schema Schema instance to use.\r\n\t */\r\n\treturn function(settings, schema) {\r\n\t\tvar self = this, writer = new Writer(settings);\r\n\r\n\t\tsettings = settings || {};\r\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\r\n\r\n\t\tself.schema = schema = schema || new Schema();\r\n\t\tself.writer = writer;\r\n\r\n\t\t/**\r\n\t\t * Serializes the specified node into a string.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\r\n\t\t * @method serialize\r\n\t\t * @param {tinymce.html.Node} node Node instance to serialize.\r\n\t\t * @return {String} String with HTML based on DOM tree.\r\n\t\t */\r\n\t\tself.serialize = function(node) {\r\n\t\t\tvar handlers, validate;\r\n\r\n\t\t\tvalidate = settings.validate;\r\n\r\n\t\t\thandlers = {\r\n\t\t\t\t// #text\r\n\t\t\t\t3: function(node) {\r\n\t\t\t\t\twriter.text(node.value, node.raw);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// #comment\r\n\t\t\t\t8: function(node) {\r\n\t\t\t\t\twriter.comment(node.value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Processing instruction\r\n\t\t\t\t7: function(node) {\r\n\t\t\t\t\twriter.pi(node.name, node.value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Doctype\r\n\t\t\t\t10: function(node) {\r\n\t\t\t\t\twriter.doctype(node.value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// CDATA\r\n\t\t\t\t4: function(node) {\r\n\t\t\t\t\twriter.cdata(node.value);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Document fragment\r\n\t\t\t\t11: function(node) {\r\n\t\t\t\t\tif ((node = node.firstChild)) {\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\twalk(node);\r\n\t\t\t\t\t\t} while ((node = node.next));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twriter.reset();\r\n\r\n\t\t\tfunction walk(node) {\r\n\t\t\t\tvar handler = handlers[node.type], name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\r\n\r\n\t\t\t\tif (!handler) {\r\n\t\t\t\t\tname = node.name;\r\n\t\t\t\t\tisEmpty = node.shortEnded;\r\n\t\t\t\t\tattrs = node.attributes;\r\n\r\n\t\t\t\t\t// Sort attributes\r\n\t\t\t\t\tif (validate && attrs && attrs.length > 1) {\r\n\t\t\t\t\t\tsortedAttrs = [];\r\n\t\t\t\t\t\tsortedAttrs.map = {};\r\n\r\n\t\t\t\t\t\telementRule = schema.getElementRule(node.name);\r\n\t\t\t\t\t\tif (elementRule) {\r\n\t\t\t\t\t\t\tfor (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\r\n\t\t\t\t\t\t\t\tattrName = elementRule.attributesOrder[i];\r\n\r\n\t\t\t\t\t\t\t\tif (attrName in attrs.map) {\r\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\r\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\r\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\r\n\t\t\t\t\t\t\t\tattrName = attrs[i].name;\r\n\r\n\t\t\t\t\t\t\t\tif (!(attrName in sortedAttrs.map)) {\r\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\r\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\r\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tattrs = sortedAttrs;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twriter.start(node.name, attrs, isEmpty);\r\n\r\n\t\t\t\t\tif (!isEmpty) {\r\n\t\t\t\t\t\tif ((node = node.firstChild)) {\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\twalk(node);\r\n\t\t\t\t\t\t\t} while ((node = node.next));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\twriter.end(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\thandler(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Serialize element and treat all non elements as fragments\r\n\t\t\tif (node.type == 1 && !settings.inner) {\r\n\t\t\t\twalk(node);\r\n\t\t\t} else {\r\n\t\t\t\thandlers[11](node);\r\n\t\t\t}\r\n\r\n\t\t\treturn writer.getContent();\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/Serializer.js\r\n\r\n/**\r\n * Serializer.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is used to serialize DOM trees into a string. Consult the TinyMCE Wiki API for\r\n * more details and examples on how to use this class.\r\n *\r\n * @class tinymce.dom.Serializer\r\n */\r\ndefine(\"tinymce/dom/Serializer\", [\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/html/DomParser\",\r\n\t\"tinymce/html/SaxParser\",\r\n\t\"tinymce/html/Entities\",\r\n\t\"tinymce/html/Serializer\",\r\n\t\"tinymce/html/Node\",\r\n\t\"tinymce/html/Schema\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/text/Zwsp\"\r\n], function(DOMUtils, DomParser, SaxParser, Entities, Serializer, Node, Schema, Env, Tools, Zwsp) {\r\n\tvar each = Tools.each, trim = Tools.trim;\r\n\tvar DOM = DOMUtils.DOM, tempAttrs = [\"data-mce-selected\"];\r\n\r\n\t/**\r\n\t * IE 11 has a fantastic bug where it will produce two trailing BR elements to iframe bodies when\r\n\t * the iframe is hidden by display: none on a parent container. The DOM is actually out of sync\r\n\t * with innerHTML in this case. It's like IE adds shadow DOM BR elements that appears on innerHTML\r\n\t * but not as the lastChild of the body. So this fix simply removes the last two\r\n\t * BR elements at the end of the document.\r\n\t *\r\n\t * Example of what happens: <body>text</body> becomes <body>text<br><br></body>\r\n\t */\r\n\tfunction trimTrailingBr(rootNode) {\r\n\t\tvar brNode1, brNode2;\r\n\r\n\t\tfunction isBr(node) {\r\n\t\t\treturn node && node.name === 'br';\r\n\t\t}\r\n\r\n\t\tbrNode1 = rootNode.lastChild;\r\n\t\tif (isBr(brNode1)) {\r\n\t\t\tbrNode2 = brNode1.prev;\r\n\r\n\t\t\tif (isBr(brNode2)) {\r\n\t\t\t\tbrNode1.remove();\r\n\t\t\t\tbrNode2.remove();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Constructs a new DOM serializer class.\r\n\t *\r\n\t * @constructor\r\n\t * @method Serializer\r\n\t * @param {Object} settings Serializer settings object.\r\n\t * @param {tinymce.Editor} editor Optional editor to bind events to and get schema/dom from.\r\n\t */\r\n\treturn function(settings, editor) {\r\n\t\tvar dom, schema, htmlParser;\r\n\r\n\t\tif (editor) {\r\n\t\t\tdom = editor.dom;\r\n\t\t\tschema = editor.schema;\r\n\t\t}\r\n\r\n\t\tfunction trimHtml(html) {\r\n\t\t\tvar trimContentRegExp = new RegExp([\r\n\t\t\t\t'<span[^>]+data-mce-bogus[^>]+>[\\u200B\\uFEFF]+<\\\\/span>', // Trim bogus spans like caret containers\r\n\t\t\t\t'\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"' // Trim temporaty data-mce prefixed attributes like data-mce-selected\r\n\t\t\t].join('|'), 'gi');\r\n\r\n\t\t\thtml = Zwsp.trim(html.replace(trimContentRegExp, ''));\r\n\r\n\t\t\treturn html;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns a trimmed version of the editor contents to be used for the undo level. This\r\n\t\t * will remove any data-mce-bogus=\"all\" marked elements since these are used for UI it will also\r\n\t\t * remove the data-mce-selected attributes used for selection of objects and caret containers.\r\n\t\t * It will keep all data-mce-bogus=\"1\" elements since these can be used to place the caret etc and will\r\n\t\t * be removed by the serialization logic when you save.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @return {String} HTML contents of the editor excluding some internal bogus elements.\r\n\t\t */\r\n\t\tfunction getTrimmedContent() {\r\n\t\t\tvar content = editor.getBody().innerHTML;\r\n\t\t\tvar bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\r\n\t\t\tvar endTagIndex, index, matchLength, matches, shortEndedElements, schema = editor.schema;\r\n\r\n\t\t\tcontent = trimHtml(content);\r\n\t\t\tshortEndedElements = schema.getShortEndedElements();\r\n\r\n\t\t\t// Remove all bogus elements marked with \"all\"\r\n\t\t\twhile ((matches = bogusAllRegExp.exec(content))) {\r\n\t\t\t\tindex = bogusAllRegExp.lastIndex;\r\n\t\t\t\tmatchLength = matches[0].length;\r\n\r\n\t\t\t\tif (shortEndedElements[matches[1]]) {\r\n\t\t\t\t\tendTagIndex = index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tendTagIndex = SaxParser.findEndTag(schema, content, index);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontent = content.substring(0, index - matchLength) + content.substring(endTagIndex);\r\n\t\t\t\tbogusAllRegExp.lastIndex = index - matchLength;\r\n\t\t\t}\r\n\r\n\t\t\treturn trim(content);\r\n\t\t}\r\n\r\n\t\tfunction addTempAttr(name) {\r\n\t\t\tif (Tools.inArray(tempAttrs, name) === -1) {\r\n\t\t\t\thtmlParser.addAttributeFilter(name, function(nodes, name) {\r\n\t\t\t\t\tvar i = nodes.length;\r\n\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tnodes[i].attr(name, null);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttempAttrs.push(name);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Default DOM and Schema if they are undefined\r\n\t\tdom = dom || DOM;\r\n\t\tschema = schema || new Schema(settings);\r\n\t\tsettings.entity_encoding = settings.entity_encoding || 'named';\r\n\t\tsettings.remove_trailing_brs = \"remove_trailing_brs\" in settings ? settings.remove_trailing_brs : true;\r\n\r\n\t\thtmlParser = new DomParser(settings, schema);\r\n\r\n\t\t// Convert tabindex back to elements when serializing contents\r\n\t\thtmlParser.addAttributeFilter('data-mce-tabindex', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\t\t\t\tnode.attr('tabindex', node.attributes.map['data-mce-tabindex']);\r\n\t\t\t\tnode.attr(name, null);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Convert move data-mce-src, data-mce-href and data-mce-style into nodes or process them if needed\r\n\t\thtmlParser.addAttributeFilter('src,href,style', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node, value, internalName = 'data-mce-' + name;\r\n\t\t\tvar urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope, undef;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\tvalue = node.attributes.map[internalName];\r\n\t\t\t\tif (value !== undef) {\r\n\t\t\t\t\t// Set external name to internal value and remove internal\r\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\r\n\t\t\t\t\tnode.attr(internalName, null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// No internal attribute found then convert the value we have in the DOM\r\n\t\t\t\t\tvalue = node.attributes.map[name];\r\n\r\n\t\t\t\t\tif (name === \"style\") {\r\n\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\r\n\t\t\t\t\t} else if (urlConverter) {\r\n\t\t\t\t\t\tvalue = urlConverter.call(urlConverterScope, value, name, node.name);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Remove internal classes mceItem<..> or mceSelected\r\n\t\thtmlParser.addAttributeFilter('class', function(nodes) {\r\n\t\t\tvar i = nodes.length, node, value;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\t\t\t\tvalue = node.attr('class');\r\n\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\tvalue = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\r\n\t\t\t\t\tnode.attr('class', value.length > 0 ? value : null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Remove bookmark elements\r\n\t\thtmlParser.addAttributeFilter('data-mce-type', function(nodes, name, args) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\tif (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup) {\r\n\t\t\t\t\tnode.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\thtmlParser.addNodeFilter('noscript', function(nodes) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i].firstChild;\r\n\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tnode.value = Entities.decode(node.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Force script into CDATA sections and remove the mce- prefix also add comments around styles\r\n\t\thtmlParser.addNodeFilter('script,style', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node, value, type;\r\n\r\n\t\t\tfunction trim(value) {\r\n\t\t\t\t/*jshint maxlen:255 */\r\n\t\t\t\t/*eslint max-len:0 */\r\n\t\t\t\treturn value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n')\r\n\t\t\t\t\t\t.replace(/^[\\r\\n]*|[\\r\\n]*$/g, '')\r\n\t\t\t\t\t\t.replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '')\r\n\t\t\t\t\t\t.replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\r\n\t\t\t}\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\t\t\t\tvalue = node.firstChild ? node.firstChild.value : '';\r\n\r\n\t\t\t\tif (name === \"script\") {\r\n\t\t\t\t\t// Remove mce- prefix from script elements and remove default type since the user specified\r\n\t\t\t\t\t// a script element without type attribute\r\n\t\t\t\t\ttype = node.attr('type');\r\n\t\t\t\t\tif (type) {\r\n\t\t\t\t\t\tnode.attr('type', type == 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (value.length > 0) {\r\n\t\t\t\t\t\tnode.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (value.length > 0) {\r\n\t\t\t\t\t\tnode.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Convert comments to cdata and handle protected comments\r\n\t\thtmlParser.addNodeFilter('#comment', function(nodes) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\tif (node.value.indexOf('[CDATA[') === 0) {\r\n\t\t\t\t\tnode.name = '#cdata';\r\n\t\t\t\t\tnode.type = 4;\r\n\t\t\t\t\tnode.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\r\n\t\t\t\t} else if (node.value.indexOf('mce:protected ') === 0) {\r\n\t\t\t\t\tnode.name = \"#text\";\r\n\t\t\t\t\tnode.type = 3;\r\n\t\t\t\t\tnode.raw = true;\r\n\t\t\t\t\tnode.value = unescape(node.value).substr(14);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\thtmlParser.addNodeFilter('xml:namespace,input', function(nodes, name) {\r\n\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnode = nodes[i];\r\n\t\t\t\tif (node.type === 7) {\r\n\t\t\t\t\tnode.remove();\r\n\t\t\t\t} else if (node.type === 1) {\r\n\t\t\t\t\tif (name === \"input\" && !(\"type\" in node.attributes.map)) {\r\n\t\t\t\t\t\tnode.attr('type', 'text');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Fix list elements, TODO: Replace this later\r\n\t\tif (settings.fix_list_elements) {\r\n\t\t\thtmlParser.addNodeFilter('ul,ol', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, node, parentNode;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tparentNode = node.parent;\r\n\r\n\t\t\t\t\tif (parentNode.name === 'ul' || parentNode.name === 'ol') {\r\n\t\t\t\t\t\tif (node.prev && node.prev.name === 'li') {\r\n\t\t\t\t\t\t\tnode.prev.append(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Remove internal data attributes\r\n\t\thtmlParser.addAttributeFilter(\r\n\t\t\t'data-mce-src,data-mce-href,data-mce-style,' +\r\n\t\t\t'data-mce-selected,data-mce-expando,' +\r\n\t\t\t'data-mce-type,data-mce-resize',\r\n\r\n\t\t\tfunction(nodes, name) {\r\n\t\t\t\tvar i = nodes.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnodes[i].attr(name, null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\t// Return public methods\r\n\t\treturn {\r\n\t\t\t/**\r\n\t\t\t * Schema instance that was used to when the Serializer was constructed.\r\n\t\t\t *\r\n\t\t\t * @field {tinymce.html.Schema} schema\r\n\t\t\t */\r\n\t\t\tschema: schema,\r\n\r\n\t\t\t/**\r\n\t\t\t * Adds a node filter function to the parser used by the serializer, the parser will collect the specified nodes by name\r\n\t\t\t * and then execute the callback ones it has finished parsing the document.\r\n\t\t\t *\r\n\t\t\t * @example\r\n\t\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\r\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\r\n\t\t\t *\t\t}\r\n\t\t\t * });\r\n\t\t\t * @method addNodeFilter\r\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\r\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\r\n\t\t\t */\r\n\t\t\taddNodeFilter: htmlParser.addNodeFilter,\r\n\r\n\t\t\t/**\r\n\t\t\t * Adds a attribute filter function to the parser used by the serializer, the parser will\r\n\t\t\t * collect nodes that has the specified attributes\r\n\t\t\t * and then execute the callback ones it has finished parsing the document.\r\n\t\t\t *\r\n\t\t\t * @example\r\n\t\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\r\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\r\n\t\t\t *\t\t}\r\n\t\t\t * });\r\n\t\t\t * @method addAttributeFilter\r\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\r\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\r\n\t\t\t */\r\n\t\t\taddAttributeFilter: htmlParser.addAttributeFilter,\r\n\r\n\t\t\t/**\r\n\t\t\t * Serializes the specified browser DOM node into a HTML string.\r\n\t\t\t *\r\n\t\t\t * @method serialize\r\n\t\t\t * @param {DOMNode} node DOM node to serialize.\r\n\t\t\t * @param {Object} args Arguments option that gets passed to event handlers.\r\n\t\t\t */\r\n\t\t\tserialize: function(node, args) {\r\n\t\t\t\tvar self = this, impl, doc, oldDoc, htmlSerializer, content, rootNode;\r\n\r\n\t\t\t\t// Explorer won't clone contents of script and style and the\r\n\t\t\t\t// selected index of select elements are cleared on a clone operation.\r\n\t\t\t\tif (Env.ie && dom.select('script,style,select,map').length > 0) {\r\n\t\t\t\t\tcontent = node.innerHTML;\r\n\t\t\t\t\tnode = node.cloneNode(false);\r\n\t\t\t\t\tdom.setHTML(node, content);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnode = node.cloneNode(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Nodes needs to be attached to something in WebKit/Opera\r\n\t\t\t\t// This fix will make DOM ranges and make Sizzle happy!\r\n\t\t\t\timpl = node.ownerDocument.implementation;\r\n\t\t\t\tif (impl.createHTMLDocument) {\r\n\t\t\t\t\t// Create an empty HTML document\r\n\t\t\t\t\tdoc = impl.createHTMLDocument(\"\");\r\n\r\n\t\t\t\t\t// Add the element or it's children if it's a body element to the new document\r\n\t\t\t\t\teach(node.nodeName == 'BODY' ? node.childNodes : [node], function(node) {\r\n\t\t\t\t\t\tdoc.body.appendChild(doc.importNode(node, true));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Grab first child or body element for serialization\r\n\t\t\t\t\tif (node.nodeName != 'BODY') {\r\n\t\t\t\t\t\tnode = doc.body.firstChild;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnode = doc.body;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// set the new document in DOMUtils so createElement etc works\r\n\t\t\t\t\toldDoc = dom.doc;\r\n\t\t\t\t\tdom.doc = doc;\r\n\t\t\t\t}\r\n\r\n\t\t\t\targs = args || {};\r\n\t\t\t\targs.format = args.format || 'html';\r\n\r\n\t\t\t\t// Don't wrap content if we want selected html\r\n\t\t\t\tif (args.selection) {\r\n\t\t\t\t\targs.forced_root_block = '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pre process\r\n\t\t\t\tif (!args.no_events) {\r\n\t\t\t\t\targs.node = node;\r\n\t\t\t\t\tself.onPreProcess(args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Parse HTML\r\n\t\t\t\trootNode = htmlParser.parse(trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node)), args);\r\n\t\t\t\ttrimTrailingBr(rootNode);\r\n\r\n\t\t\t\t// Serialize HTML\r\n\t\t\t\thtmlSerializer = new Serializer(settings, schema);\r\n\t\t\t\targs.content = htmlSerializer.serialize(rootNode);\r\n\r\n\t\t\t\t// Replace all BOM characters for now until we can find a better solution\r\n\t\t\t\tif (!args.cleanup) {\r\n\t\t\t\t\targs.content = Zwsp.trim(args.content);\r\n\t\t\t\t\targs.content = args.content.replace(/\\uFEFF/g, '');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Post process\r\n\t\t\t\tif (!args.no_events) {\r\n\t\t\t\t\tself.onPostProcess(args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Restore the old document if it was changed\r\n\t\t\t\tif (oldDoc) {\r\n\t\t\t\t\tdom.doc = oldDoc;\r\n\t\t\t\t}\r\n\r\n\t\t\t\targs.node = null;\r\n\r\n\t\t\t\treturn args.content;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Adds valid elements rules to the serializers schema instance this enables you to specify things\r\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\r\n\t\t\t * Consult the Wiki for more details on this format.\r\n\t\t\t *\r\n\t\t\t * @method addRules\r\n\t\t\t * @param {String} rules Valid elements rules string to add to schema.\r\n\t\t\t */\r\n\t\t\taddRules: function(rules) {\r\n\t\t\t\tschema.addValidElements(rules);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Sets the valid elements rules to the serializers schema instance this enables you to specify things\r\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\r\n\t\t\t * Consult the Wiki for more details on this format.\r\n\t\t\t *\r\n\t\t\t * @method setRules\r\n\t\t\t * @param {String} rules Valid elements rules string.\r\n\t\t\t */\r\n\t\t\tsetRules: function(rules) {\r\n\t\t\t\tschema.setValidElements(rules);\r\n\t\t\t},\r\n\r\n\t\t\tonPreProcess: function(args) {\r\n\t\t\t\tif (editor) {\r\n\t\t\t\t\teditor.fire('PreProcess', args);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tonPostProcess: function(args) {\r\n\t\t\t\tif (editor) {\r\n\t\t\t\t\teditor.fire('PostProcess', args);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Adds a temporary internal attribute these attributes will get removed on undo and\r\n\t\t\t * when getting contents out of the editor.\r\n\t\t\t *\r\n\t\t\t * @method addTempAttr\r\n\t\t\t * @param {String} name string\r\n\t\t\t */\r\n\t\t\taddTempAttr: addTempAttr,\r\n\r\n\t\t\t// Internal\r\n\t\t\ttrimHtml: trimHtml,\r\n\t\t\tgetTrimmedContent: getTrimmedContent\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/TridentSelection.js\r\n\r\n/**\r\n * TridentSelection.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Selection class for old explorer versions. This one fakes the\r\n * native selection object available on modern browsers.\r\n *\r\n * @private\r\n * @class tinymce.dom.TridentSelection\r\n */\r\ndefine(\"tinymce/dom/TridentSelection\", [], function() {\r\n\tfunction Selection(selection) {\r\n\t\tvar self = this, dom = selection.dom, FALSE = false;\r\n\r\n\t\tfunction getPosition(rng, start) {\r\n\t\t\tvar checkRng, startIndex = 0, endIndex, inside,\r\n\t\t\t\tchildren, child, offset, index, position = -1, parent;\r\n\r\n\t\t\t// Setup test range, collapse it and get the parent\r\n\t\t\tcheckRng = rng.duplicate();\r\n\t\t\tcheckRng.collapse(start);\r\n\t\t\tparent = checkRng.parentElement();\r\n\r\n\t\t\t// Check if the selection is within the right document\r\n\t\t\tif (parent.ownerDocument !== selection.dom.doc) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// IE will report non editable elements as it's parent so look for an editable one\r\n\t\t\twhile (parent.contentEditable === \"false\") {\r\n\t\t\t\tparent = parent.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// If parent doesn't have any children then return that we are inside the element\r\n\t\t\tif (!parent.hasChildNodes()) {\r\n\t\t\t\treturn {node: parent, inside: 1};\r\n\t\t\t}\r\n\r\n\t\t\t// Setup node list and endIndex\r\n\t\t\tchildren = parent.children;\r\n\t\t\tendIndex = children.length - 1;\r\n\r\n\t\t\t// Perform a binary search for the position\r\n\t\t\twhile (startIndex <= endIndex) {\r\n\t\t\t\tindex = Math.floor((startIndex + endIndex) / 2);\r\n\r\n\t\t\t\t// Move selection to node and compare the ranges\r\n\t\t\t\tchild = children[index];\r\n\t\t\t\tcheckRng.moveToElementText(child);\r\n\t\t\t\tposition = checkRng.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', rng);\r\n\r\n\t\t\t\t// Before/after or an exact match\r\n\t\t\t\tif (position > 0) {\r\n\t\t\t\t\tendIndex = index - 1;\r\n\t\t\t\t} else if (position < 0) {\r\n\t\t\t\t\tstartIndex = index + 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn {node: child};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if child position is before or we didn't find a position\r\n\t\t\tif (position < 0) {\r\n\t\t\t\t// No element child was found use the parent element and the offset inside that\r\n\t\t\t\tif (!child) {\r\n\t\t\t\t\tcheckRng.moveToElementText(parent);\r\n\t\t\t\t\tcheckRng.collapse(true);\r\n\t\t\t\t\tchild = parent;\r\n\t\t\t\t\tinside = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcheckRng.collapse(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint,\r\n\t\t\t\t// hit the end of document or parent isn't the right one\r\n\t\t\t\t// We need to walk char by char since rng.text or rng.htmlText will trim line endings\r\n\t\t\t\toffset = 0;\r\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\r\n\t\t\t\t\tif (checkRng.move('character', 1) === 0 || parent != checkRng.parentElement()) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toffset++;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Child position is after the selection endpoint\r\n\t\t\t\tcheckRng.collapse(true);\r\n\r\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint, hit\r\n\t\t\t\t// the end of document or parent isn't the right one\r\n\t\t\t\toffset = 0;\r\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\r\n\t\t\t\t\tif (checkRng.move('character', -1) === 0 || parent != checkRng.parentElement()) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toffset++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {node: child, position: position, offset: offset, inside: inside};\r\n\t\t}\r\n\r\n\t\t// Returns a W3C DOM compatible range object by using the IE Range API\r\n\t\tfunction getRange() {\r\n\t\t\tvar ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed, tmpRange, element2, bookmark;\r\n\r\n\t\t\t// If selection is outside the current document just return an empty range\r\n\t\t\telement = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\r\n\t\t\tif (element.ownerDocument != dom.doc) {\r\n\t\t\t\treturn domRange;\r\n\t\t\t}\r\n\r\n\t\t\tcollapsed = selection.isCollapsed();\r\n\r\n\t\t\t// Handle control selection\r\n\t\t\tif (ieRange.item) {\r\n\t\t\t\tdomRange.setStart(element.parentNode, dom.nodeIndex(element));\r\n\t\t\t\tdomRange.setEnd(domRange.startContainer, domRange.startOffset + 1);\r\n\r\n\t\t\t\treturn domRange;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findEndPoint(start) {\r\n\t\t\t\tvar endPoint = getPosition(ieRange, start), container, offset, textNodeOffset = 0, sibling, undef, nodeValue;\r\n\r\n\t\t\t\tcontainer = endPoint.node;\r\n\t\t\t\toffset = endPoint.offset;\r\n\r\n\t\t\t\tif (endPoint.inside && !container.hasChildNodes()) {\r\n\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, 0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offset === undef) {\r\n\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndAfter'](container);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (endPoint.position < 0) {\r\n\t\t\t\t\tsibling = endPoint.inside ? container.firstChild : container.nextSibling;\r\n\r\n\t\t\t\t\tif (!sibling) {\r\n\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](container);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!offset) {\r\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, 0);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndBefore'](sibling);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Find the text node and offset\r\n\t\t\t\t\twhile (sibling) {\r\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\r\n\t\t\t\t\t\t\tnodeValue = sibling.nodeValue;\r\n\t\t\t\t\t\t\ttextNodeOffset += nodeValue.length;\r\n\r\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\r\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\r\n\t\t\t\t\t\t\t\tcontainer = sibling;\r\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\r\n\t\t\t\t\t\t\t\ttextNodeOffset = nodeValue.length - textNodeOffset;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = sibling.nextSibling;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Find the text node and offset\r\n\t\t\t\t\tsibling = container.previousSibling;\r\n\r\n\t\t\t\t\tif (!sibling) {\r\n\t\t\t\t\t\treturn domRange[start ? 'setStartBefore' : 'setEndBefore'](container);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If there isn't any text to loop then use the first position\r\n\t\t\t\t\tif (!offset) {\r\n\t\t\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, container.nodeValue.length);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](sibling);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twhile (sibling) {\r\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\r\n\t\t\t\t\t\t\ttextNodeOffset += sibling.nodeValue.length;\r\n\r\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\r\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\r\n\t\t\t\t\t\t\t\tcontainer = sibling;\r\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = sibling.previousSibling;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, textNodeOffset);\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// Find start point\r\n\t\t\t\tfindEndPoint(true);\r\n\r\n\t\t\t\t// Find end point if needed\r\n\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\tfindEndPoint();\r\n\t\t\t\t}\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// IE has a nasty bug where text nodes might throw \"invalid argument\" when you\r\n\t\t\t\t// access the nodeValue or other properties of text nodes. This seems to happen when\r\n\t\t\t\t// text nodes are split into two nodes by a delete/backspace call.\r\n\t\t\t\t// So let us detect and try to fix it.\r\n\t\t\t\tif (ex.number == -2147024809) {\r\n\t\t\t\t\t// Get the current selection\r\n\t\t\t\t\tbookmark = self.getBookmark(2);\r\n\r\n\t\t\t\t\t// Get start element\r\n\t\t\t\t\ttmpRange = ieRange.duplicate();\r\n\t\t\t\t\ttmpRange.collapse(true);\r\n\t\t\t\t\telement = tmpRange.parentElement();\r\n\r\n\t\t\t\t\t// Get end element\r\n\t\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\t\ttmpRange = ieRange.duplicate();\r\n\t\t\t\t\t\ttmpRange.collapse(false);\r\n\t\t\t\t\t\telement2 = tmpRange.parentElement();\r\n\t\t\t\t\t\telement2.innerHTML = element2.innerHTML;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove the broken elements\r\n\t\t\t\t\telement.innerHTML = element.innerHTML;\r\n\r\n\t\t\t\t\t// Restore the selection\r\n\t\t\t\t\tself.moveToBookmark(bookmark);\r\n\r\n\t\t\t\t\t// Since the range has moved we need to re-get it\r\n\t\t\t\t\tieRange = selection.getRng();\r\n\r\n\t\t\t\t\t// Find start point\r\n\t\t\t\t\tfindEndPoint(true);\r\n\r\n\t\t\t\t\t// Find end point if needed\r\n\t\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\t\tfindEndPoint();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow ex; // Throw other errors\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn domRange;\r\n\t\t}\r\n\r\n\t\tthis.getBookmark = function(type) {\r\n\t\t\tvar rng = selection.getRng(), bookmark = {};\r\n\r\n\t\t\tfunction getIndexes(node) {\r\n\t\t\t\tvar parent, root, children, i, indexes = [];\r\n\r\n\t\t\t\tparent = node.parentNode;\r\n\t\t\t\troot = dom.getRoot().parentNode;\r\n\r\n\t\t\t\twhile (parent != root && parent.nodeType !== 9) {\r\n\t\t\t\t\tchildren = parent.children;\r\n\r\n\t\t\t\t\ti = children.length;\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tif (node === children[i]) {\r\n\t\t\t\t\t\t\tindexes.push(i);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = parent;\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn indexes;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getBookmarkEndPoint(start) {\r\n\t\t\t\tvar position;\r\n\r\n\t\t\t\tposition = getPosition(rng, start);\r\n\t\t\t\tif (position) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tposition: position.position,\r\n\t\t\t\t\t\toffset: position.offset,\r\n\t\t\t\t\t\tindexes: getIndexes(position.node),\r\n\t\t\t\t\t\tinside: position.inside\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Non ubstructive bookmark\r\n\t\t\tif (type === 2) {\r\n\t\t\t\t// Handle text selection\r\n\t\t\t\tif (!rng.item) {\r\n\t\t\t\t\tbookmark.start = getBookmarkEndPoint(true);\r\n\r\n\t\t\t\t\tif (!selection.isCollapsed()) {\r\n\t\t\t\t\t\tbookmark.end = getBookmarkEndPoint();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbookmark.start = {ctrl: true, indexes: getIndexes(rng.item(0))};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn bookmark;\r\n\t\t};\r\n\r\n\t\tthis.moveToBookmark = function(bookmark) {\r\n\t\t\tvar rng, body = dom.doc.body;\r\n\r\n\t\t\tfunction resolveIndexes(indexes) {\r\n\t\t\t\tvar node, i, idx, children;\r\n\r\n\t\t\t\tnode = dom.getRoot();\r\n\t\t\t\tfor (i = indexes.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tchildren = node.children;\r\n\t\t\t\t\tidx = indexes[i];\r\n\r\n\t\t\t\t\tif (idx <= children.length - 1) {\r\n\t\t\t\t\t\tnode = children[idx];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\r\n\t\t\tfunction setBookmarkEndPoint(start) {\r\n\t\t\t\tvar endPoint = bookmark[start ? 'start' : 'end'], moveLeft, moveRng, undef, offset;\r\n\r\n\t\t\t\tif (endPoint) {\r\n\t\t\t\t\tmoveLeft = endPoint.position > 0;\r\n\r\n\t\t\t\t\tmoveRng = body.createTextRange();\r\n\t\t\t\t\tmoveRng.moveToElementText(resolveIndexes(endPoint.indexes));\r\n\r\n\t\t\t\t\toffset = endPoint.offset;\r\n\t\t\t\t\tif (offset !== undef) {\r\n\t\t\t\t\t\tmoveRng.collapse(endPoint.inside || moveLeft);\r\n\t\t\t\t\t\tmoveRng.moveStart('character', moveLeft ? -offset : offset);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmoveRng.collapse(start);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trng.setEndPoint(start ? 'StartToStart' : 'EndToStart', moveRng);\r\n\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\trng.collapse(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (bookmark.start) {\r\n\t\t\t\tif (bookmark.start.ctrl) {\r\n\t\t\t\t\trng = body.createControlRange();\r\n\t\t\t\t\trng.addElement(resolveIndexes(bookmark.start.indexes));\r\n\t\t\t\t\trng.select();\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng = body.createTextRange();\r\n\t\t\t\t\tsetBookmarkEndPoint(true);\r\n\t\t\t\t\tsetBookmarkEndPoint();\r\n\t\t\t\t\trng.select();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.addRange = function(rng) {\r\n\t\t\tvar ieRng, ctrlRng, startContainer, startOffset, endContainer, endOffset, sibling,\r\n\t\t\t\tdoc = selection.dom.doc, body = doc.body, nativeRng, ctrlElm;\r\n\r\n\t\t\tfunction setEndPoint(start) {\r\n\t\t\t\tvar container, offset, marker, tmpRng, nodes;\r\n\r\n\t\t\t\tmarker = dom.create('a');\r\n\t\t\t\tcontainer = start ? startContainer : endContainer;\r\n\t\t\t\toffset = start ? startOffset : endOffset;\r\n\t\t\t\ttmpRng = ieRng.duplicate();\r\n\r\n\t\t\t\tif (container == doc || container == doc.documentElement) {\r\n\t\t\t\t\tcontainer = body;\r\n\t\t\t\t\toffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\tcontainer.parentNode.insertBefore(marker, container);\r\n\t\t\t\t\ttmpRng.moveToElementText(marker);\r\n\t\t\t\t\ttmpRng.moveStart('character', offset);\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnodes = container.childNodes;\r\n\r\n\t\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\t\tif (offset >= nodes.length) {\r\n\t\t\t\t\t\t\tdom.insertAfter(marker, nodes[nodes.length - 1]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcontainer.insertBefore(marker, nodes[offset]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\r\n\t\t\t\t\t} else if (container.canHaveHTML) {\r\n\t\t\t\t\t\t// Empty node selection for example <div>|</div>\r\n\t\t\t\t\t\t// Setting innerHTML with a span marker then remove that marker seems to keep empty block elements open\r\n\t\t\t\t\t\tcontainer.innerHTML = '<span>&#xFEFF;</span>';\r\n\t\t\t\t\t\tmarker = container.firstChild;\r\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\r\n\t\t\t\t\t\ttmpRng.collapse(FALSE); // Collapse false works better than true for some odd reason\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\r\n\t\t\t\t\tdom.remove(marker);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setup some shorter versions\r\n\t\t\tstartContainer = rng.startContainer;\r\n\t\t\tstartOffset = rng.startOffset;\r\n\t\t\tendContainer = rng.endContainer;\r\n\t\t\tendOffset = rng.endOffset;\r\n\t\t\tieRng = body.createTextRange();\r\n\r\n\t\t\t// If single element selection then try making a control selection out of it\r\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 1) {\r\n\t\t\t\t// Trick to place the caret inside an empty block element like <p></p>\r\n\t\t\t\tif (startOffset == endOffset && !startContainer.hasChildNodes()) {\r\n\t\t\t\t\tif (startContainer.canHaveHTML) {\r\n\t\t\t\t\t\t// Check if previous sibling is an empty block if it is then we need to render it\r\n\t\t\t\t\t\t// IE would otherwise move the caret into the sibling instead of the empty startContainer see: #5236\r\n\t\t\t\t\t\t// Example this: <p></p><p>|</p> would become this: <p>|</p><p></p>\r\n\t\t\t\t\t\tsibling = startContainer.previousSibling;\r\n\t\t\t\t\t\tif (sibling && !sibling.hasChildNodes() && dom.isBlock(sibling)) {\r\n\t\t\t\t\t\t\tsibling.innerHTML = '&#xFEFF;';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsibling = null;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstartContainer.innerHTML = '<span>&#xFEFF;</span><span>&#xFEFF;</span>';\r\n\t\t\t\t\t\tieRng.moveToElementText(startContainer.lastChild);\r\n\t\t\t\t\t\tieRng.select();\r\n\t\t\t\t\t\tdom.doc.selection.clear();\r\n\t\t\t\t\t\tstartContainer.innerHTML = '';\r\n\r\n\t\t\t\t\t\tif (sibling) {\r\n\t\t\t\t\t\t\tsibling.innerHTML = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\r\n\t\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (startOffset == endOffset - 1) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tctrlElm = startContainer.childNodes[startOffset];\r\n\t\t\t\t\t\tctrlRng = body.createControlRange();\r\n\t\t\t\t\t\tctrlRng.addElement(ctrlElm);\r\n\t\t\t\t\t\tctrlRng.select();\r\n\r\n\t\t\t\t\t\t// Check if the range produced is on the correct element and is a control range\r\n\t\t\t\t\t\t// On IE 8 it will select the parent contentEditable container if you select an inner element see: #5398\r\n\t\t\t\t\t\tnativeRng = selection.getRng();\r\n\t\t\t\t\t\tif (nativeRng.item && ctrlElm === nativeRng.item(0)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set start/end point of selection\r\n\t\t\tsetEndPoint(true);\r\n\t\t\tsetEndPoint();\r\n\r\n\t\t\t// Select the new range and scroll it into view\r\n\t\t\tieRng.select();\r\n\t\t};\r\n\r\n\t\t// Expose range method\r\n\t\tthis.getRangeAt = getRange;\r\n\t}\r\n\r\n\treturn Selection;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/VK.js\r\n\r\n/**\r\n * VK.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This file exposes a set of the common KeyCodes for use. Please grow it as needed.\r\n */\r\ndefine(\"tinymce/util/VK\", [\r\n\t\"tinymce/Env\"\r\n], function(Env) {\r\n\treturn {\r\n\t\tBACKSPACE: 8,\r\n\t\tDELETE: 46,\r\n\t\tDOWN: 40,\r\n\t\tENTER: 13,\r\n\t\tLEFT: 37,\r\n\t\tRIGHT: 39,\r\n\t\tSPACEBAR: 32,\r\n\t\tTAB: 9,\r\n\t\tUP: 38,\r\n\r\n\t\tmodifierPressed: function(e) {\r\n\t\t\treturn e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\r\n\t\t},\r\n\r\n\t\tmetaKeyPressed: function(e) {\r\n\t\t\t// Check if ctrl or meta key is pressed. Edge case for AltGr on Windows where it produces ctrlKey+altKey states\r\n\t\t\treturn (Env.mac ? e.metaKey : e.ctrlKey && !e.altKey);\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/ControlSelection.js\r\n\r\n/**\r\n * ControlSelection.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles control selection of elements. Controls are elements\r\n * that can be resized and needs to be selected as a whole. It adds custom resize handles\r\n * to all browser engines that support properly disabling the built in resize logic.\r\n *\r\n * @class tinymce.dom.ControlSelection\r\n */\r\ndefine(\"tinymce/dom/ControlSelection\", [\r\n\t\"tinymce/util/VK\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/util/Delay\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/dom/NodeType\"\r\n], function(VK, Tools, Delay, Env, NodeType) {\r\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\r\n\r\n\treturn function(selection, editor) {\r\n\t\tvar dom = editor.dom, each = Tools.each;\r\n\t\tvar selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle, lastMouseDownEvent;\r\n\t\tvar startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\r\n\t\tvar width, height, editableDoc = editor.getDoc(), rootDocument = document, isIE = Env.ie && Env.ie < 11;\r\n\t\tvar abs = Math.abs, round = Math.round, rootElement = editor.getBody(), startScrollWidth, startScrollHeight;\r\n\r\n\t\t// Details about each resize handle how to scale etc\r\n\t\tresizeHandles = {\r\n\t\t\t// Name: x multiplier, y multiplier, delta size x, delta size y\r\n\t\t\t/*n: [0.5, 0, 0, -1],\r\n\t\t\te: [1, 0.5, 1, 0],\r\n\t\t\ts: [0.5, 1, 0, 1],\r\n\t\t\tw: [0, 0.5, -1, 0],*/\r\n\t\t\tnw: [0, 0, -1, -1],\r\n\t\t\tne: [1, 0, 1, -1],\r\n\t\t\tse: [1, 1, 1, 1],\r\n\t\t\tsw: [0, 1, -1, 1]\r\n\t\t};\r\n\r\n\t\t// Add CSS for resize handles, cloned element and selected\r\n\t\tvar rootClass = '.mce-content-body';\r\n\t\teditor.contentStyles.push(\r\n\t\t\trootClass + ' div.mce-resizehandle {' +\r\n\t\t\t\t'position: absolute;' +\r\n\t\t\t\t'border: 1px solid black;' +\r\n\t\t\t\t'box-sizing: box-sizing;' +\r\n\t\t\t\t'background: #FFF;' +\r\n\t\t\t\t'width: 7px;' +\r\n\t\t\t\t'height: 7px;' +\r\n\t\t\t\t'z-index: 10000' +\r\n\t\t\t'}' +\r\n\t\t\trootClass + ' .mce-resizehandle:hover {' +\r\n\t\t\t\t'background: #000' +\r\n\t\t\t'}' +\r\n\t\t\trootClass + ' img[data-mce-selected],' + rootClass + ' hr[data-mce-selected] {' +\r\n\t\t\t\t'outline: 1px solid black;' +\r\n\t\t\t\t'resize: none' + // Have been talks about implementing this in browsers\r\n\t\t\t'}' +\r\n\t\t\trootClass + ' .mce-clonedresizable {' +\r\n\t\t\t\t'position: absolute;' +\r\n\t\t\t\t(Env.gecko ? '' : 'outline: 1px dashed black;') + // Gecko produces trails while resizing\r\n\t\t\t\t'opacity: .5;' +\r\n\t\t\t\t'filter: alpha(opacity=50);' +\r\n\t\t\t\t'z-index: 10000' +\r\n\t\t\t'}' +\r\n\t\t\trootClass + ' .mce-resize-helper {' +\r\n\t\t\t\t'background: #555;' +\r\n\t\t\t\t'background: rgba(0,0,0,0.75);' +\r\n\t\t\t\t'border-radius: 3px;' +\r\n\t\t\t\t'border: 1px;' +\r\n\t\t\t\t'color: white;' +\r\n\t\t\t\t'display: none;' +\r\n\t\t\t\t'font-family: sans-serif;' +\r\n\t\t\t\t'font-size: 12px;' +\r\n\t\t\t\t'white-space: nowrap;' +\r\n\t\t\t\t'line-height: 14px;' +\r\n\t\t\t\t'margin: 5px 10px;' +\r\n\t\t\t\t'padding: 5px;' +\r\n\t\t\t\t'position: absolute;' +\r\n\t\t\t\t'z-index: 10001' +\r\n\t\t\t'}'\r\n\t\t);\r\n\r\n\t\tfunction isResizable(elm) {\r\n\t\t\tvar selector = editor.settings.object_resizing;\r\n\r\n\t\t\tif (selector === false || Env.iOS) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof selector != 'string') {\r\n\t\t\t\tselector = 'table,img,div';\r\n\t\t\t}\r\n\r\n\t\t\tif (elm.getAttribute('data-mce-resize') === 'false') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (elm == editor.getBody()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn editor.dom.is(elm, selector);\r\n\t\t}\r\n\r\n\t\tfunction resizeGhostElement(e) {\r\n\t\t\tvar deltaX, deltaY, proportional;\r\n\t\t\tvar resizeHelperX, resizeHelperY;\r\n\r\n\t\t\t// Calc new width/height\r\n\t\t\tdeltaX = e.screenX - startX;\r\n\t\t\tdeltaY = e.screenY - startY;\r\n\r\n\t\t\t// Calc new size\r\n\t\t\twidth = deltaX * selectedHandle[2] + startW;\r\n\t\t\theight = deltaY * selectedHandle[3] + startH;\r\n\r\n\t\t\t// Never scale down lower than 5 pixels\r\n\t\t\twidth = width < 5 ? 5 : width;\r\n\t\t\theight = height < 5 ? 5 : height;\r\n\r\n\t\t\tif (selectedElm.nodeName == \"IMG\" && editor.settings.resize_img_proportional !== false) {\r\n\t\t\t\tproportional = !VK.modifierPressed(e);\r\n\t\t\t} else {\r\n\t\t\t\tproportional = VK.modifierPressed(e) || (selectedElm.nodeName == \"IMG\" && selectedHandle[2] * selectedHandle[3] !== 0);\r\n\t\t\t}\r\n\r\n\t\t\t// Constrain proportions\r\n\t\t\tif (proportional) {\r\n\t\t\t\tif (abs(deltaX) > abs(deltaY)) {\r\n\t\t\t\t\theight = round(width * ratio);\r\n\t\t\t\t\twidth = round(height / ratio);\r\n\t\t\t\t} else {\r\n\t\t\t\t\twidth = round(height / ratio);\r\n\t\t\t\t\theight = round(width * ratio);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Update ghost size\r\n\t\t\tdom.setStyles(selectedElmGhost, {\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height\r\n\t\t\t});\r\n\r\n\t\t\t// Update resize helper position\r\n\t\t\tresizeHelperX = selectedHandle.startPos.x + deltaX;\r\n\t\t\tresizeHelperY = selectedHandle.startPos.y + deltaY;\r\n\t\t\tresizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\r\n\t\t\tresizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\r\n\r\n\t\t\tdom.setStyles(resizeHelper, {\r\n\t\t\t\tleft: resizeHelperX,\r\n\t\t\t\ttop: resizeHelperY,\r\n\t\t\t\tdisplay: 'block'\r\n\t\t\t});\r\n\r\n\t\t\tresizeHelper.innerHTML = width + ' &times; ' + height;\r\n\r\n\t\t\t// Update ghost X position if needed\r\n\t\t\tif (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\r\n\t\t\t\tdom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\r\n\t\t\t}\r\n\r\n\t\t\t// Update ghost Y position if needed\r\n\t\t\tif (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\r\n\t\t\t\tdom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate how must overflow we got\r\n\t\t\tdeltaX = rootElement.scrollWidth - startScrollWidth;\r\n\t\t\tdeltaY = rootElement.scrollHeight - startScrollHeight;\r\n\r\n\t\t\t// Re-position the resize helper based on the overflow\r\n\t\t\tif (deltaX + deltaY !== 0) {\r\n\t\t\t\tdom.setStyles(resizeHelper, {\r\n\t\t\t\t\tleft: resizeHelperX - deltaX,\r\n\t\t\t\t\ttop: resizeHelperY - deltaY\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!resizeStarted) {\r\n\t\t\t\teditor.fire('ObjectResizeStart', {target: selectedElm, width: startW, height: startH});\r\n\t\t\t\tresizeStarted = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction endGhostResize() {\r\n\t\t\tresizeStarted = false;\r\n\r\n\t\t\tfunction setSizeProp(name, value) {\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\t// Resize by using style or attribute\r\n\t\t\t\t\tif (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\r\n\t\t\t\t\t\tdom.setStyle(selectedElm, name, value);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdom.setAttrib(selectedElm, name, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set width/height properties\r\n\t\t\tsetSizeProp('width', width);\r\n\t\t\tsetSizeProp('height', height);\r\n\r\n\t\t\tdom.unbind(editableDoc, 'mousemove', resizeGhostElement);\r\n\t\t\tdom.unbind(editableDoc, 'mouseup', endGhostResize);\r\n\r\n\t\t\tif (rootDocument != editableDoc) {\r\n\t\t\t\tdom.unbind(rootDocument, 'mousemove', resizeGhostElement);\r\n\t\t\t\tdom.unbind(rootDocument, 'mouseup', endGhostResize);\r\n\t\t\t}\r\n\r\n\t\t\t// Remove ghost/helper and update resize handle positions\r\n\t\t\tdom.remove(selectedElmGhost);\r\n\t\t\tdom.remove(resizeHelper);\r\n\r\n\t\t\tif (!isIE || selectedElm.nodeName == \"TABLE\") {\r\n\t\t\t\tshowResizeRect(selectedElm);\r\n\t\t\t}\r\n\r\n\t\t\teditor.fire('ObjectResized', {target: selectedElm, width: width, height: height});\r\n\t\t\tdom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\r\n\t\t\teditor.nodeChanged();\r\n\t\t}\r\n\r\n\t\tfunction showResizeRect(targetElm, mouseDownHandleName, mouseDownEvent) {\r\n\t\t\tvar position, targetWidth, targetHeight, e, rect;\r\n\r\n\t\t\thideResizeRect();\r\n\t\t\tunbindResizeHandleEvents();\r\n\r\n\t\t\t// Get position and size of target\r\n\t\t\tposition = dom.getPos(targetElm, rootElement);\r\n\t\t\tselectedElmX = position.x;\r\n\t\t\tselectedElmY = position.y;\r\n\t\t\trect = targetElm.getBoundingClientRect(); // Fix for Gecko offsetHeight for table with caption\r\n\t\t\ttargetWidth = rect.width || (rect.right - rect.left);\r\n\t\t\ttargetHeight = rect.height || (rect.bottom - rect.top);\r\n\r\n\t\t\t// Reset width/height if user selects a new image/table\r\n\t\t\tif (selectedElm != targetElm) {\r\n\t\t\t\tdetachResizeStartListener();\r\n\t\t\t\tselectedElm = targetElm;\r\n\t\t\t\twidth = height = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// Makes it possible to disable resizing\r\n\t\t\te = editor.fire('ObjectSelected', {target: targetElm});\r\n\r\n\t\t\tif (isResizable(targetElm) && !e.isDefaultPrevented()) {\r\n\t\t\t\teach(resizeHandles, function(handle, name) {\r\n\t\t\t\t\tvar handleElm;\r\n\r\n\t\t\t\t\tfunction startDrag(e) {\r\n\t\t\t\t\t\tstartX = e.screenX;\r\n\t\t\t\t\t\tstartY = e.screenY;\r\n\t\t\t\t\t\tstartW = selectedElm.clientWidth;\r\n\t\t\t\t\t\tstartH = selectedElm.clientHeight;\r\n\t\t\t\t\t\tratio = startH / startW;\r\n\t\t\t\t\t\tselectedHandle = handle;\r\n\r\n\t\t\t\t\t\thandle.startPos = {\r\n\t\t\t\t\t\t\tx: targetWidth * handle[0] + selectedElmX,\r\n\t\t\t\t\t\t\ty: targetHeight * handle[1] + selectedElmY\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tstartScrollWidth = rootElement.scrollWidth;\r\n\t\t\t\t\t\tstartScrollHeight = rootElement.scrollHeight;\r\n\r\n\t\t\t\t\t\tselectedElmGhost = selectedElm.cloneNode(true);\r\n\t\t\t\t\t\tdom.addClass(selectedElmGhost, 'mce-clonedresizable');\r\n\t\t\t\t\t\tdom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\r\n\t\t\t\t\t\tselectedElmGhost.contentEditable = false; // Hides IE move layer cursor\r\n\t\t\t\t\t\tselectedElmGhost.unSelectabe = true;\r\n\t\t\t\t\t\tdom.setStyles(selectedElmGhost, {\r\n\t\t\t\t\t\t\tleft: selectedElmX,\r\n\t\t\t\t\t\t\ttop: selectedElmY,\r\n\t\t\t\t\t\t\tmargin: 0\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tselectedElmGhost.removeAttribute('data-mce-selected');\r\n\t\t\t\t\t\trootElement.appendChild(selectedElmGhost);\r\n\r\n\t\t\t\t\t\tdom.bind(editableDoc, 'mousemove', resizeGhostElement);\r\n\t\t\t\t\t\tdom.bind(editableDoc, 'mouseup', endGhostResize);\r\n\r\n\t\t\t\t\t\tif (rootDocument != editableDoc) {\r\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mousemove', resizeGhostElement);\r\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mouseup', endGhostResize);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tresizeHelper = dom.add(rootElement, 'div', {\r\n\t\t\t\t\t\t\t'class': 'mce-resize-helper',\r\n\t\t\t\t\t\t\t'data-mce-bogus': 'all'\r\n\t\t\t\t\t\t}, startW + ' &times; ' + startH);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (mouseDownHandleName) {\r\n\t\t\t\t\t\t// Drag started by IE native resizestart\r\n\t\t\t\t\t\tif (name == mouseDownHandleName) {\r\n\t\t\t\t\t\t\tstartDrag(mouseDownEvent);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get existing or render resize handle\r\n\t\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\r\n\t\t\t\t\tif (handleElm) {\r\n\t\t\t\t\t\tdom.remove(handleElm);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\thandleElm = dom.add(rootElement, 'div', {\r\n\t\t\t\t\t\tid: 'mceResizeHandle' + name,\r\n\t\t\t\t\t\t'data-mce-bogus': 'all',\r\n\t\t\t\t\t\t'class': 'mce-resizehandle',\r\n\t\t\t\t\t\tunselectable: true,\r\n\t\t\t\t\t\tstyle: 'cursor:' + name + '-resize; margin:0; padding:0'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Hides IE move layer cursor\r\n\t\t\t\t\t// If we set it on Chrome we get this wounderful bug: #6725\r\n\t\t\t\t\tif (Env.ie) {\r\n\t\t\t\t\t\thandleElm.contentEditable = false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdom.bind(handleElm, 'mousedown', function(e) {\r\n\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tstartDrag(e);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\thandle.elm = handleElm;\r\n\r\n\t\t\t\t\t// Position element\r\n\t\t\t\t\tdom.setStyles(handleElm, {\r\n\t\t\t\t\t\tleft: (targetWidth * handle[0] + selectedElmX) - (handleElm.offsetWidth / 2),\r\n\t\t\t\t\t\ttop: (targetHeight * handle[1] + selectedElmY) - (handleElm.offsetHeight / 2)\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\thideResizeRect();\r\n\t\t\t}\r\n\r\n\t\t\tselectedElm.setAttribute('data-mce-selected', '1');\r\n\t\t}\r\n\r\n\t\tfunction hideResizeRect() {\r\n\t\t\tvar name, handleElm;\r\n\r\n\t\t\tunbindResizeHandleEvents();\r\n\r\n\t\t\tif (selectedElm) {\r\n\t\t\t\tselectedElm.removeAttribute('data-mce-selected');\r\n\t\t\t}\r\n\r\n\t\t\tfor (name in resizeHandles) {\r\n\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\r\n\t\t\t\tif (handleElm) {\r\n\t\t\t\t\tdom.unbind(handleElm);\r\n\t\t\t\t\tdom.remove(handleElm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction updateResizeRect(e) {\r\n\t\t\tvar startElm, controlElm;\r\n\r\n\t\t\tfunction isChildOrEqual(node, parent) {\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tif (node === parent) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while ((node = node.parentNode));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Ignore all events while resizing or if the editor instance was removed\r\n\t\t\tif (resizeStarted || editor.removed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove data-mce-selected from all elements since they might have been copied using Ctrl+c/v\r\n\t\t\teach(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function(img) {\r\n\t\t\t\timg.removeAttribute('data-mce-selected');\r\n\t\t\t});\r\n\r\n\t\t\tcontrolElm = e.type == 'mousedown' ? e.target : selection.getNode();\r\n\t\t\tcontrolElm = dom.$(controlElm).closest(isIE ? 'table' : 'table,img,hr')[0];\r\n\r\n\t\t\tif (isChildOrEqual(controlElm, rootElement)) {\r\n\t\t\t\tdisableGeckoResize();\r\n\t\t\t\tstartElm = selection.getStart(true);\r\n\r\n\t\t\t\tif (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\r\n\t\t\t\t\tif (!isIE || (controlElm != startElm && startElm.nodeName !== 'IMG')) {\r\n\t\t\t\t\t\tshowResizeRect(controlElm);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\thideResizeRect();\r\n\t\t}\r\n\r\n\t\tfunction attachEvent(elm, name, func) {\r\n\t\t\tif (elm && elm.attachEvent) {\r\n\t\t\t\telm.attachEvent('on' + name, func);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction detachEvent(elm, name, func) {\r\n\t\t\tif (elm && elm.detachEvent) {\r\n\t\t\t\telm.detachEvent('on' + name, func);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction resizeNativeStart(e) {\r\n\t\t\tvar target = e.srcElement, pos, name, corner, cornerX, cornerY, relativeX, relativeY;\r\n\r\n\t\t\tpos = target.getBoundingClientRect();\r\n\t\t\trelativeX = lastMouseDownEvent.clientX - pos.left;\r\n\t\t\trelativeY = lastMouseDownEvent.clientY - pos.top;\r\n\r\n\t\t\t// Figure out what corner we are draging on\r\n\t\t\tfor (name in resizeHandles) {\r\n\t\t\t\tcorner = resizeHandles[name];\r\n\r\n\t\t\t\tcornerX = target.offsetWidth * corner[0];\r\n\t\t\t\tcornerY = target.offsetHeight * corner[1];\r\n\r\n\t\t\t\tif (abs(cornerX - relativeX) < 8 && abs(cornerY - relativeY) < 8) {\r\n\t\t\t\t\tselectedHandle = corner;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove native selection and let the magic begin\r\n\t\t\tresizeStarted = true;\r\n\t\t\teditor.fire('ObjectResizeStart', {\r\n\t\t\t\ttarget: selectedElm,\r\n\t\t\t\twidth: selectedElm.clientWidth,\r\n\t\t\t\theight: selectedElm.clientHeight\r\n\t\t\t});\r\n\t\t\teditor.getDoc().selection.empty();\r\n\t\t\tshowResizeRect(target, name, lastMouseDownEvent);\r\n\t\t}\r\n\r\n\t\tfunction preventDefault(e) {\r\n\t\t\tif (e.preventDefault) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\te.returnValue = false; // IE\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction nativeControlSelect(e) {\r\n\t\t\tvar target = e.srcElement;\r\n\r\n\t\t\tif (isContentEditableFalse(target)) {\r\n\t\t\t\tpreventDefault(e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (target != selectedElm) {\r\n\t\t\t\teditor.fire('ObjectSelected', {target: target});\r\n\t\t\t\tdetachResizeStartListener();\r\n\r\n\t\t\t\tif (target.id.indexOf('mceResizeHandle') === 0) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (target.nodeName == 'IMG' || target.nodeName == 'TABLE') {\r\n\t\t\t\t\thideResizeRect();\r\n\t\t\t\t\tselectedElm = target;\r\n\t\t\t\t\tattachEvent(target, 'resizestart', resizeNativeStart);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction detachResizeStartListener() {\r\n\t\t\tdetachEvent(selectedElm, 'resizestart', resizeNativeStart);\r\n\t\t}\r\n\r\n\t\tfunction unbindResizeHandleEvents() {\r\n\t\t\tfor (var name in resizeHandles) {\r\n\t\t\t\tvar handle = resizeHandles[name];\r\n\r\n\t\t\t\tif (handle.elm) {\r\n\t\t\t\t\tdom.unbind(handle.elm);\r\n\t\t\t\t\tdelete handle.elm;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction disableGeckoResize() {\r\n\t\t\ttry {\r\n\t\t\t\t// Disable object resizing on Gecko\r\n\t\t\t\teditor.getDoc().execCommand('enableObjectResizing', false, false);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction controlSelect(elm) {\r\n\t\t\tvar ctrlRng;\r\n\r\n\t\t\tif (!isIE) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tctrlRng = editableDoc.body.createControlRange();\r\n\r\n\t\t\ttry {\r\n\t\t\t\tctrlRng.addElement(elm);\r\n\t\t\t\tctrlRng.select();\r\n\t\t\t\treturn true;\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore since the element can't be control selected for example a P tag\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\teditor.on('init', function() {\r\n\t\t\tif (isIE) {\r\n\t\t\t\t// Hide the resize rect on resize and reselect the image\r\n\t\t\t\teditor.on('ObjectResized', function(e) {\r\n\t\t\t\t\tif (e.target.nodeName != 'TABLE') {\r\n\t\t\t\t\t\thideResizeRect();\r\n\t\t\t\t\t\tcontrolSelect(e.target);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tattachEvent(rootElement, 'controlselect', nativeControlSelect);\r\n\r\n\t\t\t\teditor.on('mousedown', function(e) {\r\n\t\t\t\t\tlastMouseDownEvent = e;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdisableGeckoResize();\r\n\r\n\t\t\t\t// Sniff sniff, hard to feature detect this stuff\r\n\t\t\t\tif (Env.ie >= 11) {\r\n\t\t\t\t\t// Needs to be mousedown for drag/drop to work on IE 11\r\n\t\t\t\t\t// Needs to be click on Edge to properly select images\r\n\t\t\t\t\teditor.on('mousedown click', function(e) {\r\n\t\t\t\t\t\tvar nodeName = e.target.nodeName;\r\n\r\n\t\t\t\t\t\tif (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName)) {\r\n\t\t\t\t\t\t\teditor.selection.select(e.target, nodeName == 'TABLE');\r\n\r\n\t\t\t\t\t\t\t// Only fire once since nodeChange is expensive\r\n\t\t\t\t\t\t\tif (e.type == 'mousedown') {\r\n\t\t\t\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teditor.dom.bind(rootElement, 'mscontrolselect', function(e) {\r\n\t\t\t\t\t\tfunction delayedSelect(node) {\r\n\t\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\t\t\t\teditor.selection.select(node);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (isContentEditableFalse(e.target)) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tdelayedSelect(e.target);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t// This moves the selection from being a control selection to a text like selection like in WebKit #6753\r\n\t\t\t\t\t\t\t// TODO: Fix this the day IE works like other browsers without this nasty native ugly control selections.\r\n\t\t\t\t\t\t\tif (e.target.tagName == 'IMG') {\r\n\t\t\t\t\t\t\t\tdelayedSelect(e.target);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar throttledUpdateResizeRect = Delay.throttle(function(e) {\r\n\t\t\t\tif (!editor.composing) {\r\n\t\t\t\t\tupdateResizeRect(e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('nodechange ResizeEditor ResizeWindow drop', throttledUpdateResizeRect);\r\n\r\n\t\t\t// Update resize rect while typing in a table\r\n\t\t\teditor.on('keyup compositionend', function(e) {\r\n\t\t\t\t// Don't update the resize rect while composing since it blows away the IME see: #2710\r\n\t\t\t\tif (selectedElm && selectedElm.nodeName == \"TABLE\") {\r\n\t\t\t\t\tthrottledUpdateResizeRect(e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('hide blur', hideResizeRect);\r\n\r\n\t\t\t// Hide rect on focusout since it would float on top of windows otherwise\r\n\t\t\t//editor.on('focusout', hideResizeRect);\r\n\t\t});\r\n\r\n\t\teditor.on('remove', unbindResizeHandleEvents);\r\n\r\n\t\tfunction destroy() {\r\n\t\t\tselectedElm = selectedElmGhost = null;\r\n\r\n\t\t\tif (isIE) {\r\n\t\t\t\tdetachResizeStartListener();\r\n\t\t\t\tdetachEvent(rootElement, 'controlselect', nativeControlSelect);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tisResizable: isResizable,\r\n\t\t\tshowResizeRect: showResizeRect,\r\n\t\t\thideResizeRect: hideResizeRect,\r\n\t\t\tupdateResizeRect: updateResizeRect,\r\n\t\t\tcontrolSelect: controlSelect,\r\n\t\t\tdestroy: destroy\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Fun.js\r\n\r\n/**\r\n * Fun.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Functional utility class.\r\n *\r\n * @private\r\n * @class tinymce.util.Fun\r\n */\r\ndefine(\"tinymce/util/Fun\", [], function() {\r\n\tvar slice = [].slice;\r\n\r\n\tfunction constant(value) {\r\n\t\treturn function() {\r\n\t\t\treturn value;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction negate(predicate) {\r\n\t\treturn function(x) {\r\n\t\t\treturn !predicate(x);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction compose(f, g) {\r\n\t\treturn function(x) {\r\n\t\t\treturn f(g(x));\r\n\t\t};\r\n\t}\r\n\r\n\tfunction or() {\r\n\t\tvar args = slice.call(arguments);\r\n\r\n\t\treturn function(x) {\r\n\t\t\tfor (var i = 0; i < args.length; i++) {\r\n\t\t\t\tif (args[i](x)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction and() {\r\n\t\tvar args = slice.call(arguments);\r\n\r\n\t\treturn function(x) {\r\n\t\t\tfor (var i = 0; i < args.length; i++) {\r\n\t\t\t\tif (!args[i](x)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction curry(fn) {\r\n\t\tvar args = slice.call(arguments);\r\n\r\n\t\tif (args.length - 1 >= fn.length) {\r\n\t\t\treturn fn.apply(this, args.slice(1));\r\n\t\t}\r\n\r\n\t\treturn function() {\r\n\t\t\tvar tempArgs = args.concat([].slice.call(arguments));\r\n\t\t\treturn curry.apply(this, tempArgs);\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tconstant: constant,\r\n\t\tnegate: negate,\r\n\t\tand: and,\r\n\t\tor: or,\r\n\t\tcurry: curry,\r\n\t\tcompose: compose\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/CaretCandidate.js\r\n\r\n/**\r\n * CaretCandidate.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module contains logic for handling caret candidates. A caret candidate is\r\n * for example text nodes, images, input elements, cE=false elements etc.\r\n *\r\n * @private\r\n * @class tinymce.caret.CaretCandidate\r\n */\r\ndefine(\"tinymce/caret/CaretCandidate\", [\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/caret/CaretContainer\"\r\n], function(NodeType, Arr, CaretContainer) {\r\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\r\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\r\n\t\tisBr = NodeType.isBr,\r\n\t\tisText = NodeType.isText,\r\n\t\tisInvalidTextElement = NodeType.matchNodeNames('script style textarea'),\r\n\t\tisAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object'),\r\n\t\tisTable = NodeType.matchNodeNames('table'),\r\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\r\n\r\n\tfunction isCaretCandidate(node) {\r\n\t\tif (isCaretContainer(node)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isText(node)) {\r\n\t\t\tif (isInvalidTextElement(node.parentNode)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn isAtomicInline(node) || isBr(node) || isTable(node) || isContentEditableFalse(node);\r\n\t}\r\n\r\n\tfunction isInEditable(node, rootNode) {\r\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\r\n\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (isContentEditableTrue(node)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction isAtomicContentEditableFalse(node) {\r\n\t\tif (!isContentEditableFalse(node)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn Arr.reduce(node.getElementsByTagName('*'), function(result, elm) {\r\n\t\t\treturn result || isContentEditableTrue(elm);\r\n\t\t}, false) !== true;\r\n\t}\r\n\r\n\tfunction isAtomic(node) {\r\n\t\treturn isAtomicInline(node) || isAtomicContentEditableFalse(node);\r\n\t}\r\n\r\n\tfunction isEditableCaretCandidate(node, rootNode) {\r\n\t\treturn isCaretCandidate(node) && isInEditable(node, rootNode);\r\n\t}\r\n\r\n\treturn {\r\n\t\tisCaretCandidate: isCaretCandidate,\r\n\t\tisInEditable: isInEditable,\r\n\t\tisAtomic: isAtomic,\r\n\t\tisEditableCaretCandidate: isEditableCaretCandidate\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/geom/ClientRect.js\r\n\r\n/**\r\n * ClientRect.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Utility functions for working with client rects.\r\n *\r\n * @private\r\n * @class tinymce.geom.ClientRect\r\n */\r\ndefine(\"tinymce/geom/ClientRect\", [], function() {\r\n\tvar round = Math.round;\r\n\r\n\tfunction clone(rect) {\r\n\t\tif (!rect) {\r\n\t\t\treturn {left: 0, top: 0, bottom: 0, right: 0, width: 0, height: 0};\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tleft: round(rect.left),\r\n\t\t\ttop: round(rect.top),\r\n\t\t\tbottom: round(rect.bottom),\r\n\t\t\tright: round(rect.right),\r\n\t\t\twidth: round(rect.width),\r\n\t\t\theight: round(rect.height)\r\n\t\t};\r\n\t}\r\n\r\n\tfunction collapse(clientRect, toStart) {\r\n\t\tclientRect = clone(clientRect);\r\n\r\n\t\tif (toStart) {\r\n\t\t\tclientRect.right = clientRect.left;\r\n\t\t} else {\r\n\t\t\tclientRect.left = clientRect.left + clientRect.width;\r\n\t\t\tclientRect.right = clientRect.left;\r\n\t\t}\r\n\r\n\t\tclientRect.width = 0;\r\n\r\n\t\treturn clientRect;\r\n\t}\r\n\r\n\tfunction isEqual(rect1, rect2) {\r\n\t\treturn (\r\n\t\t\trect1.left === rect2.left &&\r\n\t\t\trect1.top === rect2.top &&\r\n\t\t\trect1.bottom === rect2.bottom &&\r\n\t\t\trect1.right === rect2.right\r\n\t\t);\r\n\t}\r\n\r\n\tfunction isValidOverflow(overflowY, clientRect1, clientRect2) {\r\n\t\treturn overflowY >= 0 && overflowY <= Math.min(clientRect1.height, clientRect2.height) / 2;\r\n\r\n\t}\r\n\r\n\tfunction isAbove(clientRect1, clientRect2) {\r\n\t\tif (clientRect1.bottom < clientRect2.top) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (clientRect1.top > clientRect2.bottom) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn isValidOverflow(clientRect2.top - clientRect1.bottom, clientRect1, clientRect2);\r\n\t}\r\n\r\n\tfunction isBelow(clientRect1, clientRect2) {\r\n\t\tif (clientRect1.top > clientRect2.bottom) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (clientRect1.bottom < clientRect2.top) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn isValidOverflow(clientRect2.bottom - clientRect1.top, clientRect1, clientRect2);\r\n\t}\r\n\r\n\tfunction isLeft(clientRect1, clientRect2) {\r\n\t\treturn clientRect1.left < clientRect2.left;\r\n\t}\r\n\r\n\tfunction isRight(clientRect1, clientRect2) {\r\n\t\treturn clientRect1.right > clientRect2.right;\r\n\t}\r\n\r\n\tfunction compare(clientRect1, clientRect2) {\r\n\t\tif (isAbove(clientRect1, clientRect2)) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tif (isBelow(clientRect1, clientRect2)) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\r\n\t\tif (isLeft(clientRect1, clientRect2)) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tif (isRight(clientRect1, clientRect2)) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tfunction containsXY(clientRect, clientX, clientY) {\r\n\t\treturn (\r\n\t\t\tclientX >= clientRect.left &&\r\n\t\t\tclientX <= clientRect.right &&\r\n\t\t\tclientY >= clientRect.top &&\r\n\t\t\tclientY <= clientRect.bottom\r\n\t\t);\r\n\t}\r\n\r\n\treturn {\r\n\t\tclone: clone,\r\n\t\tcollapse: collapse,\r\n\t\tisEqual: isEqual,\r\n\t\tisAbove: isAbove,\r\n\t\tisBelow: isBelow,\r\n\t\tisLeft: isLeft,\r\n\t\tisRight: isRight,\r\n\t\tcompare: compare,\r\n\t\tcontainsXY: containsXY\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/text/ExtendingChar.js\r\n\r\n/**\r\n * ExtendingChar.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class contains logic for detecting extending characters.\r\n *\r\n * @private\r\n * @class tinymce.text.ExtendingChar\r\n * @example\r\n * var isExtending = ExtendingChar.isExtendingChar('a');\r\n */\r\ndefine(\"tinymce/text/ExtendingChar\", [], function() {\r\n\t// Generated from: http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt\r\n\t// Only includes the characters in that fit into UCS-2 16 bit\r\n\tvar extendingChars = new RegExp(\r\n\t\t\"[\\u0300-\\u036F\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1-\\u05C2\\u05C4-\\u05C5\\u05C7\\u0610-\\u061A\" +\r\n\t\t\"\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7-\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\" +\r\n\t\t\"\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08E3-\\u0902\\u093A\\u093C\" +\r\n\t\t\"\\u0941-\\u0948\\u094D\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09BC\\u09BE\\u09C1-\\u09C4\\u09CD\\u09D7\\u09E2-\\u09E3\" +\r\n\t\t\"\\u0A01-\\u0A02\\u0A3C\\u0A41-\\u0A42\\u0A47-\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70-\\u0A71\\u0A75\\u0A81-\\u0A82\\u0ABC\" +\r\n\t\t\"\\u0AC1-\\u0AC5\\u0AC7-\\u0AC8\\u0ACD\\u0AE2-\\u0AE3\\u0B01\\u0B3C\\u0B3E\\u0B3F\\u0B41-\\u0B44\\u0B4D\\u0B56\\u0B57\" +\r\n\t\t\"\\u0B62-\\u0B63\\u0B82\\u0BBE\\u0BC0\\u0BCD\\u0BD7\\u0C00\\u0C3E-\\u0C40\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55-\\u0C56\" +\r\n\t\t\"\\u0C62-\\u0C63\\u0C81\\u0CBC\\u0CBF\\u0CC2\\u0CC6\\u0CCC-\\u0CCD\\u0CD5-\\u0CD6\\u0CE2-\\u0CE3\\u0D01\\u0D3E\\u0D41-\\u0D44\" +\r\n\t\t\"\\u0D4D\\u0D57\\u0D62-\\u0D63\\u0DCA\\u0DCF\\u0DD2-\\u0DD4\\u0DD6\\u0DDF\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E\\u0EB1\\u0EB4-\\u0EB9\" +\r\n\t\t\"\\u0EBB-\\u0EBC\\u0EC8-\\u0ECD\\u0F18-\\u0F19\\u0F35\\u0F37\\u0F39\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86-\\u0F87\\u0F8D-\\u0F97\" +\r\n\t\t\"\\u0F99-\\u0FBC\\u0FC6\\u102D-\\u1030\\u1032-\\u1037\\u1039-\\u103A\\u103D-\\u103E\\u1058-\\u1059\\u105E-\\u1060\\u1071-\\u1074\" +\r\n\t\t\"\\u1082\\u1085-\\u1086\\u108D\\u109D\\u135D-\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17B4-\\u17B5\" +\r\n\t\t\"\\u17B7-\\u17BD\\u17C6\\u17C9-\\u17D3\\u17DD\\u180B-\\u180D\\u18A9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193B\\u1A17-\\u1A18\" +\r\n\t\t\"\\u1A1B\\u1A56\\u1A58-\\u1A5E\\u1A60\\u1A62\\u1A65-\\u1A6C\\u1A73-\\u1A7C\\u1A7F\\u1AB0-\\u1ABD\\u1ABE\\u1B00-\\u1B03\\u1B34\" +\r\n\t\t\"\\u1B36-\\u1B3A\\u1B3C\\u1B42\\u1B6B-\\u1B73\\u1B80-\\u1B81\\u1BA2-\\u1BA5\\u1BA8-\\u1BA9\\u1BAB-\\u1BAD\\u1BE6\\u1BE8-\\u1BE9\" +\r\n\t\t\"\\u1BED\\u1BEF-\\u1BF1\\u1C2C-\\u1C33\\u1C36-\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE0\\u1CE2-\\u1CE8\\u1CED\\u1CF4\\u1CF8-\\u1CF9\" +\r\n\t\t\"\\u1DC0-\\u1DF5\\u1DFC-\\u1DFF\\u200C-\\u200D\\u20D0-\\u20DC\\u20DD-\\u20E0\\u20E1\\u20E2-\\u20E4\\u20E5-\\u20F0\\u2CEF-\\u2CF1\" +\r\n\t\t\"\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302D\\u302E-\\u302F\\u3099-\\u309A\\uA66F\\uA670-\\uA672\\uA674-\\uA67D\\uA69E-\\uA69F\\uA6F0-\\uA6F1\" +\r\n\t\t\"\\uA802\\uA806\\uA80B\\uA825-\\uA826\\uA8C4\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA951\\uA980-\\uA982\\uA9B3\\uA9B6-\\uA9B9\\uA9BC\" +\r\n\t\t\"\\uA9E5\\uAA29-\\uAA2E\\uAA31-\\uAA32\\uAA35-\\uAA36\\uAA43\\uAA4C\\uAA7C\\uAAB0\\uAAB2-\\uAAB4\\uAAB7-\\uAAB8\\uAABE-\\uAABF\\uAAC1\" +\r\n\t\t\"\\uAAEC-\\uAAED\\uAAF6\\uABE5\\uABE8\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFF9E-\\uFF9F]\"\r\n\t);\r\n\r\n\tfunction isExtendingChar(ch) {\r\n\t\treturn typeof ch == \"string\" && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\r\n\t}\r\n\r\n\treturn {\r\n\t\tisExtendingChar: isExtendingChar\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/CaretPosition.js\r\n\r\n/**\r\n * CaretPosition.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module contains logic for creating caret positions within a document a caretposition\r\n * is similar to a DOMRange object but it doesn't have two endpoints and is also more lightweight\r\n * since it's now updated live when the DOM changes.\r\n *\r\n * @private\r\n * @class tinymce.caret.CaretPosition\r\n * @example\r\n * var caretPos1 = new CaretPosition(container, offset);\r\n * var caretPos2 = CaretPosition.fromRangeStart(someRange);\r\n */\r\ndefine(\"tinymce/caret/CaretPosition\", [\r\n\t\"tinymce/util/Fun\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/caret/CaretCandidate\",\r\n\t\"tinymce/geom/ClientRect\",\r\n\t\"tinymce/text/ExtendingChar\"\r\n], function(Fun, NodeType, DOMUtils, RangeUtils, CaretCandidate, ClientRect, ExtendingChar) {\r\n\tvar isElement = NodeType.isElement,\r\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\r\n\t\tisBlock = NodeType.matchStyleValues('display', 'block table'),\r\n\t\tisFloated = NodeType.matchStyleValues('float', 'left right'),\r\n\t\tisValidElementCaretCandidate = Fun.and(isElement, isCaretCandidate, Fun.negate(isFloated)),\r\n\t\tisNotPre = Fun.negate(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap')),\r\n\t\tisText = NodeType.isText,\r\n\t\tisBr = NodeType.isBr,\r\n\t\tnodeIndex = DOMUtils.nodeIndex,\r\n\t\tresolveIndex = RangeUtils.getNode;\r\n\r\n\tfunction isWhiteSpace(chr) {\r\n\t\treturn chr && /[\\r\\n\\t ]/.test(chr);\r\n\t}\r\n\r\n\tfunction isHiddenWhiteSpaceRange(range) {\r\n\t\tvar container = range.startContainer,\r\n\t\t\toffset = range.startOffset,\r\n\t\t\ttext;\r\n\r\n\t\tif (isWhiteSpace(range.toString()) && isNotPre(container.parentNode)) {\r\n\t\t\ttext = container.data;\r\n\r\n\t\t\tif (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction getCaretPositionClientRects(caretPosition) {\r\n\t\tvar clientRects = [], beforeNode, node;\r\n\r\n\t\t// Hack for older WebKit versions that doesn't\r\n\t\t// support getBoundingClientRect on BR elements\r\n\t\tfunction getBrClientRect(brNode) {\r\n\t\t\tvar doc = brNode.ownerDocument,\r\n\t\t\t\trng = doc.createRange(),\r\n\t\t\t\tnbsp = doc.createTextNode('\\u00a0'),\r\n\t\t\t\tparentNode = brNode.parentNode,\r\n\t\t\t\tclientRect;\r\n\r\n\t\t\tparentNode.insertBefore(nbsp, brNode);\r\n\t\t\trng.setStart(nbsp, 0);\r\n\t\t\trng.setEnd(nbsp, 1);\r\n\t\t\tclientRect = ClientRect.clone(rng.getBoundingClientRect());\r\n\t\t\tparentNode.removeChild(nbsp);\r\n\r\n\t\t\treturn clientRect;\r\n\t\t}\r\n\r\n\t\tfunction getBoundingClientRect(item) {\r\n\t\t\tvar clientRect, clientRects;\r\n\r\n\t\t\tclientRects = item.getClientRects();\r\n\t\t\tif (clientRects.length > 0) {\r\n\t\t\t\tclientRect = ClientRect.clone(clientRects[0]);\r\n\t\t\t} else {\r\n\t\t\t\tclientRect = ClientRect.clone(item.getBoundingClientRect());\r\n\t\t\t}\r\n\r\n\t\t\tif (isBr(item) && clientRect.left === 0) {\r\n\t\t\t\treturn getBrClientRect(item);\r\n\t\t\t}\r\n\r\n\t\t\treturn clientRect;\r\n\t\t}\r\n\r\n\t\tfunction collapseAndInflateWidth(clientRect, toStart) {\r\n\t\t\tclientRect = ClientRect.collapse(clientRect, toStart);\r\n\t\t\tclientRect.width = 1;\r\n\t\t\tclientRect.right = clientRect.left + 1;\r\n\r\n\t\t\treturn clientRect;\r\n\t\t}\r\n\r\n\t\tfunction addUniqueAndValidRect(clientRect) {\r\n\t\t\tif (clientRect.height === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (clientRects.length > 0) {\r\n\t\t\t\tif (ClientRect.isEqual(clientRect, clientRects[clientRects.length - 1])) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tclientRects.push(clientRect);\r\n\t\t}\r\n\r\n\t\tfunction addCharacterOffset(container, offset) {\r\n\t\t\tvar range = container.ownerDocument.createRange();\r\n\r\n\t\t\tif (offset < container.data.length) {\r\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset])) {\r\n\t\t\t\t\treturn clientRects;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// WebKit returns two client rects for a position after an extending\r\n\t\t\t\t// character a\\uxxx|b so expand on \"b\" and collapse to start of \"b\" box\r\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset - 1])) {\r\n\t\t\t\t\trange.setStart(container, offset);\r\n\t\t\t\t\trange.setEnd(container, offset + 1);\r\n\r\n\t\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\r\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\r\n\t\t\t\t\t\treturn clientRects;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (offset > 0) {\r\n\t\t\t\trange.setStart(container, offset - 1);\r\n\t\t\t\trange.setEnd(container, offset);\r\n\r\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\r\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (offset < container.data.length) {\r\n\t\t\t\trange.setStart(container, offset);\r\n\t\t\t\trange.setEnd(container, offset + 1);\r\n\r\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\r\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isText(caretPosition.container())) {\r\n\t\t\taddCharacterOffset(caretPosition.container(), caretPosition.offset());\r\n\t\t\treturn clientRects;\r\n\t\t}\r\n\r\n\t\tif (isElement(caretPosition.container())) {\r\n\t\t\tif (caretPosition.isAtEnd()) {\r\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\r\n\t\t\t\tif (isText(node)) {\r\n\t\t\t\t\taddCharacterOffset(node, node.data.length);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isValidElementCaretCandidate(node) && !isBr(node)) {\r\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\r\n\t\t\t\tif (isText(node)) {\r\n\t\t\t\t\taddCharacterOffset(node, 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\r\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\r\n\t\t\t\t\treturn clientRects;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbeforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\r\n\t\t\t\tif (isValidElementCaretCandidate(beforeNode) && !isBr(beforeNode)) {\r\n\t\t\t\t\tif (isBlock(beforeNode) || isBlock(node) || !isValidElementCaretCandidate(node)) {\r\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isValidElementCaretCandidate(node)) {\r\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn clientRects;\r\n\t}\r\n\r\n\t/**\r\n\t * Represents a location within the document by a container and an offset.\r\n\t *\r\n\t * @constructor\r\n\t * @param {Node} container Container node.\r\n\t * @param {Number} offset Offset within that container node.\r\n\t * @param {Array} clientRects Optional client rects array for the position.\r\n\t */\r\n\tfunction CaretPosition(container, offset, clientRects) {\r\n\t\tfunction isAtStart() {\r\n\t\t\tif (isText(container)) {\r\n\t\t\t\treturn offset === 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn offset === 0;\r\n\t\t}\r\n\r\n\t\tfunction isAtEnd() {\r\n\t\t\tif (isText(container)) {\r\n\t\t\t\treturn offset >= container.data.length;\r\n\t\t\t}\r\n\r\n\t\t\treturn offset >= container.childNodes.length;\r\n\t\t}\r\n\r\n\t\tfunction toRange() {\r\n\t\t\tvar range;\r\n\r\n\t\t\trange = container.ownerDocument.createRange();\r\n\t\t\trange.setStart(container, offset);\r\n\t\t\trange.setEnd(container, offset);\r\n\r\n\t\t\treturn range;\r\n\t\t}\r\n\r\n\t\tfunction getClientRects() {\r\n\t\t\tif (!clientRects) {\r\n\t\t\t\tclientRects = getCaretPositionClientRects(new CaretPosition(container, offset));\r\n\t\t\t}\r\n\r\n\t\t\treturn clientRects;\r\n\t\t}\r\n\r\n\t\tfunction isVisible() {\r\n\t\t\treturn getClientRects().length > 0;\r\n\t\t}\r\n\r\n\t\tfunction isEqual(caretPosition) {\r\n\t\t\treturn caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\r\n\t\t}\r\n\r\n\t\tfunction getNode(before) {\r\n\t\t\treturn resolveIndex(container, before ? offset - 1 : offset);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t/**\r\n\t\t\t * Returns the container node.\r\n\t\t\t *\r\n\t\t\t * @method container\r\n\t\t\t * @return {Node} Container node.\r\n\t\t\t */\r\n\t\t\tcontainer: Fun.constant(container),\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns the offset within the container node.\r\n\t\t\t *\r\n\t\t\t * @method offset\r\n\t\t\t * @return {Number} Offset within the container node.\r\n\t\t\t */\r\n\t\t\toffset: Fun.constant(offset),\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns a range out of a the caret position.\r\n\t\t\t *\r\n\t\t\t * @method toRange\r\n\t\t\t * @return {DOMRange} range for the caret position.\r\n\t\t\t */\r\n\t\t\ttoRange: toRange,\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns the client rects for the caret position. Might be multiple rects between\r\n\t\t\t * block elements.\r\n\t\t\t *\r\n\t\t\t * @method getClientRects\r\n\t\t\t * @return {Array} Array of client rects.\r\n\t\t\t */\r\n\t\t\tgetClientRects: getClientRects,\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns true if the caret location is visible/displayed on screen.\r\n\t\t\t *\r\n\t\t\t * @method isVisible\r\n\t\t\t * @return {Boolean} true/false if the position is visible or not.\r\n\t\t\t */\r\n\t\t\tisVisible: isVisible,\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns true if the caret location is at the beginning of text node or container.\r\n\t\t\t *\r\n\t\t\t * @method isVisible\r\n\t\t\t * @return {Boolean} true/false if the position is at the beginning.\r\n\t\t\t */\r\n\t\t\tisAtStart: isAtStart,\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns true if the caret location is at the end of text node or container.\r\n\t\t\t *\r\n\t\t\t * @method isVisible\r\n\t\t\t * @return {Boolean} true/false if the position is at the end.\r\n\t\t\t */\r\n\t\t\tisAtEnd: isAtEnd,\r\n\r\n\t\t\t/**\r\n\t\t\t * Compares the caret position to another caret position. This will only compare the\r\n\t\t\t * container and offset not it's visual position.\r\n\t\t\t *\r\n\t\t\t * @method isEqual\r\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to compare with.\r\n\t\t\t * @return {Boolean} true if the caret positions are equal.\r\n\t\t\t */\r\n\t\t\tisEqual: isEqual,\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns the closest resolved node from a node index. That means if you have an offset after the\r\n\t\t\t * last node in a container it will return that last node.\r\n\t\t\t *\r\n\t\t\t * @method getNode\r\n\t\t\t * @return {Node} Node that is closest to the index.\r\n\t\t\t */\r\n\t\t\tgetNode: getNode\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a caret position from the start of a range.\r\n\t *\r\n\t * @method fromRangeStart\r\n\t * @param {DOMRange} range DOM Range to create caret position from.\r\n\t * @return {tinymce.caret.CaretPosition} Caret position from the start of DOM range.\r\n\t */\r\n\tCaretPosition.fromRangeStart = function(range) {\r\n\t\treturn new CaretPosition(range.startContainer, range.startOffset);\r\n\t};\r\n\r\n\t/**\r\n\t * Creates a caret position from the end of a range.\r\n\t *\r\n\t * @method fromRangeEnd\r\n\t * @param {DOMRange} range DOM Range to create caret position from.\r\n\t * @return {tinymce.caret.CaretPosition} Caret position from the end of DOM range.\r\n\t */\r\n\tCaretPosition.fromRangeEnd = function(range) {\r\n\t\treturn new CaretPosition(range.endContainer, range.endOffset);\r\n\t};\r\n\r\n\t/**\r\n\t * Creates a caret position from a node and places the offset after it.\r\n\t *\r\n\t * @method after\r\n\t * @param {Node} node Node to get caret position from.\r\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\r\n\t */\r\n\tCaretPosition.after = function(node) {\r\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node) + 1);\r\n\t};\r\n\r\n\t/**\r\n\t * Creates a caret position from a node and places the offset before it.\r\n\t *\r\n\t * @method before\r\n\t * @param {Node} node Node to get caret position from.\r\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\r\n\t */\r\n\tCaretPosition.before = function(node) {\r\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node));\r\n\t};\r\n\r\n\treturn CaretPosition;\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/CaretBookmark.js\r\n\r\n/**\r\n * CaretBookmark.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module creates or resolves xpath like string representation of a CaretPositions.\r\n *\r\n * The format is a / separated list of chunks with:\r\n * <element|text()>[index|after|before]\r\n *\r\n * For example:\r\n *  p[0]/b[0]/text()[0],1 = <p><b>a|c</b></p>\r\n *  p[0]/img[0],before = <p>|<img></p>\r\n *  p[0]/img[0],after = <p><img>|</p>\r\n *\r\n * @private\r\n * @static\r\n * @class tinymce.caret.CaretBookmark\r\n * @example\r\n * var bookmark = CaretBookmark.create(rootElm, CaretPosition.before(rootElm.firstChild));\r\n * var caretPosition = CaretBookmark.resolve(bookmark);\r\n */\r\ndefine('tinymce/caret/CaretBookmark', [\r\n\t'tinymce/dom/NodeType',\r\n\t'tinymce/dom/DOMUtils',\r\n\t'tinymce/util/Fun',\r\n\t'tinymce/util/Arr',\r\n\t'tinymce/caret/CaretPosition'\r\n], function(NodeType, DomUtils, Fun, Arr, CaretPosition) {\r\n\tvar isText = NodeType.isText,\r\n\t\tisBogus = NodeType.isBogus,\r\n\t\tnodeIndex = DomUtils.nodeIndex;\r\n\r\n\tfunction normalizedParent(node) {\r\n\t\tvar parentNode = node.parentNode;\r\n\r\n\t\tif (isBogus(parentNode)) {\r\n\t\t\treturn normalizedParent(parentNode);\r\n\t\t}\r\n\r\n\t\treturn parentNode;\r\n\t}\r\n\r\n\tfunction getChildNodes(node) {\r\n\t\tif (!node) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\treturn Arr.reduce(node.childNodes, function(result, node) {\r\n\t\t\tif (isBogus(node) && node.nodeName != 'BR') {\r\n\t\t\t\tresult = result.concat(getChildNodes(node));\r\n\t\t\t} else {\r\n\t\t\t\tresult.push(node);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t}\r\n\r\n\tfunction normalizedTextOffset(textNode, offset) {\r\n\t\twhile ((textNode = textNode.previousSibling)) {\r\n\t\t\tif (!isText(textNode)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\toffset += textNode.data.length;\r\n\t\t}\r\n\r\n\t\treturn offset;\r\n\t}\r\n\r\n\tfunction equal(targetValue) {\r\n\t\treturn function(value) {\r\n\t\t\treturn targetValue === value;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction normalizedNodeIndex(node) {\r\n\t\tvar nodes, index, numTextFragments;\r\n\r\n\t\tnodes = getChildNodes(normalizedParent(node));\r\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\r\n\t\tnodes = nodes.slice(0, index + 1);\r\n\t\tnumTextFragments = Arr.reduce(nodes, function(result, node, i) {\r\n\t\t\tif (isText(node) && isText(nodes[i - 1])) {\r\n\t\t\t\tresult++;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}, 0);\r\n\r\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(node.nodeName));\r\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\r\n\r\n\t\treturn index - numTextFragments;\r\n\t}\r\n\r\n\tfunction createPathItem(node) {\r\n\t\tvar name;\r\n\r\n\t\tif (isText(node)) {\r\n\t\t\tname = 'text()';\r\n\t\t} else {\r\n\t\t\tname = node.nodeName.toLowerCase();\r\n\t\t}\r\n\r\n\t\treturn name + '[' + normalizedNodeIndex(node) + ']';\r\n\t}\r\n\r\n\tfunction parentsUntil(rootNode, node, predicate) {\r\n\t\tvar parents = [];\r\n\r\n\t\tfor (node = node.parentNode; node != rootNode; node = node.parentNode) {\r\n\t\t\tif (predicate && predicate(node)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tparents.push(node);\r\n\t\t}\r\n\r\n\t\treturn parents;\r\n\t}\r\n\r\n\tfunction create(rootNode, caretPosition) {\r\n\t\tvar container, offset, path = [],\r\n\t\t\toutputOffset, childNodes, parents;\r\n\r\n\t\tcontainer = caretPosition.container();\r\n\t\toffset = caretPosition.offset();\r\n\r\n\t\tif (isText(container)) {\r\n\t\t\toutputOffset = normalizedTextOffset(container, offset);\r\n\t\t} else {\r\n\t\t\tchildNodes = container.childNodes;\r\n\t\t\tif (offset >= childNodes.length) {\r\n\t\t\t\toutputOffset = 'after';\r\n\t\t\t\toffset = childNodes.length - 1;\r\n\t\t\t} else {\r\n\t\t\t\toutputOffset = 'before';\r\n\t\t\t}\r\n\r\n\t\t\tcontainer = childNodes[offset];\r\n\t\t}\r\n\r\n\t\tpath.push(createPathItem(container));\r\n\t\tparents = parentsUntil(rootNode, container);\r\n\t\tparents = Arr.filter(parents, Fun.negate(NodeType.isBogus));\r\n\t\tpath = path.concat(Arr.map(parents, function(node) {\r\n\t\t\treturn createPathItem(node);\r\n\t\t}));\r\n\r\n\t\treturn path.reverse().join('/') + ',' + outputOffset;\r\n\t}\r\n\r\n\tfunction resolvePathItem(node, name, index) {\r\n\t\tvar nodes = getChildNodes(node);\r\n\r\n\t\tnodes = Arr.filter(nodes, function(node, index) {\r\n\t\t\treturn !isText(node) || !isText(nodes[index - 1]);\r\n\t\t});\r\n\r\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(name));\r\n\t\treturn nodes[index];\r\n\t}\r\n\r\n\tfunction findTextPosition(container, offset) {\r\n\t\tvar node = container, targetOffset = 0, dataLen;\r\n\r\n\t\twhile (isText(node)) {\r\n\t\t\tdataLen = node.data.length;\r\n\r\n\t\t\tif (offset >= targetOffset && offset <= targetOffset + dataLen) {\r\n\t\t\t\tcontainer = node;\r\n\t\t\t\toffset = offset - targetOffset;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isText(node.nextSibling)) {\r\n\t\t\t\tcontainer = node;\r\n\t\t\t\toffset = dataLen;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\ttargetOffset += dataLen;\r\n\t\t\tnode = node.nextSibling;\r\n\t\t}\r\n\r\n\t\tif (offset > container.data.length) {\r\n\t\t\toffset = container.data.length;\r\n\t\t}\r\n\r\n\t\treturn new CaretPosition(container, offset);\r\n\t}\r\n\r\n\tfunction resolve(rootNode, path) {\r\n\t\tvar parts, container, offset;\r\n\r\n\t\tif (!path) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tparts = path.split(',');\r\n\t\tpath = parts[0].split('/');\r\n\t\toffset = parts.length > 1 ? parts[1] : 'before';\r\n\r\n\t\tcontainer = Arr.reduce(path, function(result, value) {\r\n\t\t\tvalue = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\r\n\t\t\tif (!value) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (value[1] === 'text()') {\r\n\t\t\t\tvalue[1] = '#text';\r\n\t\t\t}\r\n\r\n\t\t\treturn resolvePathItem(result, value[1], parseInt(value[2], 10));\r\n\t\t}, rootNode);\r\n\r\n\t\tif (!container) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif (!isText(container)) {\r\n\t\t\tif (offset === 'after') {\r\n\t\t\t\toffset = nodeIndex(container) + 1;\r\n\t\t\t} else {\r\n\t\t\t\toffset = nodeIndex(container);\r\n\t\t\t}\r\n\r\n\t\t\treturn new CaretPosition(container.parentNode, offset);\r\n\t\t}\r\n\r\n\t\treturn findTextPosition(container, parseInt(offset, 10));\r\n\t}\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Create a xpath bookmark location for the specified caret position.\r\n\t\t *\r\n\t\t * @method create\r\n\t\t * @param {Node} rootNode Root node to create bookmark within.\r\n\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position within the root node.\r\n\t\t * @return {String} String xpath like location of caret position.\r\n\t\t */\r\n\t\tcreate: create,\r\n\r\n\t\t/**\r\n\t\t * Resolves a xpath like bookmark location to the a caret position.\r\n\t\t *\r\n\t\t * @method resolve\r\n\t\t * @param {Node} rootNode Root node to resolve xpath bookmark within.\r\n\t\t * @param {String} bookmark Bookmark string to resolve.\r\n\t\t * @return {tinymce.caret.CaretPosition} Caret position resolved from xpath like bookmark.\r\n\t\t */\r\n\t\tresolve: resolve\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/BookmarkManager.js\r\n\r\n/**\r\n * BookmarkManager.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles selection bookmarks.\r\n *\r\n * @class tinymce.dom.BookmarkManager\r\n */\r\ndefine(\"tinymce/dom/BookmarkManager\", [\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/caret/CaretContainer\",\r\n\t\"tinymce/caret/CaretBookmark\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/dom/NodeType\"\r\n], function(Env, Tools, CaretContainer, CaretBookmark, CaretPosition, NodeType) {\r\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\r\n\r\n\t/**\r\n\t * Constructs a new BookmarkManager instance for a specific selection instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method BookmarkManager\r\n\t * @param {tinymce.dom.Selection} selection Selection instance to handle bookmarks for.\r\n\t */\r\n\tfunction BookmarkManager(selection) {\r\n\t\tvar dom = selection.dom;\r\n\r\n\t\t/**\r\n\t\t * Returns a bookmark location for the current selection. This bookmark object\r\n\t\t * can then be used to restore the selection after some content modification to the document.\r\n\t\t *\r\n\t\t * @method getBookmark\r\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\r\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\r\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\r\n\t\t * @example\r\n\t\t * // Stores a bookmark of the current selection\r\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\r\n\t\t *\r\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\r\n\t\t *\r\n\t\t * // Restore the selection bookmark\r\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\r\n\t\t */\r\n\t\tthis.getBookmark = function(type, normalized) {\r\n\t\t\tvar rng, rng2, id, collapsed, name, element, chr = '&#xFEFF;', styles;\r\n\r\n\t\t\tfunction findIndex(name, element) {\r\n\t\t\t\tvar count = 0;\r\n\r\n\t\t\t\tTools.each(dom.select(name), function(node) {\r\n\t\t\t\t\tif (node.getAttribute('data-mce-bogus') === 'all') {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (node == element) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn count;\r\n\t\t\t}\r\n\r\n\t\t\tfunction normalizeTableCellSelection(rng) {\r\n\t\t\t\tfunction moveEndPoint(start) {\r\n\t\t\t\t\tvar container, offset, childNodes, prefix = start ? 'start' : 'end';\r\n\r\n\t\t\t\t\tcontainer = rng[prefix + 'Container'];\r\n\t\t\t\t\toffset = rng[prefix + 'Offset'];\r\n\r\n\t\t\t\t\tif (container.nodeType == 1 && container.nodeName == \"TR\") {\r\n\t\t\t\t\t\tchildNodes = container.childNodes;\r\n\t\t\t\t\t\tcontainer = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\r\n\t\t\t\t\t\tif (container) {\r\n\t\t\t\t\t\t\toffset = start ? 0 : container.childNodes.length;\r\n\t\t\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmoveEndPoint(true);\r\n\t\t\t\tmoveEndPoint();\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getLocation(rng) {\r\n\t\t\t\tvar root = dom.getRoot(), bookmark = {};\r\n\r\n\t\t\t\tfunction getPoint(rng, start) {\r\n\t\t\t\t\tvar container = rng[start ? 'startContainer' : 'endContainer'],\r\n\t\t\t\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'], point = [], node, childNodes, after = 0;\r\n\r\n\t\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\t\tif (normalized) {\r\n\t\t\t\t\t\t\tfor (node = container.previousSibling; node && node.nodeType == 3; node = node.previousSibling) {\r\n\t\t\t\t\t\t\t\toffset += node.nodeValue.length;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tpoint.push(offset);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchildNodes = container.childNodes;\r\n\r\n\t\t\t\t\t\tif (offset >= childNodes.length && childNodes.length) {\r\n\t\t\t\t\t\t\tafter = 1;\r\n\t\t\t\t\t\t\toffset = Math.max(0, childNodes.length - 1);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(childNodes[offset], normalized) + after);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (; container && container != root; container = container.parentNode) {\r\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(container, normalized));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn point;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbookmark.start = getPoint(rng, true);\r\n\r\n\t\t\t\tif (!selection.isCollapsed()) {\r\n\t\t\t\t\tbookmark.end = getPoint(rng);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn bookmark;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findAdjacentContentEditableFalseElm(rng) {\r\n\t\t\t\tfunction findSibling(node) {\r\n\t\t\t\t\tvar sibling;\r\n\r\n\t\t\t\t\tif (CaretContainer.isCaretContainer(node)) {\r\n\t\t\t\t\t\tif (NodeType.isText(node) && CaretContainer.isCaretContainerBlock(node)) {\r\n\t\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = node.previousSibling;\r\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\r\n\t\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsibling = node.nextSibling;\r\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\r\n\t\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn findSibling(rng.startContainer) || findSibling(rng.endContainer);\r\n\t\t\t}\r\n\r\n\t\t\tif (type == 2) {\r\n\t\t\t\telement = selection.getNode();\r\n\t\t\t\tname = element ? element.nodeName : null;\r\n\t\t\t\trng = selection.getRng();\r\n\r\n\t\t\t\tif (isContentEditableFalse(element) || name == 'IMG') {\r\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (selection.tridentSel) {\r\n\t\t\t\t\treturn selection.tridentSel.getBookmark(type);\r\n\t\t\t\t}\r\n\r\n\t\t\t\telement = findAdjacentContentEditableFalseElm(rng);\r\n\t\t\t\tif (element) {\r\n\t\t\t\t\tname = element.tagName;\r\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn getLocation(rng);\r\n\t\t\t}\r\n\r\n\t\t\tif (type == 3) {\r\n\t\t\t\trng = selection.getRng();\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstart: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeStart(rng)),\r\n\t\t\t\t\tend: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeEnd(rng))\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Handle simple range\r\n\t\t\tif (type) {\r\n\t\t\t\treturn {rng: selection.getRng()};\r\n\t\t\t}\r\n\r\n\t\t\trng = selection.getRng();\r\n\t\t\tid = dom.uniqueId();\r\n\t\t\tcollapsed = selection.isCollapsed();\r\n\t\t\tstyles = 'overflow:hidden;line-height:0px';\r\n\r\n\t\t\t// Explorer method\r\n\t\t\tif (rng.duplicate || rng.item) {\r\n\t\t\t\t// Text selection\r\n\t\t\t\tif (!rng.item) {\r\n\t\t\t\t\trng2 = rng.duplicate();\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Insert start marker\r\n\t\t\t\t\t\trng.collapse();\r\n\t\t\t\t\t\trng.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_start\" style=\"' + styles + '\">' + chr + '</span>');\r\n\r\n\t\t\t\t\t\t// Insert end marker\r\n\t\t\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\t\t\trng2.collapse(false);\r\n\r\n\t\t\t\t\t\t\t// Detect the empty space after block elements in IE and move the\r\n\t\t\t\t\t\t\t// end back one character <p></p>] becomes <p>]</p>\r\n\t\t\t\t\t\t\trng.moveToElementText(rng2.parentElement());\r\n\t\t\t\t\t\t\tif (rng.compareEndPoints('StartToEnd', rng2) === 0) {\r\n\t\t\t\t\t\t\t\trng2.move('character', -1);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\trng2.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_end\" style=\"' + styles + '\">' + chr + '</span>');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// IE might throw unspecified error so lets ignore it\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Control selection\r\n\t\t\t\t\telement = rng.item(0);\r\n\t\t\t\t\tname = element.nodeName;\r\n\r\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\telement = selection.getNode();\r\n\t\t\t\tname = element.nodeName;\r\n\t\t\t\tif (name == 'IMG') {\r\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// W3C method\r\n\t\t\t\trng2 = normalizeTableCellSelection(rng.cloneRange());\r\n\r\n\t\t\t\t// Insert end marker\r\n\t\t\t\tif (!collapsed) {\r\n\t\t\t\t\trng2.collapse(false);\r\n\t\t\t\t\trng2.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_end', style: styles}, chr));\r\n\t\t\t\t}\r\n\r\n\t\t\t\trng = normalizeTableCellSelection(rng);\r\n\t\t\t\trng.collapse(true);\r\n\t\t\t\trng.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_start', style: styles}, chr));\r\n\t\t\t}\r\n\r\n\t\t\tselection.moveToBookmark({id: id, keep: 1});\r\n\r\n\t\t\treturn {id: id};\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Restores the selection to the specified bookmark.\r\n\t\t *\r\n\t\t * @method moveToBookmark\r\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\r\n\t\t * @return {Boolean} true/false if it was successful or not.\r\n\t\t * @example\r\n\t\t * // Stores a bookmark of the current selection\r\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\r\n\t\t *\r\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\r\n\t\t *\r\n\t\t * // Restore the selection bookmark\r\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\r\n\t\t */\r\n\t\tthis.moveToBookmark = function(bookmark) {\r\n\t\t\tvar rng, root, startContainer, endContainer, startOffset, endOffset;\r\n\r\n\t\t\tfunction setEndPoint(start) {\r\n\t\t\t\tvar point = bookmark[start ? 'start' : 'end'], i, node, offset, children;\r\n\r\n\t\t\t\tif (point) {\r\n\t\t\t\t\toffset = point[0];\r\n\r\n\t\t\t\t\t// Find container node\r\n\t\t\t\t\tfor (node = root, i = point.length - 1; i >= 1; i--) {\r\n\t\t\t\t\t\tchildren = node.childNodes;\r\n\r\n\t\t\t\t\t\tif (point[i] > children.length - 1) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = children[point[i]];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Move text offset to best suitable location\r\n\t\t\t\t\tif (node.nodeType === 3) {\r\n\t\t\t\t\t\toffset = Math.min(point[0], node.nodeValue.length);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Move element offset to best suitable location\r\n\t\t\t\t\tif (node.nodeType === 1) {\r\n\t\t\t\t\t\toffset = Math.min(point[0], node.childNodes.length);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Set offset within container node\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\trng.setStart(node, offset);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trng.setEnd(node, offset);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfunction restoreEndPoint(suffix) {\r\n\t\t\t\tvar marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;\r\n\r\n\t\t\t\tif (marker) {\r\n\t\t\t\t\tnode = marker.parentNode;\r\n\r\n\t\t\t\t\tif (suffix == 'start') {\r\n\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnode = marker.firstChild;\r\n\t\t\t\t\t\t\tidx = 1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstartContainer = endContainer = node;\r\n\t\t\t\t\t\tstartOffset = endOffset = idx;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnode = marker.firstChild;\r\n\t\t\t\t\t\t\tidx = 1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tendContainer = node;\r\n\t\t\t\t\t\tendOffset = idx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!keep) {\r\n\t\t\t\t\t\tprev = marker.previousSibling;\r\n\t\t\t\t\t\tnext = marker.nextSibling;\r\n\r\n\t\t\t\t\t\t// Remove all marker text nodes\r\n\t\t\t\t\t\tTools.each(Tools.grep(marker.childNodes), function(node) {\r\n\t\t\t\t\t\t\tif (node.nodeType == 3) {\r\n\t\t\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Remove marker but keep children if for example contents where inserted into the marker\r\n\t\t\t\t\t\t// Also remove duplicated instances of the marker for example by a\r\n\t\t\t\t\t\t// split operation or by WebKit auto split on paste feature\r\n\t\t\t\t\t\twhile ((marker = dom.get(bookmark.id + '_' + suffix))) {\r\n\t\t\t\t\t\t\tdom.remove(marker, 1);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// If siblings are text nodes then merge them unless it's Opera since it some how removes the node\r\n\t\t\t\t\t\t// and we are sniffing since adding a lot of detection code for a browser with 3% of the market\r\n\t\t\t\t\t\t// isn't worth the effort. Sorry, Opera but it's just a fact\r\n\t\t\t\t\t\tif (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3 && !Env.opera) {\r\n\t\t\t\t\t\t\tidx = prev.nodeValue.length;\r\n\t\t\t\t\t\t\tprev.appendData(next.nodeValue);\r\n\t\t\t\t\t\t\tdom.remove(next);\r\n\r\n\t\t\t\t\t\t\tif (suffix == 'start') {\r\n\t\t\t\t\t\t\t\tstartContainer = endContainer = prev;\r\n\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tendContainer = prev;\r\n\t\t\t\t\t\t\t\tendOffset = idx;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction addBogus(node) {\r\n\t\t\t\t// Adds a bogus BR element for empty block elements\r\n\t\t\t\tif (dom.isBlock(node) && !node.innerHTML && !Env.ie) {\r\n\t\t\t\t\tnode.innerHTML = '<br data-mce-bogus=\"1\" />';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\r\n\t\t\tfunction resolveCaretPositionBookmark() {\r\n\t\t\t\tvar rng, pos;\r\n\r\n\t\t\t\trng = dom.createRng();\r\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.start);\r\n\t\t\t\trng.setStart(pos.container(), pos.offset());\r\n\r\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.end);\r\n\t\t\t\trng.setEnd(pos.container(), pos.offset());\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\r\n\t\t\tif (bookmark) {\r\n\t\t\t\tif (Tools.isArray(bookmark.start)) {\r\n\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\troot = dom.getRoot();\r\n\r\n\t\t\t\t\tif (selection.tridentSel) {\r\n\t\t\t\t\t\treturn selection.tridentSel.moveToBookmark(bookmark);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (setEndPoint(true) && setEndPoint()) {\r\n\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (typeof bookmark.start == 'string') {\r\n\t\t\t\t\tselection.setRng(resolveCaretPositionBookmark(bookmark));\r\n\t\t\t\t} else if (bookmark.id) {\r\n\t\t\t\t\t// Restore start/end points\r\n\t\t\t\t\trestoreEndPoint('start');\r\n\t\t\t\t\trestoreEndPoint('end');\r\n\r\n\t\t\t\t\tif (startContainer) {\r\n\t\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\t\trng.setStart(addBogus(startContainer), startOffset);\r\n\t\t\t\t\t\trng.setEnd(addBogus(endContainer), endOffset);\r\n\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (bookmark.name) {\r\n\t\t\t\t\tselection.select(dom.select(bookmark.name)[bookmark.index]);\r\n\t\t\t\t} else if (bookmark.rng) {\r\n\t\t\t\t\tselection.setRng(bookmark.rng);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true/false if the specified node is a bookmark node or not.\r\n\t *\r\n\t * @static\r\n\t * @method isBookmarkNode\r\n\t * @param {DOMNode} node DOM Node to check if it's a bookmark node or not.\r\n\t * @return {Boolean} true/false if the node is a bookmark node or not.\r\n\t */\r\n\tBookmarkManager.isBookmarkNode = function(node) {\r\n\t\treturn node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\r\n\t};\r\n\r\n\treturn BookmarkManager;\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/Selection.js\r\n\r\n/**\r\n * Selection.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles text and control selection it's an crossbrowser utility class.\r\n * Consult the TinyMCE Wiki API for more details and examples on how to use this class.\r\n *\r\n * @class tinymce.dom.Selection\r\n * @example\r\n * // Getting the currently selected node for the active editor\r\n * alert(tinymce.activeEditor.selection.getNode().nodeName);\r\n */\r\ndefine(\"tinymce/dom/Selection\", [\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/dom/TridentSelection\",\r\n\t\"tinymce/dom/ControlSelection\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/dom/BookmarkManager\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/caret/CaretPosition\"\r\n], function(TreeWalker, TridentSelection, ControlSelection, RangeUtils, BookmarkManager, NodeType, Env, Tools, CaretPosition) {\r\n\tvar each = Tools.each, trim = Tools.trim;\r\n\tvar isIE = Env.ie;\r\n\r\n\t/**\r\n\t * Constructs a new selection instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method Selection\r\n\t * @param {tinymce.dom.DOMUtils} dom DOMUtils object reference.\r\n\t * @param {Window} win Window to bind the selection object to.\r\n\t * @param {tinymce.Editor} editor Editor instance of the selection.\r\n\t * @param {tinymce.dom.Serializer} serializer DOM serialization class to use for getContent.\r\n\t */\r\n\tfunction Selection(dom, win, serializer, editor) {\r\n\t\tvar self = this;\r\n\r\n\t\tself.dom = dom;\r\n\t\tself.win = win;\r\n\t\tself.serializer = serializer;\r\n\t\tself.editor = editor;\r\n\t\tself.bookmarkManager = new BookmarkManager(self);\r\n\t\tself.controlSelection = new ControlSelection(self, editor);\r\n\r\n\t\t// No W3C Range support\r\n\t\tif (!self.win.getSelection) {\r\n\t\t\tself.tridentSel = new TridentSelection(self);\r\n\t\t}\r\n\t}\r\n\r\n\tSelection.prototype = {\r\n\t\t/**\r\n\t\t * Move the selection cursor range to the specified node and offset.\r\n\t\t * If there is no node specified it will move it to the first suitable location within the body.\r\n\t\t *\r\n\t\t * @method setCursorLocation\r\n\t\t * @param {Node} node Optional node to put the cursor in.\r\n\t\t * @param {Number} offset Optional offset from the start of the node to put the cursor at.\r\n\t\t */\r\n\t\tsetCursorLocation: function(node, offset) {\r\n\t\t\tvar self = this, rng = self.dom.createRng();\r\n\r\n\t\t\tif (!node) {\r\n\t\t\t\tself._moveEndPoint(rng, self.editor.getBody(), true);\r\n\t\t\t\tself.setRng(rng);\r\n\t\t\t} else {\r\n\t\t\t\trng.setStart(node, offset);\r\n\t\t\t\trng.setEnd(node, offset);\r\n\t\t\t\tself.setRng(rng);\r\n\t\t\t\tself.collapse(false);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the selected contents using the DOM serializer passed in to this class.\r\n\t\t *\r\n\t\t * @method getContent\r\n\t\t * @param {Object} args Optional settings class with for example output format text or html.\r\n\t\t * @return {String} Selected contents in for example HTML format.\r\n\t\t * @example\r\n\t\t * // Alerts the currently selected contents\r\n\t\t * alert(tinymce.activeEditor.selection.getContent());\r\n\t\t *\r\n\t\t * // Alerts the currently selected contents as plain text\r\n\t\t * alert(tinymce.activeEditor.selection.getContent({format: 'text'}));\r\n\t\t */\r\n\t\tgetContent: function(args) {\r\n\t\t\tvar self = this, rng = self.getRng(), tmpElm = self.dom.create(\"body\");\r\n\t\t\tvar se = self.getSel(), whiteSpaceBefore, whiteSpaceAfter, fragment;\r\n\r\n\t\t\targs = args || {};\r\n\t\t\twhiteSpaceBefore = whiteSpaceAfter = '';\r\n\t\t\targs.get = true;\r\n\t\t\targs.format = args.format || 'html';\r\n\t\t\targs.selection = true;\r\n\t\t\tself.editor.fire('BeforeGetContent', args);\r\n\r\n\t\t\tif (args.format == 'text') {\r\n\t\t\t\treturn self.isCollapsed() ? '' : (rng.text || (se.toString ? se.toString() : ''));\r\n\t\t\t}\r\n\r\n\t\t\tif (rng.cloneContents) {\r\n\t\t\t\tfragment = rng.cloneContents();\r\n\r\n\t\t\t\tif (fragment) {\r\n\t\t\t\t\ttmpElm.appendChild(fragment);\r\n\t\t\t\t}\r\n\t\t\t} else if (rng.item !== undefined || rng.htmlText !== undefined) {\r\n\t\t\t\t// IE will produce invalid markup if elements are present that\r\n\t\t\t\t// it doesn't understand like custom elements or HTML5 elements.\r\n\t\t\t\t// Adding a BR in front of the contents and then remoiving it seems to fix it though.\r\n\t\t\t\ttmpElm.innerHTML = '<br>' + (rng.item ? rng.item(0).outerHTML : rng.htmlText);\r\n\t\t\t\ttmpElm.removeChild(tmpElm.firstChild);\r\n\t\t\t} else {\r\n\t\t\t\ttmpElm.innerHTML = rng.toString();\r\n\t\t\t}\r\n\r\n\t\t\t// Keep whitespace before and after\r\n\t\t\tif (/^\\s/.test(tmpElm.innerHTML)) {\r\n\t\t\t\twhiteSpaceBefore = ' ';\r\n\t\t\t}\r\n\r\n\t\t\tif (/\\s+$/.test(tmpElm.innerHTML)) {\r\n\t\t\t\twhiteSpaceAfter = ' ';\r\n\t\t\t}\r\n\r\n\t\t\targs.getInner = true;\r\n\r\n\t\t\targs.content = self.isCollapsed() ? '' : whiteSpaceBefore + self.serializer.serialize(tmpElm, args) + whiteSpaceAfter;\r\n\t\t\tself.editor.fire('GetContent', args);\r\n\r\n\t\t\treturn args.content;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the current selection to the specified content. If any contents is selected it will be replaced\r\n\t\t * with the contents passed in to this function. If there is no selection the contents will be inserted\r\n\t\t * where the caret is placed in the editor/page.\r\n\t\t *\r\n\t\t * @method setContent\r\n\t\t * @param {String} content HTML contents to set could also be other formats depending on settings.\r\n\t\t * @param {Object} args Optional settings object with for example data format.\r\n\t\t * @example\r\n\t\t * // Inserts some HTML contents at the current selection\r\n\t\t * tinymce.activeEditor.selection.setContent('<strong>Some contents</strong>');\r\n\t\t */\r\n\t\tsetContent: function(content, args) {\r\n\t\t\tvar self = this, rng = self.getRng(), caretNode, doc = self.win.document, frag, temp;\r\n\r\n\t\t\targs = args || {format: 'html'};\r\n\t\t\targs.set = true;\r\n\t\t\targs.selection = true;\r\n\t\t\targs.content = content;\r\n\r\n\t\t\t// Dispatch before set content event\r\n\t\t\tif (!args.no_events) {\r\n\t\t\t\tself.editor.fire('BeforeSetContent', args);\r\n\t\t\t}\r\n\r\n\t\t\tcontent = args.content;\r\n\r\n\t\t\tif (rng.insertNode) {\r\n\t\t\t\t// Make caret marker since insertNode places the caret in the beginning of text after insert\r\n\t\t\t\tcontent += '<span id=\"__caret\">_</span>';\r\n\r\n\t\t\t\t// Delete and insert new node\r\n\t\t\t\tif (rng.startContainer == doc && rng.endContainer == doc) {\r\n\t\t\t\t\t// WebKit will fail if the body is empty since the range is then invalid and it can't insert contents\r\n\t\t\t\t\tdoc.body.innerHTML = content;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng.deleteContents();\r\n\r\n\t\t\t\t\tif (doc.body.childNodes.length === 0) {\r\n\t\t\t\t\t\tdoc.body.innerHTML = content;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// createContextualFragment doesn't exists in IE 9 DOMRanges\r\n\t\t\t\t\t\tif (rng.createContextualFragment) {\r\n\t\t\t\t\t\t\trng.insertNode(rng.createContextualFragment(content));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Fake createContextualFragment call in IE 9\r\n\t\t\t\t\t\t\tfrag = doc.createDocumentFragment();\r\n\t\t\t\t\t\t\ttemp = doc.createElement('div');\r\n\r\n\t\t\t\t\t\t\tfrag.appendChild(temp);\r\n\t\t\t\t\t\t\ttemp.outerHTML = content;\r\n\r\n\t\t\t\t\t\t\trng.insertNode(frag);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move to caret marker\r\n\t\t\t\tcaretNode = self.dom.get('__caret');\r\n\r\n\t\t\t\t// Make sure we wrap it compleatly, Opera fails with a simple select call\r\n\t\t\t\trng = doc.createRange();\r\n\t\t\t\trng.setStartBefore(caretNode);\r\n\t\t\t\trng.setEndBefore(caretNode);\r\n\t\t\t\tself.setRng(rng);\r\n\r\n\t\t\t\t// Remove the caret position\r\n\t\t\t\tself.dom.remove('__caret');\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tself.setRng(rng);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Might fail on Opera for some odd reason\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (rng.item) {\r\n\t\t\t\t\t// Delete content and get caret text selection\r\n\t\t\t\t\tdoc.execCommand('Delete', false, null);\r\n\t\t\t\t\trng = self.getRng();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Explorer removes spaces from the beginning of pasted contents\r\n\t\t\t\tif (/^\\s+/.test(content)) {\r\n\t\t\t\t\trng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\r\n\t\t\t\t\tself.dom.remove('__mce_tmp');\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng.pasteHTML(content);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Dispatch set content event\r\n\t\t\tif (!args.no_events) {\r\n\t\t\t\tself.editor.fire('SetContent', args);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the start element of a selection range. If the start is in a text\r\n\t\t * node the parent element will be returned.\r\n\t\t *\r\n\t\t * @method getStart\r\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\r\n\t\t * @return {Element} Start element of selection range.\r\n\t\t */\r\n\t\tgetStart: function(real) {\r\n\t\t\tvar self = this, rng = self.getRng(), startElement, parentElement, checkRng, node;\r\n\r\n\t\t\tif (rng.duplicate || rng.item) {\r\n\t\t\t\t// Control selection, return first item\r\n\t\t\t\tif (rng.item) {\r\n\t\t\t\t\treturn rng.item(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get start element\r\n\t\t\t\tcheckRng = rng.duplicate();\r\n\t\t\t\tcheckRng.collapse(1);\r\n\t\t\t\tstartElement = checkRng.parentElement();\r\n\t\t\t\tif (startElement.ownerDocument !== self.dom.doc) {\r\n\t\t\t\t\tstartElement = self.dom.getRoot();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if range parent is inside the start element, then return the inner parent element\r\n\t\t\t\t// This will fix issues when a single element is selected, IE would otherwise return the wrong start element\r\n\t\t\t\tparentElement = node = rng.parentElement();\r\n\t\t\t\twhile ((node = node.parentNode)) {\r\n\t\t\t\t\tif (node == startElement) {\r\n\t\t\t\t\t\tstartElement = parentElement;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn startElement;\r\n\t\t\t}\r\n\r\n\t\t\tstartElement = rng.startContainer;\r\n\r\n\t\t\tif (startElement.nodeType == 1 && startElement.hasChildNodes()) {\r\n\t\t\t\tif (!real || !rng.collapsed) {\r\n\t\t\t\t\tstartElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (startElement && startElement.nodeType == 3) {\r\n\t\t\t\treturn startElement.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn startElement;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the end element of a selection range. If the end is in a text\r\n\t\t * node the parent element will be returned.\r\n\t\t *\r\n\t\t * @method getEnd\r\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\r\n\t\t * @return {Element} End element of selection range.\r\n\t\t */\r\n\t\tgetEnd: function(real) {\r\n\t\t\tvar self = this, rng = self.getRng(), endElement, endOffset;\r\n\r\n\t\t\tif (rng.duplicate || rng.item) {\r\n\t\t\t\tif (rng.item) {\r\n\t\t\t\t\treturn rng.item(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trng = rng.duplicate();\r\n\t\t\t\trng.collapse(0);\r\n\t\t\t\tendElement = rng.parentElement();\r\n\t\t\t\tif (endElement.ownerDocument !== self.dom.doc) {\r\n\t\t\t\t\tendElement = self.dom.getRoot();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (endElement && endElement.nodeName == 'BODY') {\r\n\t\t\t\t\treturn endElement.lastChild || endElement;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn endElement;\r\n\t\t\t}\r\n\r\n\t\t\tendElement = rng.endContainer;\r\n\t\t\tendOffset = rng.endOffset;\r\n\r\n\t\t\tif (endElement.nodeType == 1 && endElement.hasChildNodes()) {\r\n\t\t\t\tif (!real || !rng.collapsed) {\r\n\t\t\t\t\tendElement = endElement.childNodes[endOffset > 0 ? endOffset - 1 : endOffset];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (endElement && endElement.nodeType == 3) {\r\n\t\t\t\treturn endElement.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn endElement;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a bookmark location for the current selection. This bookmark object\r\n\t\t * can then be used to restore the selection after some content modification to the document.\r\n\t\t *\r\n\t\t * @method getBookmark\r\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\r\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\r\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\r\n\t\t * @example\r\n\t\t * // Stores a bookmark of the current selection\r\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\r\n\t\t *\r\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\r\n\t\t *\r\n\t\t * // Restore the selection bookmark\r\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\r\n\t\t */\r\n\t\tgetBookmark: function(type, normalized) {\r\n\t\t\treturn this.bookmarkManager.getBookmark(type, normalized);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Restores the selection to the specified bookmark.\r\n\t\t *\r\n\t\t * @method moveToBookmark\r\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\r\n\t\t * @return {Boolean} true/false if it was successful or not.\r\n\t\t * @example\r\n\t\t * // Stores a bookmark of the current selection\r\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\r\n\t\t *\r\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\r\n\t\t *\r\n\t\t * // Restore the selection bookmark\r\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\r\n\t\t */\r\n\t\tmoveToBookmark: function(bookmark) {\r\n\t\t\treturn this.bookmarkManager.moveToBookmark(bookmark);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Selects the specified element. This will place the start and end of the selection range around the element.\r\n\t\t *\r\n\t\t * @method select\r\n\t\t * @param {Element} node HTML DOM element to select.\r\n\t\t * @param {Boolean} content Optional bool state if the contents should be selected or not on non IE browser.\r\n\t\t * @return {Element} Selected element the same element as the one that got passed in.\r\n\t\t * @example\r\n\t\t * // Select the first paragraph in the active editor\r\n\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\r\n\t\t */\r\n\t\tselect: function(node, content) {\r\n\t\t\tvar self = this, dom = self.dom, rng = dom.createRng(), idx;\r\n\r\n\t\t\t// Clear stored range set by FocusManager\r\n\t\t\tself.lastFocusBookmark = null;\r\n\r\n\t\t\tif (node) {\r\n\t\t\t\tif (!content && self.controlSelection.controlSelect(node)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tidx = dom.nodeIndex(node);\r\n\t\t\t\trng.setStart(node.parentNode, idx);\r\n\t\t\t\trng.setEnd(node.parentNode, idx + 1);\r\n\r\n\t\t\t\t// Find first/last text node or BR element\r\n\t\t\t\tif (content) {\r\n\t\t\t\t\tself._moveEndPoint(rng, node, true);\r\n\t\t\t\t\tself._moveEndPoint(rng, node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.setRng(rng);\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the selection range is collapsed or not. Collapsed means if it's a caret or a larger selection.\r\n\t\t *\r\n\t\t * @method isCollapsed\r\n\t\t * @return {Boolean} true/false state if the selection range is collapsed or not.\r\n\t\t * Collapsed means if it's a caret or a larger selection.\r\n\t\t */\r\n\t\tisCollapsed: function() {\r\n\t\t\tvar self = this, rng = self.getRng(), sel = self.getSel();\r\n\r\n\t\t\tif (!rng || rng.item) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (rng.compareEndPoints) {\r\n\t\t\t\treturn rng.compareEndPoints('StartToEnd', rng) === 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn !sel || rng.collapsed;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Collapse the selection to start or end of range.\r\n\t\t *\r\n\t\t * @method collapse\r\n\t\t * @param {Boolean} toStart Optional boolean state if to collapse to end or not. Defaults to false.\r\n\t\t */\r\n\t\tcollapse: function(toStart) {\r\n\t\t\tvar self = this, rng = self.getRng(), node;\r\n\r\n\t\t\t// Control range on IE\r\n\t\t\tif (rng.item) {\r\n\t\t\t\tnode = rng.item(0);\r\n\t\t\t\trng = self.win.document.body.createTextRange();\r\n\t\t\t\trng.moveToElementText(node);\r\n\t\t\t}\r\n\r\n\t\t\trng.collapse(!!toStart);\r\n\t\t\tself.setRng(rng);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the browsers internal selection object.\r\n\t\t *\r\n\t\t * @method getSel\r\n\t\t * @return {Selection} Internal browser selection object.\r\n\t\t */\r\n\t\tgetSel: function() {\r\n\t\t\tvar win = this.win;\r\n\r\n\t\t\treturn win.getSelection ? win.getSelection() : win.document.selection;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the browsers internal range object.\r\n\t\t *\r\n\t\t * @method getRng\r\n\t\t * @param {Boolean} w3c Forces a compatible W3C range on IE.\r\n\t\t * @return {Range} Internal browser range object.\r\n\t\t * @see http://www.quirksmode.org/dom/range_intro.html\r\n\t\t * @see http://www.dotvoid.com/2001/03/using-the-range-object-in-mozilla/\r\n\t\t */\r\n\t\tgetRng: function(w3c) {\r\n\t\t\tvar self = this, selection, rng, elm, doc, ieRng, evt;\r\n\r\n\t\t\tfunction tryCompareBoundaryPoints(how, sourceRange, destinationRange) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn sourceRange.compareBoundaryPoints(how, destinationRange);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Gecko throws wrong document exception if the range points\r\n\t\t\t\t\t// to nodes that where removed from the dom #6690\r\n\t\t\t\t\t// Browsers should mutate existing DOMRange instances so that they always point\r\n\t\t\t\t\t// to something in the document this is not the case in Gecko works fine in IE/WebKit/Blink\r\n\t\t\t\t\t// For performance reasons just return -1\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.win) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tdoc = self.win.document;\r\n\r\n\t\t\t// Use last rng passed from FocusManager if it's available this enables\r\n\t\t\t// calls to editor.selection.getStart() to work when caret focus is lost on IE\r\n\t\t\tif (!w3c && self.lastFocusBookmark) {\r\n\t\t\t\tvar bookmark = self.lastFocusBookmark;\r\n\r\n\t\t\t\t// Convert bookmark to range IE 11 fix\r\n\t\t\t\tif (bookmark.startContainer) {\r\n\t\t\t\t\trng = doc.createRange();\r\n\t\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\r\n\t\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng = bookmark;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\r\n\t\t\t// Found tridentSel object then we need to use that one\r\n\t\t\tif (w3c && self.tridentSel) {\r\n\t\t\t\treturn self.tridentSel.getRangeAt(0);\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tif ((selection = self.getSel())) {\r\n\t\t\t\t\tif (selection.rangeCount > 0) {\r\n\t\t\t\t\t\trng = selection.getRangeAt(0);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trng = selection.createRange ? selection.createRange() : doc.createRange();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// IE throws unspecified error here if TinyMCE is placed in a frame/iframe\r\n\t\t\t}\r\n\r\n\t\t\tevt = self.editor.fire('GetSelectionRange', {range: rng});\r\n\t\t\tif (evt.range !== rng) {\r\n\t\t\t\treturn evt.range;\r\n\t\t\t}\r\n\r\n\t\t\t// We have W3C ranges and it's IE then fake control selection since IE9 doesn't handle that correctly yet\r\n\t\t\t// IE 11 doesn't support the selection object so we check for that as well\r\n\t\t\tif (isIE && rng && rng.setStart && doc.selection) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// IE will sometimes throw an exception here\r\n\t\t\t\t\tieRng = doc.selection.createRange();\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Ignore\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ieRng && ieRng.item) {\r\n\t\t\t\t\telm = ieRng.item(0);\r\n\t\t\t\t\trng = doc.createRange();\r\n\t\t\t\t\trng.setStartBefore(elm);\r\n\t\t\t\t\trng.setEndAfter(elm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// No range found then create an empty one\r\n\t\t\t// This can occur when the editor is placed in a hidden container element on Gecko\r\n\t\t\t// Or on IE when there was an exception\r\n\t\t\tif (!rng) {\r\n\t\t\t\trng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\r\n\t\t\t}\r\n\r\n\t\t\t// If range is at start of document then move it to start of body\r\n\t\t\tif (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\r\n\t\t\t\telm = self.dom.getRoot();\r\n\t\t\t\trng.setStart(elm, 0);\r\n\t\t\t\trng.setEnd(elm, 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (self.selectedRange && self.explicitRange) {\r\n\t\t\t\tif (tryCompareBoundaryPoints(rng.START_TO_START, rng, self.selectedRange) === 0 &&\r\n\t\t\t\t\ttryCompareBoundaryPoints(rng.END_TO_END, rng, self.selectedRange) === 0) {\r\n\t\t\t\t\t// Safari, Opera and Chrome only ever select text which causes the range to change.\r\n\t\t\t\t\t// This lets us use the originally set range if the selection hasn't been changed by the user.\r\n\t\t\t\t\trng = self.explicitRange;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.selectedRange = null;\r\n\t\t\t\t\tself.explicitRange = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn rng;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Changes the selection to the specified DOM range.\r\n\t\t *\r\n\t\t * @method setRng\r\n\t\t * @param {Range} rng Range to select.\r\n\t\t * @param {Boolean} forward Optional boolean if the selection is forwards or backwards.\r\n\t\t */\r\n\t\tsetRng: function(rng, forward) {\r\n\t\t\tvar self = this, sel, node, evt;\r\n\r\n\t\t\tif (!rng) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Is IE specific range\r\n\t\t\tif (rng.select) {\r\n\t\t\t\tself.explicitRange = null;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\trng.select();\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Needed for some odd IE bug #1843306\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.tridentSel) {\r\n\t\t\t\tsel = self.getSel();\r\n\r\n\t\t\t\tevt = self.editor.fire('SetSelectionRange', {range: rng});\r\n\t\t\t\trng = evt.range;\r\n\r\n\t\t\t\tif (sel) {\r\n\t\t\t\t\tself.explicitRange = rng;\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tsel.removeAllRanges();\r\n\t\t\t\t\t\tsel.addRange(rng);\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// IE might throw errors here if the editor is within a hidden container and selection is changed\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Forward is set to false and we have an extend function\r\n\t\t\t\t\tif (forward === false && sel.extend) {\r\n\t\t\t\t\t\tsel.collapse(rng.endContainer, rng.endOffset);\r\n\t\t\t\t\t\tsel.extend(rng.startContainer, rng.startOffset);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// adding range isn't always successful so we need to check range count otherwise an exception can occur\r\n\t\t\t\t\tself.selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// WebKit egde case selecting images works better using setBaseAndExtent\r\n\t\t\t\tif (!rng.collapsed && rng.startContainer == rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\r\n\t\t\t\t\tif (rng.endOffset - rng.startOffset < 2) {\r\n\t\t\t\t\t\tif (rng.startContainer.hasChildNodes()) {\r\n\t\t\t\t\t\t\tnode = rng.startContainer.childNodes[rng.startOffset];\r\n\t\t\t\t\t\t\tif (node && node.tagName == 'IMG') {\r\n\t\t\t\t\t\t\t\tself.getSel().setBaseAndExtent(node, 0, node, 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Is W3C Range fake range on IE\r\n\t\t\t\tif (rng.cloneRange) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tself.tridentSel.addRange(rng);\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t//IE9 throws an error here if called before selection is placed in the editor\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the current selection to the specified DOM element.\r\n\t\t *\r\n\t\t * @method setNode\r\n\t\t * @param {Element} elm Element to set as the contents of the selection.\r\n\t\t * @return {Element} Returns the element that got passed in.\r\n\t\t * @example\r\n\t\t * // Inserts a DOM node at current selection/caret location\r\n\t\t * tinymce.activeEditor.selection.setNode(tinymce.activeEditor.dom.create('img', {src: 'some.gif', title: 'some title'}));\r\n\t\t */\r\n\t\tsetNode: function(elm) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.setContent(self.dom.getOuterHTML(elm));\r\n\r\n\t\t\treturn elm;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the currently selected element or the common ancestor element for both start and end of the selection.\r\n\t\t *\r\n\t\t * @method getNode\r\n\t\t * @return {Element} Currently selected element or common ancestor element.\r\n\t\t * @example\r\n\t\t * // Alerts the currently selected elements node name\r\n\t\t * alert(tinymce.activeEditor.selection.getNode().nodeName);\r\n\t\t */\r\n\t\tgetNode: function() {\r\n\t\t\tvar self = this, rng = self.getRng(), elm;\r\n\t\t\tvar startContainer, endContainer, startOffset, endOffset, root = self.dom.getRoot();\r\n\r\n\t\t\tfunction skipEmptyTextNodes(node, forwards) {\r\n\t\t\t\tvar orig = node;\r\n\r\n\t\t\t\twhile (node && node.nodeType === 3 && node.length === 0) {\r\n\t\t\t\t\tnode = forwards ? node.nextSibling : node.previousSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node || orig;\r\n\t\t\t}\r\n\r\n\t\t\t// Range maybe lost after the editor is made visible again\r\n\t\t\tif (!rng) {\r\n\t\t\t\treturn root;\r\n\t\t\t}\r\n\r\n\t\t\tstartContainer = rng.startContainer;\r\n\t\t\tendContainer = rng.endContainer;\r\n\t\t\tstartOffset = rng.startOffset;\r\n\t\t\tendOffset = rng.endOffset;\r\n\r\n\t\t\tif (rng.setStart) {\r\n\t\t\t\telm = rng.commonAncestorContainer;\r\n\r\n\t\t\t\t// Handle selection a image or other control like element such as anchors\r\n\t\t\t\tif (!rng.collapsed) {\r\n\t\t\t\t\tif (startContainer == endContainer) {\r\n\t\t\t\t\t\tif (endOffset - startOffset < 2) {\r\n\t\t\t\t\t\t\tif (startContainer.hasChildNodes()) {\r\n\t\t\t\t\t\t\t\telm = startContainer.childNodes[startOffset];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the anchor node is a element instead of a text node then return this element\r\n\t\t\t\t\t//if (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1)\r\n\t\t\t\t\t//\treturn sel.anchorNode.childNodes[sel.anchorOffset];\r\n\r\n\t\t\t\t\t// Handle cases where the selection is immediately wrapped around a node and return that node instead of it's parent.\r\n\t\t\t\t\t// This happens when you double click an underlined word in FireFox.\r\n\t\t\t\t\tif (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\r\n\t\t\t\t\t\tif (startContainer.length === startOffset) {\r\n\t\t\t\t\t\t\tstartContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (endOffset === 0) {\r\n\t\t\t\t\t\t\tendContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tendContainer = endContainer.parentNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (startContainer && startContainer === endContainer) {\r\n\t\t\t\t\t\t\treturn startContainer;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (elm && elm.nodeType == 3) {\r\n\t\t\t\t\treturn elm.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn elm;\r\n\t\t\t}\r\n\r\n\t\t\telm = rng.item ? rng.item(0) : rng.parentElement();\r\n\r\n\t\t\t// IE 7 might return elements outside the iframe\r\n\t\t\tif (elm.ownerDocument !== self.win.document) {\r\n\t\t\t\telm = root;\r\n\t\t\t}\r\n\r\n\t\t\treturn elm;\r\n\t\t},\r\n\r\n\t\tgetSelectedBlocks: function(startElm, endElm) {\r\n\t\t\tvar self = this, dom = self.dom, node, root, selectedBlocks = [];\r\n\r\n\t\t\troot = dom.getRoot();\r\n\t\t\tstartElm = dom.getParent(startElm || self.getStart(), dom.isBlock);\r\n\t\t\tendElm = dom.getParent(endElm || self.getEnd(), dom.isBlock);\r\n\r\n\t\t\tif (startElm && startElm != root) {\r\n\t\t\t\tselectedBlocks.push(startElm);\r\n\t\t\t}\r\n\r\n\t\t\tif (startElm && endElm && startElm != endElm) {\r\n\t\t\t\tnode = startElm;\r\n\r\n\t\t\t\tvar walker = new TreeWalker(startElm, root);\r\n\t\t\t\twhile ((node = walker.next()) && node != endElm) {\r\n\t\t\t\t\tif (dom.isBlock(node)) {\r\n\t\t\t\t\t\tselectedBlocks.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (endElm && startElm != endElm && endElm != root) {\r\n\t\t\t\tselectedBlocks.push(endElm);\r\n\t\t\t}\r\n\r\n\t\t\treturn selectedBlocks;\r\n\t\t},\r\n\r\n\t\tisForward: function() {\r\n\t\t\tvar dom = this.dom, sel = this.getSel(), anchorRange, focusRange;\r\n\r\n\t\t\t// No support for selection direction then always return true\r\n\t\t\tif (!sel || !sel.anchorNode || !sel.focusNode) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tanchorRange = dom.createRng();\r\n\t\t\tanchorRange.setStart(sel.anchorNode, sel.anchorOffset);\r\n\t\t\tanchorRange.collapse(true);\r\n\r\n\t\t\tfocusRange = dom.createRng();\r\n\t\t\tfocusRange.setStart(sel.focusNode, sel.focusOffset);\r\n\t\t\tfocusRange.collapse(true);\r\n\r\n\t\t\treturn anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\r\n\t\t},\r\n\r\n\t\tnormalize: function() {\r\n\t\t\tvar self = this, rng = self.getRng();\r\n\r\n\t\t\tif (Env.range && new RangeUtils(self.dom).normalize(rng)) {\r\n\t\t\t\tself.setRng(rng, self.isForward());\r\n\t\t\t}\r\n\r\n\t\t\treturn rng;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes callback when the current selection starts/stops matching the specified selector. The current\r\n\t\t * state will be passed to the callback as it's first argument.\r\n\t\t *\r\n\t\t * @method selectorChanged\r\n\t\t * @param {String} selector CSS selector to check for.\r\n\t\t * @param {function} callback Callback with state and args when the selector is matches or not.\r\n\t\t */\r\n\t\tselectorChanged: function(selector, callback) {\r\n\t\t\tvar self = this, currentSelectors;\r\n\r\n\t\t\tif (!self.selectorChangedData) {\r\n\t\t\t\tself.selectorChangedData = {};\r\n\t\t\t\tcurrentSelectors = {};\r\n\r\n\t\t\t\tself.editor.on('NodeChange', function(e) {\r\n\t\t\t\t\tvar node = e.element, dom = self.dom, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\r\n\r\n\t\t\t\t\t// Check for new matching selectors\r\n\t\t\t\t\teach(self.selectorChangedData, function(callbacks, selector) {\r\n\t\t\t\t\t\teach(parents, function(node) {\r\n\t\t\t\t\t\t\tif (dom.is(node, selector)) {\r\n\t\t\t\t\t\t\t\tif (!currentSelectors[selector]) {\r\n\t\t\t\t\t\t\t\t\t// Execute callbacks\r\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\r\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, selector: selector, parents: parents});\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tcurrentSelectors[selector] = callbacks;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tmatchedSelectors[selector] = callbacks;\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Check if current selectors still match\r\n\t\t\t\t\teach(currentSelectors, function(callbacks, selector) {\r\n\t\t\t\t\t\tif (!matchedSelectors[selector]) {\r\n\t\t\t\t\t\t\tdelete currentSelectors[selector];\r\n\r\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\r\n\t\t\t\t\t\t\t\tcallback(false, {node: node, selector: selector, parents: parents});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add selector listeners\r\n\t\t\tif (!self.selectorChangedData[selector]) {\r\n\t\t\t\tself.selectorChangedData[selector] = [];\r\n\t\t\t}\r\n\r\n\t\t\tself.selectorChangedData[selector].push(callback);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tgetScrollContainer: function() {\r\n\t\t\tvar scrollContainer, node = this.dom.getRoot();\r\n\r\n\t\t\twhile (node && node.nodeName != 'BODY') {\r\n\t\t\t\tif (node.scrollHeight > node.clientHeight) {\r\n\t\t\t\t\tscrollContainer = node;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn scrollContainer;\r\n\t\t},\r\n\r\n\t\tscrollIntoView: function(elm, alignToTop) {\r\n\t\t\tvar y, viewPort, self = this, dom = self.dom, root = dom.getRoot(), viewPortY, viewPortH, offsetY = 0;\r\n\r\n\t\t\tfunction getPos(elm) {\r\n\t\t\t\tvar x = 0, y = 0;\r\n\r\n\t\t\t\tvar offsetParent = elm;\r\n\t\t\t\twhile (offsetParent && offsetParent.nodeType) {\r\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\r\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\r\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {x: x, y: y};\r\n\t\t\t}\r\n\r\n\t\t\tif (!NodeType.isElement(elm)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (alignToTop === false) {\r\n\t\t\t\toffsetY = elm.offsetHeight;\r\n\t\t\t}\r\n\r\n\t\t\tif (root.nodeName != 'BODY') {\r\n\t\t\t\tvar scrollContainer = self.getScrollContainer();\r\n\t\t\t\tif (scrollContainer) {\r\n\t\t\t\t\ty = getPos(elm).y - getPos(scrollContainer).y + offsetY;\r\n\t\t\t\t\tviewPortH = scrollContainer.clientHeight;\r\n\t\t\t\t\tviewPortY = scrollContainer.scrollTop;\r\n\t\t\t\t\tif (y < viewPortY || y + 25 > viewPortY + viewPortH) {\r\n\t\t\t\t\t\tscrollContainer.scrollTop = y < viewPortY ? y : y - viewPortH + 25;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tviewPort = dom.getViewPort(self.editor.getWin());\r\n\t\t\ty = dom.getPos(elm).y + offsetY;\r\n\t\t\tviewPortY = viewPort.y;\r\n\t\t\tviewPortH = viewPort.h;\r\n\t\t\tif (y < viewPort.y || y + 25 > viewPortY + viewPortH) {\r\n\t\t\t\tself.editor.getWin().scrollTo(0, y < viewPortY ? y : y - viewPortH + 25);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tplaceCaretAt: function(clientX, clientY) {\r\n\t\t\tthis.setRng(RangeUtils.getCaretRangeFromPoint(clientX, clientY, this.editor.getDoc()));\r\n\t\t},\r\n\r\n\t\t_moveEndPoint: function(rng, node, start) {\r\n\t\t\tvar root = node, walker = new TreeWalker(node, root);\r\n\t\t\tvar nonEmptyElementsMap = this.dom.schema.getNonEmptyElements();\r\n\r\n\t\t\tdo {\r\n\t\t\t\t// Text node\r\n\t\t\t\tif (node.nodeType == 3 && trim(node.nodeValue).length !== 0) {\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// BR/IMG/INPUT elements but not table cells\r\n\t\t\t\tif (nonEmptyElementsMap[node.nodeName] && !/^(TD|TH)$/.test(node.nodeName)) {\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (node.nodeName == 'BR') {\r\n\t\t\t\t\t\t\trng.setEndBefore(node);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.setEndAfter(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Found empty text block old IE can place the selection inside those\r\n\t\t\t\tif (Env.ie && Env.ie < 11 && this.dom.isBlock(node) && this.dom.isEmpty(node)) {\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trng.setEnd(node, 0);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} while ((node = (start ? walker.next() : walker.prev())));\r\n\r\n\t\t\t// Failed to find any text node or other suitable location then move to the root of body\r\n\t\t\tif (root.nodeName == 'BODY') {\r\n\t\t\t\tif (start) {\r\n\t\t\t\t\trng.setStart(root, 0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng.setEnd(root, root.childNodes.length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetBoundingClientRect:  function() {\r\n\t\t\tvar rng = this.getRng();\r\n\t\t\treturn rng.collapsed ? CaretPosition.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\r\n\t\t},\r\n\r\n\t\tdestroy: function() {\r\n\t\t\tthis.win = null;\r\n\t\t\tthis.controlSelection.destroy();\r\n\t\t}\r\n\t};\r\n\r\n\treturn Selection;\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/ElementUtils.js\r\n\r\n/**\r\n * ElementUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Utility class for various element specific functions.\r\n *\r\n * @private\r\n * @class tinymce.dom.ElementUtils\r\n */\r\ndefine(\"tinymce/dom/ElementUtils\", [\r\n\t\"tinymce/dom/BookmarkManager\",\r\n\t\"tinymce/util/Tools\"\r\n], function(BookmarkManager, Tools) {\r\n\tvar each = Tools.each;\r\n\r\n\tfunction ElementUtils(dom) {\r\n\t\t/**\r\n\t\t * Compares two nodes and checks if it's attributes and styles matches.\r\n\t\t * This doesn't compare classes as items since their order is significant.\r\n\t\t *\r\n\t\t * @method compare\r\n\t\t * @param {Node} node1 First node to compare with.\r\n\t\t * @param {Node} node2 Second node to compare with.\r\n\t\t * @return {boolean} True/false if the nodes are the same or not.\r\n\t\t */\r\n\t\tthis.compare = function(node1, node2) {\r\n\t\t\t// Not the same name\r\n\t\t\tif (node1.nodeName != node2.nodeName) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns all the nodes attributes excluding internal ones, styles and classes.\r\n\t\t\t *\r\n\t\t\t * @private\r\n\t\t\t * @param {Node} node Node to get attributes from.\r\n\t\t\t * @return {Object} Name/value object with attributes and attribute values.\r\n\t\t\t */\r\n\t\t\tfunction getAttribs(node) {\r\n\t\t\t\tvar attribs = {};\r\n\r\n\t\t\t\teach(dom.getAttribs(node), function(attr) {\r\n\t\t\t\t\tvar name = attr.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\t// Don't compare internal attributes or style\r\n\t\t\t\t\tif (name.indexOf('_') !== 0 && name !== 'style' && name !== 'data-mce-style' && name != 'data-mce-fragment') {\r\n\t\t\t\t\t\tattribs[name] = dom.getAttrib(node, name);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn attribs;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Compares two objects checks if it's key + value exists in the other one.\r\n\t\t\t *\r\n\t\t\t * @private\r\n\t\t\t * @param {Object} obj1 First object to compare.\r\n\t\t\t * @param {Object} obj2 Second object to compare.\r\n\t\t\t * @return {boolean} True/false if the objects matches or not.\r\n\t\t\t */\r\n\t\t\tfunction compareObjects(obj1, obj2) {\r\n\t\t\t\tvar value, name;\r\n\r\n\t\t\t\tfor (name in obj1) {\r\n\t\t\t\t\t// Obj1 has item obj2 doesn't have\r\n\t\t\t\t\tif (obj1.hasOwnProperty(name)) {\r\n\t\t\t\t\t\tvalue = obj2[name];\r\n\r\n\t\t\t\t\t\t// Obj2 doesn't have obj1 item\r\n\t\t\t\t\t\tif (typeof value == \"undefined\") {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Obj2 item has a different value\r\n\t\t\t\t\t\tif (obj1[name] != value) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Delete similar value\r\n\t\t\t\t\t\tdelete obj2[name];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if obj 2 has something obj 1 doesn't have\r\n\t\t\t\tfor (name in obj2) {\r\n\t\t\t\t\t// Obj2 has item obj1 doesn't have\r\n\t\t\t\t\tif (obj2.hasOwnProperty(name)) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Attribs are not the same\r\n\t\t\tif (!compareObjects(getAttribs(node1), getAttribs(node2))) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Styles are not the same\r\n\t\t\tif (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn !BookmarkManager.isBookmarkNode(node1) && !BookmarkManager.isBookmarkNode(node2);\r\n\t\t};\r\n\t}\r\n\r\n\treturn ElementUtils;\r\n});\r\n\r\n// Included from: js/tinymce/classes/fmt/Preview.js\r\n\r\n/**\r\n * Preview.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Internal class for generating previews styles for formats.\r\n *\r\n * Example:\r\n *  Preview.getCssText(editor, 'bold');\r\n *\r\n * @private\r\n * @class tinymce.fmt.Preview\r\n */\r\ndefine(\"tinymce/fmt/Preview\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\tvar each = Tools.each;\r\n\r\n\tfunction getCssText(editor, format) {\r\n\t\tvar name, previewElm, dom = editor.dom;\r\n\t\tvar previewCss = '', parentFontSize, previewStyles;\r\n\r\n\t\tpreviewStyles = editor.settings.preview_styles;\r\n\r\n\t\t// No preview forced\r\n\t\tif (previewStyles === false) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\t// Default preview\r\n\t\tif (!previewStyles) {\r\n\t\t\tpreviewStyles = 'font-family font-size font-weight font-style text-decoration ' +\r\n\t\t\t\t'text-transform color background-color border border-radius outline text-shadow';\r\n\t\t}\r\n\r\n\t\t// Removes any variables since these can't be previewed\r\n\t\tfunction removeVars(val) {\r\n\t\t\treturn val.replace(/%(\\w+)/g, '');\r\n\t\t}\r\n\r\n\t\t// Create block/inline element to use for preview\r\n\t\tif (typeof format == \"string\") {\r\n\t\t\tformat = editor.formatter.get(format);\r\n\t\t\tif (!format) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tformat = format[0];\r\n\t\t}\r\n\r\n\t\tname = format.block || format.inline || 'span';\r\n\t\tpreviewElm = dom.create(name);\r\n\r\n\t\t// Add format styles to preview element\r\n\t\teach(format.styles, function(value, name) {\r\n\t\t\tvalue = removeVars(value);\r\n\r\n\t\t\tif (value) {\r\n\t\t\t\tdom.setStyle(previewElm, name, value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add attributes to preview element\r\n\t\teach(format.attributes, function(value, name) {\r\n\t\t\tvalue = removeVars(value);\r\n\r\n\t\t\tif (value) {\r\n\t\t\t\tdom.setAttrib(previewElm, name, value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add classes to preview element\r\n\t\teach(format.classes, function(value) {\r\n\t\t\tvalue = removeVars(value);\r\n\r\n\t\t\tif (!dom.hasClass(previewElm, value)) {\r\n\t\t\t\tdom.addClass(previewElm, value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\teditor.fire('PreviewFormats');\r\n\r\n\t\t// Add the previewElm outside the visual area\r\n\t\tdom.setStyles(previewElm, {position: 'absolute', left: -0xFFFF});\r\n\t\teditor.getBody().appendChild(previewElm);\r\n\r\n\t\t// Get parent container font size so we can compute px values out of em/% for older IE:s\r\n\t\tparentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\r\n\t\tparentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\r\n\r\n\t\teach(previewStyles.split(' '), function(name) {\r\n\t\t\tvar value = dom.getStyle(previewElm, name, true);\r\n\r\n\t\t\t// If background is transparent then check if the body has a background color we can use\r\n\t\t\tif (name == 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\r\n\t\t\t\tvalue = dom.getStyle(editor.getBody(), name, true);\r\n\r\n\t\t\t\t// Ignore white since it's the default color, not the nicest fix\r\n\t\t\t\t// TODO: Fix this by detecting runtime style\r\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#ffffff') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (name == 'color') {\r\n\t\t\t\t// Ignore black since it's the default color, not the nicest fix\r\n\t\t\t\t// TODO: Fix this by detecting runtime style\r\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#000000') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Old IE won't calculate the font size so we need to do that manually\r\n\t\t\tif (name == 'font-size') {\r\n\t\t\t\tif (/em|%$/.test(value)) {\r\n\t\t\t\t\tif (parentFontSize === 0) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Convert font size from em/% to px\r\n\t\t\t\t\tvalue = parseFloat(value, 10) / (/%$/.test(value) ? 100 : 1);\r\n\t\t\t\t\tvalue = (value * parentFontSize) + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (name == \"border\" && value) {\r\n\t\t\t\tpreviewCss += 'padding:0 2px;';\r\n\t\t\t}\r\n\r\n\t\t\tpreviewCss += name + ':' + value + ';';\r\n\t\t});\r\n\r\n\t\teditor.fire('AfterPreviewFormats');\r\n\r\n\t\t//previewCss += 'line-height:normal';\r\n\r\n\t\tdom.remove(previewElm);\r\n\r\n\t\treturn previewCss;\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetCssText: getCssText\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/fmt/Hooks.js\r\n\r\n/**\r\n * Hooks.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Internal class for overriding formatting.\r\n *\r\n * @private\r\n * @class tinymce.fmt.Hooks\r\n */\r\ndefine(\"tinymce/fmt/Hooks\", [\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/dom/DomQuery\"\r\n], function(Arr, NodeType, $) {\r\n\tvar postProcessHooks = [], filter = Arr.filter, each = Arr.each;\r\n\r\n\tfunction addPostProcessHook(name, hook) {\r\n\t\tvar hooks = postProcessHooks[name];\r\n\r\n\t\tif (!hooks) {\r\n\t\t\tpostProcessHooks[name] = hooks = [];\r\n\t\t}\r\n\r\n\t\tpostProcessHooks[name].push(hook);\r\n\t}\r\n\r\n\tfunction postProcess(name, editor) {\r\n\t\teach(postProcessHooks[name], function(hook) {\r\n\t\t\thook(editor);\r\n\t\t});\r\n\t}\r\n\r\n\taddPostProcessHook(\"pre\", function(editor) {\r\n\t\tvar rng = editor.selection.getRng(), isPre, blocks;\r\n\r\n\t\tfunction hasPreSibling(pre) {\r\n\t\t\treturn isPre(pre.previousSibling) && Arr.indexOf(blocks, pre.previousSibling) != -1;\r\n\t\t}\r\n\r\n\t\tfunction joinPre(pre1, pre2) {\r\n\t\t\t$(pre2).remove();\r\n\t\t\t$(pre1).append('<br><br>').append(pre2.childNodes);\r\n\t\t}\r\n\r\n\t\tisPre = NodeType.matchNodeNames('pre');\r\n\r\n\t\tif (!rng.collapsed) {\r\n\t\t\tblocks = editor.selection.getSelectedBlocks();\r\n\r\n\t\t\teach(filter(filter(blocks, isPre), hasPreSibling), function(pre) {\r\n\t\t\t\tjoinPre(pre.previousSibling, pre);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\treturn {\r\n\t\tpostProcess: postProcess\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/Formatter.js\r\n\r\n/**\r\n * Formatter.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Text formatter engine class. This class is used to apply formats like bold, italic, font size\r\n * etc to the current selection or specific nodes. This engine was built to replace the browser's\r\n * default formatting logic for execCommand due to its inconsistent and buggy behavior.\r\n *\r\n * @class tinymce.Formatter\r\n * @example\r\n *  tinymce.activeEditor.formatter.register('mycustomformat', {\r\n *    inline: 'span',\r\n *    styles: {color: '#ff0000'}\r\n *  });\r\n *\r\n *  tinymce.activeEditor.formatter.apply('mycustomformat');\r\n */\r\ndefine(\"tinymce/Formatter\", [\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/dom/BookmarkManager\",\r\n\t\"tinymce/dom/ElementUtils\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/fmt/Preview\",\r\n\t\"tinymce/fmt/Hooks\"\r\n], function(TreeWalker, RangeUtils, BookmarkManager, ElementUtils, Tools, Preview, Hooks) {\r\n\t/**\r\n\t * Constructs a new formatter instance.\r\n\t *\r\n\t * @constructor Formatter\r\n\t * @param {tinymce.Editor} ed Editor instance to construct the formatter engine to.\r\n\t */\r\n\treturn function(ed) {\r\n\t\tvar formats = {},\r\n\t\t\tdom = ed.dom,\r\n\t\t\tselection = ed.selection,\r\n\t\t\trangeUtils = new RangeUtils(dom),\r\n\t\t\tisValid = ed.schema.isValidChild,\r\n\t\t\tisBlock = dom.isBlock,\r\n\t\t\tforcedRootBlock = ed.settings.forced_root_block,\r\n\t\t\tnodeIndex = dom.nodeIndex,\r\n\t\t\tINVISIBLE_CHAR = '\\uFEFF',\r\n\t\t\tMCE_ATTR_RE = /^(src|href|style)$/,\r\n\t\t\tFALSE = false,\r\n\t\t\tTRUE = true,\r\n\t\t\tformatChangeData,\r\n\t\t\tundef,\r\n\t\t\tgetContentEditable = dom.getContentEditable,\r\n\t\t\tdisableCaretContainer,\r\n\t\t\tmarkCaretContainersBogus,\r\n\t\t\tisBookmarkNode = BookmarkManager.isBookmarkNode;\r\n\r\n\t\tvar each = Tools.each,\r\n\t\t\tgrep = Tools.grep,\r\n\t\t\twalk = Tools.walk,\r\n\t\t\textend = Tools.extend;\r\n\r\n\t\tfunction isTextBlock(name) {\r\n\t\t\tif (name.nodeType) {\r\n\t\t\t\tname = name.nodeName;\r\n\t\t\t}\r\n\r\n\t\t\treturn !!ed.schema.getTextBlockElements()[name.toLowerCase()];\r\n\t\t}\r\n\r\n\t\tfunction isTableCell(node) {\r\n\t\t\treturn /^(TH|TD)$/.test(node.nodeName);\r\n\t\t}\r\n\r\n\t\tfunction isInlineBlock(node) {\r\n\t\t\treturn node && /^(IMG)$/.test(node.nodeName);\r\n\t\t}\r\n\r\n\t\tfunction getParents(node, selector) {\r\n\t\t\treturn dom.getParents(node, selector, dom.getRoot());\r\n\t\t}\r\n\r\n\t\tfunction isCaretNode(node) {\r\n\t\t\treturn node.nodeType === 1 && node.id === '_mce_caret';\r\n\t\t}\r\n\r\n\t\tfunction defaultFormats() {\r\n\t\t\tregister({\r\n\t\t\t\tvaligntop: [\r\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'top'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tvalignmiddle: [\r\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'middle'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tvalignbottom: [\r\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'bottom'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\talignleft: [\r\n\t\t\t\t\t{selector: 'figure.image', collapsed: false, classes: 'align-left', ceFalseOverride: true},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n\t\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\t\ttextAlign: 'left'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tinherit: false,\r\n\t\t\t\t\t\tdefaultBlock: 'div'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{selector: 'img,table', collapsed: false, styles: {'float': 'left'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\taligncenter: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n\t\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\t\ttextAlign: 'center'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tinherit: false,\r\n\t\t\t\t\t\tdefaultBlock: 'div'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{selector: 'figure.image', collapsed: false, classes: 'align-center', ceFalseOverride: true},\r\n\t\t\t\t\t{selector: 'img', collapsed: false, styles: {display: 'block', marginLeft: 'auto', marginRight: 'auto'}},\r\n\t\t\t\t\t{selector: 'table', collapsed: false, styles: {marginLeft: 'auto', marginRight: 'auto'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\talignright: [\r\n\t\t\t\t\t{selector: 'figure.image', collapsed: false, classes: 'align-right', ceFalseOverride: true},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n\t\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\t\ttextAlign: 'right'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tinherit: false,\r\n\t\t\t\t\t\tdefaultBlock: 'div'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{selector: 'img,table', collapsed: false, styles: {'float': 'right'}}\r\n\t\t\t\t],\r\n\r\n\t\t\t\talignjustify: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n\t\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\t\ttextAlign: 'justify'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tinherit: false,\r\n\t\t\t\t\t\tdefaultBlock: 'div'\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tbold: [\r\n\t\t\t\t\t{inline: 'strong', remove: 'all'},\r\n\t\t\t\t\t{inline: 'span', styles: {fontWeight: 'bold'}},\r\n\t\t\t\t\t{inline: 'b', remove: 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\titalic: [\r\n\t\t\t\t\t{inline: 'em', remove: 'all'},\r\n\t\t\t\t\t{inline: 'span', styles: {fontStyle: 'italic'}},\r\n\t\t\t\t\t{inline: 'i', remove: 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tunderline: [\r\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'underline'}, exact: true},\r\n\t\t\t\t\t{inline: 'u', remove: 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tstrikethrough: [\r\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'line-through'}, exact: true},\r\n\t\t\t\t\t{inline: 'strike', remove: 'all'}\r\n\t\t\t\t],\r\n\r\n\t\t\t\tforecolor: {inline: 'span', styles: {color: '%value'}, links: true, remove_similar: true},\r\n\t\t\t\thilitecolor: {inline: 'span', styles: {backgroundColor: '%value'}, links: true, remove_similar: true},\r\n\t\t\t\tfontname: {inline: 'span', styles: {fontFamily: '%value'}},\r\n\t\t\t\tfontsize: {inline: 'span', styles: {fontSize: '%value'}},\r\n\t\t\t\tfontsize_class: {inline: 'span', attributes: {'class': '%value'}},\r\n\t\t\t\tblockquote: {block: 'blockquote', wrapper: 1, remove: 'all'},\r\n\t\t\t\tsubscript: {inline: 'sub'},\r\n\t\t\t\tsuperscript: {inline: 'sup'},\r\n\t\t\t\tcode: {inline: 'code'},\r\n\r\n\t\t\t\tlink: {inline: 'a', selector: 'a', remove: 'all', split: true, deep: true,\r\n\t\t\t\t\tonmatch: function() {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tonformat: function(elm, fmt, vars) {\r\n\t\t\t\t\t\teach(vars, function(value, key) {\r\n\t\t\t\t\t\t\tdom.setAttrib(elm, key, value);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\tremoveformat: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tselector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\r\n\t\t\t\t\t\tremove: 'all',\r\n\t\t\t\t\t\tsplit: true,\r\n\t\t\t\t\t\texpand: false,\r\n\t\t\t\t\t\tblock_expand: true,\r\n\t\t\t\t\t\tdeep: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{selector: 'span', attributes: ['style', 'class'], remove: 'empty', split: true, expand: false, deep: true},\r\n\t\t\t\t\t{selector: '*', attributes: ['style', 'class'], split: false, expand: false, deep: true}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\r\n\t\t\t// Register default block formats\r\n\t\t\teach('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function(name) {\r\n\t\t\t\tregister(name, {block: name, remove: 'all'});\r\n\t\t\t});\r\n\r\n\t\t\t// Register user defined formats\r\n\t\t\tregister(ed.settings.formats);\r\n\t\t}\r\n\r\n\t\tfunction addKeyboardShortcuts() {\r\n\t\t\t// Add some inline shortcuts\r\n\t\t\ted.addShortcut('meta+b', 'bold_desc', 'Bold');\r\n\t\t\ted.addShortcut('meta+i', 'italic_desc', 'Italic');\r\n\t\t\ted.addShortcut('meta+u', 'underline_desc', 'Underline');\r\n\r\n\t\t\t// BlockFormat shortcuts keys\r\n\t\t\tfor (var i = 1; i <= 6; i++) {\r\n\t\t\t\ted.addShortcut('access+' + i, '', ['FormatBlock', false, 'h' + i]);\r\n\t\t\t}\r\n\r\n\t\t\ted.addShortcut('access+7', '', ['FormatBlock', false, 'p']);\r\n\t\t\ted.addShortcut('access+8', '', ['FormatBlock', false, 'div']);\r\n\t\t\ted.addShortcut('access+9', '', ['FormatBlock', false, 'address']);\r\n\t\t}\r\n\r\n\t\t// Public functions\r\n\r\n\t\t/**\r\n\t\t * Returns the format by name or all formats if no name is specified.\r\n\t\t *\r\n\t\t * @method get\r\n\t\t * @param {String} name Optional name to retrieve by.\r\n\t\t * @return {Array/Object} Array/Object with all registered formats or a specific format.\r\n\t\t */\r\n\t\tfunction get(name) {\r\n\t\t\treturn name ? formats[name] : formats;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Registers a specific format by name.\r\n\t\t *\r\n\t\t * @method register\r\n\t\t * @param {Object/String} name Name of the format for example \"bold\".\r\n\t\t * @param {Object/Array} format Optional format object or array of format variants\r\n\t\t * can only be omitted if the first arg is an object.\r\n\t\t */\r\n\t\tfunction register(name, format) {\r\n\t\t\tif (name) {\r\n\t\t\t\tif (typeof name !== 'string') {\r\n\t\t\t\t\teach(name, function(format, name) {\r\n\t\t\t\t\t\tregister(name, format);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Force format into array and add it to internal collection\r\n\t\t\t\t\tformat = format.length ? format : [format];\r\n\r\n\t\t\t\t\teach(format, function(format) {\r\n\t\t\t\t\t\t// Set deep to false by default on selector formats this to avoid removing\r\n\t\t\t\t\t\t// alignment on images inside paragraphs when alignment is changed on paragraphs\r\n\t\t\t\t\t\tif (format.deep === undef) {\r\n\t\t\t\t\t\t\tformat.deep = !format.selector;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Default to true\r\n\t\t\t\t\t\tif (format.split === undef) {\r\n\t\t\t\t\t\t\tformat.split = !format.selector || format.inline;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Default to true\r\n\t\t\t\t\t\tif (format.remove === undef && format.selector && !format.inline) {\r\n\t\t\t\t\t\t\tformat.remove = 'none';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Mark format as a mixed format inline + block level\r\n\t\t\t\t\t\tif (format.selector && format.inline) {\r\n\t\t\t\t\t\t\tformat.mixed = true;\r\n\t\t\t\t\t\t\tformat.block_expand = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Split classes if needed\r\n\t\t\t\t\t\tif (typeof format.classes === 'string') {\r\n\t\t\t\t\t\t\tformat.classes = format.classes.split(/\\s+/);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tformats[name] = format;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Unregister a specific format by name.\r\n\t\t *\r\n\t\t * @method unregister\r\n\t\t * @param {String} name Name of the format for example \"bold\".\r\n\t\t */\r\n\t\tfunction unregister(name) {\r\n\t\t\tif (name && formats[name]) {\r\n\t\t\t\tdelete formats[name];\r\n\t\t\t}\r\n\r\n\t\t\treturn formats;\r\n\t\t}\r\n\r\n\t\tfunction matchesUnInheritedFormatSelector(node, name) {\r\n\t\t\tvar formatList = get(name);\r\n\r\n\t\t\tif (formatList) {\r\n\t\t\t\tfor (var i = 0; i < formatList.length; i++) {\r\n\t\t\t\t\tif (formatList[i].inherit === false && dom.is(node, formatList[i].selector)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction getTextDecoration(node) {\r\n\t\t\tvar decoration;\r\n\r\n\t\t\ted.dom.getParent(node, function(n) {\r\n\t\t\t\tdecoration = ed.dom.getStyle(n, 'text-decoration');\r\n\t\t\t\treturn decoration && decoration !== 'none';\r\n\t\t\t});\r\n\r\n\t\t\treturn decoration;\r\n\t\t}\r\n\r\n\t\tfunction processUnderlineAndColor(node) {\r\n\t\t\tvar textDecoration;\r\n\t\t\tif (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\r\n\t\t\t\ttextDecoration = getTextDecoration(node.parentNode);\r\n\t\t\t\tif (ed.dom.getStyle(node, 'color') && textDecoration) {\r\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', textDecoration);\r\n\t\t\t\t} else if (ed.dom.getStyle(node, 'text-decoration') === textDecoration) {\r\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Applies the specified format to the current selection or specified node.\r\n\t\t *\r\n\t\t * @method apply\r\n\t\t * @param {String} name Name of format to apply.\r\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying it.\r\n\t\t * @param {Node} node Optional node to apply the format to defaults to current selection.\r\n\t\t */\r\n\t\tfunction apply(name, vars, node) {\r\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, isCollapsed = !node && selection.isCollapsed();\r\n\r\n\t\t\tfunction setElementFormat(elm, fmt) {\r\n\t\t\t\tfmt = fmt || format;\r\n\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\tif (fmt.onformat) {\r\n\t\t\t\t\t\tfmt.onformat(elm, fmt, vars, node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teach(fmt.styles, function(value, name) {\r\n\t\t\t\t\t\tdom.setStyle(elm, name, replaceVars(value, vars));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Needed for the WebKit span spam bug\r\n\t\t\t\t\t// TODO: Remove this once WebKit/Blink fixes this\r\n\t\t\t\t\tif (fmt.styles) {\r\n\t\t\t\t\t\tvar styleVal = dom.getAttrib(elm, 'style');\r\n\r\n\t\t\t\t\t\tif (styleVal) {\r\n\t\t\t\t\t\t\telm.setAttribute('data-mce-style', styleVal);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teach(fmt.attributes, function(value, name) {\r\n\t\t\t\t\t\tdom.setAttrib(elm, name, replaceVars(value, vars));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teach(fmt.classes, function(value) {\r\n\t\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t\tif (!dom.hasClass(elm, value)) {\r\n\t\t\t\t\t\t\tdom.addClass(elm, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// This converts: <p>[a</p><p>]b</p> -> <p>[a]</p><p>b</p>\r\n\t\t\tfunction adjustSelectionToVisibleSelection() {\r\n\t\t\t\tfunction findSelectionEnd(start, end) {\r\n\t\t\t\t\tvar walker = new TreeWalker(end);\r\n\t\t\t\t\tfor (node = walker.prev2(); node; node = walker.prev2()) {\r\n\t\t\t\t\t\tif (node.nodeType == 3 && node.data.length > 0) {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (node.childNodes.length > 1 || node == start || node.tagName == 'BR') {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Adjust selection so that a end container with a end offset of zero is not included in the selection\r\n\t\t\t\t// as this isn't visible to the user.\r\n\t\t\t\tvar rng = ed.selection.getRng();\r\n\t\t\t\tvar start = rng.startContainer;\r\n\t\t\t\tvar end = rng.endContainer;\r\n\r\n\t\t\t\tif (start != end && rng.endOffset === 0) {\r\n\t\t\t\t\tvar newEnd = findSelectionEnd(start, end);\r\n\t\t\t\t\tvar endOffset = newEnd.nodeType == 3 ? newEnd.data.length : newEnd.childNodes.length;\r\n\r\n\t\t\t\t\trng.setEnd(newEnd, endOffset);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\r\n\t\t\tfunction applyRngStyle(rng, bookmark, node_specific) {\r\n\t\t\t\tvar newWrappers = [], wrapName, wrapElm, contentEditable = true;\r\n\r\n\t\t\t\t// Setup wrapper element\r\n\t\t\t\twrapName = format.inline || format.block;\r\n\t\t\t\twrapElm = dom.create(wrapName);\r\n\t\t\t\tsetElementFormat(wrapElm);\r\n\r\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\r\n\t\t\t\t\tvar currentWrapElm;\r\n\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * Process a list of nodes wrap them.\r\n\t\t\t\t\t */\r\n\t\t\t\t\tfunction process(node) {\r\n\t\t\t\t\t\tvar nodeName, parentName, found, hasContentEditableState, lastContentEditable;\r\n\r\n\t\t\t\t\t\tlastContentEditable = contentEditable;\r\n\t\t\t\t\t\tnodeName = node.nodeName.toLowerCase();\r\n\t\t\t\t\t\tparentName = node.parentNode.nodeName.toLowerCase();\r\n\r\n\t\t\t\t\t\t// Node has a contentEditable value\r\n\t\t\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\r\n\t\t\t\t\t\t\tlastContentEditable = contentEditable;\r\n\t\t\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\r\n\t\t\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Stop wrapping on br elements\r\n\t\t\t\t\t\tif (isEq(nodeName, 'br')) {\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\r\n\t\t\t\t\t\t\t// Remove any br elements when we wrap things\r\n\t\t\t\t\t\t\tif (format.block) {\r\n\t\t\t\t\t\t\t\tdom.remove(node);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// If node is wrapper type\r\n\t\t\t\t\t\tif (format.wrapper && matchNode(node, name, vars)) {\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Can we rename the block\r\n\t\t\t\t\t\t// TODO: Break this if up, too complex\r\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && format.block &&\r\n\t\t\t\t\t\t\t!format.wrapper && isTextBlock(nodeName) && isValid(parentName, wrapName)) {\r\n\t\t\t\t\t\t\tnode = dom.rename(node, wrapName);\r\n\t\t\t\t\t\t\tsetElementFormat(node);\r\n\t\t\t\t\t\t\tnewWrappers.push(node);\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Handle selector patterns\r\n\t\t\t\t\t\tif (format.selector) {\r\n\t\t\t\t\t\t\t// Look for matching formats\r\n\t\t\t\t\t\t\teach(formatList, function(format) {\r\n\t\t\t\t\t\t\t\t// Check collapsed state if it exists\r\n\t\t\t\t\t\t\t\tif ('collapsed' in format && format.collapsed !== isCollapsed) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (dom.is(node, format.selector) && !isCaretNode(node)) {\r\n\t\t\t\t\t\t\t\t\tsetElementFormat(node, format);\r\n\t\t\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Continue processing if a selector match wasn't found and a inline element is defined\r\n\t\t\t\t\t\t\tif (!format.inline || found) {\r\n\t\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Is it valid to wrap this item\r\n\t\t\t\t\t\t// TODO: Break this if up, too complex\r\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && isValid(wrapName, nodeName) && isValid(parentName, wrapName) &&\r\n\t\t\t\t\t\t\t\t!(!node_specific && node.nodeType === 3 &&\r\n\t\t\t\t\t\t\t\tnode.nodeValue.length === 1 &&\r\n\t\t\t\t\t\t\t\tnode.nodeValue.charCodeAt(0) === 65279) &&\r\n\t\t\t\t\t\t\t\t!isCaretNode(node) &&\r\n\t\t\t\t\t\t\t\t(!format.inline || !isBlock(node))) {\r\n\t\t\t\t\t\t\t// Start wrapping\r\n\t\t\t\t\t\t\tif (!currentWrapElm) {\r\n\t\t\t\t\t\t\t\t// Wrap the node\r\n\t\t\t\t\t\t\t\tcurrentWrapElm = dom.clone(wrapElm, FALSE);\r\n\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(currentWrapElm, node);\r\n\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Start a new wrapper for possible children\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\r\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\r\n\r\n\t\t\t\t\t\t\tif (hasContentEditableState) {\r\n\t\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// End the last wrapper\r\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Process siblings from range\r\n\t\t\t\t\teach(nodes, process);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Apply formats to links as well to get the color of the underline to change as well\r\n\t\t\t\tif (format.links === true) {\r\n\t\t\t\t\teach(newWrappers, function(node) {\r\n\t\t\t\t\t\tfunction process(node) {\r\n\t\t\t\t\t\t\tif (node.nodeName === 'A') {\r\n\t\t\t\t\t\t\t\tsetElementFormat(node, format);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tprocess(node);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cleanup\r\n\t\t\t\teach(newWrappers, function(node) {\r\n\t\t\t\t\tvar childCount;\r\n\r\n\t\t\t\t\tfunction getChildCount(node) {\r\n\t\t\t\t\t\tvar count = 0;\r\n\r\n\t\t\t\t\t\teach(node.childNodes, function(node) {\r\n\t\t\t\t\t\t\tif (!isWhiteSpaceNode(node) && !isBookmarkNode(node)) {\r\n\t\t\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\treturn count;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction mergeStyles(node) {\r\n\t\t\t\t\t\tvar child, clone;\r\n\r\n\t\t\t\t\t\teach(node.childNodes, function(node) {\r\n\t\t\t\t\t\t\tif (node.nodeType == 1 && !isBookmarkNode(node) && !isCaretNode(node)) {\r\n\t\t\t\t\t\t\t\tchild = node;\r\n\t\t\t\t\t\t\t\treturn FALSE; // break loop\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// If child was found and of the same type as the current node\r\n\t\t\t\t\t\tif (child && !isBookmarkNode(child) && matchName(child, format)) {\r\n\t\t\t\t\t\t\tclone = dom.clone(child, FALSE);\r\n\t\t\t\t\t\t\tsetElementFormat(clone);\r\n\r\n\t\t\t\t\t\t\tdom.replace(clone, node, TRUE);\r\n\t\t\t\t\t\t\tdom.remove(child, 1);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn clone || node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tchildCount = getChildCount(node);\r\n\r\n\t\t\t\t\t// Remove empty nodes but only if there is multiple wrappers and they are not block\r\n\t\t\t\t\t// elements so never remove single <h1></h1> since that would remove the\r\n\t\t\t\t\t// current empty block element where the caret is at\r\n\t\t\t\t\tif ((newWrappers.length > 1 || !isBlock(node)) && childCount === 0) {\r\n\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (format.inline || format.wrapper) {\r\n\t\t\t\t\t\t// Merges the current node with it's children of similar type to reduce the number of elements\r\n\t\t\t\t\t\tif (!format.exact && childCount === 1) {\r\n\t\t\t\t\t\t\tnode = mergeStyles(node);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remove/merge children\r\n\t\t\t\t\t\teach(formatList, function(format) {\r\n\t\t\t\t\t\t\t// Merge all children of similar type will move styles from child to parent\r\n\t\t\t\t\t\t\t// this: <span style=\"color:red\"><b><span style=\"color:red; font-size:10px\">text</span></b></span>\r\n\t\t\t\t\t\t\t// will become: <span style=\"color:red\"><b><span style=\"font-size:10px\">text</span></b></span>\r\n\t\t\t\t\t\t\teach(dom.select(format.inline, node), function(child) {\r\n\t\t\t\t\t\t\t\tif (isBookmarkNode(child)) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tremoveFormat(format, vars, child, format.exact ? child : null);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Remove child if direct parent is of same type\r\n\t\t\t\t\t\tif (matchNode(node.parentNode, name, vars)) {\r\n\t\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\t\tnode = 0;\r\n\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Look for parent with similar style format\r\n\t\t\t\t\t\tif (format.merge_with_parents) {\r\n\t\t\t\t\t\t\tdom.getParent(node.parentNode, function(parent) {\r\n\t\t\t\t\t\t\t\tif (matchNode(parent, name, vars)) {\r\n\t\t\t\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t\t\t\t\tnode = 0;\r\n\t\t\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Merge next and previous siblings if they are similar <b>text</b><b>text</b> becomes <b>texttext</b>\r\n\t\t\t\t\t\tif (node && format.merge_siblings !== false) {\r\n\t\t\t\t\t\t\tnode = mergeSiblings(getNonWhiteSpaceSibling(node), node);\r\n\t\t\t\t\t\t\tnode = mergeSiblings(node, getNonWhiteSpaceSibling(node, TRUE));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\r\n\t\t\t\tnode = selection.getNode();\r\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\r\n\t\t\t\t\tif (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\r\n\t\t\t\t\t\tsetElementFormat(node, formatList[i]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (format) {\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tif (node.nodeType) {\r\n\t\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\trng.setEndAfter(node);\r\n\t\t\t\t\t\tapplyRngStyle(expandRng(rng, formatList), null, true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapplyRngStyle(node, null, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!isCollapsed || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\r\n\t\t\t\t\t\t// Obtain selection node before selection is unselected by applyRngStyle()\r\n\t\t\t\t\t\tvar curSelNode = ed.selection.getNode();\r\n\r\n\t\t\t\t\t\t// If the formats have a default block and we can't find a parent block then\r\n\t\t\t\t\t\t// start wrapping it with a DIV this is for forced_root_blocks: false\r\n\t\t\t\t\t\t// It's kind of a hack but people should be using the default block type P since all desktop editors work that way\r\n\t\t\t\t\t\tif (!forcedRootBlock && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\r\n\t\t\t\t\t\t\tapply(formatList[0].defaultBlock);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Apply formatting to selection\r\n\t\t\t\t\t\ted.selection.setRng(adjustSelectionToVisibleSelection());\r\n\t\t\t\t\t\tbookmark = selection.getBookmark();\r\n\t\t\t\t\t\tapplyRngStyle(expandRng(selection.getRng(TRUE), formatList), bookmark);\r\n\r\n\t\t\t\t\t\t// Colored nodes should be underlined so that the color of the underline matches the text color.\r\n\t\t\t\t\t\tif (format.styles && (format.styles.color || format.styles.textDecoration)) {\r\n\t\t\t\t\t\t\twalk(curSelNode, processUnderlineAndColor, 'childNodes');\r\n\t\t\t\t\t\t\tprocessUnderlineAndColor(curSelNode);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t\t\tmoveStart(selection.getRng(TRUE));\r\n\t\t\t\t\t\ted.nodeChanged();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tperformCaretAction('apply', name, vars);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tHooks.postProcess(name, ed);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Removes the specified format from the current selection or specified node.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @param {String} name Name of format to remove.\r\n\t\t * @param {Object} vars Optional list of variables to replace within format before removing it.\r\n\t\t * @param {Node/Range} node Optional node or DOM range to remove the format from defaults to current selection.\r\n\t\t */\r\n\t\tfunction remove(name, vars, node, similar) {\r\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, contentEditable = true;\r\n\r\n\t\t\t// Merges the styles for each node\r\n\t\t\tfunction process(node) {\r\n\t\t\t\tvar children, i, l, lastContentEditable, hasContentEditableState;\r\n\r\n\t\t\t\t// Node has a contentEditable value\r\n\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\r\n\t\t\t\t\tlastContentEditable = contentEditable;\r\n\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\r\n\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Grab the children first since the nodelist might be changed\r\n\t\t\t\tchildren = grep(node.childNodes);\r\n\r\n\t\t\t\t// Process current node\r\n\t\t\t\tif (contentEditable && !hasContentEditableState) {\r\n\t\t\t\t\tfor (i = 0, l = formatList.length; i < l; i++) {\r\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Process the children\r\n\t\t\t\tif (format.deep) {\r\n\t\t\t\t\tif (children.length) {\r\n\t\t\t\t\t\tfor (i = 0, l = children.length; i < l; i++) {\r\n\t\t\t\t\t\t\tprocess(children[i]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (hasContentEditableState) {\r\n\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction findFormatRoot(container) {\r\n\t\t\t\tvar formatRoot;\r\n\r\n\t\t\t\t// Find format root\r\n\t\t\t\teach(getParents(container.parentNode).reverse(), function(parent) {\r\n\t\t\t\t\tvar format;\r\n\r\n\t\t\t\t\t// Find format root element\r\n\t\t\t\t\tif (!formatRoot && parent.id != '_start' && parent.id != '_end') {\r\n\t\t\t\t\t\t// Is the node matching the format we are looking for\r\n\t\t\t\t\t\tformat = matchNode(parent, name, vars, similar);\r\n\t\t\t\t\t\tif (format && format.split !== false) {\r\n\t\t\t\t\t\t\tformatRoot = parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn formatRoot;\r\n\t\t\t}\r\n\r\n\t\t\tfunction wrapAndSplit(formatRoot, container, target, split) {\r\n\t\t\t\tvar parent, clone, lastClone, firstClone, i, formatRootParent;\r\n\r\n\t\t\t\t// Format root found then clone formats and split it\r\n\t\t\t\tif (formatRoot) {\r\n\t\t\t\t\tformatRootParent = formatRoot.parentNode;\r\n\r\n\t\t\t\t\tfor (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {\r\n\t\t\t\t\t\tclone = dom.clone(parent, FALSE);\r\n\r\n\t\t\t\t\t\tfor (i = 0; i < formatList.length; i++) {\r\n\t\t\t\t\t\t\tif (removeFormat(formatList[i], vars, clone, clone)) {\r\n\t\t\t\t\t\t\t\tclone = 0;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Build wrapper node\r\n\t\t\t\t\t\tif (clone) {\r\n\t\t\t\t\t\t\tif (lastClone) {\r\n\t\t\t\t\t\t\t\tclone.appendChild(lastClone);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!firstClone) {\r\n\t\t\t\t\t\t\t\tfirstClone = clone;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlastClone = clone;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Never split block elements if the format is mixed\r\n\t\t\t\t\tif (split && (!format.mixed || !isBlock(formatRoot))) {\r\n\t\t\t\t\t\tcontainer = dom.split(formatRoot, container);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Wrap container in cloned formats\r\n\t\t\t\t\tif (lastClone) {\r\n\t\t\t\t\t\ttarget.parentNode.insertBefore(lastClone, target);\r\n\t\t\t\t\t\tfirstClone.appendChild(target);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\r\n\t\t\tfunction splitToFormatRoot(container) {\r\n\t\t\t\treturn wrapAndSplit(findFormatRoot(container), container, container, true);\r\n\t\t\t}\r\n\r\n\t\t\tfunction unwrap(start) {\r\n\t\t\t\tvar node = dom.get(start ? '_start' : '_end'),\r\n\t\t\t\t\tout = node[start ? 'firstChild' : 'lastChild'];\r\n\r\n\t\t\t\t// If the end is placed within the start the result will be removed\r\n\t\t\t\t// So this checks if the out node is a bookmark node if it is it\r\n\t\t\t\t// checks for another more suitable node\r\n\t\t\t\tif (isBookmarkNode(out)) {\r\n\t\t\t\t\tout = out[start ? 'firstChild' : 'lastChild'];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Since dom.remove removes empty text nodes then we need to try to find a better node\r\n\t\t\t\tif (out.nodeType == 3 && out.data.length === 0) {\r\n\t\t\t\t\tout = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdom.remove(node, true);\r\n\r\n\t\t\t\treturn out;\r\n\t\t\t}\r\n\r\n\t\t\tfunction removeRngStyle(rng) {\r\n\t\t\t\tvar startContainer, endContainer;\r\n\t\t\t\tvar commonAncestorContainer = rng.commonAncestorContainer;\r\n\r\n\t\t\t\trng = expandRng(rng, formatList, TRUE);\r\n\r\n\t\t\t\tif (format.split) {\r\n\t\t\t\t\tstartContainer = getContainer(rng, TRUE);\r\n\t\t\t\t\tendContainer = getContainer(rng);\r\n\r\n\t\t\t\t\tif (startContainer != endContainer) {\r\n\t\t\t\t\t\t// WebKit will render the table incorrectly if we wrap a TH or TD in a SPAN\r\n\t\t\t\t\t\t// so let's see if we can use the first child instead\r\n\t\t\t\t\t\t// This will happen if you triple click a table cell and use remove formatting\r\n\t\t\t\t\t\tif (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\r\n\t\t\t\t\t\t\tif (startContainer.nodeName == \"TR\") {\r\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild.firstChild || startContainer;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild || startContainer;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Try to adjust endContainer as well if cells on the same row were selected - bug #6410\r\n\t\t\t\t\t\tif (commonAncestorContainer &&\r\n\t\t\t\t\t\t\t/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) &&\r\n\t\t\t\t\t\t\tisTableCell(endContainer) && endContainer.firstChild) {\r\n\t\t\t\t\t\t\tendContainer = endContainer.firstChild || endContainer;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (dom.isChildOf(startContainer, endContainer) && !isBlock(endContainer) &&\r\n\t\t\t\t\t\t\t!isTableCell(startContainer) && !isTableCell(endContainer)) {\r\n\t\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\r\n\t\t\t\t\t\t\tsplitToFormatRoot(startContainer);\r\n\t\t\t\t\t\t\tstartContainer = unwrap(TRUE);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Wrap start/end nodes in span element since these might be cloned/moved\r\n\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\r\n\t\t\t\t\t\tendContainer = wrap(endContainer, 'span', {id: '_end', 'data-mce-type': 'bookmark'});\r\n\r\n\t\t\t\t\t\t// Split start/end\r\n\t\t\t\t\t\tsplitToFormatRoot(startContainer);\r\n\t\t\t\t\t\tsplitToFormatRoot(endContainer);\r\n\r\n\t\t\t\t\t\t// Unwrap start/end to get real elements again\r\n\t\t\t\t\t\tstartContainer = unwrap(TRUE);\r\n\t\t\t\t\t\tendContainer = unwrap();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstartContainer = endContainer = splitToFormatRoot(startContainer);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Update range positions since they might have changed after the split operations\r\n\t\t\t\t\trng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\r\n\t\t\t\t\trng.startOffset = nodeIndex(startContainer);\r\n\t\t\t\t\trng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\r\n\t\t\t\t\trng.endOffset = nodeIndex(endContainer) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove items between start/end\r\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\r\n\t\t\t\t\teach(nodes, function(node) {\r\n\t\t\t\t\t\tprocess(node);\r\n\r\n\t\t\t\t\t\t// Remove parent span if it only contains text-decoration: underline, yet a parent node is also underlined.\r\n\t\t\t\t\t\tif (node.nodeType === 1 && ed.dom.getStyle(node, 'text-decoration') === 'underline' &&\r\n\t\t\t\t\t\t\tnode.parentNode && getTextDecoration(node.parentNode) === 'underline') {\r\n\t\t\t\t\t\t\tremoveFormat({\r\n\t\t\t\t\t\t\t\t'deep': false,\r\n\t\t\t\t\t\t\t\t'exact': true,\r\n\t\t\t\t\t\t\t\t'inline': 'span',\r\n\t\t\t\t\t\t\t\t'styles': {\r\n\t\t\t\t\t\t\t\t\t'textDecoration': 'underline'\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, null, node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Handle node\r\n\t\t\tif (node) {\r\n\t\t\t\tif (node.nodeType) {\r\n\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\trng.setEndAfter(node);\r\n\t\t\t\t\tremoveRngStyle(rng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tremoveRngStyle(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\r\n\t\t\t\tnode = selection.getNode();\r\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\r\n\t\t\t\t\tif (formatList[i].ceFalseOverride) {\r\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\r\n\t\t\t\tbookmark = selection.getBookmark();\r\n\t\t\t\tremoveRngStyle(selection.getRng(TRUE));\r\n\t\t\t\tselection.moveToBookmark(bookmark);\r\n\r\n\t\t\t\t// Check if start element still has formatting then we are at: \"<b>text|</b>text\"\r\n\t\t\t\t// and need to move the start into the next text node\r\n\t\t\t\tif (format.inline && match(name, vars, selection.getStart())) {\r\n\t\t\t\t\tmoveStart(selection.getRng(true));\r\n\t\t\t\t}\r\n\r\n\t\t\t\ted.nodeChanged();\r\n\t\t\t} else {\r\n\t\t\t\tperformCaretAction('remove', name, vars, similar);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Toggles the specified format on/off.\r\n\t\t *\r\n\t\t * @method toggle\r\n\t\t * @param {String} name Name of format to apply/remove.\r\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying/removing it.\r\n\t\t * @param {Node} node Optional node to apply the format to or remove from. Defaults to current selection.\r\n\t\t */\r\n\t\tfunction toggle(name, vars, node) {\r\n\t\t\tvar fmt = get(name);\r\n\r\n\t\t\tif (match(name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\r\n\t\t\t\tremove(name, vars, node);\r\n\t\t\t} else {\r\n\t\t\t\tapply(name, vars, node);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return true/false if the specified node has the specified format.\r\n\t\t *\r\n\t\t * @method matchNode\r\n\t\t * @param {Node} node Node to check the format on.\r\n\t\t * @param {String} name Format name to check.\r\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\r\n\t\t * @param {Boolean} similar Match format that has similar properties.\r\n\t\t * @return {Object} Returns the format object it matches or undefined if it doesn't match.\r\n\t\t */\r\n\t\tfunction matchNode(node, name, vars, similar) {\r\n\t\t\tvar formatList = get(name), format, i, classes;\r\n\r\n\t\t\tfunction matchItems(node, format, item_name) {\r\n\t\t\t\tvar key, value, items = format[item_name], i;\r\n\r\n\t\t\t\t// Custom match\r\n\t\t\t\tif (format.onmatch) {\r\n\t\t\t\t\treturn format.onmatch(node, format, item_name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check all items\r\n\t\t\t\tif (items) {\r\n\t\t\t\t\t// Non indexed object\r\n\t\t\t\t\tif (items.length === undef) {\r\n\t\t\t\t\t\tfor (key in items) {\r\n\t\t\t\t\t\t\tif (items.hasOwnProperty(key)) {\r\n\t\t\t\t\t\t\t\tif (item_name === 'attributes') {\r\n\t\t\t\t\t\t\t\t\tvalue = dom.getAttrib(node, key);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tvalue = getStyle(node, key);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (similar && !value && !format.exact) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif ((!similar || format.exact) && !isEq(value, normalizeStyleValue(replaceVars(items[key], vars), key))) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Only one match needed for indexed arrays\r\n\t\t\t\t\t\tfor (i = 0; i < items.length; i++) {\r\n\t\t\t\t\t\t\tif (item_name === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(node, items[i])) {\r\n\t\t\t\t\t\t\t\treturn format;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn format;\r\n\t\t\t}\r\n\r\n\t\t\tif (formatList && node) {\r\n\t\t\t\t// Check each format in list\r\n\t\t\t\tfor (i = 0; i < formatList.length; i++) {\r\n\t\t\t\t\tformat = formatList[i];\r\n\r\n\t\t\t\t\t// Name name, attributes, styles and classes\r\n\t\t\t\t\tif (matchName(node, format) && matchItems(node, format, 'attributes') && matchItems(node, format, 'styles')) {\r\n\t\t\t\t\t\t// Match classes\r\n\t\t\t\t\t\tif ((classes = format.classes)) {\r\n\t\t\t\t\t\t\tfor (i = 0; i < classes.length; i++) {\r\n\t\t\t\t\t\t\t\tif (!dom.hasClass(node, classes[i])) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn format;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Matches the current selection or specified node against the specified format name.\r\n\t\t *\r\n\t\t * @method match\r\n\t\t * @param {String} name Name of format to match.\r\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\r\n\t\t * @param {Node} node Optional node to check.\r\n\t\t * @return {boolean} true/false if the specified selection/node matches the format.\r\n\t\t */\r\n\t\tfunction match(name, vars, node) {\r\n\t\t\tvar startNode;\r\n\r\n\t\t\tfunction matchParents(node) {\r\n\t\t\t\tvar root = dom.getRoot();\r\n\r\n\t\t\t\tif (node === root) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find first node with similar format settings\r\n\t\t\t\tnode = dom.getParent(node, function(node) {\r\n\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, name)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node.parentNode === root || !!matchNode(node, name, vars, true);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Do an exact check on the similar format element\r\n\t\t\t\treturn matchNode(node, name, vars);\r\n\t\t\t}\r\n\r\n\t\t\t// Check specified node\r\n\t\t\tif (node) {\r\n\t\t\t\treturn matchParents(node);\r\n\t\t\t}\r\n\r\n\t\t\t// Check selected node\r\n\t\t\tnode = selection.getNode();\r\n\t\t\tif (matchParents(node)) {\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\t// Check start node if it's different\r\n\t\t\tstartNode = selection.getStart();\r\n\t\t\tif (startNode != node) {\r\n\t\t\t\tif (matchParents(startNode)) {\r\n\t\t\t\t\treturn TRUE;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Matches the current selection against the array of formats and returns a new array with matching formats.\r\n\t\t *\r\n\t\t * @method matchAll\r\n\t\t * @param {Array} names Name of format to match.\r\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\r\n\t\t * @return {Array} Array with matched formats.\r\n\t\t */\r\n\t\tfunction matchAll(names, vars) {\r\n\t\t\tvar startElement, matchedFormatNames = [], checkedMap = {};\r\n\r\n\t\t\t// Check start of selection for formats\r\n\t\t\tstartElement = selection.getStart();\r\n\t\t\tdom.getParent(startElement, function(node) {\r\n\t\t\t\tvar i, name;\r\n\r\n\t\t\t\tfor (i = 0; i < names.length; i++) {\r\n\t\t\t\t\tname = names[i];\r\n\r\n\t\t\t\t\tif (!checkedMap[name] && matchNode(node, name, vars)) {\r\n\t\t\t\t\t\tcheckedMap[name] = true;\r\n\t\t\t\t\t\tmatchedFormatNames.push(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, dom.getRoot());\r\n\r\n\t\t\treturn matchedFormatNames;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified format can be applied to the current selection or not. It\r\n\t\t * will currently only check the state for selector formats, it returns true on all other format types.\r\n\t\t *\r\n\t\t * @method canApply\r\n\t\t * @param {String} name Name of format to check.\r\n\t\t * @return {boolean} true/false if the specified format can be applied to the current selection/node.\r\n\t\t */\r\n\t\tfunction canApply(name) {\r\n\t\t\tvar formatList = get(name), startNode, parents, i, x, selector;\r\n\r\n\t\t\tif (formatList) {\r\n\t\t\t\tstartNode = selection.getStart();\r\n\t\t\t\tparents = getParents(startNode);\r\n\r\n\t\t\t\tfor (x = formatList.length - 1; x >= 0; x--) {\r\n\t\t\t\t\tselector = formatList[x].selector;\r\n\r\n\t\t\t\t\t// Format is not selector based then always return TRUE\r\n\t\t\t\t\t// Is it has a defaultBlock then it's likely it can be applied for example align on a non block element line\r\n\t\t\t\t\tif (!selector || formatList[x].defaultBlock) {\r\n\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tif (dom.is(parents[i], selector)) {\r\n\t\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn FALSE;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Executes the specified callback when the current selection matches the formats or not.\r\n\t\t *\r\n\t\t * @method formatChanged\r\n\t\t * @param {String} formats Comma separated list of formats to check for.\r\n\t\t * @param {function} callback Callback with state and args when the format is changed/toggled on/off.\r\n\t\t * @param {Boolean} similar True/false state if the match should handle similar or exact formats.\r\n\t\t */\r\n\t\tfunction formatChanged(formats, callback, similar) {\r\n\t\t\tvar currentFormats;\r\n\r\n\t\t\t// Setup format node change logic\r\n\t\t\tif (!formatChangeData) {\r\n\t\t\t\tformatChangeData = {};\r\n\t\t\t\tcurrentFormats = {};\r\n\r\n\t\t\t\ted.on('NodeChange', function(e) {\r\n\t\t\t\t\tvar parents = getParents(e.element), matchedFormats = {};\r\n\r\n\t\t\t\t\t// Ignore bogus nodes like the <a> tag created by moveStart()\r\n\t\t\t\t\tparents = Tools.grep(parents, function(node) {\r\n\t\t\t\t\t\treturn node.nodeType == 1 && !node.getAttribute('data-mce-bogus');\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Check for new formats\r\n\t\t\t\t\teach(formatChangeData, function(callbacks, format) {\r\n\t\t\t\t\t\teach(parents, function(node) {\r\n\t\t\t\t\t\t\tif (matchNode(node, format, {}, callbacks.similar)) {\r\n\t\t\t\t\t\t\t\tif (!currentFormats[format]) {\r\n\t\t\t\t\t\t\t\t\t// Execute callbacks\r\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\r\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, format: format, parents: parents});\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tcurrentFormats[format] = callbacks;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tmatchedFormats[format] = callbacks;\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, format)) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Check if current formats still match\r\n\t\t\t\t\teach(currentFormats, function(callbacks, format) {\r\n\t\t\t\t\t\tif (!matchedFormats[format]) {\r\n\t\t\t\t\t\t\tdelete currentFormats[format];\r\n\r\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\r\n\t\t\t\t\t\t\t\tcallback(false, {node: e.element, format: format, parents: parents});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add format listeners\r\n\t\t\teach(formats.split(','), function(format) {\r\n\t\t\t\tif (!formatChangeData[format]) {\r\n\t\t\t\t\tformatChangeData[format] = [];\r\n\t\t\t\t\tformatChangeData[format].similar = similar;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tformatChangeData[format].push(callback);\r\n\t\t\t});\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns a preview css text for the specified format.\r\n\t\t *\r\n\t\t * @method getCssText\r\n\t\t * @param {String/Object} format Format to generate preview css text for.\r\n\t\t * @return {String} Css text for the specified format.\r\n\t\t * @example\r\n\t\t * var cssText1 = editor.formatter.getCssText('bold');\r\n\t\t * var cssText2 = editor.formatter.getCssText({inline: 'b'});\r\n\t\t */\r\n\t\tfunction getCssText(format) {\r\n\t\t\treturn Preview.getCssText(ed, format);\r\n\t\t}\r\n\r\n\t\t// Expose to public\r\n\t\textend(this, {\r\n\t\t\tget: get,\r\n\t\t\tregister: register,\r\n\t\t\tunregister: unregister,\r\n\t\t\tapply: apply,\r\n\t\t\tremove: remove,\r\n\t\t\ttoggle: toggle,\r\n\t\t\tmatch: match,\r\n\t\t\tmatchAll: matchAll,\r\n\t\t\tmatchNode: matchNode,\r\n\t\t\tcanApply: canApply,\r\n\t\t\tformatChanged: formatChanged,\r\n\t\t\tgetCssText: getCssText\r\n\t\t});\r\n\r\n\t\t// Initialize\r\n\t\tdefaultFormats();\r\n\t\taddKeyboardShortcuts();\r\n\t\ted.on('BeforeGetContent', function(e) {\r\n\t\t\tif (markCaretContainersBogus && e.format != 'raw') {\r\n\t\t\t\tmarkCaretContainersBogus();\r\n\t\t\t}\r\n\t\t});\r\n\t\ted.on('mouseup keydown', function(e) {\r\n\t\t\tif (disableCaretContainer) {\r\n\t\t\t\tdisableCaretContainer(e);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Private functions\r\n\r\n\t\t/**\r\n\t\t * Checks if the specified nodes name matches the format inline/block or selector.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Node} node Node to match against the specified format.\r\n\t\t * @param {Object} format Format object o match with.\r\n\t\t * @return {boolean} true/false if the format matches.\r\n\t\t */\r\n\t\tfunction matchName(node, format) {\r\n\t\t\t// Check for inline match\r\n\t\t\tif (isEq(node, format.inline)) {\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\t// Check for block match\r\n\t\t\tif (isEq(node, format.block)) {\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\r\n\t\t\t// Check for selector match\r\n\t\t\tif (format.selector) {\r\n\t\t\t\treturn node.nodeType == 1 && dom.is(node, format.selector);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Compares two string/nodes regardless of their case.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {String/Node} str1 Node or string to compare.\r\n\t\t * @param {String/Node} str2 Node or string to compare.\r\n\t\t * @return {boolean} True/false if they match.\r\n\t\t */\r\n\t\tfunction isEq(str1, str2) {\r\n\t\t\tstr1 = str1 || '';\r\n\t\t\tstr2 = str2 || '';\r\n\r\n\t\t\tstr1 = '' + (str1.nodeName || str1);\r\n\t\t\tstr2 = '' + (str2.nodeName || str2);\r\n\r\n\t\t\treturn str1.toLowerCase() == str2.toLowerCase();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the style by name on the specified node. This method modifies the style\r\n\t\t * contents to make it more easy to match. This will resolve a few browser issues.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Node} node to get style from.\r\n\t\t * @param {String} name Style name to get.\r\n\t\t * @return {String} Style item value.\r\n\t\t */\r\n\t\tfunction getStyle(node, name) {\r\n\t\t\treturn normalizeStyleValue(dom.getStyle(node, name), name);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Normalize style value by name. This method modifies the style contents\r\n\t\t * to make it more easy to match. This will resolve a few browser issues.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {String} value Value to get style from.\r\n\t\t * @param {String} name Style name to get.\r\n\t\t * @return {String} Style item value.\r\n\t\t */\r\n\t\tfunction normalizeStyleValue(value, name) {\r\n\t\t\t// Force the format to hex\r\n\t\t\tif (name == 'color' || name == 'backgroundColor') {\r\n\t\t\t\tvalue = dom.toHex(value);\r\n\t\t\t}\r\n\r\n\t\t\t// Opera will return bold as 700\r\n\t\t\tif (name == 'fontWeight' && value == 700) {\r\n\t\t\t\tvalue = 'bold';\r\n\t\t\t}\r\n\r\n\t\t\t// Normalize fontFamily so \"'Font name', Font\" becomes: \"Font name,Font\"\r\n\t\t\tif (name == 'fontFamily') {\r\n\t\t\t\tvalue = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\r\n\t\t\t}\r\n\r\n\t\t\treturn '' + value;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Replaces variables in the value. The variable format is %var.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {String} value Value to replace variables in.\r\n\t\t * @param {Object} vars Name/value array with variables to replace.\r\n\t\t * @return {String} New value with replaced variables.\r\n\t\t */\r\n\t\tfunction replaceVars(value, vars) {\r\n\t\t\tif (typeof value != \"string\") {\r\n\t\t\t\tvalue = value(vars);\r\n\t\t\t} else if (vars) {\r\n\t\t\t\tvalue = value.replace(/%(\\w+)/g, function(str, name) {\r\n\t\t\t\t\treturn vars[name] || str;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tfunction isWhiteSpaceNode(node) {\r\n\t\t\treturn node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\r\n\t\t}\r\n\r\n\t\tfunction wrap(node, name, attrs) {\r\n\t\t\tvar wrapper = dom.create(name, attrs);\r\n\r\n\t\t\tnode.parentNode.insertBefore(wrapper, node);\r\n\t\t\twrapper.appendChild(node);\r\n\r\n\t\t\treturn wrapper;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Expands the specified range like object to depending on format.\r\n\t\t *\r\n\t\t * For example on block formats it will move the start/end position\r\n\t\t * to the beginning of the current block.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Object} rng Range like object.\r\n\t\t * @param {Array} format Array with formats to expand by.\r\n\t\t * @param {Boolean} remove\r\n\t\t * @return {Object} Expanded range like object.\r\n\t\t */\r\n\t\tfunction expandRng(rng, format, remove) {\r\n\t\t\tvar lastIdx, leaf, endPoint,\r\n\t\t\t\tstartContainer = rng.startContainer,\r\n\t\t\t\tstartOffset = rng.startOffset,\r\n\t\t\t\tendContainer = rng.endContainer,\r\n\t\t\t\tendOffset = rng.endOffset;\r\n\r\n\t\t\t// This function walks up the tree if there is no siblings before/after the node\r\n\t\t\tfunction findParentContainer(start) {\r\n\t\t\t\tvar container, parent, sibling, siblingName, root;\r\n\r\n\t\t\t\tcontainer = parent = start ? startContainer : endContainer;\r\n\t\t\t\tsiblingName = start ? 'previousSibling' : 'nextSibling';\r\n\t\t\t\troot = dom.getRoot();\r\n\r\n\t\t\t\tfunction isBogusBr(node) {\r\n\t\t\t\t\treturn node.nodeName == \"BR\" && node.getAttribute('data-mce-bogus') && !node.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If it's a text node and the offset is inside the text\r\n\t\t\t\tif (container.nodeType == 3 && !isWhiteSpaceNode(container)) {\r\n\t\t\t\t\tif (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\r\n\t\t\t\t\t\treturn container;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/*eslint no-constant-condition:0 */\r\n\t\t\t\twhile (true) {\r\n\t\t\t\t\t// Stop expanding on block elements\r\n\t\t\t\t\tif (!format[0].block_expand && isBlock(parent)) {\r\n\t\t\t\t\t\treturn parent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Walk left/right\r\n\t\t\t\t\tfor (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\r\n\t\t\t\t\t\tif (!isBookmarkNode(sibling) && !isWhiteSpaceNode(sibling) && !isBogusBr(sibling)) {\r\n\t\t\t\t\t\t\treturn parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if we can move up are we at root level or body level\r\n\t\t\t\t\tif (parent == root || parent.parentNode == root) {\r\n\t\t\t\t\t\tcontainer = parent;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\r\n\t\t\t// This function walks down the tree to find the leaf at the selection.\r\n\t\t\t// The offset is also returned as if node initially a leaf, the offset may be in the middle of the text node.\r\n\t\t\tfunction findLeaf(node, offset) {\r\n\t\t\t\tif (offset === undef) {\r\n\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (node && node.hasChildNodes()) {\r\n\t\t\t\t\tnode = node.childNodes[offset];\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn {node: node, offset: offset};\r\n\t\t\t}\r\n\r\n\t\t\t// If index based start position then resolve it\r\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\r\n\t\t\t\tlastIdx = startContainer.childNodes.length - 1;\r\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset > lastIdx ? lastIdx : startOffset];\r\n\r\n\t\t\t\tif (startContainer.nodeType == 3) {\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If index based end position then resolve it\r\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\r\n\t\t\t\tlastIdx = endContainer.childNodes.length - 1;\r\n\t\t\t\tendContainer = endContainer.childNodes[endOffset > lastIdx ? lastIdx : endOffset - 1];\r\n\r\n\t\t\t\tif (endContainer.nodeType == 3) {\r\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Expands the node to the closes contentEditable false element if it exists\r\n\t\t\tfunction findParentContentEditable(node) {\r\n\t\t\t\tvar parent = node;\r\n\r\n\t\t\t\twhile (parent) {\r\n\t\t\t\t\tif (parent.nodeType === 1 && getContentEditable(parent)) {\r\n\t\t\t\t\t\treturn getContentEditable(parent) === \"false\" ? parent : node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findWordEndPoint(container, offset, start) {\r\n\t\t\t\tvar walker, node, pos, lastTextNode;\r\n\r\n\t\t\t\tfunction findSpace(node, offset) {\r\n\t\t\t\t\tvar pos, pos2, str = node.nodeValue;\r\n\r\n\t\t\t\t\tif (typeof offset == \"undefined\") {\r\n\t\t\t\t\t\toffset = start ? str.length : 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\tpos = str.lastIndexOf(' ', offset);\r\n\t\t\t\t\t\tpos2 = str.lastIndexOf('\\u00a0', offset);\r\n\t\t\t\t\t\tpos = pos > pos2 ? pos : pos2;\r\n\r\n\t\t\t\t\t\t// Include the space on remove to avoid tag soup\r\n\t\t\t\t\t\tif (pos !== -1 && !remove) {\r\n\t\t\t\t\t\t\tpos++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpos = str.indexOf(' ', offset);\r\n\t\t\t\t\t\tpos2 = str.indexOf('\\u00a0', offset);\r\n\t\t\t\t\t\tpos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn pos;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (container.nodeType === 3) {\r\n\t\t\t\t\tpos = findSpace(container, offset);\r\n\r\n\t\t\t\t\tif (pos !== -1) {\r\n\t\t\t\t\t\treturn {container: container, offset: pos};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlastTextNode = container;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Walk the nodes inside the block\r\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, isBlock) || ed.getBody());\r\n\t\t\t\twhile ((node = walker[start ? 'prev' : 'next']())) {\r\n\t\t\t\t\tif (node.nodeType === 3) {\r\n\t\t\t\t\t\tlastTextNode = node;\r\n\t\t\t\t\t\tpos = findSpace(node);\r\n\r\n\t\t\t\t\t\tif (pos !== -1) {\r\n\t\t\t\t\t\t\treturn {container: node, offset: pos};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (isBlock(node)) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (lastTextNode) {\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\toffset = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toffset = lastTextNode.length;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn {container: lastTextNode, offset: offset};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction findSelectorEndPoint(container, sibling_name) {\r\n\t\t\t\tvar parents, i, y, curFormat;\r\n\r\n\t\t\t\tif (container.nodeType == 3 && container.nodeValue.length === 0 && container[sibling_name]) {\r\n\t\t\t\t\tcontainer = container[sibling_name];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparents = getParents(container);\r\n\t\t\t\tfor (i = 0; i < parents.length; i++) {\r\n\t\t\t\t\tfor (y = 0; y < format.length; y++) {\r\n\t\t\t\t\t\tcurFormat = format[y];\r\n\r\n\t\t\t\t\t\t// If collapsed state is set then skip formats that doesn't match that\r\n\t\t\t\t\t\tif (\"collapsed\" in curFormat && curFormat.collapsed !== rng.collapsed) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (dom.is(parents[i], curFormat.selector)) {\r\n\t\t\t\t\t\t\treturn parents[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findBlockEndPoint(container, sibling_name) {\r\n\t\t\t\tvar node, root = dom.getRoot();\r\n\r\n\t\t\t\t// Expand to block of similar type\r\n\t\t\t\tif (!format[0].wrapper) {\r\n\t\t\t\t\tnode = dom.getParent(container, format[0].block, root);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Expand to first wrappable block element or any block element\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\tnode = dom.getParent(container.nodeType == 3 ? container.parentNode : container, function(node) {\r\n\t\t\t\t\t\t// Fixes #6183 where it would expand to editable parent element in inline mode\r\n\t\t\t\t\t\treturn node != root && isTextBlock(node);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Exclude inner lists from wrapping\r\n\t\t\t\tif (node && format[0].wrapper) {\r\n\t\t\t\t\tnode = getParents(node, 'ul,ol').reverse()[0] || node;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Didn't find a block element look for first/last wrappable element\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\tnode = container;\r\n\r\n\t\t\t\t\twhile (node[sibling_name] && !isBlock(node[sibling_name])) {\r\n\t\t\t\t\t\tnode = node[sibling_name];\r\n\r\n\t\t\t\t\t\t// Break on BR but include it will be removed later on\r\n\t\t\t\t\t\t// we can't remove it now since we need to check if it can be wrapped\r\n\t\t\t\t\t\tif (isEq(node, 'br')) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node || container;\r\n\t\t\t}\r\n\r\n\t\t\t// Expand to closest contentEditable element\r\n\t\t\tstartContainer = findParentContentEditable(startContainer);\r\n\t\t\tendContainer = findParentContentEditable(endContainer);\r\n\r\n\t\t\t// Exclude bookmark nodes if possible\r\n\t\t\tif (isBookmarkNode(startContainer.parentNode) || isBookmarkNode(startContainer)) {\r\n\t\t\t\tstartContainer = isBookmarkNode(startContainer) ? startContainer : startContainer.parentNode;\r\n\t\t\t\tstartContainer = startContainer.nextSibling || startContainer;\r\n\r\n\t\t\t\tif (startContainer.nodeType == 3) {\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (isBookmarkNode(endContainer.parentNode) || isBookmarkNode(endContainer)) {\r\n\t\t\t\tendContainer = isBookmarkNode(endContainer) ? endContainer : endContainer.parentNode;\r\n\t\t\t\tendContainer = endContainer.previousSibling || endContainer;\r\n\r\n\t\t\t\tif (endContainer.nodeType == 3) {\r\n\t\t\t\t\tendOffset = endContainer.length;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (format[0].inline) {\r\n\t\t\t\tif (rng.collapsed) {\r\n\t\t\t\t\t// Expand left to closest word boundary\r\n\t\t\t\t\tendPoint = findWordEndPoint(startContainer, startOffset, true);\r\n\t\t\t\t\tif (endPoint) {\r\n\t\t\t\t\t\tstartContainer = endPoint.container;\r\n\t\t\t\t\t\tstartOffset = endPoint.offset;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Expand right to closest word boundary\r\n\t\t\t\t\tendPoint = findWordEndPoint(endContainer, endOffset);\r\n\t\t\t\t\tif (endPoint) {\r\n\t\t\t\t\t\tendContainer = endPoint.container;\r\n\t\t\t\t\t\tendOffset = endPoint.offset;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Avoid applying formatting to a trailing space.\r\n\t\t\t\tleaf = findLeaf(endContainer, endOffset);\r\n\t\t\t\tif (leaf.node) {\r\n\t\t\t\t\twhile (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {\r\n\t\t\t\t\t\tleaf = findLeaf(leaf.node.previousSibling);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 &&\r\n\t\t\t\t\t\t\tleaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\r\n\r\n\t\t\t\t\t\tif (leaf.offset > 1) {\r\n\t\t\t\t\t\t\tendContainer = leaf.node;\r\n\t\t\t\t\t\t\tendContainer.splitText(leaf.offset - 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Move start/end point up the tree if the leaves are sharp and if we are in different containers\r\n\t\t\t// Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!\r\n\t\t\t// This will reduce the number of wrapper elements that needs to be created\r\n\t\t\t// Move start point up the tree\r\n\t\t\tif (format[0].inline || format[0].block_expand) {\r\n\t\t\t\tif (!format[0].inline || (startContainer.nodeType != 3 || startOffset === 0)) {\r\n\t\t\t\t\tstartContainer = findParentContainer(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!format[0].inline || (endContainer.nodeType != 3 || endOffset === endContainer.nodeValue.length)) {\r\n\t\t\t\t\tendContainer = findParentContainer();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Expand start/end container to matching selector\r\n\t\t\tif (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {\r\n\t\t\t\t// Find new startContainer/endContainer if there is better one\r\n\t\t\t\tstartContainer = findSelectorEndPoint(startContainer, 'previousSibling');\r\n\t\t\t\tendContainer = findSelectorEndPoint(endContainer, 'nextSibling');\r\n\t\t\t}\r\n\r\n\t\t\t// Expand start/end container to matching block element or text node\r\n\t\t\tif (format[0].block || format[0].selector) {\r\n\t\t\t\t// Find new startContainer/endContainer if there is better one\r\n\t\t\t\tstartContainer = findBlockEndPoint(startContainer, 'previousSibling');\r\n\t\t\t\tendContainer = findBlockEndPoint(endContainer, 'nextSibling');\r\n\r\n\t\t\t\t// Non block element then try to expand up the leaf\r\n\t\t\t\tif (format[0].block) {\r\n\t\t\t\t\tif (!isBlock(startContainer)) {\r\n\t\t\t\t\t\tstartContainer = findParentContainer(true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!isBlock(endContainer)) {\r\n\t\t\t\t\t\tendContainer = findParentContainer();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setup index for startContainer\r\n\t\t\tif (startContainer.nodeType == 1) {\r\n\t\t\t\tstartOffset = nodeIndex(startContainer);\r\n\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Setup index for endContainer\r\n\t\t\tif (endContainer.nodeType == 1) {\r\n\t\t\t\tendOffset = nodeIndex(endContainer) + 1;\r\n\t\t\t\tendContainer = endContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Return new range like object\r\n\t\t\treturn {\r\n\t\t\t\tstartContainer: startContainer,\r\n\t\t\t\tstartOffset: startOffset,\r\n\t\t\t\tendContainer: endContainer,\r\n\t\t\t\tendOffset: endOffset\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction isColorFormatAndAnchor(node, format) {\r\n\t\t\treturn format.links && node.tagName == 'A';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Removes the specified format for the specified node. It will also remove the node if it doesn't have\r\n\t\t * any attributes if the format specifies it to do so.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Object} format Format object with items to remove from node.\r\n\t\t * @param {Object} vars Name/value object with variables to apply to format.\r\n\t\t * @param {Node} node Node to remove the format styles on.\r\n\t\t * @param {Node} compare_node Optional compare node, if specified the styles will be compared to that node.\r\n\t\t * @return {Boolean} True/false if the node was removed or not.\r\n\t\t */\r\n\t\tfunction removeFormat(format, vars, node, compare_node) {\r\n\t\t\tvar i, attrs, stylesModified;\r\n\r\n\t\t\t// Check if node matches format\r\n\t\t\tif (!matchName(node, format) && !isColorFormatAndAnchor(node, format)) {\r\n\t\t\t\treturn FALSE;\r\n\t\t\t}\r\n\r\n\t\t\t// Should we compare with format attribs and styles\r\n\t\t\tif (format.remove != 'all') {\r\n\t\t\t\t// Remove styles\r\n\t\t\t\teach(format.styles, function(value, name) {\r\n\t\t\t\t\tvalue = normalizeStyleValue(replaceVars(value, vars), name);\r\n\r\n\t\t\t\t\t// Indexed array\r\n\t\t\t\t\tif (typeof name === 'number') {\r\n\t\t\t\t\t\tname = value;\r\n\t\t\t\t\t\tcompare_node = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (format.remove_similar || (!compare_node || isEq(getStyle(compare_node, name), value))) {\r\n\t\t\t\t\t\tdom.setStyle(node, name, '');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstylesModified = 1;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Remove style attribute if it's empty\r\n\t\t\t\tif (stylesModified && dom.getAttrib(node, 'style') === '') {\r\n\t\t\t\t\tnode.removeAttribute('style');\r\n\t\t\t\t\tnode.removeAttribute('data-mce-style');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove attributes\r\n\t\t\t\teach(format.attributes, function(value, name) {\r\n\t\t\t\t\tvar valueOut;\r\n\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\t// Indexed array\r\n\t\t\t\t\tif (typeof name === 'number') {\r\n\t\t\t\t\t\tname = value;\r\n\t\t\t\t\t\tcompare_node = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!compare_node || isEq(dom.getAttrib(compare_node, name), value)) {\r\n\t\t\t\t\t\t// Keep internal classes\r\n\t\t\t\t\t\tif (name == 'class') {\r\n\t\t\t\t\t\t\tvalue = dom.getAttrib(node, name);\r\n\t\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\t\t// Build new class value where everything is removed except the internal prefixed classes\r\n\t\t\t\t\t\t\t\tvalueOut = '';\r\n\t\t\t\t\t\t\t\teach(value.split(/\\s+/), function(cls) {\r\n\t\t\t\t\t\t\t\t\tif (/mce\\-\\w+/.test(cls)) {\r\n\t\t\t\t\t\t\t\t\t\tvalueOut += (valueOut ? ' ' : '') + cls;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// We got some internal classes left\r\n\t\t\t\t\t\t\t\tif (valueOut) {\r\n\t\t\t\t\t\t\t\t\tdom.setAttrib(node, name, valueOut);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// IE6 has a bug where the attribute doesn't get removed correctly\r\n\t\t\t\t\t\tif (name == \"class\") {\r\n\t\t\t\t\t\t\tnode.removeAttribute('className');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remove mce prefixed attributes\r\n\t\t\t\t\t\tif (MCE_ATTR_RE.test(name)) {\r\n\t\t\t\t\t\t\tnode.removeAttribute('data-mce-' + name);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode.removeAttribute(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Remove classes\r\n\t\t\t\teach(format.classes, function(value) {\r\n\t\t\t\t\tvalue = replaceVars(value, vars);\r\n\r\n\t\t\t\t\tif (!compare_node || dom.hasClass(compare_node, value)) {\r\n\t\t\t\t\t\tdom.removeClass(node, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check for non internal attributes\r\n\t\t\t\tattrs = dom.getAttribs(node);\r\n\t\t\t\tfor (i = 0; i < attrs.length; i++) {\r\n\t\t\t\t\tif (attrs[i].nodeName.indexOf('_') !== 0) {\r\n\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the inline child if it's empty for example <b> or <span>\r\n\t\t\tif (format.remove != 'none') {\r\n\t\t\t\tremoveNode(node, format);\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Removes the node and wrap it's children in paragraphs before doing so or\r\n\t\t * appends BR elements to the beginning/end of the block element if forcedRootBlocks is disabled.\r\n\t\t *\r\n\t\t * If the div in the node below gets removed:\r\n\t\t *  text<div>text</div>text\r\n\t\t *\r\n\t\t * Output becomes:\r\n\t\t *  text<div><br />text<br /></div>text\r\n\t\t *\r\n\t\t * So when the div is removed the result is:\r\n\t\t *  text<br />text<br />text\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Node} node Node to remove + apply BR/P elements to.\r\n\t\t * @param {Object} format Format rule.\r\n\t\t * @return {Node} Input node.\r\n\t\t */\r\n\t\tfunction removeNode(node, format) {\r\n\t\t\tvar parentNode = node.parentNode, rootBlockElm;\r\n\r\n\t\t\tfunction find(node, next, inc) {\r\n\t\t\t\tnode = getNonWhiteSpaceSibling(node, next, inc);\r\n\r\n\t\t\t\treturn !node || (node.nodeName == 'BR' || isBlock(node));\r\n\t\t\t}\r\n\r\n\t\t\tif (format.block) {\r\n\t\t\t\tif (!forcedRootBlock) {\r\n\t\t\t\t\t// Append BR elements if needed before we remove the block\r\n\t\t\t\t\tif (isBlock(node) && !isBlock(parentNode)) {\r\n\t\t\t\t\t\tif (!find(node, FALSE) && !find(node.firstChild, TRUE, 1)) {\r\n\t\t\t\t\t\t\tnode.insertBefore(dom.create('br'), node.firstChild);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!find(node, TRUE) && !find(node.lastChild, FALSE, 1)) {\r\n\t\t\t\t\t\t\tnode.appendChild(dom.create('br'));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Wrap the block in a forcedRootBlock if we are at the root of document\r\n\t\t\t\t\tif (parentNode == dom.getRoot()) {\r\n\t\t\t\t\t\tif (!format.list_block || !isEq(node, format.list_block)) {\r\n\t\t\t\t\t\t\teach(grep(node.childNodes), function(node) {\r\n\t\t\t\t\t\t\t\tif (isValid(forcedRootBlock, node.nodeName.toLowerCase())) {\r\n\t\t\t\t\t\t\t\t\tif (!rootBlockElm) {\r\n\t\t\t\t\t\t\t\t\t\trootBlockElm = wrap(node, forcedRootBlock);\r\n\t\t\t\t\t\t\t\t\t\tdom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\trootBlockElm.appendChild(node);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\trootBlockElm = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Never remove nodes that isn't the specified inline element if a selector is specified too\r\n\t\t\tif (format.selector && format.inline && !isEq(format.inline, node)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdom.remove(node, 1);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the next/previous non whitespace node.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Node} node Node to start at.\r\n\t\t * @param {boolean} next (Optional) Include next or previous node defaults to previous.\r\n\t\t * @param {boolean} inc (Optional) Include the current node in checking. Defaults to false.\r\n\t\t * @return {Node} Next or previous node or undefined if it wasn't found.\r\n\t\t */\r\n\t\tfunction getNonWhiteSpaceSibling(node, next, inc) {\r\n\t\t\tif (node) {\r\n\t\t\t\tnext = next ? 'nextSibling' : 'previousSibling';\r\n\r\n\t\t\t\tfor (node = inc ? node : node[next]; node; node = node[next]) {\r\n\t\t\t\t\tif (node.nodeType == 1 || !isWhiteSpaceNode(node)) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Merges the next/previous sibling element if they match.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Node} prev Previous node to compare/merge.\r\n\t\t * @param {Node} next Next node to compare/merge.\r\n\t\t * @return {Node} Next node if we didn't merge and prev node if we did.\r\n\t\t */\r\n\t\tfunction mergeSiblings(prev, next) {\r\n\t\t\tvar sibling, tmpSibling, elementUtils = new ElementUtils(dom);\r\n\r\n\t\t\tfunction findElementSibling(node, sibling_name) {\r\n\t\t\t\tfor (sibling = node; sibling; sibling = sibling[sibling_name]) {\r\n\t\t\t\t\tif (sibling.nodeType == 3 && sibling.nodeValue.length !== 0) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling)) {\r\n\t\t\t\t\t\treturn sibling;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if next/prev exists and that they are elements\r\n\t\t\tif (prev && next) {\r\n\t\t\t\t// If previous sibling is empty then jump over it\r\n\t\t\t\tprev = findElementSibling(prev, 'previousSibling');\r\n\t\t\t\tnext = findElementSibling(next, 'nextSibling');\r\n\r\n\t\t\t\t// Compare next and previous nodes\r\n\t\t\t\tif (elementUtils.compare(prev, next)) {\r\n\t\t\t\t\t// Append nodes between\r\n\t\t\t\t\tfor (sibling = prev.nextSibling; sibling && sibling != next;) {\r\n\t\t\t\t\t\ttmpSibling = sibling;\r\n\t\t\t\t\t\tsibling = sibling.nextSibling;\r\n\t\t\t\t\t\tprev.appendChild(tmpSibling);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove next node\r\n\t\t\t\t\tdom.remove(next);\r\n\r\n\t\t\t\t\t// Move children into prev node\r\n\t\t\t\t\teach(grep(next.childNodes), function(node) {\r\n\t\t\t\t\t\tprev.appendChild(node);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn next;\r\n\t\t}\r\n\r\n\t\tfunction getContainer(rng, start) {\r\n\t\t\tvar container, offset, lastIdx;\r\n\r\n\t\t\tcontainer = rng[start ? 'startContainer' : 'endContainer'];\r\n\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'];\r\n\r\n\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\tlastIdx = container.childNodes.length - 1;\r\n\r\n\t\t\t\tif (!start && offset) {\r\n\t\t\t\t\toffset--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer = container.childNodes[offset > lastIdx ? lastIdx : offset];\r\n\t\t\t}\r\n\r\n\t\t\t// If start text node is excluded then walk to the next node\r\n\t\t\tif (container.nodeType === 3 && start && offset >= container.nodeValue.length) {\r\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).next() || container;\r\n\t\t\t}\r\n\r\n\t\t\t// If end text node is excluded then walk to the previous node\r\n\t\t\tif (container.nodeType === 3 && !start && offset === 0) {\r\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).prev() || container;\r\n\t\t\t}\r\n\r\n\t\t\treturn container;\r\n\t\t}\r\n\r\n\t\tfunction performCaretAction(type, name, vars, similar) {\r\n\t\t\tvar caretContainerId = '_mce_caret', debug = ed.settings.caret_debug;\r\n\r\n\t\t\t// Creates a caret container bogus element\r\n\t\t\tfunction createCaretContainer(fill) {\r\n\t\t\t\tvar caretContainer = dom.create('span', {id: caretContainerId, 'data-mce-bogus': true, style: debug ? 'color:red' : ''});\r\n\r\n\t\t\t\tif (fill) {\r\n\t\t\t\t\tcaretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn caretContainer;\r\n\t\t\t}\r\n\r\n\t\t\tfunction isCaretContainerEmpty(node, nodes) {\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tif ((node.nodeType === 3 && node.nodeValue !== INVISIBLE_CHAR) || node.childNodes.length > 1) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Collect nodes\r\n\t\t\t\t\tif (nodes && node.nodeType === 1) {\r\n\t\t\t\t\t\tnodes.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.firstChild;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Returns any parent caret container element\r\n\t\t\tfunction getParentCaretContainer(node) {\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tif (node.id === caretContainerId) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Finds the first text node in the specified node\r\n\t\t\tfunction findFirstTextNode(node) {\r\n\t\t\t\tvar walker;\r\n\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\twalker = new TreeWalker(node, node);\r\n\r\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\r\n\t\t\t\t\t\tif (node.nodeType === 3) {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Removes the caret container for the specified node or all on the current document\r\n\t\t\tfunction removeCaretContainer(node, move_caret) {\r\n\t\t\t\tvar child, rng;\r\n\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\tnode = getParentCaretContainer(selection.getStart());\r\n\r\n\t\t\t\t\tif (!node) {\r\n\t\t\t\t\t\twhile ((node = dom.get(caretContainerId))) {\r\n\t\t\t\t\t\t\tremoveCaretContainer(node, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng = selection.getRng(true);\r\n\r\n\t\t\t\t\tif (isCaretContainerEmpty(node)) {\r\n\t\t\t\t\t\tif (move_caret !== false) {\r\n\t\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\t\trng.setEndBefore(node);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdom.remove(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchild = findFirstTextNode(node);\r\n\r\n\t\t\t\t\t\tif (child.nodeValue.charAt(0) === INVISIBLE_CHAR) {\r\n\t\t\t\t\t\t\tchild.deleteData(0, 1);\r\n\r\n\t\t\t\t\t\t\t// Fix for bug #6976\r\n\t\t\t\t\t\t\tif (rng.startContainer == child && rng.startOffset > 0) {\r\n\t\t\t\t\t\t\t\trng.setStart(child, rng.startOffset - 1);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (rng.endContainer == child && rng.endOffset > 0) {\r\n\t\t\t\t\t\t\t\trng.setEnd(child, rng.endOffset - 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdom.remove(node, 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Applies formatting to the caret position\r\n\t\t\tfunction applyCaretFormat() {\r\n\t\t\t\tvar rng, caretContainer, textNode, offset, bookmark, container, text;\r\n\r\n\t\t\t\trng = selection.getRng(true);\r\n\t\t\t\toffset = rng.startOffset;\r\n\t\t\t\tcontainer = rng.startContainer;\r\n\t\t\t\ttext = container.nodeValue;\r\n\r\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\r\n\t\t\t\tif (caretContainer) {\r\n\t\t\t\t\ttextNode = findFirstTextNode(caretContainer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Expand to word is caret is in the middle of a text node and the char before/after is a alpha numeric character\r\n\t\t\t\tif (text && offset > 0 && offset < text.length && /\\w/.test(text.charAt(offset)) && /\\w/.test(text.charAt(offset - 1))) {\r\n\t\t\t\t\t// Get bookmark of caret position\r\n\t\t\t\t\tbookmark = selection.getBookmark();\r\n\r\n\t\t\t\t\t// Collapse bookmark range (WebKit)\r\n\t\t\t\t\trng.collapse(true);\r\n\r\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\r\n\t\t\t\t\trng = expandRng(rng, get(name));\r\n\t\t\t\t\trng = rangeUtils.split(rng);\r\n\r\n\t\t\t\t\t// Apply the format to the range\r\n\t\t\t\t\tapply(name, vars, rng);\r\n\r\n\t\t\t\t\t// Move selection back to caret position\r\n\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!caretContainer || textNode.nodeValue !== INVISIBLE_CHAR) {\r\n\t\t\t\t\t\tcaretContainer = createCaretContainer(true);\r\n\t\t\t\t\t\ttextNode = caretContainer.firstChild;\r\n\r\n\t\t\t\t\t\trng.insertNode(caretContainer);\r\n\t\t\t\t\t\toffset = 1;\r\n\r\n\t\t\t\t\t\tapply(name, vars, caretContainer);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapply(name, vars, caretContainer);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Move selection to text node\r\n\t\t\t\t\tselection.setCursorLocation(textNode, offset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction removeCaretFormat() {\r\n\t\t\t\tvar rng = selection.getRng(true), container, offset, bookmark,\r\n\t\t\t\t\thasContentAfter, node, formatNode, parents = [], i, caretContainer;\r\n\r\n\t\t\t\tcontainer = rng.startContainer;\r\n\t\t\t\toffset = rng.startOffset;\r\n\t\t\t\tnode = container;\r\n\r\n\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\tif (offset != container.nodeValue.length) {\r\n\t\t\t\t\t\thasContentAfter = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tif (matchNode(node, name, vars, similar)) {\r\n\t\t\t\t\t\tformatNode = node;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (node.nextSibling) {\r\n\t\t\t\t\t\thasContentAfter = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tparents.push(node);\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Node doesn't have the specified format\r\n\t\t\t\tif (!formatNode) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is there contents after the caret then remove the format on the element\r\n\t\t\t\tif (hasContentAfter) {\r\n\t\t\t\t\t// Get bookmark of caret position\r\n\t\t\t\t\tbookmark = selection.getBookmark();\r\n\r\n\t\t\t\t\t// Collapse bookmark range (WebKit)\r\n\t\t\t\t\trng.collapse(true);\r\n\r\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\r\n\t\t\t\t\trng = expandRng(rng, get(name), true);\r\n\t\t\t\t\trng = rangeUtils.split(rng);\r\n\r\n\t\t\t\t\t// Remove the format from the range\r\n\t\t\t\t\tremove(name, vars, rng);\r\n\r\n\t\t\t\t\t// Move selection back to caret position\r\n\t\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcaretContainer = createCaretContainer();\r\n\r\n\t\t\t\t\tnode = caretContainer;\r\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tnode.appendChild(dom.clone(parents[i], false));\r\n\t\t\t\t\t\tnode = node.firstChild;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Insert invisible character into inner most format element\r\n\t\t\t\t\tnode.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR));\r\n\t\t\t\t\tnode = node.firstChild;\r\n\r\n\t\t\t\t\tvar block = dom.getParent(formatNode, isTextBlock);\r\n\r\n\t\t\t\t\tif (block && dom.isEmpty(block)) {\r\n\t\t\t\t\t\t// Replace formatNode with caretContainer when removing format from empty block like <p><b>|</b></p>\r\n\t\t\t\t\t\tformatNode.parentNode.replaceChild(caretContainer, formatNode);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Insert caret container after the formatted node\r\n\t\t\t\t\t\tdom.insertAfter(caretContainer, formatNode);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Move selection to text node\r\n\t\t\t\t\tselection.setCursorLocation(node, 1);\r\n\r\n\t\t\t\t\t// If the formatNode is empty, we can remove it safely.\r\n\t\t\t\t\tif (dom.isEmpty(formatNode)) {\r\n\t\t\t\t\t\tdom.remove(formatNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Checks if the parent caret container node isn't empty if that is the case it\r\n\t\t\t// will remove the bogus state on all children that isn't empty\r\n\t\t\tfunction unmarkBogusCaretParents() {\r\n\t\t\t\tvar caretContainer;\r\n\r\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\r\n\t\t\t\tif (caretContainer && !dom.isEmpty(caretContainer)) {\r\n\t\t\t\t\twalk(caretContainer, function(node) {\r\n\t\t\t\t\t\tif (node.nodeType == 1 && node.id !== caretContainerId && !dom.isEmpty(node)) {\r\n\t\t\t\t\t\t\tdom.setAttrib(node, 'data-mce-bogus', null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 'childNodes');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Only bind the caret events once\r\n\t\t\tif (!ed._hasCaretEvents) {\r\n\t\t\t\t// Mark current caret container elements as bogus when getting the contents so we don't end up with empty elements\r\n\t\t\t\tmarkCaretContainersBogus = function() {\r\n\t\t\t\t\tvar nodes = [], i;\r\n\r\n\t\t\t\t\tif (isCaretContainerEmpty(getParentCaretContainer(selection.getStart()), nodes)) {\r\n\t\t\t\t\t\t// Mark children\r\n\t\t\t\t\t\ti = nodes.length;\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tdom.setAttrib(nodes[i], 'data-mce-bogus', '1');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tdisableCaretContainer = function(e) {\r\n\t\t\t\t\tvar keyCode = e.keyCode;\r\n\r\n\t\t\t\t\tremoveCaretContainer();\r\n\r\n\t\t\t\t\t// Remove caret container if it's empty\r\n\t\t\t\t\tif (keyCode == 8 && selection.isCollapsed() && selection.getStart().innerHTML == INVISIBLE_CHAR) {\r\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove caret container on keydown and it's left/right arrow keys\r\n\t\t\t\t\tif (keyCode == 37 || keyCode == 39) {\r\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tunmarkBogusCaretParents();\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Remove bogus state if they got filled by contents using editor.selection.setContent\r\n\t\t\t\ted.on('SetContent', function(e) {\r\n\t\t\t\t\tif (e.selection) {\r\n\t\t\t\t\t\tunmarkBogusCaretParents();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\ted._hasCaretEvents = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Do apply or remove caret format\r\n\t\t\tif (type == \"apply\") {\r\n\t\t\t\tapplyCaretFormat();\r\n\t\t\t} else {\r\n\t\t\t\tremoveCaretFormat();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the start to the first suitable text node.\r\n\t\t */\r\n\t\tfunction moveStart(rng) {\r\n\t\t\tvar container = rng.startContainer,\r\n\t\t\t\t\toffset = rng.startOffset, isAtEndOfText,\r\n\t\t\t\t\twalker, node, nodes, tmpNode;\r\n\r\n\t\t\tif (rng.startContainer == rng.endContainer) {\r\n\t\t\t\tif (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Convert text node into index if possible\r\n\t\t\tif (container.nodeType == 3 && offset >= container.nodeValue.length) {\r\n\t\t\t\t// Get the parent container location and walk from there\r\n\t\t\t\toffset = nodeIndex(container);\r\n\t\t\t\tcontainer = container.parentNode;\r\n\t\t\t\tisAtEndOfText = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Move startContainer/startOffset in to a suitable node\r\n\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\tnodes = container.childNodes;\r\n\t\t\t\tcontainer = nodes[Math.min(offset, nodes.length - 1)];\r\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\r\n\r\n\t\t\t\t// If offset is at end of the parent node walk to the next one\r\n\t\t\t\tif (offset > nodes.length - 1 || isAtEndOfText) {\r\n\t\t\t\t\twalker.next();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\r\n\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\r\n\t\t\t\t\t\t// IE has a \"neat\" feature where it moves the start node into the closest element\r\n\t\t\t\t\t\t// we can avoid this by inserting an element before it and then remove it after we set the selection\r\n\t\t\t\t\t\ttmpNode = dom.create('a', {'data-mce-bogus': 'all'}, INVISIBLE_CHAR);\r\n\t\t\t\t\t\tnode.parentNode.insertBefore(tmpNode, node);\r\n\r\n\t\t\t\t\t\t// Set selection and remove tmpNode\r\n\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t\tdom.remove(tmpNode);\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/UndoManager.js\r\n\r\n/**\r\n * UndoManager.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles the undo/redo history levels for the editor. Since the built-in undo/redo has major drawbacks a custom one was needed.\r\n *\r\n * @class tinymce.UndoManager\r\n */\r\ndefine(\"tinymce/UndoManager\", [\r\n\t\"tinymce/util/VK\",\r\n\t\"tinymce/Env\"\r\n], function(VK, Env) {\r\n\treturn function(editor) {\r\n\t\tvar self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;\r\n\r\n\t\tfunction getContent() {\r\n\t\t\treturn editor.serializer.getTrimmedContent();\r\n\t\t}\r\n\r\n\t\tfunction setDirty(state) {\r\n\t\t\teditor.setDirty(state);\r\n\t\t}\r\n\r\n\t\tfunction addNonTypingUndoLevel(e) {\r\n\t\t\tself.typing = false;\r\n\t\t\tself.add({}, e);\r\n\t\t}\r\n\r\n\t\t// Add initial undo level when the editor is initialized\r\n\t\teditor.on('init', function() {\r\n\t\t\tself.add();\r\n\t\t});\r\n\r\n\t\t// Get position before an execCommand is processed\r\n\t\teditor.on('BeforeExecCommand', function(e) {\r\n\t\t\tvar cmd = e.command;\r\n\r\n\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint') {\r\n\t\t\t\tself.beforeChange();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add undo level after an execCommand call was made\r\n\t\teditor.on('ExecCommand', function(e) {\r\n\t\t\tvar cmd = e.command;\r\n\r\n\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint') {\r\n\t\t\t\taddNonTypingUndoLevel(e);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\teditor.on('ObjectResizeStart Cut', function() {\r\n\t\t\tself.beforeChange();\r\n\t\t});\r\n\r\n\t\teditor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\r\n\t\teditor.on('DragEnd', addNonTypingUndoLevel);\r\n\r\n\t\teditor.on('KeyUp', function(e) {\r\n\t\t\tvar keyCode = e.keyCode;\r\n\r\n\t\t\t// If key is prevented then don't add undo level\r\n\t\t\t// This would happen on keyboard shortcuts for example\r\n\t\t\tif (e.isDefaultPrevented()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 45 || keyCode == 13 || e.ctrlKey) {\r\n\t\t\t\taddNonTypingUndoLevel();\r\n\t\t\t\teditor.nodeChanged();\r\n\t\t\t}\r\n\r\n\t\t\tif (keyCode == 46 || keyCode == 8 || (Env.mac && (keyCode == 91 || keyCode == 93))) {\r\n\t\t\t\teditor.nodeChanged();\r\n\t\t\t}\r\n\r\n\t\t\t// Fire a TypingUndo event on the first character entered\r\n\t\t\tif (isFirstTypedCharacter && self.typing) {\r\n\t\t\t\t// Make it dirty if the content was changed after typing the first character\r\n\t\t\t\tif (!editor.isDirty()) {\r\n\t\t\t\t\tsetDirty(data[0] && getContent() != data[0].content);\r\n\r\n\t\t\t\t\t// Fire initial change event\r\n\t\t\t\t\tif (editor.isDirty()) {\r\n\t\t\t\t\t\teditor.fire('change', {level: data[0], lastLevel: null});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\teditor.fire('TypingUndo');\r\n\t\t\t\tisFirstTypedCharacter = false;\r\n\t\t\t\teditor.nodeChanged();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\teditor.on('KeyDown', function(e) {\r\n\t\t\tvar keyCode = e.keyCode;\r\n\r\n\t\t\t// If key is prevented then don't add undo level\r\n\t\t\t// This would happen on keyboard shortcuts for example\r\n\t\t\tif (e.isDefaultPrevented()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Is character position keys left,right,up,down,home,end,pgdown,pgup,enter\r\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 45) {\r\n\t\t\t\tif (self.typing) {\r\n\t\t\t\t\taddNonTypingUndoLevel(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If key isn't Ctrl+Alt/AltGr\r\n\t\t\tvar modKey = (e.ctrlKey && !e.altKey) || e.metaKey;\r\n\t\t\tif ((keyCode < 16 || keyCode > 20) && keyCode != 224 && keyCode != 91 && !self.typing && !modKey) {\r\n\t\t\t\tself.beforeChange();\r\n\t\t\t\tself.typing = true;\r\n\t\t\t\tself.add({}, e);\r\n\t\t\t\tisFirstTypedCharacter = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\teditor.on('MouseDown', function(e) {\r\n\t\t\tif (self.typing) {\r\n\t\t\t\taddNonTypingUndoLevel(e);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add keyboard shortcuts for undo/redo keys\r\n\t\teditor.addShortcut('meta+z', '', 'Undo');\r\n\t\teditor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\r\n\r\n\t\teditor.on('AddUndo Undo Redo ClearUndos', function(e) {\r\n\t\t\tif (!e.isDefaultPrevented()) {\r\n\t\t\t\teditor.nodeChanged();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t/*eslint consistent-this:0 */\r\n\t\tself = {\r\n\t\t\t// Explode for debugging reasons\r\n\t\t\tdata: data,\r\n\r\n\t\t\t/**\r\n\t\t\t * State if the user is currently typing or not. This will add a typing operation into one undo\r\n\t\t\t * level instead of one new level for each keystroke.\r\n\t\t\t *\r\n\t\t\t * @field {Boolean} typing\r\n\t\t\t */\r\n\t\t\ttyping: false,\r\n\r\n\t\t\t/**\r\n\t\t\t * Stores away a bookmark to be used when performing an undo action so that the selection is before\r\n\t\t\t * the change has been made.\r\n\t\t\t *\r\n\t\t\t * @method beforeChange\r\n\t\t\t */\r\n\t\t\tbeforeChange: function() {\r\n\t\t\t\tif (!locks) {\r\n\t\t\t\t\tbeforeBookmark = editor.selection.getBookmark(2, true);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Adds a new undo level/snapshot to the undo list.\r\n\t\t\t *\r\n\t\t\t * @method add\r\n\t\t\t * @param {Object} level Optional undo level object to add.\r\n\t\t\t * @param {DOMEvent} event Optional event responsible for the creation of the undo level.\r\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\r\n\t\t\t */\r\n\t\t\tadd: function(level, event) {\r\n\t\t\t\tvar i, settings = editor.settings, lastLevel;\r\n\r\n\t\t\t\tlevel = level || {};\r\n\t\t\t\tlevel.content = getContent();\r\n\r\n\t\t\t\tif (locks || editor.removed) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastLevel = data[index];\r\n\t\t\t\tif (editor.fire('BeforeAddUndo', {level: level, lastLevel: lastLevel, originalEvent: event}).isDefaultPrevented()) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add undo level if needed\r\n\t\t\t\tif (lastLevel && lastLevel.content == level.content) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set before bookmark on previous level\r\n\t\t\t\tif (data[index]) {\r\n\t\t\t\t\tdata[index].beforeBookmark = beforeBookmark;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Time to compress\r\n\t\t\t\tif (settings.custom_undo_redo_levels) {\r\n\t\t\t\t\tif (data.length > settings.custom_undo_redo_levels) {\r\n\t\t\t\t\t\tfor (i = 0; i < data.length - 1; i++) {\r\n\t\t\t\t\t\t\tdata[i] = data[i + 1];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdata.length--;\r\n\t\t\t\t\t\tindex = data.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get a non intrusive normalized bookmark\r\n\t\t\t\tlevel.bookmark = editor.selection.getBookmark(2, true);\r\n\r\n\t\t\t\t// Crop array if needed\r\n\t\t\t\tif (index < data.length - 1) {\r\n\t\t\t\t\tdata.length = index + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdata.push(level);\r\n\t\t\t\tindex = data.length - 1;\r\n\r\n\t\t\t\tvar args = {level: level, lastLevel: lastLevel, originalEvent: event};\r\n\r\n\t\t\t\teditor.fire('AddUndo', args);\r\n\r\n\t\t\t\tif (index > 0) {\r\n\t\t\t\t\tsetDirty(true);\r\n\t\t\t\t\teditor.fire('change', args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Undoes the last action.\r\n\t\t\t *\r\n\t\t\t * @method undo\r\n\t\t\t * @return {Object} Undo level or null if no undo was performed.\r\n\t\t\t */\r\n\t\t\tundo: function() {\r\n\t\t\t\tvar level;\r\n\r\n\t\t\t\tif (self.typing) {\r\n\t\t\t\t\tself.add();\r\n\t\t\t\t\tself.typing = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (index > 0) {\r\n\t\t\t\t\tlevel = data[--index];\r\n\r\n\t\t\t\t\teditor.setContent(level.content, {format: 'raw'});\r\n\t\t\t\t\teditor.selection.moveToBookmark(level.beforeBookmark);\r\n\t\t\t\t\tsetDirty(true);\r\n\r\n\t\t\t\t\teditor.fire('undo', {level: level});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Redoes the last action.\r\n\t\t\t *\r\n\t\t\t * @method redo\r\n\t\t\t * @return {Object} Redo level or null if no redo was performed.\r\n\t\t\t */\r\n\t\t\tredo: function() {\r\n\t\t\t\tvar level;\r\n\r\n\t\t\t\tif (index < data.length - 1) {\r\n\t\t\t\t\tlevel = data[++index];\r\n\r\n\t\t\t\t\teditor.setContent(level.content, {format: 'raw'});\r\n\t\t\t\t\teditor.selection.moveToBookmark(level.bookmark);\r\n\t\t\t\t\tsetDirty(true);\r\n\r\n\t\t\t\t\teditor.fire('redo', {level: level});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn level;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Removes all undo levels.\r\n\t\t\t *\r\n\t\t\t * @method clear\r\n\t\t\t */\r\n\t\t\tclear: function() {\r\n\t\t\t\tdata = [];\r\n\t\t\t\tindex = 0;\r\n\t\t\t\tself.typing = false;\r\n\t\t\t\tself.data = data;\r\n\t\t\t\teditor.fire('ClearUndos');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns true/false if the undo manager has any undo levels.\r\n\t\t\t *\r\n\t\t\t * @method hasUndo\r\n\t\t\t * @return {Boolean} true/false if the undo manager has any undo levels.\r\n\t\t\t */\r\n\t\t\thasUndo: function() {\r\n\t\t\t\t// Has undo levels or typing and content isn't the same as the initial level\r\n\t\t\t\treturn index > 0 || (self.typing && data[0] && getContent() != data[0].content);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns true/false if the undo manager has any redo levels.\r\n\t\t\t *\r\n\t\t\t * @method hasRedo\r\n\t\t\t * @return {Boolean} true/false if the undo manager has any redo levels.\r\n\t\t\t */\r\n\t\t\thasRedo: function() {\r\n\t\t\t\treturn index < data.length - 1 && !this.typing;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Executes the specified mutator function as an undo transaction. The selection\r\n\t\t\t * before the modification will be stored to the undo stack and if the DOM changes\r\n\t\t\t * it will add a new undo level. Any methods within the translation that adds undo levels will\r\n\t\t\t * be ignored. So a translation can include calls to execCommand or editor.insertContent.\r\n\t\t\t *\r\n\t\t\t * @method transact\r\n\t\t\t * @param {function} callback Function that gets executed and has dom manipulation logic in it.\r\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\r\n\t\t\t */\r\n\t\t\ttransact: function(callback) {\r\n\t\t\t\tself.beforeChange();\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlocks++;\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tlocks--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn self.add();\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Adds an extra \"hidden\" undo level by first applying the first mutation and store that to the undo stack\r\n\t\t\t * then roll back that change and do the second mutation on top of the stack. This will produce an extra\r\n\t\t\t * undo level that the user doesn't see until they undo.\r\n\t\t\t *\r\n\t\t\t * @method extra\r\n\t\t\t * @param {function} callback1 Function that does mutation but gets stored as a \"hidden\" extra undo level.\r\n\t\t\t * @param {function} callback2 Function that does mutation but gets displayed to the user.\r\n\t\t\t */\r\n\t\t\textra: function (callback1, callback2) {\r\n\t\t\t\tvar lastLevel, bookmark;\r\n\r\n\t\t\t\tif (self.transact(callback1)) {\r\n\t\t\t\t\tbookmark = data[index].bookmark;\r\n\t\t\t\t\tlastLevel = data[index - 1];\r\n\t\t\t\t\teditor.setContent(lastLevel.content, {format: 'raw'});\r\n\t\t\t\t\teditor.selection.moveToBookmark(lastLevel.beforeBookmark);\r\n\r\n\t\t\t\t\tif (self.transact(callback2)) {\r\n\t\t\t\t\t\tdata[index - 1].beforeBookmark = bookmark;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn self;\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/EnterKey.js\r\n\r\n/**\r\n * EnterKey.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Contains logic for handling the enter key to split/generate block elements.\r\n *\r\n * @private\r\n * @class tinymce.EnterKey\r\n */\r\ndefine(\"tinymce/EnterKey\", [\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/Env\"\r\n], function(TreeWalker, RangeUtils, Env) {\r\n\tvar isIE = Env.ie && Env.ie < 11;\r\n\r\n\treturn function(editor) {\r\n\t\tvar dom = editor.dom, selection = editor.selection, settings = editor.settings;\r\n\t\tvar undoManager = editor.undoManager, schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements(),\r\n\t\t\tmoveCaretBeforeOnEnterElementsMap = schema.getMoveCaretBeforeOnEnterElements();\r\n\r\n\t\tfunction handleEnterKey(evt) {\r\n\t\t\tvar rng, tmpRng, editableRoot, container, offset, parentBlock, documentMode, shiftKey,\r\n\t\t\t\tnewBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\r\n\r\n\t\t\t// Returns true if the block can be split into two blocks or not\r\n\t\t\tfunction canSplitBlock(node) {\r\n\t\t\t\treturn node &&\r\n\t\t\t\t\tdom.isBlock(node) &&\r\n\t\t\t\t\t!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) &&\r\n\t\t\t\t\t!/^(fixed|absolute)/i.test(node.style.position) &&\r\n\t\t\t\t\tdom.getContentEditable(node) !== \"true\";\r\n\t\t\t}\r\n\r\n\t\t\tfunction isTableCell(node) {\r\n\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\r\n\t\t\t}\r\n\r\n\t\t\t// Renders empty block on IE\r\n\t\t\tfunction renderBlockOnIE(block) {\r\n\t\t\t\tvar oldRng;\r\n\r\n\t\t\t\tif (dom.isBlock(block)) {\r\n\t\t\t\t\toldRng = selection.getRng();\r\n\t\t\t\t\tblock.appendChild(dom.create('span', null, '\\u00a0'));\r\n\t\t\t\t\tselection.select(block);\r\n\t\t\t\t\tblock.lastChild.outerHTML = '';\r\n\t\t\t\t\tselection.setRng(oldRng);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the first empty inline element of the block so this: <p><b><em></em></b>x</p> becomes this: <p>x</p>\r\n\t\t\tfunction trimInlineElementsOnLeftSideOfBlock(block) {\r\n\t\t\t\tvar node = block, firstChilds = [], i;\r\n\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find inner most first child ex: <p><i><b>*</b></i></p>\r\n\t\t\t\twhile ((node = node.firstChild)) {\r\n\t\t\t\t\tif (dom.isBlock(node)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (node.nodeType == 1 && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\r\n\t\t\t\t\t\tfirstChilds.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\ti = firstChilds.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = firstChilds[i];\r\n\t\t\t\t\tif (!node.hasChildNodes() || (node.firstChild == node.lastChild && node.firstChild.nodeValue === '')) {\r\n\t\t\t\t\t\tdom.remove(node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Remove <a> </a> see #5381\r\n\t\t\t\t\t\tif (node.nodeName == \"A\" && (node.innerText || node.textContent) === ' ') {\r\n\t\t\t\t\t\t\tdom.remove(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Moves the caret to a suitable position within the root for example in the first non\r\n\t\t\t// pure whitespace text node or before an image\r\n\t\t\tfunction moveToCaretPosition(root) {\r\n\t\t\t\tvar walker, node, rng, lastNode = root, tempElm;\r\n\t\t\t\tfunction firstNonWhiteSpaceNodeSibling(node) {\r\n\t\t\t\t\twhile (node) {\r\n\t\t\t\t\t\tif (node.nodeType == 1 || (node.nodeType == 3 && node.data && /[\\r\\n\\s]/.test(node.data))) {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!root) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Old IE versions doesn't properly render blocks with br elements in them\r\n\t\t\t\t// For example <p><br></p> wont be rendered correctly in a contentEditable area\r\n\t\t\t\t// until you remove the br producing <p></p>\r\n\t\t\t\tif (Env.ie && Env.ie < 9 && parentBlock && parentBlock.firstChild) {\r\n\t\t\t\t\tif (parentBlock.firstChild == parentBlock.lastChild && parentBlock.firstChild.tagName == 'BR') {\r\n\t\t\t\t\t\tdom.remove(parentBlock.firstChild);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (/^(LI|DT|DD)$/.test(root.nodeName)) {\r\n\t\t\t\t\tvar firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\r\n\r\n\t\t\t\t\tif (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\r\n\t\t\t\t\t\troot.insertBefore(dom.doc.createTextNode('\\u00a0'), root.firstChild);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\trng = dom.createRng();\r\n\r\n\t\t\t\t// Normalize whitespace to remove empty text nodes. Fix for: #6904\r\n\t\t\t\t// Gecko will be able to place the caret in empty text nodes but it won't render propery\r\n\t\t\t\t// Older IE versions will sometimes crash so for now ignore all IE versions\r\n\t\t\t\tif (!Env.ie) {\r\n\t\t\t\t\troot.normalize();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (root.hasChildNodes()) {\r\n\t\t\t\t\twalker = new TreeWalker(root, root);\r\n\r\n\t\t\t\t\twhile ((node = walker.current())) {\r\n\t\t\t\t\t\tif (node.nodeType == 3) {\r\n\t\t\t\t\t\t\trng.setStart(node, 0);\r\n\t\t\t\t\t\t\trng.setEnd(node, 0);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\r\n\t\t\t\t\t\t\trng.setStartBefore(node);\r\n\t\t\t\t\t\t\trng.setEndBefore(node);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlastNode = node;\r\n\t\t\t\t\t\tnode = walker.next();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!node) {\r\n\t\t\t\t\t\trng.setStart(lastNode, 0);\r\n\t\t\t\t\t\trng.setEnd(lastNode, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (root.nodeName == 'BR') {\r\n\t\t\t\t\t\tif (root.nextSibling && dom.isBlock(root.nextSibling)) {\r\n\t\t\t\t\t\t\t// Trick on older IE versions to render the caret before the BR between two lists\r\n\t\t\t\t\t\t\tif (!documentMode || documentMode < 9) {\r\n\t\t\t\t\t\t\t\ttempElm = dom.create('br');\r\n\t\t\t\t\t\t\t\troot.parentNode.insertBefore(tempElm, root);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\trng.setStartBefore(root);\r\n\t\t\t\t\t\t\trng.setEndBefore(root);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.setStartAfter(root);\r\n\t\t\t\t\t\t\trng.setEndAfter(root);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trng.setStart(root, 0);\r\n\t\t\t\t\t\trng.setEnd(root, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselection.setRng(rng);\r\n\r\n\t\t\t\t// Remove tempElm created for old IE:s\r\n\t\t\t\tdom.remove(tempElm);\r\n\t\t\t\tselection.scrollIntoView(root);\r\n\t\t\t}\r\n\r\n\t\t\tfunction setForcedBlockAttrs(node) {\r\n\t\t\t\tvar forcedRootBlockName = settings.forced_root_block;\r\n\r\n\t\t\t\tif (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\r\n\t\t\t\t\tdom.setAttribs(node, settings.forced_root_block_attrs);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction emptyBlock(elm) {\r\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\r\n\t\t\t\telm.innerHTML = !isIE ? '<br data-mce-bogus=\"1\">' : '';\r\n\t\t\t}\r\n\r\n\t\t\t// Creates a new block element by cloning the current one or creating a new one if the name is specified\r\n\t\t\t// This function will also copy any text formatting from the parent block and add it to the new one\r\n\t\t\tfunction createNewBlock(name) {\r\n\t\t\t\tvar node = container, block, clonedNode, caretNode, textInlineElements = schema.getTextInlineElements();\r\n\r\n\t\t\t\tif (name || parentBlockName == \"TABLE\") {\r\n\t\t\t\t\tblock = dom.create(name || newBlockName);\r\n\t\t\t\t\tsetForcedBlockAttrs(block);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tblock = parentBlock.cloneNode(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcaretNode = block;\r\n\r\n\t\t\t\t// Clone any parent styles\r\n\t\t\t\tif (settings.keep_styles !== false) {\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tif (textInlineElements[node.nodeName]) {\r\n\t\t\t\t\t\t\t// Never clone a caret containers\r\n\t\t\t\t\t\t\tif (node.id == '_mce_caret') {\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tclonedNode = node.cloneNode(false);\r\n\t\t\t\t\t\t\tdom.setAttrib(clonedNode, 'id', ''); // Remove ID since it needs to be document unique\r\n\r\n\t\t\t\t\t\t\tif (block.hasChildNodes()) {\r\n\t\t\t\t\t\t\t\tclonedNode.appendChild(block.firstChild);\r\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcaretNode = clonedNode;\r\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while ((node = node.parentNode) && node != editableRoot);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\r\n\t\t\t\tif (!isIE) {\r\n\t\t\t\t\tcaretNode.innerHTML = '<br data-mce-bogus=\"1\">';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn block;\r\n\t\t\t}\r\n\r\n\t\t\t// Returns true/false if the caret is at the start/end of the parent block element\r\n\t\t\tfunction isCaretAtStartOrEndOfBlock(start) {\r\n\t\t\t\tvar walker, node, name;\r\n\r\n\t\t\t\t// Caret is in the middle of a text node like \"a|b\"\r\n\t\t\t\tif (container.nodeType == 3 && (start ? offset > 0 : offset < container.nodeValue.length)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If after the last element in block node edge case for #5091\r\n\t\t\t\tif (container.parentNode == parentBlock && isAfterLastNodeInContainer && !start) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the caret if before the first element in parentBlock\r\n\t\t\t\tif (start && container.nodeType == 1 && container == parentBlock.firstChild) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Caret can be before/after a table\r\n\t\t\t\tif (container.nodeName === \"TABLE\" || (container.previousSibling && container.previousSibling.nodeName == \"TABLE\")) {\r\n\t\t\t\t\treturn (isAfterLastNodeInContainer && !start) || (!isAfterLastNodeInContainer && start);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Walk the DOM and look for text nodes or non empty elements\r\n\t\t\t\twalker = new TreeWalker(container, parentBlock);\r\n\r\n\t\t\t\t// If caret is in beginning or end of a text block then jump to the next/previous node\r\n\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\tif (start && offset === 0) {\r\n\t\t\t\t\t\twalker.prev();\r\n\t\t\t\t\t} else if (!start && offset == container.nodeValue.length) {\r\n\t\t\t\t\t\twalker.next();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile ((node = walker.current())) {\r\n\t\t\t\t\tif (node.nodeType === 1) {\r\n\t\t\t\t\t\t// Ignore bogus elements\r\n\t\t\t\t\t\tif (!node.getAttribute('data-mce-bogus')) {\r\n\t\t\t\t\t\t\t// Keep empty elements like <img /> <input /> but not trailing br:s like <p>text|<br></p>\r\n\t\t\t\t\t\t\tname = node.nodeName.toLowerCase();\r\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[name] && name !== 'br') {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (node.nodeType === 3 && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (start) {\r\n\t\t\t\t\t\twalker.prev();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twalker.next();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Wraps any text nodes or inline elements in the specified forced root block name\r\n\t\t\tfunction wrapSelfAndSiblingsInDefaultBlock(container, offset) {\r\n\t\t\t\tvar newBlock, parentBlock, startNode, node, next, rootBlockName, blockName = newBlockName || 'P';\r\n\r\n\t\t\t\t// Not in a block element or in a table cell or caption\r\n\t\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\r\n\t\t\t\tif (!parentBlock || !canSplitBlock(parentBlock)) {\r\n\t\t\t\t\tparentBlock = parentBlock || editableRoot;\r\n\r\n\t\t\t\t\tif (parentBlock == editor.getBody() || isTableCell(parentBlock)) {\r\n\t\t\t\t\t\trootBlockName = parentBlock.nodeName.toLowerCase();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!parentBlock.hasChildNodes()) {\r\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\r\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\r\n\t\t\t\t\t\tparentBlock.appendChild(newBlock);\r\n\t\t\t\t\t\trng.setStart(newBlock, 0);\r\n\t\t\t\t\t\trng.setEnd(newBlock, 0);\r\n\t\t\t\t\t\treturn newBlock;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Find parent that is the first child of parentBlock\r\n\t\t\t\t\tnode = container;\r\n\t\t\t\t\twhile (node.parentNode != parentBlock) {\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Loop left to find start node start wrapping at\r\n\t\t\t\t\twhile (node && !dom.isBlock(node)) {\r\n\t\t\t\t\t\tstartNode = node;\r\n\t\t\t\t\t\tnode = node.previousSibling;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (startNode && schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\r\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\r\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\r\n\t\t\t\t\t\tstartNode.parentNode.insertBefore(newBlock, startNode);\r\n\r\n\t\t\t\t\t\t// Start wrapping until we hit a block\r\n\t\t\t\t\t\tnode = startNode;\r\n\t\t\t\t\t\twhile (node && !dom.isBlock(node)) {\r\n\t\t\t\t\t\t\tnext = node.nextSibling;\r\n\t\t\t\t\t\t\tnewBlock.appendChild(node);\r\n\t\t\t\t\t\t\tnode = next;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Restore range to it's past location\r\n\t\t\t\t\t\trng.setStart(container, offset);\r\n\t\t\t\t\t\trng.setEnd(container, offset);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\r\n\t\t\t// Inserts a block or br before/after or in the middle of a split list of the LI is empty\r\n\t\t\tfunction handleEmptyListItem() {\r\n\t\t\t\tfunction isFirstOrLastLi(first) {\r\n\t\t\t\t\tvar node = containerBlock[first ? 'firstChild' : 'lastChild'];\r\n\r\n\t\t\t\t\t// Find first/last element since there might be whitespace there\r\n\t\t\t\t\twhile (node) {\r\n\t\t\t\t\t\tif (node.nodeType == 1) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = node[first ? 'nextSibling' : 'previousSibling'];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node === parentBlock;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction getContainerBlock() {\r\n\t\t\t\t\tvar containerBlockParent = containerBlock.parentNode;\r\n\r\n\t\t\t\t\tif (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\r\n\t\t\t\t\t\treturn containerBlockParent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn containerBlock;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (containerBlock == editor.getBody()) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if we are in an nested list\r\n\t\t\t\tvar containerBlockParentName = containerBlock.parentNode.nodeName;\r\n\t\t\t\tif (/^(OL|UL|LI)$/.test(containerBlockParentName)) {\r\n\t\t\t\t\tnewBlockName = 'LI';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\r\n\r\n\t\t\t\tif (isFirstOrLastLi(true) && isFirstOrLastLi()) {\r\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\r\n\t\t\t\t\t\t// Nested list is inside a LI\r\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Is first and last list item then replace the OL/UL with a text block\r\n\t\t\t\t\t\tdom.replace(newBlock, containerBlock);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (isFirstOrLastLi(true)) {\r\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\r\n\t\t\t\t\t\t// List nested in an LI then move the list to a new sibling LI\r\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\r\n\t\t\t\t\t\tnewBlock.appendChild(dom.doc.createTextNode(' ')); // Needed for IE so the caret can be placed\r\n\t\t\t\t\t\tnewBlock.appendChild(containerBlock);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// First LI in list then remove LI and add text block before list\r\n\t\t\t\t\t\tcontainerBlock.parentNode.insertBefore(newBlock, containerBlock);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (isFirstOrLastLi()) {\r\n\t\t\t\t\t// Last LI in list then remove LI and add text block after list\r\n\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\r\n\t\t\t\t\trenderBlockOnIE(newBlock);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Middle LI in list the split the list and insert a text block in the middle\r\n\t\t\t\t\t// Extract after fragment and insert it after the current block\r\n\t\t\t\t\tcontainerBlock = getContainerBlock();\r\n\t\t\t\t\ttmpRng = rng.cloneRange();\r\n\t\t\t\t\ttmpRng.setStartAfter(parentBlock);\r\n\t\t\t\t\ttmpRng.setEndAfter(containerBlock);\r\n\t\t\t\t\tfragment = tmpRng.extractContents();\r\n\r\n\t\t\t\t\tif (newBlockName == 'LI' && fragment.firstChild.nodeName == 'LI') {\r\n\t\t\t\t\t\tnewBlock = fragment.firstChild;\r\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\r\n\t\t\t\t\t\tdom.insertAfter(newBlock, containerBlock);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdom.remove(parentBlock);\r\n\t\t\t\tmoveToCaretPosition(newBlock);\r\n\t\t\t\tundoManager.add();\r\n\t\t\t}\r\n\r\n\t\t\t// Inserts a BR element if the forced_root_block option is set to false or empty string\r\n\t\t\tfunction insertBr() {\r\n\t\t\t\teditor.execCommand(\"InsertLineBreak\", false, evt);\r\n\t\t\t}\r\n\r\n\t\t\t// Trims any linebreaks at the beginning of node user for example when pressing enter in a PRE element\r\n\t\t\tfunction trimLeadingLineBreaks(node) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (node.nodeType === 3) {\r\n\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.firstChild;\r\n\t\t\t\t} while (node);\r\n\t\t\t}\r\n\r\n\t\t\tfunction getEditableRoot(node) {\r\n\t\t\t\tvar root = dom.getRoot(), parent, editableRoot;\r\n\r\n\t\t\t\t// Get all parents until we hit a non editable parent or the root\r\n\t\t\t\tparent = node;\r\n\t\t\t\twhile (parent !== root && dom.getContentEditable(parent) !== \"false\") {\r\n\t\t\t\t\tif (dom.getContentEditable(parent) === \"true\") {\r\n\t\t\t\t\t\teditableRoot = parent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn parent !== root ? editableRoot : root;\r\n\t\t\t}\r\n\r\n\t\t\t// Adds a BR at the end of blocks that only contains an IMG or INPUT since\r\n\t\t\t// these might be floated and then they won't expand the block\r\n\t\t\tfunction addBrToBlockIfNeeded(block) {\r\n\t\t\t\tvar lastChild;\r\n\r\n\t\t\t\t// IE will render the blocks correctly other browsers needs a BR\r\n\t\t\t\tif (!isIE) {\r\n\t\t\t\t\tblock.normalize(); // Remove empty text nodes that got left behind by the extract\r\n\r\n\t\t\t\t\t// Check if the block is empty or contains a floated last child\r\n\t\t\t\t\tlastChild = block.lastChild;\r\n\t\t\t\t\tif (!lastChild || (/^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true)))) {\r\n\t\t\t\t\t\tdom.add(block, 'br');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction insertNewBlockAfter() {\r\n\t\t\t\t// If the caret is at the end of a header we produce a P tag after it similar to Word unless we are in a hgroup\r\n\t\t\t\tif (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName != 'HGROUP') {\r\n\t\t\t\t\tnewBlock = createNewBlock(newBlockName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewBlock = createNewBlock();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Split the current container block element if enter is pressed inside an empty inner block element\r\n\t\t\t\tif (settings.end_container_on_empty_block && canSplitBlock(containerBlock) && dom.isEmpty(parentBlock)) {\r\n\t\t\t\t\t// Split container block for example a BLOCKQUOTE at the current blockParent location for example a P\r\n\t\t\t\t\tnewBlock = dom.split(containerBlock, parentBlock);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdom.insertAfter(newBlock, parentBlock);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmoveToCaretPosition(newBlock);\r\n\t\t\t}\r\n\r\n\t\t\trng = selection.getRng(true);\r\n\r\n\t\t\t// Event is blocked by some other handler for example the lists plugin\r\n\t\t\tif (evt.isDefaultPrevented()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Delete any selected contents\r\n\t\t\tif (!rng.collapsed) {\r\n\t\t\t\teditor.execCommand('Delete');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Setup range items and newBlockName\r\n\t\t\tnew RangeUtils(dom).normalize(rng);\r\n\t\t\tcontainer = rng.startContainer;\r\n\t\t\toffset = rng.startOffset;\r\n\t\t\tnewBlockName = (settings.force_p_newlines ? 'p' : '') || settings.forced_root_block;\r\n\t\t\tnewBlockName = newBlockName ? newBlockName.toUpperCase() : '';\r\n\t\t\tdocumentMode = dom.doc.documentMode;\r\n\t\t\tshiftKey = evt.shiftKey;\r\n\r\n\t\t\t// Resolve node index\r\n\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\r\n\t\t\t\tisAfterLastNodeInContainer = offset > container.childNodes.length - 1;\r\n\r\n\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\r\n\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\r\n\t\t\t\t\toffset = container.nodeValue.length;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toffset = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Get editable root node, normally the body element but sometimes a div or span\r\n\t\t\teditableRoot = getEditableRoot(container);\r\n\r\n\t\t\t// If there is no editable root then enter is done inside a contentEditable false element\r\n\t\t\tif (!editableRoot) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tundoManager.beforeChange();\r\n\r\n\t\t\t// If editable root isn't block nor the root of the editor\r\n\t\t\tif (!dom.isBlock(editableRoot) && editableRoot != dom.getRoot()) {\r\n\t\t\t\tif (!newBlockName || shiftKey) {\r\n\t\t\t\t\tinsertBr();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Wrap the current node and it's sibling in a default block if it's needed.\r\n\t\t\t// for example this <td>text|<b>text2</b></td> will become this <td><p>text|<b>text2</p></b></td>\r\n\t\t\t// This won't happen if root blocks are disabled or the shiftKey is pressed\r\n\t\t\tif ((newBlockName && !shiftKey) || (!newBlockName && shiftKey)) {\r\n\t\t\t\tcontainer = wrapSelfAndSiblingsInDefaultBlock(container, offset);\r\n\t\t\t}\r\n\r\n\t\t\t// Find parent block and setup empty block paddings\r\n\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\r\n\t\t\tcontainerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\r\n\r\n\t\t\t// Setup block names\r\n\t\t\tparentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\r\n\t\t\tcontainerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\r\n\r\n\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\r\n\t\t\tif (containerBlockName == 'LI' && !evt.ctrlKey) {\r\n\t\t\t\tparentBlock = containerBlock;\r\n\t\t\t\tparentBlockName = containerBlockName;\r\n\t\t\t}\r\n\r\n\t\t\t// Handle enter in list item\r\n\t\t\tif (/^(LI|DT|DD)$/.test(parentBlockName)) {\r\n\t\t\t\tif (!newBlockName && shiftKey) {\r\n\t\t\t\t\tinsertBr();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle enter inside an empty list item\r\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\r\n\t\t\t\t\thandleEmptyListItem();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Don't split PRE tags but insert a BR instead easier when writing code samples etc\r\n\t\t\tif (parentBlockName == 'PRE' && settings.br_in_pre !== false) {\r\n\t\t\t\tif (!shiftKey) {\r\n\t\t\t\t\tinsertBr();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// If no root block is configured then insert a BR by default or if the shiftKey is pressed\r\n\t\t\t\tif ((!newBlockName && !shiftKey && parentBlockName != 'LI') || (newBlockName && shiftKey)) {\r\n\t\t\t\t\tinsertBr();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If parent block is root then never insert new blocks\r\n\t\t\tif (newBlockName && parentBlock === editor.getBody()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Default block name if it's not configured\r\n\t\t\tnewBlockName = newBlockName || 'P';\r\n\r\n\t\t\t// Insert new block before/after the parent block depending on caret location\r\n\t\t\tif (isCaretAtStartOrEndOfBlock()) {\r\n\t\t\t\tinsertNewBlockAfter();\r\n\t\t\t} else if (isCaretAtStartOrEndOfBlock(true)) {\r\n\t\t\t\t// Insert new block before\r\n\t\t\t\tnewBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\r\n\t\t\t\trenderBlockOnIE(newBlock);\r\n\t\t\t\tmoveToCaretPosition(parentBlock);\r\n\t\t\t} else {\r\n\t\t\t\t// Extract after fragment and insert it after the current block\r\n\t\t\t\ttmpRng = rng.cloneRange();\r\n\t\t\t\ttmpRng.setEndAfter(parentBlock);\r\n\t\t\t\tfragment = tmpRng.extractContents();\r\n\t\t\t\ttrimLeadingLineBreaks(fragment);\r\n\t\t\t\tnewBlock = fragment.firstChild;\r\n\t\t\t\tdom.insertAfter(fragment, parentBlock);\r\n\t\t\t\ttrimInlineElementsOnLeftSideOfBlock(newBlock);\r\n\t\t\t\taddBrToBlockIfNeeded(parentBlock);\r\n\r\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\r\n\t\t\t\t\temptyBlock(parentBlock);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewBlock.normalize();\r\n\r\n\t\t\t\t// New block might become empty if it's <p><b>a |</b></p>\r\n\t\t\t\tif (dom.isEmpty(newBlock)) {\r\n\t\t\t\t\tdom.remove(newBlock);\r\n\t\t\t\t\tinsertNewBlockAfter();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoveToCaretPosition(newBlock);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tdom.setAttrib(newBlock, 'id', ''); // Remove ID since it needs to be document unique\r\n\r\n\t\t\t// Allow custom handling of new blocks\r\n\t\t\teditor.fire('NewBlock', {newBlock: newBlock});\r\n\r\n\t\t\tundoManager.add();\r\n\t\t}\r\n\r\n\t\teditor.on('keydown', function(evt) {\r\n\t\t\tif (evt.keyCode == 13) {\r\n\t\t\t\tif (handleEnterKey(evt) !== false) {\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ForceBlocks.js\r\n\r\n/**\r\n * ForceBlocks.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Makes sure that everything gets wrapped in paragraphs.\r\n *\r\n * @private\r\n * @class tinymce.ForceBlocks\r\n */\r\ndefine(\"tinymce/ForceBlocks\", [], function() {\r\n\treturn function(editor) {\r\n\t\tvar settings = editor.settings, dom = editor.dom, selection = editor.selection;\r\n\t\tvar schema = editor.schema, blockElements = schema.getBlockElements();\r\n\r\n\t\tfunction addRootBlocks() {\r\n\t\t\tvar node = selection.getStart(), rootNode = editor.getBody(), rng;\r\n\t\t\tvar startContainer, startOffset, endContainer, endOffset, rootBlockNode;\r\n\t\t\tvar tempNode, offset = -0xFFFFFF, wrapped, restoreSelection;\r\n\t\t\tvar tmpRng, rootNodeName, forcedRootBlock;\r\n\r\n\t\t\tforcedRootBlock = settings.forced_root_block;\r\n\r\n\t\t\tif (!node || node.nodeType !== 1 || !forcedRootBlock) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if node is wrapped in block\r\n\t\t\twhile (node && node != rootNode) {\r\n\t\t\t\tif (blockElements[node.nodeName]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Get current selection\r\n\t\t\trng = selection.getRng();\r\n\t\t\tif (rng.setStart) {\r\n\t\t\t\tstartContainer = rng.startContainer;\r\n\t\t\t\tstartOffset = rng.startOffset;\r\n\t\t\t\tendContainer = rng.endContainer;\r\n\t\t\t\tendOffset = rng.endOffset;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\trestoreSelection = editor.getDoc().activeElement === rootNode;\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// IE throws unspecified error here sometimes\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Force control range into text range\r\n\t\t\t\tif (rng.item) {\r\n\t\t\t\t\tnode = rng.item(0);\r\n\t\t\t\t\trng = editor.getDoc().body.createTextRange();\r\n\t\t\t\t\trng.moveToElementText(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trestoreSelection = rng.parentElement().ownerDocument === editor.getDoc();\r\n\t\t\t\ttmpRng = rng.duplicate();\r\n\t\t\t\ttmpRng.collapse(true);\r\n\t\t\t\tstartOffset = tmpRng.move('character', offset) * -1;\r\n\r\n\t\t\t\tif (!tmpRng.collapsed) {\r\n\t\t\t\t\ttmpRng = rng.duplicate();\r\n\t\t\t\t\ttmpRng.collapse(false);\r\n\t\t\t\t\tendOffset = (tmpRng.move('character', offset) * -1) - startOffset;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Wrap non block elements and text nodes\r\n\t\t\tnode = rootNode.firstChild;\r\n\t\t\trootNodeName = rootNode.nodeName.toLowerCase();\r\n\t\t\twhile (node) {\r\n\t\t\t\t// TODO: Break this up, too complex\r\n\t\t\t\tif (((node.nodeType === 3 || (node.nodeType == 1 && !blockElements[node.nodeName]))) &&\r\n\t\t\t\t\tschema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase())) {\r\n\t\t\t\t\t// Remove empty text nodes\r\n\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length === 0) {\r\n\t\t\t\t\t\ttempNode = node;\r\n\t\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t\t\tdom.remove(tempNode);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!rootBlockNode) {\r\n\t\t\t\t\t\trootBlockNode = dom.create(forcedRootBlock, editor.settings.forced_root_block_attrs);\r\n\t\t\t\t\t\tnode.parentNode.insertBefore(rootBlockNode, node);\r\n\t\t\t\t\t\twrapped = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttempNode = node;\r\n\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t\trootBlockNode.appendChild(tempNode);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trootBlockNode = null;\r\n\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (wrapped && restoreSelection) {\r\n\t\t\t\tif (rng.setStart) {\r\n\t\t\t\t\trng.setStart(startContainer, startOffset);\r\n\t\t\t\t\trng.setEnd(endContainer, endOffset);\r\n\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Only select if the previous selection was inside the document to prevent auto focus in quirks mode\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\trng = editor.getDoc().body.createTextRange();\r\n\t\t\t\t\t\trng.moveToElementText(rootNode);\r\n\t\t\t\t\t\trng.collapse(true);\r\n\t\t\t\t\t\trng.moveStart('character', startOffset);\r\n\r\n\t\t\t\t\t\tif (endOffset > 0) {\r\n\t\t\t\t\t\t\trng.moveEnd('character', endOffset);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\trng.select();\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t// Ignore\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\teditor.nodeChanged();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Force root blocks\r\n\t\tif (settings.forced_root_block) {\r\n\t\t\teditor.on('NodeChange', addRootBlocks);\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/CaretUtils.js\r\n\r\n/**\r\n * CaretUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Utility functions shared by the caret logic.\r\n *\r\n * @private\r\n * @class tinymce.caret.CaretUtils\r\n */\r\ndefine(\"tinymce/caret/CaretUtils\", [\r\n\t\"tinymce/util/Fun\",\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/caret/CaretContainer\",\r\n\t\"tinymce/caret/CaretCandidate\"\r\n], function(Fun, TreeWalker, NodeType, CaretPosition, CaretContainer, CaretCandidate) {\r\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\r\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\r\n\t\tisBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption'),\r\n\t\tisCaretContainer = CaretContainer.isCaretContainer,\r\n\t\tcurry = Fun.curry,\r\n\t\tisElement = NodeType.isElement,\r\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate;\r\n\r\n\tfunction isForwards(direction) {\r\n\t\treturn direction > 0;\r\n\t}\r\n\r\n\tfunction isBackwards(direction) {\r\n\t\treturn direction < 0;\r\n\t}\r\n\r\n\tfunction findNode(node, direction, predicateFn, rootNode, shallow) {\r\n\t\tvar walker = new TreeWalker(node, rootNode);\r\n\r\n\t\tif (isBackwards(direction)) {\r\n\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\tnode = walker.prev(true);\r\n\t\t\t\tif (predicateFn(node)) {\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\twhile ((node = walker.prev(shallow))) {\r\n\t\t\t\tif (predicateFn(node)) {\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isForwards(direction)) {\r\n\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\tnode = walker.next(true);\r\n\t\t\t\tif (predicateFn(node)) {\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\twhile ((node = walker.next(shallow))) {\r\n\t\t\t\tif (predicateFn(node)) {\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction getEditingHost(node, rootNode) {\r\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\r\n\t\t\tif (isContentEditableTrue(node)) {\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn rootNode;\r\n\t}\r\n\r\n\tfunction getParentBlock(node, rootNode) {\r\n\t\twhile (node && node != rootNode) {\r\n\t\t\tif (isBlockLike(node)) {\r\n\t\t\t\treturn node;\r\n\t\t\t}\r\n\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction isInSameBlock(caretPosition1, caretPosition2, rootNode) {\r\n\t\treturn getParentBlock(caretPosition1.container(), rootNode) == getParentBlock(caretPosition2.container(), rootNode);\r\n\t}\r\n\r\n\tfunction isInSameEditingHost(caretPosition1, caretPosition2, rootNode) {\r\n\t\treturn getEditingHost(caretPosition1.container(), rootNode) == getEditingHost(caretPosition2.container(), rootNode);\r\n\t}\r\n\r\n\tfunction getChildNodeAtRelativeOffset(relativeOffset, caretPosition) {\r\n\t\tvar container, offset;\r\n\r\n\t\tif (!caretPosition) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tcontainer = caretPosition.container();\r\n\t\toffset = caretPosition.offset();\r\n\r\n\t\tif (!isElement(container)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn container.childNodes[offset + relativeOffset];\r\n\t}\r\n\r\n\tfunction beforeAfter(before, node) {\r\n\t\tvar range = node.ownerDocument.createRange();\r\n\r\n\t\tif (before) {\r\n\t\t\trange.setStartBefore(node);\r\n\t\t\trange.setEndBefore(node);\r\n\t\t} else {\r\n\t\t\trange.setStartAfter(node);\r\n\t\t\trange.setEndAfter(node);\r\n\t\t}\r\n\r\n\t\treturn range;\r\n\t}\r\n\r\n\tfunction isNodesInSameBlock(rootNode, node1, node2) {\r\n\t\treturn getParentBlock(node1, rootNode) == getParentBlock(node2, rootNode);\r\n\t}\r\n\r\n\tfunction lean(left, rootNode, node) {\r\n\t\tvar sibling, siblingName;\r\n\r\n\t\tif (left) {\r\n\t\t\tsiblingName = 'previousSibling';\r\n\t\t} else {\r\n\t\t\tsiblingName = 'nextSibling';\r\n\t\t}\r\n\r\n\t\twhile (node && node != rootNode) {\r\n\t\t\tsibling = node[siblingName];\r\n\r\n\t\t\tif (isCaretContainer(sibling)) {\r\n\t\t\t\tsibling = sibling[siblingName];\r\n\t\t\t}\r\n\r\n\t\t\tif (isContentEditableFalse(sibling)) {\r\n\t\t\t\tif (isNodesInSameBlock(rootNode, sibling, node)) {\r\n\t\t\t\t\treturn sibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (isCaretCandidate(sibling)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar before = curry(beforeAfter, true);\r\n\tvar after = curry(beforeAfter, false);\r\n\r\n\tfunction normalizeRange(direction, rootNode, range) {\r\n\t\tvar node, container, offset, location;\r\n\t\tvar leanLeft = curry(lean, true, rootNode);\r\n\t\tvar leanRight = curry(lean, false, rootNode);\r\n\r\n\t\tcontainer = range.startContainer;\r\n\t\toffset = range.startOffset;\r\n\r\n\t\tif (CaretContainer.isCaretContainerBlock(container)) {\r\n\t\t\tif (!isElement(container)) {\r\n\t\t\t\tcontainer = container.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tlocation = container.getAttribute('data-mce-caret');\r\n\r\n\t\t\tif (location == 'before') {\r\n\t\t\t\tnode = container.nextSibling;\r\n\t\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\t\treturn before(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (location == 'after') {\r\n\t\t\t\tnode = container.previousSibling;\r\n\t\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\t\treturn after(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!range.collapsed) {\r\n\t\t\treturn range;\r\n\t\t}\r\n\r\n\t\tif (NodeType.isText(container)) {\r\n\t\t\tif (isCaretContainer(container)) {\r\n\t\t\t\tif (direction === 1) {\r\n\t\t\t\t\tnode = leanRight(container);\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\treturn before(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = leanLeft(container);\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\treturn after(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (direction === -1) {\r\n\t\t\t\t\tnode = leanLeft(container);\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\treturn after(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = leanRight(container);\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\treturn before(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t}\r\n\r\n\t\t\tif (CaretContainer.endsWithCaretContainer(container) && offset >= container.data.length - 1) {\r\n\t\t\t\tif (direction === 1) {\r\n\t\t\t\t\tnode = leanRight(container);\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\treturn before(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t}\r\n\r\n\t\t\tif (CaretContainer.startsWithCaretContainer(container) && offset <= 1) {\r\n\t\t\t\tif (direction === -1) {\r\n\t\t\t\t\tnode = leanLeft(container);\r\n\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\treturn after(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t}\r\n\r\n\t\t\tif (offset === container.data.length) {\r\n\t\t\t\tnode = leanRight(container);\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\treturn before(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t}\r\n\r\n\t\t\tif (offset === 0) {\r\n\t\t\t\tnode = leanLeft(container);\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\treturn after(node);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn range;\r\n\t}\r\n\r\n\tfunction isNextToContentEditableFalse(relativeOffset, caretPosition) {\r\n\t\treturn isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset, caretPosition));\r\n\t}\r\n\r\n\treturn {\r\n\t\tisForwards: isForwards,\r\n\t\tisBackwards: isBackwards,\r\n\t\tfindNode: findNode,\r\n\t\tgetEditingHost: getEditingHost,\r\n\t\tgetParentBlock: getParentBlock,\r\n\t\tisInSameBlock: isInSameBlock,\r\n\t\tisInSameEditingHost: isInSameEditingHost,\r\n\t\tisBeforeContentEditableFalse: curry(isNextToContentEditableFalse, 0),\r\n\t\tisAfterContentEditableFalse: curry(isNextToContentEditableFalse, -1),\r\n\t\tnormalizeRange: normalizeRange\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/CaretWalker.js\r\n\r\n/**\r\n * CaretWalker.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module contains logic for moving around a virtual caret in logical order within a DOM element.\r\n *\r\n * It ignores the most obvious invalid caret locations such as within a script element or within a\r\n * contentEditable=false element but it will return locations that isn't possible to render visually.\r\n *\r\n * @private\r\n * @class tinymce.caret.CaretWalker\r\n * @example\r\n * var caretWalker = new CaretWalker(rootElm);\r\n *\r\n * var prevLogicalCaretPosition = caretWalker.prev(CaretPosition.fromRangeStart(range));\r\n * var nextLogicalCaretPosition = caretWalker.next(CaretPosition.fromRangeEnd(range));\r\n */\r\ndefine(\"tinymce/caret/CaretWalker\", [\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/caret/CaretCandidate\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/caret/CaretUtils\",\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/util/Fun\"\r\n], function(NodeType, CaretCandidate, CaretPosition, CaretUtils, Arr, Fun) {\r\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\r\n\t\tisText = NodeType.isText,\r\n\t\tisElement = NodeType.isElement,\r\n\t\tisBr = NodeType.isBr,\r\n\t\tisForwards = CaretUtils.isForwards,\r\n\t\tisBackwards = CaretUtils.isBackwards,\r\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\r\n\t\tisAtomic = CaretCandidate.isAtomic,\r\n\t\tisEditableCaretCandidate = CaretCandidate.isEditableCaretCandidate;\r\n\r\n\tfunction getParents(node, rootNode) {\r\n\t\tvar parents = [];\r\n\r\n\t\twhile (node && node != rootNode) {\r\n\t\t\tparents.push(node);\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\r\n\t\treturn parents;\r\n\t}\r\n\r\n\tfunction nodeAtIndex(container, offset) {\r\n\t\tif (container.hasChildNodes() && offset < container.childNodes.length) {\r\n\t\t\treturn container.childNodes[offset];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction getCaretCandidatePosition(direction, node) {\r\n\t\tif (isForwards(direction)) {\r\n\t\t\tif (isCaretCandidate(node.previousSibling) && !isText(node.previousSibling)) {\r\n\t\t\t\treturn CaretPosition.before(node);\r\n\t\t\t}\r\n\r\n\t\t\tif (isText(node)) {\r\n\t\t\t\treturn CaretPosition(node, 0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isBackwards(direction)) {\r\n\t\t\tif (isCaretCandidate(node.nextSibling) && !isText(node.nextSibling)) {\r\n\t\t\t\treturn CaretPosition.after(node);\r\n\t\t\t}\r\n\r\n\t\t\tif (isText(node)) {\r\n\t\t\t\treturn CaretPosition(node, node.data.length);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isBackwards(direction)) {\r\n\t\t\tif (isBr(node)) {\r\n\t\t\t\treturn CaretPosition.before(node);\r\n\t\t\t}\r\n\r\n\t\t\treturn CaretPosition.after(node);\r\n\t\t}\r\n\r\n\t\treturn CaretPosition.before(node);\r\n\t}\r\n\r\n\t// Jumps over BR elements <p>|<br></p><p>a</p> -> <p><br></p><p>|a</p>\r\n\tfunction isBrBeforeBlock(node, rootNode) {\r\n\t\tvar next;\r\n\r\n\t\tif (!NodeType.isBr(node)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tnext = findCaretPosition(1, CaretPosition.after(node), rootNode);\r\n\t\tif (!next) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn !CaretUtils.isInSameBlock(CaretPosition.before(node), CaretPosition.before(next), rootNode);\r\n\t}\r\n\r\n\tfunction findCaretPosition(direction, startCaretPosition, rootNode) {\r\n\t\tvar container, offset, node, nextNode, innerNode,\r\n\t\t\trootContentEditableFalseElm, caretPosition;\r\n\r\n\t\tif (!isElement(rootNode) || !startCaretPosition) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tcaretPosition = startCaretPosition;\r\n\t\tcontainer = caretPosition.container();\r\n\t\toffset = caretPosition.offset();\r\n\r\n\t\tif (isText(container)) {\r\n\t\t\tif (isBackwards(direction) && offset > 0) {\r\n\t\t\t\treturn CaretPosition(container, --offset);\r\n\t\t\t}\r\n\r\n\t\t\tif (isForwards(direction) && offset < container.length) {\r\n\t\t\t\treturn CaretPosition(container, ++offset);\r\n\t\t\t}\r\n\r\n\t\t\tnode = container;\r\n\t\t} else {\r\n\t\t\tif (isBackwards(direction) && offset > 0) {\r\n\t\t\t\tnextNode = nodeAtIndex(container, offset - 1);\r\n\t\t\t\tif (isCaretCandidate(nextNode)) {\r\n\t\t\t\t\tif (!isAtomic(nextNode)) {\r\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\r\n\t\t\t\t\t\tif (innerNode) {\r\n\t\t\t\t\t\t\tif (isText(innerNode)) {\r\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, innerNode.data.length);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn CaretPosition.after(innerNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (isText(nextNode)) {\r\n\t\t\t\t\t\treturn CaretPosition(nextNode, nextNode.data.length);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn CaretPosition.before(nextNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (isForwards(direction) && offset < container.childNodes.length) {\r\n\t\t\t\tnextNode = nodeAtIndex(container, offset);\r\n\t\t\t\tif (isCaretCandidate(nextNode)) {\r\n\t\t\t\t\tif (isBrBeforeBlock(nextNode, rootNode)) {\r\n\t\t\t\t\t\treturn findCaretPosition(direction, CaretPosition.after(nextNode), rootNode);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!isAtomic(nextNode)) {\r\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\r\n\t\t\t\t\t\tif (innerNode) {\r\n\t\t\t\t\t\t\tif (isText(innerNode)) {\r\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, 0);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn CaretPosition.before(innerNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (isText(nextNode)) {\r\n\t\t\t\t\t\treturn CaretPosition(nextNode, 0);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn CaretPosition.after(nextNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tnode = caretPosition.getNode();\r\n\t\t}\r\n\r\n\t\tif ((isForwards(direction) && caretPosition.isAtEnd()) || (isBackwards(direction) && caretPosition.isAtStart())) {\r\n\t\t\tnode = CaretUtils.findNode(node, direction, Fun.constant(true), rootNode, true);\r\n\t\t\tif (isEditableCaretCandidate(node)) {\r\n\t\t\t\treturn getCaretCandidatePosition(direction, node);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tnextNode = CaretUtils.findNode(node, direction, isEditableCaretCandidate, rootNode);\r\n\r\n\t\trootContentEditableFalseElm = Arr.last(Arr.filter(getParents(container, rootNode), isContentEditableFalse));\r\n\t\tif (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\r\n\t\t\tif (isForwards(direction)) {\r\n\t\t\t\tcaretPosition = CaretPosition.after(rootContentEditableFalseElm);\r\n\t\t\t} else {\r\n\t\t\t\tcaretPosition = CaretPosition.before(rootContentEditableFalseElm);\r\n\t\t\t}\r\n\r\n\t\t\treturn caretPosition;\r\n\t\t}\r\n\r\n\t\tif (nextNode) {\r\n\t\t\treturn getCaretCandidatePosition(direction, nextNode);\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn function(rootNode) {\r\n\t\treturn {\r\n\t\t\t/**\r\n\t\t\t * Returns the next logical caret position from the specificed input\r\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\r\n\t\t\t * at the end specified root element.\r\n\t\t\t *\r\n\t\t\t * @method next\r\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\r\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\r\n\t\t\t */\r\n\t\t\tnext: function(caretPosition) {\r\n\t\t\t\treturn findCaretPosition(1, caretPosition, rootNode);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Returns the previous logical caret position from the specificed input\r\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\r\n\t\t\t * at the end specified root element.\r\n\t\t\t *\r\n\t\t\t * @method prev\r\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\r\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\r\n\t\t\t */\r\n\t\t\tprev: function(caretPosition) {\r\n\t\t\t\treturn findCaretPosition(-1, caretPosition, rootNode);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/InsertList.js\r\n\r\n/**\r\n * InsertList.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Handles inserts of lists into the editor instance.\r\n *\r\n * @class tinymce.InsertList\r\n * @private\r\n */\r\ndefine(\"tinymce/InsertList\", [\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/caret/CaretWalker\",\r\n\t\"tinymce/caret/CaretPosition\"\r\n], function(Tools, CaretWalker, CaretPosition) {\r\n\tvar isListFragment = function(fragment) {\r\n\t\tvar firstChild = fragment.firstChild;\r\n\t\tvar lastChild = fragment.lastChild;\r\n\r\n\t\t// Skip meta since it's likely <meta><ul>..</ul>\r\n\t\tif (firstChild && firstChild.name === 'meta') {\r\n\t\t\tfirstChild = firstChild.next;\r\n\t\t}\r\n\r\n\t\t// Skip mce_marker since it's likely <ul>..</ul><span id=\"mce_marker\"></span>\r\n\t\tif (lastChild && lastChild.attr('id') === 'mce_marker') {\r\n\t\t\tlastChild = lastChild.prev;\r\n\t\t}\r\n\r\n\t\tif (!firstChild || firstChild !== lastChild) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn firstChild.name === 'ul' || firstChild.name === 'ol';\r\n\t};\r\n\r\n\tvar cleanupDomFragment = function (domFragment) {\r\n\t\tvar firstChild = domFragment.firstChild;\r\n\t\tvar lastChild = domFragment.lastChild;\r\n\r\n\t\t// TODO: remove the meta tag from paste logic\r\n\t\tif (firstChild && firstChild.nodeName === 'META') {\r\n\t\t\tfirstChild.parentNode.removeChild(firstChild);\r\n\t\t}\r\n\r\n\t\tif (lastChild && lastChild.id === 'mce_marker') {\r\n\t\t\tlastChild.parentNode.removeChild(lastChild);\r\n\t\t}\r\n\r\n\t\treturn domFragment;\r\n\t};\r\n\r\n\tvar toDomFragment = function(dom, serializer, fragment) {\r\n\t\tvar html = serializer.serialize(fragment);\r\n\t\tvar domFragment = dom.createFragment(html);\r\n\r\n\t\treturn cleanupDomFragment(domFragment);\r\n\t};\r\n\r\n\tvar listItems = function(elm) {\r\n\t\treturn Tools.grep(elm.childNodes, function(child) {\r\n\t\t\treturn child.nodeName === 'LI';\r\n\t\t});\r\n\t};\r\n\r\n\tvar isEmpty = function (elm) {\r\n\t\treturn !elm.firstChild;\r\n\t};\r\n\r\n\tvar trimListItems = function(elms) {\r\n\t\treturn elms.length > 0 && isEmpty(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\r\n\t};\r\n\r\n\tvar getParentLi = function(dom, node) {\r\n\t\tvar parentBlock = dom.getParent(node, dom.isBlock);\r\n\t\treturn parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\r\n\t};\r\n\r\n\tvar isParentBlockLi = function(dom, node) {\r\n\t\treturn !!getParentLi(dom, node);\r\n\t};\r\n\r\n\tvar getSplit = function(parentNode, rng) {\r\n\t\tvar beforeRng = rng.cloneRange();\r\n\t\tvar afterRng = rng.cloneRange();\r\n\r\n\t\tbeforeRng.setStartBefore(parentNode);\r\n\t\tafterRng.setEndAfter(parentNode);\r\n\r\n\t\treturn [\r\n\t\t\tbeforeRng.cloneContents(),\r\n\t\t\tafterRng.cloneContents()\r\n\t\t];\r\n\t};\r\n\r\n\tvar findFirstIn = function(node, rootNode) {\r\n\t\tvar caretPos = CaretPosition.before(node);\r\n\t\tvar caretWalker = new CaretWalker(rootNode);\r\n\t\tvar newCaretPos = caretWalker.next(caretPos);\r\n\r\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\r\n\t};\r\n\r\n\tvar findLastOf = function(node, rootNode) {\r\n\t\tvar caretPos = CaretPosition.after(node);\r\n\t\tvar caretWalker = new CaretWalker(rootNode);\r\n\t\tvar newCaretPos = caretWalker.prev(caretPos);\r\n\r\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\r\n\t};\r\n\r\n\tvar insertMiddle = function(target, elms, rootNode, rng) {\r\n\t\tvar parts = getSplit(target, rng);\r\n\t\tvar parentElm = target.parentNode;\r\n\r\n\t\tparentElm.insertBefore(parts[0], target);\r\n\t\tTools.each(elms, function(li) {\r\n\t\t\tparentElm.insertBefore(li, target);\r\n\t\t});\r\n\t\tparentElm.insertBefore(parts[1], target);\r\n\t\tparentElm.removeChild(target);\r\n\r\n\t\treturn findLastOf(elms[elms.length - 1], rootNode);\r\n\t};\r\n\r\n\tvar insertBefore = function(target, elms, rootNode) {\r\n\t\tvar parentElm = target.parentNode;\r\n\r\n\t\tTools.each(elms, function(elm) {\r\n\t\t\tparentElm.insertBefore(elm, target);\r\n\t\t});\r\n\r\n\t\treturn findFirstIn(target, rootNode);\r\n\t};\r\n\r\n\tvar insertAfter = function(target, elms, rootNode, dom) {\r\n\t\tdom.insertAfter(elms.reverse(), target);\r\n\t\treturn findLastOf(elms[0], rootNode);\r\n\t};\r\n\r\n\tvar insertAtCaret = function(serializer, dom, rng, fragment) {\r\n\t\tvar domFragment = toDomFragment(dom, serializer, fragment);\r\n\t\tvar liTarget = getParentLi(dom, rng.startContainer);\r\n\t\tvar liElms = trimListItems(listItems(domFragment.firstChild));\r\n\t\tvar BEGINNING = 1, END = 2;\r\n\t\tvar rootNode = dom.getRoot();\r\n\r\n\t\tvar isAt = function(location) {\r\n\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\r\n\t\t\tvar caretWalker = new CaretWalker(dom.getRoot());\r\n\t\t\tvar newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\r\n\r\n\t\t\treturn newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\r\n\t\t};\r\n\r\n\t\tif (isAt(BEGINNING)) {\r\n\t\t\treturn insertBefore(liTarget, liElms, rootNode);\r\n\t\t} else if (isAt(END)) {\r\n\t\t\treturn insertAfter(liTarget, liElms, rootNode, dom);\r\n\t\t}\r\n\r\n\t\treturn insertMiddle(liTarget, liElms, rootNode, rng);\r\n\t};\r\n\r\n\treturn {\r\n\t\tisListFragment: isListFragment,\r\n\t\tinsertAtCaret: insertAtCaret,\r\n\t\tisParentBlockLi: isParentBlockLi,\r\n\t\ttrimListItems: trimListItems,\r\n\t\tlistItems: listItems\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/InsertContent.js\r\n\r\n/**\r\n * InsertContent.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Handles inserts of contents into the editor instance.\r\n *\r\n * @class tinymce.InsertContent\r\n * @private\r\n */\r\ndefine(\"tinymce/InsertContent\", [\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/html/Serializer\",\r\n\t\"tinymce/caret/CaretWalker\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/dom/ElementUtils\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/InsertList\"\r\n], function(Env, Tools, Serializer, CaretWalker, CaretPosition, ElementUtils, NodeType, InsertList) {\r\n\tvar isTableCell = NodeType.matchNodeNames('td th');\r\n\r\n\tvar insertHtmlAtCaret = function(editor, value, details) {\r\n\t\tvar parser, serializer, parentNode, rootNode, fragment, args;\r\n\t\tvar marker, rng, node, node2, bookmarkHtml, merge;\r\n\t\tvar textInlineElements = editor.schema.getTextInlineElements();\r\n\t\tvar selection = editor.selection, dom = editor.dom;\r\n\r\n\t\tfunction trimOrPaddLeftRight(html) {\r\n\t\t\tvar rng, container, offset;\r\n\r\n\t\t\trng = selection.getRng(true);\r\n\t\t\tcontainer = rng.startContainer;\r\n\t\t\toffset = rng.startOffset;\r\n\r\n\t\t\tfunction hasSiblingText(siblingName) {\r\n\t\t\t\treturn container[siblingName] && container[siblingName].nodeType == 3;\r\n\t\t\t}\r\n\r\n\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\tif (offset > 0) {\r\n\t\t\t\t\thtml = html.replace(/^&nbsp;/, ' ');\r\n\t\t\t\t} else if (!hasSiblingText('previousSibling')) {\r\n\t\t\t\t\thtml = html.replace(/^ /, '&nbsp;');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (offset < container.length) {\r\n\t\t\t\t\thtml = html.replace(/&nbsp;(<br>|)$/, ' ');\r\n\t\t\t\t} else if (!hasSiblingText('nextSibling')) {\r\n\t\t\t\t\thtml = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn html;\r\n\t\t}\r\n\r\n\t\t// Removes &nbsp; from a [b] c -> a &nbsp;c -> a c\r\n\t\tfunction trimNbspAfterDeleteAndPaddValue() {\r\n\t\t\tvar rng, container, offset;\r\n\r\n\t\t\trng = selection.getRng(true);\r\n\t\t\tcontainer = rng.startContainer;\r\n\t\t\toffset = rng.startOffset;\r\n\r\n\t\t\tif (container.nodeType == 3 && rng.collapsed) {\r\n\t\t\t\tif (container.data[offset] === '\\u00a0') {\r\n\t\t\t\t\tcontainer.deleteData(offset, 1);\r\n\r\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\r\n\t\t\t\t\t\tvalue += ' ';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (container.data[offset - 1] === '\\u00a0') {\r\n\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\r\n\r\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\r\n\t\t\t\t\t\tvalue = ' ' + value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction reduceInlineTextElements() {\r\n\t\t\tif (merge) {\r\n\t\t\t\tvar root = editor.getBody(), elementUtils = new ElementUtils(dom);\r\n\r\n\t\t\t\tTools.each(dom.select('*[data-mce-fragment]'), function(node) {\r\n\t\t\t\t\tfor (var testNode = node.parentNode; testNode && testNode != root; testNode = testNode.parentNode) {\r\n\t\t\t\t\t\tif (textInlineElements[node.nodeName.toLowerCase()] && elementUtils.compare(testNode, node)) {\r\n\t\t\t\t\t\t\tdom.remove(node, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction markFragmentElements(fragment) {\r\n\t\t\tvar node = fragment;\r\n\r\n\t\t\twhile ((node = node.walk())) {\r\n\t\t\t\tif (node.type === 1) {\r\n\t\t\t\t\tnode.attr('data-mce-fragment', '1');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction umarkFragmentElements(elm) {\r\n\t\t\tTools.each(elm.getElementsByTagName('*'), function(elm) {\r\n\t\t\t\telm.removeAttribute('data-mce-fragment');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction isPartOfFragment(node) {\r\n\t\t\treturn !!node.getAttribute('data-mce-fragment');\r\n\t\t}\r\n\r\n\t\tfunction canHaveChildren(node) {\r\n\t\t\treturn node && !editor.schema.getShortEndedElements()[node.nodeName];\r\n\t\t}\r\n\r\n\t\tfunction moveSelectionToMarker(marker) {\r\n\t\t\tvar parentEditableFalseElm, parentBlock, nextRng;\r\n\r\n\t\t\tfunction getContentEditableFalseParent(node) {\r\n\t\t\t\tvar root = editor.getBody();\r\n\r\n\t\t\t\tfor (; node && node !== root; node = node.parentNode) {\r\n\t\t\t\t\tif (editor.dom.getContentEditable(node) === 'false') {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (!marker) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tselection.scrollIntoView(marker);\r\n\r\n\t\t\t// If marker is in cE=false then move selection to that element instead\r\n\t\t\tparentEditableFalseElm = getContentEditableFalseParent(marker);\r\n\t\t\tif (parentEditableFalseElm) {\r\n\t\t\t\tdom.remove(marker);\r\n\t\t\t\tselection.select(parentEditableFalseElm);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Move selection before marker and remove it\r\n\t\t\trng = dom.createRng();\r\n\r\n\t\t\t// If previous sibling is a text node set the selection to the end of that node\r\n\t\t\tnode = marker.previousSibling;\r\n\t\t\tif (node && node.nodeType == 3) {\r\n\t\t\t\trng.setStart(node, node.nodeValue.length);\r\n\r\n\t\t\t\t// TODO: Why can't we normalize on IE\r\n\t\t\t\tif (!Env.ie) {\r\n\t\t\t\t\tnode2 = marker.nextSibling;\r\n\t\t\t\t\tif (node2 && node2.nodeType == 3) {\r\n\t\t\t\t\t\tnode.appendData(node2.data);\r\n\t\t\t\t\t\tnode2.parentNode.removeChild(node2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// If the previous sibling isn't a text node or doesn't exist set the selection before the marker node\r\n\t\t\t\trng.setStartBefore(marker);\r\n\t\t\t\trng.setEndBefore(marker);\r\n\t\t\t}\r\n\r\n\t\t\tfunction findNextCaretRng(rng) {\r\n\t\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\r\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\r\n\r\n\t\t\t\tcaretPos = caretWalker.next(caretPos);\r\n\t\t\t\tif (caretPos) {\r\n\t\t\t\t\treturn caretPos.toRange();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the marker node and set the new range\r\n\t\t\tparentBlock = dom.getParent(marker, dom.isBlock);\r\n\t\t\tdom.remove(marker);\r\n\r\n\t\t\tif (parentBlock && dom.isEmpty(parentBlock)) {\r\n\t\t\t\teditor.$(parentBlock).empty();\r\n\r\n\t\t\t\trng.setStart(parentBlock, 0);\r\n\t\t\t\trng.setEnd(parentBlock, 0);\r\n\r\n\t\t\t\tif (!isTableCell(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\r\n\t\t\t\t\trng = nextRng;\r\n\t\t\t\t\tdom.remove(parentBlock);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdom.add(parentBlock, dom.create('br', {'data-mce-bogus': '1'}));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tselection.setRng(rng);\r\n\t\t}\r\n\r\n\t\t// Check for whitespace before/after value\r\n\t\tif (/^ | $/.test(value)) {\r\n\t\t\tvalue = trimOrPaddLeftRight(value);\r\n\t\t}\r\n\r\n\t\t// Setup parser and serializer\r\n\t\tparser = editor.parser;\r\n\t\tmerge = details.merge;\r\n\r\n\t\tserializer = new Serializer({\r\n\t\t\tvalidate: editor.settings.validate\r\n\t\t}, editor.schema);\r\n\t\tbookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;&#x200B;</span>';\r\n\r\n\t\t// Run beforeSetContent handlers on the HTML to be inserted\r\n\t\targs = {content: value, format: 'html', selection: true};\r\n\t\teditor.fire('BeforeSetContent', args);\r\n\t\tvalue = args.content;\r\n\r\n\t\t// Add caret at end of contents if it's missing\r\n\t\tif (value.indexOf('{$caret}') == -1) {\r\n\t\t\tvalue += '{$caret}';\r\n\t\t}\r\n\r\n\t\t// Replace the caret marker with a span bookmark element\r\n\t\tvalue = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\r\n\r\n\t\t// If selection is at <body>|<p></p> then move it into <body><p>|</p>\r\n\t\trng = selection.getRng();\r\n\t\tvar caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\r\n\t\tvar body = editor.getBody();\r\n\t\tif (caretElement === body && selection.isCollapsed()) {\r\n\t\t\tif (dom.isBlock(body.firstChild) && canHaveChildren(body.firstChild) && dom.isEmpty(body.firstChild)) {\r\n\t\t\t\trng = dom.createRng();\r\n\t\t\t\trng.setStart(body.firstChild, 0);\r\n\t\t\t\trng.setEnd(body.firstChild, 0);\r\n\t\t\t\tselection.setRng(rng);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Insert node maker where we will insert the new HTML and get it's parent\r\n\t\tif (!selection.isCollapsed()) {\r\n\t\t\t// Fix for #2595 seems that delete removes one extra character on\r\n\t\t\t// WebKit for some odd reason if you double click select a word\r\n\t\t\teditor.selection.setRng(editor.selection.getRng());\r\n\t\t\teditor.getDoc().execCommand('Delete', false, null);\r\n\t\t\ttrimNbspAfterDeleteAndPaddValue();\r\n\t\t}\r\n\r\n\t\tparentNode = selection.getNode();\r\n\r\n\t\t// Parse the fragment within the context of the parent node\r\n\t\tvar parserArgs = {context: parentNode.nodeName.toLowerCase(), data: details.data};\r\n\t\tfragment = parser.parse(value, parserArgs);\r\n\r\n\t\t// Custom handling of lists\r\n\t\tif (InsertList.isListFragment(fragment) && InsertList.isParentBlockLi(dom, parentNode)) {\r\n\t\t\trng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(), fragment);\r\n\t\t\teditor.selection.setRng(rng);\r\n\t\t\teditor.fire('SetContent', args);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tmarkFragmentElements(fragment);\r\n\r\n\t\t// Move the caret to a more suitable location\r\n\t\tnode = fragment.lastChild;\r\n\t\tif (node.attr('id') == 'mce_marker') {\r\n\t\t\tmarker = node;\r\n\r\n\t\t\tfor (node = node.prev; node; node = node.walk(true)) {\r\n\t\t\t\tif (node.type == 3 || !dom.isBlock(node.name)) {\r\n\t\t\t\t\tif (editor.schema.isValidChild(node.parent.name, 'span')) {\r\n\t\t\t\t\t\tnode.parent.insert(marker, node, node.name === 'br');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\teditor._selectionOverrides.showBlockCaretContainer(parentNode);\r\n\r\n\t\t// If parser says valid we can insert the contents into that parent\r\n\t\tif (!parserArgs.invalid) {\r\n\t\t\tvalue = serializer.serialize(fragment);\r\n\r\n\t\t\t// Check if parent is empty or only has one BR element then set the innerHTML of that parent\r\n\t\t\tnode = parentNode.firstChild;\r\n\t\t\tnode2 = parentNode.lastChild;\r\n\t\t\tif (!node || (node === node2 && node.nodeName === 'BR')) {\r\n\t\t\t\tdom.setHTML(parentNode, value);\r\n\t\t\t} else {\r\n\t\t\t\tselection.setContent(value);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// If the fragment was invalid within that context then we need\r\n\t\t\t// to parse and process the parent it's inserted into\r\n\r\n\t\t\t// Insert bookmark node and get the parent\r\n\t\t\tselection.setContent(bookmarkHtml);\r\n\t\t\tparentNode = selection.getNode();\r\n\t\t\trootNode = editor.getBody();\r\n\r\n\t\t\t// Opera will return the document node when selection is in root\r\n\t\t\tif (parentNode.nodeType == 9) {\r\n\t\t\t\tparentNode = node = rootNode;\r\n\t\t\t} else {\r\n\t\t\t\tnode = parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Find the ancestor just before the root element\r\n\t\t\twhile (node !== rootNode) {\r\n\t\t\t\tparentNode = node;\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\t// Get the outer/inner HTML depending on if we are in the root and parser and serialize that\r\n\t\t\tvalue = parentNode == rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\r\n\t\t\tvalue = serializer.serialize(\r\n\t\t\t\tparser.parse(\r\n\t\t\t\t\t// Need to replace by using a function since $ in the contents would otherwise be a problem\r\n\t\t\t\t\tvalue.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function() {\r\n\t\t\t\t\t\treturn serializer.serialize(fragment);\r\n\t\t\t\t\t})\r\n\t\t\t\t)\r\n\t\t\t);\r\n\r\n\t\t\t// Set the inner/outer HTML depending on if we are in the root or not\r\n\t\t\tif (parentNode == rootNode) {\r\n\t\t\t\tdom.setHTML(rootNode, value);\r\n\t\t\t} else {\r\n\t\t\t\tdom.setOuterHTML(parentNode, value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treduceInlineTextElements();\r\n\t\tmoveSelectionToMarker(dom.get('mce_marker'));\r\n\t\tumarkFragmentElements(editor.getBody());\r\n\t\teditor.fire('SetContent', args);\r\n\t\teditor.addVisual();\r\n\t};\r\n\r\n\tvar processValue = function (value) {\r\n\t\tvar details;\r\n\r\n\t\tif (typeof value !== 'string') {\r\n\t\t\tdetails = Tools.extend({\r\n\t\t\t\tpaste: value.paste,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tpaste: value.paste\r\n\t\t\t\t}\r\n\t\t\t}, value);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tcontent: value.content,\r\n\t\t\t\tdetails: details\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tcontent: value,\r\n\t\t\tdetails: {}\r\n\t\t};\r\n\t};\r\n\r\n\tvar insertAtCaret = function (editor, value) {\r\n\t\tvar result = processValue(value);\r\n\t\tinsertHtmlAtCaret(editor, result.content, result.details);\r\n\t};\r\n\r\n\treturn {\r\n\t\tinsertAtCaret: insertAtCaret\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/EditorCommands.js\r\n\r\n/**\r\n * EditorCommands.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class enables you to add custom editor commands and it contains\r\n * overrides for native browser commands to address various bugs and issues.\r\n *\r\n * @class tinymce.EditorCommands\r\n */\r\ndefine(\"tinymce/EditorCommands\", [\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/InsertContent\"\r\n], function(Env, Tools, RangeUtils, TreeWalker, InsertContent) {\r\n\t// Added for compression purposes\r\n\tvar each = Tools.each, extend = Tools.extend;\r\n\tvar map = Tools.map, inArray = Tools.inArray, explode = Tools.explode;\r\n\tvar isOldIE = Env.ie && Env.ie < 11;\r\n\tvar TRUE = true, FALSE = false;\r\n\r\n\treturn function(editor) {\r\n\t\tvar dom, selection, formatter,\r\n\t\t\tcommands = {state: {}, exec: {}, value: {}},\r\n\t\t\tsettings = editor.settings,\r\n\t\t\tbookmark;\r\n\r\n\t\teditor.on('PreInit', function() {\r\n\t\t\tdom = editor.dom;\r\n\t\t\tselection = editor.selection;\r\n\t\t\tsettings = editor.settings;\r\n\t\t\tformatter = editor.formatter;\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * Executes the specified command.\r\n\t\t *\r\n\t\t * @method execCommand\r\n\t\t * @param {String} command Command to execute.\r\n\t\t * @param {Boolean} ui Optional user interface state.\r\n\t\t * @param {Object} value Optional value for command.\r\n\t\t * @param {Object} args Optional extra arguments to the execCommand.\r\n\t\t * @return {Boolean} true/false if the command was found or not.\r\n\t\t */\r\n\t\tfunction execCommand(command, ui, value, args) {\r\n\t\t\tvar func, customCommand, state = 0;\r\n\r\n\t\t\tif (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\r\n\t\t\t\teditor.focus();\r\n\t\t\t}\r\n\r\n\t\t\targs = editor.fire('BeforeExecCommand', {command: command, ui: ui, value: value});\r\n\t\t\tif (args.isDefaultPrevented()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tcustomCommand = command.toLowerCase();\r\n\t\t\tif ((func = commands.exec[customCommand])) {\r\n\t\t\t\tfunc(customCommand, ui, value);\r\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Plugin commands\r\n\t\t\teach(editor.plugins, function(p) {\r\n\t\t\t\tif (p.execCommand && p.execCommand(command, ui, value)) {\r\n\t\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\r\n\t\t\t\t\tstate = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (state) {\r\n\t\t\t\treturn state;\r\n\t\t\t}\r\n\r\n\t\t\t// Theme commands\r\n\t\t\tif (editor.theme && editor.theme.execCommand && editor.theme.execCommand(command, ui, value)) {\r\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\tstate = editor.getDoc().execCommand(command, ui, value);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore old IE errors\r\n\t\t\t}\r\n\r\n\t\t\tif (state) {\r\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Queries the current state for a command for example if the current selection is \"bold\".\r\n\t\t *\r\n\t\t * @method queryCommandState\r\n\t\t * @param {String} command Command to check the state of.\r\n\t\t * @return {Boolean/Number} true/false if the selected contents is bold or not, -1 if it's not found.\r\n\t\t */\r\n\t\tfunction queryCommandState(command) {\r\n\t\t\tvar func;\r\n\r\n\t\t\t// Is hidden then return undefined\r\n\t\t\tif (editor.quirks.isHidden()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif ((func = commands.state[command])) {\r\n\t\t\t\treturn func(command);\r\n\t\t\t}\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\treturn editor.getDoc().queryCommandState(command);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Fails sometimes see bug: 1896577\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Queries the command value for example the current fontsize.\r\n\t\t *\r\n\t\t * @method queryCommandValue\r\n\t\t * @param {String} command Command to check the value of.\r\n\t\t * @return {Object} Command value of false if it's not found.\r\n\t\t */\r\n\t\tfunction queryCommandValue(command) {\r\n\t\t\tvar func;\r\n\r\n\t\t\t// Is hidden then return undefined\r\n\t\t\tif (editor.quirks.isHidden()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tif ((func = commands.value[command])) {\r\n\t\t\t\treturn func(command);\r\n\t\t\t}\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\treturn editor.getDoc().queryCommandValue(command);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Fails sometimes see bug: 1896577\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Adds commands to the command collection.\r\n\t\t *\r\n\t\t * @method addCommands\r\n\t\t * @param {Object} command_list Name/value collection with commands to add, the names can also be comma separated.\r\n\t\t * @param {String} type Optional type to add, defaults to exec. Can be value or state as well.\r\n\t\t */\r\n\t\tfunction addCommands(command_list, type) {\r\n\t\t\ttype = type || 'exec';\r\n\r\n\t\t\teach(command_list, function(callback, command) {\r\n\t\t\t\teach(command.toLowerCase().split(','), function(command) {\r\n\t\t\t\t\tcommands[type][command] = callback;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction addCommand(command, callback, scope) {\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tcommands.exec[command] = function(command, ui, value, args) {\r\n\t\t\t\treturn callback.call(scope || editor, ui, value, args);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the command is supported or not.\r\n\t\t *\r\n\t\t * @method queryCommandSupported\r\n\t\t * @param {String} command Command that we check support for.\r\n\t\t * @return {Boolean} true/false if the command is supported or not.\r\n\t\t */\r\n\t\tfunction queryCommandSupported(command) {\r\n\t\t\tcommand = command.toLowerCase();\r\n\r\n\t\t\tif (commands.exec[command]) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Browser commands\r\n\t\t\ttry {\r\n\t\t\t\treturn editor.getDoc().queryCommandSupported(command);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Fails sometimes see bug: 1896577\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction addQueryStateHandler(command, callback, scope) {\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tcommands.state[command] = function() {\r\n\t\t\t\treturn callback.call(scope || editor);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction addQueryValueHandler(command, callback, scope) {\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\tcommands.value[command] = function() {\r\n\t\t\t\treturn callback.call(scope || editor);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction hasCustomCommand(command) {\r\n\t\t\tcommand = command.toLowerCase();\r\n\t\t\treturn !!commands.exec[command];\r\n\t\t}\r\n\r\n\t\t// Expose public methods\r\n\t\textend(this, {\r\n\t\t\texecCommand: execCommand,\r\n\t\t\tqueryCommandState: queryCommandState,\r\n\t\t\tqueryCommandValue: queryCommandValue,\r\n\t\t\tqueryCommandSupported: queryCommandSupported,\r\n\t\t\taddCommands: addCommands,\r\n\t\t\taddCommand: addCommand,\r\n\t\t\taddQueryStateHandler: addQueryStateHandler,\r\n\t\t\taddQueryValueHandler: addQueryValueHandler,\r\n\t\t\thasCustomCommand: hasCustomCommand\r\n\t\t});\r\n\r\n\t\t// Private methods\r\n\r\n\t\tfunction execNativeCommand(command, ui, value) {\r\n\t\t\tif (ui === undefined) {\r\n\t\t\t\tui = FALSE;\r\n\t\t\t}\r\n\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t}\r\n\r\n\t\t\treturn editor.getDoc().execCommand(command, ui, value);\r\n\t\t}\r\n\r\n\t\tfunction isFormatMatch(name) {\r\n\t\t\treturn formatter.match(name);\r\n\t\t}\r\n\r\n\t\tfunction toggleFormat(name, value) {\r\n\t\t\tformatter.toggle(name, value ? {value: value} : undefined);\r\n\t\t\teditor.nodeChanged();\r\n\t\t}\r\n\r\n\t\tfunction storeSelection(type) {\r\n\t\t\tbookmark = selection.getBookmark(type);\r\n\t\t}\r\n\r\n\t\tfunction restoreSelection() {\r\n\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t}\r\n\r\n\t\t// Add execCommand overrides\r\n\t\taddCommands({\r\n\t\t\t// Ignore these, added for compatibility\r\n\t\t\t'mceResetDesignMode,mceBeginUndoLevel': function() {},\r\n\r\n\t\t\t// Add undo manager logic\r\n\t\t\t'mceEndUndoLevel,mceAddUndoLevel': function() {\r\n\t\t\t\teditor.undoManager.add();\r\n\t\t\t},\r\n\r\n\t\t\t'Cut,Copy,Paste': function(command) {\r\n\t\t\t\tvar doc = editor.getDoc(), failed;\r\n\r\n\t\t\t\t// Try executing the native command\r\n\t\t\t\ttry {\r\n\t\t\t\t\texecNativeCommand(command);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Command failed\r\n\t\t\t\t\tfailed = TRUE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Chrome reports the paste command as supported however older IE:s will return false for cut/paste\r\n\t\t\t\tif (command === 'paste' && !doc.queryCommandEnabled(command)) {\r\n\t\t\t\t\tfailed = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Present alert message about clipboard access not being available\r\n\t\t\t\tif (failed || !doc.queryCommandSupported(command)) {\r\n\t\t\t\t\tvar msg = editor.translate(\r\n\t\t\t\t\t\t\"Your browser doesn't support direct access to the clipboard. \" +\r\n\t\t\t\t\t\t\"Please use the Ctrl+X/C/V keyboard shortcuts instead.\"\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (Env.mac) {\r\n\t\t\t\t\t\tmsg = msg.replace(/Ctrl\\+/g, '\\u2318+');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teditor.notificationManager.open({text: msg, type: 'error'});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// Override unlink command\r\n\t\t\tunlink: function() {\r\n\t\t\t\tif (selection.isCollapsed()) {\r\n\t\t\t\t\tvar elm = selection.getNode();\r\n\t\t\t\t\tif (elm.tagName == 'A') {\r\n\t\t\t\t\t\teditor.dom.remove(elm, true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tformatter.remove(\"link\");\r\n\t\t\t},\r\n\r\n\t\t\t// Override justify commands to use the text formatter engine\r\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function(command) {\r\n\t\t\t\tvar align = command.substring(7);\r\n\r\n\t\t\t\tif (align == 'full') {\r\n\t\t\t\t\talign = 'justify';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove all other alignments first\r\n\t\t\t\teach('left,center,right,justify'.split(','), function(name) {\r\n\t\t\t\t\tif (align != name) {\r\n\t\t\t\t\t\tformatter.remove('align' + name);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (align != 'none') {\r\n\t\t\t\t\ttoggleFormat('align' + align);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// Override list commands to fix WebKit bug\r\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\r\n\t\t\t\tvar listElm, listParent;\r\n\r\n\t\t\t\texecNativeCommand(command);\r\n\r\n\t\t\t\t// WebKit produces lists within block elements so we need to split them\r\n\t\t\t\t// we will replace the native list creation logic to custom logic later on\r\n\t\t\t\t// TODO: Remove this when the list creation logic is removed\r\n\t\t\t\tlistElm = dom.getParent(selection.getNode(), 'ol,ul');\r\n\t\t\t\tif (listElm) {\r\n\t\t\t\t\tlistParent = listElm.parentNode;\r\n\r\n\t\t\t\t\t// If list is within a text block then split that block\r\n\t\t\t\t\tif (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\r\n\t\t\t\t\t\tstoreSelection();\r\n\t\t\t\t\t\tdom.split(listParent, listElm);\r\n\t\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// Override commands to use the text formatter engine\r\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\r\n\t\t\t\ttoggleFormat(command);\r\n\t\t\t},\r\n\r\n\t\t\t// Override commands to use the text formatter engine\r\n\t\t\t'ForeColor,HiliteColor,FontName': function(command, ui, value) {\r\n\t\t\t\ttoggleFormat(command, value);\r\n\t\t\t},\r\n\r\n\t\t\tFontSize: function(command, ui, value) {\r\n\t\t\t\tvar fontClasses, fontSizes;\r\n\r\n\t\t\t\t// Convert font size 1-7 to styles\r\n\t\t\t\tif (value >= 1 && value <= 7) {\r\n\t\t\t\t\tfontSizes = explode(settings.font_size_style_values);\r\n\t\t\t\t\tfontClasses = explode(settings.font_size_classes);\r\n\r\n\t\t\t\t\tif (fontClasses) {\r\n\t\t\t\t\t\tvalue = fontClasses[value - 1] || value;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = fontSizes[value - 1] || value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoggleFormat(command, value);\r\n\t\t\t},\r\n\r\n\t\t\tRemoveFormat: function(command) {\r\n\t\t\t\tformatter.remove(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceBlockQuote: function() {\r\n\t\t\t\ttoggleFormat('blockquote');\r\n\t\t\t},\r\n\r\n\t\t\tFormatBlock: function(command, ui, value) {\r\n\t\t\t\treturn toggleFormat(value || 'p');\r\n\t\t\t},\r\n\r\n\t\t\tmceCleanup: function() {\r\n\t\t\t\tvar bookmark = selection.getBookmark();\r\n\r\n\t\t\t\teditor.setContent(editor.getContent({cleanup: TRUE}), {cleanup: TRUE});\r\n\r\n\t\t\t\tselection.moveToBookmark(bookmark);\r\n\t\t\t},\r\n\r\n\t\t\tmceRemoveNode: function(command, ui, value) {\r\n\t\t\t\tvar node = value || selection.getNode();\r\n\r\n\t\t\t\t// Make sure that the body node isn't removed\r\n\t\t\t\tif (node != editor.getBody()) {\r\n\t\t\t\t\tstoreSelection();\r\n\t\t\t\t\teditor.dom.remove(node, TRUE);\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmceSelectNodeDepth: function(command, ui, value) {\r\n\t\t\t\tvar counter = 0;\r\n\r\n\t\t\t\tdom.getParent(selection.getNode(), function(node) {\r\n\t\t\t\t\tif (node.nodeType == 1 && counter++ == value) {\r\n\t\t\t\t\t\tselection.select(node);\r\n\t\t\t\t\t\treturn FALSE;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, editor.getBody());\r\n\t\t\t},\r\n\r\n\t\t\tmceSelectNode: function(command, ui, value) {\r\n\t\t\t\tselection.select(value);\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertContent: function(command, ui, value) {\r\n\t\t\t\tInsertContent.insertAtCaret(editor, value);\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertRawHTML: function(command, ui, value) {\r\n\t\t\t\tselection.setContent('tiny_mce_marker');\r\n\t\t\t\teditor.setContent(\r\n\t\t\t\t\teditor.getContent().replace(/tiny_mce_marker/g, function() {\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t},\r\n\r\n\t\t\tmceToggleFormat: function(command, ui, value) {\r\n\t\t\t\ttoggleFormat(value);\r\n\t\t\t},\r\n\r\n\t\t\tmceSetContent: function(command, ui, value) {\r\n\t\t\t\teditor.setContent(value);\r\n\t\t\t},\r\n\r\n\t\t\t'Indent,Outdent': function(command) {\r\n\t\t\t\tvar intentValue, indentUnit, value;\r\n\r\n\t\t\t\t// Setup indent level\r\n\t\t\t\tintentValue = settings.indentation;\r\n\t\t\t\tindentUnit = /[a-z%]+$/i.exec(intentValue);\r\n\t\t\t\tintentValue = parseInt(intentValue, 10);\r\n\r\n\t\t\t\tif (!queryCommandState('InsertUnorderedList') && !queryCommandState('InsertOrderedList')) {\r\n\t\t\t\t\t// If forced_root_blocks is set to false we don't have a block to indent so lets create a div\r\n\t\t\t\t\tif (!settings.forced_root_block && !dom.getParent(selection.getNode(), dom.isBlock)) {\r\n\t\t\t\t\t\tformatter.apply('div');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teach(selection.getSelectedBlocks(), function(element) {\r\n\t\t\t\t\t\tif (dom.getContentEditable(element) === \"false\") {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (element.nodeName != \"LI\") {\r\n\t\t\t\t\t\t\tvar indentStyleName = editor.getParam('indent_use_margin', false) ? 'margin' : 'padding';\r\n\r\n\t\t\t\t\t\t\tindentStyleName += dom.getStyle(element, 'direction', true) == 'rtl' ? 'Right' : 'Left';\r\n\r\n\t\t\t\t\t\t\tif (command == 'outdent') {\r\n\t\t\t\t\t\t\t\tvalue = Math.max(0, parseInt(element.style[indentStyleName] || 0, 10) - intentValue);\r\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value ? value + indentUnit : '');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvalue = (parseInt(element.style[indentStyleName] || 0, 10) + intentValue) + indentUnit;\r\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\texecNativeCommand(command);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmceRepaint: function() {\r\n\t\t\t},\r\n\r\n\t\t\tInsertHorizontalRule: function() {\r\n\t\t\t\teditor.execCommand('mceInsertContent', false, '<hr />');\r\n\t\t\t},\r\n\r\n\t\t\tmceToggleVisualAid: function() {\r\n\t\t\t\teditor.hasVisual = !editor.hasVisual;\r\n\t\t\t\teditor.addVisual();\r\n\t\t\t},\r\n\r\n\t\t\tmceReplaceContent: function(command, ui, value) {\r\n\t\t\t\teditor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({format: 'text'})));\r\n\t\t\t},\r\n\r\n\t\t\tmceInsertLink: function(command, ui, value) {\r\n\t\t\t\tvar anchor;\r\n\r\n\t\t\t\tif (typeof value == 'string') {\r\n\t\t\t\t\tvalue = {href: value};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tanchor = dom.getParent(selection.getNode(), 'a');\r\n\r\n\t\t\t\t// Spaces are never valid in URLs and it's a very common mistake for people to make so we fix it here.\r\n\t\t\t\tvalue.href = value.href.replace(' ', '%20');\r\n\r\n\t\t\t\t// Remove existing links if there could be child links or that the href isn't specified\r\n\t\t\t\tif (!anchor || !value.href) {\r\n\t\t\t\t\tformatter.remove('link');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Apply new link to selection\r\n\t\t\t\tif (value.href) {\r\n\t\t\t\t\tformatter.apply('link', value, anchor);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tselectAll: function() {\r\n\t\t\t\tvar root = dom.getRoot(), rng;\r\n\r\n\t\t\t\tif (selection.getRng().setStart) {\r\n\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\trng.setStart(root, 0);\r\n\t\t\t\t\trng.setEnd(root, root.childNodes.length);\r\n\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// IE will render it's own root level block elements and sometimes\r\n\t\t\t\t\t// even put font elements in them when the user starts typing. So we need to\r\n\t\t\t\t\t// move the selection to a more suitable element from this:\r\n\t\t\t\t\t// <body>|<p></p></body> to this: <body><p>|</p></body>\r\n\t\t\t\t\trng = selection.getRng();\r\n\t\t\t\t\tif (!rng.item) {\r\n\t\t\t\t\t\trng.moveToElementText(root);\r\n\t\t\t\t\t\trng.select();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t\"delete\": function() {\r\n\t\t\t\texecNativeCommand(\"Delete\");\r\n\r\n\t\t\t\t// Check if body is empty after the delete call if so then set the contents\r\n\t\t\t\t// to an empty string and move the caret to any block produced by that operation\r\n\t\t\t\t// this fixes the issue with root blocks not being properly produced after a delete call on IE\r\n\t\t\t\tvar body = editor.getBody();\r\n\r\n\t\t\t\tif (dom.isEmpty(body)) {\r\n\t\t\t\t\teditor.setContent('');\r\n\r\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\r\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmceNewDocument: function() {\r\n\t\t\t\teditor.setContent('');\r\n\t\t\t},\r\n\r\n\t\t\tInsertLineBreak: function(command, ui, value) {\r\n\t\t\t\t// We load the current event in from EnterKey.js when appropriate to heed\r\n\t\t\t\t// certain event-specific variations such as ctrl-enter in a list\r\n\t\t\t\tvar evt = value;\r\n\t\t\t\tvar brElm, extraBr, marker;\r\n\t\t\t\tvar rng = selection.getRng(true);\r\n\t\t\t\tnew RangeUtils(dom).normalize(rng);\r\n\r\n\t\t\t\tvar offset = rng.startOffset;\r\n\t\t\t\tvar container = rng.startContainer;\r\n\r\n\t\t\t\t// Resolve node index\r\n\t\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\r\n\t\t\t\t\tvar isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\r\n\r\n\t\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\r\n\t\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\r\n\t\t\t\t\t\toffset = container.nodeValue.length;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toffset = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar parentBlock = dom.getParent(container, dom.isBlock);\r\n\t\t\t\tvar parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\r\n\t\t\t\tvar containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\r\n\t\t\t\tvar containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\r\n\r\n\t\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\r\n\t\t\t\tvar isControlKey = evt && evt.ctrlKey;\r\n\t\t\t\tif (containerBlockName == 'LI' && !isControlKey) {\r\n\t\t\t\t\tparentBlock = containerBlock;\r\n\t\t\t\t\tparentBlockName = containerBlockName;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Walks the parent block to the right and look for BR elements\r\n\t\t\t\tfunction hasRightSideContent() {\r\n\t\t\t\t\tvar walker = new TreeWalker(container, parentBlock), node;\r\n\t\t\t\t\tvar nonEmptyElementsMap = editor.schema.getNonEmptyElements();\r\n\r\n\t\t\t\t\twhile ((node = walker.next())) {\r\n\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (container && container.nodeType == 3 && offset >= container.nodeValue.length) {\r\n\t\t\t\t\t// Insert extra BR element at the end block elements\r\n\t\t\t\t\tif (!isOldIE && !hasRightSideContent()) {\r\n\t\t\t\t\t\tbrElm = dom.create('br');\r\n\t\t\t\t\t\trng.insertNode(brElm);\r\n\t\t\t\t\t\trng.setStartAfter(brElm);\r\n\t\t\t\t\t\trng.setEndAfter(brElm);\r\n\t\t\t\t\t\textraBr = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbrElm = dom.create('br');\r\n\t\t\t\trng.insertNode(brElm);\r\n\r\n\t\t\t\t// Rendering modes below IE8 doesn't display BR elements in PRE unless we have a \\n before it\r\n\t\t\t\tvar documentMode = dom.doc.documentMode;\r\n\t\t\t\tif (isOldIE && parentBlockName == 'PRE' && (!documentMode || documentMode < 8)) {\r\n\t\t\t\t\tbrElm.parentNode.insertBefore(dom.doc.createTextNode('\\r'), brElm);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Insert temp marker and scroll to that\r\n\t\t\t\tmarker = dom.create('span', {}, '&nbsp;');\r\n\t\t\t\tbrElm.parentNode.insertBefore(marker, brElm);\r\n\t\t\t\tselection.scrollIntoView(marker);\r\n\t\t\t\tdom.remove(marker);\r\n\r\n\t\t\t\tif (!extraBr) {\r\n\t\t\t\t\trng.setStartAfter(brElm);\r\n\t\t\t\t\trng.setEndAfter(brElm);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng.setStartBefore(brElm);\r\n\t\t\t\t\trng.setEndBefore(brElm);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselection.setRng(rng);\r\n\t\t\t\teditor.undoManager.add();\r\n\r\n\t\t\t\treturn TRUE;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add queryCommandState overrides\r\n\t\taddCommands({\r\n\t\t\t// Override justify commands\r\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull': function(command) {\r\n\t\t\t\tvar name = 'align' + command.substring(7);\r\n\t\t\t\tvar nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();\r\n\t\t\t\tvar matches = map(nodes, function(node) {\r\n\t\t\t\t\treturn !!formatter.matchNode(node, name);\r\n\t\t\t\t});\r\n\t\t\t\treturn inArray(matches, TRUE) !== -1;\r\n\t\t\t},\r\n\r\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\r\n\t\t\t\treturn isFormatMatch(command);\r\n\t\t\t},\r\n\r\n\t\t\tmceBlockQuote: function() {\r\n\t\t\t\treturn isFormatMatch('blockquote');\r\n\t\t\t},\r\n\r\n\t\t\tOutdent: function() {\r\n\t\t\t\tvar node;\r\n\r\n\t\t\t\tif (settings.inline_styles) {\r\n\t\t\t\t\tif ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\r\n\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\r\n\t\t\t\t\t\treturn TRUE;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn (\r\n\t\t\t\t\tqueryCommandState('InsertUnorderedList') ||\r\n\t\t\t\t\tqueryCommandState('InsertOrderedList') ||\r\n\t\t\t\t\t(!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'))\r\n\t\t\t\t);\r\n\t\t\t},\r\n\r\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\r\n\t\t\t\tvar list = dom.getParent(selection.getNode(), 'ul,ol');\r\n\r\n\t\t\t\treturn list &&\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\tcommand === 'insertunorderedlist' && list.tagName === 'UL' ||\r\n\t\t\t\t\t\tcommand === 'insertorderedlist' && list.tagName === 'OL'\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\t\t}, 'state');\r\n\r\n\t\t// Add queryCommandValue overrides\r\n\t\taddCommands({\r\n\t\t\t'FontSize,FontName': function(command) {\r\n\t\t\t\tvar value = 0, parent;\r\n\r\n\t\t\t\tif ((parent = dom.getParent(selection.getNode(), 'span'))) {\r\n\t\t\t\t\tif (command == 'fontsize') {\r\n\t\t\t\t\t\tvalue = parent.style.fontSize;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = parent.style.fontFamily.replace(/, /g, ',').replace(/[\\'\\\"]/g, '').toLowerCase();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}, 'value');\r\n\r\n\t\t// Add undo manager logic\r\n\t\taddCommands({\r\n\t\t\tUndo: function() {\r\n\t\t\t\teditor.undoManager.undo();\r\n\t\t\t},\r\n\r\n\t\t\tRedo: function() {\r\n\t\t\t\teditor.undoManager.redo();\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/URI.js\r\n\r\n/**\r\n * URI.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles parsing, modification and serialization of URI/URL strings.\r\n * @class tinymce.util.URI\r\n */\r\ndefine(\"tinymce/util/URI\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\tvar each = Tools.each, trim = Tools.trim;\r\n\tvar queryParts = \"source protocol authority userInfo user password host port relative path directory file query anchor\".split(' ');\r\n\tvar DEFAULT_PORTS = {\r\n\t\t'ftp': 21,\r\n\t\t'http': 80,\r\n\t\t'https': 443,\r\n\t\t'mailto': 25\r\n\t};\r\n\r\n\t/**\r\n\t * Constructs a new URI instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method URI\r\n\t * @param {String} url URI string to parse.\r\n\t * @param {Object} settings Optional settings object.\r\n\t */\r\n\tfunction URI(url, settings) {\r\n\t\tvar self = this, baseUri, base_url;\r\n\r\n\t\turl = trim(url);\r\n\t\tsettings = self.settings = settings || {};\r\n\t\tbaseUri = settings.base_uri;\r\n\r\n\t\t// Strange app protocol that isn't http/https or local anchor\r\n\t\t// For example: mailto,skype,tel etc.\r\n\t\tif (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\r\n\t\t\tself.source = url;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar isProtocolRelative = url.indexOf('//') === 0;\r\n\r\n\t\t// Absolute path with no host, fake host and protocol\r\n\t\tif (url.indexOf('/') === 0 && !isProtocolRelative) {\r\n\t\t\turl = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\r\n\t\t}\r\n\r\n\t\t// Relative path http:// or protocol relative //path\r\n\t\tif (!/^[\\w\\-]*:?\\/\\//.test(url)) {\r\n\t\t\tbase_url = settings.base_uri ? settings.base_uri.path : new URI(location.href).directory;\r\n\t\t\tif (settings.base_uri.protocol === \"\") {\r\n\t\t\t\turl = '//mce_host' + self.toAbsPath(base_url, url);\r\n\t\t\t} else {\r\n\t\t\t\turl = /([^#?]*)([#?]?.*)/.exec(url);\r\n\t\t\t\turl = ((baseUri && baseUri.protocol) || 'http') + '://mce_host' + self.toAbsPath(base_url, url[1]) + url[2];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Parse URL (Credits goes to Steave, http://blog.stevenlevithan.com/archives/parseuri)\r\n\t\turl = url.replace(/@@/g, '(mce_at)'); // Zope 3 workaround, they use @@something\r\n\r\n\t\t/*jshint maxlen: 255 */\r\n\t\t/*eslint max-len: 0 */\r\n\t\turl = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\r\n\r\n\t\teach(queryParts, function(v, i) {\r\n\t\t\tvar part = url[i];\r\n\r\n\t\t\t// Zope 3 workaround, they use @@something\r\n\t\t\tif (part) {\r\n\t\t\t\tpart = part.replace(/\\(mce_at\\)/g, '@@');\r\n\t\t\t}\r\n\r\n\t\t\tself[v] = part;\r\n\t\t});\r\n\r\n\t\tif (baseUri) {\r\n\t\t\tif (!self.protocol) {\r\n\t\t\t\tself.protocol = baseUri.protocol;\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.userInfo) {\r\n\t\t\t\tself.userInfo = baseUri.userInfo;\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.port && self.host === 'mce_host') {\r\n\t\t\t\tself.port = baseUri.port;\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.host || self.host === 'mce_host') {\r\n\t\t\t\tself.host = baseUri.host;\r\n\t\t\t}\r\n\r\n\t\t\tself.source = '';\r\n\t\t}\r\n\r\n\t\tif (isProtocolRelative) {\r\n\t\t\tself.protocol = '';\r\n\t\t}\r\n\r\n\t\t//t.path = t.path || '/';\r\n\t}\r\n\r\n\tURI.prototype = {\r\n\t\t/**\r\n\t\t * Sets the internal path part of the URI.\r\n\t\t *\r\n\t\t * @method setPath\r\n\t\t * @param {string} path Path string to set.\r\n\t\t */\r\n\t\tsetPath: function(path) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tpath = /^(.*?)\\/?(\\w+)?$/.exec(path);\r\n\r\n\t\t\t// Update path parts\r\n\t\t\tself.path = path[0];\r\n\t\t\tself.directory = path[1];\r\n\t\t\tself.file = path[2];\r\n\r\n\t\t\t// Rebuild source\r\n\t\t\tself.source = '';\r\n\t\t\tself.getURI();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Converts the specified URI into a relative URI based on the current URI instance location.\r\n\t\t *\r\n\t\t * @method toRelative\r\n\t\t * @param {String} uri URI to convert into a relative path/URI.\r\n\t\t * @return {String} Relative URI from the point specified in the current URI instance.\r\n\t\t * @example\r\n\t\t * // Converts an absolute URL to an relative URL url will be somedir/somefile.htm\r\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toRelative('http://www.site.com/dir/somedir/somefile.htm');\r\n\t\t */\r\n\t\ttoRelative: function(uri) {\r\n\t\t\tvar self = this, output;\r\n\r\n\t\t\tif (uri === \"./\") {\r\n\t\t\t\treturn uri;\r\n\t\t\t}\r\n\r\n\t\t\turi = new URI(uri, {base_uri: self});\r\n\r\n\t\t\t// Not on same domain/port or protocol\r\n\t\t\tif ((uri.host != 'mce_host' && self.host != uri.host && uri.host) || self.port != uri.port ||\r\n\t\t\t\t(self.protocol != uri.protocol && uri.protocol !== \"\")) {\r\n\t\t\t\treturn uri.getURI();\r\n\t\t\t}\r\n\r\n\t\t\tvar tu = self.getURI(), uu = uri.getURI();\r\n\r\n\t\t\t// Allow usage of the base_uri when relative_urls = true\r\n\t\t\tif (tu == uu || (tu.charAt(tu.length - 1) == \"/\" && tu.substr(0, tu.length - 1) == uu)) {\r\n\t\t\t\treturn tu;\r\n\t\t\t}\r\n\r\n\t\t\toutput = self.toRelPath(self.path, uri.path);\r\n\r\n\t\t\t// Add query\r\n\t\t\tif (uri.query) {\r\n\t\t\t\toutput += '?' + uri.query;\r\n\t\t\t}\r\n\r\n\t\t\t// Add anchor\r\n\t\t\tif (uri.anchor) {\r\n\t\t\t\toutput += '#' + uri.anchor;\r\n\t\t\t}\r\n\r\n\t\t\treturn output;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Converts the specified URI into a absolute URI based on the current URI instance location.\r\n\t\t *\r\n\t\t * @method toAbsolute\r\n\t\t * @param {String} uri URI to convert into a relative path/URI.\r\n\t\t * @param {Boolean} noHost No host and protocol prefix.\r\n\t\t * @return {String} Absolute URI from the point specified in the current URI instance.\r\n\t\t * @example\r\n\t\t * // Converts an relative URL to an absolute URL url will be http://www.site.com/dir/somedir/somefile.htm\r\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toAbsolute('somedir/somefile.htm');\r\n\t\t */\r\n\t\ttoAbsolute: function(uri, noHost) {\r\n\t\t\turi = new URI(uri, {base_uri: this});\r\n\r\n\t\t\treturn uri.getURI(noHost && this.isSameOrigin(uri));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Determine whether the given URI has the same origin as this URI.  Based on RFC-6454.\r\n\t\t * Supports default ports for protocols listed in DEFAULT_PORTS.  Unsupported protocols will fail safe: they\r\n\t\t * won't match, if the port specifications differ.\r\n\t\t *\r\n\t\t * @method isSameOrigin\r\n\t\t * @param {tinymce.util.URI} uri Uri instance to compare.\r\n\t\t * @returns {Boolean} True if the origins are the same.\r\n\t\t */\r\n\t\tisSameOrigin: function(uri) {\r\n\t\t\tif (this.host == uri.host && this.protocol == uri.protocol) {\r\n\t\t\t\tif (this.port == uri.port) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar defaultPort = DEFAULT_PORTS[this.protocol];\r\n\t\t\t\tif (defaultPort && ((this.port || defaultPort) == (uri.port || defaultPort))) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Converts a absolute path into a relative path.\r\n\t\t *\r\n\t\t * @method toRelPath\r\n\t\t * @param {String} base Base point to convert the path from.\r\n\t\t * @param {String} path Absolute path to convert into a relative path.\r\n\t\t */\r\n\t\ttoRelPath: function(base, path) {\r\n\t\t\tvar items, breakPoint = 0, out = '', i, l;\r\n\r\n\t\t\t// Split the paths\r\n\t\t\tbase = base.substring(0, base.lastIndexOf('/'));\r\n\t\t\tbase = base.split('/');\r\n\t\t\titems = path.split('/');\r\n\r\n\t\t\tif (base.length >= items.length) {\r\n\t\t\t\tfor (i = 0, l = base.length; i < l; i++) {\r\n\t\t\t\t\tif (i >= items.length || base[i] != items[i]) {\r\n\t\t\t\t\t\tbreakPoint = i + 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (base.length < items.length) {\r\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\r\n\t\t\t\t\tif (i >= base.length || base[i] != items[i]) {\r\n\t\t\t\t\t\tbreakPoint = i + 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (breakPoint === 1) {\r\n\t\t\t\treturn path;\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0, l = base.length - (breakPoint - 1); i < l; i++) {\r\n\t\t\t\tout += \"../\";\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = breakPoint - 1, l = items.length; i < l; i++) {\r\n\t\t\t\tif (i != breakPoint - 1) {\r\n\t\t\t\t\tout += \"/\" + items[i];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tout += items[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn out;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Converts a relative path into a absolute path.\r\n\t\t *\r\n\t\t * @method toAbsPath\r\n\t\t * @param {String} base Base point to convert the path from.\r\n\t\t * @param {String} path Relative path to convert into an absolute path.\r\n\t\t */\r\n\t\ttoAbsPath: function(base, path) {\r\n\t\t\tvar i, nb = 0, o = [], tr, outPath;\r\n\r\n\t\t\t// Split paths\r\n\t\t\ttr = /\\/$/.test(path) ? '/' : '';\r\n\t\t\tbase = base.split('/');\r\n\t\t\tpath = path.split('/');\r\n\r\n\t\t\t// Remove empty chunks\r\n\t\t\teach(base, function(k) {\r\n\t\t\t\tif (k) {\r\n\t\t\t\t\to.push(k);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tbase = o;\r\n\r\n\t\t\t// Merge relURLParts chunks\r\n\t\t\tfor (i = path.length - 1, o = []; i >= 0; i--) {\r\n\t\t\t\t// Ignore empty or .\r\n\t\t\t\tif (path[i].length === 0 || path[i] === \".\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is parent\r\n\t\t\t\tif (path[i] === '..') {\r\n\t\t\t\t\tnb++;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move up\r\n\t\t\t\tif (nb > 0) {\r\n\t\t\t\t\tnb--;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\to.push(path[i]);\r\n\t\t\t}\r\n\r\n\t\t\ti = base.length - nb;\r\n\r\n\t\t\t// If /a/b/c or /\r\n\t\t\tif (i <= 0) {\r\n\t\t\t\toutPath = o.reverse().join('/');\r\n\t\t\t} else {\r\n\t\t\t\toutPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\r\n\t\t\t}\r\n\r\n\t\t\t// Add front / if it's needed\r\n\t\t\tif (outPath.indexOf('/') !== 0) {\r\n\t\t\t\toutPath = '/' + outPath;\r\n\t\t\t}\r\n\r\n\t\t\t// Add traling / if it's needed\r\n\t\t\tif (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\r\n\t\t\t\toutPath += tr;\r\n\t\t\t}\r\n\r\n\t\t\treturn outPath;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the full URI of the internal structure.\r\n\t\t *\r\n\t\t * @method getURI\r\n\t\t * @param {Boolean} noProtoHost Optional no host and protocol part. Defaults to false.\r\n\t\t */\r\n\t\tgetURI: function(noProtoHost) {\r\n\t\t\tvar s, self = this;\r\n\r\n\t\t\t// Rebuild source\r\n\t\t\tif (!self.source || noProtoHost) {\r\n\t\t\t\ts = '';\r\n\r\n\t\t\t\tif (!noProtoHost) {\r\n\t\t\t\t\tif (self.protocol) {\r\n\t\t\t\t\t\ts += self.protocol + '://';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ts += '//';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.userInfo) {\r\n\t\t\t\t\t\ts += self.userInfo + '@';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.host) {\r\n\t\t\t\t\t\ts += self.host;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.port) {\r\n\t\t\t\t\t\ts += ':' + self.port;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.path) {\r\n\t\t\t\t\ts += self.path;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.query) {\r\n\t\t\t\t\ts += '?' + self.query;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.anchor) {\r\n\t\t\t\t\ts += '#' + self.anchor;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.source = s;\r\n\t\t\t}\r\n\r\n\t\t\treturn self.source;\r\n\t\t}\r\n\t};\r\n\r\n\tURI.parseDataUri = function(uri) {\r\n\t\tvar type, matches;\r\n\r\n\t\turi = decodeURIComponent(uri).split(',');\r\n\r\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\r\n\t\tif (matches) {\r\n\t\t\ttype = matches[1];\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttype: type,\r\n\t\t\tdata: uri[1]\r\n\t\t};\r\n\t};\r\n\r\n\tURI.getDocumentBaseUrl = function(loc) {\r\n\t\tvar baseUrl;\r\n\r\n\t\t// Pass applewebdata:// and other non web protocols though\r\n\t\tif (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\r\n\t\t\tbaseUrl = loc.href;\r\n\t\t} else {\r\n\t\t\tbaseUrl = loc.protocol + '//' + loc.host + loc.pathname;\r\n\t\t}\r\n\r\n\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\r\n\t\t\tbaseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\r\n\r\n\t\t\tif (!/[\\/\\\\]$/.test(baseUrl)) {\r\n\t\t\t\tbaseUrl += '/';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn baseUrl;\r\n\t};\r\n\r\n\treturn URI;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Class.js\r\n\r\n/**\r\n * Class.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This utilitiy class is used for easier inheritance.\r\n *\r\n * Features:\r\n * * Exposed super functions: this._super();\r\n * * Mixins\r\n * * Dummy functions\r\n * * Property functions: var value = object.value(); and object.value(newValue);\r\n * * Static functions\r\n * * Defaults settings\r\n */\r\ndefine(\"tinymce/util/Class\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\tvar each = Tools.each, extend = Tools.extend;\r\n\r\n\tvar extendClass, initializing;\r\n\r\n\tfunction Class() {\r\n\t}\r\n\r\n\t// Provides classical inheritance, based on code made by John Resig\r\n\tClass.extend = extendClass = function(prop) {\r\n\t\tvar self = this, _super = self.prototype, prototype, name, member;\r\n\r\n\t\t// The dummy class constructor\r\n\t\tfunction Class() {\r\n\t\t\tvar i, mixins, mixin, self = this;\r\n\r\n\t\t\t// All construction is actually done in the init method\r\n\t\t\tif (!initializing) {\r\n\t\t\t\t// Run class constuctor\r\n\t\t\t\tif (self.init) {\r\n\t\t\t\t\tself.init.apply(self, arguments);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Run mixin constructors\r\n\t\t\t\tmixins = self.Mixins;\r\n\t\t\t\tif (mixins) {\r\n\t\t\t\t\ti = mixins.length;\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tmixin = mixins[i];\r\n\t\t\t\t\t\tif (mixin.init) {\r\n\t\t\t\t\t\t\tmixin.init.apply(self, arguments);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Dummy function, needs to be extended in order to provide functionality\r\n\t\tfunction dummy() {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t// Creates a overloaded method for the class\r\n\t\t// this enables you to use this._super(); to call the super function\r\n\t\tfunction createMethod(name, fn) {\r\n\t\t\treturn function() {\r\n\t\t\t\tvar self = this, tmp = self._super, ret;\r\n\r\n\t\t\t\tself._super = _super[name];\r\n\t\t\t\tret = fn.apply(self, arguments);\r\n\t\t\t\tself._super = tmp;\r\n\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Instantiate a base class (but only create the instance,\r\n\t\t// don't run the init constructor)\r\n\t\tinitializing = true;\r\n\r\n\t\t/*eslint new-cap:0 */\r\n\t\tprototype = new self();\r\n\t\tinitializing = false;\r\n\r\n\t\t// Add mixins\r\n\t\tif (prop.Mixins) {\r\n\t\t\teach(prop.Mixins, function(mixin) {\r\n\t\t\t\tfor (var name in mixin) {\r\n\t\t\t\t\tif (name !== \"init\") {\r\n\t\t\t\t\t\tprop[name] = mixin[name];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (_super.Mixins) {\r\n\t\t\t\tprop.Mixins = _super.Mixins.concat(prop.Mixins);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Generate dummy methods\r\n\t\tif (prop.Methods) {\r\n\t\t\teach(prop.Methods.split(','), function(name) {\r\n\t\t\t\tprop[name] = dummy;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Generate property methods\r\n\t\tif (prop.Properties) {\r\n\t\t\teach(prop.Properties.split(','), function(name) {\r\n\t\t\t\tvar fieldName = '_' + name;\r\n\r\n\t\t\t\tprop[name] = function(value) {\r\n\t\t\t\t\tvar self = this, undef;\r\n\r\n\t\t\t\t\t// Set value\r\n\t\t\t\t\tif (value !== undef) {\r\n\t\t\t\t\t\tself[fieldName] = value;\r\n\r\n\t\t\t\t\t\treturn self;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get value\r\n\t\t\t\t\treturn self[fieldName];\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Static functions\r\n\t\tif (prop.Statics) {\r\n\t\t\teach(prop.Statics, function(func, name) {\r\n\t\t\t\tClass[name] = func;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Default settings\r\n\t\tif (prop.Defaults && _super.Defaults) {\r\n\t\t\tprop.Defaults = extend({}, _super.Defaults, prop.Defaults);\r\n\t\t}\r\n\r\n\t\t// Copy the properties over onto the new prototype\r\n\t\tfor (name in prop) {\r\n\t\t\tmember = prop[name];\r\n\r\n\t\t\tif (typeof member == \"function\" && _super[name]) {\r\n\t\t\t\tprototype[name] = createMethod(name, member);\r\n\t\t\t} else {\r\n\t\t\t\tprototype[name] = member;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Populate our constructed prototype object\r\n\t\tClass.prototype = prototype;\r\n\r\n\t\t// Enforce the constructor to be what we expect\r\n\t\tClass.constructor = Class;\r\n\r\n\t\t// And make this class extendible\r\n\t\tClass.extend = extendClass;\r\n\r\n\t\treturn Class;\r\n\t};\r\n\r\n\treturn Class;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/EventDispatcher.js\r\n\r\n/**\r\n * EventDispatcher.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class lets you add/remove and fire events by name on the specified scope. This makes\r\n * it easy to add event listener logic to any class.\r\n *\r\n * @class tinymce.util.EventDispatcher\r\n * @example\r\n *  var eventDispatcher = new EventDispatcher();\r\n *\r\n *  eventDispatcher.on('click', function() {console.log('data');});\r\n *  eventDispatcher.fire('click', {data: 123});\r\n */\r\ndefine(\"tinymce/util/EventDispatcher\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\tvar nativeEvents = Tools.makeMap(\r\n\t\t\"focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange \" +\r\n\t\t\"mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover \" +\r\n\t\t\"draggesture dragdrop drop drag submit \" +\r\n\t\t\"compositionstart compositionend compositionupdate touchstart touchend\",\r\n\t\t' '\r\n\t);\r\n\r\n\tfunction Dispatcher(settings) {\r\n\t\tvar self = this, scope, bindings = {}, toggleEvent;\r\n\r\n\t\tfunction returnFalse() {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction returnTrue() {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tsettings = settings || {};\r\n\t\tscope = settings.scope || self;\r\n\t\ttoggleEvent = settings.toggleEvent || returnFalse;\r\n\r\n\t\t/**\r\n\t\t * Fires the specified event by name.\r\n\t\t *\r\n\t\t * @method fire\r\n\t\t * @param {String} name Name of the event to fire.\r\n\t\t * @param {Object?} args Event arguments.\r\n\t\t * @return {Object} Event args instance passed in.\r\n\t\t * @example\r\n\t\t * instance.fire('event', {...});\r\n\t\t */\r\n\t\tfunction fire(name, args) {\r\n\t\t\tvar handlers, i, l, callback;\r\n\r\n\t\t\tname = name.toLowerCase();\r\n\t\t\targs = args || {};\r\n\t\t\targs.type = name;\r\n\r\n\t\t\t// Setup target is there isn't one\r\n\t\t\tif (!args.target) {\r\n\t\t\t\targs.target = scope;\r\n\t\t\t}\r\n\r\n\t\t\t// Add event delegation methods if they are missing\r\n\t\t\tif (!args.preventDefault) {\r\n\t\t\t\t// Add preventDefault method\r\n\t\t\t\targs.preventDefault = function() {\r\n\t\t\t\t\targs.isDefaultPrevented = returnTrue;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Add stopPropagation\r\n\t\t\t\targs.stopPropagation = function() {\r\n\t\t\t\t\targs.isPropagationStopped = returnTrue;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Add stopImmediatePropagation\r\n\t\t\t\targs.stopImmediatePropagation = function() {\r\n\t\t\t\t\targs.isImmediatePropagationStopped = returnTrue;\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Add event delegation states\r\n\t\t\t\targs.isDefaultPrevented = returnFalse;\r\n\t\t\t\targs.isPropagationStopped = returnFalse;\r\n\t\t\t\targs.isImmediatePropagationStopped = returnFalse;\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.beforeFire) {\r\n\t\t\t\tsettings.beforeFire(args);\r\n\t\t\t}\r\n\r\n\t\t\thandlers = bindings[name];\r\n\t\t\tif (handlers) {\r\n\t\t\t\tfor (i = 0, l = handlers.length; i < l; i++) {\r\n\t\t\t\t\tcallback = handlers[i];\r\n\r\n\t\t\t\t\t// Unbind handlers marked with \"once\"\r\n\t\t\t\t\tif (callback.once) {\r\n\t\t\t\t\t\toff(name, callback.func);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Stop immediate propagation if needed\r\n\t\t\t\t\tif (args.isImmediatePropagationStopped()) {\r\n\t\t\t\t\t\targs.stopPropagation();\r\n\t\t\t\t\t\treturn args;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If callback returns false then prevent default and stop all propagation\r\n\t\t\t\t\tif (callback.func.call(scope, args) === false) {\r\n\t\t\t\t\t\targs.preventDefault();\r\n\t\t\t\t\t\treturn args;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn args;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Binds an event listener to a specific event by name.\r\n\t\t *\r\n\t\t * @method on\r\n\t\t * @param {String} name Event name or space separated list of events to bind.\r\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\r\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\r\n\t\t * @return {Object} Current class instance.\r\n\t\t * @example\r\n\t\t * instance.on('event', function(e) {\r\n\t\t *     // Callback logic\r\n\t\t * });\r\n\t\t */\r\n\t\tfunction on(name, callback, prepend, extra) {\r\n\t\t\tvar handlers, names, i;\r\n\r\n\t\t\tif (callback === false) {\r\n\t\t\t\tcallback = returnFalse;\r\n\t\t\t}\r\n\r\n\t\t\tif (callback) {\r\n\t\t\t\tcallback = {\r\n\t\t\t\t\tfunc: callback\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (extra) {\r\n\t\t\t\t\tTools.extend(callback, extra);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnames = name.toLowerCase().split(' ');\r\n\t\t\t\ti = names.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tname = names[i];\r\n\t\t\t\t\thandlers = bindings[name];\r\n\t\t\t\t\tif (!handlers) {\r\n\t\t\t\t\t\thandlers = bindings[name] = [];\r\n\t\t\t\t\t\ttoggleEvent(name, true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (prepend) {\r\n\t\t\t\t\t\thandlers.unshift(callback);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\thandlers.push(callback);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Unbinds an event listener to a specific event by name.\r\n\t\t *\r\n\t\t * @method off\r\n\t\t * @param {String?} name Name of the event to unbind.\r\n\t\t * @param {callback?} callback Callback to unbind.\r\n\t\t * @return {Object} Current class instance.\r\n\t\t * @example\r\n\t\t * // Unbind specific callback\r\n\t\t * instance.off('event', handler);\r\n\t\t *\r\n\t\t * // Unbind all listeners by name\r\n\t\t * instance.off('event');\r\n\t\t *\r\n\t\t * // Unbind all events\r\n\t\t * instance.off();\r\n\t\t */\r\n\t\tfunction off(name, callback) {\r\n\t\t\tvar i, handlers, bindingName, names, hi;\r\n\r\n\t\t\tif (name) {\r\n\t\t\t\tnames = name.toLowerCase().split(' ');\r\n\t\t\t\ti = names.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tname = names[i];\r\n\t\t\t\t\thandlers = bindings[name];\r\n\r\n\t\t\t\t\t// Unbind all handlers\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tfor (bindingName in bindings) {\r\n\t\t\t\t\t\t\ttoggleEvent(bindingName, false);\r\n\t\t\t\t\t\t\tdelete bindings[bindingName];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn self;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (handlers) {\r\n\t\t\t\t\t\t// Unbind all by name\r\n\t\t\t\t\t\tif (!callback) {\r\n\t\t\t\t\t\t\thandlers.length = 0;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Unbind specific ones\r\n\t\t\t\t\t\t\thi = handlers.length;\r\n\t\t\t\t\t\t\twhile (hi--) {\r\n\t\t\t\t\t\t\t\tif (handlers[hi].func === callback) {\r\n\t\t\t\t\t\t\t\t\thandlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\r\n\t\t\t\t\t\t\t\t\tbindings[name] = handlers;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!handlers.length) {\r\n\t\t\t\t\t\t\ttoggleEvent(name, false);\r\n\t\t\t\t\t\t\tdelete bindings[name];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (name in bindings) {\r\n\t\t\t\t\ttoggleEvent(name, false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbindings = {};\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Binds an event listener to a specific event by name\r\n\t\t * and automatically unbind the event once the callback fires.\r\n\t\t *\r\n\t\t * @method once\r\n\t\t * @param {String} name Event name or space separated list of events to bind.\r\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\r\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\r\n\t\t * @return {Object} Current class instance.\r\n\t\t * @example\r\n\t\t * instance.once('event', function(e) {\r\n\t\t *     // Callback logic\r\n\t\t * });\r\n\t\t */\r\n\t\tfunction once(name, callback, prepend) {\r\n\t\t\treturn on(name, callback, prepend, {once: true});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the dispatcher has a event of the specified name.\r\n\t\t *\r\n\t\t * @method has\r\n\t\t * @param {String} name Name of the event to check for.\r\n\t\t * @return {Boolean} true/false if the event exists or not.\r\n\t\t */\r\n\t\tfunction has(name) {\r\n\t\t\tname = name.toLowerCase();\r\n\t\t\treturn !(!bindings[name] || bindings[name].length === 0);\r\n\t\t}\r\n\r\n\t\t// Expose\r\n\t\tself.fire = fire;\r\n\t\tself.on = on;\r\n\t\tself.off = off;\r\n\t\tself.once = once;\r\n\t\tself.has = has;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true/false if the specified event name is a native browser event or not.\r\n\t *\r\n\t * @method isNative\r\n\t * @param {String} name Name to check if it's native.\r\n\t * @return {Boolean} true/false if the event is native or not.\r\n\t * @static\r\n\t */\r\n\tDispatcher.isNative = function(name) {\r\n\t\treturn !!nativeEvents[name.toLowerCase()];\r\n\t};\r\n\r\n\treturn Dispatcher;\r\n});\r\n\r\n// Included from: js/tinymce/classes/data/Binding.js\r\n\r\n/**\r\n * Binding.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class gets dynamically extended to provide a binding between two models. This makes it possible to\r\n * sync the state of two properties in two models by a layer of abstraction.\r\n *\r\n * @private\r\n * @class tinymce.data.Binding\r\n */\r\ndefine(\"tinymce/data/Binding\", [], function() {\r\n\t/**\r\n\t * Constructs a new bidning.\r\n\t *\r\n\t * @constructor\r\n\t * @method Binding\r\n\t * @param {Object} settings Settings to the binding.\r\n\t */\r\n\tfunction Binding(settings) {\r\n\t\tthis.create = settings.create;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a binding for a property on a model.\r\n\t *\r\n\t * @method create\r\n\t * @param {tinymce.data.ObservableObject} model Model to create binding to.\r\n\t * @param {String} name Name of property to bind.\r\n\t * @return {tinymce.data.Binding} Binding instance.\r\n\t */\r\n\tBinding.create = function(model, name) {\r\n\t\treturn new Binding({\r\n\t\t\tcreate: function(otherModel, otherName) {\r\n\t\t\t\tvar bindings;\r\n\r\n\t\t\t\tfunction fromSelfToOther(e) {\r\n\t\t\t\t\totherModel.set(otherName, e.value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction fromOtherToSelf(e) {\r\n\t\t\t\t\tmodel.set(name, e.value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\totherModel.on('change:' + otherName, fromOtherToSelf);\r\n\t\t\t\tmodel.on('change:' + name, fromSelfToOther);\r\n\r\n\t\t\t\t// Keep track of the bindings\r\n\t\t\t\tbindings = otherModel._bindings;\r\n\r\n\t\t\t\tif (!bindings) {\r\n\t\t\t\t\tbindings = otherModel._bindings = [];\r\n\r\n\t\t\t\t\totherModel.on('destroy', function() {\r\n\t\t\t\t\t\tvar i = bindings.length;\r\n\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tbindings[i]();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbindings.push(function() {\r\n\t\t\t\t\tmodel.off('change:' + name, fromSelfToOther);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn model.get(name);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\treturn Binding;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Observable.js\r\n\r\n/**\r\n * Observable.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This mixin will add event binding logic to classes.\r\n *\r\n * @mixin tinymce.util.Observable\r\n */\r\ndefine(\"tinymce/util/Observable\", [\r\n\t\"tinymce/util/EventDispatcher\"\r\n], function(EventDispatcher) {\r\n\tfunction getEventDispatcher(obj) {\r\n\t\tif (!obj._eventDispatcher) {\r\n\t\t\tobj._eventDispatcher = new EventDispatcher({\r\n\t\t\t\tscope: obj,\r\n\t\t\t\ttoggleEvent: function(name, state) {\r\n\t\t\t\t\tif (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\r\n\t\t\t\t\t\tobj.toggleNativeEvent(name, state);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn obj._eventDispatcher;\r\n\t}\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Fires the specified event by name.\r\n\t\t *\r\n\t\t * @method fire\r\n\t\t * @param {String} name Name of the event to fire.\r\n\t\t * @param {Object?} args Event arguments.\r\n\t\t * @param {Boolean?} bubble True/false if the event is to be bubbled.\r\n\t\t * @return {Object} Event args instance passed in.\r\n\t\t * @example\r\n\t\t * instance.fire('event', {...});\r\n\t\t */\r\n\t\tfire: function(name, args, bubble) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// Prevent all events except the remove event after the instance has been removed\r\n\t\t\tif (self.removed && name !== \"remove\") {\r\n\t\t\t\treturn args;\r\n\t\t\t}\r\n\r\n\t\t\targs = getEventDispatcher(self).fire(name, args, bubble);\r\n\r\n\t\t\t// Bubble event up to parents\r\n\t\t\tif (bubble !== false && self.parent) {\r\n\t\t\t\tvar parent = self.parent();\r\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\r\n\t\t\t\t\tparent.fire(name, args, false);\r\n\t\t\t\t\tparent = parent.parent();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn args;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Binds an event listener to a specific event by name.\r\n\t\t *\r\n\t\t * @method on\r\n\t\t * @param {String} name Event name or space separated list of events to bind.\r\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\r\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\r\n\t\t * @return {Object} Current class instance.\r\n\t\t * @example\r\n\t\t * instance.on('event', function(e) {\r\n\t\t *     // Callback logic\r\n\t\t * });\r\n\t\t */\r\n\t\ton: function(name, callback, prepend) {\r\n\t\t\treturn getEventDispatcher(this).on(name, callback, prepend);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unbinds an event listener to a specific event by name.\r\n\t\t *\r\n\t\t * @method off\r\n\t\t * @param {String?} name Name of the event to unbind.\r\n\t\t * @param {callback?} callback Callback to unbind.\r\n\t\t * @return {Object} Current class instance.\r\n\t\t * @example\r\n\t\t * // Unbind specific callback\r\n\t\t * instance.off('event', handler);\r\n\t\t *\r\n\t\t * // Unbind all listeners by name\r\n\t\t * instance.off('event');\r\n\t\t *\r\n\t\t * // Unbind all events\r\n\t\t * instance.off();\r\n\t\t */\r\n\t\toff: function(name, callback) {\r\n\t\t\treturn getEventDispatcher(this).off(name, callback);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Bind the event callback and once it fires the callback is removed.\r\n\t\t *\r\n\t\t * @method once\r\n\t\t * @param {String} name Name of the event to bind.\r\n\t\t * @param {callback} callback Callback to bind only once.\r\n\t\t * @return {Object} Current class instance.\r\n\t\t */\r\n\t\tonce: function(name, callback) {\r\n\t\t\treturn getEventDispatcher(this).once(name, callback);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the object has a event of the specified name.\r\n\t\t *\r\n\t\t * @method hasEventListeners\r\n\t\t * @param {String} name Name of the event to check for.\r\n\t\t * @return {Boolean} true/false if the event exists or not.\r\n\t\t */\r\n\t\thasEventListeners: function(name) {\r\n\t\t\treturn getEventDispatcher(this).has(name);\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/data/ObservableObject.js\r\n\r\n/**\r\n * ObservableObject.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is a object that is observable when properties changes a change event gets emitted.\r\n *\r\n * @private\r\n * @class tinymce.data.ObservableObject\r\n */\r\ndefine(\"tinymce/data/ObservableObject\", [\r\n\t\"tinymce/data/Binding\",\r\n\t\"tinymce/util/Observable\",\r\n\t\"tinymce/util/Class\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Binding, Observable, Class, Tools) {\r\n\tfunction isNode(node) {\r\n\t\treturn node.nodeType > 0;\r\n\t}\r\n\r\n\t// Todo: Maybe this should be shallow compare since it might be huge object references\r\n\tfunction isEqual(a, b) {\r\n\t\tvar k, checked;\r\n\r\n\t\t// Strict equals\r\n\t\tif (a === b) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Compare null\r\n\t\tif (a === null || b === null) {\r\n\t\t\treturn a === b;\r\n\t\t}\r\n\r\n\t\t// Compare number, boolean, string, undefined\r\n\t\tif (typeof a !== \"object\" || typeof b !== \"object\") {\r\n\t\t\treturn a === b;\r\n\t\t}\r\n\r\n\t\t// Compare arrays\r\n\t\tif (Tools.isArray(b)) {\r\n\t\t\tif (a.length !== b.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tk = a.length;\r\n\t\t\twhile (k--) {\r\n\t\t\t\tif (!isEqual(a[k], b[k])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Shallow compare nodes\r\n\t\tif (isNode(a) || isNode(b)) {\r\n\t\t\treturn a === b;\r\n\t\t}\r\n\r\n\t\t// Compare objects\r\n\t\tchecked = {};\r\n\t\tfor (k in b) {\r\n\t\t\tif (!isEqual(a[k], b[k])) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tchecked[k] = true;\r\n\t\t}\r\n\r\n\t\tfor (k in a) {\r\n\t\t\tif (!checked[k] && !isEqual(a[k], b[k])) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn Class.extend({\r\n\t\tMixins: [Observable],\r\n\r\n\t\t/**\r\n\t\t * Constructs a new observable object instance.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} data Initial data for the object.\r\n\t\t */\r\n\t\tinit: function(data) {\r\n\t\t\tvar name, value;\r\n\r\n\t\t\tdata = data || {};\r\n\r\n\t\t\tfor (name in data) {\r\n\t\t\t\tvalue = data[name];\r\n\r\n\t\t\t\tif (value instanceof Binding) {\r\n\t\t\t\t\tdata[name] = value.create(this, name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.data = data;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets a property on the value this will call\r\n\t\t * observers if the value is a change from the current value.\r\n\t\t *\r\n\t\t * @method set\r\n\t\t * @param {String/object} name Name of the property to set or a object of items to set.\r\n\t\t * @param {Object} value Value to set for the property.\r\n\t\t * @return {tinymce.data.ObservableObject} Observable object instance.\r\n\t\t */\r\n\t\tset: function(name, value) {\r\n\t\t\tvar key, args, oldValue = this.data[name];\r\n\r\n\t\t\tif (value instanceof Binding) {\r\n\t\t\t\tvalue = value.create(this, name);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof name === \"object\") {\r\n\t\t\t\tfor (key in name) {\r\n\t\t\t\t\tthis.set(key, name[key]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isEqual(oldValue, value)) {\r\n\t\t\t\tthis.data[name] = value;\r\n\r\n\t\t\t\targs = {\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tname: name,\r\n\t\t\t\t\tvalue: value,\r\n\t\t\t\t\toldValue: oldValue\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.fire('change:' + name, args);\r\n\t\t\t\tthis.fire('change', args);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Gets a property by name.\r\n\t\t *\r\n\t\t * @method get\r\n\t\t * @param {String} name Name of the property to get.\r\n\t\t * @return {Object} Object value of propery.\r\n\t\t */\r\n\t\tget: function(name) {\r\n\t\t\treturn this.data[name];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified property exists.\r\n\t\t *\r\n\t\t * @method has\r\n\t\t * @param {String} name Name of the property to check for.\r\n\t\t * @return {Boolean} true/false if the item exists.\r\n\t\t */\r\n\t\thas: function(name) {\r\n\t\t\treturn name in this.data;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a dynamic property binding for the specified property name. This makes\r\n\t\t * it possible to sync the state of two properties in two ObservableObject instances.\r\n\t\t *\r\n\t\t * @method bind\r\n\t\t * @param {String} name Name of the property to sync with the property it's inserted to.\r\n\t\t * @return {tinymce.data.Binding} Data binding instance.\r\n\t\t */\r\n\t\tbind: function(name) {\r\n\t\t\treturn Binding.create(this, name);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Destroys the observable object and fires the \"destroy\"\r\n\t\t * event and clean up any internal resources.\r\n\t\t *\r\n\t\t * @method destroy\r\n\t\t */\r\n\t\tdestroy: function() {\r\n\t\t\tthis.fire('destroy');\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Selector.js\r\n\r\n/**\r\n * Selector.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*eslint no-nested-ternary:0 */\r\n\r\n/**\r\n * Selector engine, enables you to select controls by using CSS like expressions.\r\n * We currently only support basic CSS expressions to reduce the size of the core\r\n * and the ones we support should be enough for most cases.\r\n *\r\n * @example\r\n * Supported expressions:\r\n *  element\r\n *  element#name\r\n *  element.class\r\n *  element[attr]\r\n *  element[attr*=value]\r\n *  element[attr~=value]\r\n *  element[attr!=value]\r\n *  element[attr^=value]\r\n *  element[attr$=value]\r\n *  element:<state>\r\n *  element:not(<expression>)\r\n *  element:first\r\n *  element:last\r\n *  element:odd\r\n *  element:even\r\n *  element element\r\n *  element > element\r\n *\r\n * @class tinymce.ui.Selector\r\n */\r\ndefine(\"tinymce/ui/Selector\", [\r\n\t\"tinymce/util/Class\"\r\n], function(Class) {\r\n\t\"use strict\";\r\n\r\n\t/**\r\n\t * Produces an array with a unique set of objects. It will not compare the values\r\n\t * but the references of the objects.\r\n\t *\r\n\t * @private\r\n\t * @method unqiue\r\n\t * @param {Array} array Array to make into an array with unique items.\r\n\t * @return {Array} Array with unique items.\r\n\t */\r\n\tfunction unique(array) {\r\n\t\tvar uniqueItems = [], i = array.length, item;\r\n\r\n\t\twhile (i--) {\r\n\t\t\titem = array[i];\r\n\r\n\t\t\tif (!item.__checked) {\r\n\t\t\t\tuniqueItems.push(item);\r\n\t\t\t\titem.__checked = 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ti = uniqueItems.length;\r\n\t\twhile (i--) {\r\n\t\t\tdelete uniqueItems[i].__checked;\r\n\t\t}\r\n\r\n\t\treturn uniqueItems;\r\n\t}\r\n\r\n\tvar expression = /^([\\w\\\\*]+)?(?:#([\\w\\-\\\\]+))?(?:\\.([\\w\\\\\\.]+))?(?:\\[\\@?([\\w\\\\]+)([\\^\\$\\*!~]?=)([\\w\\\\]+)\\])?(?:\\:(.+))?/i;\r\n\r\n\t/*jshint maxlen:255 */\r\n\t/*eslint max-len:0 */\r\n\tvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,\r\n\t\twhiteSpace = /^\\s*|\\s*$/g,\r\n\t\tCollection;\r\n\r\n\tvar Selector = Class.extend({\r\n\t\t/**\r\n\t\t * Constructs a new Selector instance.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @method init\r\n\t\t * @param {String} selector CSS like selector expression.\r\n\t\t */\r\n\t\tinit: function(selector) {\r\n\t\t\tvar match = this.match;\r\n\r\n\t\t\tfunction compileNameFilter(name) {\r\n\t\t\t\tif (name) {\r\n\t\t\t\t\tname = name.toLowerCase();\r\n\r\n\t\t\t\t\treturn function(item) {\r\n\t\t\t\t\t\treturn name === '*' || item.type === name;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction compileIdFilter(id) {\r\n\t\t\t\tif (id) {\r\n\t\t\t\t\treturn function(item) {\r\n\t\t\t\t\t\treturn item._name === id;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction compileClassesFilter(classes) {\r\n\t\t\t\tif (classes) {\r\n\t\t\t\t\tclasses = classes.split('.');\r\n\r\n\t\t\t\t\treturn function(item) {\r\n\t\t\t\t\t\tvar i = classes.length;\r\n\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\tif (!item.classes.contains(classes[i])) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction compileAttrFilter(name, cmp, check) {\r\n\t\t\t\tif (name) {\r\n\t\t\t\t\treturn function(item) {\r\n\t\t\t\t\t\tvar value = item[name] ? item[name]() : '';\r\n\r\n\t\t\t\t\t\treturn !cmp ? !!check :\r\n\t\t\t\t\t\t\tcmp === \"=\" ? value === check :\r\n\t\t\t\t\t\t\tcmp === \"*=\" ? value.indexOf(check) >= 0 :\r\n\t\t\t\t\t\t\tcmp === \"~=\" ? (\" \" + value + \" \").indexOf(\" \" + check + \" \") >= 0 :\r\n\t\t\t\t\t\t\tcmp === \"!=\" ? value != check :\r\n\t\t\t\t\t\t\tcmp === \"^=\" ? value.indexOf(check) === 0 :\r\n\t\t\t\t\t\t\tcmp === \"$=\" ? value.substr(value.length - check.length) === check :\r\n\t\t\t\t\t\t\tfalse;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction compilePsuedoFilter(name) {\r\n\t\t\t\tvar notSelectors;\r\n\r\n\t\t\t\tif (name) {\r\n\t\t\t\t\tname = /(?:not\\((.+)\\))|(.+)/i.exec(name);\r\n\r\n\t\t\t\t\tif (!name[1]) {\r\n\t\t\t\t\t\tname = name[2];\r\n\r\n\t\t\t\t\t\treturn function(item, index, length) {\r\n\t\t\t\t\t\t\treturn name === 'first' ? index === 0 :\r\n\t\t\t\t\t\t\t\tname === 'last' ? index === length - 1 :\r\n\t\t\t\t\t\t\t\tname === 'even' ? index % 2 === 0 :\r\n\t\t\t\t\t\t\t\tname === 'odd' ? index % 2 === 1 :\r\n\t\t\t\t\t\t\t\titem[name] ? item[name]() :\r\n\t\t\t\t\t\t\t\tfalse;\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Compile not expression\r\n\t\t\t\t\tnotSelectors = parseChunks(name[1], []);\r\n\r\n\t\t\t\t\treturn function(item) {\r\n\t\t\t\t\t\treturn !match(item, notSelectors);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction compile(selector, filters, direct) {\r\n\t\t\t\tvar parts;\r\n\r\n\t\t\t\tfunction add(filter) {\r\n\t\t\t\t\tif (filter) {\r\n\t\t\t\t\t\tfilters.push(filter);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Parse expression into parts\r\n\t\t\t\tparts = expression.exec(selector.replace(whiteSpace, ''));\r\n\r\n\t\t\t\tadd(compileNameFilter(parts[1]));\r\n\t\t\t\tadd(compileIdFilter(parts[2]));\r\n\t\t\t\tadd(compileClassesFilter(parts[3]));\r\n\t\t\t\tadd(compileAttrFilter(parts[4], parts[5], parts[6]));\r\n\t\t\t\tadd(compilePsuedoFilter(parts[7]));\r\n\r\n\t\t\t\t// Mark the filter with pseudo for performance\r\n\t\t\t\tfilters.pseudo = !!parts[7];\r\n\t\t\t\tfilters.direct = direct;\r\n\r\n\t\t\t\treturn filters;\r\n\t\t\t}\r\n\r\n\t\t\t// Parser logic based on Sizzle by John Resig\r\n\t\t\tfunction parseChunks(selector, selectors) {\r\n\t\t\t\tvar parts = [], extra, matches, i;\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\tchunker.exec(\"\");\r\n\t\t\t\t\tmatches = chunker.exec(selector);\r\n\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\tselector = matches[3];\r\n\t\t\t\t\t\tparts.push(matches[1]);\r\n\r\n\t\t\t\t\t\tif (matches[2]) {\r\n\t\t\t\t\t\t\textra = matches[3];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} while (matches);\r\n\r\n\t\t\t\tif (extra) {\r\n\t\t\t\t\tparseChunks(extra, selectors);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselector = [];\r\n\t\t\t\tfor (i = 0; i < parts.length; i++) {\r\n\t\t\t\t\tif (parts[i] != '>') {\r\n\t\t\t\t\t\tselector.push(compile(parts[i], [], parts[i - 1] === '>'));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselectors.push(selector);\r\n\r\n\t\t\t\treturn selectors;\r\n\t\t\t}\r\n\r\n\t\t\tthis._selectors = parseChunks(selector, []);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the selector matches the specified control.\r\n\t\t *\r\n\t\t * @method match\r\n\t\t * @param {tinymce.ui.Control} control Control to match against the selector.\r\n\t\t * @param {Array} selectors Optional array of selectors, mostly used internally.\r\n\t\t * @return {Boolean} true/false state if the control matches or not.\r\n\t\t */\r\n\t\tmatch: function(control, selectors) {\r\n\t\t\tvar i, l, si, sl, selector, fi, fl, filters, index, length, siblings, count, item;\r\n\r\n\t\t\tselectors = selectors || this._selectors;\r\n\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\r\n\t\t\t\tselector = selectors[i];\r\n\t\t\t\tsl = selector.length;\r\n\t\t\t\titem = control;\r\n\t\t\t\tcount = 0;\r\n\r\n\t\t\t\tfor (si = sl - 1; si >= 0; si--) {\r\n\t\t\t\t\tfilters = selector[si];\r\n\r\n\t\t\t\t\twhile (item) {\r\n\t\t\t\t\t\t// Find the index and length since a pseudo filter like :first needs it\r\n\t\t\t\t\t\tif (filters.pseudo) {\r\n\t\t\t\t\t\t\tsiblings = item.parent().items();\r\n\t\t\t\t\t\t\tindex = length = siblings.length;\r\n\t\t\t\t\t\t\twhile (index--) {\r\n\t\t\t\t\t\t\t\tif (siblings[index] === item) {\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\r\n\t\t\t\t\t\t\tif (!filters[fi](item, index, length)) {\r\n\t\t\t\t\t\t\t\tfi = fl + 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (fi === fl) {\r\n\t\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// If it didn't match the right most expression then\r\n\t\t\t\t\t\t\t// break since it's no point looking at the parents\r\n\t\t\t\t\t\t\tif (si === sl - 1) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\titem = item.parent();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If we found all selectors then return true otherwise continue looking\r\n\t\t\t\tif (count === sl) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a tinymce.ui.Collection with matches of the specified selector inside the specified container.\r\n\t\t *\r\n\t\t * @method find\r\n\t\t * @param {tinymce.ui.Control} container Container to look for items in.\r\n\t\t * @return {tinymce.ui.Collection} Collection with matched elements.\r\n\t\t */\r\n\t\tfind: function(container) {\r\n\t\t\tvar matches = [], i, l, selectors = this._selectors;\r\n\r\n\t\t\tfunction collect(items, selector, index) {\r\n\t\t\t\tvar i, l, fi, fl, item, filters = selector[index];\r\n\r\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\r\n\t\t\t\t\titem = items[i];\r\n\r\n\t\t\t\t\t// Run each filter against the item\r\n\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\r\n\t\t\t\t\t\tif (!filters[fi](item, i, l)) {\r\n\t\t\t\t\t\t\tfi = fl + 1;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// All filters matched the item\r\n\t\t\t\t\tif (fi === fl) {\r\n\t\t\t\t\t\t// Matched item is on the last expression like: panel toolbar [button]\r\n\t\t\t\t\t\tif (index == selector.length - 1) {\r\n\t\t\t\t\t\t\tmatches.push(item);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Collect next expression type\r\n\t\t\t\t\t\t\tif (item.items) {\r\n\t\t\t\t\t\t\t\tcollect(item.items(), selector, index + 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (filters.direct) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Collect child items\r\n\t\t\t\t\tif (item.items) {\r\n\t\t\t\t\t\tcollect(item.items(), selector, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (container.items) {\r\n\t\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\r\n\t\t\t\t\tcollect(container.items(), selectors[i], 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Unique the matches if needed\r\n\t\t\t\tif (l > 1) {\r\n\t\t\t\t\tmatches = unique(matches);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Fix for circular reference\r\n\t\t\tif (!Collection) {\r\n\t\t\t\t// TODO: Fix me!\r\n\t\t\t\tCollection = Selector.Collection;\r\n\t\t\t}\r\n\r\n\t\t\treturn new Collection(matches);\r\n\t\t}\r\n\t});\r\n\r\n\treturn Selector;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Collection.js\r\n\r\n/**\r\n * Collection.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Control collection, this class contains control instances and it enables you to\r\n * perform actions on all the contained items. This is very similar to how jQuery works.\r\n *\r\n * @example\r\n * someCollection.show().disabled(true);\r\n *\r\n * @class tinymce.ui.Collection\r\n */\r\ndefine(\"tinymce/ui/Collection\", [\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/ui/Selector\",\r\n\t\"tinymce/util/Class\"\r\n], function(Tools, Selector, Class) {\r\n\t\"use strict\";\r\n\r\n\tvar Collection, proto, push = Array.prototype.push, slice = Array.prototype.slice;\r\n\r\n\tproto = {\r\n\t\t/**\r\n\t\t * Current number of contained control instances.\r\n\t\t *\r\n\t\t * @field length\r\n\t\t * @type Number\r\n\t\t */\r\n\t\tlength: 0,\r\n\r\n\t\t/**\r\n\t\t * Constructor for the collection.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @method init\r\n\t\t * @param {Array} items Optional array with items to add.\r\n\t\t */\r\n\t\tinit: function(items) {\r\n\t\t\tif (items) {\r\n\t\t\t\tthis.add(items);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds new items to the control collection.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {Array} items Array if items to add to collection.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\tadd: function(items) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// Force single item into array\r\n\t\t\tif (!Tools.isArray(items)) {\r\n\t\t\t\tif (items instanceof Collection) {\r\n\t\t\t\t\tself.add(items.toArray());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpush.call(self, items);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tpush.apply(self, items);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the contents of the collection. This will remove any existing items\r\n\t\t * and replace them with the ones specified in the input array.\r\n\t\t *\r\n\t\t * @method set\r\n\t\t * @param {Array} items Array with items to set into the Collection.\r\n\t\t * @return {tinymce.ui.Collection} Collection instance.\r\n\t\t */\r\n\t\tset: function(items) {\r\n\t\t\tvar self = this, len = self.length, i;\r\n\r\n\t\t\tself.length = 0;\r\n\t\t\tself.add(items);\r\n\r\n\t\t\t// Remove old entries\r\n\t\t\tfor (i = self.length; i < len; i++) {\r\n\t\t\t\tdelete self[i];\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Filters the collection item based on the specified selector expression or selector function.\r\n\t\t *\r\n\t\t * @method filter\r\n\t\t * @param {String} selector Selector expression to filter items by.\r\n\t\t * @return {tinymce.ui.Collection} Collection containing the filtered items.\r\n\t\t */\r\n\t\tfilter: function(selector) {\r\n\t\t\tvar self = this, i, l, matches = [], item, match;\r\n\r\n\t\t\t// Compile string into selector expression\r\n\t\t\tif (typeof selector === \"string\") {\r\n\t\t\t\tselector = new Selector(selector);\r\n\r\n\t\t\t\tmatch = function(item) {\r\n\t\t\t\t\treturn selector.match(item);\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\t// Use selector as matching function\r\n\t\t\t\tmatch = selector;\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0, l = self.length; i < l; i++) {\r\n\t\t\t\titem = self[i];\r\n\r\n\t\t\t\tif (match(item)) {\r\n\t\t\t\t\tmatches.push(item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn new Collection(matches);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Slices the items within the collection.\r\n\t\t *\r\n\t\t * @method slice\r\n\t\t * @param {Number} index Index to slice at.\r\n\t\t * @param {Number} len Optional length to slice.\r\n\t\t * @return {tinymce.ui.Collection} Current collection.\r\n\t\t */\r\n\t\tslice: function() {\r\n\t\t\treturn new Collection(slice.apply(this, arguments));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Makes the current collection equal to the specified index.\r\n\t\t *\r\n\t\t * @method eq\r\n\t\t * @param {Number} index Index of the item to set the collection to.\r\n\t\t * @return {tinymce.ui.Collection} Current collection.\r\n\t\t */\r\n\t\teq: function(index) {\r\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes the specified callback on each item in collection.\r\n\t\t *\r\n\t\t * @method each\r\n\t\t * @param {function} callback Callback to execute for each item in collection.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\teach: function(callback) {\r\n\t\t\tTools.each(this, callback);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns an JavaScript array object of the contents inside the collection.\r\n\t\t *\r\n\t\t * @method toArray\r\n\t\t * @return {Array} Array with all items from collection.\r\n\t\t */\r\n\t\ttoArray: function() {\r\n\t\t\treturn Tools.toArray(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Finds the index of the specified control or return -1 if it isn't in the collection.\r\n\t\t *\r\n\t\t * @method indexOf\r\n\t\t * @param {Control} ctrl Control instance to look for.\r\n\t\t * @return {Number} Index of the specified control or -1.\r\n\t\t */\r\n\t\tindexOf: function(ctrl) {\r\n\t\t\tvar self = this, i = self.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tif (self[i] === ctrl) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn i;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a new collection of the contents in reverse order.\r\n\t\t *\r\n\t\t * @method reverse\r\n\t\t * @return {tinymce.ui.Collection} Collection instance with reversed items.\r\n\t\t */\r\n\t\treverse: function() {\r\n\t\t\treturn new Collection(Tools.toArray(this).reverse());\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the class exists or not.\r\n\t\t *\r\n\t\t * @method hasClass\r\n\t\t * @param {String} cls Class to check for.\r\n\t\t * @return {Boolean} true/false state if the class exists or not.\r\n\t\t */\r\n\t\thasClass: function(cls) {\r\n\t\t\treturn this[0] ? this[0].classes.contains(cls) : false;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the specific property on the items in the collection. The same as executing control.<property>(<value>);\r\n\t\t *\r\n\t\t * @method prop\r\n\t\t * @param {String} name Property name to get/set.\r\n\t\t * @param {Object} value Optional object value to set.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance or value of the first item on a get operation.\r\n\t\t */\r\n\t\tprop: function(name, value) {\r\n\t\t\tvar self = this, undef, item;\r\n\r\n\t\t\tif (value !== undef) {\r\n\t\t\t\tself.each(function(item) {\r\n\t\t\t\t\tif (item[name]) {\r\n\t\t\t\t\t\titem[name](value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\titem = self[0];\r\n\r\n\t\t\tif (item && item[name]) {\r\n\t\t\t\treturn item[name]();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes the specific function name with optional arguments an all items in collection if it exists.\r\n\t\t *\r\n\t\t * @example collection.exec(\"myMethod\", arg1, arg2, arg3);\r\n\t\t * @method exec\r\n\t\t * @param {String} name Name of the function to execute.\r\n\t\t * @param {Object} ... Multiple arguments to pass to each function.\r\n\t\t * @return {tinymce.ui.Collection} Current collection.\r\n\t\t */\r\n\t\texec: function(name) {\r\n\t\t\tvar self = this, args = Tools.toArray(arguments).slice(1);\r\n\r\n\t\t\tself.each(function(item) {\r\n\t\t\t\tif (item[name]) {\r\n\t\t\t\t\titem[name].apply(item, args);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Remove all items from collection and DOM.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @return {tinymce.ui.Collection} Current collection.\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tvar i = this.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tthis[i].remove();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a class to all items in the collection.\r\n\t\t *\r\n\t\t * @method addClass\r\n\t\t * @param {String} cls Class to add to each item.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\taddClass: function(cls) {\r\n\t\t\treturn this.each(function(item) {\r\n\t\t\t\titem.classes.add(cls);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the specified class from all items in collection.\r\n\t\t *\r\n\t\t * @method removeClass\r\n\t\t * @param {String} cls Class to remove from each item.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\tremoveClass: function(cls) {\r\n\t\t\treturn this.each(function(item) {\r\n\t\t\t\titem.classes.remove(cls);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\r\n\t\t * bound event handlers.\r\n\t\t *\r\n\t\t * @method fire\r\n\t\t * @param {String} name Name of the event to fire.\r\n\t\t * @param {Object} args Optional arguments to pass to the event.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\t// fire: function(event, args) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Binds a callback to the specified event. This event can both be\r\n\t\t * native browser events like \"click\" or custom ones like PostRender.\r\n\t\t *\r\n\t\t * The callback function will have two parameters the first one being the control that received the event\r\n\t\t * the second one will be the event object either the browsers native event object or a custom JS object.\r\n\t\t *\r\n\t\t * @method on\r\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\r\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\t// on: function(name, callback) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\r\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\r\n\t\t * by the specified name will be removed.\r\n\t\t *\r\n\t\t * @method off\r\n\t\t * @param {String} name Optional name for the event to unbind.\r\n\t\t * @param {function} callback Optional callback function to unbind.\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\t// off: function(name, callback) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Shows the items in the current collection.\r\n\t\t *\r\n\t\t * @method show\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\t// show: function() {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Hides the items in the current collection.\r\n\t\t *\r\n\t\t * @method hide\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\r\n\t\t */\r\n\t\t// hide: function() {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the text contents of the items in the current collection.\r\n\t\t *\r\n\t\t * @method text\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance or text value of the first item on a get operation.\r\n\t\t */\r\n\t\t// text: function(value) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the name contents of the items in the current collection.\r\n\t\t *\r\n\t\t * @method name\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance or name value of the first item on a get operation.\r\n\t\t */\r\n\t\t// name: function(value) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the disabled state on the items in the current collection.\r\n\t\t *\r\n\t\t * @method disabled\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance or disabled state of the first item on a get operation.\r\n\t\t */\r\n\t\t// disabled: function(state) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the active state on the items in the current collection.\r\n\t\t *\r\n\t\t * @method active\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance or active state of the first item on a get operation.\r\n\t\t */\r\n\t\t// active: function(state) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the selected state on the items in the current collection.\r\n\t\t *\r\n\t\t * @method selected\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance or selected state of the first item on a get operation.\r\n\t\t */\r\n\t\t// selected: function(state) {}, -- Generated by code below\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the selected state on the items in the current collection.\r\n\t\t *\r\n\t\t * @method visible\r\n\t\t * @return {tinymce.ui.Collection} Current collection instance or visible state of the first item on a get operation.\r\n\t\t */\r\n\t\t// visible: function(state) {}, -- Generated by code below\r\n\t};\r\n\r\n\t// Extend tinymce.ui.Collection prototype with some generated control specific methods\r\n\tTools.each('fire on off show hide append prepend before after reflow'.split(' '), function(name) {\r\n\t\tproto[name] = function() {\r\n\t\t\tvar args = Tools.toArray(arguments);\r\n\r\n\t\t\tthis.each(function(ctrl) {\r\n\t\t\t\tif (name in ctrl) {\r\n\t\t\t\t\tctrl[name].apply(ctrl, args);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn this;\r\n\t\t};\r\n\t});\r\n\r\n\t// Extend tinymce.ui.Collection prototype with some property methods\r\n\tTools.each('text name disabled active selected checked visible parent value data'.split(' '), function(name) {\r\n\t\tproto[name] = function(value) {\r\n\t\t\treturn this.prop(name, value);\r\n\t\t};\r\n\t});\r\n\r\n\t// Create class based on the new prototype\r\n\tCollection = Class.extend(proto);\r\n\r\n\t// Stick Collection into Selector to prevent circual references\r\n\tSelector.Collection = Collection;\r\n\r\n\treturn Collection;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/DomUtils.js\r\n\r\n/**\r\n * DomUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Private UI DomUtils proxy.\r\n *\r\n * @private\r\n * @class tinymce.ui.DomUtils\r\n */\r\ndefine(\"tinymce/ui/DomUtils\", [\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/dom/DOMUtils\"\r\n], function(Tools, DOMUtils) {\r\n\t\"use strict\";\r\n\r\n\tvar count = 0;\r\n\r\n\treturn {\r\n\t\tid: function() {\r\n\t\t\treturn 'mceu_' + (count++);\r\n\t\t},\r\n\r\n\t\tcreate: function(name, attrs, children) {\r\n\t\t\tvar elm = document.createElement(name);\r\n\r\n\t\t\tDOMUtils.DOM.setAttribs(elm, attrs);\r\n\r\n\t\t\tif (typeof children === 'string') {\r\n\t\t\t\telm.innerHTML = children;\r\n\t\t\t} else {\r\n\t\t\t\tTools.each(children, function(child) {\r\n\t\t\t\t\tif (child.nodeType) {\r\n\t\t\t\t\t\telm.appendChild(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn elm;\r\n\t\t},\r\n\r\n\t\tcreateFragment: function(html) {\r\n\t\t\treturn DOMUtils.DOM.createFragment(html);\r\n\t\t},\r\n\r\n\t\tgetWindowSize: function() {\r\n\t\t\treturn DOMUtils.DOM.getViewPort();\r\n\t\t},\r\n\r\n\t\tgetSize: function(elm) {\r\n\t\t\tvar width, height;\r\n\r\n\t\t\tif (elm.getBoundingClientRect) {\r\n\t\t\t\tvar rect = elm.getBoundingClientRect();\r\n\r\n\t\t\t\twidth = Math.max(rect.width || (rect.right - rect.left), elm.offsetWidth);\r\n\t\t\t\theight = Math.max(rect.height || (rect.bottom - rect.bottom), elm.offsetHeight);\r\n\t\t\t} else {\r\n\t\t\t\twidth = elm.offsetWidth;\r\n\t\t\t\theight = elm.offsetHeight;\r\n\t\t\t}\r\n\r\n\t\t\treturn {width: width, height: height};\r\n\t\t},\r\n\r\n\t\tgetPos: function(elm, root) {\r\n\t\t\treturn DOMUtils.DOM.getPos(elm, root);\r\n\t\t},\r\n\r\n\t\tgetViewPort: function(win) {\r\n\t\t\treturn DOMUtils.DOM.getViewPort(win);\r\n\t\t},\r\n\r\n\t\tget: function(id) {\r\n\t\t\treturn document.getElementById(id);\r\n\t\t},\r\n\r\n\t\taddClass: function(elm, cls) {\r\n\t\t\treturn DOMUtils.DOM.addClass(elm, cls);\r\n\t\t},\r\n\r\n\t\tremoveClass: function(elm, cls) {\r\n\t\t\treturn DOMUtils.DOM.removeClass(elm, cls);\r\n\t\t},\r\n\r\n\t\thasClass: function(elm, cls) {\r\n\t\t\treturn DOMUtils.DOM.hasClass(elm, cls);\r\n\t\t},\r\n\r\n\t\ttoggleClass: function(elm, cls, state) {\r\n\t\t\treturn DOMUtils.DOM.toggleClass(elm, cls, state);\r\n\t\t},\r\n\r\n\t\tcss: function(elm, name, value) {\r\n\t\t\treturn DOMUtils.DOM.setStyle(elm, name, value);\r\n\t\t},\r\n\r\n\t\tgetRuntimeStyle: function(elm, name) {\r\n\t\t\treturn DOMUtils.DOM.getStyle(elm, name, true);\r\n\t\t},\r\n\r\n\t\ton: function(target, name, callback, scope) {\r\n\t\t\treturn DOMUtils.DOM.bind(target, name, callback, scope);\r\n\t\t},\r\n\r\n\t\toff: function(target, name, callback) {\r\n\t\t\treturn DOMUtils.DOM.unbind(target, name, callback);\r\n\t\t},\r\n\r\n\t\tfire: function(target, name, args) {\r\n\t\t\treturn DOMUtils.DOM.fire(target, name, args);\r\n\t\t},\r\n\r\n\t\tinnerHtml: function(elm, html) {\r\n\t\t\t// Workaround for <div> in <p> bug on IE 8 #6178\r\n\t\t\tDOMUtils.DOM.setHTML(elm, html);\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/BoxUtils.js\r\n\r\n/**\r\n * BoxUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Utility class for box parsing and measuring.\r\n *\r\n * @private\r\n * @class tinymce.ui.BoxUtils\r\n */\r\ndefine(\"tinymce/ui/BoxUtils\", [\r\n], function() {\r\n\t\"use strict\";\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Parses the specified box value. A box value contains 1-4 properties in clockwise order.\r\n\t\t *\r\n\t\t * @method parseBox\r\n\t\t * @param {String/Number} value Box value \"0 1 2 3\" or \"0\" etc.\r\n\t\t * @return {Object} Object with top/right/bottom/left properties.\r\n\t\t * @private\r\n\t\t */\r\n\t\tparseBox: function(value) {\r\n\t\t\tvar len, radix = 10;\r\n\r\n\t\t\tif (!value) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof value === \"number\") {\r\n\t\t\t\tvalue = value || 0;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: value,\r\n\t\t\t\t\tleft: value,\r\n\t\t\t\t\tbottom: value,\r\n\t\t\t\t\tright: value\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tvalue = value.split(' ');\r\n\t\t\tlen = value.length;\r\n\r\n\t\t\tif (len === 1) {\r\n\t\t\t\tvalue[1] = value[2] = value[3] = value[0];\r\n\t\t\t} else if (len === 2) {\r\n\t\t\t\tvalue[2] = value[0];\r\n\t\t\t\tvalue[3] = value[1];\r\n\t\t\t} else if (len === 3) {\r\n\t\t\t\tvalue[3] = value[1];\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttop: parseInt(value[0], radix) || 0,\r\n\t\t\t\tright: parseInt(value[1], radix) || 0,\r\n\t\t\t\tbottom: parseInt(value[2], radix) || 0,\r\n\t\t\t\tleft: parseInt(value[3], radix) || 0\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tmeasureBox: function(elm, prefix) {\r\n\t\t\tfunction getStyle(name) {\r\n\t\t\t\tvar defaultView = document.defaultView;\r\n\r\n\t\t\t\tif (defaultView) {\r\n\t\t\t\t\t// Remove camelcase\r\n\t\t\t\t\tname = name.replace(/[A-Z]/g, function(a) {\r\n\t\t\t\t\t\treturn '-' + a;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn defaultView.getComputedStyle(elm, null).getPropertyValue(name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn elm.currentStyle[name];\r\n\t\t\t}\r\n\r\n\t\t\tfunction getSide(name) {\r\n\t\t\t\tvar val = parseFloat(getStyle(name), 10);\r\n\r\n\t\t\t\treturn isNaN(val) ? 0 : val;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttop: getSide(prefix + \"TopWidth\"),\r\n\t\t\t\tright: getSide(prefix + \"RightWidth\"),\r\n\t\t\t\tbottom: getSide(prefix + \"BottomWidth\"),\r\n\t\t\t\tleft: getSide(prefix + \"LeftWidth\")\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ClassList.js\r\n\r\n/**\r\n * ClassList.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Handles adding and removal of classes.\r\n *\r\n * @private\r\n * @class tinymce.ui.ClassList\r\n */\r\ndefine(\"tinymce/ui/ClassList\", [\r\n\t\"tinymce/util/Tools\"\r\n], function(Tools) {\r\n\t\"use strict\";\r\n\r\n\tfunction noop() {\r\n\t}\r\n\r\n\t/**\r\n\t * Constructs a new class list the specified onchange\r\n\t * callback will be executed when the class list gets modifed.\r\n\t *\r\n\t * @constructor ClassList\r\n\t * @param {function} onchange Onchange callback to be executed.\r\n\t */\r\n\tfunction ClassList(onchange) {\r\n\t\tthis.cls = [];\r\n\t\tthis.cls._map = {};\r\n\t\tthis.onchange = onchange || noop;\r\n\t\tthis.prefix = '';\r\n\t}\r\n\r\n\tTools.extend(ClassList.prototype, {\r\n\t\t/**\r\n\t\t * Adds a new class to the class list.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {String} cls Class to be added.\r\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\r\n\t\t */\r\n\t\tadd: function(cls) {\r\n\t\t\tif (cls && !this.contains(cls)) {\r\n\t\t\t\tthis.cls._map[cls] = true;\r\n\t\t\t\tthis.cls.push(cls);\r\n\t\t\t\tthis._change();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the specified class from the class list.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @param {String} cls Class to be removed.\r\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\r\n\t\t */\r\n\t\tremove: function(cls) {\r\n\t\t\tif (this.contains(cls)) {\r\n\t\t\t\tfor (var i = 0; i < this.cls.length; i++) {\r\n\t\t\t\t\tif (this.cls[i] === cls) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.cls.splice(i, 1);\r\n\t\t\t\tdelete this.cls._map[cls];\r\n\t\t\t\tthis._change();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Toggles a class in the class list.\r\n\t\t *\r\n\t\t * @method toggle\r\n\t\t * @param {String} cls Class to be added/removed.\r\n\t\t * @param {Boolean} state Optional state if it should be added/removed.\r\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\r\n\t\t */\r\n\t\ttoggle: function(cls, state) {\r\n\t\t\tvar curState = this.contains(cls);\r\n\r\n\t\t\tif (curState !== state) {\r\n\t\t\t\tif (curState) {\r\n\t\t\t\t\tthis.remove(cls);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.add(cls);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._change();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true if the class list has the specified class.\r\n\t\t *\r\n\t\t * @method contains\r\n\t\t * @param {String} cls Class to look for.\r\n\t\t * @return {Boolean} true/false if the class exists or not.\r\n\t\t */\r\n\t\tcontains: function(cls) {\r\n\t\t\treturn !!this.cls._map[cls];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a space separated list of classes.\r\n\t\t *\r\n\t\t * @method toString\r\n\t\t * @return {String} Space separated list of classes.\r\n\t\t */\r\n\r\n\t\t_change: function() {\r\n\t\t\tdelete this.clsValue;\r\n\t\t\tthis.onchange.call(this);\r\n\t\t}\r\n\t});\r\n\r\n\t// IE 8 compatibility\r\n\tClassList.prototype.toString = function() {\r\n\t\tvar value;\r\n\r\n\t\tif (this.clsValue) {\r\n\t\t\treturn this.clsValue;\r\n\t\t}\r\n\r\n\t\tvalue = '';\r\n\t\tfor (var i = 0; i < this.cls.length; i++) {\r\n\t\t\tif (i > 0) {\r\n\t\t\t\tvalue += ' ';\r\n\t\t\t}\r\n\r\n\t\t\tvalue += this.prefix + this.cls[i];\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t};\r\n\r\n\treturn ClassList;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ReflowQueue.js\r\n\r\n/**\r\n * ReflowQueue.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class will automatically reflow controls on the next animation frame within a few milliseconds on older browsers.\r\n * If the user manually reflows then the automatic reflow will be cancelled. This class is used internally when various control states\r\n * changes that triggers a reflow.\r\n *\r\n * @class tinymce.ui.ReflowQueue\r\n * @static\r\n */\r\ndefine(\"tinymce/ui/ReflowQueue\", [\r\n\t\"tinymce/util/Delay\"\r\n], function(Delay) {\r\n\tvar dirtyCtrls = {}, animationFrameRequested;\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Adds a control to the next automatic reflow call. This is the control that had a state\r\n\t\t * change for example if the control was hidden/shown.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {tinymce.ui.Control} ctrl Control to add to queue.\r\n\t\t */\r\n\t\tadd: function(ctrl) {\r\n\t\t\tvar parent = ctrl.parent();\r\n\r\n\t\t\tif (parent) {\r\n\t\t\t\tif (!parent._layout || parent._layout.isNative()) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!dirtyCtrls[parent._id]) {\r\n\t\t\t\t\tdirtyCtrls[parent._id] = parent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!animationFrameRequested) {\r\n\t\t\t\t\tanimationFrameRequested = true;\r\n\r\n\t\t\t\t\tDelay.requestAnimationFrame(function() {\r\n\t\t\t\t\t\tvar id, ctrl;\r\n\r\n\t\t\t\t\t\tanimationFrameRequested = false;\r\n\r\n\t\t\t\t\t\tfor (id in dirtyCtrls) {\r\n\t\t\t\t\t\t\tctrl = dirtyCtrls[id];\r\n\r\n\t\t\t\t\t\t\tif (ctrl.state.get('rendered')) {\r\n\t\t\t\t\t\t\t\tctrl.reflow();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdirtyCtrls = {};\r\n\t\t\t\t\t}, document.body);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the specified control from the automatic reflow. This will happen when for example the user\r\n\t\t * manually triggers a reflow.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @param {tinymce.ui.Control} ctrl Control to remove from queue.\r\n\t\t */\r\n\t\tremove: function(ctrl) {\r\n\t\t\tif (dirtyCtrls[ctrl._id]) {\r\n\t\t\t\tdelete dirtyCtrls[ctrl._id];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Control.js\r\n\r\n/**\r\n * Control.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*eslint consistent-this:0 */\r\n\r\n/**\r\n * This is the base class for all controls and containers. All UI control instances inherit\r\n * from this one as it has the base logic needed by all of them.\r\n *\r\n * @class tinymce.ui.Control\r\n */\r\ndefine(\"tinymce/ui/Control\", [\r\n\t\"tinymce/util/Class\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/util/EventDispatcher\",\r\n\t\"tinymce/data/ObservableObject\",\r\n\t\"tinymce/ui/Collection\",\r\n\t\"tinymce/ui/DomUtils\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/ui/BoxUtils\",\r\n\t\"tinymce/ui/ClassList\",\r\n\t\"tinymce/ui/ReflowQueue\"\r\n], function(Class, Tools, EventDispatcher, ObservableObject, Collection, DomUtils, $, BoxUtils, ClassList, ReflowQueue) {\r\n\t\"use strict\";\r\n\r\n\tvar hasMouseWheelEventSupport = \"onmousewheel\" in document;\r\n\tvar hasWheelEventSupport = false;\r\n\tvar classPrefix = \"mce-\";\r\n\tvar Control, idCounter = 0;\r\n\r\n\tvar proto = {\r\n\t\tStatics: {\r\n\t\t\tclassPrefix: classPrefix\r\n\t\t},\r\n\r\n\t\tisRtl: function() {\r\n\t\t\treturn Control.rtl;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Class/id prefix to use for all controls.\r\n\t\t *\r\n\t\t * @final\r\n\t\t * @field {String} classPrefix\r\n\t\t */\r\n\t\tclassPrefix: classPrefix,\r\n\r\n\t\t/**\r\n\t\t * Constructs a new control instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {String} style Style CSS properties to add.\r\n\t\t * @setting {String} border Border box values example: 1 1 1 1\r\n\t\t * @setting {String} padding Padding box values example: 1 1 1 1\r\n\t\t * @setting {String} margin Margin box values example: 1 1 1 1\r\n\t\t * @setting {Number} minWidth Minimal width for the control.\r\n\t\t * @setting {Number} minHeight Minimal height for the control.\r\n\t\t * @setting {String} classes Space separated list of classes to add.\r\n\t\t * @setting {String} role WAI-ARIA role to use for control.\r\n\t\t * @setting {Boolean} hidden Is the control hidden by default.\r\n\t\t * @setting {Boolean} disabled Is the control disabled by default.\r\n\t\t * @setting {String} name Name of the control instance.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this, classes, defaultClasses;\r\n\r\n\t\t\tfunction applyClasses(classes) {\r\n\t\t\t\tvar i;\r\n\r\n\t\t\t\tclasses = classes.split(' ');\r\n\t\t\t\tfor (i = 0; i < classes.length; i++) {\r\n\t\t\t\t\tself.classes.add(classes[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.settings = settings = Tools.extend({}, self.Defaults, settings);\r\n\r\n\t\t\t// Initial states\r\n\t\t\tself._id = settings.id || ('mceu_' + (idCounter++));\r\n\t\t\tself._aria = {role: settings.role};\r\n\t\t\tself._elmCache = {};\r\n\t\t\tself.$ = $;\r\n\r\n\t\t\tself.state = new ObservableObject({\r\n\t\t\t\tvisible: true,\r\n\t\t\t\tactive: false,\r\n\t\t\t\tdisabled: false,\r\n\t\t\t\tvalue: ''\r\n\t\t\t});\r\n\r\n\t\t\tself.data = new ObservableObject(settings.data);\r\n\r\n\t\t\tself.classes = new ClassList(function() {\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tself.getEl().className = this.toString();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.classes.prefix = self.classPrefix;\r\n\r\n\t\t\t// Setup classes\r\n\t\t\tclasses = settings.classes;\r\n\t\t\tif (classes) {\r\n\t\t\t\tif (self.Defaults) {\r\n\t\t\t\t\tdefaultClasses = self.Defaults.classes;\r\n\r\n\t\t\t\t\tif (defaultClasses && classes != defaultClasses) {\r\n\t\t\t\t\t\tapplyClasses(defaultClasses);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapplyClasses(classes);\r\n\t\t\t}\r\n\r\n\t\t\tTools.each('title text name visible disabled active value'.split(' '), function(name) {\r\n\t\t\t\tif (name in settings) {\r\n\t\t\t\t\tself[name](settings[name]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.on('click', function() {\r\n\t\t\t\tif (self.disabled()) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * Name/value object with settings for the current control.\r\n\t\t\t *\r\n\t\t\t * @field {Object} settings\r\n\t\t\t */\r\n\t\t\tself.settings = settings;\r\n\r\n\t\t\tself.borderBox = BoxUtils.parseBox(settings.border);\r\n\t\t\tself.paddingBox = BoxUtils.parseBox(settings.padding);\r\n\t\t\tself.marginBox = BoxUtils.parseBox(settings.margin);\r\n\r\n\t\t\tif (settings.hidden) {\r\n\t\t\t\tself.hide();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Will generate getter/setter methods for these properties\r\n\t\tProperties: 'parent,name',\r\n\r\n\t\t/**\r\n\t\t * Returns the root element to render controls into.\r\n\t\t *\r\n\t\t * @method getContainerElm\r\n\t\t * @return {Element} HTML DOM element to render into.\r\n\t\t */\r\n\t\tgetContainerElm: function() {\r\n\t\t\treturn document.body;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a control instance for the current DOM element.\r\n\t\t *\r\n\t\t * @method getParentCtrl\r\n\t\t * @param {Element} elm HTML dom element to get parent control from.\r\n\t\t * @return {tinymce.ui.Control} Control instance or undefined.\r\n\t\t */\r\n\t\tgetParentCtrl: function(elm) {\r\n\t\t\tvar ctrl, lookup = this.getRoot().controlIdLookup;\r\n\r\n\t\t\twhile (elm && lookup) {\r\n\t\t\t\tctrl = lookup[elm.id];\r\n\t\t\t\tif (ctrl) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\telm = elm.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn ctrl;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Initializes the current controls layout rect.\r\n\t\t * This will be executed by the layout managers to determine the\r\n\t\t * default minWidth/minHeight etc.\r\n\t\t *\r\n\t\t * @method initLayoutRect\r\n\t\t * @return {Object} Layout rect instance.\r\n\t\t */\r\n\t\tinitLayoutRect: function() {\r\n\t\t\tvar self = this, settings = self.settings, borderBox, layoutRect;\r\n\t\t\tvar elm = self.getEl(), width, height, minWidth, minHeight, autoResize;\r\n\t\t\tvar startMinWidth, startMinHeight, initialSize;\r\n\r\n\t\t\t// Measure the current element\r\n\t\t\tborderBox = self.borderBox = self.borderBox || BoxUtils.measureBox(elm, 'border');\r\n\t\t\tself.paddingBox = self.paddingBox || BoxUtils.measureBox(elm, 'padding');\r\n\t\t\tself.marginBox = self.marginBox || BoxUtils.measureBox(elm, 'margin');\r\n\t\t\tinitialSize = DomUtils.getSize(elm);\r\n\r\n\t\t\t// Setup minWidth/minHeight and width/height\r\n\t\t\tstartMinWidth = settings.minWidth;\r\n\t\t\tstartMinHeight = settings.minHeight;\r\n\t\t\tminWidth = startMinWidth || initialSize.width;\r\n\t\t\tminHeight = startMinHeight || initialSize.height;\r\n\t\t\twidth = settings.width;\r\n\t\t\theight = settings.height;\r\n\t\t\tautoResize = settings.autoResize;\r\n\t\t\tautoResize = typeof autoResize != \"undefined\" ? autoResize : !width && !height;\r\n\r\n\t\t\twidth = width || minWidth;\r\n\t\t\theight = height || minHeight;\r\n\r\n\t\t\tvar deltaW = borderBox.left + borderBox.right;\r\n\t\t\tvar deltaH = borderBox.top + borderBox.bottom;\r\n\r\n\t\t\tvar maxW = settings.maxWidth || 0xFFFF;\r\n\t\t\tvar maxH = settings.maxHeight || 0xFFFF;\r\n\r\n\t\t\t// Setup initial layout rect\r\n\t\t\tself._layoutRect = layoutRect = {\r\n\t\t\t\tx: settings.x || 0,\r\n\t\t\t\ty: settings.y || 0,\r\n\t\t\t\tw: width,\r\n\t\t\t\th: height,\r\n\t\t\t\tdeltaW: deltaW,\r\n\t\t\t\tdeltaH: deltaH,\r\n\t\t\t\tcontentW: width - deltaW,\r\n\t\t\t\tcontentH: height - deltaH,\r\n\t\t\t\tinnerW: width - deltaW,\r\n\t\t\t\tinnerH: height - deltaH,\r\n\t\t\t\tstartMinWidth: startMinWidth || 0,\r\n\t\t\t\tstartMinHeight: startMinHeight || 0,\r\n\t\t\t\tminW: Math.min(minWidth, maxW),\r\n\t\t\t\tminH: Math.min(minHeight, maxH),\r\n\t\t\t\tmaxW: maxW,\r\n\t\t\t\tmaxH: maxH,\r\n\t\t\t\tautoResize: autoResize,\r\n\t\t\t\tscrollW: 0\r\n\t\t\t};\r\n\r\n\t\t\tself._lastLayoutRect = {};\r\n\r\n\t\t\treturn layoutRect;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Getter/setter for the current layout rect.\r\n\t\t *\r\n\t\t * @method layoutRect\r\n\t\t * @param {Object} [newRect] Optional new layout rect.\r\n\t\t * @return {tinymce.ui.Control/Object} Current control or rect object.\r\n\t\t */\r\n\t\tlayoutRect: function(newRect) {\r\n\t\t\tvar self = this, curRect = self._layoutRect, lastLayoutRect, size, deltaWidth, deltaHeight, undef, repaintControls;\r\n\r\n\t\t\t// Initialize default layout rect\r\n\t\t\tif (!curRect) {\r\n\t\t\t\tcurRect = self.initLayoutRect();\r\n\t\t\t}\r\n\r\n\t\t\t// Set new rect values\r\n\t\t\tif (newRect) {\r\n\t\t\t\t// Calc deltas between inner and outer sizes\r\n\t\t\t\tdeltaWidth = curRect.deltaW;\r\n\t\t\t\tdeltaHeight = curRect.deltaH;\r\n\r\n\t\t\t\t// Set x position\r\n\t\t\t\tif (newRect.x !== undef) {\r\n\t\t\t\t\tcurRect.x = newRect.x;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set y position\r\n\t\t\t\tif (newRect.y !== undef) {\r\n\t\t\t\t\tcurRect.y = newRect.y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set minW\r\n\t\t\t\tif (newRect.minW !== undef) {\r\n\t\t\t\t\tcurRect.minW = newRect.minW;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set minH\r\n\t\t\t\tif (newRect.minH !== undef) {\r\n\t\t\t\t\tcurRect.minH = newRect.minH;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set new width and calculate inner width\r\n\t\t\t\tsize = newRect.w;\r\n\t\t\t\tif (size !== undef) {\r\n\t\t\t\t\tsize = size < curRect.minW ? curRect.minW : size;\r\n\t\t\t\t\tsize = size > curRect.maxW ? curRect.maxW : size;\r\n\t\t\t\t\tcurRect.w = size;\r\n\t\t\t\t\tcurRect.innerW = size - deltaWidth;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set new height and calculate inner height\r\n\t\t\t\tsize = newRect.h;\r\n\t\t\t\tif (size !== undef) {\r\n\t\t\t\t\tsize = size < curRect.minH ? curRect.minH : size;\r\n\t\t\t\t\tsize = size > curRect.maxH ? curRect.maxH : size;\r\n\t\t\t\t\tcurRect.h = size;\r\n\t\t\t\t\tcurRect.innerH = size - deltaHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set new inner width and calculate width\r\n\t\t\t\tsize = newRect.innerW;\r\n\t\t\t\tif (size !== undef) {\r\n\t\t\t\t\tsize = size < curRect.minW - deltaWidth ? curRect.minW - deltaWidth : size;\r\n\t\t\t\t\tsize = size > curRect.maxW - deltaWidth ? curRect.maxW - deltaWidth : size;\r\n\t\t\t\t\tcurRect.innerW = size;\r\n\t\t\t\t\tcurRect.w = size + deltaWidth;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set new height and calculate inner height\r\n\t\t\t\tsize = newRect.innerH;\r\n\t\t\t\tif (size !== undef) {\r\n\t\t\t\t\tsize = size < curRect.minH - deltaHeight ? curRect.minH - deltaHeight : size;\r\n\t\t\t\t\tsize = size > curRect.maxH - deltaHeight ? curRect.maxH - deltaHeight : size;\r\n\t\t\t\t\tcurRect.innerH = size;\r\n\t\t\t\t\tcurRect.h = size + deltaHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set new contentW\r\n\t\t\t\tif (newRect.contentW !== undef) {\r\n\t\t\t\t\tcurRect.contentW = newRect.contentW;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set new contentH\r\n\t\t\t\tif (newRect.contentH !== undef) {\r\n\t\t\t\t\tcurRect.contentH = newRect.contentH;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Compare last layout rect with the current one to see if we need to repaint or not\r\n\t\t\t\tlastLayoutRect = self._lastLayoutRect;\r\n\t\t\t\tif (lastLayoutRect.x !== curRect.x || lastLayoutRect.y !== curRect.y ||\r\n\t\t\t\t\tlastLayoutRect.w !== curRect.w || lastLayoutRect.h !== curRect.h) {\r\n\t\t\t\t\trepaintControls = Control.repaintControls;\r\n\r\n\t\t\t\t\tif (repaintControls) {\r\n\t\t\t\t\t\tif (repaintControls.map && !repaintControls.map[self._id]) {\r\n\t\t\t\t\t\t\trepaintControls.push(self);\r\n\t\t\t\t\t\t\trepaintControls.map[self._id] = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlastLayoutRect.x = curRect.x;\r\n\t\t\t\t\tlastLayoutRect.y = curRect.y;\r\n\t\t\t\t\tlastLayoutRect.w = curRect.w;\r\n\t\t\t\t\tlastLayoutRect.h = curRect.h;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\treturn curRect;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar self = this, style, bodyStyle, bodyElm, rect, borderBox;\r\n\t\t\tvar borderW, borderH, lastRepaintRect, round, value;\r\n\r\n\t\t\t// Use Math.round on all values on IE < 9\r\n\t\t\tround = !document.createRange ? Math.round : function(value) {\r\n\t\t\t\treturn value;\r\n\t\t\t};\r\n\r\n\t\t\tstyle = self.getEl().style;\r\n\t\t\trect = self._layoutRect;\r\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\r\n\r\n\t\t\tborderBox = self.borderBox;\r\n\t\t\tborderW = borderBox.left + borderBox.right;\r\n\t\t\tborderH = borderBox.top + borderBox.bottom;\r\n\r\n\t\t\tif (rect.x !== lastRepaintRect.x) {\r\n\t\t\t\tstyle.left = round(rect.x) + 'px';\r\n\t\t\t\tlastRepaintRect.x = rect.x;\r\n\t\t\t}\r\n\r\n\t\t\tif (rect.y !== lastRepaintRect.y) {\r\n\t\t\t\tstyle.top = round(rect.y) + 'px';\r\n\t\t\t\tlastRepaintRect.y = rect.y;\r\n\t\t\t}\r\n\r\n\t\t\tif (rect.w !== lastRepaintRect.w) {\r\n\t\t\t\tvalue = round(rect.w - borderW);\r\n\t\t\t\tstyle.width = (value >= 0 ? value : 0) + 'px';\r\n\t\t\t\tlastRepaintRect.w = rect.w;\r\n\t\t\t}\r\n\r\n\t\t\tif (rect.h !== lastRepaintRect.h) {\r\n\t\t\t\tvalue = round(rect.h - borderH);\r\n\t\t\t\tstyle.height = (value >= 0 ? value : 0) + 'px';\r\n\t\t\t\tlastRepaintRect.h = rect.h;\r\n\t\t\t}\r\n\r\n\t\t\t// Update body if needed\r\n\t\t\tif (self._hasBody && rect.innerW !== lastRepaintRect.innerW) {\r\n\t\t\t\tvalue = round(rect.innerW);\r\n\r\n\t\t\t\tbodyElm = self.getEl('body');\r\n\t\t\t\tif (bodyElm) {\r\n\t\t\t\t\tbodyStyle = bodyElm.style;\r\n\t\t\t\t\tbodyStyle.width = (value >= 0 ? value : 0) + 'px';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastRepaintRect.innerW = rect.innerW;\r\n\t\t\t}\r\n\r\n\t\t\tif (self._hasBody && rect.innerH !== lastRepaintRect.innerH) {\r\n\t\t\t\tvalue = round(rect.innerH);\r\n\r\n\t\t\t\tbodyElm = bodyElm || self.getEl('body');\r\n\t\t\t\tif (bodyElm) {\r\n\t\t\t\t\tbodyStyle = bodyStyle || bodyElm.style;\r\n\t\t\t\t\tbodyStyle.height = (value >= 0 ? value : 0) + 'px';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastRepaintRect.innerH = rect.innerH;\r\n\t\t\t}\r\n\r\n\t\t\tself._lastRepaintRect = lastRepaintRect;\r\n\t\t\tself.fire('repaint', {}, false);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Updates the controls layout rect by re-measuing it.\r\n\t\t */\r\n\t\tupdateLayoutRect: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.parent()._lastRect = null;\r\n\r\n\t\t\tDomUtils.css(self.getEl(), {width: '', height: ''});\r\n\r\n\t\t\tself._layoutRect = self._lastRepaintRect = self._lastLayoutRect = null;\r\n\t\t\tself.initLayoutRect();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Binds a callback to the specified event. This event can both be\r\n\t\t * native browser events like \"click\" or custom ones like PostRender.\r\n\t\t *\r\n\t\t * The callback function will be passed a DOM event like object that enables yout do stop propagation.\r\n\t\t *\r\n\t\t * @method on\r\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\r\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\r\n\t\t * @return {tinymce.ui.Control} Current control object.\r\n\t\t */\r\n\t\ton: function(name, callback) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tfunction resolveCallbackName(name) {\r\n\t\t\t\tvar callback, scope;\r\n\r\n\t\t\t\tif (typeof name != 'string') {\r\n\t\t\t\t\treturn name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn function(e) {\r\n\t\t\t\t\tif (!callback) {\r\n\t\t\t\t\t\tself.parentsAndSelf().each(function(ctrl) {\r\n\t\t\t\t\t\t\tvar callbacks = ctrl.settings.callbacks;\r\n\r\n\t\t\t\t\t\t\tif (callbacks && (callback = callbacks[name])) {\r\n\t\t\t\t\t\t\t\tscope = ctrl;\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!callback) {\r\n\t\t\t\t\t\te.action = name;\r\n\t\t\t\t\t\tthis.fire('execute', e);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn callback.call(scope, e);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tgetEventDispatcher(self).on(name, resolveCallbackName(callback));\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\r\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\r\n\t\t * by the specified name will be removed.\r\n\t\t *\r\n\t\t * @method off\r\n\t\t * @param {String} [name] Name for the event to unbind.\r\n\t\t * @param {function} [callback] Callback function to unbind.\r\n\t\t * @return {tinymce.ui.Control} Current control object.\r\n\t\t */\r\n\t\toff: function(name, callback) {\r\n\t\t\tgetEventDispatcher(this).off(name, callback);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\r\n\t\t * bound event handlers.\r\n\t\t *\r\n\t\t * @method fire\r\n\t\t * @param {String} name Name of the event to fire.\r\n\t\t * @param {Object} [args] Arguments to pass to the event.\r\n\t\t * @param {Boolean} [bubble] Value to control bubbling. Defaults to true.\r\n\t\t * @return {Object} Current arguments object.\r\n\t\t */\r\n\t\tfire: function(name, args, bubble) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\targs = args || {};\r\n\r\n\t\t\tif (!args.control) {\r\n\t\t\t\targs.control = self;\r\n\t\t\t}\r\n\r\n\t\t\targs = getEventDispatcher(self).fire(name, args);\r\n\r\n\t\t\t// Bubble event up to parents\r\n\t\t\tif (bubble !== false && self.parent) {\r\n\t\t\t\tvar parent = self.parent();\r\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\r\n\t\t\t\t\tparent.fire(name, args, false);\r\n\t\t\t\t\tparent = parent.parent();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn args;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified event has any listeners.\r\n\t\t *\r\n\t\t * @method hasEventListeners\r\n\t\t * @param {String} name Name of the event to check for.\r\n\t\t * @return {Boolean} True/false state if the event has listeners.\r\n\t\t */\r\n\t\thasEventListeners: function(name) {\r\n\t\t\treturn getEventDispatcher(this).has(name);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a control collection with all parent controls.\r\n\t\t *\r\n\t\t * @method parents\r\n\t\t * @param {String} selector Optional selector expression to find parents.\r\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\r\n\t\t */\r\n\t\tparents: function(selector) {\r\n\t\t\tvar self = this, ctrl, parents = new Collection();\r\n\r\n\t\t\t// Add each parent to collection\r\n\t\t\tfor (ctrl = self.parent(); ctrl; ctrl = ctrl.parent()) {\r\n\t\t\t\tparents.add(ctrl);\r\n\t\t\t}\r\n\r\n\t\t\t// Filter away everything that doesn't match the selector\r\n\t\t\tif (selector) {\r\n\t\t\t\tparents = parents.filter(selector);\r\n\t\t\t}\r\n\r\n\t\t\treturn parents;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the current control and it's parents.\r\n\t\t *\r\n\t\t * @method parentsAndSelf\r\n\t\t * @param {String} selector Optional selector expression to find parents.\r\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\r\n\t\t */\r\n\t\tparentsAndSelf: function(selector) {\r\n\t\t\treturn new Collection(this).add(this.parents(selector));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the control next to the current control.\r\n\t\t *\r\n\t\t * @method next\r\n\t\t * @return {tinymce.ui.Control} Next control instance.\r\n\t\t */\r\n\t\tnext: function() {\r\n\t\t\tvar parentControls = this.parent().items();\r\n\r\n\t\t\treturn parentControls[parentControls.indexOf(this) + 1];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the control previous to the current control.\r\n\t\t *\r\n\t\t * @method prev\r\n\t\t * @return {tinymce.ui.Control} Previous control instance.\r\n\t\t */\r\n\t\tprev: function() {\r\n\t\t\tvar parentControls = this.parent().items();\r\n\r\n\t\t\treturn parentControls[parentControls.indexOf(this) - 1];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the inner HTML of the control element.\r\n\t\t *\r\n\t\t * @method innerHtml\r\n\t\t * @param {String} html Html string to set as inner html.\r\n\t\t * @return {tinymce.ui.Control} Current control object.\r\n\t\t */\r\n\t\tinnerHtml: function(html) {\r\n\t\t\tthis.$el.html(html);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the control DOM element or sub element.\r\n\t\t *\r\n\t\t * @method getEl\r\n\t\t * @param {String} [suffix] Suffix to get element by.\r\n\t\t * @return {Element} HTML DOM element for the current control or it's children.\r\n\t\t */\r\n\t\tgetEl: function(suffix) {\r\n\t\t\tvar id = suffix ? this._id + '-' + suffix : this._id;\r\n\r\n\t\t\tif (!this._elmCache[id]) {\r\n\t\t\t\tthis._elmCache[id] = $('#' + id)[0];\r\n\t\t\t}\r\n\r\n\t\t\treturn this._elmCache[id];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the visible state to true.\r\n\t\t *\r\n\t\t * @method show\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tshow: function() {\r\n\t\t\treturn this.visible(true);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the visible state to false.\r\n\t\t *\r\n\t\t * @method hide\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\thide: function() {\r\n\t\t\treturn this.visible(false);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Focuses the current control.\r\n\t\t *\r\n\t\t * @method focus\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tfocus: function() {\r\n\t\t\ttry {\r\n\t\t\t\tthis.getEl().focus();\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore IE error\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Blurs the current control.\r\n\t\t *\r\n\t\t * @method blur\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tblur: function() {\r\n\t\t\tthis.getEl().blur();\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the specified aria property.\r\n\t\t *\r\n\t\t * @method aria\r\n\t\t * @param {String} name Name of the aria property to set.\r\n\t\t * @param {String} value Value of the aria property.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\taria: function(name, value) {\r\n\t\t\tvar self = this, elm = self.getEl(self.ariaTarget);\r\n\r\n\t\t\tif (typeof value === \"undefined\") {\r\n\t\t\t\treturn self._aria[name];\r\n\t\t\t}\r\n\r\n\t\t\tself._aria[name] = value;\r\n\r\n\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\telm.setAttribute(name == 'role' ? name : 'aria-' + name, value);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Encodes the specified string with HTML entities. It will also\r\n\t\t * translate the string to different languages.\r\n\t\t *\r\n\t\t * @method encode\r\n\t\t * @param {String/Object/Array} text Text to entity encode.\r\n\t\t * @param {Boolean} [translate=true] False if the contents shouldn't be translated.\r\n\t\t * @return {String} Encoded and possible traslated string.\r\n\t\t */\r\n\t\tencode: function(text, translate) {\r\n\t\t\tif (translate !== false) {\r\n\t\t\t\ttext = this.translate(text);\r\n\t\t\t}\r\n\r\n\t\t\treturn (text || '').replace(/[&<>\"]/g, function(match) {\r\n\t\t\t\treturn '&#' + match.charCodeAt(0) + ';';\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the translated string.\r\n\t\t *\r\n\t\t * @method translate\r\n\t\t * @param {String} text Text to translate.\r\n\t\t * @return {String} Translated string or the same as the input.\r\n\t\t */\r\n\t\ttranslate: function(text) {\r\n\t\t\treturn Control.translate ? Control.translate(text) : text;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds items before the current control.\r\n\t\t *\r\n\t\t * @method before\r\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to prepend before this control.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tbefore: function(items) {\r\n\t\t\tvar self = this, parent = self.parent();\r\n\r\n\t\t\tif (parent) {\r\n\t\t\t\tparent.insert(items, parent.items().indexOf(self), true);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds items after the current control.\r\n\t\t *\r\n\t\t * @method after\r\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to append after this control.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tafter: function(items) {\r\n\t\t\tvar self = this, parent = self.parent();\r\n\r\n\t\t\tif (parent) {\r\n\t\t\t\tparent.insert(items, parent.items().indexOf(self));\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the current control from DOM and from UI collections.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tvar self = this, elm = self.getEl(), parent = self.parent(), newItems, i;\r\n\r\n\t\t\tif (self.items) {\r\n\t\t\t\tvar controls = self.items().toArray();\r\n\t\t\t\ti = controls.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tcontrols[i].remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (parent && parent.items) {\r\n\t\t\t\tnewItems = [];\r\n\r\n\t\t\t\tparent.items().each(function(item) {\r\n\t\t\t\t\tif (item !== self) {\r\n\t\t\t\t\t\tnewItems.push(item);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tparent.items().set(newItems);\r\n\t\t\t\tparent._lastRect = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (self._eventsRoot && self._eventsRoot == self) {\r\n\t\t\t\t$(elm).off();\r\n\t\t\t}\r\n\r\n\t\t\tvar lookup = self.getRoot().controlIdLookup;\r\n\t\t\tif (lookup) {\r\n\t\t\t\tdelete lookup[self._id];\r\n\t\t\t}\r\n\r\n\t\t\tif (elm && elm.parentNode) {\r\n\t\t\t\telm.parentNode.removeChild(elm);\r\n\t\t\t}\r\n\r\n\t\t\tself.state.set('rendered', false);\r\n\t\t\tself.state.destroy();\r\n\r\n\t\t\tself.fire('remove');\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control before the specified element.\r\n\t\t *\r\n\t\t * @method renderBefore\r\n\t\t * @param {Element} elm Element to render before.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\trenderBefore: function(elm) {\r\n\t\t\t$(elm).before(this.renderHtml());\r\n\t\t\tthis.postRender();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control to the specified element.\r\n\t\t *\r\n\t\t * @method renderBefore\r\n\t\t * @param {Element} elm Element to render to.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\trenderTo: function(elm) {\r\n\t\t\t$(elm || this.getContainerElm()).append(this.renderHtml());\r\n\t\t\tthis.postRender();\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tpreRender: function() {\r\n\t\t},\r\n\r\n\t\trender: function() {\r\n\t\t},\r\n\r\n\t\trenderHtml: function() {\r\n\t\t\treturn '<div id=\"' + this._id + '\" class=\"' + this.classes + '\"></div>';\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Post render method. Called after the control has been rendered to the target.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, settings = self.settings, elm, box, parent, name, parentEventsRoot;\r\n\r\n\t\t\tself.$el = $(self.getEl());\r\n\t\t\tself.state.set('rendered', true);\r\n\r\n\t\t\t// Bind on<event> settings\r\n\t\t\tfor (name in settings) {\r\n\t\t\t\tif (name.indexOf(\"on\") === 0) {\r\n\t\t\t\t\tself.on(name.substr(2), settings[name]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (self._eventsRoot) {\r\n\t\t\t\tfor (parent = self.parent(); !parentEventsRoot && parent; parent = parent.parent()) {\r\n\t\t\t\t\tparentEventsRoot = parent._eventsRoot;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parentEventsRoot) {\r\n\t\t\t\t\tfor (name in parentEventsRoot._nativeEvents) {\r\n\t\t\t\t\t\tself._nativeEvents[name] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbindPendingEvents(self);\r\n\r\n\t\t\tif (settings.style) {\r\n\t\t\t\telm = self.getEl();\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\telm.setAttribute('style', settings.style);\r\n\t\t\t\t\telm.style.cssText = settings.style;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (self.settings.border) {\r\n\t\t\t\tbox = self.borderBox;\r\n\t\t\t\tself.$el.css({\r\n\t\t\t\t\t'border-top-width': box.top,\r\n\t\t\t\t\t'border-right-width': box.right,\r\n\t\t\t\t\t'border-bottom-width': box.bottom,\r\n\t\t\t\t\t'border-left-width': box.left\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Add instance to lookup\r\n\t\t\tvar root = self.getRoot();\r\n\t\t\tif (!root.controlIdLookup) {\r\n\t\t\t\troot.controlIdLookup = {};\r\n\t\t\t}\r\n\r\n\t\t\troot.controlIdLookup[self._id] = self;\r\n\r\n\t\t\tfor (var key in self._aria) {\r\n\t\t\t\tself.aria(key, self._aria[key]);\r\n\t\t\t}\r\n\r\n\t\t\tif (self.state.get('visible') === false) {\r\n\t\t\t\tself.getEl().style.display = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tself.bindStates();\r\n\r\n\t\t\tself.state.on('change:visible', function(e) {\r\n\t\t\t\tvar state = e.value, parentCtrl;\r\n\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tself.getEl().style.display = state === false ? 'none' : '';\r\n\r\n\t\t\t\t\t// Need to force a reflow here on IE 8\r\n\t\t\t\t\tself.getEl().getBoundingClientRect();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Parent container needs to reflow\r\n\t\t\t\tparentCtrl = self.parent();\r\n\t\t\t\tif (parentCtrl) {\r\n\t\t\t\t\tparentCtrl._lastRect = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.fire(state ? 'show' : 'hide');\r\n\r\n\t\t\t\tReflowQueue.add(self);\r\n\t\t\t});\r\n\r\n\t\t\tself.fire('postrender', {}, false);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Scrolls the current control into view.\r\n\t\t *\r\n\t\t * @method scrollIntoView\r\n\t\t * @param {String} align Alignment in view top|center|bottom.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tscrollIntoView: function(align) {\r\n\t\t\tfunction getOffset(elm, rootElm) {\r\n\t\t\t\tvar x, y, parent = elm;\r\n\r\n\t\t\t\tx = y = 0;\r\n\t\t\t\twhile (parent && parent != rootElm && parent.nodeType) {\r\n\t\t\t\t\tx += parent.offsetLeft || 0;\r\n\t\t\t\t\ty += parent.offsetTop || 0;\r\n\t\t\t\t\tparent = parent.offsetParent;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {x: x, y: y};\r\n\t\t\t}\r\n\r\n\t\t\tvar elm = this.getEl(), parentElm = elm.parentNode;\r\n\t\t\tvar x, y, width, height, parentWidth, parentHeight;\r\n\t\t\tvar pos = getOffset(elm, parentElm);\r\n\r\n\t\t\tx = pos.x;\r\n\t\t\ty = pos.y;\r\n\t\t\twidth = elm.offsetWidth;\r\n\t\t\theight = elm.offsetHeight;\r\n\t\t\tparentWidth = parentElm.clientWidth;\r\n\t\t\tparentHeight = parentElm.clientHeight;\r\n\r\n\t\t\tif (align == \"end\") {\r\n\t\t\t\tx -= parentWidth - width;\r\n\t\t\t\ty -= parentHeight - height;\r\n\t\t\t} else if (align == \"center\") {\r\n\t\t\t\tx -= (parentWidth / 2) - (width / 2);\r\n\t\t\t\ty -= (parentHeight / 2) - (height / 2);\r\n\t\t\t}\r\n\r\n\t\t\tparentElm.scrollLeft = x;\r\n\t\t\tparentElm.scrollTop = y;\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tgetRoot: function() {\r\n\t\t\tvar ctrl = this, rootControl, parents = [];\r\n\r\n\t\t\twhile (ctrl) {\r\n\t\t\t\tif (ctrl.rootControl) {\r\n\t\t\t\t\trootControl = ctrl.rootControl;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparents.push(ctrl);\r\n\t\t\t\trootControl = ctrl;\r\n\t\t\t\tctrl = ctrl.parent();\r\n\t\t\t}\r\n\r\n\t\t\tif (!rootControl) {\r\n\t\t\t\trootControl = this;\r\n\t\t\t}\r\n\r\n\t\t\tvar i = parents.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tparents[i].rootControl = rootControl;\r\n\t\t\t}\r\n\r\n\t\t\treturn rootControl;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Reflows the current control and it's parents.\r\n\t\t * This should be used after you for example append children to the current control so\r\n\t\t * that the layout managers know that they need to reposition everything.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\r\n\t\t *\r\n\t\t * @method reflow\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\treflow: function() {\r\n\t\t\tReflowQueue.remove(this);\r\n\r\n\t\t\tvar parent = this.parent();\r\n\t\t\tif (parent._layout && !parent._layout.isNative()) {\r\n\t\t\t\tparent.reflow();\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the parent container for the control.\r\n\t\t *\r\n\t\t * @method parent\r\n\t\t * @param {tinymce.ui.Container} parent Optional parent to set.\r\n\t\t * @return {tinymce.ui.Control} Parent control or the current control on a set action.\r\n\t\t */\r\n\t\t// parent: function(parent) {} -- Generated\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the text for the control.\r\n\t\t *\r\n\t\t * @method text\r\n\t\t * @param {String} value Value to set to control.\r\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\r\n\t\t */\r\n\t\t// text: function(value) {} -- Generated\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the disabled state on the control.\r\n\t\t *\r\n\t\t * @method disabled\r\n\t\t * @param {Boolean} state Value to set to control.\r\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\r\n\t\t */\r\n\t\t// disabled: function(state) {} -- Generated\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the active for the control.\r\n\t\t *\r\n\t\t * @method active\r\n\t\t * @param {Boolean} state Value to set to control.\r\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\r\n\t\t */\r\n\t\t// active: function(state) {} -- Generated\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the name for the control.\r\n\t\t *\r\n\t\t * @method name\r\n\t\t * @param {String} value Value to set to control.\r\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\r\n\t\t */\r\n\t\t// name: function(value) {} -- Generated\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the title for the control.\r\n\t\t *\r\n\t\t * @method title\r\n\t\t * @param {String} value Value to set to control.\r\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\r\n\t\t */\r\n\t\t// title: function(value) {} -- Generated\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the visible for the control.\r\n\t\t *\r\n\t\t * @method visible\r\n\t\t * @param {Boolean} state Value to set to control.\r\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\r\n\t\t */\r\n\t\t// visible: function(value) {} -- Generated\r\n\t};\r\n\r\n\t/**\r\n\t * Setup state properties.\r\n\t */\r\n\tTools.each('text title visible disabled active value'.split(' '), function(name) {\r\n\t\tproto[name] = function(value) {\r\n\t\t\tif (arguments.length === 0) {\r\n\t\t\t\treturn this.state.get(name);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof value != \"undefined\") {\r\n\t\t\t\tthis.state.set(name, value);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t};\r\n\t});\r\n\r\n\tControl = Class.extend(proto);\r\n\r\n\tfunction getEventDispatcher(obj) {\r\n\t\tif (!obj._eventDispatcher) {\r\n\t\t\tobj._eventDispatcher = new EventDispatcher({\r\n\t\t\t\tscope: obj,\r\n\t\t\t\ttoggleEvent: function(name, state) {\r\n\t\t\t\t\tif (state && EventDispatcher.isNative(name)) {\r\n\t\t\t\t\t\tif (!obj._nativeEvents) {\r\n\t\t\t\t\t\t\tobj._nativeEvents = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tobj._nativeEvents[name] = true;\r\n\r\n\t\t\t\t\t\tif (obj.state.get('rendered')) {\r\n\t\t\t\t\t\t\tbindPendingEvents(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn obj._eventDispatcher;\r\n\t}\r\n\r\n\tfunction bindPendingEvents(eventCtrl) {\r\n\t\tvar i, l, parents, eventRootCtrl, nativeEvents, name;\r\n\r\n\t\tfunction delegate(e) {\r\n\t\t\tvar control = eventCtrl.getParentCtrl(e.target);\r\n\r\n\t\t\tif (control) {\r\n\t\t\t\tcontrol.fire(e.type, e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction mouseLeaveHandler() {\r\n\t\t\tvar ctrl = eventRootCtrl._lastHoverCtrl;\r\n\r\n\t\t\tif (ctrl) {\r\n\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\r\n\r\n\t\t\t\tctrl.parents().each(function(ctrl) {\r\n\t\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\r\n\t\t\t\t});\r\n\r\n\t\t\t\teventRootCtrl._lastHoverCtrl = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction mouseEnterHandler(e) {\r\n\t\t\tvar ctrl = eventCtrl.getParentCtrl(e.target), lastCtrl = eventRootCtrl._lastHoverCtrl, idx = 0, i, parents, lastParents;\r\n\r\n\t\t\t// Over on a new control\r\n\t\t\tif (ctrl !== lastCtrl) {\r\n\t\t\t\teventRootCtrl._lastHoverCtrl = ctrl;\r\n\r\n\t\t\t\tparents = ctrl.parents().toArray().reverse();\r\n\t\t\t\tparents.push(ctrl);\r\n\r\n\t\t\t\tif (lastCtrl) {\r\n\t\t\t\t\tlastParents = lastCtrl.parents().toArray().reverse();\r\n\t\t\t\t\tlastParents.push(lastCtrl);\r\n\r\n\t\t\t\t\tfor (idx = 0; idx < lastParents.length; idx++) {\r\n\t\t\t\t\t\tif (parents[idx] !== lastParents[idx]) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (i = lastParents.length - 1; i >= idx; i--) {\r\n\t\t\t\t\t\tlastCtrl = lastParents[i];\r\n\t\t\t\t\t\tlastCtrl.fire(\"mouseleave\", {\r\n\t\t\t\t\t\t\ttarget: lastCtrl.getEl()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i = idx; i < parents.length; i++) {\r\n\t\t\t\t\tctrl = parents[i];\r\n\t\t\t\t\tctrl.fire(\"mouseenter\", {\r\n\t\t\t\t\t\ttarget: ctrl.getEl()\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction fixWheelEvent(e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (e.type == \"mousewheel\") {\r\n\t\t\t\te.deltaY = -1 / 40 * e.wheelDelta;\r\n\r\n\t\t\t\tif (e.wheelDeltaX) {\r\n\t\t\t\t\te.deltaX = -1 / 40 * e.wheelDeltaX;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\te.deltaX = 0;\r\n\t\t\t\te.deltaY = e.detail;\r\n\t\t\t}\r\n\r\n\t\t\te = eventCtrl.fire(\"wheel\", e);\r\n\t\t}\r\n\r\n\t\tnativeEvents = eventCtrl._nativeEvents;\r\n\t\tif (nativeEvents) {\r\n\t\t\t// Find event root element if it exists\r\n\t\t\tparents = eventCtrl.parents().toArray();\r\n\t\t\tparents.unshift(eventCtrl);\r\n\t\t\tfor (i = 0, l = parents.length; !eventRootCtrl && i < l; i++) {\r\n\t\t\t\teventRootCtrl = parents[i]._eventsRoot;\r\n\t\t\t}\r\n\r\n\t\t\t// Event root wasn't found the use the root control\r\n\t\t\tif (!eventRootCtrl) {\r\n\t\t\t\teventRootCtrl = parents[parents.length - 1] || eventCtrl;\r\n\t\t\t}\r\n\r\n\t\t\t// Set the eventsRoot property on children that didn't have it\r\n\t\t\teventCtrl._eventsRoot = eventRootCtrl;\r\n\t\t\tfor (l = i, i = 0; i < l; i++) {\r\n\t\t\t\tparents[i]._eventsRoot = eventRootCtrl;\r\n\t\t\t}\r\n\r\n\t\t\tvar eventRootDelegates = eventRootCtrl._delegates;\r\n\t\t\tif (!eventRootDelegates) {\r\n\t\t\t\teventRootDelegates = eventRootCtrl._delegates = {};\r\n\t\t\t}\r\n\r\n\t\t\t// Bind native event delegates\r\n\t\t\tfor (name in nativeEvents) {\r\n\t\t\t\tif (!nativeEvents) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (name === \"wheel\" && !hasWheelEventSupport) {\r\n\t\t\t\t\tif (hasMouseWheelEventSupport) {\r\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"mousewheel\", fixWheelEvent);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"DOMMouseScroll\", fixWheelEvent);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Special treatment for mousenter/mouseleave since these doesn't bubble\r\n\t\t\t\tif (name === \"mouseenter\" || name === \"mouseleave\") {\r\n\t\t\t\t\t// Fake mousenter/mouseleave\r\n\t\t\t\t\tif (!eventRootCtrl._hasMouseEnter) {\r\n\t\t\t\t\t\t$(eventRootCtrl.getEl()).on(\"mouseleave\", mouseLeaveHandler).on(\"mouseover\", mouseEnterHandler);\r\n\t\t\t\t\t\teventRootCtrl._hasMouseEnter = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (!eventRootDelegates[name]) {\r\n\t\t\t\t\t$(eventRootCtrl.getEl()).on(name, delegate);\r\n\t\t\t\t\teventRootDelegates[name] = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove the event once it's bound\r\n\t\t\t\tnativeEvents[name] = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn Control;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Factory.js\r\n\r\n/**\r\n * Factory.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*global tinymce:true */\r\n\r\n/**\r\n * This class is a factory for control instances. This enables you\r\n * to create instances of controls without having to require the UI controls directly.\r\n *\r\n * It also allow you to override or add new control types.\r\n *\r\n * @class tinymce.ui.Factory\r\n */\r\ndefine(\"tinymce/ui/Factory\", [], function() {\r\n\t\"use strict\";\r\n\r\n\tvar types = {}, namespaceInit;\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Adds a new control instance type to the factory.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {String} type Type name for example \"button\".\r\n\t\t * @param {function} typeClass Class type function.\r\n\t\t */\r\n\t\tadd: function(type, typeClass) {\r\n\t\t\ttypes[type.toLowerCase()] = typeClass;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified type exists or not.\r\n\t\t *\r\n\t\t * @method has\r\n\t\t * @param {String} type Type to look for.\r\n\t\t * @return {Boolean} true/false if the control by name exists.\r\n\t\t */\r\n\t\thas: function(type) {\r\n\t\t\treturn !!types[type.toLowerCase()];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates a new control instance based on the settings provided. The instance created will be\r\n\t\t * based on the specified type property it can also create whole structures of components out of\r\n\t\t * the specified JSON object.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * tinymce.ui.Factory.create({\r\n\t\t *     type: 'button',\r\n\t\t *     text: 'Hello world!'\r\n\t\t * });\r\n\t\t *\r\n\t\t * @method create\r\n\t\t * @param {Object/String} settings Name/Value object with items used to create the type.\r\n\t\t * @return {tinymce.ui.Control} Control instance based on the specified type.\r\n\t\t */\r\n\t\tcreate: function(type, settings) {\r\n\t\t\tvar ControlType, name, namespace;\r\n\r\n\t\t\t// Build type lookup\r\n\t\t\tif (!namespaceInit) {\r\n\t\t\t\tnamespace = tinymce.ui;\r\n\r\n\t\t\t\tfor (name in namespace) {\r\n\t\t\t\t\ttypes[name.toLowerCase()] = namespace[name];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnamespaceInit = true;\r\n\t\t\t}\r\n\r\n\t\t\t// If string is specified then use it as the type\r\n\t\t\tif (typeof type == 'string') {\r\n\t\t\t\tsettings = settings || {};\r\n\t\t\t\tsettings.type = type;\r\n\t\t\t} else {\r\n\t\t\t\tsettings = type;\r\n\t\t\t\ttype = settings.type;\r\n\t\t\t}\r\n\r\n\t\t\t// Find control type\r\n\t\t\ttype = type.toLowerCase();\r\n\t\t\tControlType = types[type];\r\n\r\n\t\t\t// #if debug\r\n\r\n\t\t\tif (!ControlType) {\r\n\t\t\t\tthrow new Error(\"Could not find control by type: \" + type);\r\n\t\t\t}\r\n\r\n\t\t\t// #endif\r\n\r\n\t\t\tControlType = new ControlType(settings);\r\n\t\t\tControlType.type = type; // Set the type on the instance, this will be used by the Selector engine\r\n\r\n\t\t\treturn ControlType;\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/KeyboardNavigation.js\r\n\r\n/**\r\n * KeyboardNavigation.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles keyboard navigation of controls and elements.\r\n *\r\n * @class tinymce.ui.KeyboardNavigation\r\n */\r\ndefine(\"tinymce/ui/KeyboardNavigation\", [\r\n], function() {\r\n\t\"use strict\";\r\n\r\n\t/**\r\n\t * This class handles all keyboard navigation for WAI-ARIA support. Each root container\r\n\t * gets an instance of this class.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\treturn function(settings) {\r\n\t\tvar root = settings.root, focusedElement, focusedControl;\r\n\r\n\t\tfunction isElement(node) {\r\n\t\t\treturn node && node.nodeType === 1;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tfocusedElement = document.activeElement;\r\n\t\t} catch (ex) {\r\n\t\t\t// IE sometimes fails to return a proper element\r\n\t\t\tfocusedElement = document.body;\r\n\t\t}\r\n\r\n\t\tfocusedControl = root.getParentCtrl(focusedElement);\r\n\r\n\t\t/**\r\n\t\t * Returns the currently focused elements wai aria role of the currently\r\n\t\t * focused element or specified element.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Element} elm Optional element to get role from.\r\n\t\t * @return {String} Role of specified element.\r\n\t\t */\r\n\t\tfunction getRole(elm) {\r\n\t\t\telm = elm || focusedElement;\r\n\r\n\t\t\tif (isElement(elm)) {\r\n\t\t\t\treturn elm.getAttribute('role');\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the wai role of the parent element of the currently\r\n\t\t * focused element or specified element.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Element} elm Optional element to get parent role from.\r\n\t\t * @return {String} Role of the first parent that has a role.\r\n\t\t */\r\n\t\tfunction getParentRole(elm) {\r\n\t\t\tvar role, parent = elm || focusedElement;\r\n\r\n\t\t\twhile ((parent = parent.parentNode)) {\r\n\t\t\t\tif ((role = getRole(parent))) {\r\n\t\t\t\t\treturn role;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns a wai aria property by name for example aria-selected.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {String} name Name of the aria property to get for example \"disabled\".\r\n\t\t * @return {String} Aria property value.\r\n\t\t */\r\n\t\tfunction getAriaProp(name) {\r\n\t\t\tvar elm = focusedElement;\r\n\r\n\t\t\tif (isElement(elm)) {\r\n\t\t\t\treturn elm.getAttribute('aria-' + name);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Is the element a text input element or not.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Element} elm Element to check if it's an text input element or not.\r\n\t\t * @return {Boolean} True/false if the element is a text element or not.\r\n\t\t */\r\n\t\tfunction isTextInputElement(elm) {\r\n\t\t\tvar tagName = elm.tagName.toUpperCase();\r\n\r\n\t\t\t// Notice: since type can be \"email\" etc we don't check the type\r\n\t\t\t// So all input elements gets treated as text input elements\r\n\t\t\treturn tagName == \"INPUT\" || tagName == \"TEXTAREA\" || tagName == \"SELECT\";\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the specified element can be focused or not.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Element} elm DOM element to check if it can be focused or not.\r\n\t\t * @return {Boolean} True/false if the element can have focus.\r\n\t\t */\r\n\t\tfunction canFocus(elm) {\r\n\t\t\tif (isTextInputElement(elm) && !elm.hidden) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif (/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns an array of focusable visible elements within the specified container element.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Element} elm DOM element to find focusable elements within.\r\n\t\t * @return {Array} Array of focusable elements.\r\n\t\t */\r\n\t\tfunction getFocusElements(elm) {\r\n\t\t\tvar elements = [];\r\n\r\n\t\t\tfunction collect(elm) {\r\n\t\t\t\tif (elm.nodeType != 1 || elm.style.display == 'none') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (canFocus(elm)) {\r\n\t\t\t\t\telements.push(elm);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0; i < elm.childNodes.length; i++) {\r\n\t\t\t\t\tcollect(elm.childNodes[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcollect(elm || root.getEl());\r\n\r\n\t\t\treturn elements;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the navigation root control for the specified control. The navigation root\r\n\t\t * is the control that the keyboard navigation gets scoped to for example a menubar or toolbar group.\r\n\t\t * It will look for parents of the specified target control or the currently focused control if this option is omitted.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {tinymce.ui.Control} targetControl Optional target control to find root of.\r\n\t\t * @return {tinymce.ui.Control} Navigation root control.\r\n\t\t */\r\n\t\tfunction getNavigationRoot(targetControl) {\r\n\t\t\tvar navigationRoot, controls;\r\n\r\n\t\t\ttargetControl = targetControl || focusedControl;\r\n\t\t\tcontrols = targetControl.parents().toArray();\r\n\t\t\tcontrols.unshift(targetControl);\r\n\r\n\t\t\tfor (var i = 0; i < controls.length; i++) {\r\n\t\t\t\tnavigationRoot = controls[i];\r\n\r\n\t\t\t\tif (navigationRoot.settings.ariaRoot) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn navigationRoot;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Focuses the first item in the specified targetControl element or the last aria index if the\r\n\t\t * navigation root has the ariaRemember option enabled.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {tinymce.ui.Control} targetControl Target control to focus the first item in.\r\n\t\t */\r\n\t\tfunction focusFirst(targetControl) {\r\n\t\t\tvar navigationRoot = getNavigationRoot(targetControl);\r\n\t\t\tvar focusElements = getFocusElements(navigationRoot.getEl());\r\n\r\n\t\t\tif (navigationRoot.settings.ariaRemember && \"lastAriaIndex\" in navigationRoot) {\r\n\t\t\t\tmoveFocusToIndex(navigationRoot.lastAriaIndex, focusElements);\r\n\t\t\t} else {\r\n\t\t\t\tmoveFocusToIndex(0, focusElements);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the focus to the specified index within the elements list.\r\n\t\t * This will scope the index to the size of the element list if it changed.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Number} idx Specified index to move to.\r\n\t\t * @param {Array} elements Array with dom elements to move focus within.\r\n\t\t * @return {Number} Input index or a changed index if it was out of range.\r\n\t\t */\r\n\t\tfunction moveFocusToIndex(idx, elements) {\r\n\t\t\tif (idx < 0) {\r\n\t\t\t\tidx = elements.length - 1;\r\n\t\t\t} else if (idx >= elements.length) {\r\n\t\t\t\tidx = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (elements[idx]) {\r\n\t\t\t\telements[idx].focus();\r\n\t\t\t}\r\n\r\n\t\t\treturn idx;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the focus forwards or backwards.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Number} dir Direction to move in positive means forward, negative means backwards.\r\n\t\t * @param {Array} elements Optional array of elements to move within defaults to the current navigation roots elements.\r\n\t\t */\r\n\t\tfunction moveFocus(dir, elements) {\r\n\t\t\tvar idx = -1, navigationRoot = getNavigationRoot();\r\n\r\n\t\t\telements = elements || getFocusElements(navigationRoot.getEl());\r\n\r\n\t\t\tfor (var i = 0; i < elements.length; i++) {\r\n\t\t\t\tif (elements[i] === focusedElement) {\r\n\t\t\t\t\tidx = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tidx += dir;\r\n\t\t\tnavigationRoot.lastAriaIndex = moveFocusToIndex(idx, elements);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the focus to the left this is called by the left key.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tfunction left() {\r\n\t\t\tvar parentRole = getParentRole();\r\n\r\n\t\t\tif (parentRole == \"tablist\") {\r\n\t\t\t\tmoveFocus(-1, getFocusElements(focusedElement.parentNode));\r\n\t\t\t} else if (focusedControl.parent().submenu) {\r\n\t\t\t\tcancel();\r\n\t\t\t} else {\r\n\t\t\t\tmoveFocus(-1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the focus to the right this is called by the right key.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tfunction right() {\r\n\t\t\tvar role = getRole(), parentRole = getParentRole();\r\n\r\n\t\t\tif (parentRole == \"tablist\") {\r\n\t\t\t\tmoveFocus(1, getFocusElements(focusedElement.parentNode));\r\n\t\t\t} else if (role == \"menuitem\" && parentRole == \"menu\" && getAriaProp('haspopup')) {\r\n\t\t\t\tenter();\r\n\t\t\t} else {\r\n\t\t\t\tmoveFocus(1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the focus to the up this is called by the up key.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tfunction up() {\r\n\t\t\tmoveFocus(-1);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the focus to the up this is called by the down key.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tfunction down() {\r\n\t\t\tvar role = getRole(), parentRole = getParentRole();\r\n\r\n\t\t\tif (role == \"menuitem\" && parentRole == \"menubar\") {\r\n\t\t\t\tenter();\r\n\t\t\t} else if (role == \"button\" && getAriaProp('haspopup')) {\r\n\t\t\t\tenter({key: 'down'});\r\n\t\t\t} else {\r\n\t\t\t\tmoveFocus(1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves the focus to the next item or previous item depending on shift key.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {DOMEvent} e DOM event object.\r\n\t\t */\r\n\t\tfunction tab(e) {\r\n\t\t\tvar parentRole = getParentRole();\r\n\r\n\t\t\tif (parentRole == \"tablist\") {\r\n\t\t\t\tvar elm = getFocusElements(focusedControl.getEl('body'))[0];\r\n\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\telm.focus();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmoveFocus(e.shiftKey ? -1 : 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Calls the cancel event on the currently focused control. This is normally done using the Esc key.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tfunction cancel() {\r\n\t\t\tfocusedControl.fire('cancel');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Calls the click event on the currently focused control. This is normally done using the Enter/Space keys.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Object} aria Optional aria data to pass along with the enter event.\r\n\t\t */\r\n\t\tfunction enter(aria) {\r\n\t\t\taria = aria || {};\r\n\t\t\tfocusedControl.fire('click', {target: focusedElement, aria: aria});\r\n\t\t}\r\n\r\n\t\troot.on('keydown', function(e) {\r\n\t\t\tfunction handleNonTabOrEscEvent(e, handler) {\r\n\t\t\t\t// Ignore non tab keys for text elements\r\n\t\t\t\tif (isTextInputElement(focusedElement)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (getRole(focusedElement) === 'slider') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (handler(e) !== false) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (e.isDefaultPrevented()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (e.keyCode) {\r\n\t\t\t\tcase 37: // DOM_VK_LEFT\r\n\t\t\t\t\thandleNonTabOrEscEvent(e, left);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 39: // DOM_VK_RIGHT\r\n\t\t\t\t\thandleNonTabOrEscEvent(e, right);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 38: // DOM_VK_UP\r\n\t\t\t\t\thandleNonTabOrEscEvent(e, up);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 40: // DOM_VK_DOWN\r\n\t\t\t\t\thandleNonTabOrEscEvent(e, down);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 27: // DOM_VK_ESCAPE\r\n\t\t\t\t\tcancel();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 14: // DOM_VK_ENTER\r\n\t\t\t\tcase 13: // DOM_VK_RETURN\r\n\t\t\t\tcase 32: // DOM_VK_SPACE\r\n\t\t\t\t\thandleNonTabOrEscEvent(e, enter);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 9: // DOM_VK_TAB\r\n\t\t\t\t\tif (tab(e) !== false) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\troot.on('focusin', function(e) {\r\n\t\t\tfocusedElement = e.target;\r\n\t\t\tfocusedControl = e.control;\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tfocusFirst: focusFirst\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Container.js\r\n\r\n/**\r\n * Container.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Container control. This is extended by all controls that can have\r\n * children such as panels etc. You can also use this class directly as an\r\n * generic container instance. The container doesn't have any specific role or style.\r\n *\r\n * @-x-less Container.less\r\n * @class tinymce.ui.Container\r\n * @extends tinymce.ui.Control\r\n */\r\ndefine(\"tinymce/ui/Container\", [\r\n\t\"tinymce/ui/Control\",\r\n\t\"tinymce/ui/Collection\",\r\n\t\"tinymce/ui/Selector\",\r\n\t\"tinymce/ui/Factory\",\r\n\t\"tinymce/ui/KeyboardNavigation\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/ui/ClassList\",\r\n\t\"tinymce/ui/ReflowQueue\"\r\n], function(Control, Collection, Selector, Factory, KeyboardNavigation, Tools, $, ClassList, ReflowQueue) {\r\n\t\"use strict\";\r\n\r\n\tvar selectorCache = {};\r\n\r\n\treturn Control.extend({\r\n\t\t/**\r\n\t\t * Constructs a new control instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Array} items Items to add to container in JSON format or control instances.\r\n\t\t * @setting {String} layout Layout manager by name to use.\r\n\t\t * @setting {Object} defaults Default settings to apply to all items.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tsettings = self.settings;\r\n\r\n\t\t\tif (settings.fixed) {\r\n\t\t\t\tself.state.set('fixed', true);\r\n\t\t\t}\r\n\r\n\t\t\tself._items = new Collection();\r\n\r\n\t\t\tif (self.isRtl()) {\r\n\t\t\t\tself.classes.add('rtl');\r\n\t\t\t}\r\n\r\n\t\t\tself.bodyClasses = new ClassList(function() {\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tself.getEl('body').className = this.toString();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.bodyClasses.prefix = self.classPrefix;\r\n\r\n\t\t\tself.classes.add('container');\r\n\t\t\tself.bodyClasses.add('container-body');\r\n\r\n\t\t\tif (settings.containerCls) {\r\n\t\t\t\tself.classes.add(settings.containerCls);\r\n\t\t\t}\r\n\r\n\t\t\tself._layout = Factory.create((settings.layout || '') + 'layout');\r\n\r\n\t\t\tif (self.settings.items) {\r\n\t\t\t\tself.add(self.settings.items);\r\n\t\t\t} else {\r\n\t\t\t\tself.add(self.render());\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: Fix this!\r\n\t\t\tself._hasBody = true;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a collection of child items that the container currently have.\r\n\t\t *\r\n\t\t * @method items\r\n\t\t * @return {tinymce.ui.Collection} Control collection direct child controls.\r\n\t\t */\r\n\t\titems: function() {\r\n\t\t\treturn this._items;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Find child controls by selector.\r\n\t\t *\r\n\t\t * @method find\r\n\t\t * @param {String} selector Selector CSS pattern to find children by.\r\n\t\t * @return {tinymce.ui.Collection} Control collection with child controls.\r\n\t\t */\r\n\t\tfind: function(selector) {\r\n\t\t\tselector = selectorCache[selector] = selectorCache[selector] || new Selector(selector);\r\n\r\n\t\t\treturn selector.find(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds one or many items to the current container. This will create instances of\r\n\t\t * the object representations if needed.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {Array/Object/tinymce.ui.Control} items Array or item that will be added to the container.\r\n\t\t * @return {tinymce.ui.Collection} Current collection control.\r\n\t\t */\r\n\t\tadd: function(items) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.items().add(self.create(items)).parent(self);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Focuses the current container instance. This will look\r\n\t\t * for the first control in the container and focus that.\r\n\t\t *\r\n\t\t * @method focus\r\n\t\t * @param {Boolean} keyboard Optional true/false if the focus was a keyboard focus or not.\r\n\t\t * @return {tinymce.ui.Collection} Current instance.\r\n\t\t */\r\n\t\tfocus: function(keyboard) {\r\n\t\t\tvar self = this, focusCtrl, keyboardNav, items;\r\n\r\n\t\t\tif (keyboard) {\r\n\t\t\t\tkeyboardNav = self.keyboardNav || self.parents().eq(-1)[0].keyboardNav;\r\n\r\n\t\t\t\tif (keyboardNav) {\r\n\t\t\t\t\tkeyboardNav.focusFirst(self);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\titems = self.find('*');\r\n\r\n\t\t\t// TODO: Figure out a better way to auto focus alert dialog buttons\r\n\t\t\tif (self.statusbar) {\r\n\t\t\t\titems.add(self.statusbar.items());\r\n\t\t\t}\r\n\r\n\t\t\titems.each(function(ctrl) {\r\n\t\t\t\tif (ctrl.settings.autofocus) {\r\n\t\t\t\t\tfocusCtrl = null;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ctrl.canFocus) {\r\n\t\t\t\t\tfocusCtrl = focusCtrl || ctrl;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (focusCtrl) {\r\n\t\t\t\tfocusCtrl.focus();\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Replaces the specified child control with a new control.\r\n\t\t *\r\n\t\t * @method replace\r\n\t\t * @param {tinymce.ui.Control} oldItem Old item to be replaced.\r\n\t\t * @param {tinymce.ui.Control} newItem New item to be inserted.\r\n\t\t */\r\n\t\treplace: function(oldItem, newItem) {\r\n\t\t\tvar ctrlElm, items = this.items(), i = items.length;\r\n\r\n\t\t\t// Replace the item in collection\r\n\t\t\twhile (i--) {\r\n\t\t\t\tif (items[i] === oldItem) {\r\n\t\t\t\t\titems[i] = newItem;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (i >= 0) {\r\n\t\t\t\t// Remove new item from DOM\r\n\t\t\t\tctrlElm = newItem.getEl();\r\n\t\t\t\tif (ctrlElm) {\r\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove old item from DOM\r\n\t\t\t\tctrlElm = oldItem.getEl();\r\n\t\t\t\tif (ctrlElm) {\r\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Adopt the item\r\n\t\t\tnewItem.parent(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates the specified items. If any of the items is plain JSON style objects\r\n\t\t * it will convert these into real tinymce.ui.Control instances.\r\n\t\t *\r\n\t\t * @method create\r\n\t\t * @param {Array} items Array of items to convert into control instances.\r\n\t\t * @return {Array} Array with control instances.\r\n\t\t */\r\n\t\tcreate: function(items) {\r\n\t\t\tvar self = this, settings, ctrlItems = [];\r\n\r\n\t\t\t// Non array structure, then force it into an array\r\n\t\t\tif (!Tools.isArray(items)) {\r\n\t\t\t\titems = [items];\r\n\t\t\t}\r\n\r\n\t\t\t// Add default type to each child control\r\n\t\t\tTools.each(items, function(item) {\r\n\t\t\t\tif (item) {\r\n\t\t\t\t\t// Construct item if needed\r\n\t\t\t\t\tif (!(item instanceof Control)) {\r\n\t\t\t\t\t\t// Name only then convert it to an object\r\n\t\t\t\t\t\tif (typeof item == \"string\") {\r\n\t\t\t\t\t\t\titem = {type: item};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Create control instance based on input settings and default settings\r\n\t\t\t\t\t\tsettings = Tools.extend({}, self.settings.defaults, item);\r\n\t\t\t\t\t\titem.type = settings.type = settings.type || item.type || self.settings.defaultType ||\r\n\t\t\t\t\t\t\t(settings.defaults ? settings.defaults.type : null);\r\n\t\t\t\t\t\titem = Factory.create(settings);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctrlItems.push(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn ctrlItems;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders new control instances.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\trenderNew: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// Render any new items\r\n\t\t\tself.items().each(function(ctrl, index) {\r\n\t\t\t\tvar containerElm;\r\n\r\n\t\t\t\tctrl.parent(self);\r\n\r\n\t\t\t\tif (!ctrl.state.get('rendered')) {\r\n\t\t\t\t\tcontainerElm = self.getEl('body');\r\n\r\n\t\t\t\t\t// Insert or append the item\r\n\t\t\t\t\tif (containerElm.hasChildNodes() && index <= containerElm.childNodes.length - 1) {\r\n\t\t\t\t\t\t$(containerElm.childNodes[index]).before(ctrl.renderHtml());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(containerElm).append(ctrl.renderHtml());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctrl.postRender();\r\n\t\t\t\t\tReflowQueue.add(ctrl);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself._layout.applyClasses(self.items().filter(':visible'));\r\n\t\t\tself._lastRect = null;\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Appends new instances to the current container.\r\n\t\t *\r\n\t\t * @method append\r\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to append.\r\n\t\t * @return {tinymce.ui.Container} Current container instance.\r\n\t\t */\r\n\t\tappend: function(items) {\r\n\t\t\treturn this.add(items).renderNew();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Prepends new instances to the current container.\r\n\t\t *\r\n\t\t * @method prepend\r\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to prepend.\r\n\t\t * @return {tinymce.ui.Container} Current container instance.\r\n\t\t */\r\n\t\tprepend: function(items) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.items().set(self.create(items).concat(self.items().toArray()));\r\n\r\n\t\t\treturn self.renderNew();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Inserts an control at a specific index.\r\n\t\t *\r\n\t\t * @method insert\r\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to insert.\r\n\t\t * @param {Number} index Index to insert controls at.\r\n\t\t * @param {Boolean} [before=false] Inserts controls before the index.\r\n\t\t */\r\n\t\tinsert: function(items, index, before) {\r\n\t\t\tvar self = this, curItems, beforeItems, afterItems;\r\n\r\n\t\t\titems = self.create(items);\r\n\t\t\tcurItems = self.items();\r\n\r\n\t\t\tif (!before && index < curItems.length - 1) {\r\n\t\t\t\tindex += 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (index >= 0 && index < curItems.length) {\r\n\t\t\t\tbeforeItems = curItems.slice(0, index).toArray();\r\n\t\t\t\tafterItems = curItems.slice(index).toArray();\r\n\t\t\t\tcurItems.set(beforeItems.concat(items, afterItems));\r\n\t\t\t}\r\n\r\n\t\t\treturn self.renderNew();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Populates the form fields from the specified JSON data object.\r\n\t\t *\r\n\t\t * Control items in the form that matches the data will have it's value set.\r\n\t\t *\r\n\t\t * @method fromJSON\r\n\t\t * @param {Object} data JSON data object to set control values by.\r\n\t\t * @return {tinymce.ui.Container} Current form instance.\r\n\t\t */\r\n\t\tfromJSON: function(data) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tfor (var name in data) {\r\n\t\t\t\tself.find('#' + name).value(data[name]);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Serializes the form into a JSON object by getting all items\r\n\t\t * that has a name and a value.\r\n\t\t *\r\n\t\t * @method toJSON\r\n\t\t * @return {Object} JSON object with form data.\r\n\t\t */\r\n\t\ttoJSON: function() {\r\n\t\t\tvar self = this, data = {};\r\n\r\n\t\t\tself.find('*').each(function(ctrl) {\r\n\t\t\t\tvar name = ctrl.name(), value = ctrl.value();\r\n\r\n\t\t\t\tif (name && typeof value != \"undefined\") {\r\n\t\t\t\t\tdata[name] = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, layout = self._layout, role = this.settings.role;\r\n\r\n\t\t\tself.preRender();\r\n\t\t\tlayout.preRender(self);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (role ? ' role=\"' + this.settings.role + '\"' : '') + '>' +\r\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\r\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Post render method. Called after the control has been rendered to the target.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t * @return {tinymce.ui.Container} Current combobox instance.\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, box;\r\n\r\n\t\t\tself.items().exec('postRender');\r\n\t\t\tself._super();\r\n\r\n\t\t\tself._layout.postRender(self);\r\n\t\t\tself.state.set('rendered', true);\r\n\r\n\t\t\tif (self.settings.style) {\r\n\t\t\t\tself.$el.css(self.settings.style);\r\n\t\t\t}\r\n\r\n\t\t\tif (self.settings.border) {\r\n\t\t\t\tbox = self.borderBox;\r\n\t\t\t\tself.$el.css({\r\n\t\t\t\t\t'border-top-width': box.top,\r\n\t\t\t\t\t'border-right-width': box.right,\r\n\t\t\t\t\t'border-bottom-width': box.bottom,\r\n\t\t\t\t\t'border-left-width': box.left\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.parent()) {\r\n\t\t\t\tself.keyboardNav = new KeyboardNavigation({\r\n\t\t\t\t\troot: self\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Initializes the current controls layout rect.\r\n\t\t * This will be executed by the layout managers to determine the\r\n\t\t * default minWidth/minHeight etc.\r\n\t\t *\r\n\t\t * @method initLayoutRect\r\n\t\t * @return {Object} Layout rect instance.\r\n\t\t */\r\n\t\tinitLayoutRect: function() {\r\n\t\t\tvar self = this, layoutRect = self._super();\r\n\r\n\t\t\t// Recalc container size by asking layout manager\r\n\t\t\tself._layout.recalc(self);\r\n\r\n\t\t\treturn layoutRect;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the current container.\r\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t */\r\n\t\trecalc: function() {\r\n\t\t\tvar self = this, rect = self._layoutRect, lastRect = self._lastRect;\r\n\r\n\t\t\tif (!lastRect || lastRect.w != rect.w || lastRect.h != rect.h) {\r\n\t\t\t\tself._layout.recalc(self);\r\n\t\t\t\trect = self.layoutRect();\r\n\t\t\t\tself._lastRect = {x: rect.x, y: rect.y, w: rect.w, h: rect.h};\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Reflows the current container and it's children and possible parents.\r\n\t\t * This should be used after you for example append children to the current control so\r\n\t\t * that the layout managers know that they need to reposition everything.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\r\n\t\t *\r\n\t\t * @method reflow\r\n\t\t * @return {tinymce.ui.Container} Current container instance.\r\n\t\t */\r\n\t\treflow: function() {\r\n\t\t\tvar i;\r\n\r\n\t\t\tReflowQueue.remove(this);\r\n\r\n\t\t\tif (this.visible()) {\r\n\t\t\t\tControl.repaintControls = [];\r\n\t\t\t\tControl.repaintControls.map = {};\r\n\r\n\t\t\t\tthis.recalc();\r\n\t\t\t\ti = Control.repaintControls.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tControl.repaintControls[i].repaint();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: Fix me!\r\n\t\t\t\tif (this.settings.layout !== \"flow\" && this.settings.layout !== \"stack\") {\r\n\t\t\t\t\tthis.repaint();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tControl.repaintControls = [];\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/DragHelper.js\r\n\r\n/**\r\n * DragHelper.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Drag/drop helper class.\r\n *\r\n * @example\r\n * var dragHelper = new tinymce.ui.DragHelper('mydiv', {\r\n *     start: function(evt) {\r\n *     },\r\n *\r\n *     drag: function(evt) {\r\n *     },\r\n *\r\n *     end: function(evt) {\r\n *     }\r\n * });\r\n *\r\n * @class tinymce.ui.DragHelper\r\n */\r\ndefine(\"tinymce/ui/DragHelper\", [\r\n\t\"tinymce/dom/DomQuery\"\r\n], function($) {\r\n\t\"use strict\";\r\n\r\n\tfunction getDocumentSize(doc) {\r\n\t\tvar documentElement, body, scrollWidth, clientWidth;\r\n\t\tvar offsetWidth, scrollHeight, clientHeight, offsetHeight, max = Math.max;\r\n\r\n\t\tdocumentElement = doc.documentElement;\r\n\t\tbody = doc.body;\r\n\r\n\t\tscrollWidth = max(documentElement.scrollWidth, body.scrollWidth);\r\n\t\tclientWidth = max(documentElement.clientWidth, body.clientWidth);\r\n\t\toffsetWidth = max(documentElement.offsetWidth, body.offsetWidth);\r\n\r\n\t\tscrollHeight = max(documentElement.scrollHeight, body.scrollHeight);\r\n\t\tclientHeight = max(documentElement.clientHeight, body.clientHeight);\r\n\t\toffsetHeight = max(documentElement.offsetHeight, body.offsetHeight);\r\n\r\n\t\treturn {\r\n\t\t\twidth: scrollWidth < offsetWidth ? clientWidth : scrollWidth,\r\n\t\t\theight: scrollHeight < offsetHeight ? clientHeight : scrollHeight\r\n\t\t};\r\n\t}\r\n\r\n\tfunction updateWithTouchData(e) {\r\n\t\tvar keys, i;\r\n\r\n\t\tif (e.changedTouches) {\r\n\t\t\tkeys = \"screenX screenY pageX pageY clientX clientY\".split(' ');\r\n\t\t\tfor (i = 0; i < keys.length; i++) {\r\n\t\t\t\te[keys[i]] = e.changedTouches[0][keys[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn function(id, settings) {\r\n\t\tvar $eventOverlay, doc = settings.document || document, downButton, start, stop, drag, startX, startY;\r\n\r\n\t\tsettings = settings || {};\r\n\r\n\t\tfunction getHandleElm() {\r\n\t\t\treturn doc.getElementById(settings.handle || id);\r\n\t\t}\r\n\r\n\t\tstart = function(e) {\r\n\t\t\tvar docSize = getDocumentSize(doc), handleElm, cursor;\r\n\r\n\t\t\tupdateWithTouchData(e);\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\tdownButton = e.button;\r\n\t\t\thandleElm = getHandleElm();\r\n\t\t\tstartX = e.screenX;\r\n\t\t\tstartY = e.screenY;\r\n\r\n\t\t\t// Grab cursor from handle so we can place it on overlay\r\n\t\t\tif (window.getComputedStyle) {\r\n\t\t\t\tcursor = window.getComputedStyle(handleElm, null).getPropertyValue(\"cursor\");\r\n\t\t\t} else {\r\n\t\t\t\tcursor = handleElm.runtimeStyle.cursor;\r\n\t\t\t}\r\n\r\n\t\t\t$eventOverlay = $('<div>').css({\r\n\t\t\t\tposition: \"absolute\",\r\n\t\t\t\ttop: 0, left: 0,\r\n\t\t\t\twidth: docSize.width,\r\n\t\t\t\theight: docSize.height,\r\n\t\t\t\tzIndex: 0x7FFFFFFF,\r\n\t\t\t\topacity: 0.0001,\r\n\t\t\t\tcursor: cursor\r\n\t\t\t}).appendTo(doc.body);\r\n\r\n\t\t\t$(doc).on('mousemove touchmove', drag).on('mouseup touchend', stop);\r\n\r\n\t\t\tsettings.start(e);\r\n\t\t};\r\n\r\n\t\tdrag = function(e) {\r\n\t\t\tupdateWithTouchData(e);\r\n\r\n\t\t\tif (e.button !== downButton) {\r\n\t\t\t\treturn stop(e);\r\n\t\t\t}\r\n\r\n\t\t\te.deltaX = e.screenX - startX;\r\n\t\t\te.deltaY = e.screenY - startY;\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\tsettings.drag(e);\r\n\t\t};\r\n\r\n\t\tstop = function(e) {\r\n\t\t\tupdateWithTouchData(e);\r\n\r\n\t\t\t$(doc).off('mousemove touchmove', drag).off('mouseup touchend', stop);\r\n\r\n\t\t\t$eventOverlay.remove();\r\n\r\n\t\t\tif (settings.stop) {\r\n\t\t\t\tsettings.stop(e);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Destroys the drag/drop helper instance.\r\n\t\t *\r\n\t\t * @method destroy\r\n\t\t */\r\n\t\tthis.destroy = function() {\r\n\t\t\t$(getHandleElm()).off();\r\n\t\t};\r\n\r\n\t\t$(getHandleElm()).on('mousedown touchstart', start);\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Scrollable.js\r\n\r\n/**\r\n * Scrollable.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This mixin makes controls scrollable using custom scrollbars.\r\n *\r\n * @-x-less Scrollable.less\r\n * @mixin tinymce.ui.Scrollable\r\n */\r\ndefine(\"tinymce/ui/Scrollable\", [\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/ui/DragHelper\"\r\n], function($, DragHelper) {\r\n\t\"use strict\";\r\n\r\n\treturn {\r\n\t\tinit: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on('repaint', self.renderScroll);\r\n\t\t},\r\n\r\n\t\trenderScroll: function() {\r\n\t\t\tvar self = this, margin = 2;\r\n\r\n\t\t\tfunction repaintScroll() {\r\n\t\t\t\tvar hasScrollH, hasScrollV, bodyElm;\r\n\r\n\t\t\t\tfunction repaintAxis(axisName, posName, sizeName, contentSizeName, hasScroll, ax) {\r\n\t\t\t\t\tvar containerElm, scrollBarElm, scrollThumbElm;\r\n\t\t\t\t\tvar containerSize, scrollSize, ratio, rect;\r\n\t\t\t\t\tvar posNameLower, sizeNameLower;\r\n\r\n\t\t\t\t\tscrollBarElm = self.getEl('scroll' + axisName);\r\n\t\t\t\t\tif (scrollBarElm) {\r\n\t\t\t\t\t\tposNameLower = posName.toLowerCase();\r\n\t\t\t\t\t\tsizeNameLower = sizeName.toLowerCase();\r\n\r\n\t\t\t\t\t\t$(self.getEl('absend')).css(posNameLower, self.layoutRect()[contentSizeName] - 1);\r\n\r\n\t\t\t\t\t\tif (!hasScroll) {\r\n\t\t\t\t\t\t\t$(scrollBarElm).css('display', 'none');\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(scrollBarElm).css('display', 'block');\r\n\t\t\t\t\t\tcontainerElm = self.getEl('body');\r\n\t\t\t\t\t\tscrollThumbElm = self.getEl('scroll' + axisName + \"t\");\r\n\t\t\t\t\t\tcontainerSize = containerElm[\"client\" + sizeName] - (margin * 2);\r\n\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? scrollBarElm[\"client\" + ax] : 0;\r\n\t\t\t\t\t\tscrollSize = containerElm[\"scroll\" + sizeName];\r\n\t\t\t\t\t\tratio = containerSize / scrollSize;\r\n\r\n\t\t\t\t\t\trect = {};\r\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"offset\" + posName] + margin;\r\n\t\t\t\t\t\trect[sizeNameLower] = containerSize;\r\n\t\t\t\t\t\t$(scrollBarElm).css(rect);\r\n\r\n\t\t\t\t\t\trect = {};\r\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"scroll\" + posName] * ratio;\r\n\t\t\t\t\t\trect[sizeNameLower] = containerSize * ratio;\r\n\t\t\t\t\t\t$(scrollThumbElm).css(rect);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbodyElm = self.getEl('body');\r\n\t\t\t\thasScrollH = bodyElm.scrollWidth > bodyElm.clientWidth;\r\n\t\t\t\thasScrollV = bodyElm.scrollHeight > bodyElm.clientHeight;\r\n\r\n\t\t\t\trepaintAxis(\"h\", \"Left\", \"Width\", \"contentW\", hasScrollH, \"Height\");\r\n\t\t\t\trepaintAxis(\"v\", \"Top\", \"Height\", \"contentH\", hasScrollV, \"Width\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction addScroll() {\r\n\t\t\t\tfunction addScrollAxis(axisName, posName, sizeName, deltaPosName, ax) {\r\n\t\t\t\t\tvar scrollStart, axisId = self._id + '-scroll' + axisName, prefix = self.classPrefix;\r\n\r\n\t\t\t\t\t$(self.getEl()).append(\r\n\t\t\t\t\t\t'<div id=\"' + axisId + '\" class=\"' + prefix + 'scrollbar ' + prefix + 'scrollbar-' + axisName + '\">' +\r\n\t\t\t\t\t\t\t'<div id=\"' + axisId + 't\" class=\"' + prefix + 'scrollbar-thumb\"></div>' +\r\n\t\t\t\t\t\t'</div>'\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tself.draghelper = new DragHelper(axisId + 't', {\r\n\t\t\t\t\t\tstart: function() {\r\n\t\t\t\t\t\t\tscrollStart = self.getEl('body')[\"scroll\" + posName];\r\n\t\t\t\t\t\t\t$('#' + axisId).addClass(prefix + 'active');\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tdrag: function(e) {\r\n\t\t\t\t\t\t\tvar ratio, hasScrollH, hasScrollV, containerSize, layoutRect = self.layoutRect();\r\n\r\n\t\t\t\t\t\t\thasScrollH = layoutRect.contentW > layoutRect.innerW;\r\n\t\t\t\t\t\t\thasScrollV = layoutRect.contentH > layoutRect.innerH;\r\n\t\t\t\t\t\t\tcontainerSize = self.getEl('body')[\"client\" + sizeName] - (margin * 2);\r\n\t\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? self.getEl('scroll' + axisName)[\"client\" + ax] : 0;\r\n\r\n\t\t\t\t\t\t\tratio = containerSize / self.getEl('body')[\"scroll\" + sizeName];\r\n\t\t\t\t\t\t\tself.getEl('body')[\"scroll\" + posName] = scrollStart + (e[\"delta\" + deltaPosName] / ratio);\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tstop: function() {\r\n\t\t\t\t\t\t\t$('#' + axisId).removeClass(prefix + 'active');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.classes.add('scroll');\r\n\r\n\t\t\t\taddScrollAxis(\"v\", \"Top\", \"Height\", \"Y\", \"Width\");\r\n\t\t\t\taddScrollAxis(\"h\", \"Left\", \"Width\", \"X\", \"Height\");\r\n\t\t\t}\r\n\r\n\t\t\tif (self.settings.autoScroll) {\r\n\t\t\t\tif (!self._hasScroll) {\r\n\t\t\t\t\tself._hasScroll = true;\r\n\t\t\t\t\taddScroll();\r\n\r\n\t\t\t\t\tself.on('wheel', function(e) {\r\n\t\t\t\t\t\tvar bodyEl = self.getEl('body');\r\n\r\n\t\t\t\t\t\tbodyEl.scrollLeft += (e.deltaX || 0) * 10;\r\n\t\t\t\t\t\tbodyEl.scrollTop += e.deltaY * 10;\r\n\r\n\t\t\t\t\t\trepaintScroll();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(self.getEl('body')).on(\"scroll\", repaintScroll);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trepaintScroll();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Panel.js\r\n\r\n/**\r\n * Panel.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new panel.\r\n *\r\n * @-x-less Panel.less\r\n * @class tinymce.ui.Panel\r\n * @extends tinymce.ui.Container\r\n * @mixes tinymce.ui.Scrollable\r\n */\r\ndefine(\"tinymce/ui/Panel\", [\r\n\t\"tinymce/ui/Container\",\r\n\t\"tinymce/ui/Scrollable\"\r\n], function(Container, Scrollable) {\r\n\t\"use strict\";\r\n\r\n\treturn Container.extend({\r\n\t\tDefaults: {\r\n\t\t\tlayout: 'fit',\r\n\t\t\tcontainerCls: 'panel'\r\n\t\t},\r\n\r\n\t\tMixins: [Scrollable],\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, layout = self._layout, innerHtml = self.settings.html;\r\n\r\n\t\t\tself.preRender();\r\n\t\t\tlayout.preRender(self);\r\n\r\n\t\t\tif (typeof innerHtml == \"undefined\") {\r\n\t\t\t\tinnerHtml = (\r\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\r\n\t\t\t\t\t\tlayout.renderHtml(self) +\r\n\t\t\t\t\t'</div>'\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof innerHtml == 'function') {\r\n\t\t\t\t\tinnerHtml = innerHtml.call(self);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself._hasBody = false;\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\" role=\"group\">' +\r\n\t\t\t\t\t(self._preBodyHtml || '') +\r\n\t\t\t\t\tinnerHtml +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Movable.js\r\n\r\n/**\r\n * Movable.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Movable mixin. Makes controls movable absolute and relative to other elements.\r\n *\r\n * @mixin tinymce.ui.Movable\r\n */\r\ndefine(\"tinymce/ui/Movable\", [\r\n\t\"tinymce/ui/DomUtils\"\r\n], function(DomUtils) {\r\n\t\"use strict\";\r\n\r\n\tfunction calculateRelativePosition(ctrl, targetElm, rel) {\r\n\t\tvar ctrlElm, pos, x, y, selfW, selfH, targetW, targetH, viewport, size;\r\n\r\n\t\tviewport = DomUtils.getViewPort();\r\n\r\n\t\t// Get pos of target\r\n\t\tpos = DomUtils.getPos(targetElm);\r\n\t\tx = pos.x;\r\n\t\ty = pos.y;\r\n\r\n\t\tif (ctrl.state.get('fixed') && DomUtils.getRuntimeStyle(document.body, 'position') == 'static') {\r\n\t\t\tx -= viewport.x;\r\n\t\t\ty -= viewport.y;\r\n\t\t}\r\n\r\n\t\t// Get size of self\r\n\t\tctrlElm = ctrl.getEl();\r\n\t\tsize = DomUtils.getSize(ctrlElm);\r\n\t\tselfW = size.width;\r\n\t\tselfH = size.height;\r\n\r\n\t\t// Get size of target\r\n\t\tsize = DomUtils.getSize(targetElm);\r\n\t\ttargetW = size.width;\r\n\t\ttargetH = size.height;\r\n\r\n\t\t// Parse align string\r\n\t\trel = (rel || '').split('');\r\n\r\n\t\t// Target corners\r\n\t\tif (rel[0] === 'b') {\r\n\t\t\ty += targetH;\r\n\t\t}\r\n\r\n\t\tif (rel[1] === 'r') {\r\n\t\t\tx += targetW;\r\n\t\t}\r\n\r\n\t\tif (rel[0] === 'c') {\r\n\t\t\ty += Math.round(targetH / 2);\r\n\t\t}\r\n\r\n\t\tif (rel[1] === 'c') {\r\n\t\t\tx += Math.round(targetW / 2);\r\n\t\t}\r\n\r\n\t\t// Self corners\r\n\t\tif (rel[3] === 'b') {\r\n\t\t\ty -= selfH;\r\n\t\t}\r\n\r\n\t\tif (rel[4] === 'r') {\r\n\t\t\tx -= selfW;\r\n\t\t}\r\n\r\n\t\tif (rel[3] === 'c') {\r\n\t\t\ty -= Math.round(selfH / 2);\r\n\t\t}\r\n\r\n\t\tif (rel[4] === 'c') {\r\n\t\t\tx -= Math.round(selfW / 2);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tw: selfW,\r\n\t\t\th: selfH\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Tests various positions to get the most suitable one.\r\n\t\t *\r\n\t\t * @method testMoveRel\r\n\t\t * @param {DOMElement} elm Element to position against.\r\n\t\t * @param {Array} rels Array with relative positions.\r\n\t\t * @return {String} Best suitable relative position.\r\n\t\t */\r\n\t\ttestMoveRel: function(elm, rels) {\r\n\t\t\tvar viewPortRect = DomUtils.getViewPort();\r\n\r\n\t\t\tfor (var i = 0; i < rels.length; i++) {\r\n\t\t\t\tvar pos = calculateRelativePosition(this, elm, rels[i]);\r\n\r\n\t\t\t\tif (this.state.get('fixed')) {\r\n\t\t\t\t\tif (pos.x > 0 && pos.x + pos.w < viewPortRect.w && pos.y > 0 && pos.y + pos.h < viewPortRect.h) {\r\n\t\t\t\t\t\treturn rels[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (pos.x > viewPortRect.x && pos.x + pos.w < viewPortRect.w + viewPortRect.x &&\r\n\t\t\t\t\t\tpos.y > viewPortRect.y && pos.y + pos.h < viewPortRect.h + viewPortRect.y) {\r\n\t\t\t\t\t\treturn rels[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn rels[0];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Move relative to the specified element.\r\n\t\t *\r\n\t\t * @method moveRel\r\n\t\t * @param {Element} elm Element to move relative to.\r\n\t\t * @param {String} rel Relative mode. For example: br-tl.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tmoveRel: function(elm, rel) {\r\n\t\t\tif (typeof rel != 'string') {\r\n\t\t\t\trel = this.testMoveRel(elm, rel);\r\n\t\t\t}\r\n\r\n\t\t\tvar pos = calculateRelativePosition(this, elm, rel);\r\n\t\t\treturn this.moveTo(pos.x, pos.y);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Move by a relative x, y values.\r\n\t\t *\r\n\t\t * @method moveBy\r\n\t\t * @param {Number} dx Relative x position.\r\n\t\t * @param {Number} dy Relative y position.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tmoveBy: function(dx, dy) {\r\n\t\t\tvar self = this, rect = self.layoutRect();\r\n\r\n\t\t\tself.moveTo(rect.x + dx, rect.y + dy);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Move to absolute position.\r\n\t\t *\r\n\t\t * @method moveTo\r\n\t\t * @param {Number} x Absolute x position.\r\n\t\t * @param {Number} y Absolute y position.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tmoveTo: function(x, y) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// TODO: Move this to some global class\r\n\t\t\tfunction constrain(value, max, size) {\r\n\t\t\t\tif (value < 0) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value + size > max) {\r\n\t\t\t\t\tvalue = max - size;\r\n\t\t\t\t\treturn value < 0 ? 0 : value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tif (self.settings.constrainToViewport) {\r\n\t\t\t\tvar viewPortRect = DomUtils.getViewPort(window);\r\n\t\t\t\tvar layoutRect = self.layoutRect();\r\n\r\n\t\t\t\tx = constrain(x, viewPortRect.w + viewPortRect.x, layoutRect.w);\r\n\t\t\t\ty = constrain(y, viewPortRect.h + viewPortRect.y, layoutRect.h);\r\n\t\t\t}\r\n\r\n\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\tself.layoutRect({x: x, y: y}).repaint();\r\n\t\t\t} else {\r\n\t\t\t\tself.settings.x = x;\r\n\t\t\t\tself.settings.y = y;\r\n\t\t\t}\r\n\r\n\t\t\tself.fire('move', {x: x, y: y});\r\n\r\n\t\t\treturn self;\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Resizable.js\r\n\r\n/**\r\n * Resizable.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Resizable mixin. Enables controls to be resized.\r\n *\r\n * @mixin tinymce.ui.Resizable\r\n */\r\ndefine(\"tinymce/ui/Resizable\", [\r\n\t\"tinymce/ui/DomUtils\"\r\n], function(DomUtils) {\r\n\t\"use strict\";\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Resizes the control to contents.\r\n\t\t *\r\n\t\t * @method resizeToContent\r\n\t\t */\r\n\t\tresizeToContent: function() {\r\n\t\t\tthis._layoutRect.autoResize = true;\r\n\t\t\tthis._lastRect = null;\r\n\t\t\tthis.reflow();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Resizes the control to a specific width/height.\r\n\t\t *\r\n\t\t * @method resizeTo\r\n\t\t * @param {Number} w Control width.\r\n\t\t * @param {Number} h Control height.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tresizeTo: function(w, h) {\r\n\t\t\t// TODO: Fix hack\r\n\t\t\tif (w <= 1 || h <= 1) {\r\n\t\t\t\tvar rect = DomUtils.getWindowSize();\r\n\r\n\t\t\t\tw = w <= 1 ? w * rect.w : w;\r\n\t\t\t\th = h <= 1 ? h * rect.h : h;\r\n\t\t\t}\r\n\r\n\t\t\tthis._layoutRect.autoResize = false;\r\n\t\t\treturn this.layoutRect({minW: w, minH: h, w: w, h: h}).reflow();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Resizes the control to a specific relative width/height.\r\n\t\t *\r\n\t\t * @method resizeBy\r\n\t\t * @param {Number} dw Relative control width.\r\n\t\t * @param {Number} dh Relative control height.\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tresizeBy: function(dw, dh) {\r\n\t\t\tvar self = this, rect = self.layoutRect();\r\n\r\n\t\t\treturn self.resizeTo(rect.w + dw, rect.h + dh);\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FloatPanel.js\r\n\r\n/**\r\n * FloatPanel.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class creates a floating panel.\r\n *\r\n * @-x-less FloatPanel.less\r\n * @class tinymce.ui.FloatPanel\r\n * @extends tinymce.ui.Panel\r\n * @mixes tinymce.ui.Movable\r\n * @mixes tinymce.ui.Resizable\r\n */\r\ndefine(\"tinymce/ui/FloatPanel\", [\r\n\t\"tinymce/ui/Panel\",\r\n\t\"tinymce/ui/Movable\",\r\n\t\"tinymce/ui/Resizable\",\r\n\t\"tinymce/ui/DomUtils\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/util/Delay\"\r\n], function(Panel, Movable, Resizable, DomUtils, $, Delay) {\r\n\t\"use strict\";\r\n\r\n\tvar documentClickHandler, documentScrollHandler, windowResizeHandler, visiblePanels = [];\r\n\tvar zOrder = [], hasModal;\r\n\r\n\tfunction isChildOf(ctrl, parent) {\r\n\t\twhile (ctrl) {\r\n\t\t\tif (ctrl == parent) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tctrl = ctrl.parent();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction skipOrHidePanels(e) {\r\n\t\t// Hide any float panel when a click/focus out is out side that float panel and the\r\n\t\t// float panels direct parent for example a click on a menu button\r\n\t\tvar i = visiblePanels.length;\r\n\r\n\t\twhile (i--) {\r\n\t\t\tvar panel = visiblePanels[i], clickCtrl = panel.getParentCtrl(e.target);\r\n\r\n\t\t\tif (panel.settings.autohide) {\r\n\t\t\t\tif (clickCtrl) {\r\n\t\t\t\t\tif (isChildOf(clickCtrl, panel) || panel.parent() === clickCtrl) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\te = panel.fire('autohide', {target: e.target});\r\n\t\t\t\tif (!e.isDefaultPrevented()) {\r\n\t\t\t\t\tpanel.hide();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction bindDocumentClickHandler() {\r\n\r\n\t\tif (!documentClickHandler) {\r\n\t\t\tdocumentClickHandler = function(e) {\r\n\t\t\t\t// Gecko fires click event and in the wrong order on Mac so lets normalize\r\n\t\t\t\tif (e.button == 2) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tskipOrHidePanels(e);\r\n\t\t\t};\r\n\r\n\t\t\t$(document).on('click touchstart', documentClickHandler);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction bindDocumentScrollHandler() {\r\n\t\tif (!documentScrollHandler) {\r\n\t\t\tdocumentScrollHandler = function() {\r\n\t\t\t\tvar i;\r\n\r\n\t\t\t\ti = visiblePanels.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\trepositionPanel(visiblePanels[i]);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$(window).on('scroll', documentScrollHandler);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction bindWindowResizeHandler() {\r\n\t\tif (!windowResizeHandler) {\r\n\t\t\tvar docElm = document.documentElement, clientWidth = docElm.clientWidth, clientHeight = docElm.clientHeight;\r\n\r\n\t\t\twindowResizeHandler = function() {\r\n\t\t\t\t// Workaround for #7065 IE 7 fires resize events event though the window wasn't resized\r\n\t\t\t\tif (!document.all || clientWidth != docElm.clientWidth || clientHeight != docElm.clientHeight) {\r\n\t\t\t\t\tclientWidth = docElm.clientWidth;\r\n\t\t\t\t\tclientHeight = docElm.clientHeight;\r\n\t\t\t\t\tFloatPanel.hideAll();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$(window).on('resize', windowResizeHandler);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Repositions the panel to the top of page if the panel is outside of the visual viewport. It will\r\n\t * also reposition all child panels of the current panel.\r\n\t */\r\n\tfunction repositionPanel(panel) {\r\n\t\tvar scrollY = DomUtils.getViewPort().y;\r\n\r\n\t\tfunction toggleFixedChildPanels(fixed, deltaY) {\r\n\t\t\tvar parent;\r\n\r\n\t\t\tfor (var i = 0; i < visiblePanels.length; i++) {\r\n\t\t\t\tif (visiblePanels[i] != panel) {\r\n\t\t\t\t\tparent = visiblePanels[i].parent();\r\n\r\n\t\t\t\t\twhile (parent && (parent = parent.parent())) {\r\n\t\t\t\t\t\tif (parent == panel) {\r\n\t\t\t\t\t\t\tvisiblePanels[i].fixed(fixed).moveBy(0, deltaY).repaint();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (panel.settings.autofix) {\r\n\t\t\tif (!panel.state.get('fixed')) {\r\n\t\t\t\tpanel._autoFixY = panel.layoutRect().y;\r\n\r\n\t\t\t\tif (panel._autoFixY < scrollY) {\r\n\t\t\t\t\tpanel.fixed(true).layoutRect({y: 0}).repaint();\r\n\t\t\t\t\ttoggleFixedChildPanels(true, scrollY - panel._autoFixY);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (panel._autoFixY > scrollY) {\r\n\t\t\t\t\tpanel.fixed(false).layoutRect({y: panel._autoFixY}).repaint();\r\n\t\t\t\t\ttoggleFixedChildPanels(false, panel._autoFixY - scrollY);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction addRemove(add, ctrl) {\r\n\t\tvar i, zIndex = FloatPanel.zIndex || 0xFFFF, topModal;\r\n\r\n\t\tif (add) {\r\n\t\t\tzOrder.push(ctrl);\r\n\t\t} else {\r\n\t\t\ti = zOrder.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tif (zOrder[i] === ctrl) {\r\n\t\t\t\t\tzOrder.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (zOrder.length) {\r\n\t\t\tfor (i = 0; i < zOrder.length; i++) {\r\n\t\t\t\tif (zOrder[i].modal) {\r\n\t\t\t\t\tzIndex++;\r\n\t\t\t\t\ttopModal = zOrder[i];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tzOrder[i].getEl().style.zIndex = zIndex;\r\n\t\t\t\tzOrder[i].zIndex = zIndex;\r\n\t\t\t\tzIndex++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar modalBlockEl = $('#' + ctrl.classPrefix + 'modal-block', ctrl.getContainerElm())[0];\r\n\r\n\t\tif (topModal) {\r\n\t\t\t$(modalBlockEl).css('z-index', topModal.zIndex - 1);\r\n\t\t} else if (modalBlockEl) {\r\n\t\t\tmodalBlockEl.parentNode.removeChild(modalBlockEl);\r\n\t\t\thasModal = false;\r\n\t\t}\r\n\r\n\t\tFloatPanel.currentZIndex = zIndex;\r\n\t}\r\n\r\n\tvar FloatPanel = Panel.extend({\r\n\t\tMixins: [Movable, Resizable],\r\n\r\n\t\t/**\r\n\t\t * Constructs a new control instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Boolean} autohide Automatically hide the panel.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself._eventsRoot = self;\r\n\r\n\t\t\tself.classes.add('floatpanel');\r\n\r\n\t\t\t// Hide floatpanes on click out side the root button\r\n\t\t\tif (settings.autohide) {\r\n\t\t\t\tbindDocumentClickHandler();\r\n\t\t\t\tbindWindowResizeHandler();\r\n\t\t\t\tvisiblePanels.push(self);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.autofix) {\r\n\t\t\t\tbindDocumentScrollHandler();\r\n\r\n\t\t\t\tself.on('move', function() {\r\n\t\t\t\t\trepositionPanel(this);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tself.on('postrender show', function(e) {\r\n\t\t\t\tif (e.control == self) {\r\n\t\t\t\t\tvar $modalBlockEl, prefix = self.classPrefix;\r\n\r\n\t\t\t\t\tif (self.modal && !hasModal) {\r\n\t\t\t\t\t\t$modalBlockEl = $('#' + prefix + 'modal-block', self.getContainerElm());\r\n\t\t\t\t\t\tif (!$modalBlockEl[0]) {\r\n\t\t\t\t\t\t\t$modalBlockEl = $(\r\n\t\t\t\t\t\t\t\t'<div id=\"' + prefix + 'modal-block\" class=\"' + prefix + 'reset ' + prefix + 'fade\"></div>'\r\n\t\t\t\t\t\t\t).appendTo(self.getContainerElm());\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tDelay.setTimeout(function() {\r\n\t\t\t\t\t\t\t$modalBlockEl.addClass(prefix + 'in');\r\n\t\t\t\t\t\t\t$(self.getEl()).addClass(prefix + 'in');\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\thasModal = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\taddRemove(true, self);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.on('show', function() {\r\n\t\t\t\tself.parents().each(function(ctrl) {\r\n\t\t\t\t\tif (ctrl.state.get('fixed')) {\r\n\t\t\t\t\t\tself.fixed(true);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tif (settings.popover) {\r\n\t\t\t\tself._preBodyHtml = '<div class=\"' + self.classPrefix + 'arrow\"></div>';\r\n\t\t\t\tself.classes.add('popover').add('bottom').add(self.isRtl() ? 'end' : 'start');\r\n\t\t\t}\r\n\r\n\t\t\tself.aria('label', settings.ariaLabel);\r\n\t\t\tself.aria('labelledby', self._id);\r\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\r\n\t\t},\r\n\r\n\t\tfixed: function(state) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.state.get('fixed') != state) {\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tvar viewport = DomUtils.getViewPort();\r\n\r\n\t\t\t\t\tif (state) {\r\n\t\t\t\t\t\tself.layoutRect().y -= viewport.y;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.layoutRect().y += viewport.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.classes.toggle('fixed', state);\r\n\t\t\t\tself.state.set('fixed', state);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Shows the current float panel.\r\n\t\t *\r\n\t\t * @method show\r\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\r\n\t\t */\r\n\t\tshow: function() {\r\n\t\t\tvar self = this, i, state = self._super();\r\n\r\n\t\t\ti = visiblePanels.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tif (visiblePanels[i] === self) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (i === -1) {\r\n\t\t\t\tvisiblePanels.push(self);\r\n\t\t\t}\r\n\r\n\t\t\treturn state;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides the current float panel.\r\n\t\t *\r\n\t\t * @method hide\r\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\r\n\t\t */\r\n\t\thide: function() {\r\n\t\t\tremoveVisiblePanel(this);\r\n\t\t\taddRemove(false, this);\r\n\r\n\t\t\treturn this._super();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hide all visible float panels with he autohide setting enabled. This is for\r\n\t\t * manually hiding floating menus or panels.\r\n\t\t *\r\n\t\t * @method hideAll\r\n\t\t */\r\n\t\thideAll: function() {\r\n\t\t\tFloatPanel.hideAll();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Closes the float panel. This will remove the float panel from page and fire the close event.\r\n\t\t *\r\n\t\t * @method close\r\n\t\t */\r\n\t\tclose: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\r\n\t\t\t\tself.remove();\r\n\t\t\t\taddRemove(false, self);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the float panel from page.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tremoveVisiblePanel(this);\r\n\t\t\tthis._super();\r\n\t\t},\r\n\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.settings.bodyRole) {\r\n\t\t\t\tthis.getEl('body').setAttribute('role', self.settings.bodyRole);\r\n\t\t\t}\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * Hide all visible float panels with he autohide setting enabled. This is for\r\n\t * manually hiding floating menus or panels.\r\n\t *\r\n\t * @static\r\n\t * @method hideAll\r\n\t */\r\n\tFloatPanel.hideAll = function() {\r\n\t\tvar i = visiblePanels.length;\r\n\r\n\t\twhile (i--) {\r\n\t\t\tvar panel = visiblePanels[i];\r\n\r\n\t\t\tif (panel && panel.settings.autohide) {\r\n\t\t\t\tpanel.hide();\r\n\t\t\t\tvisiblePanels.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfunction removeVisiblePanel(panel) {\r\n\t\tvar i;\r\n\r\n\t\ti = visiblePanels.length;\r\n\t\twhile (i--) {\r\n\t\t\tif (visiblePanels[i] === panel) {\r\n\t\t\t\tvisiblePanels.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ti = zOrder.length;\r\n\t\twhile (i--) {\r\n\t\t\tif (zOrder[i] === panel) {\r\n\t\t\t\tzOrder.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn FloatPanel;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Window.js\r\n\r\n/**\r\n * Window.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new window.\r\n *\r\n * @-x-less Window.less\r\n * @class tinymce.ui.Window\r\n * @extends tinymce.ui.FloatPanel\r\n */\r\ndefine(\"tinymce/ui/Window\", [\r\n\t\"tinymce/ui/FloatPanel\",\r\n\t\"tinymce/ui/Panel\",\r\n\t\"tinymce/ui/DomUtils\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/ui/DragHelper\",\r\n\t\"tinymce/ui/BoxUtils\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Delay\"\r\n], function(FloatPanel, Panel, DomUtils, $, DragHelper, BoxUtils, Env, Delay) {\r\n\t\"use strict\";\r\n\r\n\tvar windows = [], oldMetaValue = '';\r\n\r\n\tfunction toggleFullScreenState(state) {\r\n\t\tvar noScaleMetaValue = 'width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0',\r\n\t\t\tviewport = $(\"meta[name=viewport]\")[0],\r\n\t\t\tcontentValue;\r\n\r\n\t\tif (Env.overrideViewPort === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!viewport) {\r\n\t\t\tviewport = document.createElement('meta');\r\n\t\t\tviewport.setAttribute('name', 'viewport');\r\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(viewport);\r\n\t\t}\r\n\r\n\t\tcontentValue = viewport.getAttribute('content');\r\n\t\tif (contentValue && typeof oldMetaValue != 'undefined') {\r\n\t\t\toldMetaValue = contentValue;\r\n\t\t}\r\n\r\n\t\tviewport.setAttribute('content', state ? noScaleMetaValue : oldMetaValue);\r\n\t}\r\n\r\n\tfunction toggleBodyFullScreenClasses(classPrefix) {\r\n\t\tfor (var i = 0; i < windows.length; i++) {\r\n\t\t\tif (windows[i]._fullscreen) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$([document.documentElement, document.body]).removeClass(classPrefix + 'fullscreen');\r\n\t}\r\n\r\n\tfunction handleWindowResize() {\r\n\t\tif (!Env.desktop) {\r\n\t\t\tvar lastSize = {\r\n\t\t\t\tw: window.innerWidth,\r\n\t\t\t\th: window.innerHeight\r\n\t\t\t};\r\n\r\n\t\t\tDelay.setInterval(function() {\r\n\t\t\t\tvar w = window.innerWidth,\r\n\t\t\t\t\th = window.innerHeight;\r\n\r\n\t\t\t\tif (lastSize.w != w || lastSize.h != h) {\r\n\t\t\t\t\tlastSize = {\r\n\t\t\t\t\t\tw: w,\r\n\t\t\t\t\t\th: h\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t$(window).trigger('resize');\r\n\t\t\t\t}\r\n\t\t\t}, 100);\r\n\t\t}\r\n\r\n\t\tfunction reposition() {\r\n\t\t\tvar i, rect = DomUtils.getWindowSize(), layoutRect;\r\n\r\n\t\t\tfor (i = 0; i < windows.length; i++) {\r\n\t\t\t\tlayoutRect = windows[i].layoutRect();\r\n\r\n\t\t\t\twindows[i].moveTo(\r\n\t\t\t\t\twindows[i].settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2),\r\n\t\t\t\t\twindows[i].settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(window).on('resize', reposition);\r\n\t}\r\n\r\n\tvar Window = FloatPanel.extend({\r\n\t\tmodal: true,\r\n\r\n\t\tDefaults: {\r\n\t\t\tborder: 1,\r\n\t\t\tlayout: 'flex',\r\n\t\t\tcontainerCls: 'panel',\r\n\t\t\trole: 'dialog',\r\n\t\t\tcallbacks: {\r\n\t\t\t\tsubmit: function() {\r\n\t\t\t\t\tthis.fire('submit', {data: this.toJSON()});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\r\n\t\t\tif (self.isRtl()) {\r\n\t\t\t\tself.classes.add('rtl');\r\n\t\t\t}\r\n\r\n\t\t\tself.classes.add('window');\r\n\t\t\tself.bodyClasses.add('window-body');\r\n\t\t\tself.state.set('fixed', true);\r\n\r\n\t\t\t// Create statusbar\r\n\t\t\tif (settings.buttons) {\r\n\t\t\t\tself.statusbar = new Panel({\r\n\t\t\t\t\tlayout: 'flex',\r\n\t\t\t\t\tborder: '1 0 0 0',\r\n\t\t\t\t\tspacing: 3,\r\n\t\t\t\t\tpadding: 10,\r\n\t\t\t\t\talign: 'center',\r\n\t\t\t\t\tpack: self.isRtl() ? 'start' : 'end',\r\n\t\t\t\t\tdefaults: {\r\n\t\t\t\t\t\ttype: 'button'\r\n\t\t\t\t\t},\r\n\t\t\t\t\titems: settings.buttons\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.statusbar.classes.add('foot');\r\n\t\t\t\tself.statusbar.parent(self);\r\n\t\t\t}\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tvar closeClass = self.classPrefix + 'close';\r\n\r\n\t\t\t\tif (DomUtils.hasClass(e.target, closeClass) || DomUtils.hasClass(e.target.parentNode, closeClass)) {\r\n\t\t\t\t\tself.close();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.on('cancel', function() {\r\n\t\t\t\tself.close();\r\n\t\t\t});\r\n\r\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\r\n\t\t\tself.aria('label', settings.title);\r\n\t\t\tself._fullscreen = false;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the current container.\r\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t */\r\n\t\trecalc: function() {\r\n\t\t\tvar self = this, statusbar = self.statusbar, layoutRect, width, x, needsRecalc;\r\n\r\n\t\t\tif (self._fullscreen) {\r\n\t\t\t\tself.layoutRect(DomUtils.getWindowSize());\r\n\t\t\t\tself.layoutRect().contentH = self.layoutRect().innerH;\r\n\t\t\t}\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tlayoutRect = self.layoutRect();\r\n\r\n\t\t\t// Resize window based on title width\r\n\t\t\tif (self.settings.title && !self._fullscreen) {\r\n\t\t\t\twidth = layoutRect.headerW;\r\n\t\t\t\tif (width > layoutRect.w) {\r\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width / 2);\r\n\t\t\t\t\tself.layoutRect({w: width, x: x});\r\n\t\t\t\t\tneedsRecalc = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Resize window based on statusbar width\r\n\t\t\tif (statusbar) {\r\n\t\t\t\tstatusbar.layoutRect({w: self.layoutRect().innerW}).recalc();\r\n\r\n\t\t\t\twidth = statusbar.layoutRect().minW + layoutRect.deltaW;\r\n\t\t\t\tif (width > layoutRect.w) {\r\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width - layoutRect.w);\r\n\t\t\t\t\tself.layoutRect({w: width, x: x});\r\n\t\t\t\t\tneedsRecalc = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Recalc body and disable auto resize\r\n\t\t\tif (needsRecalc) {\r\n\t\t\t\tself.recalc();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Initializes the current controls layout rect.\r\n\t\t * This will be executed by the layout managers to determine the\r\n\t\t * default minWidth/minHeight etc.\r\n\t\t *\r\n\t\t * @method initLayoutRect\r\n\t\t * @return {Object} Layout rect instance.\r\n\t\t */\r\n\t\tinitLayoutRect: function() {\r\n\t\t\tvar self = this, layoutRect = self._super(), deltaH = 0, headEl;\r\n\r\n\t\t\t// Reserve vertical space for title\r\n\t\t\tif (self.settings.title && !self._fullscreen) {\r\n\t\t\t\theadEl = self.getEl('head');\r\n\r\n\t\t\t\tvar size = DomUtils.getSize(headEl);\r\n\r\n\t\t\t\tlayoutRect.headerW = size.width;\r\n\t\t\t\tlayoutRect.headerH = size.height;\r\n\r\n\t\t\t\tdeltaH += layoutRect.headerH;\r\n\t\t\t}\r\n\r\n\t\t\t// Reserve vertical space for statusbar\r\n\t\t\tif (self.statusbar) {\r\n\t\t\t\tdeltaH += self.statusbar.layoutRect().h;\r\n\t\t\t}\r\n\r\n\t\t\tlayoutRect.deltaH += deltaH;\r\n\t\t\tlayoutRect.minH += deltaH;\r\n\t\t\t//layoutRect.innerH -= deltaH;\r\n\t\t\tlayoutRect.h += deltaH;\r\n\r\n\t\t\tvar rect = DomUtils.getWindowSize();\r\n\r\n\t\t\tlayoutRect.x = self.settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2);\r\n\t\t\tlayoutRect.y = self.settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2);\r\n\r\n\t\t\treturn layoutRect;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, layout = self._layout, id = self._id, prefix = self.classPrefix;\r\n\t\t\tvar settings = self.settings, headerHtml = '', footerHtml = '', html = settings.html;\r\n\r\n\t\t\tself.preRender();\r\n\t\t\tlayout.preRender(self);\r\n\r\n\t\t\tif (settings.title) {\r\n\t\t\t\theaderHtml = (\r\n\t\t\t\t\t'<div id=\"' + id + '-head\" class=\"' + prefix + 'window-head\">' +\r\n\t\t\t\t\t\t'<div id=\"' + id + '-title\" class=\"' + prefix + 'title\">' + self.encode(settings.title) + '</div>' +\r\n\t\t\t\t\t\t'<div id=\"' + id + '-dragh\" class=\"' + prefix + 'dragh\"></div>' +\r\n\t\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">' +\r\n\t\t\t\t\t\t\t'<i class=\"mce-ico mce-i-remove\"></i>' +\r\n\t\t\t\t\t\t'</button>' +\r\n\t\t\t\t\t'</div>'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.url) {\r\n\t\t\t\thtml = '<iframe src=\"' + settings.url + '\" tabindex=\"-1\"></iframe>';\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof html == \"undefined\") {\r\n\t\t\t\thtml = layout.renderHtml(self);\r\n\t\t\t}\r\n\r\n\t\t\tif (self.statusbar) {\r\n\t\t\t\tfooterHtml = self.statusbar.renderHtml();\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" hidefocus=\"1\">' +\r\n\t\t\t\t\t'<div class=\"' + self.classPrefix + 'reset\" role=\"application\">' +\r\n\t\t\t\t\t\theaderHtml +\r\n\t\t\t\t\t\t'<div id=\"' + id + '-body\" class=\"' + self.bodyClasses + '\">' +\r\n\t\t\t\t\t\t\thtml +\r\n\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\tfooterHtml +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Switches the window fullscreen mode.\r\n\t\t *\r\n\t\t * @method fullscreen\r\n\t\t * @param {Boolean} state True/false state.\r\n\t\t * @return {tinymce.ui.Window} Current window instance.\r\n\t\t */\r\n\t\tfullscreen: function(state) {\r\n\t\t\tvar self = this, documentElement = document.documentElement, slowRendering, prefix = self.classPrefix, layoutRect;\r\n\r\n\t\t\tif (state != self._fullscreen) {\r\n\t\t\t\t$(window).on('resize', function() {\r\n\t\t\t\t\tvar time;\r\n\r\n\t\t\t\t\tif (self._fullscreen) {\r\n\t\t\t\t\t\t// Time the layout time if it's to slow use a timeout to not hog the CPU\r\n\t\t\t\t\t\tif (!slowRendering) {\r\n\t\t\t\t\t\t\ttime = new Date().getTime();\r\n\r\n\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\r\n\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\r\n\r\n\t\t\t\t\t\t\tif ((new Date().getTime()) - time > 50) {\r\n\t\t\t\t\t\t\t\tslowRendering = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (!self._timer) {\r\n\t\t\t\t\t\t\t\tself._timer = Delay.setTimeout(function() {\r\n\t\t\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\r\n\t\t\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\r\n\r\n\t\t\t\t\t\t\t\t\tself._timer = 0;\r\n\t\t\t\t\t\t\t\t}, 50);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tlayoutRect = self.layoutRect();\r\n\t\t\t\tself._fullscreen = state;\r\n\r\n\t\t\t\tif (!state) {\r\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox(self.settings.border);\r\n\t\t\t\t\tself.getEl('head').style.display = '';\r\n\t\t\t\t\tlayoutRect.deltaH += layoutRect.headerH;\r\n\t\t\t\t\t$([documentElement, document.body]).removeClass(prefix + 'fullscreen');\r\n\t\t\t\t\tself.classes.remove('fullscreen');\r\n\t\t\t\t\tself.moveTo(self._initial.x, self._initial.y).resizeTo(self._initial.w, self._initial.h);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself._initial = {x: layoutRect.x, y: layoutRect.y, w: layoutRect.w, h: layoutRect.h};\r\n\r\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox('0');\r\n\t\t\t\t\tself.getEl('head').style.display = 'none';\r\n\t\t\t\t\tlayoutRect.deltaH -= layoutRect.headerH + 2;\r\n\t\t\t\t\t$([documentElement, document.body]).addClass(prefix + 'fullscreen');\r\n\t\t\t\t\tself.classes.add('fullscreen');\r\n\r\n\t\t\t\t\tvar rect = DomUtils.getWindowSize();\r\n\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn self.reflow();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, startPos;\r\n\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tself.classes.add('in');\r\n\t\t\t\tself.fire('open');\r\n\t\t\t}, 0);\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tif (self.statusbar) {\r\n\t\t\t\tself.statusbar.postRender();\r\n\t\t\t}\r\n\r\n\t\t\tself.focus();\r\n\r\n\t\t\tthis.dragHelper = new DragHelper(self._id + '-dragh', {\r\n\t\t\t\tstart: function() {\r\n\t\t\t\t\tstartPos = {\r\n\t\t\t\t\t\tx: self.layoutRect().x,\r\n\t\t\t\t\t\ty: self.layoutRect().y\r\n\t\t\t\t\t};\r\n\t\t\t\t},\r\n\r\n\t\t\t\tdrag: function(e) {\r\n\t\t\t\t\tself.moveTo(startPos.x + e.deltaX, startPos.y + e.deltaY);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.on('submit', function(e) {\r\n\t\t\t\tif (!e.isDefaultPrevented()) {\r\n\t\t\t\t\tself.close();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\twindows.push(self);\r\n\t\t\ttoggleFullScreenState(true);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Fires a submit event with the serialized form.\r\n\t\t *\r\n\t\t * @method submit\r\n\t\t * @return {Object} Event arguments object.\r\n\t\t */\r\n\t\tsubmit: function() {\r\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the current control from DOM and from UI collections.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tvar self = this, i;\r\n\r\n\t\t\tself.dragHelper.destroy();\r\n\t\t\tself._super();\r\n\r\n\t\t\tif (self.statusbar) {\r\n\t\t\t\tthis.statusbar.remove();\r\n\t\t\t}\r\n\r\n\t\t\ti = windows.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tif (windows[i] === self) {\r\n\t\t\t\t\twindows.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttoggleFullScreenState(windows.length > 0);\r\n\t\t\ttoggleBodyFullScreenClasses(self.classPrefix);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the contentWindow object of the iframe if it exists.\r\n\t\t *\r\n\t\t * @method getContentWindow\r\n\t\t * @return {Window} window object or null.\r\n\t\t */\r\n\t\tgetContentWindow: function() {\r\n\t\t\tvar ifr = this.getEl().getElementsByTagName('iframe')[0];\r\n\t\t\treturn ifr ? ifr.contentWindow : null;\r\n\t\t}\r\n\t});\r\n\r\n\thandleWindowResize();\r\n\r\n\treturn Window;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/MessageBox.js\r\n\r\n/**\r\n * MessageBox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is used to create MessageBoxes like alerts/confirms etc.\r\n *\r\n * @class tinymce.ui.MessageBox\r\n * @extends tinymce.ui.FloatPanel\r\n */\r\ndefine(\"tinymce/ui/MessageBox\", [\r\n\t\"tinymce/ui/Window\"\r\n], function(Window) {\r\n\t\"use strict\";\r\n\r\n\tvar MessageBox = Window.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tsettings = {\r\n\t\t\t\tborder: 1,\r\n\t\t\t\tpadding: 20,\r\n\t\t\t\tlayout: 'flex',\r\n\t\t\t\tpack: \"center\",\r\n\t\t\t\talign: \"center\",\r\n\t\t\t\tcontainerCls: 'panel',\r\n\t\t\t\tautoScroll: true,\r\n\t\t\t\tbuttons: {type: \"button\", text: \"Ok\", action: \"ok\"},\r\n\t\t\t\titems: {\r\n\t\t\t\t\ttype: \"label\",\r\n\t\t\t\t\tmultiline: true,\r\n\t\t\t\t\tmaxWidth: 500,\r\n\t\t\t\t\tmaxHeight: 200\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis._super(settings);\r\n\t\t},\r\n\r\n\t\tStatics: {\r\n\t\t\t/**\r\n\t\t\t * Ok buttons constant.\r\n\t\t\t *\r\n\t\t\t * @static\r\n\t\t\t * @final\r\n\t\t\t * @field {Number} OK\r\n\t\t\t */\r\n\t\t\tOK: 1,\r\n\r\n\t\t\t/**\r\n\t\t\t * Ok/cancel buttons constant.\r\n\t\t\t *\r\n\t\t\t * @static\r\n\t\t\t * @final\r\n\t\t\t * @field {Number} OK_CANCEL\r\n\t\t\t */\r\n\t\t\tOK_CANCEL: 2,\r\n\r\n\t\t\t/**\r\n\t\t\t * yes/no buttons constant.\r\n\t\t\t *\r\n\t\t\t * @static\r\n\t\t\t * @final\r\n\t\t\t * @field {Number} YES_NO\r\n\t\t\t */\r\n\t\t\tYES_NO: 3,\r\n\r\n\t\t\t/**\r\n\t\t\t * yes/no/cancel buttons constant.\r\n\t\t\t *\r\n\t\t\t * @static\r\n\t\t\t * @final\r\n\t\t\t * @field {Number} YES_NO_CANCEL\r\n\t\t\t */\r\n\t\t\tYES_NO_CANCEL: 4,\r\n\r\n\t\t\t/**\r\n\t\t\t * Constructs a new message box and renders it to the body element.\r\n\t\t\t *\r\n\t\t\t * @static\r\n\t\t\t * @method msgBox\r\n\t\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t\t */\r\n\t\t\tmsgBox: function(settings) {\r\n\t\t\t\tvar buttons, callback = settings.callback || function() {};\r\n\r\n\t\t\t\tfunction createButton(text, status, primary) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\ttype: \"button\",\r\n\t\t\t\t\t\ttext: text,\r\n\t\t\t\t\t\tsubtype: primary ? 'primary' : '',\r\n\t\t\t\t\t\tonClick: function(e) {\r\n\t\t\t\t\t\t\te.control.parents()[1].close();\r\n\t\t\t\t\t\t\tcallback(status);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (settings.buttons) {\r\n\t\t\t\t\tcase MessageBox.OK_CANCEL:\r\n\t\t\t\t\t\tbuttons = [\r\n\t\t\t\t\t\t\tcreateButton('Ok', true, true),\r\n\t\t\t\t\t\t\tcreateButton('Cancel', false)\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase MessageBox.YES_NO:\r\n\t\t\t\t\tcase MessageBox.YES_NO_CANCEL:\r\n\t\t\t\t\t\tbuttons = [\r\n\t\t\t\t\t\t\tcreateButton('Yes', 1, true),\r\n\t\t\t\t\t\t\tcreateButton('No', 0)\r\n\t\t\t\t\t\t];\r\n\r\n\t\t\t\t\t\tif (settings.buttons == MessageBox.YES_NO_CANCEL) {\r\n\t\t\t\t\t\t\tbuttons.push(createButton('Cancel', -1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbuttons = [\r\n\t\t\t\t\t\t\tcreateButton('Ok', true, true)\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn new Window({\r\n\t\t\t\t\tpadding: 20,\r\n\t\t\t\t\tx: settings.x,\r\n\t\t\t\t\ty: settings.y,\r\n\t\t\t\t\tminWidth: 300,\r\n\t\t\t\t\tminHeight: 100,\r\n\t\t\t\t\tlayout: \"flex\",\r\n\t\t\t\t\tpack: \"center\",\r\n\t\t\t\t\talign: \"center\",\r\n\t\t\t\t\tbuttons: buttons,\r\n\t\t\t\t\ttitle: settings.title,\r\n\t\t\t\t\trole: 'alertdialog',\r\n\t\t\t\t\titems: {\r\n\t\t\t\t\t\ttype: \"label\",\r\n\t\t\t\t\t\tmultiline: true,\r\n\t\t\t\t\t\tmaxWidth: 500,\r\n\t\t\t\t\t\tmaxHeight: 200,\r\n\t\t\t\t\t\ttext: settings.text\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonPostRender: function() {\r\n\t\t\t\t\t\tthis.aria('describedby', this.items()[0]._id);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonClose: settings.onClose,\r\n\t\t\t\t\tonCancel: function() {\r\n\t\t\t\t\t\tcallback(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}).renderTo(document.body).reflow();\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Creates a new alert dialog.\r\n\t\t\t *\r\n\t\t\t * @method alert\r\n\t\t\t * @param {Object} settings Settings for the alert dialog.\r\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\r\n\t\t\t */\r\n\t\t\talert: function(settings, callback) {\r\n\t\t\t\tif (typeof settings == \"string\") {\r\n\t\t\t\t\tsettings = {text: settings};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsettings.callback = callback;\r\n\t\t\t\treturn MessageBox.msgBox(settings);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Creates a new confirm dialog.\r\n\t\t\t *\r\n\t\t\t * @method confirm\r\n\t\t\t * @param {Object} settings Settings for the confirm dialog.\r\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\r\n\t\t\t */\r\n\t\t\tconfirm: function(settings, callback) {\r\n\t\t\t\tif (typeof settings == \"string\") {\r\n\t\t\t\t\tsettings = {text: settings};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsettings.callback = callback;\r\n\t\t\t\tsettings.buttons = MessageBox.OK_CANCEL;\r\n\r\n\t\t\t\treturn MessageBox.msgBox(settings);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn MessageBox;\r\n});\r\n\r\n// Included from: js/tinymce/classes/WindowManager.js\r\n\r\n/**\r\n * WindowManager.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles the creation of native windows and dialogs. This class can be extended to provide for example inline dialogs.\r\n *\r\n * @class tinymce.WindowManager\r\n * @example\r\n * // Opens a new dialog with the file.htm file and the size 320x240\r\n * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\r\n * tinymce.activeEditor.windowManager.open({\r\n *    url: 'file.htm',\r\n *    width: 320,\r\n *    height: 240\r\n * }, {\r\n *    custom_param: 1\r\n * });\r\n *\r\n * // Displays an alert box using the active editors window manager instance\r\n * tinymce.activeEditor.windowManager.alert('Hello world!');\r\n *\r\n * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\r\n * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\r\n *    if (s)\r\n *       tinymce.activeEditor.windowManager.alert(\"Ok\");\r\n *    else\r\n *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\r\n * });\r\n */\r\ndefine(\"tinymce/WindowManager\", [\r\n\t\"tinymce/ui/Window\",\r\n\t\"tinymce/ui/MessageBox\"\r\n], function(Window, MessageBox) {\r\n\treturn function(editor) {\r\n\t\tvar self = this, windows = [];\r\n\r\n\t\tfunction getTopMostWindow() {\r\n\t\t\tif (windows.length) {\r\n\t\t\t\treturn windows[windows.length - 1];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction fireOpenEvent(win) {\r\n\t\t\teditor.fire('OpenWindow', {\r\n\t\t\t\twin: win\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction fireCloseEvent(win) {\r\n\t\t\teditor.fire('CloseWindow', {\r\n\t\t\t\twin: win\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tself.windows = windows;\r\n\r\n\t\teditor.on('remove', function() {\r\n\t\t\tvar i = windows.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\twindows[i].close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * Opens a new window.\r\n\t\t *\r\n\t\t * @method open\r\n\t\t * @param {Object} args Optional name/value settings collection contains things like width/height/url etc.\r\n\t\t * @param {Object} params Options like title, file, width, height etc.\r\n\t\t * @option {String} title Window title.\r\n\t\t * @option {String} file URL of the file to open in the window.\r\n\t\t * @option {Number} width Width in pixels.\r\n\t\t * @option {Number} height Height in pixels.\r\n\t\t * @option {Boolean} autoScroll Specifies whether the popup window can have scrollbars if required (i.e. content\r\n\t\t * larger than the popup size specified).\r\n\t\t */\r\n\t\tself.open = function(args, params) {\r\n\t\t\tvar win;\r\n\r\n\t\t\teditor.editorManager.setActive(editor);\r\n\r\n\t\t\targs.title = args.title || ' ';\r\n\r\n\t\t\t// Handle URL\r\n\t\t\targs.url = args.url || args.file; // Legacy\r\n\t\t\tif (args.url) {\r\n\t\t\t\targs.width = parseInt(args.width || 320, 10);\r\n\t\t\t\targs.height = parseInt(args.height || 240, 10);\r\n\t\t\t}\r\n\r\n\t\t\t// Handle body\r\n\t\t\tif (args.body) {\r\n\t\t\t\targs.items = {\r\n\t\t\t\t\tdefaults: args.defaults,\r\n\t\t\t\t\ttype: args.bodyType || 'form',\r\n\t\t\t\t\titems: args.body,\r\n\t\t\t\t\tdata: args.data,\r\n\t\t\t\t\tcallbacks: args.commands\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!args.url && !args.buttons) {\r\n\t\t\t\targs.buttons = [\r\n\t\t\t\t\t{text: 'Ok', subtype: 'primary', onclick: function() {\r\n\t\t\t\t\t\twin.find('form')[0].submit();\r\n\t\t\t\t\t}},\r\n\r\n\t\t\t\t\t{text: 'Cancel', onclick: function() {\r\n\t\t\t\t\t\twin.close();\r\n\t\t\t\t\t}}\r\n\t\t\t\t];\r\n\t\t\t}\r\n\r\n\t\t\twin = new Window(args);\r\n\t\t\twindows.push(win);\r\n\r\n\t\t\twin.on('close', function() {\r\n\t\t\t\tvar i = windows.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tif (windows[i] === win) {\r\n\t\t\t\t\t\twindows.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!windows.length) {\r\n\t\t\t\t\teditor.focus();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfireCloseEvent(win);\r\n\t\t\t});\r\n\r\n\t\t\t// Handle data\r\n\t\t\tif (args.data) {\r\n\t\t\t\twin.on('postRender', function() {\r\n\t\t\t\t\tthis.find('*').each(function(ctrl) {\r\n\t\t\t\t\t\tvar name = ctrl.name();\r\n\r\n\t\t\t\t\t\tif (name in args.data) {\r\n\t\t\t\t\t\t\tctrl.value(args.data[name]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// store args and parameters\r\n\t\t\twin.features = args || {};\r\n\t\t\twin.params = params || {};\r\n\r\n\t\t\t// Takes a snapshot in the FocusManager of the selection before focus is lost to dialog\r\n\t\t\tif (windows.length === 1) {\r\n\t\t\t\teditor.nodeChanged();\r\n\t\t\t}\r\n\r\n\t\t\twin = win.renderTo().reflow();\r\n\r\n\t\t\tfireOpenEvent(win);\r\n\r\n\t\t\treturn win;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Creates a alert dialog. Please don't use the blocking behavior of this\r\n\t\t * native version use the callback method instead then it can be extended.\r\n\t\t *\r\n\t\t * @method alert\r\n\t\t * @param {String} message Text to display in the new alert dialog.\r\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok.\r\n\t\t * @param {Object} scope Optional scope to execute the callback in.\r\n\t\t * @example\r\n\t\t * // Displays an alert box using the active editors window manager instance\r\n\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\r\n\t\t */\r\n\t\tself.alert = function(message, callback, scope) {\r\n\t\t\tvar win;\r\n\r\n\t\t\twin = MessageBox.alert(message, function() {\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback.call(scope || this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\teditor.focus();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\twin.on('close', function() {\r\n\t\t\t\tfireCloseEvent(win);\r\n\t\t\t});\r\n\r\n\t\t\tfireOpenEvent(win);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Creates a confirm dialog. Please don't use the blocking behavior of this\r\n\t\t * native version use the callback method instead then it can be extended.\r\n\t\t *\r\n\t\t * @method confirm\r\n\t\t * @param {String} message Text to display in the new confirm dialog.\r\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok or cancel.\r\n\t\t * @param {Object} scope Optional scope to execute the callback in.\r\n\t\t * @example\r\n\t\t * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\r\n\t\t * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\r\n\t\t *    if (s)\r\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Ok\");\r\n\t\t *    else\r\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\r\n\t\t * });\r\n\t\t */\r\n\t\tself.confirm = function(message, callback, scope) {\r\n\t\t\tvar win;\r\n\r\n\t\t\twin = MessageBox.confirm(message, function(state) {\r\n\t\t\t\tcallback.call(scope || this, state);\r\n\t\t\t});\r\n\r\n\t\t\twin.on('close', function() {\r\n\t\t\t\tfireCloseEvent(win);\r\n\t\t\t});\r\n\r\n\t\t\tfireOpenEvent(win);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Closes the top most window.\r\n\t\t *\r\n\t\t * @method close\r\n\t\t */\r\n\t\tself.close = function() {\r\n\t\t\tif (getTopMostWindow()) {\r\n\t\t\t\tgetTopMostWindow().close();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns the params of the last window open call. This can be used in iframe based\r\n\t\t * dialog to get params passed from the tinymce plugin.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * var dialogArguments = top.tinymce.activeEditor.windowManager.getParams();\r\n\t\t *\r\n\t\t * @method getParams\r\n\t\t * @return {Object} Name/value object with parameters passed from windowManager.open call.\r\n\t\t */\r\n\t\tself.getParams = function() {\r\n\t\t\treturn getTopMostWindow() ? getTopMostWindow().params : null;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Sets the params of the last opened window.\r\n\t\t *\r\n\t\t * @method setParams\r\n\t\t * @param {Object} params Params object to set for the last opened window.\r\n\t\t */\r\n\t\tself.setParams = function(params) {\r\n\t\t\tif (getTopMostWindow()) {\r\n\t\t\t\tgetTopMostWindow().params = params;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns the currently opened window objects.\r\n\t\t *\r\n\t\t * @method getWindows\r\n\t\t * @return {Array} Array of the currently opened windows.\r\n\t\t */\r\n\t\tself.getWindows = function() {\r\n\t\t\treturn windows;\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Tooltip.js\r\n\r\n/**\r\n * Tooltip.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a tooltip instance.\r\n *\r\n * @-x-less ToolTip.less\r\n * @class tinymce.ui.ToolTip\r\n * @extends tinymce.ui.Control\r\n * @mixes tinymce.ui.Movable\r\n */\r\ndefine(\"tinymce/ui/Tooltip\", [\r\n\t\"tinymce/ui/Control\",\r\n\t\"tinymce/ui/Movable\"\r\n], function(Control, Movable) {\r\n\treturn Control.extend({\r\n\t\tMixins: [Movable],\r\n\r\n\t\tDefaults: {\r\n\t\t\tclasses: 'widget tooltip tooltip-n'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, prefix = self.classPrefix;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" role=\"presentation\">' +\r\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-arrow\"></div>' +\r\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-inner\">' + self.encode(self.state.get('text')) + '</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:text', function(e) {\r\n\t\t\t\tself.getEl().lastChild.innerHTML = self.encode(e.value);\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar self = this, style, rect;\r\n\r\n\t\t\tstyle = self.getEl().style;\r\n\t\t\trect = self._layoutRect;\r\n\r\n\t\t\tstyle.left = rect.x + 'px';\r\n\t\t\tstyle.top = rect.y + 'px';\r\n\t\t\tstyle.zIndex = 0xFFFF + 0xFFFF;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Widget.js\r\n\r\n/**\r\n * Widget.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Widget base class a widget is a control that has a tooltip and some basic states.\r\n *\r\n * @class tinymce.ui.Widget\r\n * @extends tinymce.ui.Control\r\n */\r\ndefine(\"tinymce/ui/Widget\", [\r\n\t\"tinymce/ui/Control\",\r\n\t\"tinymce/ui/Tooltip\"\r\n], function(Control, Tooltip) {\r\n\t\"use strict\";\r\n\r\n\tvar tooltip;\r\n\r\n\tvar Widget = Control.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {String} tooltip Tooltip text to display when hovering.\r\n\t\t * @setting {Boolean} autofocus True if the control should be focused when rendered.\r\n\t\t * @setting {String} text Text to display inside widget.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tsettings = self.settings;\r\n\t\t\tself.canFocus = true;\r\n\r\n\t\t\tif (settings.tooltip && Widget.tooltips !== false) {\r\n\t\t\t\tself.on('mouseenter', function(e) {\r\n\t\t\t\t\tvar tooltip = self.tooltip().moveTo(-0xFFFF);\r\n\r\n\t\t\t\t\tif (e.control == self) {\r\n\t\t\t\t\t\tvar rel = tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(), ['bc-tc', 'bc-tl', 'bc-tr']);\r\n\r\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-n', rel == 'bc-tc');\r\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-nw', rel == 'bc-tl');\r\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-ne', rel == 'bc-tr');\r\n\r\n\t\t\t\t\t\ttooltip.moveRel(self.getEl(), rel);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttooltip.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.on('mouseleave mousedown click', function() {\r\n\t\t\t\t\tself.tooltip().hide();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tself.aria('label', settings.ariaLabel || settings.tooltip);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the current tooltip instance.\r\n\t\t *\r\n\t\t * @method tooltip\r\n\t\t * @return {tinymce.ui.Tooltip} Tooltip instance.\r\n\t\t */\r\n\t\ttooltip: function() {\r\n\t\t\tif (!tooltip) {\r\n\t\t\t\ttooltip = new Tooltip({type: 'tooltip'});\r\n\t\t\t\ttooltip.renderTo();\r\n\t\t\t}\r\n\r\n\t\t\treturn tooltip;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, settings = self.settings;\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tif (!self.parent() && (settings.width || settings.height)) {\r\n\t\t\t\tself.initLayoutRect();\r\n\t\t\t\tself.repaint();\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.autofocus) {\r\n\t\t\t\tself.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tfunction disable(state) {\r\n\t\t\t\tself.aria('disabled', state);\r\n\t\t\t\tself.classes.toggle('disabled', state);\r\n\t\t\t}\r\n\r\n\t\t\tfunction active(state) {\r\n\t\t\t\tself.aria('pressed', state);\r\n\t\t\t\tself.classes.toggle('active', state);\r\n\t\t\t}\r\n\r\n\t\t\tself.state.on('change:disabled', function(e) {\r\n\t\t\t\tdisable(e.value);\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:active', function(e) {\r\n\t\t\t\tactive(e.value);\r\n\t\t\t});\r\n\r\n\t\t\tif (self.state.get('disabled')) {\r\n\t\t\t\tdisable(true);\r\n\t\t\t}\r\n\r\n\t\t\tif (self.state.get('active')) {\r\n\t\t\t\tactive(true);\r\n\t\t\t}\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the current control from DOM and from UI collections.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tthis._super();\r\n\r\n\t\t\tif (tooltip) {\r\n\t\t\t\ttooltip.remove();\r\n\t\t\t\ttooltip = null;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn Widget;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Progress.js\r\n\r\n/**\r\n * Progress.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Progress control.\r\n *\r\n * @-x-less Progress.less\r\n * @class tinymce.ui.Progress\r\n * @extends tinymce.ui.Control\r\n */\r\ndefine(\"tinymce/ui/Progress\", [\r\n\t\"tinymce/ui/Widget\"\r\n], function(Widget) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\tDefaults: {\r\n\t\t\tvalue: 0\r\n\t\t},\r\n\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself.classes.add('progress');\r\n\r\n\t\t\tif (!self.settings.filter) {\r\n\t\t\t\tself.settings.filter = function(value) {\r\n\t\t\t\t\treturn Math.round(value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = this.classPrefix;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\t'<div class=\"' + prefix + 'bar-container\">' +\r\n\t\t\t\t\t\t'<div class=\"' + prefix + 'bar\"></div>' +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t'<div class=\"' + prefix + 'text\">0%</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super();\r\n\t\t\tself.value(self.settings.value);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tfunction setValue(value) {\r\n\t\t\t\tvalue = self.settings.filter(value);\r\n\t\t\t\tself.getEl().lastChild.innerHTML = value + '%';\r\n\t\t\t\tself.getEl().firstChild.firstChild.style.width = value + '%';\r\n\t\t\t}\r\n\r\n\t\t\tself.state.on('change:value', function(e) {\r\n\t\t\t\tsetValue(e.value);\r\n\t\t\t});\r\n\r\n\t\t\tsetValue(self.state.get('value'));\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Notification.js\r\n\r\n/**\r\n * Notification.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a notification instance.\r\n *\r\n * @-x-less Notification.less\r\n * @class tinymce.ui.Notification\r\n * @extends tinymce.ui.Container\r\n * @mixes tinymce.ui.Movable\r\n */\r\ndefine(\"tinymce/ui/Notification\", [\r\n\t\"tinymce/ui/Control\",\r\n\t\"tinymce/ui/Movable\",\r\n\t\"tinymce/ui/Progress\",\r\n\t\"tinymce/util/Delay\"\r\n], function(Control, Movable, Progress, Delay) {\r\n\treturn Control.extend({\r\n\t\tMixins: [Movable],\r\n\r\n\t\tDefaults: {\r\n\t\t\tclasses: 'widget notification'\r\n\t\t},\r\n\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\r\n\t\t\tif (settings.text) {\r\n\t\t\t\tself.text(settings.text);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.icon) {\r\n\t\t\t\tself.icon = settings.icon;\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.color) {\r\n\t\t\t\tself.color = settings.color;\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.type) {\r\n\t\t\t\tself.classes.add('notification-' + settings.type);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.timeout && (settings.timeout < 0 || settings.timeout > 0) && !settings.closeButton) {\r\n\t\t\t\tself.closeButton = false;\r\n\t\t\t} else {\r\n\t\t\t\tself.classes.add('has-close');\r\n\t\t\t\tself.closeButton = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.progressBar) {\r\n\t\t\t\tself.progressBar = new Progress();\r\n\t\t\t}\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tif (e.target.className.indexOf(self.classPrefix + 'close') != -1) {\r\n\t\t\t\t\tself.close();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, prefix = self.classPrefix, icon = '', closeButton = '', progressBar = '', notificationStyle = '';\r\n\r\n\t\t\tif (self.icon) {\r\n\t\t\t\ticon = '<i class=\"' + prefix + 'ico' + ' ' + prefix + 'i-' + self.icon + '\"></i>';\r\n\t\t\t}\r\n\r\n\t\t\tif (self.color) {\r\n\t\t\t\tnotificationStyle = ' style=\"background-color: ' + self.color + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tif (self.closeButton) {\r\n\t\t\t\tcloseButton = '<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">\\u00d7</button>';\r\n\t\t\t}\r\n\r\n\t\t\tif (self.progressBar) {\r\n\t\t\t\tprogressBar = self.progressBar.renderHtml();\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + notificationStyle + ' role=\"presentation\">' +\r\n\t\t\t\t\ticon +\r\n\t\t\t\t\t'<div class=\"' + prefix + 'notification-inner\">' + self.state.get('text') + '</div>' +\r\n\t\t\t\t\tprogressBar +\r\n\t\t\t\t\tcloseButton +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tDelay.setTimeout(function() {\r\n\t\t\t\tself.$el.addClass(self.classPrefix + 'in');\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:text', function(e) {\r\n\t\t\t\tself.getEl().childNodes[1].innerHTML = e.value;\r\n\t\t\t});\r\n\t\t\tif (self.progressBar) {\r\n\t\t\t\tself.progressBar.bindStates();\r\n\t\t\t}\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\tclose: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\r\n\t\t\t\tself.remove();\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar self = this, style, rect;\r\n\r\n\t\t\tstyle = self.getEl().style;\r\n\t\t\trect = self._layoutRect;\r\n\r\n\t\t\tstyle.left = rect.x + 'px';\r\n\t\t\tstyle.top = rect.y + 'px';\r\n\t\t\tstyle.zIndex = 0xFFFF + 0xFFFF;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/NotificationManager.js\r\n\r\n/**\r\n * NotificationManager.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class handles the creation of TinyMCE's notifications.\r\n *\r\n * @class tinymce.notificationManager\r\n * @example\r\n * // Opens a new notification of type \"error\" with text \"An error occurred.\"\r\n * tinymce.activeEditor.notificationManager.open({\r\n *    text: 'An error occurred.',\r\n *    type: 'error'\r\n * });\r\n */\r\ndefine(\"tinymce/NotificationManager\", [\r\n\t\"tinymce/ui/Notification\",\r\n\t\"tinymce/util/Delay\"\r\n], function(Notification, Delay) {\r\n\treturn function(editor) {\r\n\t\tvar self = this, notifications = [];\r\n\r\n\t\tfunction getLastNotification() {\r\n\t\t\tif (notifications.length) {\r\n\t\t\t\treturn notifications[notifications.length - 1];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tself.notifications = notifications;\r\n\r\n\t\tfunction resizeWindowEvent() {\r\n\t\t\tDelay.requestAnimationFrame(function() {\r\n\t\t\t\tprePositionNotifications();\r\n\t\t\t\tpositionNotifications();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Since the viewport will change based on the present notifications, we need to move them all to the\r\n\t\t// top left of the viewport to give an accurate size measurement so we can position them later.\r\n\t\tfunction prePositionNotifications() {\r\n\t\t\tfor (var i = 0; i < notifications.length; i++) {\r\n\t\t\t\tnotifications[i].moveTo(0, 0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction positionNotifications() {\r\n\t\t\tif (notifications.length > 0) {\r\n\t\t\t\tvar firstItem = notifications.slice(0, 1)[0];\r\n\t\t\t\tvar container = editor.inline ? editor.getElement() : editor.getContentAreaContainer();\r\n\t\t\t\tfirstItem.moveRel(container, 'tc-tc');\r\n\t\t\t\tif (notifications.length > 1) {\r\n\t\t\t\t\tfor (var i = 1; i < notifications.length; i++) {\r\n\t\t\t\t\t\tnotifications[i].moveRel(notifications[i - 1].getEl(), 'bc-tc');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\teditor.on('remove', function() {\r\n\t\t\tvar i = notifications.length;\r\n\r\n\t\t\twhile (i--) {\r\n\t\t\t\tnotifications[i].close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\teditor.on('ResizeEditor', positionNotifications);\r\n\t\teditor.on('ResizeWindow', resizeWindowEvent);\r\n\r\n\t\t/**\r\n\t\t * Opens a new notification.\r\n\t\t *\r\n\t\t * @method open\r\n\t\t * @param {Object} args Optional name/value settings collection contains things like timeout/color/message etc.\r\n\t\t */\r\n\t\tself.open = function(args) {\r\n\t\t\tvar notif;\r\n\r\n\t\t\teditor.editorManager.setActive(editor);\r\n\r\n\t\t\tnotif = new Notification(args);\r\n\t\t\tnotifications.push(notif);\r\n\r\n\t\t\t//If we have a timeout value\r\n\t\t\tif (args.timeout > 0) {\r\n\t\t\t\tnotif.timer = setTimeout(function() {\r\n\t\t\t\t\tnotif.close();\r\n\t\t\t\t}, args.timeout);\r\n\t\t\t}\r\n\r\n\t\t\tnotif.on('close', function() {\r\n\t\t\t\tvar i = notifications.length;\r\n\r\n\t\t\t\tif (notif.timer) {\r\n\t\t\t\t\teditor.getWin().clearTimeout(notif.timer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tif (notifications[i] === notif) {\r\n\t\t\t\t\t\tnotifications.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpositionNotifications();\r\n\t\t\t});\r\n\r\n\t\t\tnotif.renderTo();\r\n\r\n\t\t\tpositionNotifications();\r\n\r\n\t\t\treturn notif;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Closes the top most notification.\r\n\t\t *\r\n\t\t * @method close\r\n\t\t */\r\n\t\tself.close = function() {\r\n\t\t\tif (getLastNotification()) {\r\n\t\t\t\tgetLastNotification().close();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Returns the currently opened notification objects.\r\n\t\t *\r\n\t\t * @method getNotifications\r\n\t\t * @return {Array} Array of the currently opened notifications.\r\n\t\t */\r\n\t\tself.getNotifications = function() {\r\n\t\t\treturn notifications;\r\n\t\t};\r\n\r\n\t\teditor.on('SkinLoaded', function() {\r\n\t\t\tvar serviceMessage = editor.settings.service_message;\r\n\r\n\t\t\tif (serviceMessage) {\r\n\t\t\t\teditor.notificationManager.open({\r\n\t\t\t\t\ttext: serviceMessage,\r\n\t\t\t\t\ttype: 'warning',\r\n\t\t\t\t\ttimeout: 0,\r\n\t\t\t\t\ticon: ''\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//self.positionNotifications = positionNotifications;\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/NodePath.js\r\n\r\n/**\r\n * NodePath.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Handles paths of nodes within an element.\r\n *\r\n * @private\r\n * @class tinymce.dom.NodePath\r\n */\r\ndefine(\"tinymce/dom/NodePath\", [\r\n\t\"tinymce/dom/DOMUtils\"\r\n], function(DOMUtils) {\r\n\tfunction create(rootNode, targetNode, normalized) {\r\n\t\tvar path = [];\r\n\r\n\t\tfor (; targetNode && targetNode != rootNode; targetNode = targetNode.parentNode) {\r\n\t\t\tpath.push(DOMUtils.nodeIndex(targetNode, normalized));\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t}\r\n\r\n\tfunction resolve(rootNode, path) {\r\n\t\tvar i, node, children;\r\n\r\n\t\tfor (node = rootNode, i = path.length - 1; i >= 0; i--) {\r\n\t\t\tchildren = node.childNodes;\r\n\r\n\t\t\tif (path[i] > children.length - 1) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tnode = children[path[i]];\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\treturn {\r\n\t\tcreate: create,\r\n\t\tresolve: resolve\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Quirks.js\r\n\r\n/**\r\n * Quirks.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n *\r\n * @ignore-file\r\n */\r\n\r\n/**\r\n * This file includes fixes for various browser quirks it's made to make it easy to add/remove browser specific fixes.\r\n *\r\n * @private\r\n * @class tinymce.util.Quirks\r\n */\r\ndefine(\"tinymce/util/Quirks\", [\r\n\t\"tinymce/util/VK\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/dom/TreeWalker\",\r\n\t\"tinymce/dom/NodePath\",\r\n\t\"tinymce/html/Node\",\r\n\t\"tinymce/html/Entities\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/util/Delay\",\r\n\t\"tinymce/caret/CaretContainer\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/caret/CaretWalker\"\r\n], function(VK, RangeUtils, TreeWalker, NodePath, Node, Entities, Env, Tools, Delay, CaretContainer, CaretPosition, CaretWalker) {\r\n\treturn function(editor) {\r\n\t\tvar each = Tools.each, $ = editor.$;\r\n\t\tvar BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection,\r\n\t\t\tsettings = editor.settings, parser = editor.parser, serializer = editor.serializer;\r\n\t\tvar isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\r\n\t\tvar mceInternalUrlPrefix = 'data:text/mce-internal,';\r\n\t\tvar mceInternalDataType = isIE ? 'Text' : 'URL';\r\n\r\n\t\t/**\r\n\t\t * Executes a command with a specific state this can be to enable/disable browser editing features.\r\n\t\t */\r\n\t\tfunction setEditorCommandState(cmd, state) {\r\n\t\t\ttry {\r\n\t\t\t\teditor.getDoc().execCommand(cmd, false, state);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns current IE document mode.\r\n\t\t */\r\n\t\tfunction getDocumentMode() {\r\n\t\t\tvar documentMode = editor.getDoc().documentMode;\r\n\r\n\t\t\treturn documentMode ? documentMode : 6;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the event is prevented or not.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Event} e Event object.\r\n\t\t * @return {Boolean} true/false if the event is prevented or not.\r\n\t\t */\r\n\t\tfunction isDefaultPrevented(e) {\r\n\t\t\treturn e.isDefaultPrevented();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Sets Text/URL data on the event's dataTransfer object to a special data:text/mce-internal url.\r\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\r\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {DragEvent} e Event object\r\n\t\t */\r\n\t\tfunction setMceInternalContent(e) {\r\n\t\t\tvar selectionHtml, internalContent;\r\n\r\n\t\t\tif (e.dataTransfer) {\r\n\t\t\t\tif (editor.selection.isCollapsed() && e.target.tagName == 'IMG') {\r\n\t\t\t\t\tselection.select(e.target);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselectionHtml = editor.selection.getContent();\r\n\r\n\t\t\t\t// Safari/IE doesn't support custom dataTransfer items so we can only use URL and Text\r\n\t\t\t\tif (selectionHtml.length > 0) {\r\n\t\t\t\t\tinternalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\r\n\t\t\t\t\te.dataTransfer.setData(mceInternalDataType, internalContent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Gets content of special data:text/mce-internal url on the event's dataTransfer object.\r\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\r\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {DragEvent} e Event object\r\n\t\t * @returns {String} mce-internal content\r\n\t\t */\r\n\t\tfunction getMceInternalContent(e) {\r\n\t\t\tvar internalContent;\r\n\r\n\t\t\tif (e.dataTransfer) {\r\n\t\t\t\tinternalContent = e.dataTransfer.getData(mceInternalDataType);\r\n\r\n\t\t\t\tif (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\r\n\t\t\t\t\tinternalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tid: unescape(internalContent[0]),\r\n\t\t\t\t\t\thtml: unescape(internalContent[1])\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Inserts contents using the paste clipboard command if it's available if it isn't it will fallback\r\n\t\t * to the core command.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {String} content Content to insert at selection.\r\n\t\t */\r\n\t\tfunction insertClipboardContents(content) {\r\n\t\t\tif (editor.queryCommandSupported('mceInsertClipboardContent')) {\r\n\t\t\t\teditor.execCommand('mceInsertClipboardContent', false, {content: content});\r\n\t\t\t} else {\r\n\t\t\t\teditor.execCommand('mceInsertContent', false, content);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Fixes a WebKit bug when deleting contents using backspace or delete key.\r\n\t\t * WebKit will produce a span element if you delete across two block elements.\r\n\t\t *\r\n\t\t * Example:\r\n\t\t * <h1>a</h1><p>|b</p>\r\n\t\t *\r\n\t\t * Will produce this on backspace:\r\n\t\t * <h1>a<span style=\"<all runtime styles>\">b</span></p>\r\n\t\t *\r\n\t\t * This fixes the backspace to produce:\r\n\t\t * <h1>a|b</p>\r\n\t\t *\r\n\t\t * See bug: https://bugs.webkit.org/show_bug.cgi?id=45784\r\n\t\t *\r\n\t\t * This fixes the following delete scenarios:\r\n\t\t *  1. Delete by pressing backspace key.\r\n\t\t *  2. Delete by pressing delete key.\r\n\t\t *  3. Delete by pressing backspace key with ctrl/cmd (Word delete).\r\n\t\t *  4. Delete by pressing delete key with ctrl/cmd (Word delete).\r\n\t\t *  5. Delete by drag/dropping contents inside the editor.\r\n\t\t *  6. Delete by using Cut Ctrl+X/Cmd+X.\r\n\t\t *  7. Delete by selecting contents and writing a character.\r\n\t\t *\r\n\t\t * This code is a ugly hack since writing full custom delete logic for just this bug\r\n\t\t * fix seemed like a huge task. I hope we can remove this before the year 2030.\r\n\t\t */\r\n\t\tfunction cleanupStylesWhenDeleting() {\r\n\t\t\tvar doc = editor.getDoc(), dom = editor.dom, selection = editor.selection;\r\n\t\t\tvar MutationObserver = window.MutationObserver, olderWebKit, dragStartRng;\r\n\r\n\t\t\t// Add mini polyfill for older WebKits\r\n\t\t\t// TODO: Remove this when old Safari versions gets updated\r\n\t\t\tif (!MutationObserver) {\r\n\t\t\t\tolderWebKit = true;\r\n\r\n\t\t\t\tMutationObserver = function() {\r\n\t\t\t\t\tvar records = [], target;\r\n\r\n\t\t\t\t\tfunction nodeInsert(e) {\r\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\r\n\t\t\t\t\t\trecords.push({target: target, addedNodes: [target]});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction attrModified(e) {\r\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\r\n\t\t\t\t\t\trecords.push({target: target, attributeName: e.attrName});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.observe = function(node) {\r\n\t\t\t\t\t\ttarget = node;\r\n\t\t\t\t\t\ttarget.addEventListener('DOMSubtreeModified', nodeInsert, false);\r\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\r\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInserted', nodeInsert, false);\r\n\t\t\t\t\t\ttarget.addEventListener('DOMAttrModified', attrModified, false);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.disconnect = function() {\r\n\t\t\t\t\t\ttarget.removeEventListener('DOMSubtreeModified', nodeInsert, false);\r\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\r\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInserted', nodeInsert, false);\r\n\t\t\t\t\t\ttarget.removeEventListener('DOMAttrModified', attrModified, false);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.takeRecords = function() {\r\n\t\t\t\t\t\treturn records;\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction isTrailingBr(node) {\r\n\t\t\t\tvar blockElements = dom.schema.getBlockElements(), rootNode = editor.getBody();\r\n\r\n\t\t\t\tif (node.nodeName != 'BR') {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (; node != rootNode && !blockElements[node.nodeName]; node = node.parentNode) {\r\n\t\t\t\t\tif (node.nextSibling) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfunction isSiblingsIgnoreWhiteSpace(node1, node2) {\r\n\t\t\t\tvar node;\r\n\r\n\t\t\t\tfor (node = node1.nextSibling; node && node != node2; node = node.nextSibling) {\r\n\t\t\t\t\tif (node.nodeType == 3 && $.trim(node.data).length === 0) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (node !== node2) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node === node2;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findCaretNode(node, forward, startNode) {\r\n\t\t\t\tvar walker, current, nonEmptyElements;\r\n\r\n\t\t\t\tnonEmptyElements = dom.schema.getNonEmptyElements();\r\n\r\n\t\t\t\twalker = new TreeWalker(startNode || node, node);\r\n\r\n\t\t\t\twhile ((current = walker[forward ? 'next' : 'prev']())) {\r\n\t\t\t\t\tif (nonEmptyElements[current.nodeName] && !isTrailingBr(current)) {\r\n\t\t\t\t\t\treturn current;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (current.nodeType == 3 && current.data.length > 0) {\r\n\t\t\t\t\t\treturn current;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction deleteRangeBetweenTextBlocks(rng) {\r\n\t\t\t\tvar startBlock, endBlock, caretNodeBefore, caretNodeAfter, textBlockElements;\r\n\r\n\t\t\t\tif (rng.collapsed) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstartBlock = dom.getParent(RangeUtils.getNode(rng.startContainer, rng.startOffset), dom.isBlock);\r\n\t\t\t\tendBlock = dom.getParent(RangeUtils.getNode(rng.endContainer, rng.endOffset), dom.isBlock);\r\n\t\t\t\ttextBlockElements = editor.schema.getTextBlockElements();\r\n\r\n\t\t\t\tif (startBlock == endBlock) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!textBlockElements[startBlock.nodeName] || !textBlockElements[endBlock.nodeName]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (dom.getContentEditable(startBlock) === \"false\" || dom.getContentEditable(endBlock) === \"false\") {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trng.deleteContents();\r\n\r\n\t\t\t\tcaretNodeBefore = findCaretNode(startBlock, false);\r\n\t\t\t\tcaretNodeAfter = findCaretNode(endBlock, true);\r\n\r\n\t\t\t\tif (!dom.isEmpty(endBlock)) {\r\n\t\t\t\t\t$(startBlock).append(endBlock.childNodes);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(endBlock).remove();\r\n\r\n\t\t\t\tif (caretNodeBefore) {\r\n\t\t\t\t\tif (caretNodeBefore.nodeType == 1) {\r\n\t\t\t\t\t\tif (caretNodeBefore.nodeName == \"BR\") {\r\n\t\t\t\t\t\t\trng.setStartBefore(caretNodeBefore);\r\n\t\t\t\t\t\t\trng.setEndBefore(caretNodeBefore);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.setStartAfter(caretNodeBefore);\r\n\t\t\t\t\t\t\trng.setEndAfter(caretNodeBefore);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trng.setStart(caretNodeBefore, caretNodeBefore.data.length);\r\n\t\t\t\t\t\trng.setEnd(caretNodeBefore, caretNodeBefore.data.length);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (caretNodeAfter) {\r\n\t\t\t\t\tif (caretNodeAfter.nodeType == 1) {\r\n\t\t\t\t\t\trng.setStartBefore(caretNodeAfter);\r\n\t\t\t\t\t\trng.setEndBefore(caretNodeAfter);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trng.setStart(caretNodeAfter, 0);\r\n\t\t\t\t\t\trng.setEnd(caretNodeAfter, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselection.setRng(rng);\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfunction expandBetweenBlocks(rng, isForward) {\r\n\t\t\t\tvar caretNode, targetCaretNode, textBlock, targetTextBlock, container, offset;\r\n\r\n\t\t\t\tif (!rng.collapsed) {\r\n\t\t\t\t\treturn rng;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer = rng.startContainer;\r\n\t\t\t\toffset = rng.startOffset;\r\n\r\n\t\t\t\tif (container.nodeType == 3) {\r\n\t\t\t\t\tif (isForward) {\r\n\t\t\t\t\t\tif (offset < container.data.length) {\r\n\t\t\t\t\t\t\treturn rng;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (offset > 0) {\r\n\t\t\t\t\t\t\treturn rng;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcaretNode = RangeUtils.getNode(rng.startContainer, rng.startOffset);\r\n\t\t\t\ttextBlock = dom.getParent(caretNode, dom.isBlock);\r\n\t\t\t\ttargetCaretNode = findCaretNode(editor.getBody(), isForward, caretNode);\r\n\t\t\t\ttargetTextBlock = dom.getParent(targetCaretNode, dom.isBlock);\r\n\r\n\t\t\t\tif (!caretNode || !targetCaretNode) {\r\n\t\t\t\t\treturn rng;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (targetTextBlock && textBlock != targetTextBlock) {\r\n\t\t\t\t\tif (!isForward) {\r\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(targetTextBlock, textBlock)) {\r\n\t\t\t\t\t\t\treturn rng;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\r\n\t\t\t\t\t\t\tif (targetCaretNode.nodeName == \"BR\") {\r\n\t\t\t\t\t\t\t\trng.setStartBefore(targetCaretNode);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trng.setStartAfter(targetCaretNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.setStart(targetCaretNode, targetCaretNode.data.length);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\r\n\t\t\t\t\t\t\trng.setEnd(caretNode, 0);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.setEndBefore(caretNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(textBlock, targetTextBlock)) {\r\n\t\t\t\t\t\t\treturn rng;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\r\n\t\t\t\t\t\t\tif (caretNode.nodeName == \"BR\") {\r\n\t\t\t\t\t\t\t\trng.setStartBefore(caretNode);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trng.setStartAfter(caretNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.setStart(caretNode, caretNode.data.length);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\r\n\t\t\t\t\t\t\trng.setEnd(targetCaretNode, 0);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.setEndBefore(targetCaretNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleTextBlockMergeDelete(isForward) {\r\n\t\t\t\tvar rng = selection.getRng();\r\n\r\n\t\t\t\trng = expandBetweenBlocks(rng, isForward);\r\n\r\n\t\t\t\tif (deleteRangeBetweenTextBlocks(rng)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * This retains the formatting if the last character is to be deleted.\r\n\t\t\t *\r\n\t\t\t * Backspace on this: <p><b><i>a|</i></b></p> would become <p>|</p> in WebKit.\r\n\t\t\t * With this patch: <p><b><i>|<br></i></b></p>\r\n\t\t\t */\r\n\t\t\tfunction handleLastBlockCharacterDelete(isForward, rng) {\r\n\t\t\t\tvar path, blockElm, newBlockElm, clonedBlockElm, sibling,\r\n\t\t\t\t\tcontainer, offset, br, currentFormatNodes;\r\n\r\n\t\t\t\tfunction cloneTextBlockWithFormats(blockElm, node) {\r\n\t\t\t\t\tcurrentFormatNodes = $(node).parents().filter(function(idx, node) {\r\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tnewBlockElm = blockElm.cloneNode(false);\r\n\r\n\t\t\t\t\tcurrentFormatNodes = Tools.map(currentFormatNodes, function(formatNode) {\r\n\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\r\n\r\n\t\t\t\t\t\tif (newBlockElm.hasChildNodes()) {\r\n\t\t\t\t\t\t\tformatNode.appendChild(newBlockElm.firstChild);\r\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\r\n\r\n\t\t\t\t\t\treturn formatNode;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (currentFormatNodes.length) {\r\n\t\t\t\t\t\tbr = dom.create('br');\r\n\t\t\t\t\t\tcurrentFormatNodes[0].appendChild(br);\r\n\t\t\t\t\t\tdom.replace(newBlockElm, blockElm);\r\n\r\n\t\t\t\t\t\trng.setStartBefore(br);\r\n\t\t\t\t\t\trng.setEndBefore(br);\r\n\t\t\t\t\t\teditor.selection.setRng(rng);\r\n\r\n\t\t\t\t\t\treturn br;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction isTextBlock(node) {\r\n\t\t\t\t\treturn node && editor.schema.getTextBlockElements()[node.tagName];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!rng.collapsed) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer = rng.startContainer;\r\n\t\t\t\toffset = rng.startOffset;\r\n\t\t\t\tblockElm = dom.getParent(container, dom.isBlock);\r\n\t\t\t\tif (!isTextBlock(blockElm)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (container.nodeType == 1) {\r\n\t\t\t\t\tcontainer = container.childNodes[offset];\r\n\t\t\t\t\tif (container && container.tagName != 'BR') {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (isForward) {\r\n\t\t\t\t\t\tsibling = blockElm.nextSibling;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsibling = blockElm.previousSibling;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (dom.isEmpty(blockElm) && isTextBlock(sibling) && dom.isEmpty(sibling)) {\r\n\t\t\t\t\t\tif (cloneTextBlockWithFormats(blockElm, container)) {\r\n\t\t\t\t\t\t\tdom.remove(sibling);\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (container.nodeType == 3) {\r\n\t\t\t\t\tpath = NodePath.create(blockElm, container);\r\n\t\t\t\t\tclonedBlockElm = blockElm.cloneNode(true);\r\n\t\t\t\t\tcontainer = NodePath.resolve(clonedBlockElm, path);\r\n\r\n\t\t\t\t\tif (isForward) {\r\n\t\t\t\t\t\tif (offset >= container.data.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcontainer.deleteData(offset, 1);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (offset <= 0) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (dom.isEmpty(clonedBlockElm)) {\r\n\t\t\t\t\t\treturn cloneTextBlockWithFormats(blockElm, container);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction customDelete(isForward) {\r\n\t\t\t\tvar mutationObserver, rng, caretElement;\r\n\r\n\t\t\t\tif (handleTextBlockMergeDelete(isForward)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tTools.each(editor.getBody().getElementsByTagName('*'), function(elm) {\r\n\t\t\t\t\t// Mark existing spans\r\n\t\t\t\t\tif (elm.tagName == 'SPAN') {\r\n\t\t\t\t\t\telm.setAttribute('mce-data-marked', 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Make sure all elements has a data-mce-style attribute\r\n\t\t\t\t\tif (!elm.hasAttribute('data-mce-style') && elm.hasAttribute('style')) {\r\n\t\t\t\t\t\teditor.dom.setAttrib(elm, 'style', editor.dom.getAttrib(elm, 'style'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Observe added nodes and style attribute changes\r\n\t\t\t\tmutationObserver = new MutationObserver(function() {});\r\n\t\t\t\tmutationObserver.observe(editor.getDoc(), {\r\n\t\t\t\t\tchildList: true,\r\n\t\t\t\t\tattributes: true,\r\n\t\t\t\t\tsubtree: true,\r\n\t\t\t\t\tattributeFilter: ['style']\r\n\t\t\t\t});\r\n\r\n\t\t\t\teditor.getDoc().execCommand(isForward ? 'ForwardDelete' : 'Delete', false, null);\r\n\r\n\t\t\t\trng = editor.selection.getRng();\r\n\t\t\t\tcaretElement = rng.startContainer.parentNode;\r\n\r\n\t\t\t\tTools.each(mutationObserver.takeRecords(), function(record) {\r\n\t\t\t\t\tif (!dom.isChildOf(record.target, editor.getBody())) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Restore style attribute to previous value\r\n\t\t\t\t\tif (record.attributeName == \"style\") {\r\n\t\t\t\t\t\tvar oldValue = record.target.getAttribute('data-mce-style');\r\n\r\n\t\t\t\t\t\tif (oldValue) {\r\n\t\t\t\t\t\t\trecord.target.setAttribute(\"style\", oldValue);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trecord.target.removeAttribute(\"style\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove all spans that aren't marked and retain selection\r\n\t\t\t\t\tTools.each(record.addedNodes, function(node) {\r\n\t\t\t\t\t\tif (node.nodeName == \"SPAN\" && !node.getAttribute('mce-data-marked')) {\r\n\t\t\t\t\t\t\tvar offset, container;\r\n\r\n\t\t\t\t\t\t\tif (node == caretElement) {\r\n\t\t\t\t\t\t\t\toffset = rng.startOffset;\r\n\t\t\t\t\t\t\t\tcontainer = node.firstChild;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tdom.remove(node, true);\r\n\r\n\t\t\t\t\t\t\tif (container) {\r\n\t\t\t\t\t\t\t\trng.setStart(container, offset);\r\n\t\t\t\t\t\t\t\trng.setEnd(container, offset);\r\n\t\t\t\t\t\t\t\teditor.selection.setRng(rng);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tmutationObserver.disconnect();\r\n\r\n\t\t\t\t// Remove any left over marks\r\n\t\t\t\tTools.each(editor.dom.select('span[mce-data-marked]'), function(span) {\r\n\t\t\t\t\tspan.removeAttribute('mce-data-marked');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\tvar isForward = e.keyCode == DELETE, isMetaOrCtrl = e.ctrlKey || e.metaKey;\r\n\r\n\t\t\t\tif (!isDefaultPrevented(e) && (isForward || e.keyCode == BACKSPACE)) {\r\n\t\t\t\t\tvar rng = editor.selection.getRng(), container = rng.startContainer, offset = rng.startOffset;\r\n\r\n\t\t\t\t\t// Shift+Delete is cut\r\n\t\t\t\t\tif (isForward && e.shiftKey) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (handleLastBlockCharacterDelete(isForward, rng)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Ignore non meta delete in the where there is text before/after the caret\r\n\t\t\t\t\tif (!isMetaOrCtrl && rng.collapsed && container.nodeType == 3) {\r\n\t\t\t\t\t\tif (isForward ? offset < container.data.length : offset > 0) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tif (isMetaOrCtrl) {\r\n\t\t\t\t\t\teditor.selection.getSel().modify(\"extend\", isForward ? \"forward\" : \"backward\", e.metaKey ? \"lineboundary\" : \"word\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcustomDelete(isForward);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Handle case where text is deleted by typing over\r\n\t\t\teditor.on('keypress', function(e) {\r\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\r\n\t\t\t\t\tvar rng, currentFormatNodes, fragmentNode, blockParent, caretNode, charText;\r\n\r\n\t\t\t\t\trng = editor.selection.getRng();\r\n\t\t\t\t\tcharText = String.fromCharCode(e.charCode);\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t// Keep track of current format nodes\r\n\t\t\t\t\tcurrentFormatNodes = $(rng.startContainer).parents().filter(function(idx, node) {\r\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcustomDelete(true);\r\n\r\n\t\t\t\t\t// Check if the browser removed them\r\n\t\t\t\t\tcurrentFormatNodes = currentFormatNodes.filter(function(idx, node) {\r\n\t\t\t\t\t\treturn !$.contains(editor.getBody(), node);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Then re-add them\r\n\t\t\t\t\tif (currentFormatNodes.length) {\r\n\t\t\t\t\t\tfragmentNode = dom.createFragment();\r\n\r\n\t\t\t\t\t\tcurrentFormatNodes.each(function(idx, formatNode) {\r\n\t\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\r\n\r\n\t\t\t\t\t\t\tif (fragmentNode.hasChildNodes()) {\r\n\t\t\t\t\t\t\t\tformatNode.appendChild(fragmentNode.firstChild);\r\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcaretNode = formatNode;\r\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tcaretNode.appendChild(editor.getDoc().createTextNode(charText));\r\n\r\n\t\t\t\t\t\t// Prevent edge case where older WebKit would add an extra BR element\r\n\t\t\t\t\t\tblockParent = dom.getParent(rng.startContainer, dom.isBlock);\r\n\t\t\t\t\t\tif (dom.isEmpty(blockParent)) {\r\n\t\t\t\t\t\t\t$(blockParent).empty().append(fragmentNode);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trng.insertNode(fragmentNode);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\trng.setStart(caretNode.firstChild, 1);\r\n\t\t\t\t\t\trng.setEnd(caretNode.firstChild, 1);\r\n\t\t\t\t\t\teditor.selection.setRng(rng);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\teditor.selection.setContent(charText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.addCommand('Delete', function() {\r\n\t\t\t\tcustomDelete();\r\n\t\t\t});\r\n\r\n\t\t\teditor.addCommand('ForwardDelete', function() {\r\n\t\t\t\tcustomDelete(true);\r\n\t\t\t});\r\n\r\n\t\t\t// Older WebKits doesn't properly handle the clipboard so we can't add the rest\r\n\t\t\tif (olderWebKit) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\teditor.on('dragstart', function(e) {\r\n\t\t\t\tdragStartRng = selection.getRng();\r\n\t\t\t\tsetMceInternalContent(e);\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('drop', function(e) {\r\n\t\t\t\tif (!isDefaultPrevented(e)) {\r\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\r\n\r\n\t\t\t\t\tif (internalContent) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t// Safari has a weird issue where drag/dropping images sometimes\r\n\t\t\t\t\t\t// produces a green plus icon. When this happens the caretRangeFromPoint\r\n\t\t\t\t\t\t// will return \"null\" even though the x, y coordinate is correct.\r\n\t\t\t\t\t\t// But if we detach the insert from the drop event we will get a proper range\r\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\t\t\tvar pointRng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, doc);\r\n\r\n\t\t\t\t\t\t\tif (dragStartRng) {\r\n\t\t\t\t\t\t\t\tselection.setRng(dragStartRng);\r\n\t\t\t\t\t\t\t\tdragStartRng = null;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcustomDelete();\r\n\t\t\t\t\t\t\tselection.setRng(pointRng);\r\n\t\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('cut', function(e) {\r\n\t\t\t\tif (!isDefaultPrevented(e) && e.clipboardData && !editor.selection.isCollapsed()) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.clipboardData.clearData();\r\n\t\t\t\t\te.clipboardData.setData('text/html', editor.selection.getContent());\r\n\t\t\t\t\te.clipboardData.setData('text/plain', editor.selection.getContent({format: 'text'}));\r\n\r\n\t\t\t\t\t// Needed delay for https://code.google.com/p/chromium/issues/detail?id=363288#c3\r\n\t\t\t\t\t// Nested delete/forwardDelete not allowed on execCommand(\"cut\")\r\n\t\t\t\t\t// This is ugly but not sure how to work around it otherwise\r\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\t\tcustomDelete(true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Makes sure that the editor body becomes empty when backspace or delete is pressed in empty editors.\r\n\t\t *\r\n\t\t * For example:\r\n\t\t * <p><b>|</b></p>\r\n\t\t *\r\n\t\t * Or:\r\n\t\t * <h1>|</h1>\r\n\t\t *\r\n\t\t * Or:\r\n\t\t * [<h1></h1>]\r\n\t\t */\r\n\t\tfunction emptyEditorWhenDeleting() {\r\n\t\t\tfunction serializeRng(rng) {\r\n\t\t\t\tvar body = dom.create(\"body\");\r\n\t\t\t\tvar contents = rng.cloneContents();\r\n\t\t\t\tbody.appendChild(contents);\r\n\t\t\t\treturn selection.serializer.serialize(body, {format: 'html'});\r\n\t\t\t}\r\n\r\n\t\t\tfunction allContentsSelected(rng) {\r\n\t\t\t\tif (!rng.setStart) {\r\n\t\t\t\t\tif (rng.item) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar bodyRng = rng.duplicate();\r\n\t\t\t\t\tbodyRng.moveToElementText(editor.getBody());\r\n\t\t\t\t\treturn RangeUtils.compareRanges(rng, bodyRng);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar selection = serializeRng(rng);\r\n\r\n\t\t\t\tvar allRng = dom.createRng();\r\n\t\t\t\tallRng.selectNode(editor.getBody());\r\n\r\n\t\t\t\tvar allSelection = serializeRng(allRng);\r\n\t\t\t\treturn selection === allSelection;\r\n\t\t\t}\r\n\r\n\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\tvar keyCode = e.keyCode, isCollapsed, body;\r\n\r\n\t\t\t\t// Empty the editor if it's needed for example backspace at <p><b>|</b></p>\r\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\r\n\t\t\t\t\tisCollapsed = editor.selection.isCollapsed();\r\n\t\t\t\t\tbody = editor.getBody();\r\n\r\n\t\t\t\t\t// Selection is collapsed but the editor isn't empty\r\n\t\t\t\t\tif (isCollapsed && !dom.isEmpty(body)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Selection isn't collapsed but not all the contents is selected\r\n\t\t\t\t\tif (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Manually empty the editor\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\teditor.setContent('');\r\n\r\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\r\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * WebKit doesn't select all the nodes in the body when you press Ctrl+A.\r\n\t\t * IE selects more than the contents <body>[<p>a</p>]</body> instead of <body><p>[a]</p]</body> see bug #6438\r\n\t\t * This selects the whole body so that backspace/delete logic will delete everything\r\n\t\t */\r\n\t\tfunction selectAll() {\r\n\t\t\teditor.shortcuts.add('meta+a', null, 'SelectAll');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * WebKit has a weird issue where it some times fails to properly convert keypresses to input method keystrokes.\r\n\t\t * The IME on Mac doesn't initialize when it doesn't fire a proper focus event.\r\n\t\t *\r\n\t\t * This seems to happen when the user manages to click the documentElement element then the window doesn't get proper focus until\r\n\t\t * you enter a character into the editor.\r\n\t\t *\r\n\t\t * It also happens when the first focus in made to the body.\r\n\t\t *\r\n\t\t * See: https://bugs.webkit.org/show_bug.cgi?id=83566\r\n\t\t */\r\n\t\tfunction inputMethodFocus() {\r\n\t\t\tif (!editor.settings.content_editable) {\r\n\t\t\t\t// Case 1 IME doesn't initialize if you focus the document\r\n\t\t\t\t// Disabled since it was interferring with the cE=false logic\r\n\t\t\t\t// Also coultn't reproduce the issue on Safari 9\r\n\t\t\t\t/*dom.bind(editor.getDoc(), 'focusin', function() {\r\n\t\t\t\t\tselection.setRng(selection.getRng());\r\n\t\t\t\t});*/\r\n\r\n\t\t\t\t// Case 2 IME doesn't initialize if you click the documentElement it also doesn't properly fire the focusin event\r\n\t\t\t\t// Needs to be both down/up due to weird rendering bug on Chrome Windows\r\n\t\t\t\tdom.bind(editor.getDoc(), 'mousedown mouseup', function(e) {\r\n\t\t\t\t\tvar rng;\r\n\r\n\t\t\t\t\tif (e.target == editor.getDoc().documentElement) {\r\n\t\t\t\t\t\trng = selection.getRng();\r\n\t\t\t\t\t\teditor.getBody().focus();\r\n\r\n\t\t\t\t\t\tif (e.type == 'mousedown') {\r\n\t\t\t\t\t\t\tif (CaretContainer.isCaretContainer(rng.startContainer)) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Edge case for mousedown, drag select and mousedown again within selection on Chrome Windows to render caret\r\n\t\t\t\t\t\t\tselection.placeCaretAt(e.clientX, e.clientY);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Backspacing in FireFox/IE from a paragraph into a horizontal rule results in a floating text node because the\r\n\t\t * browser just deletes the paragraph - the browser fails to merge the text node with a horizontal rule so it is\r\n\t\t * left there. TinyMCE sees a floating text node and wraps it in a paragraph on the key up event (ForceBlocks.js\r\n\t\t * addRootBlocks), meaning the action does nothing. With this code, FireFox/IE matche the behaviour of other\r\n\t\t * browsers.\r\n\t\t *\r\n\t\t * It also fixes a bug on Firefox where it's impossible to delete HR elements.\r\n\t\t */\r\n\t\tfunction removeHrOnBackspace() {\r\n\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\r\n\t\t\t\t\t// Check if there is any HR elements this is faster since getRng on IE 7 & 8 is slow\r\n\t\t\t\t\tif (!editor.getBody().getElementsByTagName('hr').length) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\r\n\t\t\t\t\t\tvar node = selection.getNode();\r\n\t\t\t\t\t\tvar previousSibling = node.previousSibling;\r\n\r\n\t\t\t\t\t\tif (node.nodeName == 'HR') {\r\n\t\t\t\t\t\t\tdom.remove(node);\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"hr\") {\r\n\t\t\t\t\t\t\tdom.remove(previousSibling);\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Firefox 3.x has an issue where the body element won't get proper focus if you click out\r\n\t\t * side it's rectangle.\r\n\t\t */\r\n\t\tfunction focusBody() {\r\n\t\t\t// Fix for a focus bug in FF 3.x where the body element\r\n\t\t\t// wouldn't get proper focus if the user clicked on the HTML element\r\n\t\t\tif (!window.Range.prototype.getClientRects) { // Detect getClientRects got introduced in FF 4\r\n\t\t\t\teditor.on('mousedown', function(e) {\r\n\t\t\t\t\tif (!isDefaultPrevented(e) && e.target.nodeName === \"HTML\") {\r\n\t\t\t\t\t\tvar body = editor.getBody();\r\n\r\n\t\t\t\t\t\t// Blur the body it's focused but not correctly focused\r\n\t\t\t\t\t\tbody.blur();\r\n\r\n\t\t\t\t\t\t// Refocus the body after a little while\r\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\t\t\tbody.focus();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * WebKit has a bug where it isn't possible to select image, hr or anchor elements\r\n\t\t * by clicking on them so we need to fake that.\r\n\t\t */\r\n\t\tfunction selectControlElements() {\r\n\t\t\teditor.on('click', function(e) {\r\n\t\t\t\tvar target = e.target;\r\n\r\n\t\t\t\t// Workaround for bug, http://bugs.webkit.org/show_bug.cgi?id=12250\r\n\t\t\t\t// WebKit can't even do simple things like selecting an image\r\n\t\t\t\t// Needs to be the setBaseAndExtend or it will fail to select floated images\r\n\t\t\t\tif (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== \"false\") {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tselection.getSel().setBaseAndExtent(target, 0, target, 1);\r\n\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (target.nodeName == 'A' && dom.hasClass(target, 'mce-item-anchor')) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tselection.select(target);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Fixes a Gecko bug where the style attribute gets added to the wrong element when deleting between two block elements.\r\n\t\t *\r\n\t\t * Fixes do backspace/delete on this:\r\n\t\t * <p>bla[ck</p><p style=\"color:red\">r]ed</p>\r\n\t\t *\r\n\t\t * Would become:\r\n\t\t * <p>bla|ed</p>\r\n\t\t *\r\n\t\t * Instead of:\r\n\t\t * <p style=\"color:red\">bla|ed</p>\r\n\t\t */\r\n\t\tfunction removeStylesWhenDeletingAcrossBlockElements() {\r\n\t\t\tfunction getAttributeApplyFunction() {\r\n\t\t\t\tvar template = dom.getAttribs(selection.getStart().cloneNode(false));\r\n\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar target = selection.getStart();\r\n\r\n\t\t\t\t\tif (target !== editor.getBody()) {\r\n\t\t\t\t\t\tdom.setAttrib(target, \"style\", null);\r\n\r\n\t\t\t\t\t\teach(template, function(attr) {\r\n\t\t\t\t\t\t\ttarget.setAttributeNode(attr.cloneNode(true));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction isSelectionAcrossElements() {\r\n\t\t\t\treturn !selection.isCollapsed() &&\r\n\t\t\t\t\tdom.getParent(selection.getStart(), dom.isBlock) != dom.getParent(selection.getEnd(), dom.isBlock);\r\n\t\t\t}\r\n\r\n\t\t\teditor.on('keypress', function(e) {\r\n\t\t\t\tvar applyAttributes;\r\n\r\n\t\t\t\tif (!isDefaultPrevented(e) && (e.keyCode == 8 || e.keyCode == 46) && isSelectionAcrossElements()) {\r\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\r\n\t\t\t\t\teditor.getDoc().execCommand('delete', false, null);\r\n\t\t\t\t\tapplyAttributes();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tdom.bind(editor.getDoc(), 'cut', function(e) {\r\n\t\t\t\tvar applyAttributes;\r\n\r\n\t\t\t\tif (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\r\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\r\n\r\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\t\tapplyAttributes();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Screen readers on IE needs to have the role application set on the body.\r\n\t\t */\r\n\t\tfunction ensureBodyHasRoleApplication() {\r\n\t\t\tdocument.body.setAttribute(\"role\", \"application\");\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Backspacing into a table behaves differently depending upon browser type.\r\n\t\t * Therefore, disable Backspace when cursor immediately follows a table.\r\n\t\t */\r\n\t\tfunction disableBackspaceIntoATable() {\r\n\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\r\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\r\n\t\t\t\t\t\tvar previousSibling = selection.getNode().previousSibling;\r\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"table\") {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Old IE versions can't properly render BR elements in PRE tags white in contentEditable mode. So this\r\n\t\t * logic adds a \\n before the BR so that it will get rendered.\r\n\t\t */\r\n\t\tfunction addNewLinesBeforeBrInPre() {\r\n\t\t\t// IE8+ rendering mode does the right thing with BR in PRE\r\n\t\t\tif (getDocumentMode() > 7) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Enable display: none in area and add a specific class that hides all BR elements in PRE to\r\n\t\t\t// avoid the caret from getting stuck at the BR elements while pressing the right arrow key\r\n\t\t\tsetEditorCommandState('RespectVisibilityInDesign', true);\r\n\t\t\teditor.contentStyles.push('.mceHideBrInPre pre br {display: none}');\r\n\t\t\tdom.addClass(editor.getBody(), 'mceHideBrInPre');\r\n\r\n\t\t\t// Adds a \\n before all BR elements in PRE to get them visual\r\n\t\t\tparser.addNodeFilter('pre', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\r\n\t\t\t\t\tj = brNodes.length;\r\n\t\t\t\t\twhile (j--) {\r\n\t\t\t\t\t\tbrElm = brNodes[j];\r\n\r\n\t\t\t\t\t\t// Add \\n before BR in PRE elements on older IE:s so the new lines get rendered\r\n\t\t\t\t\t\tsibling = brElm.prev;\r\n\t\t\t\t\t\tif (sibling && sibling.type === 3 && sibling.value.charAt(sibling.value - 1) != '\\n') {\r\n\t\t\t\t\t\t\tsibling.value += '\\n';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbrElm.parent.insert(new Node('#text', 3), brElm, true).value = '\\n';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Removes any \\n before BR elements in PRE since other browsers and in contentEditable=false mode they will be visible\r\n\t\t\tserializer.addNodeFilter('pre', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\r\n\t\t\t\t\tj = brNodes.length;\r\n\t\t\t\t\twhile (j--) {\r\n\t\t\t\t\t\tbrElm = brNodes[j];\r\n\t\t\t\t\t\tsibling = brElm.prev;\r\n\t\t\t\t\t\tif (sibling && sibling.type == 3) {\r\n\t\t\t\t\t\t\tsibling.value = sibling.value.replace(/\\r?\\n$/, '');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Moves style width/height to attribute width/height when the user resizes an image on IE.\r\n\t\t */\r\n\t\tfunction removePreSerializedStylesWhenSelectingControls() {\r\n\t\t\tdom.bind(editor.getBody(), 'mouseup', function() {\r\n\t\t\t\tvar value, node = selection.getNode();\r\n\r\n\t\t\t\t// Moved styles to attributes on IMG eements\r\n\t\t\t\tif (node.nodeName == 'IMG') {\r\n\t\t\t\t\t// Convert style width to width attribute\r\n\t\t\t\t\tif ((value = dom.getStyle(node, 'width'))) {\r\n\t\t\t\t\t\tdom.setAttrib(node, 'width', value.replace(/[^0-9%]+/g, ''));\r\n\t\t\t\t\t\tdom.setStyle(node, 'width', '');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Convert style height to height attribute\r\n\t\t\t\t\tif ((value = dom.getStyle(node, 'height'))) {\r\n\t\t\t\t\t\tdom.setAttrib(node, 'height', value.replace(/[^0-9%]+/g, ''));\r\n\t\t\t\t\t\tdom.setStyle(node, 'height', '');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Removes a blockquote when backspace is pressed at the beginning of it.\r\n\t\t *\r\n\t\t * For example:\r\n\t\t * <blockquote><p>|x</p></blockquote>\r\n\t\t *\r\n\t\t * Becomes:\r\n\t\t * <p>|x</p>\r\n\t\t */\r\n\t\tfunction removeBlockQuoteOnBackSpace() {\r\n\t\t\t// Add block quote deletion handler\r\n\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\tvar rng, container, offset, root, parent;\r\n\r\n\t\t\t\tif (isDefaultPrevented(e) || e.keyCode != VK.BACKSPACE) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trng = selection.getRng();\r\n\t\t\t\tcontainer = rng.startContainer;\r\n\t\t\t\toffset = rng.startOffset;\r\n\t\t\t\troot = dom.getRoot();\r\n\t\t\t\tparent = container;\r\n\r\n\t\t\t\tif (!rng.collapsed || offset !== 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (parent && parent.parentNode && parent.parentNode.firstChild == parent && parent.parentNode != root) {\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Is the cursor at the beginning of a blockquote?\r\n\t\t\t\tif (parent.tagName === 'BLOCKQUOTE') {\r\n\t\t\t\t\t// Remove the blockquote\r\n\t\t\t\t\teditor.formatter.toggle('blockquote', null, parent);\r\n\r\n\t\t\t\t\t// Move the caret to the beginning of container\r\n\t\t\t\t\trng = dom.createRng();\r\n\t\t\t\t\trng.setStart(container, 0);\r\n\t\t\t\t\trng.setEnd(container, 0);\r\n\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Sets various Gecko editing options on mouse down and before a execCommand to disable inline table editing that is broken etc.\r\n\t\t */\r\n\t\tfunction setGeckoEditingOptions() {\r\n\t\t\tfunction setOpts() {\r\n\t\t\t\trefreshContentEditable();\r\n\r\n\t\t\t\tsetEditorCommandState(\"StyleWithCSS\", false);\r\n\t\t\t\tsetEditorCommandState(\"enableInlineTableEditing\", false);\r\n\r\n\t\t\t\tif (!settings.object_resizing) {\r\n\t\t\t\t\tsetEditorCommandState(\"enableObjectResizing\", false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!settings.readonly) {\r\n\t\t\t\teditor.on('BeforeExecCommand MouseDown', setOpts);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Fixes a gecko link bug, when a link is placed at the end of block elements there is\r\n\t\t * no way to move the caret behind the link. This fix adds a bogus br element after the link.\r\n\t\t *\r\n\t\t * For example this:\r\n\t\t * <p><b><a href=\"#\">x</a></b></p>\r\n\t\t *\r\n\t\t * Becomes this:\r\n\t\t * <p><b><a href=\"#\">x</a></b><br></p>\r\n\t\t */\r\n\t\tfunction addBrAfterLastLinks() {\r\n\t\t\tfunction fixLinks() {\r\n\t\t\t\teach(dom.select('a'), function(node) {\r\n\t\t\t\t\tvar parentNode = node.parentNode, root = dom.getRoot();\r\n\r\n\t\t\t\t\tif (parentNode.lastChild === node) {\r\n\t\t\t\t\t\twhile (parentNode && !dom.isBlock(parentNode)) {\r\n\t\t\t\t\t\t\tif (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tparentNode = parentNode.parentNode;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdom.add(parentNode, 'br', {'data-mce-bogus': 1});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\teditor.on('SetContent ExecCommand', function(e) {\r\n\t\t\t\tif (e.type == \"setcontent\" || e.command === 'mceInsertLink') {\r\n\t\t\t\t\tfixLinks();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * WebKit will produce DIV elements here and there by default. But since TinyMCE uses paragraphs by\r\n\t\t * default we want to change that behavior.\r\n\t\t */\r\n\t\tfunction setDefaultBlockType() {\r\n\t\t\tif (settings.forced_root_block) {\r\n\t\t\t\teditor.on('init', function() {\r\n\t\t\t\t\tsetEditorCommandState('DefaultParagraphSeparator', settings.forced_root_block);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Deletes the selected image on IE instead of navigating to previous page.\r\n\t\t */\r\n\t\tfunction deleteControlItemOnBackSpace() {\r\n\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\tvar rng;\r\n\r\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode == BACKSPACE) {\r\n\t\t\t\t\trng = editor.getDoc().selection.createRange();\r\n\t\t\t\t\tif (rng && rng.item) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\teditor.undoManager.beforeChange();\r\n\t\t\t\t\t\tdom.remove(rng.item(0));\r\n\t\t\t\t\t\teditor.undoManager.add();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * IE10 doesn't properly render block elements with the right height until you add contents to them.\r\n\t\t * This fixes that by adding a padding-right to all empty text block elements.\r\n\t\t * See: https://connect.microsoft.com/IE/feedback/details/743881\r\n\t\t */\r\n\t\tfunction renderEmptyBlocksFix() {\r\n\t\t\tvar emptyBlocksCSS;\r\n\r\n\t\t\t// IE10+\r\n\t\t\tif (getDocumentMode() >= 10) {\r\n\t\t\t\temptyBlocksCSS = '';\r\n\t\t\t\teach('p div h1 h2 h3 h4 h5 h6'.split(' '), function(name, i) {\r\n\t\t\t\t\temptyBlocksCSS += (i > 0 ? ',' : '') + name + ':empty';\r\n\t\t\t\t});\r\n\r\n\t\t\t\teditor.contentStyles.push(emptyBlocksCSS + '{padding-right: 1px !important}');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Old IE versions can't retain contents within noscript elements so this logic will store the contents\r\n\t\t * as a attribute and the insert that value as it's raw text when the DOM is serialized.\r\n\t\t */\r\n\t\tfunction keepNoScriptContents() {\r\n\t\t\tif (getDocumentMode() < 9) {\r\n\t\t\t\tparser.addNodeFilter('noscript', function(nodes) {\r\n\t\t\t\t\tvar i = nodes.length, node, textNode;\r\n\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\t\ttextNode = node.firstChild;\r\n\r\n\t\t\t\t\t\tif (textNode) {\r\n\t\t\t\t\t\t\tnode.attr('data-mce-innertext', textNode.value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tserializer.addNodeFilter('noscript', function(nodes) {\r\n\t\t\t\t\tvar i = nodes.length, node, textNode, value;\r\n\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\t\ttextNode = nodes[i].firstChild;\r\n\r\n\t\t\t\t\t\tif (textNode) {\r\n\t\t\t\t\t\t\ttextNode.value = Entities.decode(textNode.value);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Old IE can't retain noscript value so an attribute is used to store it\r\n\t\t\t\t\t\t\tvalue = node.attributes.map['data-mce-innertext'];\r\n\t\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\t\tnode.attr('data-mce-innertext', null);\r\n\t\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\r\n\t\t\t\t\t\t\t\ttextNode.value = value;\r\n\t\t\t\t\t\t\t\ttextNode.raw = true;\r\n\t\t\t\t\t\t\t\tnode.append(textNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * IE has an issue where you can't select/move the caret by clicking outside the body if the document is in standards mode.\r\n\t\t */\r\n\t\tfunction fixCaretSelectionOfDocumentElementOnIe() {\r\n\t\t\tvar doc = dom.doc, body = doc.body, started, startRng, htmlElm;\r\n\r\n\t\t\t// Return range from point or null if it failed\r\n\t\t\tfunction rngFromPoint(x, y) {\r\n\t\t\t\tvar rng = body.createTextRange();\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\trng.moveToPoint(x, y);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// IE sometimes throws and exception, so lets just ignore it\r\n\t\t\t\t\trng = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\r\n\t\t\t// Fires while the selection is changing\r\n\t\t\tfunction selectionChange(e) {\r\n\t\t\t\tvar pointRng;\r\n\r\n\t\t\t\t// Check if the button is down or not\r\n\t\t\t\tif (e.button) {\r\n\t\t\t\t\t// Create range from mouse position\r\n\t\t\t\t\tpointRng = rngFromPoint(e.x, e.y);\r\n\r\n\t\t\t\t\tif (pointRng) {\r\n\t\t\t\t\t\t// Check if pointRange is before/after selection then change the endPoint\r\n\t\t\t\t\t\tif (pointRng.compareEndPoints('StartToStart', startRng) > 0) {\r\n\t\t\t\t\t\t\tpointRng.setEndPoint('StartToStart', startRng);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpointRng.setEndPoint('EndToEnd', startRng);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tpointRng.select();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tendSelection();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Removes listeners\r\n\t\t\tfunction endSelection() {\r\n\t\t\t\tvar rng = doc.selection.createRange();\r\n\r\n\t\t\t\t// If the range is collapsed then use the last start range\r\n\t\t\t\tif (startRng && !rng.item && rng.compareEndPoints('StartToEnd', rng) === 0) {\r\n\t\t\t\t\tstartRng.select();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdom.unbind(doc, 'mouseup', endSelection);\r\n\t\t\t\tdom.unbind(doc, 'mousemove', selectionChange);\r\n\t\t\t\tstartRng = started = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// Make HTML element unselectable since we are going to handle selection by hand\r\n\t\t\tdoc.documentElement.unselectable = true;\r\n\r\n\t\t\t// Detect when user selects outside BODY\r\n\t\t\tdom.bind(doc, 'mousedown contextmenu', function(e) {\r\n\t\t\t\tif (e.target.nodeName === 'HTML') {\r\n\t\t\t\t\tif (started) {\r\n\t\t\t\t\t\tendSelection();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Detect vertical scrollbar, since IE will fire a mousedown on the scrollbar and have target set as HTML\r\n\t\t\t\t\thtmlElm = doc.documentElement;\r\n\t\t\t\t\tif (htmlElm.scrollHeight > htmlElm.clientHeight) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstarted = 1;\r\n\t\t\t\t\t// Setup start position\r\n\t\t\t\t\tstartRng = rngFromPoint(e.x, e.y);\r\n\t\t\t\t\tif (startRng) {\r\n\t\t\t\t\t\t// Listen for selection change events\r\n\t\t\t\t\t\tdom.bind(doc, 'mouseup', endSelection);\r\n\t\t\t\t\t\tdom.bind(doc, 'mousemove', selectionChange);\r\n\r\n\t\t\t\t\t\tdom.getRoot().focus();\r\n\t\t\t\t\t\tstartRng.select();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Fixes selection issues where the caret can be placed between two inline elements like <b>a</b>|<b>b</b>\r\n\t\t * this fix will lean the caret right into the closest inline element.\r\n\t\t */\r\n\t\tfunction normalizeSelection() {\r\n\t\t\t// Normalize selection for example <b>a</b><i>|a</i> becomes <b>a|</b><i>a</i> except for Ctrl+A since it selects everything\r\n\t\t\teditor.on('keyup focusin mouseup', function(e) {\r\n\t\t\t\tif (e.keyCode != 65 || !VK.metaKeyPressed(e)) {\r\n\t\t\t\t\tselection.normalize();\r\n\t\t\t\t}\r\n\t\t\t}, true);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Forces Gecko to render a broken image icon if it fails to load an image.\r\n\t\t */\r\n\t\tfunction showBrokenImageIcon() {\r\n\t\t\teditor.contentStyles.push(\r\n\t\t\t\t'img:-moz-broken {' +\r\n\t\t\t\t\t'-moz-force-broken-image-icon:1;' +\r\n\t\t\t\t\t'min-width:24px;' +\r\n\t\t\t\t\t'min-height:24px' +\r\n\t\t\t\t'}'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * iOS has a bug where it's impossible to type if the document has a touchstart event\r\n\t\t * bound and the user touches the document while having the on screen keyboard visible.\r\n\t\t *\r\n\t\t * The touch event moves the focus to the parent document while having the caret inside the iframe\r\n\t\t * this fix moves the focus back into the iframe document.\r\n\t\t */\r\n\t\tfunction restoreFocusOnKeyDown() {\r\n\t\t\tif (!editor.inline) {\r\n\t\t\t\teditor.on('keydown', function() {\r\n\t\t\t\t\tif (document.activeElement == document.body) {\r\n\t\t\t\t\t\teditor.getWin().focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * IE 11 has an annoying issue where you can't move focus into the editor\r\n\t\t * by clicking on the white area HTML element. We used to be able to to fix this with\r\n\t\t * the fixCaretSelectionOfDocumentElementOnIe fix. But since M$ removed the selection\r\n\t\t * object it's not possible anymore. So we need to hack in a ungly CSS to force the\r\n\t\t * body to be at least 150px. If the user clicks the HTML element out side this 150px region\r\n\t\t * we simply move the focus into the first paragraph. Not ideal since you loose the\r\n\t\t * positioning of the caret but goot enough for most cases.\r\n\t\t */\r\n\t\tfunction bodyHeight() {\r\n\t\t\tif (!editor.inline) {\r\n\t\t\t\teditor.contentStyles.push('body {min-height: 150px}');\r\n\t\t\t\teditor.on('click', function(e) {\r\n\t\t\t\t\tvar rng;\r\n\r\n\t\t\t\t\tif (e.target.nodeName == 'HTML') {\r\n\t\t\t\t\t\t// Edge seems to only need focus if we set the range\r\n\t\t\t\t\t\t// the caret will become invisible and moved out of the iframe!!\r\n\t\t\t\t\t\tif (Env.ie > 11) {\r\n\t\t\t\t\t\t\teditor.getBody().focus();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Need to store away non collapsed ranges since the focus call will mess that up see #7382\r\n\t\t\t\t\t\trng = editor.selection.getRng();\r\n\t\t\t\t\t\teditor.getBody().focus();\r\n\t\t\t\t\t\teditor.selection.setRng(rng);\r\n\t\t\t\t\t\teditor.selection.normalize();\r\n\t\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Firefox on Mac OS will move the browser back to the previous page if you press CMD+Left arrow.\r\n\t\t * You might then loose all your work so we need to block that behavior and replace it with our own.\r\n\t\t */\r\n\t\tfunction blockCmdArrowNavigation() {\r\n\t\t\tif (Env.mac) {\r\n\t\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\t\tif (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode == 37 || e.keyCode == 39)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\teditor.selection.getSel().modify('move', e.keyCode == 37 ? 'backward' : 'forward', 'lineboundary');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Disables the autolinking in IE 9+ this is then re-enabled by the autolink plugin.\r\n\t\t */\r\n\t\tfunction disableAutoUrlDetect() {\r\n\t\t\tsetEditorCommandState(\"AutoUrlDetect\", false);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * iOS 7.1 introduced two new bugs:\r\n\t\t * 1) It's possible to open links within a contentEditable area by clicking on them.\r\n\t\t * 2) If you hold down the finger it will display the link/image touch callout menu.\r\n\t\t */\r\n\t\tfunction tapLinksAndImages() {\r\n\t\t\teditor.on('click', function(e) {\r\n\t\t\t\tvar elm = e.target;\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (elm.tagName === 'A') {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} while ((elm = elm.parentNode));\r\n\t\t\t});\r\n\r\n\t\t\teditor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * iOS Safari and possible other browsers have a bug where it won't fire\r\n\t\t * a click event when a contentEditable is focused. This function fakes click events\r\n\t\t * by using touchstart/touchend and measuring the time and distance travelled.\r\n\t\t */\r\n\t\t/*\r\n\t\tfunction touchClickEvent() {\r\n\t\t\teditor.on('touchstart', function(e) {\r\n\t\t\t\tvar elm, time, startTouch, changedTouches;\r\n\r\n\t\t\t\telm = e.target;\r\n\t\t\t\ttime = new Date().getTime();\r\n\t\t\t\tchangedTouches = e.changedTouches;\r\n\r\n\t\t\t\tif (!changedTouches || changedTouches.length > 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstartTouch = changedTouches[0];\r\n\r\n\t\t\t\teditor.once('touchend', function(e) {\r\n\t\t\t\t\tvar endTouch = e.changedTouches[0], args;\r\n\r\n\t\t\t\t\tif (new Date().getTime() - time > 500) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (Math.abs(startTouch.clientX - endTouch.clientX) > 5) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (Math.abs(startTouch.clientY - endTouch.clientY) > 5) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\targs = {\r\n\t\t\t\t\t\ttarget: elm\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\teach('pageX pageY clientX clientY screenX screenY'.split(' '), function(key) {\r\n\t\t\t\t\t\targs[key] = endTouch[key];\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\targs = editor.fire('click', args);\r\n\r\n\t\t\t\t\tif (!args.isDefaultPrevented()) {\r\n\t\t\t\t\t\t// iOS WebKit can't place the caret properly once\r\n\t\t\t\t\t\t// you bind touch events so we need to do this manually\r\n\t\t\t\t\t\t// TODO: Expand to the closest word? Touble tap still works.\r\n\t\t\t\t\t\teditor.selection.placeCaretAt(endTouch.clientX, endTouch.clientY);\r\n\t\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t/**\r\n\t\t * WebKit has a bug where it will allow forms to be submitted if they are inside a contentEditable element.\r\n\t\t * For example this: <form><button></form>\r\n\t\t */\r\n\t\tfunction blockFormSubmitInsideEditor() {\r\n\t\t\teditor.on('init', function() {\r\n\t\t\t\teditor.dom.bind(editor.getBody(), 'submit', function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Sometimes WebKit/Blink generates BR elements with the Apple-interchange-newline class.\r\n\t\t *\r\n\t\t * Scenario:\r\n\t\t *  1) Create a table 2x2.\r\n\t\t *  2) Select and copy cells A2-B2.\r\n\t\t *  3) Paste and it will add BR element to table cell.\r\n\t\t */\r\n\t\tfunction removeAppleInterchangeBrs() {\r\n\t\t\tparser.addNodeFilter('br', function(nodes) {\r\n\t\t\t\tvar i = nodes.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tif (nodes[i].attr('class') == 'Apple-interchange-newline') {\r\n\t\t\t\t\t\tnodes[i].remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * IE cannot set custom contentType's on drag events, and also does not properly drag/drop between\r\n\t\t * editors. This uses a special data:text/mce-internal URL to pass data when drag/drop between editors.\r\n\t\t */\r\n\t\tfunction ieInternalDragAndDrop() {\r\n\t\t\teditor.on('dragstart', function(e) {\r\n\t\t\t\tsetMceInternalContent(e);\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('drop', function(e) {\r\n\t\t\t\tif (!isDefaultPrevented(e)) {\r\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\r\n\r\n\t\t\t\t\tif (internalContent && internalContent.id != editor.id) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tvar rng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, editor.getDoc());\r\n\t\t\t\t\t\tselection.setRng(rng);\r\n\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction refreshContentEditable() {\r\n\t\t\tvar body, parent;\r\n\r\n\t\t\t// Check if the editor was hidden and the re-initialize contentEditable mode by removing and adding the body again\r\n\t\t\tif (isHidden()) {\r\n\t\t\t\tbody = editor.getBody();\r\n\t\t\t\tparent = body.parentNode;\r\n\r\n\t\t\t\tparent.removeChild(body);\r\n\t\t\t\tparent.appendChild(body);\r\n\r\n\t\t\t\tbody.focus();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction isHidden() {\r\n\t\t\tvar sel;\r\n\r\n\t\t\tif (!isGecko) {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\t// Weird, wheres that cursor selection?\r\n\t\t\tsel = editor.selection.getSel();\r\n\t\t\treturn (!sel || !sel.rangeCount || sel.rangeCount === 0);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Properly empties the editor if all contents is selected and deleted this to\r\n\t\t * prevent empty paragraphs from being produced at beginning/end of contents.\r\n\t\t */\r\n\t\tfunction emptyEditorOnDeleteEverything() {\r\n\t\t\tfunction isEverythingSelected(editor) {\r\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\r\n\t\t\t\tvar rng = editor.selection.getRng();\r\n\t\t\t\tvar startCaretPos = CaretPosition.fromRangeStart(rng);\r\n\t\t\t\tvar endCaretPos = CaretPosition.fromRangeEnd(rng);\r\n\r\n\t\t\t\treturn !editor.selection.isCollapsed() && !caretWalker.prev(startCaretPos) && !caretWalker.next(endCaretPos);\r\n\t\t\t}\r\n\r\n\t\t\t// Type over case delete and insert this won't cover typeover with a IME but at least it covers the common case\r\n\t\t\teditor.on('keypress', function (e) {\r\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\r\n\t\t\t\t\tif (isEverythingSelected(editor)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\teditor.setContent(String.fromCharCode(e.charCode));\r\n\t\t\t\t\t\teditor.selection.select(editor.getBody(), true);\r\n\t\t\t\t\t\teditor.selection.collapse(false);\r\n\t\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('keydown', function (e) {\r\n\t\t\t\tvar keyCode = e.keyCode;\r\n\r\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\r\n\t\t\t\t\tif (isEverythingSelected(editor)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\teditor.setContent('');\r\n\t\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// All browsers\r\n\t\tremoveBlockQuoteOnBackSpace();\r\n\t\temptyEditorWhenDeleting();\r\n\r\n\t\t// Windows phone will return a range like [body, 0] on mousedown so\r\n\t\t// it will always normalize to the wrong location\r\n\t\tif (!Env.windowsPhone) {\r\n\t\t\tnormalizeSelection();\r\n\t\t}\r\n\r\n\t\t// WebKit\r\n\t\tif (isWebKit) {\r\n\t\t\temptyEditorOnDeleteEverything();\r\n\t\t\tcleanupStylesWhenDeleting();\r\n\t\t\tinputMethodFocus();\r\n\t\t\tselectControlElements();\r\n\t\t\tsetDefaultBlockType();\r\n\t\t\tblockFormSubmitInsideEditor();\r\n\t\t\tdisableBackspaceIntoATable();\r\n\t\t\tremoveAppleInterchangeBrs();\r\n\r\n\t\t\t//touchClickEvent();\r\n\r\n\t\t\t// iOS\r\n\t\t\tif (Env.iOS) {\r\n\t\t\t\trestoreFocusOnKeyDown();\r\n\t\t\t\tbodyHeight();\r\n\t\t\t\ttapLinksAndImages();\r\n\t\t\t} else {\r\n\t\t\t\tselectAll();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// IE\r\n\t\tif (isIE && Env.ie < 11) {\r\n\t\t\tremoveHrOnBackspace();\r\n\t\t\tensureBodyHasRoleApplication();\r\n\t\t\taddNewLinesBeforeBrInPre();\r\n\t\t\tremovePreSerializedStylesWhenSelectingControls();\r\n\t\t\tdeleteControlItemOnBackSpace();\r\n\t\t\trenderEmptyBlocksFix();\r\n\t\t\tkeepNoScriptContents();\r\n\t\t\tfixCaretSelectionOfDocumentElementOnIe();\r\n\t\t}\r\n\r\n\t\tif (Env.ie >= 11) {\r\n\t\t\tbodyHeight();\r\n\t\t\tdisableBackspaceIntoATable();\r\n\t\t}\r\n\r\n\t\tif (Env.ie) {\r\n\t\t\tselectAll();\r\n\t\t\tdisableAutoUrlDetect();\r\n\t\t\tieInternalDragAndDrop();\r\n\t\t}\r\n\r\n\t\t// Gecko\r\n\t\tif (isGecko) {\r\n\t\t\temptyEditorOnDeleteEverything();\r\n\t\t\tremoveHrOnBackspace();\r\n\t\t\tfocusBody();\r\n\t\t\tremoveStylesWhenDeletingAcrossBlockElements();\r\n\t\t\tsetGeckoEditingOptions();\r\n\t\t\taddBrAfterLastLinks();\r\n\t\t\tshowBrokenImageIcon();\r\n\t\t\tblockCmdArrowNavigation();\r\n\t\t\tdisableBackspaceIntoATable();\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\trefreshContentEditable: refreshContentEditable,\r\n\t\t\tisHidden: isHidden\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/EditorObservable.js\r\n\r\n/**\r\n * EditorObservable.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This mixin contains the event logic for the tinymce.Editor class.\r\n *\r\n * @mixin tinymce.EditorObservable\r\n * @extends tinymce.util.Observable\r\n */\r\ndefine(\"tinymce/EditorObservable\", [\r\n\t\"tinymce/util/Observable\",\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Observable, DOMUtils, Tools) {\r\n\tvar DOM = DOMUtils.DOM, customEventRootDelegates;\r\n\r\n\t/**\r\n\t * Returns the event target so for the specified event. Some events fire\r\n\t * only on document, some fire on documentElement etc. This also handles the\r\n\t * custom event root setting where it returns that element instead of the body.\r\n\t *\r\n\t * @private\r\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\r\n\t * @param {String} eventName Name of the event for example \"click\".\r\n\t * @return {Element/Document} HTML Element or document target to bind on.\r\n\t */\r\n\tfunction getEventTarget(editor, eventName) {\r\n\t\tif (eventName == 'selectionchange') {\r\n\t\t\treturn editor.getDoc();\r\n\t\t}\r\n\r\n\t\t// Need to bind mousedown/mouseup etc to document not body in iframe mode\r\n\t\t// Since the user might click on the HTML element not the BODY\r\n\t\tif (!editor.inline && /^mouse|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\r\n\t\t\treturn editor.getDoc().documentElement;\r\n\t\t}\r\n\r\n\t\t// Bind to event root instead of body if it's defined\r\n\t\tif (editor.settings.event_root) {\r\n\t\t\tif (!editor.eventRoot) {\r\n\t\t\t\teditor.eventRoot = DOM.select(editor.settings.event_root)[0];\r\n\t\t\t}\r\n\r\n\t\t\treturn editor.eventRoot;\r\n\t\t}\r\n\r\n\t\treturn editor.getBody();\r\n\t}\r\n\r\n\t/**\r\n\t * Binds a event delegate for the specified name this delegate will fire\r\n\t * the event to the editor dispatcher.\r\n\t *\r\n\t * @private\r\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\r\n\t * @param {String} eventName Name of the event for example \"click\".\r\n\t */\r\n\tfunction bindEventDelegate(editor, eventName) {\r\n\t\tvar eventRootElm = getEventTarget(editor, eventName), delegate;\r\n\r\n\t\tfunction isListening(editor) {\r\n\t\t\treturn !editor.hidden && !editor.readonly;\r\n\t\t}\r\n\r\n\t\tif (!editor.delegates) {\r\n\t\t\teditor.delegates = {};\r\n\t\t}\r\n\r\n\t\tif (editor.delegates[eventName]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (editor.settings.event_root) {\r\n\t\t\tif (!customEventRootDelegates) {\r\n\t\t\t\tcustomEventRootDelegates = {};\r\n\t\t\t\teditor.editorManager.on('removeEditor', function() {\r\n\t\t\t\t\tvar name;\r\n\r\n\t\t\t\t\tif (!editor.editorManager.activeEditor) {\r\n\t\t\t\t\t\tif (customEventRootDelegates) {\r\n\t\t\t\t\t\t\tfor (name in customEventRootDelegates) {\r\n\t\t\t\t\t\t\t\teditor.dom.unbind(getEventTarget(editor, name));\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcustomEventRootDelegates = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (customEventRootDelegates[eventName]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdelegate = function(e) {\r\n\t\t\t\tvar target = e.target, editors = editor.editorManager.editors, i = editors.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tvar body = editors[i].getBody();\r\n\r\n\t\t\t\t\tif (body === target || DOM.isChildOf(target, body)) {\r\n\t\t\t\t\t\tif (isListening(editors[i])) {\r\n\t\t\t\t\t\t\teditors[i].fire(eventName, e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tcustomEventRootDelegates[eventName] = delegate;\r\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\r\n\t\t} else {\r\n\t\t\tdelegate = function(e) {\r\n\t\t\t\tif (isListening(editor)) {\r\n\t\t\t\t\teditor.fire(eventName, e);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\r\n\t\t\teditor.delegates[eventName] = delegate;\r\n\t\t}\r\n\t}\r\n\r\n\tvar EditorObservable = {\r\n\t\t/**\r\n\t\t * Bind any pending event delegates. This gets executed after the target body/document is created.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tbindPendingEventDelegates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tTools.each(self._pendingNativeEvents, function(name) {\r\n\t\t\t\tbindEventDelegate(self, name);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Toggles a native event on/off this is called by the EventDispatcher when\r\n\t\t * the first native event handler is added and when the last native event handler is removed.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\ttoggleNativeEvent: function(name, state) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// Never bind focus/blur since the FocusManager fakes those\r\n\t\t\tif (name == \"focus\" || name == \"blur\") {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (state) {\r\n\t\t\t\tif (self.initialized) {\r\n\t\t\t\t\tbindEventDelegate(self, name);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!self._pendingNativeEvents) {\r\n\t\t\t\t\t\tself._pendingNativeEvents = [name];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself._pendingNativeEvents.push(name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (self.initialized) {\r\n\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\r\n\t\t\t\tdelete self.delegates[name];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unbinds all native event handlers that means delegates, custom events bound using the Events API etc.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tunbindAllNativeEvents: function() {\r\n\t\t\tvar self = this, name;\r\n\r\n\t\t\tif (self.delegates) {\r\n\t\t\t\tfor (name in self.delegates) {\r\n\t\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete self.delegates;\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.inline) {\r\n\t\t\t\tself.getBody().onload = null;\r\n\t\t\t\tself.dom.unbind(self.getWin());\r\n\t\t\t\tself.dom.unbind(self.getDoc());\r\n\t\t\t}\r\n\r\n\t\t\tself.dom.unbind(self.getBody());\r\n\t\t\tself.dom.unbind(self.getContainer());\r\n\t\t}\r\n\t};\r\n\r\n\tEditorObservable = Tools.extend({}, Observable, EditorObservable);\r\n\r\n\treturn EditorObservable;\r\n});\r\n\r\n// Included from: js/tinymce/classes/Mode.js\r\n\r\n/**\r\n * Mode.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Mode switcher logic.\r\n *\r\n * @private\r\n * @class tinymce.Mode\r\n */\r\ndefine(\"tinymce/Mode\", [], function() {\r\n\tfunction setEditorCommandState(editor, cmd, state) {\r\n\t\ttry {\r\n\t\t\teditor.getDoc().execCommand(cmd, false, state);\r\n\t\t} catch (ex) {\r\n\t\t\t// Ignore\r\n\t\t}\r\n\t}\r\n\r\n\tfunction clickBlocker(editor) {\r\n\t\tvar target, handler;\r\n\r\n\t\ttarget = editor.getBody();\r\n\r\n\t\thandler = function(e) {\r\n\t\t\tif (editor.dom.getParents(e.target, 'a').length > 0) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\teditor.dom.bind(target, 'click', handler);\r\n\r\n\t\treturn {\r\n\t\t\tunbind: function() {\r\n\t\t\t\teditor.dom.unbind(target, 'click', handler);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tfunction toggleReadOnly(editor, state) {\r\n\t\tif (editor._clickBlocker) {\r\n\t\t\teditor._clickBlocker.unbind();\r\n\t\t\teditor._clickBlocker = null;\r\n\t\t}\r\n\r\n\t\tif (state) {\r\n\t\t\teditor._clickBlocker = clickBlocker(editor);\r\n\t\t\teditor.selection.controlSelection.hideResizeRect();\r\n\t\t\teditor.readonly = true;\r\n\t\t\teditor.getBody().contentEditable = false;\r\n\t\t} else {\r\n\t\t\teditor.readonly = false;\r\n\t\t\teditor.getBody().contentEditable = true;\r\n\t\t\tsetEditorCommandState(editor, \"StyleWithCSS\", false);\r\n\t\t\tsetEditorCommandState(editor, \"enableInlineTableEditing\", false);\r\n\t\t\tsetEditorCommandState(editor, \"enableObjectResizing\", false);\r\n\t\t\teditor.focus();\r\n\t\t\teditor.nodeChanged();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setMode(editor, mode) {\r\n\t\tvar currentMode = editor.readonly ? 'readonly' : 'design';\r\n\r\n\t\tif (mode == currentMode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (editor.initialized) {\r\n\t\t\ttoggleReadOnly(editor, mode == 'readonly');\r\n\t\t} else {\r\n\t\t\teditor.on('init', function() {\r\n\t\t\t\ttoggleReadOnly(editor, mode == 'readonly');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Event is NOT preventable\r\n\t\teditor.fire('SwitchMode', {mode: mode});\r\n\t}\r\n\r\n\treturn {\r\n\t\tsetMode: setMode\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/Shortcuts.js\r\n\r\n/**\r\n * Shortcuts.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Contains all logic for handling of keyboard shortcuts.\r\n *\r\n * @class tinymce.Shortcuts\r\n * @example\r\n * editor.shortcuts.add('ctrl+a', function() {});\r\n * editor.shortcuts.add('meta+a', function() {}); // \"meta\" maps to Command on Mac and Ctrl on PC\r\n * editor.shortcuts.add('ctrl+alt+a', function() {});\r\n * editor.shortcuts.add('access+a', function() {}); // \"access\" maps to ctrl+alt on Mac and shift+alt on PC\r\n */\r\ndefine(\"tinymce/Shortcuts\", [\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/Env\"\r\n], function(Tools, Env) {\r\n\tvar each = Tools.each, explode = Tools.explode;\r\n\r\n\tvar keyCodeLookup = {\r\n\t\t\"f9\": 120,\r\n\t\t\"f10\": 121,\r\n\t\t\"f11\": 122\r\n\t};\r\n\r\n\tvar modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\r\n\r\n\treturn function(editor) {\r\n\t\tvar self = this, shortcuts = {}, pendingPatterns = [];\r\n\r\n\t\tfunction parseShortcut(pattern) {\r\n\t\t\tvar id, key, shortcut = {};\r\n\r\n\t\t\t// Parse modifiers and keys ctrl+alt+b for example\r\n\t\t\teach(explode(pattern, '+'), function(value) {\r\n\t\t\t\tif (value in modifierNames) {\r\n\t\t\t\t\tshortcut[value] = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Allow numeric keycodes like ctrl+219 for ctrl+[\r\n\t\t\t\t\tif (/^[0-9]{2,}$/.test(value)) {\r\n\t\t\t\t\t\tshortcut.keyCode = parseInt(value, 10);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tshortcut.charCode = value.charCodeAt(0);\r\n\t\t\t\t\t\tshortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Generate unique id for modifier combination and set default state for unused modifiers\r\n\t\t\tid = [shortcut.keyCode];\r\n\t\t\tfor (key in modifierNames) {\r\n\t\t\t\tif (shortcut[key]) {\r\n\t\t\t\t\tid.push(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshortcut[key] = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tshortcut.id = id.join(',');\r\n\r\n\t\t\t// Handle special access modifier differently depending on Mac/Win\r\n\t\t\tif (shortcut.access) {\r\n\t\t\t\tshortcut.alt = true;\r\n\r\n\t\t\t\tif (Env.mac) {\r\n\t\t\t\t\tshortcut.ctrl = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshortcut.shift = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Handle special meta modifier differently depending on Mac/Win\r\n\t\t\tif (shortcut.meta) {\r\n\t\t\t\tif (Env.mac) {\r\n\t\t\t\t\tshortcut.meta = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshortcut.ctrl = true;\r\n\t\t\t\t\tshortcut.meta = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn shortcut;\r\n\t\t}\r\n\r\n\t\tfunction createShortcut(pattern, desc, cmdFunc, scope) {\r\n\t\t\tvar shortcuts;\r\n\r\n\t\t\tshortcuts = Tools.map(explode(pattern, '>'), parseShortcut);\r\n\t\t\tshortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\r\n\t\t\t\tfunc: cmdFunc,\r\n\t\t\t\tscope: scope || editor\r\n\t\t\t});\r\n\r\n\t\t\treturn Tools.extend(shortcuts[0], {\r\n\t\t\t\tdesc: editor.translate(desc),\r\n\t\t\t\tsubpatterns: shortcuts.slice(1)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction hasModifier(e) {\r\n\t\t\treturn e.altKey || e.ctrlKey || e.metaKey;\r\n\t\t}\r\n\r\n\t\tfunction isFunctionKey(e) {\r\n\t\t\treturn e.keyCode >= 112 && e.keyCode <= 123;\r\n\t\t}\r\n\r\n\t\tfunction matchShortcut(e, shortcut) {\r\n\t\t\tif (!shortcut) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (shortcut.ctrl != e.ctrlKey || shortcut.meta != e.metaKey) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (shortcut.alt != e.altKey || shortcut.shift != e.shiftKey) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (e.keyCode == shortcut.keyCode || (e.charCode && e.charCode == shortcut.charCode)) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction executeShortcutAction(shortcut) {\r\n\t\t\treturn shortcut.func ? shortcut.func.call(shortcut.scope) : null;\r\n\t\t}\r\n\r\n\t\teditor.on('keyup keypress keydown', function(e) {\r\n\t\t\tif ((hasModifier(e) || isFunctionKey(e)) && !e.isDefaultPrevented()) {\r\n\t\t\t\teach(shortcuts, function(shortcut) {\r\n\t\t\t\t\tif (matchShortcut(e, shortcut)) {\r\n\t\t\t\t\t\tpendingPatterns = shortcut.subpatterns.slice(0);\r\n\r\n\t\t\t\t\t\tif (e.type == \"keydown\") {\r\n\t\t\t\t\t\t\texecuteShortcutAction(shortcut);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (matchShortcut(e, pendingPatterns[0])) {\r\n\t\t\t\t\tif (pendingPatterns.length === 1) {\r\n\t\t\t\t\t\tif (e.type == \"keydown\") {\r\n\t\t\t\t\t\t\texecuteShortcutAction(pendingPatterns[0]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpendingPatterns.shift();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * Adds a keyboard shortcut for some command or function.\r\n\t\t *\r\n\t\t * @method addShortcut\r\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\r\n\t\t * @param {String} desc Text description for the command.\r\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\r\n\t\t * @param {Object} scope Optional scope to execute the function in.\r\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\r\n\t\t */\r\n\t\tself.add = function(pattern, desc, cmdFunc, scope) {\r\n\t\t\tvar cmd;\r\n\r\n\t\t\tcmd = cmdFunc;\r\n\r\n\t\t\tif (typeof cmdFunc === 'string') {\r\n\t\t\t\tcmdFunc = function() {\r\n\t\t\t\t\teditor.execCommand(cmd, false, null);\r\n\t\t\t\t};\r\n\t\t\t} else if (Tools.isArray(cmd)) {\r\n\t\t\t\tcmdFunc = function() {\r\n\t\t\t\t\teditor.execCommand(cmd[0], cmd[1], cmd[2]);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\teach(explode(Tools.trim(pattern.toLowerCase())), function(pattern) {\r\n\t\t\t\tvar shortcut = createShortcut(pattern, desc, cmdFunc, scope);\r\n\t\t\t\tshortcuts[shortcut.id] = shortcut;\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Remove a keyboard shortcut by pattern.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\r\n\t\t * @return {Boolean} true/false state if the shortcut was removed or not.\r\n\t\t */\r\n\t\tself.remove = function(pattern) {\r\n\t\t\tvar shortcut = createShortcut(pattern);\r\n\r\n\t\t\tif (shortcuts[shortcut.id]) {\r\n\t\t\t\tdelete shortcuts[shortcut.id];\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/file/Uploader.js\r\n\r\n/**\r\n * Uploader.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Upload blobs or blob infos to the specified URL or handler.\r\n *\r\n * @private\r\n * @class tinymce.file.Uploader\r\n * @example\r\n * var uploader = new Uploader({\r\n *     url: '/upload.php',\r\n *     basePath: '/base/path',\r\n *     credentials: true,\r\n *     handler: function(data, success, failure) {\r\n *         ...\r\n *     }\r\n * });\r\n *\r\n * uploader.upload(blobInfos).then(function(result) {\r\n *     ...\r\n * });\r\n */\r\ndefine(\"tinymce/file/Uploader\", [\r\n\t\"tinymce/util/Promise\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/util/Fun\"\r\n], function(Promise, Tools, Fun) {\r\n\treturn function(uploadStatus, settings) {\r\n\t\tvar pendingPromises = {};\r\n\r\n\t\tfunction fileName(blobInfo) {\r\n\t\t\tvar ext, extensions;\r\n\r\n\t\t\textensions = {\r\n\t\t\t\t'image/jpeg': 'jpg',\r\n\t\t\t\t'image/jpg': 'jpg',\r\n\t\t\t\t'image/gif': 'gif',\r\n\t\t\t\t'image/png': 'png'\r\n\t\t\t};\r\n\r\n\t\t\text = extensions[blobInfo.blob().type.toLowerCase()] || 'dat';\r\n\r\n\t\t\treturn blobInfo.id() + '.' + ext;\r\n\t\t}\r\n\r\n\t\tfunction pathJoin(path1, path2) {\r\n\t\t\tif (path1) {\r\n\t\t\t\treturn path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\r\n\t\t\t}\r\n\r\n\t\t\treturn path2;\r\n\t\t}\r\n\r\n\t\tfunction blobInfoToData(blobInfo) {\r\n\t\t\treturn {\r\n\t\t\t\tid: blobInfo.id,\r\n\t\t\t\tblob: blobInfo.blob,\r\n\t\t\t\tbase64: blobInfo.base64,\r\n\t\t\t\tfilename: Fun.constant(fileName(blobInfo))\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction defaultHandler(blobInfo, success, failure, progress) {\r\n\t\t\tvar xhr, formData;\r\n\r\n\t\t\txhr = new XMLHttpRequest();\r\n\t\t\txhr.open('POST', settings.url);\r\n\t\t\txhr.withCredentials = settings.credentials;\r\n\r\n\t\t\txhr.upload.onprogress = function(e) {\r\n\t\t\t\tprogress(e.loaded / e.total * 100);\r\n\t\t\t};\r\n\r\n\t\t\txhr.onerror = function() {\r\n\t\t\t\tfailure(\"Image upload failed due to a XHR Transport error. Code: \" + xhr.status);\r\n\t\t\t};\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tvar json;\r\n\r\n\t\t\t\tif (xhr.status != 200) {\r\n\t\t\t\t\tfailure(\"HTTP Error: \" + xhr.status);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tjson = JSON.parse(xhr.responseText);\r\n\r\n\t\t\t\tif (!json || typeof json.location != \"string\") {\r\n\t\t\t\t\tfailure(\"Invalid JSON: \" + xhr.responseText);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsuccess(pathJoin(settings.basePath, json.location));\r\n\t\t\t};\r\n\r\n\t\t\tformData = new FormData();\r\n\t\t\tformData.append('file', blobInfo.blob(), fileName(blobInfo));\r\n\r\n\t\t\txhr.send(formData);\r\n\t\t}\r\n\r\n\t\tfunction noUpload() {\r\n\t\t\treturn new Promise(function(resolve) {\r\n\t\t\t\tresolve([]);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction handlerSuccess(blobInfo, url) {\r\n\t\t\treturn {\r\n\t\t\t\turl: url,\r\n\t\t\t\tblobInfo: blobInfo,\r\n\t\t\t\tstatus: true\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction handlerFailure(blobInfo, error) {\r\n\t\t\treturn {\r\n\t\t\t\turl: '',\r\n\t\t\t\tblobInfo: blobInfo,\r\n\t\t\t\tstatus: false,\r\n\t\t\t\terror: error\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction resolvePending(blobUri, result) {\r\n\t\t\tTools.each(pendingPromises[blobUri], function(resolve) {\r\n\t\t\t\tresolve(result);\r\n\t\t\t});\r\n\r\n\t\t\tdelete pendingPromises[blobUri];\r\n\t\t}\r\n\r\n\t\tfunction uploadBlobInfo(blobInfo, handler, openNotification) {\r\n\t\t\tuploadStatus.markPending(blobInfo.blobUri());\r\n\r\n\t\t\treturn new Promise(function(resolve) {\r\n\t\t\t\tvar notification, progress;\r\n\r\n\t\t\t\tvar noop = function() {\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar closeNotification = function() {\r\n\t\t\t\t\t\tif (notification) {\r\n\t\t\t\t\t\t\tnotification.close();\r\n\t\t\t\t\t\t\tprogress = noop; // Once it's closed it's closed\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar success = function(url) {\r\n\t\t\t\t\t\tcloseNotification();\r\n\t\t\t\t\t\tuploadStatus.markUploaded(blobInfo.blobUri(), url);\r\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\r\n\t\t\t\t\t\tresolve(handlerSuccess(blobInfo, url));\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar failure = function() {\r\n\t\t\t\t\t\tcloseNotification();\r\n\t\t\t\t\t\tuploadStatus.removeFailed(blobInfo.blobUri());\r\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, failure));\r\n\t\t\t\t\t\tresolve(handlerFailure(blobInfo, failure));\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tprogress = function(percent) {\r\n\t\t\t\t\t\tif (percent < 0 || percent > 100) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!notification) {\r\n\t\t\t\t\t\t\tnotification = openNotification();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnotification.progressBar.value(percent);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\thandler(blobInfoToData(blobInfo), success, failure, progress);\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\tresolve(handlerFailure(blobInfo, ex.message));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction isDefaultHandler(handler) {\r\n\t\t\treturn handler === defaultHandler;\r\n\t\t}\r\n\r\n\t\tfunction pendingUploadBlobInfo(blobInfo) {\r\n\t\t\tvar blobUri = blobInfo.blobUri();\r\n\r\n\t\t\treturn new Promise(function(resolve) {\r\n\t\t\t\tpendingPromises[blobUri] = pendingPromises[blobUri] || [];\r\n\t\t\t\tpendingPromises[blobUri].push(resolve);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction uploadBlobs(blobInfos, openNotification) {\r\n\t\t\tblobInfos = Tools.grep(blobInfos, function(blobInfo) {\r\n\t\t\t\treturn !uploadStatus.isUploaded(blobInfo.blobUri());\r\n\t\t\t});\r\n\r\n\t\t\treturn Promise.all(Tools.map(blobInfos, function(blobInfo) {\r\n\t\t\t\treturn uploadStatus.isPending(blobInfo.blobUri()) ?\r\n\t\t\t\t\tpendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tfunction upload(blobInfos, openNotification) {\r\n\t\t\treturn (!settings.url && isDefaultHandler(settings.handler)) ? noUpload() : uploadBlobs(blobInfos, openNotification);\r\n\t\t}\r\n\r\n\t\tsettings = Tools.extend({\r\n\t\t\tcredentials: false,\r\n\t\t\t// We are adding a notify argument to this (at the moment, until it doesn't work)\r\n\t\t\thandler: defaultHandler\r\n\t\t}, settings);\r\n\r\n\t\treturn {\r\n\t\t\tupload: upload\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/file/Conversions.js\r\n\r\n/**\r\n * Conversions.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Converts blob/uris back and forth.\r\n *\r\n * @private\r\n * @class tinymce.file.Conversions\r\n */\r\ndefine(\"tinymce/file/Conversions\", [\r\n\t\"tinymce/util/Promise\"\r\n], function(Promise) {\r\n\tfunction blobUriToBlob(url) {\r\n\t\treturn new Promise(function(resolve) {\r\n\t\t\tvar xhr = new XMLHttpRequest();\r\n\r\n\t\t\txhr.open('GET', url, true);\r\n\t\t\txhr.responseType = 'blob';\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tif (this.status == 200) {\r\n\t\t\t\t\tresolve(this.response);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.send();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction parseDataUri(uri) {\r\n\t\tvar type, matches;\r\n\r\n\t\turi = decodeURIComponent(uri).split(',');\r\n\r\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\r\n\t\tif (matches) {\r\n\t\t\ttype = matches[1];\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttype: type,\r\n\t\t\tdata: uri[1]\r\n\t\t};\r\n\t}\r\n\r\n\tfunction dataUriToBlob(uri) {\r\n\t\treturn new Promise(function(resolve) {\r\n\t\t\tvar str, arr, i;\r\n\r\n\t\t\turi = parseDataUri(uri);\r\n\r\n\t\t\t// Might throw error if data isn't proper base64\r\n\t\t\ttry {\r\n\t\t\t\tstr = atob(uri.data);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tresolve(new Blob([]));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tarr = new Uint8Array(str.length);\r\n\r\n\t\t\tfor (i = 0; i < arr.length; i++) {\r\n\t\t\t\tarr[i] = str.charCodeAt(i);\r\n\t\t\t}\r\n\r\n\t\t\tresolve(new Blob([arr], {type: uri.type}));\r\n\t\t});\r\n\t}\r\n\r\n\tfunction uriToBlob(url) {\r\n\t\tif (url.indexOf('blob:') === 0) {\r\n\t\t\treturn blobUriToBlob(url);\r\n\t\t}\r\n\r\n\t\tif (url.indexOf('data:') === 0) {\r\n\t\t\treturn dataUriToBlob(url);\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction blobToDataUri(blob) {\r\n\t\treturn new Promise(function(resolve) {\r\n\t\t\tvar reader = new FileReader();\r\n\r\n\t\t\treader.onloadend = function() {\r\n\t\t\t\tresolve(reader.result);\r\n\t\t\t};\r\n\r\n\t\t\treader.readAsDataURL(blob);\r\n\t\t});\r\n\t}\r\n\r\n\treturn {\r\n\t\turiToBlob: uriToBlob,\r\n\t\tblobToDataUri: blobToDataUri,\r\n\t\tparseDataUri: parseDataUri\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/file/ImageScanner.js\r\n\r\n/**\r\n * ImageScanner.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Finds images with data uris or blob uris. If data uris are found it will convert them into blob uris.\r\n *\r\n * @private\r\n * @class tinymce.file.ImageScanner\r\n */\r\ndefine(\"tinymce/file/ImageScanner\", [\r\n\t\"tinymce/util/Promise\",\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/util/Fun\",\r\n\t\"tinymce/file/Conversions\",\r\n\t\"tinymce/Env\"\r\n], function(Promise, Arr, Fun, Conversions, Env) {\r\n\tvar count = 0;\r\n\r\n\treturn function(uploadStatus, blobCache) {\r\n\t\tvar cachedPromises = {};\r\n\r\n\t\tfunction findAll(elm, predicate) {\r\n\t\t\tvar images, promises;\r\n\r\n\t\t\tfunction imageToBlobInfo(img, resolve) {\r\n\t\t\t\tvar base64, blobInfo;\r\n\r\n\t\t\t\tif (img.src.indexOf('blob:') === 0) {\r\n\t\t\t\t\tblobInfo = blobCache.getByUri(img.src);\r\n\r\n\t\t\t\t\tif (blobInfo) {\r\n\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\timage: img,\r\n\t\t\t\t\t\t\tblobInfo: blobInfo\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbase64 = Conversions.parseDataUri(img.src).data;\r\n\t\t\t\tblobInfo = blobCache.findFirst(function(cachedBlobInfo) {\r\n\t\t\t\t\treturn cachedBlobInfo.base64() === base64;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (blobInfo) {\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\timage: img,\r\n\t\t\t\t\t\tblobInfo: blobInfo\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tConversions.uriToBlob(img.src).then(function(blob) {\r\n\t\t\t\t\t\tvar blobInfoId = 'blobid' + (count++),\r\n\t\t\t\t\t\t\tblobInfo = blobCache.create(blobInfoId, blob, base64);\r\n\r\n\t\t\t\t\t\tblobCache.add(blobInfo);\r\n\r\n\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\timage: img,\r\n\t\t\t\t\t\t\tblobInfo: blobInfo\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!predicate) {\r\n\t\t\t\tpredicate = Fun.constant(true);\r\n\t\t\t}\r\n\r\n\t\t\timages = Arr.filter(elm.getElementsByTagName('img'), function(img) {\r\n\t\t\t\tvar src = img.src;\r\n\r\n\t\t\t\tif (!Env.fileApi) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (img.hasAttribute('data-mce-bogus')) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (img.hasAttribute('data-mce-placeholder')) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!src || src == Env.transparentSrc) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (src.indexOf('blob:') === 0) {\r\n\t\t\t\t\treturn !uploadStatus.isUploaded(src);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (src.indexOf('data:') === 0) {\r\n\t\t\t\t\treturn predicate(img);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\r\n\t\t\tpromises = Arr.map(images, function(img) {\r\n\t\t\t\tvar newPromise;\r\n\r\n\t\t\t\tif (cachedPromises[img.src]) {\r\n\t\t\t\t\t// Since the cached promise will return the cached image\r\n\t\t\t\t\t// We need to wrap it and resolve with the actual image\r\n\t\t\t\t\treturn new Promise(function(resolve) {\r\n\t\t\t\t\t\tcachedPromises[img.src].then(function(imageInfo) {\r\n\t\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\t\timage: img,\r\n\t\t\t\t\t\t\t\tblobInfo: imageInfo.blobInfo\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewPromise = new Promise(function(resolve) {\r\n\t\t\t\t\timageToBlobInfo(img, resolve);\r\n\t\t\t\t}).then(function(result) {\r\n\t\t\t\t\tdelete cachedPromises[result.image.src];\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t})['catch'](function(error) {\r\n\t\t\t\t\tdelete cachedPromises[img.src];\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcachedPromises[img.src] = newPromise;\r\n\r\n\t\t\t\treturn newPromise;\r\n\t\t\t});\r\n\r\n\t\t\treturn Promise.all(promises);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tfindAll: findAll\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/file/BlobCache.js\r\n\r\n/**\r\n * BlobCache.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Hold blob info objects where a blob has extra internal information.\r\n *\r\n * @private\r\n * @class tinymce.file.BlobCache\r\n */\r\ndefine(\"tinymce/file/BlobCache\", [\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/util/Fun\"\r\n], function(Arr, Fun) {\r\n\treturn function() {\r\n\t\tvar cache = [], constant = Fun.constant;\r\n\r\n\t\tfunction create(id, blob, base64) {\r\n\t\t\treturn {\r\n\t\t\t\tid: constant(id),\r\n\t\t\t\tblob: constant(blob),\r\n\t\t\t\tbase64: constant(base64),\r\n\t\t\t\tblobUri: constant(URL.createObjectURL(blob))\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction add(blobInfo) {\r\n\t\t\tif (!get(blobInfo.id())) {\r\n\t\t\t\tcache.push(blobInfo);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction get(id) {\r\n\t\t\treturn findFirst(function(cachedBlobInfo) {\r\n\t\t\t\treturn cachedBlobInfo.id() === id;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction findFirst(predicate) {\r\n\t\t\treturn Arr.filter(cache, predicate)[0];\r\n\t\t}\r\n\r\n\t\tfunction getByUri(blobUri) {\r\n\t\t\treturn findFirst(function(blobInfo) {\r\n\t\t\t\treturn blobInfo.blobUri() == blobUri;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction removeByUri(blobUri) {\r\n\t\t\tcache = Arr.filter(cache, function(blobInfo) {\r\n\t\t\t\tif (blobInfo.blobUri() === blobUri) {\r\n\t\t\t\t\tURL.revokeObjectURL(blobInfo.blobUri());\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction destroy() {\r\n\t\t\tArr.each(cache, function(cachedBlobInfo) {\r\n\t\t\t\tURL.revokeObjectURL(cachedBlobInfo.blobUri());\r\n\t\t\t});\r\n\r\n\t\t\tcache = [];\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tcreate: create,\r\n\t\t\tadd: add,\r\n\t\t\tget: get,\r\n\t\t\tgetByUri: getByUri,\r\n\t\t\tfindFirst: findFirst,\r\n\t\t\tremoveByUri: removeByUri,\r\n\t\t\tdestroy: destroy\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/file/UploadStatus.js\r\n\r\n/**\r\n * UploadStatus.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Holds the current status of a blob uri, if it's pending or uploaded and what the result urls was.\r\n *\r\n * @private\r\n * @class tinymce.file.UploadStatus\r\n */\r\ndefine(\"tinymce/file/UploadStatus\", [\r\n], function() {\r\n\treturn function() {\r\n\t\tvar PENDING = 1, UPLOADED = 2;\r\n\t\tvar blobUriStatuses = {};\r\n\r\n\t\tfunction createStatus(status, resultUri) {\r\n\t\t\treturn {\r\n\t\t\t\tstatus: status,\r\n\t\t\t\tresultUri: resultUri\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction hasBlobUri(blobUri) {\r\n\t\t\treturn blobUri in blobUriStatuses;\r\n\t\t}\r\n\r\n\t\tfunction getResultUri(blobUri) {\r\n\t\t\tvar result = blobUriStatuses[blobUri];\r\n\r\n\t\t\treturn result ? result.resultUri : null;\r\n\t\t}\r\n\r\n\t\tfunction isPending(blobUri) {\r\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\r\n\t\t}\r\n\r\n\t\tfunction isUploaded(blobUri) {\r\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\r\n\t\t}\r\n\r\n\t\tfunction markPending(blobUri) {\r\n\t\t\tblobUriStatuses[blobUri] = createStatus(PENDING, null);\r\n\t\t}\r\n\r\n\t\tfunction markUploaded(blobUri, resultUri) {\r\n\t\t\tblobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\r\n\t\t}\r\n\r\n\t\tfunction removeFailed(blobUri) {\r\n\t\t\tdelete blobUriStatuses[blobUri];\r\n\t\t}\r\n\r\n\t\tfunction destroy() {\r\n\t\t\tblobUriStatuses = {};\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\thasBlobUri: hasBlobUri,\r\n\t\t\tgetResultUri: getResultUri,\r\n\t\t\tisPending: isPending,\r\n\t\t\tisUploaded: isUploaded,\r\n\t\t\tmarkPending: markPending,\r\n\t\t\tmarkUploaded: markUploaded,\r\n\t\t\tremoveFailed: removeFailed,\r\n\t\t\tdestroy: destroy\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/EditorUpload.js\r\n\r\n/**\r\n * EditorUpload.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Handles image uploads, updates undo stack and patches over various internal functions.\r\n *\r\n * @private\r\n * @class tinymce.EditorUpload\r\n */\r\ndefine(\"tinymce/EditorUpload\", [\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/file/Uploader\",\r\n\t\"tinymce/file/ImageScanner\",\r\n\t\"tinymce/file/BlobCache\",\r\n\t\"tinymce/file/UploadStatus\"\r\n], function(Arr, Uploader, ImageScanner, BlobCache, UploadStatus) {\r\n\treturn function(editor) {\r\n\t\tvar blobCache = new BlobCache(), uploader, imageScanner, settings = editor.settings;\r\n\t\tvar uploadStatus = new UploadStatus();\r\n\r\n\t\tfunction aliveGuard(callback) {\r\n\t\t\treturn function(result) {\r\n\t\t\t\tif (editor.selection) {\r\n\t\t\t\t\treturn callback(result);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn [];\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Replaces strings without regexps to avoid FF regexp to big issue\r\n\t\tfunction replaceString(content, search, replace) {\r\n\t\t\tvar index = 0;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tindex = content.indexOf(search, index);\r\n\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tcontent = content.substring(0, index) + replace + content.substr(index + search.length);\r\n\t\t\t\t\tindex += replace.length - search.length + 1;\r\n\t\t\t\t}\r\n\t\t\t} while (index !== -1);\r\n\r\n\t\t\treturn content;\r\n\t\t}\r\n\r\n\t\tfunction replaceImageUrl(content, targetUrl, replacementUrl) {\r\n\t\t\tcontent = replaceString(content, 'src=\"' + targetUrl + '\"', 'src=\"' + replacementUrl + '\"');\r\n\t\t\tcontent = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\r\n\r\n\t\t\treturn content;\r\n\t\t}\r\n\r\n\t\tfunction replaceUrlInUndoStack(targetUrl, replacementUrl) {\r\n\t\t\tArr.each(editor.undoManager.data, function(level) {\r\n\t\t\t\tlevel.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction openNotification() {\r\n\t\t\treturn editor.notificationManager.open({\r\n\t\t\t\ttext: editor.translate('Image uploading...'),\r\n\t\t\t\ttype: 'info',\r\n\t\t\t\ttimeout: -1,\r\n\t\t\t\tprogressBar: true\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction replaceImageUri(image, resultUri) {\r\n\t\t\tblobCache.removeByUri(image.src);\r\n\t\t\treplaceUrlInUndoStack(image.src, resultUri);\r\n\r\n\t\t\teditor.$(image).attr({\r\n\t\t\t\tsrc: resultUri,\r\n\t\t\t\t'data-mce-src': editor.convertURL(resultUri, 'src')\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction uploadImages(callback) {\r\n\t\t\tif (!uploader) {\r\n\t\t\t\tuploader = new Uploader(uploadStatus, {\r\n\t\t\t\t\turl: settings.images_upload_url,\r\n\t\t\t\t\tbasePath: settings.images_upload_base_path,\r\n\t\t\t\t\tcredentials: settings.images_upload_credentials,\r\n\t\t\t\t\thandler: settings.images_upload_handler\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn scanForImages().then(aliveGuard(function(imageInfos) {\r\n\t\t\t\tvar blobInfos;\r\n\r\n\t\t\t\tblobInfos = Arr.map(imageInfos, function(imageInfo) {\r\n\t\t\t\t\treturn imageInfo.blobInfo;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn uploader.upload(blobInfos, openNotification).then(aliveGuard(function(result) {\r\n\t\t\t\t\tresult = Arr.map(result, function(uploadInfo, index) {\r\n\t\t\t\t\t\tvar image = imageInfos[index].image;\r\n\r\n\t\t\t\t\t\tif (uploadInfo.status && editor.settings.images_replace_blob_uris !== false) {\r\n\t\t\t\t\t\t\treplaceImageUri(image, uploadInfo.url);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\telement: image,\r\n\t\t\t\t\t\t\tstatus: uploadInfo.status\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback(result);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}));\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tfunction uploadImagesAuto(callback) {\r\n\t\t\tif (settings.automatic_uploads !== false) {\r\n\t\t\t\treturn uploadImages(callback);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction isValidDataUriImage(imgElm) {\r\n\t\t\treturn settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm) : true;\r\n\t\t}\r\n\r\n\t\tfunction scanForImages() {\r\n\t\t\tif (!imageScanner) {\r\n\t\t\t\timageScanner = new ImageScanner(uploadStatus, blobCache);\r\n\t\t\t}\r\n\r\n\t\t\treturn imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function(result) {\r\n\t\t\t\tArr.each(result, function(resultItem) {\r\n\t\t\t\t\treplaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\r\n\t\t\t\t\tresultItem.image.src = resultItem.blobInfo.blobUri();\r\n\t\t\t\t\tresultItem.image.removeAttribute('data-mce-src');\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tfunction destroy() {\r\n\t\t\tblobCache.destroy();\r\n\t\t\tuploadStatus.destroy();\r\n\t\t\timageScanner = uploader = null;\r\n\t\t}\r\n\r\n\t\tfunction replaceBlobUris(content) {\r\n\t\t\treturn content.replace(/src=\"(blob:[^\"]+)\"/g, function(match, blobUri) {\r\n\t\t\t\tvar resultUri = uploadStatus.getResultUri(blobUri);\r\n\r\n\t\t\t\tif (resultUri) {\r\n\t\t\t\t\treturn 'src=\"' + resultUri + '\"';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar blobInfo = blobCache.getByUri(blobUri);\r\n\r\n\t\t\t\tif (!blobInfo) {\r\n\t\t\t\t\tblobInfo = Arr.reduce(editor.editorManager.editors, function(result, editor) {\r\n\t\t\t\t\t\treturn result || editor.editorUpload.blobCache.getByUri(blobUri);\r\n\t\t\t\t\t}, null);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (blobInfo) {\r\n\t\t\t\t\treturn 'src=\"data:' + blobInfo.blob().type + ';base64,' + blobInfo.base64() + '\"';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn match;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\teditor.on('setContent', function() {\r\n\t\t\tif (editor.settings.automatic_uploads !== false) {\r\n\t\t\t\tuploadImagesAuto();\r\n\t\t\t} else {\r\n\t\t\t\tscanForImages();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\teditor.on('RawSaveContent', function(e) {\r\n\t\t\te.content = replaceBlobUris(e.content);\r\n\t\t});\r\n\r\n\t\teditor.on('getContent', function(e) {\r\n\t\t\tif (e.source_view || e.format == 'raw') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\te.content = replaceBlobUris(e.content);\r\n\t\t});\r\n\r\n\t\teditor.on('PostRender', function() {\r\n\t\t\teditor.parser.addNodeFilter('img', function(images) {\r\n\t\t\t\tArr.each(images, function(img) {\r\n\t\t\t\t\tvar src = img.attr('src');\r\n\r\n\t\t\t\t\tif (blobCache.getByUri(src)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar resultUri = uploadStatus.getResultUri(src);\r\n\t\t\t\t\tif (resultUri) {\r\n\t\t\t\t\t\timg.attr('src', resultUri);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tblobCache: blobCache,\r\n\t\t\tuploadImages: uploadImages,\r\n\t\t\tuploadImagesAuto: uploadImagesAuto,\r\n\t\t\tscanForImages: scanForImages,\r\n\t\t\tdestroy: destroy\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/FakeCaret.js\r\n\r\n/**\r\n * FakeCaret.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module contains logic for rendering a fake visual caret.\r\n *\r\n * @private\r\n * @class tinymce.caret.FakeCaret\r\n */\r\ndefine(\"tinymce/caret/FakeCaret\", [\r\n\t\"tinymce/caret/CaretContainer\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/geom/ClientRect\",\r\n\t\"tinymce/util/Delay\"\r\n], function(CaretContainer, CaretPosition, NodeType, RangeUtils, $, ClientRect, Delay) {\r\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\r\n\r\n\treturn function(rootNode, isBlock) {\r\n\t\tvar cursorInterval, $lastVisualCaret, caretContainerNode;\r\n\r\n\t\tfunction getAbsoluteClientRect(node, before) {\r\n\t\t\tvar clientRect = ClientRect.collapse(node.getBoundingClientRect(), before),\r\n\t\t\t\tdocElm, scrollX, scrollY, margin, rootRect;\r\n\r\n\t\t\tif (rootNode.tagName == 'BODY') {\r\n\t\t\t\tdocElm = rootNode.ownerDocument.documentElement;\r\n\t\t\t\tscrollX = rootNode.scrollLeft || docElm.scrollLeft;\r\n\t\t\t\tscrollY = rootNode.scrollTop || docElm.scrollTop;\r\n\t\t\t} else {\r\n\t\t\t\trootRect = rootNode.getBoundingClientRect();\r\n\t\t\t\tscrollX = rootNode.scrollLeft - rootRect.left;\r\n\t\t\t\tscrollY = rootNode.scrollTop - rootRect.top;\r\n\t\t\t}\r\n\r\n\t\t\tclientRect.left += scrollX;\r\n\t\t\tclientRect.right += scrollX;\r\n\t\t\tclientRect.top += scrollY;\r\n\t\t\tclientRect.bottom += scrollY;\r\n\t\t\tclientRect.width = 1;\r\n\r\n\t\t\tmargin = node.offsetWidth - node.clientWidth;\r\n\r\n\t\t\tif (margin > 0) {\r\n\t\t\t\tif (before) {\r\n\t\t\t\t\tmargin *= -1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclientRect.left += margin;\r\n\t\t\t\tclientRect.right += margin;\r\n\t\t\t}\r\n\r\n\t\t\treturn clientRect;\r\n\t\t}\r\n\r\n\t\tfunction trimInlineCaretContainers() {\r\n\t\t\tvar contentEditableFalseNodes, node, sibling, i, data;\r\n\r\n\t\t\tcontentEditableFalseNodes = $('*[contentEditable=false]', rootNode);\r\n\t\t\tfor (i = 0; i < contentEditableFalseNodes.length; i++) {\r\n\t\t\t\tnode = contentEditableFalseNodes[i];\r\n\r\n\t\t\t\tsibling = node.previousSibling;\r\n\t\t\t\tif (CaretContainer.endsWithCaretContainer(sibling)) {\r\n\t\t\t\t\tdata = sibling.data;\r\n\r\n\t\t\t\t\tif (data.length == 1) {\r\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsibling.deleteData(data.length - 1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsibling = node.nextSibling;\r\n\t\t\t\tif (CaretContainer.startsWithCaretContainer(sibling)) {\r\n\t\t\t\t\tdata = sibling.data;\r\n\r\n\t\t\t\t\tif (data.length == 1) {\r\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsibling.deleteData(0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction show(before, node) {\r\n\t\t\tvar clientRect, rng, container;\r\n\r\n\t\t\thide();\r\n\r\n\t\t\tif (isBlock(node)) {\r\n\t\t\t\tcaretContainerNode = CaretContainer.insertBlock('p', node, before);\r\n\t\t\t\tclientRect = getAbsoluteClientRect(node, before);\r\n\t\t\t\t$(caretContainerNode).css('top', clientRect.top);\r\n\r\n\t\t\t\t$lastVisualCaret = $('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(rootNode);\r\n\r\n\t\t\t\tif (before) {\r\n\t\t\t\t\t$lastVisualCaret.addClass('mce-visual-caret-before');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstartBlink();\r\n\r\n\t\t\t\trng = node.ownerDocument.createRange();\r\n\t\t\t\tcontainer = caretContainerNode.firstChild;\r\n\t\t\t\trng.setStart(container, 0);\r\n\t\t\t\trng.setEnd(container, 1);\r\n\t\t\t} else {\r\n\t\t\t\tcaretContainerNode = CaretContainer.insertInline(node, before);\r\n\t\t\t\trng = node.ownerDocument.createRange();\r\n\r\n\t\t\t\tif (isContentEditableFalse(caretContainerNode.nextSibling)) {\r\n\t\t\t\t\trng.setStart(caretContainerNode, 0);\r\n\t\t\t\t\trng.setEnd(caretContainerNode, 0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trng.setStart(caretContainerNode, 1);\r\n\t\t\t\t\trng.setEnd(caretContainerNode, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn rng;\r\n\t\t\t}\r\n\r\n\t\t\treturn rng;\r\n\t\t}\r\n\r\n\t\tfunction hide() {\r\n\t\t\ttrimInlineCaretContainers();\r\n\r\n\t\t\tif (caretContainerNode) {\r\n\t\t\t\tCaretContainer.remove(caretContainerNode);\r\n\t\t\t\tcaretContainerNode = null;\r\n\t\t\t}\r\n\r\n\t\t\tif ($lastVisualCaret) {\r\n\t\t\t\t$lastVisualCaret.remove();\r\n\t\t\t\t$lastVisualCaret = null;\r\n\t\t\t}\r\n\r\n\t\t\tclearInterval(cursorInterval);\r\n\t\t}\r\n\r\n\t\tfunction startBlink() {\r\n\t\t\tcursorInterval = Delay.setInterval(function() {\r\n\t\t\t\t$('div.mce-visual-caret', rootNode).toggleClass('mce-visual-caret-hidden');\r\n\t\t\t}, 500);\r\n\t\t}\r\n\r\n\t\tfunction destroy() {\r\n\t\t\tDelay.clearInterval(cursorInterval);\r\n\t\t}\r\n\r\n\t\tfunction getCss() {\r\n\t\t\treturn (\r\n\t\t\t\t'.mce-visual-caret {' +\r\n\t\t\t\t\t'position: absolute;' +\r\n\t\t\t\t\t'background-color: black;' +\r\n\t\t\t\t\t'background-color: currentcolor;' +\r\n\t\t\t\t'}' +\r\n\t\t\t\t'.mce-visual-caret-hidden {' +\r\n\t\t\t\t\t'display: none;' +\r\n\t\t\t\t'}' +\r\n\t\t\t\t'*[data-mce-caret] {' +\r\n\t\t\t\t\t'position: absolute;' +\r\n\t\t\t\t\t'left: -1000px;' +\r\n\t\t\t\t\t'right: auto;' +\r\n\t\t\t\t\t'top: 0;' +\r\n\t\t\t\t\t'margin: 0;' +\r\n\t\t\t\t\t'padding: 0;' +\r\n\t\t\t\t'}'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tshow: show,\r\n\t\t\thide: hide,\r\n\t\t\tgetCss: getCss,\r\n\t\t\tdestroy: destroy\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/dom/Dimensions.js\r\n\r\n/**\r\n * Dimensions.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module measures nodes and returns client rects. The client rects has an\r\n * extra node property.\r\n *\r\n * @private\r\n * @class tinymce.dom.Dimensions\r\n */\r\ndefine(\"tinymce/dom/Dimensions\", [\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/geom/ClientRect\"\r\n], function(Arr, NodeType, ClientRect) {\r\n\r\n\tfunction getClientRects(node) {\r\n\t\tfunction toArrayWithNode(clientRects) {\r\n\t\t\treturn Arr.map(clientRects, function(clientRect) {\r\n\t\t\t\tclientRect = ClientRect.clone(clientRect);\r\n\t\t\t\tclientRect.node = node;\r\n\r\n\t\t\t\treturn clientRect;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (Arr.isArray(node)) {\r\n\t\t\treturn Arr.reduce(node, function(result, node) {\r\n\t\t\t\treturn result.concat(getClientRects(node));\r\n\t\t\t}, []);\r\n\t\t}\r\n\r\n\t\tif (NodeType.isElement(node)) {\r\n\t\t\treturn toArrayWithNode(node.getClientRects());\r\n\t\t}\r\n\r\n\t\tif (NodeType.isText(node)) {\r\n\t\t\tvar rng = node.ownerDocument.createRange();\r\n\r\n\t\t\trng.setStart(node, 0);\r\n\t\t\trng.setEnd(node, node.data.length);\r\n\r\n\t\t\treturn toArrayWithNode(rng.getClientRects());\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Returns the client rects for a specific node.\r\n\t\t *\r\n\t\t * @method getClientRects\r\n\t\t * @param {Array/DOMNode} node Node or array of nodes to get client rects on.\r\n\t\t * @param {Array} Array of client rects with a extra node property.\r\n\t\t */\r\n\t\tgetClientRects: getClientRects\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/LineWalker.js\r\n\r\n/**\r\n * LineWalker.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module lets you walk the document line by line\r\n * returing nodes and client rects for each line.\r\n *\r\n * @private\r\n * @class tinymce.caret.LineWalker\r\n */\r\ndefine(\"tinymce/caret/LineWalker\", [\r\n\t\"tinymce/util/Fun\",\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/dom/Dimensions\",\r\n\t\"tinymce/caret/CaretCandidate\",\r\n\t\"tinymce/caret/CaretUtils\",\r\n\t\"tinymce/caret/CaretWalker\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/geom/ClientRect\"\r\n], function(Fun, Arr, Dimensions, CaretCandidate, CaretUtils, CaretWalker, CaretPosition, ClientRect) {\r\n\tvar curry = Fun.curry;\r\n\r\n\tfunction findUntil(direction, rootNode, predicateFn, node) {\r\n\t\twhile ((node = CaretUtils.findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\r\n\t\t\tif (predicateFn(node)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction walkUntil(direction, isAboveFn, isBeflowFn, rootNode, predicateFn, caretPosition) {\r\n\t\tvar line = 0, node, result = [], targetClientRect;\r\n\r\n\t\tfunction add(node) {\r\n\t\t\tvar i, clientRect, clientRects;\r\n\r\n\t\t\tclientRects = Dimensions.getClientRects(node);\r\n\t\t\tif (direction == -1) {\r\n\t\t\t\tclientRects = clientRects.reverse();\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0; i < clientRects.length; i++) {\r\n\t\t\t\tclientRect = clientRects[i];\r\n\t\t\t\tif (isBeflowFn(clientRect, targetClientRect)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (result.length > 0 && isAboveFn(clientRect, Arr.last(result))) {\r\n\t\t\t\t\tline++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclientRect.line = line;\r\n\r\n\t\t\t\tif (predicateFn(clientRect)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresult.push(clientRect);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttargetClientRect = Arr.last(caretPosition.getClientRects());\r\n\t\tif (!targetClientRect) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tnode = caretPosition.getNode();\r\n\t\tadd(node);\r\n\t\tfindUntil(direction, rootNode, add, node);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction aboveLineNumber(lineNumber, clientRect) {\r\n\t\treturn clientRect.line > lineNumber;\r\n\t}\r\n\r\n\tfunction isLine(lineNumber, clientRect) {\r\n\t\treturn clientRect.line === lineNumber;\r\n\t}\r\n\r\n\tvar upUntil = curry(walkUntil, -1, ClientRect.isAbove, ClientRect.isBelow);\r\n\tvar downUntil = curry(walkUntil, 1, ClientRect.isBelow, ClientRect.isAbove);\r\n\r\n\tfunction positionsUntil(direction, rootNode, predicateFn, node) {\r\n\t\tvar caretWalker = new CaretWalker(rootNode), walkFn, isBelowFn, isAboveFn,\r\n\t\t\tcaretPosition, result = [], line = 0, clientRect, targetClientRect;\r\n\r\n\t\tfunction getClientRect(caretPosition) {\r\n\t\t\tif (direction == 1) {\r\n\t\t\t\treturn Arr.last(caretPosition.getClientRects());\r\n\t\t\t}\r\n\r\n\t\t\treturn Arr.last(caretPosition.getClientRects());\r\n\t\t}\r\n\r\n\t\tif (direction == 1) {\r\n\t\t\twalkFn = caretWalker.next;\r\n\t\t\tisBelowFn = ClientRect.isBelow;\r\n\t\t\tisAboveFn = ClientRect.isAbove;\r\n\t\t\tcaretPosition = CaretPosition.after(node);\r\n\t\t} else {\r\n\t\t\twalkFn = caretWalker.prev;\r\n\t\t\tisBelowFn = ClientRect.isAbove;\r\n\t\t\tisAboveFn = ClientRect.isBelow;\r\n\t\t\tcaretPosition = CaretPosition.before(node);\r\n\t\t}\r\n\r\n\t\ttargetClientRect = getClientRect(caretPosition);\r\n\r\n\t\tdo {\r\n\t\t\tif (!caretPosition.isVisible()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tclientRect = getClientRect(caretPosition);\r\n\r\n\t\t\tif (isAboveFn(clientRect, targetClientRect)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (result.length > 0 && isBelowFn(clientRect, Arr.last(result))) {\r\n\t\t\t\tline++;\r\n\t\t\t}\r\n\r\n\t\t\tclientRect = ClientRect.clone(clientRect);\r\n\t\t\tclientRect.position = caretPosition;\r\n\t\t\tclientRect.line = line;\r\n\r\n\t\t\tif (predicateFn(clientRect)) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tresult.push(clientRect);\r\n\t\t} while ((caretPosition = walkFn(caretPosition)));\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\treturn {\r\n\t\tupUntil: upUntil,\r\n\t\tdownUntil: downUntil,\r\n\r\n\t\t/**\r\n\t\t * Find client rects with line and caret position until the predicate returns true.\r\n\t\t *\r\n\t\t * @method positionsUntil\r\n\t\t * @param {Number} direction Direction forward/backward 1/-1.\r\n\t\t * @param {DOMNode} rootNode Root node to walk within.\r\n\t\t * @param {function} predicateFn Gets the client rect as it's input.\r\n\t\t * @param {DOMNode} node Node to start walking from.\r\n\t\t * @return {Array} Array of client rects with line and position properties.\r\n\t\t */\r\n\t\tpositionsUntil: positionsUntil,\r\n\r\n\t\tisAboveLine: curry(aboveLineNumber),\r\n\t\tisLine: curry(isLine)\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/caret/LineUtils.js\r\n\r\n/**\r\n * LineUtils.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Utility functions for working with lines.\r\n *\r\n * @private\r\n * @class tinymce.caret.LineUtils\r\n */\r\ndefine(\"tinymce/caret/LineUtils\", [\r\n\t\"tinymce/util/Fun\",\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/dom/Dimensions\",\r\n\t\"tinymce/geom/ClientRect\",\r\n\t\"tinymce/caret/CaretUtils\",\r\n\t\"tinymce/caret/CaretCandidate\"\r\n], function(Fun, Arr, NodeType, Dimensions, ClientRect, CaretUtils, CaretCandidate) {\r\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\r\n\t\tfindNode = CaretUtils.findNode,\r\n\t\tcurry = Fun.curry;\r\n\r\n\tfunction distanceToRectLeft(clientRect, clientX) {\r\n\t\treturn Math.abs(clientRect.left - clientX);\r\n\t}\r\n\r\n\tfunction distanceToRectRight(clientRect, clientX) {\r\n\t\treturn Math.abs(clientRect.right - clientX);\r\n\t}\r\n\r\n\tfunction findClosestClientRect(clientRects, clientX) {\r\n\t\tfunction isInside(clientX, clientRect) {\r\n\t\t\treturn clientX >= clientRect.left && clientX <= clientRect.right;\r\n\t\t}\r\n\r\n\t\treturn Arr.reduce(clientRects, function(oldClientRect, clientRect) {\r\n\t\t\tvar oldDistance, newDistance;\r\n\r\n\t\t\toldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\r\n\t\t\tnewDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\r\n\r\n\t\t\tif (isInside(clientX, clientRect)) {\r\n\t\t\t\treturn clientRect;\r\n\t\t\t}\r\n\r\n\t\t\tif (isInside(clientX, oldClientRect)) {\r\n\t\t\t\treturn oldClientRect;\r\n\t\t\t}\r\n\r\n\t\t\t// cE=false has higher priority\r\n\t\t\tif (newDistance == oldDistance && isContentEditableFalse(clientRect.node)) {\r\n\t\t\t\treturn clientRect;\r\n\t\t\t}\r\n\r\n\t\t\tif (newDistance < oldDistance) {\r\n\t\t\t\treturn clientRect;\r\n\t\t\t}\r\n\r\n\t\t\treturn oldClientRect;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction walkUntil(direction, rootNode, predicateFn, node) {\r\n\t\twhile ((node = findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\r\n\t\t\tif (predicateFn(node)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction findLineNodeRects(rootNode, targetNodeRect) {\r\n\t\tvar clientRects = [];\r\n\r\n\t\tfunction collect(checkPosFn, node) {\r\n\t\t\tvar lineRects;\r\n\r\n\t\t\tlineRects = Arr.filter(Dimensions.getClientRects(node), function(clientRect) {\r\n\t\t\t\treturn !checkPosFn(clientRect, targetNodeRect);\r\n\t\t\t});\r\n\r\n\t\t\tclientRects = clientRects.concat(lineRects);\r\n\r\n\t\t\treturn lineRects.length === 0;\r\n\t\t}\r\n\r\n\t\tclientRects.push(targetNodeRect);\r\n\t\twalkUntil(-1, rootNode, curry(collect, ClientRect.isAbove), targetNodeRect.node);\r\n\t\twalkUntil(1, rootNode, curry(collect, ClientRect.isBelow), targetNodeRect.node);\r\n\r\n\t\treturn clientRects;\r\n\t}\r\n\r\n\tfunction getContentEditableFalseChildren(rootNode) {\r\n\t\treturn Arr.filter(Arr.toArray(rootNode.getElementsByTagName('*')), isContentEditableFalse);\r\n\t}\r\n\r\n\tfunction caretInfo(clientRect, clientX) {\r\n\t\treturn {\r\n\t\t\tnode: clientRect.node,\r\n\t\t\tbefore: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\r\n\t\t};\r\n\t}\r\n\r\n\tfunction closestCaret(rootNode, clientX, clientY) {\r\n\t\tvar contentEditableFalseNodeRects, closestNodeRect;\r\n\r\n\t\tcontentEditableFalseNodeRects = Dimensions.getClientRects(getContentEditableFalseChildren(rootNode));\r\n\t\tcontentEditableFalseNodeRects = Arr.filter(contentEditableFalseNodeRects, function(clientRect) {\r\n\t\t\treturn clientY >= clientRect.top && clientY <= clientRect.bottom;\r\n\t\t});\r\n\r\n\t\tclosestNodeRect = findClosestClientRect(contentEditableFalseNodeRects, clientX);\r\n\t\tif (closestNodeRect) {\r\n\t\t\tclosestNodeRect = findClosestClientRect(findLineNodeRects(rootNode, closestNodeRect), clientX);\r\n\t\t\tif (closestNodeRect && isContentEditableFalse(closestNodeRect.node)) {\r\n\t\t\t\treturn caretInfo(closestNodeRect, clientX);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn {\r\n\t\tfindClosestClientRect: findClosestClientRect,\r\n\t\tfindLineNodeRects: findLineNodeRects,\r\n\t\tclosestCaret: closestCaret\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/DragDropOverrides.js\r\n\r\n/**\r\n * DragDropOverrides.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module contains logic overriding the drag/drop logic of the editor.\r\n *\r\n * @private\r\n * @class tinymce.DragDropOverrides\r\n */\r\ndefine(\"tinymce/DragDropOverrides\", [\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/util/Fun\"\r\n], function(\r\n\tNodeType,\r\n\tArr,\r\n\tFun\r\n) {\r\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\r\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue;\r\n\r\n\tfunction init(editor) {\r\n\t\tvar $ = editor.$, rootDocument = document,\r\n\t\t\teditableDoc = editor.getDoc(),\r\n\t\t\tdom = editor.dom, state = {};\r\n\r\n\t\tfunction isDraggable(elm) {\r\n\t\t\treturn isContentEditableFalse(elm);\r\n\t\t}\r\n\r\n\t\tfunction setBodyCursor(cursor) {\r\n\t\t\t$(editor.getBody()).css('cursor', cursor);\r\n\t\t}\r\n\r\n\t\tfunction isValidDropTarget(elm) {\r\n\t\t\tif (elm == state.element || editor.dom.isChildOf(elm, state.element)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (isContentEditableFalse(elm)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction move(e) {\r\n\t\t\tvar deltaX, deltaY, pos, viewPort,\r\n\t\t\t\toverflowX = 0, overflowY = 0, movement,\r\n\t\t\t\tclientX, clientY, rootClientRect;\r\n\r\n\t\t\tif (e.button !== 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdeltaX = e.screenX - state.screenX;\r\n\t\t\tdeltaY = e.screenY - state.screenY;\r\n\t\t\tmovement = Math.max(Math.abs(deltaX), Math.abs(deltaY));\r\n\r\n\t\t\tif (!state.dragging && movement > 10) {\r\n\t\t\t\tstate.dragging = true;\r\n\t\t\t\tsetBodyCursor('default');\r\n\r\n\t\t\t\tstate.clone = state.element.cloneNode(true);\r\n\r\n\t\t\t\tpos = dom.getPos(state.element);\r\n\t\t\t\tstate.relX = state.clientX - pos.x;\r\n\t\t\t\tstate.relY = state.clientY - pos.y;\r\n\t\t\t\tstate.width = state.element.offsetWidth;\r\n\t\t\t\tstate.height = state.element.offsetHeight;\r\n\r\n\t\t\t\t$(state.clone).css({\r\n\t\t\t\t\twidth: state.width,\r\n\t\t\t\t\theight: state.height\r\n\t\t\t\t}).removeAttr('data-mce-selected');\r\n\r\n\t\t\t\tstate.ghost = $('<div>').css({\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\topacity: 0.5,\r\n\t\t\t\t\toverflow: 'hidden',\r\n\t\t\t\t\twidth: state.width,\r\n\t\t\t\t\theight: state.height\r\n\t\t\t\t}).attr({\r\n\t\t\t\t\t'data-mce-bogus': 'all',\r\n\t\t\t\t\tunselectable: 'on',\r\n\t\t\t\t\tcontenteditable: 'false'\r\n\t\t\t\t}).addClass('mce-drag-container mce-reset').\r\n\t\t\t\t\tappend(state.clone).\r\n\t\t\t\t\tappendTo(editor.getBody())[0];\r\n\r\n\t\t\t\tviewPort = editor.dom.getViewPort(editor.getWin());\r\n\t\t\t\tstate.maxX = viewPort.w;\r\n\t\t\t\tstate.maxY = viewPort.h;\r\n\t\t\t}\r\n\r\n\t\t\tif (state.dragging) {\r\n\t\t\t\teditor._selectionOverrides.hideFakeCaret();\r\n\t\t\t\teditor.selection.placeCaretAt(e.clientX, e.clientY);\r\n\r\n\t\t\t\tclientX = state.clientX + deltaX - state.relX;\r\n\t\t\t\tclientY = state.clientY + deltaY + 5;\r\n\r\n\t\t\t\tif (clientX + state.width > state.maxX) {\r\n\t\t\t\t\toverflowX = (clientX + state.width) - state.maxX;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (clientY + state.height > state.maxY) {\r\n\t\t\t\t\toverflowY = (clientY + state.height) - state.maxY;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (editor.getBody().nodeName != 'BODY') {\r\n\t\t\t\t\trootClientRect = editor.getBody().getBoundingClientRect();\r\n\t\t\t\t} else {\r\n\t\t\t\t\trootClientRect = {left: 0, top: 0};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(state.ghost).css({\r\n\t\t\t\t\tleft: clientX - rootClientRect.left,\r\n\t\t\t\t\ttop: clientY - rootClientRect.top,\r\n\t\t\t\t\twidth: state.width - overflowX,\r\n\t\t\t\t\theight: state.height - overflowY\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction drop(evt) {\r\n\t\t\tvar dropEvt;\r\n\r\n\t\t\tif (state.dragging) {\r\n\t\t\t\t// Hack for IE since it doesn't sync W3C Range with IE Specific range\r\n\t\t\t\teditor.selection.setRng(editor.selection.getSel().getRangeAt(0));\r\n\r\n\t\t\t\tif (isValidDropTarget(editor.selection.getNode())) {\r\n\t\t\t\t\tvar targetClone = state.element;\r\n\r\n\t\t\t\t\t// Pass along clientX, clientY if we have them\r\n\t\t\t\t\tdropEvt = editor.fire('drop', {\r\n\t\t\t\t\t\ttargetClone: targetClone,\r\n\t\t\t\t\t\tclientX: evt.clientX,\r\n\t\t\t\t\t\tclientY: evt.clientY\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (dropEvt.isDefaultPrevented()) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttargetClone = dropEvt.targetClone;\r\n\r\n\t\t\t\t\teditor.undoManager.transact(function() {\r\n\t\t\t\t\t\teditor.insertContent(dom.getOuterHTML(targetClone));\r\n\t\t\t\t\t\t$(state.element).remove();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstop();\r\n\t\t}\r\n\r\n\t\tfunction start(e) {\r\n\t\t\tvar ceElm, evt;\r\n\r\n\t\t\tstop();\r\n\r\n\t\t\tif (e.button !== 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tceElm = Arr.find(editor.dom.getParents(e.target), Fun.or(isContentEditableFalse, isContentEditableTrue));\r\n\r\n\t\t\tif (isDraggable(ceElm)) {\r\n\t\t\t\tevt = editor.fire('dragstart', {target: ceElm});\r\n\t\t\t\tif (evt.isDefaultPrevented()) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teditor.on('mousemove', move);\r\n\t\t\t\teditor.on('mouseup', drop);\r\n\r\n\t\t\t\tif (rootDocument != editableDoc) {\r\n\t\t\t\t\tdom.bind(rootDocument, 'mousemove', move);\r\n\t\t\t\t\tdom.bind(rootDocument, 'mouseup', drop);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate = {\r\n\t\t\t\t\tscreenX: e.screenX,\r\n\t\t\t\t\tscreenY: e.screenY,\r\n\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t\telement: ceElm\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction stop() {\r\n\t\t\t$(state.ghost).remove();\r\n\t\t\tsetBodyCursor(null);\r\n\r\n\t\t\teditor.off('mousemove', move);\r\n\t\t\teditor.off('mouseup', stop);\r\n\r\n\t\t\tif (rootDocument != editableDoc) {\r\n\t\t\t\tdom.unbind(rootDocument, 'mousemove', move);\r\n\t\t\t\tdom.unbind(rootDocument, 'mouseup', stop);\r\n\t\t\t}\r\n\r\n\t\t\tstate = {};\r\n\t\t}\r\n\r\n\t\teditor.on('mousedown', start);\r\n\r\n\t\t// Blocks drop inside cE=false on IE\r\n\t\teditor.on('drop', function(e) {\r\n\t\t\t// FF doesn't pass out clientX/clientY for drop since this is for IE we just use null instead\r\n\t\t\tvar realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\r\n\r\n\t\t\tif (isContentEditableFalse(realTarget) || isContentEditableFalse(editor.dom.getContentEditableParent(realTarget))) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn {\r\n\t\tinit: init\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/SelectionOverrides.js\r\n\r\n/**\r\n * SelectionOverrides.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This module contains logic overriding the selection with keyboard/mouse\r\n * around contentEditable=false regions.\r\n *\r\n * @example\r\n * // Disable the default cE=false selection\r\n * tinymce.activeEditor.on('ShowCaret BeforeObjectSelected', function(e) {\r\n *     e.preventDefault();\r\n * });\r\n *\r\n * @private\r\n * @class tinymce.SelectionOverrides\r\n */\r\ndefine(\"tinymce/SelectionOverrides\", [\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/caret/CaretWalker\",\r\n\t\"tinymce/caret/CaretPosition\",\r\n\t\"tinymce/caret/CaretContainer\",\r\n\t\"tinymce/caret/CaretUtils\",\r\n\t\"tinymce/caret/FakeCaret\",\r\n\t\"tinymce/caret/LineWalker\",\r\n\t\"tinymce/caret/LineUtils\",\r\n\t\"tinymce/dom/NodeType\",\r\n\t\"tinymce/dom/RangeUtils\",\r\n\t\"tinymce/geom/ClientRect\",\r\n\t\"tinymce/util/VK\",\r\n\t\"tinymce/util/Fun\",\r\n\t\"tinymce/util/Arr\",\r\n\t\"tinymce/util/Delay\",\r\n\t\"tinymce/DragDropOverrides\",\r\n\t\"tinymce/text/Zwsp\"\r\n], function(\r\n\tEnv, CaretWalker, CaretPosition, CaretContainer, CaretUtils, FakeCaret, LineWalker,\r\n\tLineUtils, NodeType, RangeUtils, ClientRect, VK, Fun, Arr, Delay, DragDropOverrides, Zwsp\r\n) {\r\n\tvar curry = Fun.curry,\r\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue,\r\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\r\n\t\tisElement = NodeType.isElement,\r\n\t\tisAfterContentEditableFalse = CaretUtils.isAfterContentEditableFalse,\r\n\t\tisBeforeContentEditableFalse = CaretUtils.isBeforeContentEditableFalse,\r\n\t\tgetSelectedNode = RangeUtils.getSelectedNode;\r\n\r\n\tfunction getVisualCaretPosition(walkFn, caretPosition) {\r\n\t\twhile ((caretPosition = walkFn(caretPosition))) {\r\n\t\t\tif (caretPosition.isVisible()) {\r\n\t\t\t\treturn caretPosition;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn caretPosition;\r\n\t}\r\n\r\n\tfunction SelectionOverrides(editor) {\r\n\t\tvar rootNode = editor.getBody(), caretWalker = new CaretWalker(rootNode);\r\n\t\tvar getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\r\n\t\tvar getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev),\r\n\t\t\tfakeCaret = new FakeCaret(editor.getBody(), isBlock),\r\n\t\t\trealSelectionId = 'sel-' + editor.dom.uniqueId(),\r\n\t\t\tselectedContentEditableNode, $ = editor.$;\r\n\r\n\t\tfunction isBlock(node) {\r\n\t\t\treturn editor.dom.isBlock(node);\r\n\t\t}\r\n\r\n\t\tfunction setRange(range) {\r\n\t\t\t//console.log('setRange', range);\r\n\t\t\tif (range) {\r\n\t\t\t\teditor.selection.setRng(range);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getRange() {\r\n\t\t\treturn editor.selection.getRng();\r\n\t\t}\r\n\r\n\t\tfunction scrollIntoView(node, alignToTop) {\r\n\t\t\teditor.selection.scrollIntoView(node, alignToTop);\r\n\t\t}\r\n\r\n\t\tfunction showCaret(direction, node, before) {\r\n\t\t\tvar e;\r\n\r\n\t\t\te = editor.fire('ShowCaret', {\r\n\t\t\t\ttarget: node,\r\n\t\t\t\tdirection: direction,\r\n\t\t\t\tbefore: before\r\n\t\t\t});\r\n\r\n\t\t\tif (e.isDefaultPrevented()) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tscrollIntoView(node, direction === -1);\r\n\r\n\t\t\treturn fakeCaret.show(before, node);\r\n\t\t}\r\n\r\n\t\tfunction selectNode(node) {\r\n\t\t\tvar e;\r\n\r\n\t\t\tfakeCaret.hide();\r\n\r\n\t\t\te = editor.fire('BeforeObjectSelected', {target: node});\r\n\t\t\tif (e.isDefaultPrevented()) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn getNodeRange(node);\r\n\t\t}\r\n\r\n\t\tfunction getNodeRange(node) {\r\n\t\t\tvar rng = node.ownerDocument.createRange();\r\n\r\n\t\t\trng.selectNode(node);\r\n\r\n\t\t\treturn rng;\r\n\t\t}\r\n\r\n\t\tfunction isMoveInsideSameBlock(fromCaretPosition, toCaretPosition) {\r\n\t\t\tvar inSameBlock = CaretUtils.isInSameBlock(fromCaretPosition, toCaretPosition);\r\n\r\n\t\t\t// Handle bogus BR <p>abc|<br></p>\r\n\t\t\tif (!inSameBlock && NodeType.isBr(fromCaretPosition.getNode())) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn inSameBlock;\r\n\t\t}\r\n\r\n\t\tfunction getNormalizedRangeEndPoint(direction, range) {\r\n\t\t\trange = CaretUtils.normalizeRange(direction, rootNode, range);\r\n\r\n\t\t\tif (direction == -1) {\r\n\t\t\t\treturn CaretPosition.fromRangeStart(range);\r\n\t\t\t}\r\n\r\n\t\t\treturn CaretPosition.fromRangeEnd(range);\r\n\t\t}\r\n\r\n\t\tfunction isRangeInCaretContainerBlock(range) {\r\n\t\t\treturn CaretContainer.isCaretContainerBlock(range.startContainer);\r\n\t\t}\r\n\r\n\t\tfunction moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\r\n\t\t\tvar node, caretPosition, peekCaretPosition, rangeIsInContainerBlock;\r\n\r\n\t\t\tif (!range.collapsed) {\r\n\t\t\t\tnode = getSelectedNode(range);\r\n\t\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\t\treturn showCaret(direction, node, direction == -1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\trangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\r\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\r\n\r\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\r\n\t\t\t\treturn selectNode(caretPosition.getNode(direction == -1));\r\n\t\t\t}\r\n\r\n\t\t\tcaretPosition = getNextPosFn(caretPosition);\r\n\t\t\tif (!caretPosition) {\r\n\t\t\t\tif (rangeIsInContainerBlock) {\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\r\n\t\t\t\treturn showCaret(direction, caretPosition.getNode(direction == -1), direction == 1);\r\n\t\t\t}\r\n\r\n\t\t\t// Peek ahead for handling of ab|c<span cE=false> -> abc|<span cE=false>\r\n\t\t\tpeekCaretPosition = getNextPosFn(caretPosition);\r\n\t\t\tif (isBeforeContentEditableFalseFn(peekCaretPosition)) {\r\n\t\t\t\tif (isMoveInsideSameBlock(caretPosition, peekCaretPosition)) {\r\n\t\t\t\t\treturn showCaret(direction, peekCaretPosition.getNode(direction == -1), direction == 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (rangeIsInContainerBlock) {\r\n\t\t\t\treturn renderRangeCaret(caretPosition.toRange());\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction moveToCeFalseVertically(direction, walkerFn, range) {\r\n\t\t\tvar caretPosition, linePositions, nextLinePositions,\r\n\t\t\t\tclosestNextLineRect, caretClientRect, clientX,\r\n\t\t\t\tdist1, dist2, contentEditableFalseNode;\r\n\r\n\t\t\tcontentEditableFalseNode = getSelectedNode(range);\r\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\r\n\t\t\tlinePositions = walkerFn(rootNode, LineWalker.isAboveLine(1), caretPosition);\r\n\t\t\tnextLinePositions = Arr.filter(linePositions, LineWalker.isLine(1));\r\n\t\t\tcaretClientRect = Arr.last(caretPosition.getClientRects());\r\n\r\n\t\t\tif (isBeforeContentEditableFalse(caretPosition)) {\r\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode();\r\n\t\t\t}\r\n\r\n\t\t\tif (isAfterContentEditableFalse(caretPosition)) {\r\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode(true);\r\n\t\t\t}\r\n\r\n\t\t\tif (!caretClientRect) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tclientX = caretClientRect.left;\r\n\r\n\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(nextLinePositions, clientX);\r\n\t\t\tif (closestNextLineRect) {\r\n\t\t\t\tif (isContentEditableFalse(closestNextLineRect.node)) {\r\n\t\t\t\t\tdist1 = Math.abs(clientX - closestNextLineRect.left);\r\n\t\t\t\t\tdist2 = Math.abs(clientX - closestNextLineRect.right);\r\n\r\n\t\t\t\t\treturn showCaret(direction, closestNextLineRect.node, dist1 < dist2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (contentEditableFalseNode) {\r\n\t\t\t\tvar caretPositions = LineWalker.positionsUntil(direction, rootNode, LineWalker.isAboveLine(1), contentEditableFalseNode);\r\n\r\n\t\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(Arr.filter(caretPositions, LineWalker.isLine(1)), clientX);\r\n\t\t\t\tif (closestNextLineRect) {\r\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclosestNextLineRect = Arr.last(Arr.filter(caretPositions, LineWalker.isLine(0)));\r\n\t\t\t\tif (closestNextLineRect) {\r\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction exitPreBlock(direction, range) {\r\n\t\t\tvar pre, caretPos, newBlock;\r\n\r\n\t\t\tfunction createTextBlock() {\r\n\t\t\t\tvar textBlock = editor.dom.create(editor.settings.forced_root_block);\r\n\r\n\t\t\t\tif (!Env.ie || Env.ie >= 11) {\r\n\t\t\t\t\ttextBlock.innerHTML = '<br data-mce-bogus=\"1\">';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn textBlock;\r\n\t\t\t}\r\n\r\n\t\t\tif (range.collapsed && editor.settings.forced_root_block) {\r\n\t\t\t\tpre = editor.dom.getParent(range.startContainer, 'PRE');\r\n\t\t\t\tif (!pre) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (direction == 1) {\r\n\t\t\t\t\tcaretPos = getNextVisualCaretPosition(CaretPosition.fromRangeStart(range));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcaretPos = getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!caretPos) {\r\n\t\t\t\t\tnewBlock = createTextBlock();\r\n\r\n\t\t\t\t\tif (direction == 1) {\r\n\t\t\t\t\t\teditor.$(pre).after(newBlock);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\teditor.$(pre).before(newBlock);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teditor.selection.select(newBlock, true);\r\n\t\t\t\t\teditor.selection.collapse();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction moveH(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\r\n\t\t\tvar newRange;\r\n\r\n\t\t\tnewRange = moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range);\r\n\t\t\tif (newRange) {\r\n\t\t\t\treturn newRange;\r\n\t\t\t}\r\n\r\n\t\t\tnewRange = exitPreBlock(direction, range);\r\n\t\t\tif (newRange) {\r\n\t\t\t\treturn newRange;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction moveV(direction, walkerFn, range) {\r\n\t\t\tvar newRange;\r\n\r\n\t\t\tnewRange = moveToCeFalseVertically(direction, walkerFn, range);\r\n\t\t\tif (newRange) {\r\n\t\t\t\treturn newRange;\r\n\t\t\t}\r\n\r\n\t\t\tnewRange = exitPreBlock(direction, range);\r\n\t\t\tif (newRange) {\r\n\t\t\t\treturn newRange;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction getBlockCaretContainer() {\r\n\t\t\treturn $('*[data-mce-caret]')[0];\r\n\t\t}\r\n\r\n\t\tfunction showBlockCaretContainer(blockCaretContainer) {\r\n\t\t\tblockCaretContainer = $(blockCaretContainer);\r\n\r\n\t\t\tif (blockCaretContainer.attr('data-mce-caret')) {\r\n\t\t\t\tfakeCaret.hide();\r\n\t\t\t\tblockCaretContainer.removeAttr('data-mce-caret');\r\n\t\t\t\tblockCaretContainer.removeAttr('data-mce-bogus');\r\n\t\t\t\tblockCaretContainer.removeAttr('style');\r\n\r\n\t\t\t\t// Removes control rect on IE\r\n\t\t\t\tsetRange(getRange());\r\n\t\t\t\tscrollIntoView(blockCaretContainer[0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction renderCaretAtRange(range) {\r\n\t\t\tvar caretPosition, ceRoot;\r\n\r\n\t\t\trange = CaretUtils.normalizeRange(1, rootNode, range);\r\n\t\t\tcaretPosition = CaretPosition.fromRangeStart(range);\r\n\r\n\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\r\n\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\r\n\t\t\t}\r\n\r\n\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\r\n\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: Should render caret before/after depending on where you click on the page forces after now\r\n\t\t\tceRoot = editor.dom.getParent(caretPosition.getNode(), Fun.or(isContentEditableFalse, isContentEditableTrue));\r\n\t\t\tif (isContentEditableFalse(ceRoot)) {\r\n\t\t\t\treturn showCaret(1, ceRoot, false);\r\n\t\t\t}\r\n\r\n\t\t\tfakeCaret.hide();\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction renderRangeCaret(range) {\r\n\t\t\tvar caretRange;\r\n\r\n\t\t\tif (!range || !range.collapsed) {\r\n\t\t\t\treturn range;\r\n\t\t\t}\r\n\r\n\t\t\tcaretRange = renderCaretAtRange(range);\r\n\t\t\tif (caretRange) {\r\n\t\t\t\treturn caretRange;\r\n\t\t\t}\r\n\r\n\t\t\treturn range;\r\n\t\t}\r\n\r\n\t\tfunction deleteContentEditableNode(node) {\r\n\t\t\tvar nextCaretPosition, prevCaretPosition, prevCeFalseElm, nextElement;\r\n\r\n\t\t\tif (!isContentEditableFalse(node)) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (isContentEditableFalse(node.previousSibling)) {\r\n\t\t\t\tprevCeFalseElm = node.previousSibling;\r\n\t\t\t}\r\n\r\n\t\t\tprevCaretPosition = getPrevVisualCaretPosition(CaretPosition.before(node));\r\n\t\t\tif (!prevCaretPosition) {\r\n\t\t\t\tnextCaretPosition = getNextVisualCaretPosition(CaretPosition.after(node));\r\n\t\t\t}\r\n\r\n\t\t\tif (nextCaretPosition && isElement(nextCaretPosition.getNode())) {\r\n\t\t\t\tnextElement = nextCaretPosition.getNode();\r\n\t\t\t}\r\n\r\n\t\t\tCaretContainer.remove(node.previousSibling);\r\n\t\t\tCaretContainer.remove(node.nextSibling);\r\n\t\t\teditor.dom.remove(node);\r\n\t\t\tclearContentEditableSelection();\r\n\r\n\t\t\tif (editor.dom.isEmpty(editor.getBody())) {\r\n\t\t\t\teditor.setContent('');\r\n\t\t\t\teditor.focus();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (prevCeFalseElm) {\r\n\t\t\t\treturn CaretPosition.after(prevCeFalseElm).toRange();\r\n\t\t\t}\r\n\r\n\t\t\tif (nextElement) {\r\n\t\t\t\treturn CaretPosition.before(nextElement).toRange();\r\n\t\t\t}\r\n\r\n\t\t\tif (prevCaretPosition) {\r\n\t\t\t\treturn prevCaretPosition.toRange();\r\n\t\t\t}\r\n\r\n\t\t\tif (nextCaretPosition) {\r\n\t\t\t\treturn nextCaretPosition.toRange();\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction mergeTextBlocks(direction, fromCaretPosition, toCaretPosition) {\r\n\t\t\tvar dom = editor.dom, fromBlock, toBlock, node, textBlocks;\r\n\r\n\t\t\tif (direction === -1) {\r\n\t\t\t\tif (isAfterContentEditableFalse(toCaretPosition) && isBlock(toCaretPosition.getNode(true))) {\r\n\t\t\t\t\treturn deleteContentEditableNode(toCaretPosition.getNode(true));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (isBeforeContentEditableFalse(fromCaretPosition) && isBlock(fromCaretPosition.getNode())) {\r\n\t\t\t\t\treturn deleteContentEditableNode(fromCaretPosition.getNode());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttextBlocks = editor.schema.getTextBlockElements();\r\n\t\t\tfromBlock = dom.getParent(fromCaretPosition.getNode(), dom.isBlock);\r\n\t\t\ttoBlock = dom.getParent(toCaretPosition.getNode(), dom.isBlock);\r\n\r\n\t\t\t// Verify that both blocks are text blocks\r\n\t\t\tif (fromBlock === toBlock || !textBlocks[fromBlock.nodeName] || !textBlocks[toBlock.nodeName]) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\twhile ((node = fromBlock.firstChild)) {\r\n\t\t\t\ttoBlock.appendChild(node);\r\n\t\t\t}\r\n\r\n\t\t\teditor.dom.remove(fromBlock);\r\n\r\n\t\t\treturn toCaretPosition.toRange();\r\n\t\t}\r\n\r\n\t\tfunction backspaceDelete(direction, beforeFn, afterFn, range) {\r\n\t\t\tvar node, caretPosition, peekCaretPosition, newCaretPosition;\r\n\r\n\t\t\tif (!range.collapsed) {\r\n\t\t\t\tnode = getSelectedNode(range);\r\n\t\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(node));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\r\n\r\n\t\t\tif (afterFn(caretPosition) && CaretContainer.isCaretContainerBlock(range.startContainer)) {\r\n\t\t\t\tnewCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\r\n\t\t\t\treturn newCaretPosition ? renderRangeCaret(newCaretPosition.toRange()) : range;\r\n\t\t\t}\r\n\r\n\t\t\tif (beforeFn(caretPosition)) {\r\n\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(caretPosition.getNode(direction == -1)));\r\n\t\t\t}\r\n\r\n\t\t\tpeekCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\r\n\t\t\tif (beforeFn(peekCaretPosition)) {\r\n\t\t\t\tif (direction === -1) {\r\n\t\t\t\t\treturn mergeTextBlocks(direction, caretPosition, peekCaretPosition);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn mergeTextBlocks(direction, peekCaretPosition, caretPosition);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction registerEvents() {\r\n\t\t\tvar right = curry(moveH, 1, getNextVisualCaretPosition, isBeforeContentEditableFalse);\r\n\t\t\tvar left = curry(moveH, -1, getPrevVisualCaretPosition, isAfterContentEditableFalse);\r\n\t\t\tvar deleteForward = curry(backspaceDelete, 1, isBeforeContentEditableFalse, isAfterContentEditableFalse);\r\n\t\t\tvar backspace = curry(backspaceDelete, -1, isAfterContentEditableFalse, isBeforeContentEditableFalse);\r\n\t\t\tvar up = curry(moveV, -1, LineWalker.upUntil);\r\n\t\t\tvar down = curry(moveV, 1, LineWalker.downUntil);\r\n\r\n\t\t\tfunction override(evt, moveFn) {\r\n\t\t\t\tvar range = moveFn(getRange());\r\n\r\n\t\t\t\tif (range && !evt.isDefaultPrevented()) {\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\tsetRange(range);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction getContentEditableRoot(node) {\r\n\t\t\t\tvar root = editor.getBody();\r\n\r\n\t\t\t\twhile (node && node != root) {\r\n\t\t\t\t\tif (isContentEditableTrue(node) || isContentEditableFalse(node)) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tfunction isXYWithinRange(clientX, clientY, range) {\r\n\t\t\t\tif (range.collapsed) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Arr.reduce(range.getClientRects(), function(state, rect) {\r\n\t\t\t\t\treturn state || ClientRect.containsXY(rect, clientX, clientY);\r\n\t\t\t\t}, false);\r\n\t\t\t}\r\n\r\n\t\t\t// Some browsers (Chrome) lets you place the caret after a cE=false\r\n\t\t\t// Make sure we render the caret container in this case\r\n\t\t\teditor.on('mouseup', function() {\r\n\t\t\t\tvar range = getRange();\r\n\r\n\t\t\t\tif (range.collapsed) {\r\n\t\t\t\t\tsetRange(renderCaretAtRange(range));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('click', function(e) {\r\n\t\t\t\tvar contentEditableRoot;\r\n\r\n\t\t\t\t// Prevent clicks on links in a cE=false element\r\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\r\n\t\t\t\tif (contentEditableRoot) {\r\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar hasNormalCaretPosition = function (elm) {\r\n\t\t\t\tvar caretWalker = new CaretWalker(elm);\r\n\r\n\t\t\t\tif (!elm.firstChild) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar startPos = CaretPosition.before(elm.firstChild);\r\n\t\t\t\tvar newPos = caretWalker.next(startPos);\r\n\r\n\t\t\t\treturn newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);\r\n\t\t\t};\r\n\r\n\t\t\tvar isInSameBlock = function (node1, node2) {\r\n\t\t\t\tvar block1 = editor.dom.getParent(node1, editor.dom.isBlock);\r\n\t\t\t\tvar block2 = editor.dom.getParent(node2, editor.dom.isBlock);\r\n\t\t\t\treturn block1 === block2;\r\n\t\t\t};\r\n\r\n\t\t\t// Checks if the target node is in a block and if that block has a caret position better than the\r\n\t\t\t// suggested caretNode this is to prevent the caret from being sucked in towards a cE=false block if\r\n\t\t\t// they are adjacent on the vertical axis\r\n\t\t\tvar hasBetterMouseTarget = function (targetNode, caretNode) {\r\n\t\t\t\tvar targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);\r\n\t\t\t\tvar caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);\r\n\r\n\t\t\t\treturn targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\r\n\t\t\t};\r\n\r\n\t\t\teditor.on('mousedown', function(e) {\r\n\t\t\t\tvar contentEditableRoot;\r\n\r\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\r\n\t\t\t\tif (contentEditableRoot) {\r\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tsetContentEditableSelection(selectNode(contentEditableRoot));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tclearContentEditableSelection();\r\n\r\n\t\t\t\t\t\tif (!isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {\r\n\t\t\t\t\t\t\teditor.selection.placeCaretAt(e.clientX, e.clientY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclearContentEditableSelection();\r\n\t\t\t\t\tfakeCaret.hide();\r\n\r\n\t\t\t\t\tvar caretInfo = LineUtils.closestCaret(rootNode, e.clientX, e.clientY);\r\n\t\t\t\t\tif (caretInfo) {\r\n\t\t\t\t\t\tif (!hasBetterMouseTarget(e.target, caretInfo.node)) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\teditor.getBody().focus();\r\n\t\t\t\t\t\t\tsetRange(showCaret(1, caretInfo.node, caretInfo.before));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('keydown', function(e) {\r\n\t\t\t\tif (VK.modifierPressed(e)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (e.keyCode) {\r\n\t\t\t\t\tcase VK.RIGHT:\r\n\t\t\t\t\t\toverride(e, right);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase VK.DOWN:\r\n\t\t\t\t\t\toverride(e, down);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase VK.LEFT:\r\n\t\t\t\t\t\toverride(e, left);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase VK.UP:\r\n\t\t\t\t\t\toverride(e, up);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase VK.DELETE:\r\n\t\t\t\t\t\toverride(e, deleteForward);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase VK.BACKSPACE:\r\n\t\t\t\t\t\toverride(e, backspace);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (isContentEditableFalse(editor.selection.getNode())) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfunction paddEmptyContentEditableArea() {\r\n\t\t\t\tvar br, ceRoot = getContentEditableRoot(editor.selection.getNode());\r\n\r\n\t\t\t\tif (isContentEditableTrue(ceRoot) && isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {\r\n\t\t\t\t\tbr = editor.dom.create('br', {\"data-mce-bogus\": \"1\"});\r\n\t\t\t\t\teditor.$(ceRoot).empty().append(br);\r\n\t\t\t\t\teditor.selection.setRng(CaretPosition.before(br).toRange());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleBlockContainer(e) {\r\n\t\t\t\tvar blockCaretContainer = getBlockCaretContainer();\r\n\r\n\t\t\t\tif (!blockCaretContainer) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (e.type == 'compositionstart') {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (blockCaretContainer.innerHTML != '&nbsp;') {\r\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleEmptyBackspaceDelete(e) {\r\n\t\t\t\tvar prevent;\r\n\r\n\t\t\t\tswitch (e.keyCode) {\r\n\t\t\t\t\tcase VK.DELETE:\r\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase VK.BACKSPACE:\r\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (prevent) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Must be added to \"top\" since undoManager needs to be executed after\r\n\t\t\teditor.on('keyup compositionstart', function(e) {\r\n\t\t\t\thandleBlockContainer(e);\r\n\t\t\t\thandleEmptyBackspaceDelete(e);\r\n\t\t\t}, true);\r\n\r\n\t\t\teditor.on('cut', function() {\r\n\t\t\t\tvar node = editor.selection.getNode();\r\n\r\n\t\t\t\tif (isContentEditableFalse(node)) {\r\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\t\tsetRange(renderRangeCaret(deleteContentEditableNode(node)));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('getSelectionRange', function(e) {\r\n\t\t\t\tvar rng = e.range;\r\n\r\n\t\t\t\tif (selectedContentEditableNode) {\r\n\t\t\t\t\tif (!selectedContentEditableNode.parentNode) {\r\n\t\t\t\t\t\tselectedContentEditableNode = null;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trng = rng.cloneRange();\r\n\t\t\t\t\trng.selectNode(selectedContentEditableNode);\r\n\t\t\t\t\te.range = rng;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('setSelectionRange', function(e) {\r\n\t\t\t\tvar rng;\r\n\r\n\t\t\t\trng = setContentEditableSelection(e.range);\r\n\t\t\t\tif (rng) {\r\n\t\t\t\t\te.range = rng;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('focus', function() {\r\n\t\t\t\t// Make sure we have a proper fake caret on focus\r\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\teditor.selection.setRng(renderRangeCaret(editor.selection.getRng()));\r\n\t\t\t\t}, 0);\r\n\t\t\t});\r\n\r\n\t\t\tDragDropOverrides.init(editor);\r\n\t\t}\r\n\r\n\t\tfunction addCss() {\r\n\t\t\tvar styles = editor.contentStyles, rootClass = '.mce-content-body';\r\n\r\n\t\t\tstyles.push(fakeCaret.getCss());\r\n\t\t\tstyles.push(\r\n\t\t\t\trootClass + ' .mce-offscreen-selection {' +\r\n\t\t\t\t\t'position: absolute;' +\r\n\t\t\t\t\t'left: -9999999999px;' +\r\n\t\t\t\t\t'width: 100px;' +\r\n\t\t\t\t\t'height: 100px;' +\r\n\t\t\t\t'}' +\r\n\t\t\t\trootClass + ' *[contentEditable=false] {' +\r\n\t\t\t\t\t'cursor: default;' +\r\n\t\t\t\t'}' +\r\n\t\t\t\trootClass + ' *[contentEditable=true] {' +\r\n\t\t\t\t\t'cursor: text;' +\r\n\t\t\t\t'}'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tfunction isRangeInCaretContainer(rng) {\r\n\t\t\treturn CaretContainer.isCaretContainer(rng.startContainer) || CaretContainer.isCaretContainer(rng.endContainer);\r\n\t\t}\r\n\r\n\t\tfunction setContentEditableSelection(range) {\r\n\t\t\tvar node, $ = editor.$, dom = editor.dom, $realSelectionContainer, sel,\r\n\t\t\t\tstartContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;\r\n\r\n\t\t\tif (!range) {\r\n\t\t\t\tclearContentEditableSelection();\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (range.collapsed) {\r\n\t\t\t\tclearContentEditableSelection();\r\n\r\n\t\t\t\tif (!isRangeInCaretContainer(range)) {\r\n\t\t\t\t\tcaretPosition = getNormalizedRangeEndPoint(1, range);\r\n\r\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\r\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\r\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tstartContainer = range.startContainer;\r\n\t\t\tstartOffset = range.startOffset;\r\n\t\t\tendOffset = range.endOffset;\r\n\r\n\t\t\t// Normalizes <span cE=false>[</span>] to [<span cE=false></span>]\r\n\t\t\tif (startContainer.nodeType == 3 && startOffset == 0 && isContentEditableFalse(startContainer.parentNode)) {\r\n\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\r\n\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tif (startContainer.nodeType != 1) {\r\n\t\t\t\tclearContentEditableSelection();\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (endOffset == startOffset + 1) {\r\n\t\t\t\tnode = startContainer.childNodes[startOffset];\r\n\t\t\t}\r\n\r\n\t\t\tif (!isContentEditableFalse(node)) {\r\n\t\t\t\tclearContentEditableSelection();\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\ttargetClone = origTargetClone = node.cloneNode(true);\r\n\t\t\te = editor.fire('ObjectSelected', {target: node, targetClone: targetClone});\r\n\t\t\tif (e.isDefaultPrevented()) {\r\n\t\t\t\tclearContentEditableSelection();\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\ttargetClone = e.targetClone;\r\n\t\t\t$realSelectionContainer = $('#' + realSelectionId);\r\n\t\t\tif ($realSelectionContainer.length === 0) {\r\n\t\t\t\t$realSelectionContainer = $(\r\n\t\t\t\t\t'<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>'\r\n\t\t\t\t).attr('id', realSelectionId);\r\n\r\n\t\t\t\t$realSelectionContainer.appendTo(editor.getBody());\r\n\t\t\t}\r\n\r\n\t\t\trange = editor.dom.createRng();\r\n\r\n\t\t\t// WHY is IE making things so hard! Copy on <i contentEditable=\"false\">x</i> produces: <em>x</em>\r\n\t\t\tif (targetClone === origTargetClone && Env.ie) {\r\n\t\t\t\t$realSelectionContainer.empty().append(Zwsp.ZWSP).append(targetClone).append(Zwsp.ZWSP);\r\n\t\t\t\trange.setStart($realSelectionContainer[0].firstChild, 0);\r\n\t\t\t\trange.setEnd($realSelectionContainer[0].lastChild, 1);\r\n\t\t\t} else {\r\n\t\t\t\t$realSelectionContainer.empty().append('\\u00a0').append(targetClone).append('\\u00a0');\r\n\t\t\t\trange.setStart($realSelectionContainer[0].firstChild, 1);\r\n\t\t\t\trange.setEnd($realSelectionContainer[0].lastChild, 0);\r\n\t\t\t}\r\n\r\n\t\t\t$realSelectionContainer.css({\r\n\t\t\t\ttop: dom.getPos(node, editor.getBody()).y\r\n\t\t\t});\r\n\r\n\t\t\t$realSelectionContainer[0].focus();\r\n\t\t\tsel = editor.selection.getSel();\r\n\t\t\tsel.removeAllRanges();\r\n\t\t\tsel.addRange(range);\r\n\r\n\t\t\teditor.$('*[data-mce-selected]').removeAttr('data-mce-selected');\r\n\t\t\tnode.setAttribute('data-mce-selected', 1);\r\n\t\t\tselectedContentEditableNode = node;\r\n\r\n\t\t\treturn range;\r\n\t\t}\r\n\r\n\t\tfunction clearContentEditableSelection() {\r\n\t\t\tif (selectedContentEditableNode) {\r\n\t\t\t\tselectedContentEditableNode.removeAttribute('data-mce-selected');\r\n\t\t\t\teditor.$('#' + realSelectionId).remove();\r\n\t\t\t\tselectedContentEditableNode = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction destroy() {\r\n\t\t\tfakeCaret.destroy();\r\n\t\t\tselectedContentEditableNode = null;\r\n\t\t}\r\n\r\n\t\tfunction hideFakeCaret() {\r\n\t\t\tfakeCaret.hide();\r\n\t\t}\r\n\r\n\t\tif (Env.ceFalse) {\r\n\t\t\tregisterEvents();\r\n\t\t\taddCss();\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tshowBlockCaretContainer: showBlockCaretContainer,\r\n\t\t\thideFakeCaret: hideFakeCaret,\r\n\t\t\tdestroy: destroy\r\n\t\t};\r\n\t}\r\n\r\n\treturn SelectionOverrides;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Uuid.js\r\n\r\n/**\r\n * Uuid.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Generates unique ids.\r\n *\r\n * @class tinymce.util.Uuid\r\n * @private\r\n */\r\ndefine(\"tinymce/util/Uuid\", [\r\n], function() {\r\n\tvar count = 0;\r\n\r\n\tvar seed = function () {\r\n\t\tvar rnd = function () {\r\n\t\t\treturn Math.round(Math.random() * 0xFFFFFFFF).toString(36);\r\n\t\t};\r\n\r\n\t\treturn 's' + Date.now().toString(36) + rnd() + rnd() + rnd();\r\n\t};\r\n\r\n\tvar uuid = function (prefix) {\r\n\t\treturn prefix + (count++) + seed();\r\n\t};\r\n\r\n\treturn {\r\n\t\tuuid: uuid\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/Editor.js\r\n\r\n/**\r\n * Editor.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*jshint scripturl:true */\r\n\r\n/**\r\n * Include the base event class documentation.\r\n *\r\n * @include ../../../tools/docs/tinymce.Event.js\r\n */\r\n\r\n/**\r\n * This class contains the core logic for a TinyMCE editor.\r\n *\r\n * @class tinymce.Editor\r\n * @mixes tinymce.util.Observable\r\n * @example\r\n * // Add a class to all paragraphs in the editor.\r\n * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\r\n *\r\n * // Gets the current editors selection as text\r\n * tinymce.activeEditor.selection.getContent({format: 'text'});\r\n *\r\n * // Creates a new editor instance\r\n * var ed = new tinymce.Editor('textareaid', {\r\n *     some_setting: 1\r\n * }, tinymce.EditorManager);\r\n *\r\n * // Select each item the user clicks on\r\n * ed.on('click', function(e) {\r\n *     ed.selection.select(e.target);\r\n * });\r\n *\r\n * ed.render();\r\n */\r\ndefine(\"tinymce/Editor\", [\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/AddOnManager\",\r\n\t\"tinymce/NodeChange\",\r\n\t\"tinymce/html/Node\",\r\n\t\"tinymce/dom/Serializer\",\r\n\t\"tinymce/html/Serializer\",\r\n\t\"tinymce/dom/Selection\",\r\n\t\"tinymce/Formatter\",\r\n\t\"tinymce/UndoManager\",\r\n\t\"tinymce/EnterKey\",\r\n\t\"tinymce/ForceBlocks\",\r\n\t\"tinymce/EditorCommands\",\r\n\t\"tinymce/util/URI\",\r\n\t\"tinymce/dom/ScriptLoader\",\r\n\t\"tinymce/dom/EventUtils\",\r\n\t\"tinymce/WindowManager\",\r\n\t\"tinymce/NotificationManager\",\r\n\t\"tinymce/html/Schema\",\r\n\t\"tinymce/html/DomParser\",\r\n\t\"tinymce/util/Quirks\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/util/Delay\",\r\n\t\"tinymce/EditorObservable\",\r\n\t\"tinymce/Mode\",\r\n\t\"tinymce/Shortcuts\",\r\n\t\"tinymce/EditorUpload\",\r\n\t\"tinymce/SelectionOverrides\",\r\n\t\"tinymce/util/Uuid\"\r\n], function(\r\n\tDOMUtils, DomQuery, AddOnManager, NodeChange, Node, DomSerializer, Serializer,\r\n\tSelection, Formatter, UndoManager, EnterKey, ForceBlocks, EditorCommands,\r\n\tURI, ScriptLoader, EventUtils, WindowManager, NotificationManager,\r\n\tSchema, DomParser, Quirks, Env, Tools, Delay, EditorObservable, Mode, Shortcuts, EditorUpload,\r\n\tSelectionOverrides, Uuid\r\n) {\r\n\t// Shorten these names\r\n\tvar DOM = DOMUtils.DOM, ThemeManager = AddOnManager.ThemeManager, PluginManager = AddOnManager.PluginManager;\r\n\tvar extend = Tools.extend, each = Tools.each, explode = Tools.explode;\r\n\tvar inArray = Tools.inArray, trim = Tools.trim, resolve = Tools.resolve;\r\n\tvar Event = EventUtils.Event;\r\n\tvar isGecko = Env.gecko, ie = Env.ie;\r\n\r\n\t/**\r\n\t * Include documentation for all the events.\r\n\t *\r\n\t * @include ../../../tools/docs/tinymce.Editor.js\r\n\t */\r\n\r\n\t/**\r\n\t * Constructs a editor instance by id.\r\n\t *\r\n\t * @constructor\r\n\t * @method Editor\r\n\t * @param {String} id Unique id for the editor.\r\n\t * @param {Object} settings Settings for the editor.\r\n\t * @param {tinymce.EditorManager} editorManager EditorManager instance.\r\n\t */\r\n\tfunction Editor(id, settings, editorManager) {\r\n\t\tvar self = this, documentBaseUrl, baseUri, defaultSettings;\r\n\r\n\t\tdocumentBaseUrl = self.documentBaseUrl = editorManager.documentBaseURL;\r\n\t\tbaseUri = editorManager.baseURI;\r\n\t\tdefaultSettings = editorManager.defaultSettings;\r\n\r\n\t\t/**\r\n\t\t * Name/value collection with editor settings.\r\n\t\t *\r\n\t\t * @property settings\r\n\t\t * @type Object\r\n\t\t * @example\r\n\t\t * // Get the value of the theme setting\r\n\t\t * tinymce.activeEditor.windowManager.alert(\"You are using the \" + tinymce.activeEditor.settings.theme + \" theme\");\r\n\t\t */\r\n\t\tsettings = extend({\r\n\t\t\tid: id,\r\n\t\t\ttheme: 'modern',\r\n\t\t\tdelta_width: 0,\r\n\t\t\tdelta_height: 0,\r\n\t\t\tpopup_css: '',\r\n\t\t\tplugins: '',\r\n\t\t\tdocument_base_url: documentBaseUrl,\r\n\t\t\tadd_form_submit_trigger: true,\r\n\t\t\tsubmit_patch: true,\r\n\t\t\tadd_unload_trigger: true,\r\n\t\t\tconvert_urls: true,\r\n\t\t\trelative_urls: true,\r\n\t\t\tremove_script_host: true,\r\n\t\t\tobject_resizing: true,\r\n\t\t\tdoctype: '<!DOCTYPE html>',\r\n\t\t\tvisual: true,\r\n\t\t\tfont_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',\r\n\r\n\t\t\t// See: http://www.w3.org/TR/CSS2/fonts.html#propdef-font-size\r\n\t\t\tfont_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\r\n\t\t\tforced_root_block: 'p',\r\n\t\t\thidden_input: true,\r\n\t\t\tpadd_empty_editor: true,\r\n\t\t\trender_ui: true,\r\n\t\t\tindentation: '30px',\r\n\t\t\tinline_styles: true,\r\n\t\t\tconvert_fonts_to_spans: true,\r\n\t\t\tindent: 'simple',\r\n\t\t\tindent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\r\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\r\n\t\t\tindent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\r\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\r\n\t\t\tvalidate: true,\r\n\t\t\tentity_encoding: 'named',\r\n\t\t\turl_converter: self.convertURL,\r\n\t\t\turl_converter_scope: self,\r\n\t\t\tie7_compat: true\r\n\t\t}, defaultSettings, settings);\r\n\r\n\t\t// Merge external_plugins\r\n\t\tif (defaultSettings && defaultSettings.external_plugins && settings.external_plugins) {\r\n\t\t\tsettings.external_plugins = extend({}, defaultSettings.external_plugins, settings.external_plugins);\r\n\t\t}\r\n\r\n\t\tself.settings = settings;\r\n\t\tAddOnManager.language = settings.language || 'en';\r\n\t\tAddOnManager.languageLoad = settings.language_load;\r\n\t\tAddOnManager.baseURL = editorManager.baseURL;\r\n\r\n\t\t/**\r\n\t\t * Editor instance id, normally the same as the div/textarea that was replaced.\r\n\t\t *\r\n\t\t * @property id\r\n\t\t * @type String\r\n\t\t */\r\n\t\tself.id = settings.id = id;\r\n\r\n\t\t/**\r\n\t\t * State to force the editor to return false on a isDirty call.\r\n\t\t *\r\n\t\t * @property isNotDirty\r\n\t\t * @type Boolean\r\n\t\t * @deprecated Use editor.setDirty instead.\r\n\t\t */\r\n\t\tself.setDirty(false);\r\n\r\n\t\t/**\r\n\t\t * Name/Value object containing plugin instances.\r\n\t\t *\r\n\t\t * @property plugins\r\n\t\t * @type Object\r\n\t\t * @example\r\n\t\t * // Execute a method inside a plugin directly\r\n\t\t * tinymce.activeEditor.plugins.someplugin.someMethod();\r\n\t\t */\r\n\t\tself.plugins = {};\r\n\r\n\t\t/**\r\n\t\t * URI object to document configured for the TinyMCE instance.\r\n\t\t *\r\n\t\t * @property documentBaseURI\r\n\t\t * @type tinymce.util.URI\r\n\t\t * @example\r\n\t\t * // Get relative URL from the location of document_base_url\r\n\t\t * tinymce.activeEditor.documentBaseURI.toRelative('/somedir/somefile.htm');\r\n\t\t *\r\n\t\t * // Get absolute URL from the location of document_base_url\r\n\t\t * tinymce.activeEditor.documentBaseURI.toAbsolute('somefile.htm');\r\n\t\t */\r\n\t\tself.documentBaseURI = new URI(settings.document_base_url || documentBaseUrl, {\r\n\t\t\tbase_uri: baseUri\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * URI object to current document that holds the TinyMCE editor instance.\r\n\t\t *\r\n\t\t * @property baseURI\r\n\t\t * @type tinymce.util.URI\r\n\t\t * @example\r\n\t\t * // Get relative URL from the location of the API\r\n\t\t * tinymce.activeEditor.baseURI.toRelative('/somedir/somefile.htm');\r\n\t\t *\r\n\t\t * // Get absolute URL from the location of the API\r\n\t\t * tinymce.activeEditor.baseURI.toAbsolute('somefile.htm');\r\n\t\t */\r\n\t\tself.baseURI = baseUri;\r\n\r\n\t\t/**\r\n\t\t * Array with CSS files to load into the iframe.\r\n\t\t *\r\n\t\t * @property contentCSS\r\n\t\t * @type Array\r\n\t\t */\r\n\t\tself.contentCSS = [];\r\n\r\n\t\t/**\r\n\t\t * Array of CSS styles to add to head of document when the editor loads.\r\n\t\t *\r\n\t\t * @property contentStyles\r\n\t\t * @type Array\r\n\t\t */\r\n\t\tself.contentStyles = [];\r\n\r\n\t\t// Creates all events like onClick, onSetContent etc see Editor.Events.js for the actual logic\r\n\t\tself.shortcuts = new Shortcuts(self);\r\n\t\tself.loadedCSS = {};\r\n\t\tself.editorCommands = new EditorCommands(self);\r\n\r\n\t\tif (settings.target) {\r\n\t\t\tself.targetElm = settings.target;\r\n\t\t}\r\n\r\n\t\tself.suffix = editorManager.suffix;\r\n\t\tself.editorManager = editorManager;\r\n\t\tself.inline = settings.inline;\r\n\t\tself.settings.content_editable = self.inline;\r\n\r\n\t\tif (settings.cache_suffix) {\r\n\t\t\tEnv.cacheSuffix = settings.cache_suffix.replace(/^[\\?\\&]+/, '');\r\n\t\t}\r\n\r\n\t\tif (settings.override_viewport === false) {\r\n\t\t\tEnv.overrideViewPort = false;\r\n\t\t}\r\n\r\n\t\t// Call setup\r\n\t\teditorManager.fire('SetupEditor', self);\r\n\t\tself.execCallback('setup', self);\r\n\r\n\t\t/**\r\n\t\t * Dom query instance with default scope to the editor document and default element is the body of the editor.\r\n\t\t *\r\n\t\t * @property $\r\n\t\t * @type tinymce.dom.DomQuery\r\n\t\t * @example\r\n\t\t * tinymce.activeEditor.$('p').css('color', 'red');\r\n\t\t * tinymce.activeEditor.$().append('<p>new</p>');\r\n\t\t */\r\n\t\tself.$ = DomQuery.overrideDefaults(function() {\r\n\t\t\treturn {\r\n\t\t\t\tcontext: self.inline ? self.getBody() : self.getDoc(),\r\n\t\t\t\telement: self.getBody()\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\r\n\tEditor.prototype = {\r\n\t\t/**\r\n\t\t * Renders the editor/adds it to the page.\r\n\t\t *\r\n\t\t * @method render\r\n\t\t */\r\n\t\trender: function() {\r\n\t\t\tvar self = this, settings = self.settings, id = self.id, suffix = self.suffix;\r\n\r\n\t\t\tfunction readyHandler() {\r\n\t\t\t\tDOM.unbind(window, 'ready', readyHandler);\r\n\t\t\t\tself.render();\r\n\t\t\t}\r\n\r\n\t\t\t// Page is not loaded yet, wait for it\r\n\t\t\tif (!Event.domLoaded) {\r\n\t\t\t\tDOM.bind(window, 'ready', readyHandler);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Element not found, then skip initialization\r\n\t\t\tif (!self.getElement()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// No editable support old iOS versions etc\r\n\t\t\tif (!Env.contentEditable) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Hide target element early to prevent content flashing\r\n\t\t\tif (!settings.inline) {\r\n\t\t\t\tself.orgVisibility = self.getElement().style.visibility;\r\n\t\t\t\tself.getElement().style.visibility = 'hidden';\r\n\t\t\t} else {\r\n\t\t\t\tself.inline = true;\r\n\t\t\t}\r\n\r\n\t\t\tvar form = self.getElement().form || DOM.getParent(id, 'form');\r\n\t\t\tif (form) {\r\n\t\t\t\tself.formElement = form;\r\n\r\n\t\t\t\t// Add hidden input for non input elements inside form elements\r\n\t\t\t\tif (settings.hidden_input && !/TEXTAREA|INPUT/i.test(self.getElement().nodeName)) {\r\n\t\t\t\t\tDOM.insertAfter(DOM.create('input', {type: 'hidden', name: id}), id);\r\n\t\t\t\t\tself.hasHiddenInput = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pass submit/reset from form to editor instance\r\n\t\t\t\tself.formEventDelegate = function(e) {\r\n\t\t\t\t\tself.fire(e.type, e);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tDOM.bind(form, 'submit reset', self.formEventDelegate);\r\n\r\n\t\t\t\t// Reset contents in editor when the form is reset\r\n\t\t\t\tself.on('reset', function() {\r\n\t\t\t\t\tself.setContent(self.startContent, {format: 'raw'});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check page uses id=\"submit\" or name=\"submit\" for it's submit button\r\n\t\t\t\tif (settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\r\n\t\t\t\t\tform._mceOldSubmit = form.submit;\r\n\t\t\t\t\tform.submit = function() {\r\n\t\t\t\t\t\tself.editorManager.triggerSave();\r\n\t\t\t\t\t\tself.setDirty(false);\r\n\r\n\t\t\t\t\t\treturn form._mceOldSubmit(form);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Window manager reference, use this to open new windows and dialogs.\r\n\t\t\t *\r\n\t\t\t * @property windowManager\r\n\t\t\t * @type tinymce.WindowManager\r\n\t\t\t * @example\r\n\t\t\t * // Shows an alert message\r\n\t\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\r\n\t\t\t *\r\n\t\t\t * // Opens a new dialog with the file.htm file and the size 320x240\r\n\t\t\t * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\r\n\t\t\t * tinymce.activeEditor.windowManager.open({\r\n\t\t\t *    url: 'file.htm',\r\n\t\t\t *    width: 320,\r\n\t\t\t *    height: 240\r\n\t\t\t * }, {\r\n\t\t\t *    custom_param: 1\r\n\t\t\t * });\r\n\t\t\t */\r\n\t\t\tself.windowManager = new WindowManager(self);\r\n\r\n\t\t\t/**\r\n\t\t\t * Notification manager reference, use this to open new windows and dialogs.\r\n\t\t\t *\r\n\t\t\t * @property notificationManager\r\n\t\t\t * @type tinymce.NotificationManager\r\n\t\t\t * @example\r\n\t\t\t * // Shows a notification info message.\r\n\t\t\t * tinymce.activeEditor.notificationManager.open({text: 'Hello world!', type: 'info'});\r\n\t\t\t */\r\n\t\t\tself.notificationManager = new NotificationManager(self);\r\n\r\n\t\t\tif (settings.encoding == 'xml') {\r\n\t\t\t\tself.on('GetContent', function(e) {\r\n\t\t\t\t\tif (e.save) {\r\n\t\t\t\t\t\te.content = DOM.encode(e.content);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.add_form_submit_trigger) {\r\n\t\t\t\tself.on('submit', function() {\r\n\t\t\t\t\tif (self.initialized) {\r\n\t\t\t\t\t\tself.save();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.add_unload_trigger) {\r\n\t\t\t\tself._beforeUnload = function() {\r\n\t\t\t\t\tif (self.initialized && !self.destroyed && !self.isHidden()) {\r\n\t\t\t\t\t\tself.save({format: 'raw', no_events: true, set_dirty: false});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tself.editorManager.on('BeforeUnload', self._beforeUnload);\r\n\t\t\t}\r\n\r\n\t\t\t// Load scripts\r\n\t\t\tfunction loadScripts() {\r\n\t\t\t\tvar scriptLoader = ScriptLoader.ScriptLoader;\r\n\r\n\t\t\t\tif (settings.language && settings.language != 'en' && !settings.language_url) {\r\n\t\t\t\t\tsettings.language_url = self.editorManager.baseURL + '/langs/' + settings.language + '.js';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.language_url) {\r\n\t\t\t\t\tscriptLoader.add(settings.language_url);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.theme && typeof settings.theme != \"function\" &&\r\n\t\t\t\t\tsettings.theme.charAt(0) != '-' && !ThemeManager.urls[settings.theme]) {\r\n\t\t\t\t\tvar themeUrl = settings.theme_url;\r\n\r\n\t\t\t\t\tif (themeUrl) {\r\n\t\t\t\t\t\tthemeUrl = self.documentBaseURI.toAbsolute(themeUrl);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthemeUrl = 'themes/' + settings.theme + '/theme' + suffix + '.js';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tThemeManager.load(settings.theme, themeUrl);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (Tools.isArray(settings.plugins)) {\r\n\t\t\t\t\tsettings.plugins = settings.plugins.join(' ');\r\n\t\t\t\t}\r\n\r\n\t\t\t\teach(settings.external_plugins, function(url, name) {\r\n\t\t\t\t\tPluginManager.load(name, url);\r\n\t\t\t\t\tsettings.plugins += ' ' + name;\r\n\t\t\t\t});\r\n\r\n\t\t\t\teach(settings.plugins.split(/[ ,]/), function(plugin) {\r\n\t\t\t\t\tplugin = trim(plugin);\r\n\r\n\t\t\t\t\tif (plugin && !PluginManager.urls[plugin]) {\r\n\t\t\t\t\t\tif (plugin.charAt(0) == '-') {\r\n\t\t\t\t\t\t\tplugin = plugin.substr(1, plugin.length);\r\n\r\n\t\t\t\t\t\t\tvar dependencies = PluginManager.dependencies(plugin);\r\n\r\n\t\t\t\t\t\t\teach(dependencies, function(dep) {\r\n\t\t\t\t\t\t\t\tvar defaultSettings = {\r\n\t\t\t\t\t\t\t\t\tprefix: 'plugins/',\r\n\t\t\t\t\t\t\t\t\tresource: dep,\r\n\t\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\tdep = PluginManager.createUrl(defaultSettings, dep);\r\n\t\t\t\t\t\t\t\tPluginManager.load(dep.resource, dep);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tPluginManager.load(plugin, {\r\n\t\t\t\t\t\t\t\tprefix: 'plugins/',\r\n\t\t\t\t\t\t\t\tresource: plugin,\r\n\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tscriptLoader.loadQueue(function() {\r\n\t\t\t\t\tif (!self.removed) {\r\n\t\t\t\t\t\tself.init();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tself.editorManager.add(self);\r\n\t\t\tloadScripts();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Initializes the editor this will be called automatically when\r\n\t\t * all plugins/themes and language packs are loaded by the rendered method.\r\n\t\t * This method will setup the iframe and create the theme and plugin instances.\r\n\t\t *\r\n\t\t * @method init\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\tvar self = this, settings = self.settings, elm = self.getElement();\r\n\t\t\tvar w, h, minHeight, n, o, Theme, url, bodyId, bodyClass, re, i, initializedPlugins = [];\r\n\r\n\t\t\tthis.editorManager.i18n.setCode(settings.language);\r\n\t\t\tself.rtl = settings.rtl_ui || this.editorManager.i18n.rtl;\r\n\r\n\t\t\tsettings.aria_label = settings.aria_label || DOM.getAttrib(elm, 'aria-label', self.getLang('aria.rich_text_area'));\r\n\r\n\t\t\t/**\r\n\t\t\t * Reference to the theme instance that was used to generate the UI.\r\n\t\t\t *\r\n\t\t\t * @property theme\r\n\t\t\t * @type tinymce.Theme\r\n\t\t\t * @example\r\n\t\t\t * // Executes a method on the theme directly\r\n\t\t\t * tinymce.activeEditor.theme.someMethod();\r\n\t\t\t */\r\n\t\t\tif (settings.theme) {\r\n\t\t\t\tif (typeof settings.theme != \"function\") {\r\n\t\t\t\t\tsettings.theme = settings.theme.replace(/-/, '');\r\n\t\t\t\t\tTheme = ThemeManager.get(settings.theme);\r\n\t\t\t\t\tself.theme = new Theme(self, ThemeManager.urls[settings.theme]);\r\n\r\n\t\t\t\t\tif (self.theme.init) {\r\n\t\t\t\t\t\tself.theme.init(self, ThemeManager.urls[settings.theme] || self.documentBaseUrl.replace(/\\/$/, ''), self.$);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.theme = settings.theme;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction initPlugin(plugin) {\r\n\t\t\t\tvar Plugin = PluginManager.get(plugin), pluginUrl, pluginInstance;\r\n\r\n\t\t\t\tpluginUrl = PluginManager.urls[plugin] || self.documentBaseUrl.replace(/\\/$/, '');\r\n\t\t\t\tplugin = trim(plugin);\r\n\t\t\t\tif (Plugin && inArray(initializedPlugins, plugin) === -1) {\r\n\t\t\t\t\teach(PluginManager.dependencies(plugin), function(dep) {\r\n\t\t\t\t\t\tinitPlugin(dep);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (self.plugins[plugin]) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpluginInstance = new Plugin(self, pluginUrl, self.$);\r\n\r\n\t\t\t\t\tself.plugins[plugin] = pluginInstance;\r\n\r\n\t\t\t\t\tif (pluginInstance.init) {\r\n\t\t\t\t\t\tpluginInstance.init(self, pluginUrl);\r\n\t\t\t\t\t\tinitializedPlugins.push(plugin);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Create all plugins\r\n\t\t\teach(settings.plugins.replace(/\\-/g, '').split(/[ ,]/), initPlugin);\r\n\r\n\t\t\t// Measure box\r\n\t\t\tif (settings.render_ui && self.theme) {\r\n\t\t\t\tself.orgDisplay = elm.style.display;\r\n\r\n\t\t\t\tif (typeof settings.theme != \"function\") {\r\n\t\t\t\t\tw = settings.width || elm.style.width || elm.offsetWidth;\r\n\t\t\t\t\th = settings.height || elm.style.height || elm.offsetHeight;\r\n\t\t\t\t\tminHeight = settings.min_height || 100;\r\n\t\t\t\t\tre = /^[0-9\\.]+(|px)$/i;\r\n\r\n\t\t\t\t\tif (re.test('' + w)) {\r\n\t\t\t\t\t\tw = Math.max(parseInt(w, 10), 100);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (re.test('' + h)) {\r\n\t\t\t\t\t\th = Math.max(parseInt(h, 10), minHeight);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Render UI\r\n\t\t\t\t\to = self.theme.renderUI({\r\n\t\t\t\t\t\ttargetNode: elm,\r\n\t\t\t\t\t\twidth: w,\r\n\t\t\t\t\t\theight: h,\r\n\t\t\t\t\t\tdeltaWidth: settings.delta_width,\r\n\t\t\t\t\t\tdeltaHeight: settings.delta_height\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Resize editor\r\n\t\t\t\t\tif (!settings.content_editable) {\r\n\t\t\t\t\t\th = (o.iframeHeight || h) + (typeof h == 'number' ? (o.deltaHeight || 0) : '');\r\n\t\t\t\t\t\tif (h < minHeight) {\r\n\t\t\t\t\t\t\th = minHeight;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\to = settings.theme(self, elm);\r\n\r\n\t\t\t\t\t// Convert element type to id:s\r\n\t\t\t\t\tif (o.editorContainer.nodeType) {\r\n\t\t\t\t\t\to.editorContainer = o.editorContainer.id = o.editorContainer.id || self.id + \"_parent\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Convert element type to id:s\r\n\t\t\t\t\tif (o.iframeContainer.nodeType) {\r\n\t\t\t\t\t\to.iframeContainer = o.iframeContainer.id = o.iframeContainer.id || self.id + \"_iframecontainer\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Use specified iframe height or the targets offsetHeight\r\n\t\t\t\t\th = o.iframeHeight || elm.offsetHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.editorContainer = o.editorContainer;\r\n\t\t\t}\r\n\r\n\t\t\t// Load specified content CSS last\r\n\t\t\tif (settings.content_css) {\r\n\t\t\t\teach(explode(settings.content_css), function(u) {\r\n\t\t\t\t\tself.contentCSS.push(self.documentBaseURI.toAbsolute(u));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Load specified content CSS last\r\n\t\t\tif (settings.content_style) {\r\n\t\t\t\tself.contentStyles.push(settings.content_style);\r\n\t\t\t}\r\n\r\n\t\t\t// Content editable mode ends here\r\n\t\t\tif (settings.content_editable) {\r\n\t\t\t\telm = n = o = null; // Fix IE leak\r\n\t\t\t\treturn self.initContentBody();\r\n\t\t\t}\r\n\r\n\t\t\tself.iframeHTML = settings.doctype + '<html><head>';\r\n\r\n\t\t\t// We only need to override paths if we have to\r\n\t\t\t// IE has a bug where it remove site absolute urls to relative ones if this is specified\r\n\t\t\tif (settings.document_base_url != self.documentBaseUrl) {\r\n\t\t\t\tself.iframeHTML += '<base href=\"' + self.documentBaseURI.getURI() + '\" />';\r\n\t\t\t}\r\n\r\n\t\t\t// IE8 doesn't support carets behind images setting ie7_compat would force IE8+ to run in IE7 compat mode.\r\n\t\t\tif (!Env.caretAfter && settings.ie7_compat) {\r\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" />';\r\n\t\t\t}\r\n\r\n\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\r\n\r\n\t\t\t// Load the CSS by injecting them into the HTML this will reduce \"flicker\"\r\n\t\t\t// However we can't do that on Chrome since # will scroll to the editor for some odd reason see #2427\r\n\t\t\tif (!/#$/.test(document.location.href)) {\r\n\t\t\t\tfor (i = 0; i < self.contentCSS.length; i++) {\r\n\t\t\t\t\tvar cssUrl = self.contentCSS[i];\r\n\t\t\t\t\tself.iframeHTML += (\r\n\t\t\t\t\t\t'<link type=\"text/css\" ' +\r\n\t\t\t\t\t\t\t'rel=\"stylesheet\" ' +\r\n\t\t\t\t\t\t\t'href=\"' + Tools._addCacheSuffix(cssUrl) + '\" />'\r\n\t\t\t\t\t);\r\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbodyId = settings.body_id || 'tinymce';\r\n\t\t\tif (bodyId.indexOf('=') != -1) {\r\n\t\t\t\tbodyId = self.getParam('body_id', '', 'hash');\r\n\t\t\t\tbodyId = bodyId[self.id] || bodyId;\r\n\t\t\t}\r\n\r\n\t\t\tbodyClass = settings.body_class || '';\r\n\t\t\tif (bodyClass.indexOf('=') != -1) {\r\n\t\t\t\tbodyClass = self.getParam('body_class', '', 'hash');\r\n\t\t\t\tbodyClass = bodyClass[self.id] || '';\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.content_security_policy) {\r\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + settings.content_security_policy + '\" />';\r\n\t\t\t}\r\n\r\n\t\t\tself.iframeHTML += '</head><body id=\"' + bodyId +\r\n\t\t\t\t'\" class=\"mce-content-body ' + bodyClass +\r\n\t\t\t\t'\" data-id=\"' + self.id + '\"><br></body></html>';\r\n\r\n\t\t\t/*eslint no-script-url:0 */\r\n\t\t\tvar domainRelaxUrl = 'javascript:(function(){' +\r\n\t\t\t\t'document.open();document.domain=\"' + document.domain + '\";' +\r\n\t\t\t\t'var ed = window.parent.tinymce.get(\"' + self.id + '\");document.write(ed.iframeHTML);' +\r\n\t\t\t\t'document.close();ed.initContentBody(true);})()';\r\n\r\n\t\t\t// Domain relaxing is required since the user has messed around with document.domain\r\n\t\t\tif (document.domain != location.hostname) {\r\n\t\t\t\t// Edge seems to be able to handle domain relaxing\r\n\t\t\t\tif (Env.ie && Env.ie < 12) {\r\n\t\t\t\t\turl = domainRelaxUrl;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Create iframe\r\n\t\t\t// TODO: ACC add the appropriate description on this.\r\n\t\t\tvar ifr = DOM.create('iframe', {\r\n\t\t\t\tid: self.id + \"_ifr\",\r\n\t\t\t\t//src: url || 'javascript:\"\"', // Workaround for HTTPS warning in IE6/7\r\n\t\t\t\tframeBorder: '0',\r\n\t\t\t\tallowTransparency: \"true\",\r\n\t\t\t\ttitle: self.editorManager.translate(\r\n\t\t\t\t\t\t\"Rich Text Area. Press ALT-F9 for menu. \" +\r\n\t\t\t\t\t\t\"Press ALT-F10 for toolbar. Press ALT-0 for help\"\r\n\t\t\t\t),\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\twidth: '100%',\r\n\t\t\t\t\theight: h,\r\n\t\t\t\t\tdisplay: 'block' // Important for Gecko to render the iframe correctly\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tifr.onload = function() {\r\n\t\t\t\tifr.onload = null;\r\n\t\t\t\tself.fire(\"load\");\r\n\t\t\t};\r\n\r\n\t\t\tDOM.setAttrib(ifr, \"src\", url || 'javascript:\"\"');\r\n\r\n\t\t\tself.contentAreaContainer = o.iframeContainer;\r\n\t\t\tself.iframeElement = ifr;\r\n\r\n\t\t\tn = DOM.add(o.iframeContainer, ifr);\r\n\r\n\t\t\t// Try accessing the document this will fail on IE when document.domain is set to the same as location.hostname\r\n\t\t\t// Then we have to force domain relaxing using the domainRelaxUrl approach very ugly!!\r\n\t\t\tif (ie) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tself.getDoc();\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tn.src = url = domainRelaxUrl;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (o.editorContainer) {\r\n\t\t\t\tDOM.get(o.editorContainer).style.display = self.orgDisplay;\r\n\t\t\t\tself.hidden = DOM.isHidden(o.editorContainer);\r\n\t\t\t}\r\n\r\n\t\t\tself.getElement().style.display = 'none';\r\n\t\t\tDOM.setAttrib(self.id, 'aria-hidden', true);\r\n\r\n\t\t\tif (!url) {\r\n\t\t\t\tself.initContentBody();\r\n\t\t\t}\r\n\r\n\t\t\telm = n = o = null; // Cleanup\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method get called by the init method once the iframe is loaded.\r\n\t\t * It will fill the iframe with contents, sets up DOM and selection objects for the iframe.\r\n\t\t *\r\n\t\t * @method initContentBody\r\n\t\t * @private\r\n\t\t */\r\n\t\tinitContentBody: function(skipWrite) {\r\n\t\t\tvar self = this, settings = self.settings, targetElm = self.getElement(), doc = self.getDoc(), body, contentCssText;\r\n\r\n\t\t\t// Restore visibility on target element\r\n\t\t\tif (!settings.inline) {\r\n\t\t\t\tself.getElement().style.visibility = self.orgVisibility;\r\n\t\t\t}\r\n\r\n\t\t\t// Setup iframe body\r\n\t\t\tif (!skipWrite && !settings.content_editable) {\r\n\t\t\t\tdoc.open();\r\n\t\t\t\tdoc.write(self.iframeHTML);\r\n\t\t\t\tdoc.close();\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.content_editable) {\r\n\t\t\t\tself.on('remove', function() {\r\n\t\t\t\t\tvar bodyEl = this.getBody();\r\n\r\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-content-body');\r\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-edit-focus');\r\n\t\t\t\t\tDOM.setAttrib(bodyEl, 'contentEditable', null);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tDOM.addClass(targetElm, 'mce-content-body');\r\n\t\t\t\tself.contentDocument = doc = settings.content_document || document;\r\n\t\t\t\tself.contentWindow = settings.content_window || window;\r\n\t\t\t\tself.bodyElement = targetElm;\r\n\r\n\t\t\t\t// Prevent leak in IE\r\n\t\t\t\tsettings.content_document = settings.content_window = null;\r\n\r\n\t\t\t\t// TODO: Fix this\r\n\t\t\t\tsettings.root_name = targetElm.nodeName.toLowerCase();\r\n\t\t\t}\r\n\r\n\t\t\t// It will not steal focus while setting contentEditable\r\n\t\t\tbody = self.getBody();\r\n\t\t\tbody.disabled = true;\r\n\t\t\tself.readonly = settings.readonly;\r\n\r\n\t\t\tif (!self.readonly) {\r\n\t\t\t\tif (self.inline && DOM.getStyle(body, 'position', true) == 'static') {\r\n\t\t\t\t\tbody.style.position = 'relative';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbody.contentEditable = self.getParam('content_editable_state', true);\r\n\t\t\t}\r\n\r\n\t\t\tbody.disabled = false;\r\n\r\n\t\t\tself.editorUpload = new EditorUpload(self);\r\n\r\n\t\t\t/**\r\n\t\t\t * Schema instance, enables you to validate elements and its children.\r\n\t\t\t *\r\n\t\t\t * @property schema\r\n\t\t\t * @type tinymce.html.Schema\r\n\t\t\t */\r\n\t\t\tself.schema = new Schema(settings);\r\n\r\n\t\t\t/**\r\n\t\t\t * DOM instance for the editor.\r\n\t\t\t *\r\n\t\t\t * @property dom\r\n\t\t\t * @type tinymce.dom.DOMUtils\r\n\t\t\t * @example\r\n\t\t\t * // Adds a class to all paragraphs within the editor\r\n\t\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\r\n\t\t\t */\r\n\t\t\tself.dom = new DOMUtils(doc, {\r\n\t\t\t\tkeep_values: true,\r\n\t\t\t\turl_converter: self.convertURL,\r\n\t\t\t\turl_converter_scope: self,\r\n\t\t\t\thex_colors: settings.force_hex_style_colors,\r\n\t\t\t\tclass_filter: settings.class_filter,\r\n\t\t\t\tupdate_styles: true,\r\n\t\t\t\troot_element: self.inline ? self.getBody() : null,\r\n\t\t\t\tcollect: settings.content_editable,\r\n\t\t\t\tschema: self.schema,\r\n\t\t\t\tonSetAttrib: function(e) {\r\n\t\t\t\t\tself.fire('SetAttrib', e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * HTML parser will be used when contents is inserted into the editor.\r\n\t\t\t *\r\n\t\t\t * @property parser\r\n\t\t\t * @type tinymce.html.DomParser\r\n\t\t\t */\r\n\t\t\tself.parser = new DomParser(settings, self.schema);\r\n\r\n\t\t\t// Convert src and href into data-mce-src, data-mce-href and data-mce-style\r\n\t\t\tself.parser.addAttributeFilter('src,href,style,tabindex', function(nodes, name) {\r\n\t\t\t\tvar i = nodes.length, node, dom = self.dom, value, internalName;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tvalue = node.attr(name);\r\n\t\t\t\t\tinternalName = 'data-mce-' + name;\r\n\r\n\t\t\t\t\t// Add internal attribute if we need to we don't on a refresh of the document\r\n\t\t\t\t\tif (!node.attributes.map[internalName]) {\r\n\t\t\t\t\t\t// Don't duplicate these since they won't get modified by any browser\r\n\t\t\t\t\t\tif (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (name === \"style\") {\r\n\t\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\r\n\r\n\t\t\t\t\t\t\tif (!value.length) {\r\n\t\t\t\t\t\t\t\tvalue = null;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tnode.attr(internalName, value);\r\n\t\t\t\t\t\t\tnode.attr(name, value);\r\n\t\t\t\t\t\t} else if (name === \"tabindex\") {\r\n\t\t\t\t\t\t\tnode.attr(internalName, value);\r\n\t\t\t\t\t\t\tnode.attr(name, null);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnode.attr(internalName, self.convertURL(value, name, node.name));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Keep scripts from executing\r\n\t\t\tself.parser.addNodeFilter('script', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, node, type;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\ttype = node.attr('type') || 'no/type';\r\n\t\t\t\t\tif (type.indexOf('mce-') !== 0) {\r\n\t\t\t\t\t\tnode.attr('type', 'mce-' + type);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.parser.addNodeFilter('#cdata', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, node;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\t\t\t\t\tnode.type = 8;\r\n\t\t\t\t\tnode.name = '#comment';\r\n\t\t\t\t\tnode.value = '[CDATA[' + node.value + ']]';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function(nodes) {\r\n\t\t\t\tvar i = nodes.length, node, nonEmptyElements = self.schema.getNonEmptyElements();\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tnode = nodes[i];\r\n\r\n\t\t\t\t\tif (node.isEmpty(nonEmptyElements)) {\r\n\t\t\t\t\t\tnode.append(new Node('br', 1)).shortEnded = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * DOM serializer for the editor. Will be used when contents is extracted from the editor.\r\n\t\t\t *\r\n\t\t\t * @property serializer\r\n\t\t\t * @type tinymce.dom.Serializer\r\n\t\t\t * @example\r\n\t\t\t * // Serializes the first paragraph in the editor into a string\r\n\t\t\t * tinymce.activeEditor.serializer.serialize(tinymce.activeEditor.dom.select('p')[0]);\r\n\t\t\t */\r\n\t\t\tself.serializer = new DomSerializer(settings, self);\r\n\r\n\t\t\t/**\r\n\t\t\t * Selection instance for the editor.\r\n\t\t\t *\r\n\t\t\t * @property selection\r\n\t\t\t * @type tinymce.dom.Selection\r\n\t\t\t * @example\r\n\t\t\t * // Sets some contents to the current selection in the editor\r\n\t\t\t * tinymce.activeEditor.selection.setContent('Some contents');\r\n\t\t\t *\r\n\t\t\t * // Gets the current selection\r\n\t\t\t * alert(tinymce.activeEditor.selection.getContent());\r\n\t\t\t *\r\n\t\t\t * // Selects the first paragraph found\r\n\t\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\r\n\t\t\t */\r\n\t\t\tself.selection = new Selection(self.dom, self.getWin(), self.serializer, self);\r\n\r\n\t\t\t/**\r\n\t\t\t * Formatter instance.\r\n\t\t\t *\r\n\t\t\t * @property formatter\r\n\t\t\t * @type tinymce.Formatter\r\n\t\t\t */\r\n\t\t\tself.formatter = new Formatter(self);\r\n\r\n\t\t\t/**\r\n\t\t\t * Undo manager instance, responsible for handling undo levels.\r\n\t\t\t *\r\n\t\t\t * @property undoManager\r\n\t\t\t * @type tinymce.UndoManager\r\n\t\t\t * @example\r\n\t\t\t * // Undoes the last modification to the editor\r\n\t\t\t * tinymce.activeEditor.undoManager.undo();\r\n\t\t\t */\r\n\t\t\tself.undoManager = new UndoManager(self);\r\n\r\n\t\t\tself.forceBlocks = new ForceBlocks(self);\r\n\t\t\tself.enterKey = new EnterKey(self);\r\n\t\t\tself._nodeChangeDispatcher = new NodeChange(self);\r\n\t\t\tself._selectionOverrides = new SelectionOverrides(self);\r\n\r\n\t\t\tself.fire('PreInit');\r\n\r\n\t\t\tif (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\r\n\t\t\t\tdoc.body.spellcheck = false; // Gecko\r\n\t\t\t\tDOM.setAttrib(body, \"spellcheck\", \"false\");\r\n\t\t\t}\r\n\r\n\t\t\tself.quirks = new Quirks(self);\r\n\t\t\tself.fire('PostRender');\r\n\r\n\t\t\tif (settings.directionality) {\r\n\t\t\t\tbody.dir = settings.directionality;\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.nowrap) {\r\n\t\t\t\tbody.style.whiteSpace = \"nowrap\";\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.protect) {\r\n\t\t\t\tself.on('BeforeSetContent', function(e) {\r\n\t\t\t\t\teach(settings.protect, function(pattern) {\r\n\t\t\t\t\t\te.content = e.content.replace(pattern, function(str) {\r\n\t\t\t\t\t\t\treturn '<!--mce:protected ' + escape(str) + '-->';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tself.on('SetContent', function() {\r\n\t\t\t\tself.addVisual(self.getBody());\r\n\t\t\t});\r\n\r\n\t\t\t// Remove empty contents\r\n\t\t\tif (settings.padd_empty_editor) {\r\n\t\t\t\tself.on('PostProcess', function(e) {\r\n\t\t\t\t\te.content = e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/, '');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tself.load({initial: true, format: 'html'});\r\n\t\t\tself.startContent = self.getContent({format: 'raw'});\r\n\r\n\t\t\t/**\r\n\t\t\t * Is set to true after the editor instance has been initialized\r\n\t\t\t *\r\n\t\t\t * @property initialized\r\n\t\t\t * @type Boolean\r\n\t\t\t * @example\r\n\t\t\t * function isEditorInitialized(editor) {\r\n\t\t\t *     return editor && editor.initialized;\r\n\t\t\t * }\r\n\t\t\t */\r\n\t\t\tself.initialized = true;\r\n\t\t\tself.bindPendingEventDelegates();\r\n\r\n\t\t\tself.fire('init');\r\n\t\t\tself.focus(true);\r\n\t\t\tself.nodeChanged({initial: true});\r\n\t\t\tself.execCallback('init_instance_callback', self);\r\n\r\n\t\t\tself.on('compositionstart compositionend', function(e) {\r\n\t\t\t\tself.composing = e.type === 'compositionstart';\r\n\t\t\t});\r\n\r\n\t\t\t// Add editor specific CSS styles\r\n\t\t\tif (self.contentStyles.length > 0) {\r\n\t\t\t\tcontentCssText = '';\r\n\r\n\t\t\t\teach(self.contentStyles, function(style) {\r\n\t\t\t\t\tcontentCssText += style + \"\\r\\n\";\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.dom.addStyle(contentCssText);\r\n\t\t\t}\r\n\r\n\t\t\t// Load specified content CSS last\r\n\t\t\teach(self.contentCSS, function(cssUrl) {\r\n\t\t\t\tif (!self.loadedCSS[cssUrl]) {\r\n\t\t\t\t\tself.dom.loadCSS(cssUrl);\r\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Handle auto focus\r\n\t\t\tif (settings.auto_focus) {\r\n\t\t\t\tDelay.setEditorTimeout(self, function() {\r\n\t\t\t\t\tvar editor;\r\n\r\n\t\t\t\t\tif (settings.auto_focus === true) {\r\n\t\t\t\t\t\teditor = self;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\teditor = self.editorManager.get(settings.auto_focus);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!editor.destroyed) {\r\n\t\t\t\t\t\teditor.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\t\t\t}\r\n\r\n\t\t\t// Clean up references for IE\r\n\t\t\ttargetElm = doc = body = null;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Focuses/activates the editor. This will set this editor as the activeEditor in the tinymce collection\r\n\t\t * it will also place DOM focus inside the editor.\r\n\t\t *\r\n\t\t * @method focus\r\n\t\t * @param {Boolean} skipFocus Skip DOM focus. Just set is as the active editor.\r\n\t\t */\r\n\t\tfocus: function(skipFocus) {\r\n\t\t\tvar self = this, selection = self.selection, contentEditable = self.settings.content_editable, rng;\r\n\t\t\tvar controlElm, doc = self.getDoc(), body = self.getBody(), contentEditableHost;\r\n\r\n\t\t\tfunction getContentEditableHost(node) {\r\n\t\t\t\treturn self.dom.getParent(node, function(node) {\r\n\t\t\t\t\treturn self.dom.getContentEditable(node) === \"true\";\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!skipFocus) {\r\n\t\t\t\t// Get selected control element\r\n\t\t\t\trng = selection.getRng();\r\n\t\t\t\tif (rng.item) {\r\n\t\t\t\t\tcontrolElm = rng.item(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.quirks.refreshContentEditable();\r\n\r\n\t\t\t\t// Move focus to contentEditable=true child if needed\r\n\t\t\t\tcontentEditableHost = getContentEditableHost(selection.getNode());\r\n\t\t\t\tif (self.$.contains(body, contentEditableHost)) {\r\n\t\t\t\t\tcontentEditableHost.focus();\r\n\t\t\t\t\tselection.normalize();\r\n\t\t\t\t\tself.editorManager.setActive(self);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Focus the window iframe\r\n\t\t\t\tif (!contentEditable) {\r\n\t\t\t\t\t// WebKit needs this call to fire focusin event properly see #5948\r\n\t\t\t\t\t// But Opera pre Blink engine will produce an empty selection so skip Opera\r\n\t\t\t\t\tif (!Env.opera) {\r\n\t\t\t\t\t\tself.getBody().focus();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.getWin().focus();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Focus the body as well since it's contentEditable\r\n\t\t\t\tif (isGecko || contentEditable) {\r\n\t\t\t\t\t// Check for setActive since it doesn't scroll to the element\r\n\t\t\t\t\tif (body.setActive) {\r\n\t\t\t\t\t\t// IE 11 sometimes throws \"Invalid function\" then fallback to focus\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tbody.setActive();\r\n\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\tbody.focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbody.focus();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (contentEditable) {\r\n\t\t\t\t\t\tselection.normalize();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Restore selected control element\r\n\t\t\t\t// This is needed when for example an image is selected within a\r\n\t\t\t\t// layer a call to focus will then remove the control selection\r\n\t\t\t\tif (controlElm && controlElm.ownerDocument == doc) {\r\n\t\t\t\t\trng = doc.body.createControlRange();\r\n\t\t\t\t\trng.addElement(controlElm);\r\n\t\t\t\t\trng.select();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.editorManager.setActive(self);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes a legacy callback. This method is useful to call old 2.x option callbacks.\r\n\t\t * There new event model is a better way to add callback so this method might be removed in the future.\r\n\t\t *\r\n\t\t * @method execCallback\r\n\t\t * @param {String} name Name of the callback to execute.\r\n\t\t * @return {Object} Return value passed from callback function.\r\n\t\t */\r\n\t\texecCallback: function(name) {\r\n\t\t\tvar self = this, callback = self.settings[name], scope;\r\n\r\n\t\t\tif (!callback) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Look through lookup\r\n\t\t\tif (self.callbackLookup && (scope = self.callbackLookup[name])) {\r\n\t\t\t\tcallback = scope.func;\r\n\t\t\t\tscope = scope.scope;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof callback === 'string') {\r\n\t\t\t\tscope = callback.replace(/\\.\\w+$/, '');\r\n\t\t\t\tscope = scope ? resolve(scope) : 0;\r\n\t\t\t\tcallback = resolve(callback);\r\n\t\t\t\tself.callbackLookup = self.callbackLookup || {};\r\n\t\t\t\tself.callbackLookup[name] = {func: callback, scope: scope};\r\n\t\t\t}\r\n\r\n\t\t\treturn callback.apply(scope || self, Array.prototype.slice.call(arguments, 1));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Translates the specified string by replacing variables with language pack items it will also check if there is\r\n\t\t * a key matching the input.\r\n\t\t *\r\n\t\t * @method translate\r\n\t\t * @param {String} text String to translate by the language pack data.\r\n\t\t * @return {String} Translated string.\r\n\t\t */\r\n\t\ttranslate: function(text) {\r\n\t\t\tvar lang = this.settings.language || 'en', i18n = this.editorManager.i18n;\r\n\r\n\t\t\tif (!text) {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\r\n\t\t\ttext = i18n.data[lang + '.' + text] || text.replace(/\\{\\#([^\\}]+)\\}/g, function(a, b) {\r\n\t\t\t\treturn i18n.data[lang + '.' + b] || '{#' + b + '}';\r\n\t\t\t});\r\n\r\n\t\t\treturn this.editorManager.translate(text);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a language pack item by name/key.\r\n\t\t *\r\n\t\t * @method getLang\r\n\t\t * @param {String} name Name/key to get from the language pack.\r\n\t\t * @param {String} defaultVal Optional default value to retrieve.\r\n\t\t */\r\n\t\tgetLang: function(name, defaultVal) {\r\n\t\t\treturn (\r\n\t\t\t\tthis.editorManager.i18n.data[(this.settings.language || 'en') + '.' + name] ||\r\n\t\t\t\t(defaultVal !== undefined ? defaultVal : '{#' + name + '}')\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a configuration parameter by name.\r\n\t\t *\r\n\t\t * @method getParam\r\n\t\t * @param {String} name Configruation parameter to retrieve.\r\n\t\t * @param {String} defaultVal Optional default value to return.\r\n\t\t * @param {String} type Optional type parameter.\r\n\t\t * @return {String} Configuration parameter value or default value.\r\n\t\t * @example\r\n\t\t * // Returns a specific config value from the currently active editor\r\n\t\t * var someval = tinymce.activeEditor.getParam('myvalue');\r\n\t\t *\r\n\t\t * // Returns a specific config value from a specific editor instance by id\r\n\t\t * var someval2 = tinymce.get('my_editor').getParam('myvalue');\r\n\t\t */\r\n\t\tgetParam: function(name, defaultVal, type) {\r\n\t\t\tvar value = name in this.settings ? this.settings[name] : defaultVal, output;\r\n\r\n\t\t\tif (type === 'hash') {\r\n\t\t\t\toutput = {};\r\n\r\n\t\t\t\tif (typeof value === 'string') {\r\n\t\t\t\t\teach(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function(value) {\r\n\t\t\t\t\t\tvalue = value.split('=');\r\n\r\n\t\t\t\t\t\tif (value.length > 1) {\r\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value[1]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\toutput = value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn output;\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\r\n\t\t * need to update the UI states or element path etc.\r\n\t\t *\r\n\t\t * @method nodeChanged\r\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\r\n\t\t */\r\n\t\tnodeChanged: function(args) {\r\n\t\t\tthis._nodeChangeDispatcher.nodeChanged(args);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a button that later gets created by the theme in the editors toolbars.\r\n\t\t *\r\n\t\t * @method addButton\r\n\t\t * @param {String} name Button name to add.\r\n\t\t * @param {Object} settings Settings object with title, cmd etc.\r\n\t\t * @example\r\n\t\t * // Adds a custom button to the editor that inserts contents when clicked\r\n\t\t * tinymce.init({\r\n\t\t *    ...\r\n\t\t *\r\n\t\t *    toolbar: 'example'\r\n\t\t *\r\n\t\t *    setup: function(ed) {\r\n\t\t *       ed.addButton('example', {\r\n\t\t *          title: 'My title',\r\n\t\t *          image: '../js/tinymce/plugins/example/img/example.gif',\r\n\t\t *          onclick: function() {\r\n\t\t *             ed.insertContent('Hello world!!');\r\n\t\t *          }\r\n\t\t *       });\r\n\t\t *    }\r\n\t\t * });\r\n\t\t */\r\n\t\taddButton: function(name, settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (settings.cmd) {\r\n\t\t\t\tsettings.onclick = function() {\r\n\t\t\t\t\tself.execCommand(settings.cmd);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!settings.text && !settings.icon) {\r\n\t\t\t\tsettings.icon = name;\r\n\t\t\t}\r\n\r\n\t\t\tself.buttons = self.buttons || {};\r\n\t\t\tsettings.tooltip = settings.tooltip || settings.title;\r\n\t\t\tself.buttons[name] = settings;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a menu item to be used in the menus of the theme. There might be multiple instances\r\n\t\t * of this menu item for example it might be used in the main menus of the theme but also in\r\n\t\t * the context menu so make sure that it's self contained and supports multiple instances.\r\n\t\t *\r\n\t\t * @method addMenuItem\r\n\t\t * @param {String} name Menu item name to add.\r\n\t\t * @param {Object} settings Settings object with title, cmd etc.\r\n\t\t * @example\r\n\t\t * // Adds a custom menu item to the editor that inserts contents when clicked\r\n\t\t * // The context option allows you to add the menu item to an existing default menu\r\n\t\t * tinymce.init({\r\n\t\t *    ...\r\n\t\t *\r\n\t\t *    setup: function(ed) {\r\n\t\t *       ed.addMenuItem('example', {\r\n\t\t *          text: 'My menu item',\r\n\t\t *          context: 'tools',\r\n\t\t *          onclick: function() {\r\n\t\t *             ed.insertContent('Hello world!!');\r\n\t\t *          }\r\n\t\t *       });\r\n\t\t *    }\r\n\t\t * });\r\n\t\t */\r\n\t\taddMenuItem: function(name, settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (settings.cmd) {\r\n\t\t\t\tsettings.onclick = function() {\r\n\t\t\t\t\tself.execCommand(settings.cmd);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tself.menuItems = self.menuItems || {};\r\n\t\t\tself.menuItems[name] = settings;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a contextual toolbar to be rendered when the selector matches.\r\n\t\t *\r\n\t\t * @method addContextToolbar\r\n\t\t * @param {function/string} predicate Predicate that needs to return true if provided strings get converted into CSS predicates.\r\n\t\t * @param {String/Array} items String or array with items to add to the context toolbar.\r\n\t\t */\r\n\t\taddContextToolbar: function(predicate, items) {\r\n\t\t\tvar self = this, selector;\r\n\r\n\t\t\tself.contextToolbars = self.contextToolbars || [];\r\n\r\n\t\t\t// Convert selector to predicate\r\n\t\t\tif (typeof predicate == \"string\") {\r\n\t\t\t\tselector = predicate;\r\n\t\t\t\tpredicate = function(elm) {\r\n\t\t\t\t\treturn self.dom.is(elm, selector);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tself.contextToolbars.push({\r\n\t\t\t\tid: Uuid.uuid('mcet'),\r\n\t\t\t\tpredicate: predicate,\r\n\t\t\t\titems: items\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a custom command to the editor, you can also override existing commands with this method.\r\n\t\t * The command that you add can be executed with execCommand.\r\n\t\t *\r\n\t\t * @method addCommand\r\n\t\t * @param {String} name Command name to add/override.\r\n\t\t * @param {addCommandCallback} callback Function to execute when the command occurs.\r\n\t\t * @param {Object} scope Optional scope to execute the function in.\r\n\t\t * @example\r\n\t\t * // Adds a custom command that later can be executed using execCommand\r\n\t\t * tinymce.init({\r\n\t\t *    ...\r\n\t\t *\r\n\t\t *    setup: function(ed) {\r\n\t\t *       // Register example command\r\n\t\t *       ed.addCommand('mycommand', function(ui, v) {\r\n\t\t *          ed.windowManager.alert('Hello world!! Selection: ' + ed.selection.getContent({format: 'text'}));\r\n\t\t *       });\r\n\t\t *    }\r\n\t\t * });\r\n\t\t */\r\n\t\taddCommand: function(name, callback, scope) {\r\n\t\t\t/**\r\n\t\t\t * Callback function that gets called when a command is executed.\r\n\t\t\t *\r\n\t\t\t * @callback addCommandCallback\r\n\t\t\t * @param {Boolean} ui Display UI state true/false.\r\n\t\t\t * @param {Object} value Optional value for command.\r\n\t\t\t * @return {Boolean} True/false state if the command was handled or not.\r\n\t\t\t */\r\n\t\t\tthis.editorCommands.addCommand(name, callback, scope);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a custom query state command to the editor, you can also override existing commands with this method.\r\n\t\t * The command that you add can be executed with queryCommandState function.\r\n\t\t *\r\n\t\t * @method addQueryStateHandler\r\n\t\t * @param {String} name Command name to add/override.\r\n\t\t * @param {addQueryStateHandlerCallback} callback Function to execute when the command state retrieval occurs.\r\n\t\t * @param {Object} scope Optional scope to execute the function in.\r\n\t\t */\r\n\t\taddQueryStateHandler: function(name, callback, scope) {\r\n\t\t\t/**\r\n\t\t\t * Callback function that gets called when a queryCommandState is executed.\r\n\t\t\t *\r\n\t\t\t * @callback addQueryStateHandlerCallback\r\n\t\t\t * @return {Boolean} True/false state if the command is enabled or not like is it bold.\r\n\t\t\t */\r\n\t\t\tthis.editorCommands.addQueryStateHandler(name, callback, scope);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a custom query value command to the editor, you can also override existing commands with this method.\r\n\t\t * The command that you add can be executed with queryCommandValue function.\r\n\t\t *\r\n\t\t * @method addQueryValueHandler\r\n\t\t * @param {String} name Command name to add/override.\r\n\t\t * @param {addQueryValueHandlerCallback} callback Function to execute when the command value retrieval occurs.\r\n\t\t * @param {Object} scope Optional scope to execute the function in.\r\n\t\t */\r\n\t\taddQueryValueHandler: function(name, callback, scope) {\r\n\t\t\t/**\r\n\t\t\t * Callback function that gets called when a queryCommandValue is executed.\r\n\t\t\t *\r\n\t\t\t * @callback addQueryValueHandlerCallback\r\n\t\t\t * @return {Object} Value of the command or undefined.\r\n\t\t\t */\r\n\t\t\tthis.editorCommands.addQueryValueHandler(name, callback, scope);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a keyboard shortcut for some command or function.\r\n\t\t *\r\n\t\t * @method addShortcut\r\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\r\n\t\t * @param {String} desc Text description for the command.\r\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\r\n\t\t * @param {Object} sc Optional scope to execute the function in.\r\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\r\n\t\t */\r\n\t\taddShortcut: function(pattern, desc, cmdFunc, scope) {\r\n\t\t\tthis.shortcuts.add(pattern, desc, cmdFunc, scope);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes a command on the current instance. These commands can be TinyMCE internal commands prefixed with \"mce\" or\r\n\t\t * they can be build in browser commands such as \"Bold\". A compleate list of browser commands is available on MSDN or Mozilla.org.\r\n\t\t * This function will dispatch the execCommand function on each plugin, theme or the execcommand_callback option if none of these\r\n\t\t * return true it will handle the command as a internal browser command.\r\n\t\t *\r\n\t\t * @method execCommand\r\n\t\t * @param {String} cmd Command name to execute, for example mceLink or Bold.\r\n\t\t * @param {Boolean} ui True/false state if a UI (dialog) should be presented or not.\r\n\t\t * @param {mixed} value Optional command value, this can be anything.\r\n\t\t * @param {Object} args Optional arguments object.\r\n\t\t */\r\n\t\texecCommand: function(cmd, ui, value, args) {\r\n\t\t\treturn this.editorCommands.execCommand(cmd, ui, value, args);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a command specific state, for example if bold is enabled or not.\r\n\t\t *\r\n\t\t * @method queryCommandState\r\n\t\t * @param {string} cmd Command to query state from.\r\n\t\t * @return {Boolean} Command specific state, for example if bold is enabled or not.\r\n\t\t */\r\n\t\tqueryCommandState: function(cmd) {\r\n\t\t\treturn this.editorCommands.queryCommandState(cmd);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a command specific value, for example the current font size.\r\n\t\t *\r\n\t\t * @method queryCommandValue\r\n\t\t * @param {string} cmd Command to query value from.\r\n\t\t * @return {Object} Command specific value, for example the current font size.\r\n\t\t */\r\n\t\tqueryCommandValue: function(cmd) {\r\n\t\t\treturn this.editorCommands.queryCommandValue(cmd);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the command is supported or not.\r\n\t\t *\r\n\t\t * @method queryCommandSupported\r\n\t\t * @param {String} cmd Command that we check support for.\r\n\t\t * @return {Boolean} true/false if the command is supported or not.\r\n\t\t */\r\n\t\tqueryCommandSupported: function(cmd) {\r\n\t\t\treturn this.editorCommands.queryCommandSupported(cmd);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Shows the editor and hides any textarea/div that the editor is supposed to replace.\r\n\t\t *\r\n\t\t * @method show\r\n\t\t */\r\n\t\tshow: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.hidden) {\r\n\t\t\t\tself.hidden = false;\r\n\r\n\t\t\t\tif (self.inline) {\r\n\t\t\t\t\tself.getBody().contentEditable = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tDOM.show(self.getContainer());\r\n\t\t\t\t\tDOM.hide(self.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.load();\r\n\t\t\t\tself.fire('show');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides the editor and shows any textarea/div that the editor is supposed to replace.\r\n\t\t *\r\n\t\t * @method hide\r\n\t\t */\r\n\t\thide: function() {\r\n\t\t\tvar self = this, doc = self.getDoc();\r\n\r\n\t\t\tif (!self.hidden) {\r\n\t\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\r\n\t\t\t\tif (ie && doc && !self.inline) {\r\n\t\t\t\t\tdoc.execCommand('SelectAll');\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// We must save before we hide so Safari doesn't crash\r\n\t\t\t\tself.save();\r\n\r\n\t\t\t\tif (self.inline) {\r\n\t\t\t\t\tself.getBody().contentEditable = false;\r\n\r\n\t\t\t\t\t// Make sure the editor gets blurred\r\n\t\t\t\t\tif (self == self.editorManager.focusedEditor) {\r\n\t\t\t\t\t\tself.editorManager.focusedEditor = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tDOM.hide(self.getContainer());\r\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.hidden = true;\r\n\t\t\t\tself.fire('hide');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the editor is hidden or not.\r\n\t\t *\r\n\t\t * @method isHidden\r\n\t\t * @return {Boolean} True/false if the editor is hidden or not.\r\n\t\t */\r\n\t\tisHidden: function() {\r\n\t\t\treturn !!this.hidden;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the progress state, this will display a throbber/progess for the editor.\r\n\t\t * This is ideal for asynchronous operations like an AJAX save call.\r\n\t\t *\r\n\t\t * @method setProgressState\r\n\t\t * @param {Boolean} state Boolean state if the progress should be shown or hidden.\r\n\t\t * @param {Number} time Optional time to wait before the progress gets shown.\r\n\t\t * @return {Boolean} Same as the input state.\r\n\t\t * @example\r\n\t\t * // Show progress for the active editor\r\n\t\t * tinymce.activeEditor.setProgressState(true);\r\n\t\t *\r\n\t\t * // Hide progress for the active editor\r\n\t\t * tinymce.activeEditor.setProgressState(false);\r\n\t\t *\r\n\t\t * // Show progress after 3 seconds\r\n\t\t * tinymce.activeEditor.setProgressState(true, 3000);\r\n\t\t */\r\n\t\tsetProgressState: function(state, time) {\r\n\t\t\tthis.fire('ProgressState', {state: state, time: time});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Loads contents from the textarea or div element that got converted into an editor instance.\r\n\t\t * This method will move the contents from that textarea or div into the editor by using setContent\r\n\t\t * so all events etc that method has will get dispatched as well.\r\n\t\t *\r\n\t\t * @method load\r\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole load process.\r\n\t\t * @return {String} HTML string that got set into the editor.\r\n\t\t */\r\n\t\tload: function(args) {\r\n\t\t\tvar self = this, elm = self.getElement(), html;\r\n\r\n\t\t\tif (elm) {\r\n\t\t\t\targs = args || {};\r\n\t\t\t\targs.load = true;\r\n\r\n\t\t\t\thtml = self.setContent(elm.value !== undefined ? elm.value : elm.innerHTML, args);\r\n\t\t\t\targs.element = elm;\r\n\r\n\t\t\t\tif (!args.no_events) {\r\n\t\t\t\t\tself.fire('LoadContent', args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\targs.element = elm = null;\r\n\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Saves the contents from a editor out to the textarea or div element that got converted into an editor instance.\r\n\t\t * This method will move the HTML contents from the editor into that textarea or div by getContent\r\n\t\t * so all events etc that method has will get dispatched as well.\r\n\t\t *\r\n\t\t * @method save\r\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole save process.\r\n\t\t * @return {String} HTML string that got set into the textarea/div.\r\n\t\t */\r\n\t\tsave: function(args) {\r\n\t\t\tvar self = this, elm = self.getElement(), html, form;\r\n\r\n\t\t\tif (!elm || !self.initialized) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\targs = args || {};\r\n\t\t\targs.save = true;\r\n\r\n\t\t\targs.element = elm;\r\n\t\t\thtml = args.content = self.getContent(args);\r\n\r\n\t\t\tif (!args.no_events) {\r\n\t\t\t\tself.fire('SaveContent', args);\r\n\t\t\t}\r\n\r\n\t\t\t// Always run this internal event\r\n\t\t\tif (args.format == 'raw') {\r\n\t\t\t\tself.fire('RawSaveContent', args);\r\n\t\t\t}\r\n\r\n\t\t\thtml = args.content;\r\n\r\n\t\t\tif (!/TEXTAREA|INPUT/i.test(elm.nodeName)) {\r\n\t\t\t\t// Update DIV element when not in inline mode\r\n\t\t\t\tif (!self.inline) {\r\n\t\t\t\t\telm.innerHTML = html;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update hidden form element\r\n\t\t\t\tif ((form = DOM.getParent(self.id, 'form'))) {\r\n\t\t\t\t\teach(form.elements, function(elm) {\r\n\t\t\t\t\t\tif (elm.name == self.id) {\r\n\t\t\t\t\t\t\telm.value = html;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\telm.value = html;\r\n\t\t\t}\r\n\r\n\t\t\targs.element = elm = null;\r\n\r\n\t\t\tif (args.set_dirty !== false) {\r\n\t\t\t\tself.setDirty(false);\r\n\t\t\t}\r\n\r\n\t\t\treturn html;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the specified content to the editor instance, this will cleanup the content before it gets set using\r\n\t\t * the different cleanup rules options.\r\n\t\t *\r\n\t\t * @method setContent\r\n\t\t * @param {String} content Content to set to editor, normally HTML contents but can be other formats as well.\r\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole set process.\r\n\t\t * @return {String} HTML string that got set into the editor.\r\n\t\t * @example\r\n\t\t * // Sets the HTML contents of the activeEditor editor\r\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html');\r\n\t\t *\r\n\t\t * // Sets the raw contents of the activeEditor editor\r\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html', {format: 'raw'});\r\n\t\t *\r\n\t\t * // Sets the content of a specific editor (my_editor in this example)\r\n\t\t * tinymce.get('my_editor').setContent(data);\r\n\t\t *\r\n\t\t * // Sets the bbcode contents of the activeEditor editor if the bbcode plugin was added\r\n\t\t * tinymce.activeEditor.setContent('[b]some[/b] html', {format: 'bbcode'});\r\n\t\t */\r\n\t\tsetContent: function(content, args) {\r\n\t\t\tvar self = this, body = self.getBody(), forcedRootBlockName, padd;\r\n\r\n\t\t\t// Setup args object\r\n\t\t\targs = args || {};\r\n\t\t\targs.format = args.format || 'html';\r\n\t\t\targs.set = true;\r\n\t\t\targs.content = content;\r\n\r\n\t\t\t// Do preprocessing\r\n\t\t\tif (!args.no_events) {\r\n\t\t\t\tself.fire('BeforeSetContent', args);\r\n\t\t\t}\r\n\r\n\t\t\tcontent = args.content;\r\n\r\n\t\t\t// Padd empty content in Gecko and Safari. Commands will otherwise fail on the content\r\n\t\t\t// It will also be impossible to place the caret in the editor unless there is a BR element present\r\n\t\t\tif (content.length === 0 || /^\\s+$/.test(content)) {\r\n\t\t\t\tpadd = ie && ie < 11 ? '' : '<br data-mce-bogus=\"1\">';\r\n\r\n\t\t\t\t// Todo: There is a lot more root elements that need special padding\r\n\t\t\t\t// so separate this and add all of them at some point.\r\n\t\t\t\tif (body.nodeName == 'TABLE') {\r\n\t\t\t\t\tcontent = '<tr><td>' + padd + '</td></tr>';\r\n\t\t\t\t} else if (/^(UL|OL)$/.test(body.nodeName)) {\r\n\t\t\t\t\tcontent = '<li>' + padd + '</li>';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tforcedRootBlockName = self.settings.forced_root_block;\r\n\r\n\t\t\t\t// Check if forcedRootBlock is configured and that the block is a valid child of the body\r\n\t\t\t\tif (forcedRootBlockName && self.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\r\n\t\t\t\t\t// Padd with bogus BR elements on modern browsers and IE 7 and 8 since they don't render empty P tags properly\r\n\t\t\t\t\tcontent = padd;\r\n\t\t\t\t\tcontent = self.dom.createHTML(forcedRootBlockName, self.settings.forced_root_block_attrs, content);\r\n\t\t\t\t} else if (!ie && !content) {\r\n\t\t\t\t\t// We need to add a BR when forced_root_block is disabled on non IE browsers to place the caret\r\n\t\t\t\t\tcontent = '<br data-mce-bogus=\"1\">';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.dom.setHTML(body, content);\r\n\r\n\t\t\t\tself.fire('SetContent', args);\r\n\t\t\t} else {\r\n\t\t\t\t// Parse and serialize the html\r\n\t\t\t\tif (args.format !== 'raw') {\r\n\t\t\t\t\tcontent = new Serializer({\r\n\t\t\t\t\t\tvalidate: self.validate\r\n\t\t\t\t\t}, self.schema).serialize(\r\n\t\t\t\t\t\tself.parser.parse(content, {isRootContent: true})\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set the new cleaned contents to the editor\r\n\t\t\t\targs.content = trim(content);\r\n\t\t\t\tself.dom.setHTML(body, args.content);\r\n\r\n\t\t\t\t// Do post processing\r\n\t\t\t\tif (!args.no_events) {\r\n\t\t\t\t\tself.fire('SetContent', args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Don't normalize selection if the focused element isn't the body in\r\n\t\t\t\t// content editable mode since it will steal focus otherwise\r\n\t\t\t\t/*if (!self.settings.content_editable || document.activeElement === self.getBody()) {\r\n\t\t\t\t\tself.selection.normalize();\r\n\t\t\t\t}*/\r\n\t\t\t}\r\n\r\n\t\t\treturn args.content;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Gets the content from the editor instance, this will cleanup the content before it gets returned using\r\n\t\t * the different cleanup rules options.\r\n\t\t *\r\n\t\t * @method getContent\r\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole get process.\r\n\t\t * @return {String} Cleaned content string, normally HTML contents.\r\n\t\t * @example\r\n\t\t * // Get the HTML contents of the currently active editor\r\n\t\t * console.debug(tinymce.activeEditor.getContent());\r\n\t\t *\r\n\t\t * // Get the raw contents of the currently active editor\r\n\t\t * tinymce.activeEditor.getContent({format: 'raw'});\r\n\t\t *\r\n\t\t * // Get content of a specific editor:\r\n\t\t * tinymce.get('content id').getContent()\r\n\t\t */\r\n\t\tgetContent: function(args) {\r\n\t\t\tvar self = this, content, body = self.getBody();\r\n\r\n\t\t\t// Setup args object\r\n\t\t\targs = args || {};\r\n\t\t\targs.format = args.format || 'html';\r\n\t\t\targs.get = true;\r\n\t\t\targs.getInner = true;\r\n\r\n\t\t\t// Do preprocessing\r\n\t\t\tif (!args.no_events) {\r\n\t\t\t\tself.fire('BeforeGetContent', args);\r\n\t\t\t}\r\n\r\n\t\t\t// Get raw contents or by default the cleaned contents\r\n\t\t\tif (args.format == 'raw') {\r\n\t\t\t\tcontent = self.serializer.getTrimmedContent();\r\n\t\t\t} else if (args.format == 'text') {\r\n\t\t\t\tcontent = body.innerText || body.textContent;\r\n\t\t\t} else {\r\n\t\t\t\tcontent = self.serializer.serialize(body, args);\r\n\t\t\t}\r\n\r\n\t\t\t// Trim whitespace in beginning/end of HTML\r\n\t\t\tif (args.format != 'text') {\r\n\t\t\t\targs.content = trim(content);\r\n\t\t\t} else {\r\n\t\t\t\targs.content = content;\r\n\t\t\t}\r\n\r\n\t\t\t// Do post processing\r\n\t\t\tif (!args.no_events) {\r\n\t\t\t\tself.fire('GetContent', args);\r\n\t\t\t}\r\n\r\n\t\t\treturn args.content;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Inserts content at caret position.\r\n\t\t *\r\n\t\t * @method insertContent\r\n\t\t * @param {String} content Content to insert.\r\n\t\t * @param {Object} args Optional args to pass to insert call.\r\n\t\t */\r\n\t\tinsertContent: function(content, args) {\r\n\t\t\tif (args) {\r\n\t\t\t\tcontent = extend({content: content}, args);\r\n\t\t\t}\r\n\r\n\t\t\tthis.execCommand('mceInsertContent', false, content);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\r\n\t\t *\r\n\t\t * The dirty state is automatically set to true if you do modifications to the content in other\r\n\t\t * words when new undo levels is created or if you undo/redo to update the contents of the editor. It will also be set\r\n\t\t * to false if you call editor.save().\r\n\t\t *\r\n\t\t * @method isDirty\r\n\t\t * @return {Boolean} True/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\r\n\t\t * @example\r\n\t\t * if (tinymce.activeEditor.isDirty())\r\n\t\t *     alert(\"You must save your contents.\");\r\n\t\t */\r\n\t\tisDirty: function() {\r\n\t\t\treturn !this.isNotDirty;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Explicitly sets the dirty state. This will fire the dirty event if the editor dirty state is changed from false to true\r\n\t\t * by invoking this method.\r\n\t\t *\r\n\t\t * @method setDirty\r\n\t\t * @param {Boolean} state True/false if the editor is considered dirty.\r\n\t\t * @example\r\n\t\t * function ajaxSave() {\r\n\t\t *     var editor = tinymce.get('elm1');\r\n\t\t *\r\n\t\t *     // Save contents using some XHR call\r\n\t\t *     alert(editor.getContent());\r\n\t\t *\r\n\t\t *     editor.setDirty(false); // Force not dirty state\r\n\t\t * }\r\n\t\t */\r\n\t\tsetDirty: function(state) {\r\n\t\t\tvar oldState = !this.isNotDirty;\r\n\r\n\t\t\tthis.isNotDirty = !state;\r\n\r\n\t\t\tif (state && state != oldState) {\r\n\t\t\t\tthis.fire('dirty');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the editor mode. Mode can be for example \"design\", \"code\" or \"readonly\".\r\n\t\t *\r\n\t\t * @method setMode\r\n\t\t * @param {String} mode Mode to set the editor in.\r\n\t\t */\r\n\t\tsetMode: function(mode) {\r\n\t\t\tMode.setMode(this, mode);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the editors container element. The container element wrappes in\r\n\t\t * all the elements added to the page for the editor. Such as UI, iframe etc.\r\n\t\t *\r\n\t\t * @method getContainer\r\n\t\t * @return {Element} HTML DOM element for the editor container.\r\n\t\t */\r\n\t\tgetContainer: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!self.container) {\r\n\t\t\t\tself.container = DOM.get(self.editorContainer || self.id + '_parent');\r\n\t\t\t}\r\n\r\n\t\t\treturn self.container;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the editors content area container element. The this element is the one who\r\n\t\t * holds the iframe or the editable element.\r\n\t\t *\r\n\t\t * @method getContentAreaContainer\r\n\t\t * @return {Element} HTML DOM element for the editor area container.\r\n\t\t */\r\n\t\tgetContentAreaContainer: function() {\r\n\t\t\treturn this.contentAreaContainer;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the target element/textarea that got replaced with a TinyMCE editor instance.\r\n\t\t *\r\n\t\t * @method getElement\r\n\t\t * @return {Element} HTML DOM element for the replaced element.\r\n\t\t */\r\n\t\tgetElement: function() {\r\n\t\t\tif (!this.targetElm) {\r\n\t\t\t\tthis.targetElm = DOM.get(this.id);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.targetElm;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the iframes window object.\r\n\t\t *\r\n\t\t * @method getWin\r\n\t\t * @return {Window} Iframe DOM window object.\r\n\t\t */\r\n\t\tgetWin: function() {\r\n\t\t\tvar self = this, elm;\r\n\r\n\t\t\tif (!self.contentWindow) {\r\n\t\t\t\telm = self.iframeElement;\r\n\r\n\t\t\t\tif (elm) {\r\n\t\t\t\t\tself.contentWindow = elm.contentWindow;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn self.contentWindow;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the iframes document object.\r\n\t\t *\r\n\t\t * @method getDoc\r\n\t\t * @return {Document} Iframe DOM document object.\r\n\t\t */\r\n\t\tgetDoc: function() {\r\n\t\t\tvar self = this, win;\r\n\r\n\t\t\tif (!self.contentDocument) {\r\n\t\t\t\twin = self.getWin();\r\n\r\n\t\t\t\tif (win) {\r\n\t\t\t\t\tself.contentDocument = win.document;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn self.contentDocument;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the root element of the editable area.\r\n\t\t * For a non-inline iframe-based editor, returns the iframe's body element.\r\n\t\t *\r\n\t\t * @method getBody\r\n\t\t * @return {Element} The root element of the editable area.\r\n\t\t */\r\n\t\tgetBody: function() {\r\n\t\t\treturn this.bodyElement || this.getDoc().body;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * URL converter function this gets executed each time a user adds an img, a or\r\n\t\t * any other element that has a URL in it. This will be called both by the DOM and HTML\r\n\t\t * manipulation functions.\r\n\t\t *\r\n\t\t * @method convertURL\r\n\t\t * @param {string} url URL to convert.\r\n\t\t * @param {string} name Attribute name src, href etc.\r\n\t\t * @param {string/HTMLElement} elm Tag name or HTML DOM element depending on HTML or DOM insert.\r\n\t\t * @return {string} Converted URL string.\r\n\t\t */\r\n\t\tconvertURL: function(url, name, elm) {\r\n\t\t\tvar self = this, settings = self.settings;\r\n\r\n\t\t\t// Use callback instead\r\n\t\t\tif (settings.urlconverter_callback) {\r\n\t\t\t\treturn self.execCallback('urlconverter_callback', url, elm, true, name);\r\n\t\t\t}\r\n\r\n\t\t\t// Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs\r\n\t\t\tif (!settings.convert_urls || (elm && elm.nodeName == 'LINK') || url.indexOf('file:') === 0 || url.length === 0) {\r\n\t\t\t\treturn url;\r\n\t\t\t}\r\n\r\n\t\t\t// Convert to relative\r\n\t\t\tif (settings.relative_urls) {\r\n\t\t\t\treturn self.documentBaseURI.toRelative(url);\r\n\t\t\t}\r\n\r\n\t\t\t// Convert to absolute\r\n\t\t\turl = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\r\n\r\n\t\t\treturn url;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds visual aid for tables, anchors etc so they can be more easily edited inside the editor.\r\n\t\t *\r\n\t\t * @method addVisual\r\n\t\t * @param {Element} elm Optional root element to loop though to find tables etc that needs the visual aid.\r\n\t\t */\r\n\t\taddVisual: function(elm) {\r\n\t\t\tvar self = this, settings = self.settings, dom = self.dom, cls;\r\n\r\n\t\t\telm = elm || self.getBody();\r\n\r\n\t\t\tif (self.hasVisual === undefined) {\r\n\t\t\t\tself.hasVisual = settings.visual;\r\n\t\t\t}\r\n\r\n\t\t\teach(dom.select('table,a', elm), function(elm) {\r\n\t\t\t\tvar value;\r\n\r\n\t\t\t\tswitch (elm.nodeName) {\r\n\t\t\t\t\tcase 'TABLE':\r\n\t\t\t\t\t\tcls = settings.visual_table_class || 'mce-item-table';\r\n\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'border');\r\n\r\n\t\t\t\t\t\tif ((!value || value == '0') && self.hasVisual) {\r\n\t\t\t\t\t\t\tdom.addClass(elm, cls);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdom.removeClass(elm, cls);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tcase 'A':\r\n\t\t\t\t\t\tif (!dom.getAttrib(elm, 'href', false)) {\r\n\t\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'name') || elm.id;\r\n\t\t\t\t\t\t\tcls = settings.visual_anchor_class || 'mce-item-anchor';\r\n\r\n\t\t\t\t\t\t\tif (value && self.hasVisual) {\r\n\t\t\t\t\t\t\t\tdom.addClass(elm, cls);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdom.removeClass(elm, cls);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.fire('VisualAid', {element: elm, hasVisual: self.hasVisual});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the editor from the dom and tinymce collection.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!self.removed) {\r\n\t\t\t\tself.save();\r\n\t\t\t\tself.removed = 1;\r\n\t\t\t\tself.unbindAllNativeEvents();\r\n\r\n\t\t\t\t// Remove any hidden input\r\n\t\t\t\tif (self.hasHiddenInput) {\r\n\t\t\t\t\tDOM.remove(self.getElement().nextSibling);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!self.inline) {\r\n\t\t\t\t\t// IE 9 has a bug where the selection stops working if you place the\r\n\t\t\t\t\t// caret inside the editor then remove the iframe\r\n\t\t\t\t\tif (ie && ie < 10) {\r\n\t\t\t\t\t\tself.getDoc().execCommand('SelectAll', false, null);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\r\n\t\t\t\t\tself.getBody().onload = null; // Prevent #6816\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.fire('remove');\r\n\r\n\t\t\t\tself.editorManager.remove(self);\r\n\t\t\t\tDOM.remove(self.getContainer());\r\n\t\t\t\tself._selectionOverrides.destroy();\r\n\t\t\t\tself.editorUpload.destroy();\r\n\t\t\t\tself.destroy();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Destroys the editor instance by removing all events, element references or other resources\r\n\t\t * that could leak memory. This method will be called automatically when the page is unloaded\r\n\t\t * but you can also call it directly if you know what you are doing.\r\n\t\t *\r\n\t\t * @method destroy\r\n\t\t * @param {Boolean} automatic Optional state if the destroy is an automatic destroy or user called one.\r\n\t\t */\r\n\t\tdestroy: function(automatic) {\r\n\t\t\tvar self = this, form;\r\n\r\n\t\t\t// One time is enough\r\n\t\t\tif (self.destroyed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If user manually calls destroy and not remove\r\n\t\t\t// Users seems to have logic that calls destroy instead of remove\r\n\t\t\tif (!automatic && !self.removed) {\r\n\t\t\t\tself.remove();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!automatic) {\r\n\t\t\t\tself.editorManager.off('beforeunload', self._beforeUnload);\r\n\r\n\t\t\t\t// Manual destroy\r\n\t\t\t\tif (self.theme && self.theme.destroy) {\r\n\t\t\t\t\tself.theme.destroy();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Destroy controls, selection and dom\r\n\t\t\t\tself.selection.destroy();\r\n\t\t\t\tself.dom.destroy();\r\n\t\t\t}\r\n\r\n\t\t\tform = self.formElement;\r\n\t\t\tif (form) {\r\n\t\t\t\tif (form._mceOldSubmit) {\r\n\t\t\t\t\tform.submit = form._mceOldSubmit;\r\n\t\t\t\t\tform._mceOldSubmit = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDOM.unbind(form, 'submit reset', self.formEventDelegate);\r\n\t\t\t}\r\n\r\n\t\t\tself.contentAreaContainer = self.formElement = self.container = self.editorContainer = null;\r\n\t\t\tself.bodyElement = self.contentDocument = self.contentWindow = null;\r\n\t\t\tself.iframeElement = self.targetElm = null;\r\n\r\n\t\t\tif (self.selection) {\r\n\t\t\t\tself.selection = self.selection.win = self.selection.dom = self.selection.dom.doc = null;\r\n\t\t\t}\r\n\r\n\t\t\tself.destroyed = 1;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Uploads all data uri/blob uri images in the editor contents to server.\r\n\t\t *\r\n\t\t * @method uploadImages\r\n\t\t * @param {function} callback Optional callback with images and status for each image.\r\n\t\t * @return {tinymce.util.Promise} Promise instance.\r\n\t\t */\r\n\t\tuploadImages: function(callback) {\r\n\t\t\treturn this.editorUpload.uploadImages(callback);\r\n\t\t},\r\n\r\n\t\t// Internal functions\r\n\r\n\t\t_scanForImages: function() {\r\n\t\t\treturn this.editorUpload.scanForImages();\r\n\t\t}\r\n\t};\r\n\r\n\textend(Editor.prototype, EditorObservable);\r\n\r\n\treturn Editor;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/I18n.js\r\n\r\n/**\r\n * I18n.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * I18n class that handles translation of TinyMCE UI.\r\n * Uses po style with csharp style parameters.\r\n *\r\n * @class tinymce.util.I18n\r\n */\r\ndefine(\"tinymce/util/I18n\", [], function() {\r\n\t\"use strict\";\r\n\r\n\tvar data = {}, code = \"en\";\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Sets the current language code.\r\n\t\t *\r\n\t\t * @method setCode\r\n\t\t * @param {String} newCode Current language code.\r\n\t\t */\r\n\t\tsetCode: function(newCode) {\r\n\t\t\tif (newCode) {\r\n\t\t\t\tcode = newCode;\r\n\t\t\t\tthis.rtl = this.data[newCode] ? this.data[newCode]._dir === 'rtl' : false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the current language code.\r\n\t\t *\r\n\t\t * @method getCode\r\n\t\t * @return {String} Current language code.\r\n\t\t */\r\n\t\tgetCode: function() {\r\n\t\t\treturn code;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Property gets set to true if a RTL language pack was loaded.\r\n\t\t *\r\n\t\t * @property rtl\r\n\t\t * @type Boolean\r\n\t\t */\r\n\t\trtl: false,\r\n\r\n\t\t/**\r\n\t\t * Adds translations for a specific language code.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {String} code Language code like sv_SE.\r\n\t\t * @param {Array} items Name/value array with English en_US to sv_SE.\r\n\t\t */\r\n\t\tadd: function(code, items) {\r\n\t\t\tvar langData = data[code];\r\n\r\n\t\t\tif (!langData) {\r\n\t\t\t\tdata[code] = langData = {};\r\n\t\t\t}\r\n\r\n\t\t\tfor (var name in items) {\r\n\t\t\t\tlangData[name] = items[name];\r\n\t\t\t}\r\n\r\n\t\t\tthis.setCode(code);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Translates the specified text.\r\n\t\t *\r\n\t\t * It has a few formats:\r\n\t\t * I18n.translate(\"Text\");\r\n\t\t * I18n.translate([\"Text {0}/{1}\", 0, 1]);\r\n\t\t * I18n.translate({raw: \"Raw string\"});\r\n\t\t *\r\n\t\t * @method translate\r\n\t\t * @param {String/Object/Array} text Text to translate.\r\n\t\t * @return {String} String that got translated.\r\n\t\t */\r\n\t\ttranslate: function(text) {\r\n\t\t\tvar langData;\r\n\r\n\t\t\tlangData = data[code];\r\n\t\t\tif (!langData) {\r\n\t\t\t\tlangData = {};\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof text == \"undefined\") {\r\n\t\t\t\treturn text;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof text != \"string\" && text.raw) {\r\n\t\t\t\treturn text.raw;\r\n\t\t\t}\r\n\r\n\t\t\tif (text.push) {\r\n\t\t\t\tvar values = text.slice(1);\r\n\r\n\t\t\t\ttext = (langData[text[0]] || text[0]).replace(/\\{([0-9]+)\\}/g, function(match1, match2) {\r\n\t\t\t\t\treturn values[match2];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn (langData[text] || text).replace(/{context:\\w+}$/, '');\r\n\t\t},\r\n\r\n\t\tdata: data\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/FocusManager.js\r\n\r\n/**\r\n * FocusManager.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class manages the focus/blur state of the editor. This class is needed since some\r\n * browsers fire false focus/blur states when the selection is moved to a UI dialog or similar.\r\n *\r\n * This class will fire two events focus and blur on the editor instances that got affected.\r\n * It will also handle the restore of selection when the focus is lost and returned.\r\n *\r\n * @class tinymce.FocusManager\r\n */\r\ndefine(\"tinymce/FocusManager\", [\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/util/Delay\",\r\n\t\"tinymce/Env\"\r\n], function(DOMUtils, Delay, Env) {\r\n\tvar selectionChangeHandler, documentFocusInHandler, documentMouseUpHandler, DOM = DOMUtils.DOM;\r\n\r\n\t/**\r\n\t * Constructs a new focus manager instance.\r\n\t *\r\n\t * @constructor FocusManager\r\n\t * @param {tinymce.EditorManager} editorManager Editor manager instance to handle focus for.\r\n\t */\r\n\tfunction FocusManager(editorManager) {\r\n\t\tfunction getActiveElement() {\r\n\t\t\ttry {\r\n\t\t\t\treturn document.activeElement;\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// IE sometimes fails to get the activeElement when resizing table\r\n\t\t\t\t// TODO: Investigate this\r\n\t\t\t\treturn document.body;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// We can't store a real range on IE 11 since it gets mutated so we need to use a bookmark object\r\n\t\t// TODO: Move this to a separate range utils class since it's it's logic is present in Selection as well.\r\n\t\tfunction createBookmark(dom, rng) {\r\n\t\t\tif (rng && rng.startContainer) {\r\n\t\t\t\t// Verify that the range is within the root of the editor\r\n\t\t\t\tif (!dom.isChildOf(rng.startContainer, dom.getRoot()) || !dom.isChildOf(rng.endContainer, dom.getRoot())) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstartContainer: rng.startContainer,\r\n\t\t\t\t\tstartOffset: rng.startOffset,\r\n\t\t\t\t\tendContainer: rng.endContainer,\r\n\t\t\t\t\tendOffset: rng.endOffset\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn rng;\r\n\t\t}\r\n\r\n\t\tfunction bookmarkToRng(editor, bookmark) {\r\n\t\t\tvar rng;\r\n\r\n\t\t\tif (bookmark.startContainer) {\r\n\t\t\t\trng = editor.getDoc().createRange();\r\n\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\r\n\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\r\n\t\t\t} else {\r\n\t\t\t\trng = bookmark;\r\n\t\t\t}\r\n\r\n\t\t\treturn rng;\r\n\t\t}\r\n\r\n\t\tfunction isUIElement(elm) {\r\n\t\t\treturn !!DOM.getParent(elm, FocusManager.isEditorUIElement);\r\n\t\t}\r\n\r\n\t\tfunction registerEvents(e) {\r\n\t\t\tvar editor = e.editor;\r\n\r\n\t\t\teditor.on('init', function() {\r\n\t\t\t\t// Gecko/WebKit has ghost selections in iframes and IE only has one selection per browser tab\r\n\t\t\t\tif (editor.inline || Env.ie) {\r\n\t\t\t\t\t// Use the onbeforedeactivate event when available since it works better see #7023\r\n\t\t\t\t\tif (\"onbeforedeactivate\" in document && Env.ie < 9) {\r\n\t\t\t\t\t\teditor.dom.bind(editor.getBody(), 'beforedeactivate', function(e) {\r\n\t\t\t\t\t\t\tif (e.target != editor.getBody()) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\r\n\t\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t\t// IE throws \"Unexcpected call to method or property access\" some times so lets ignore it\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// On other browsers take snapshot on nodechange in inline mode since they have Ghost selections for iframes\r\n\t\t\t\t\t\teditor.on('nodechange mouseup keyup', function(e) {\r\n\t\t\t\t\t\t\tvar node = getActiveElement();\r\n\r\n\t\t\t\t\t\t\t// Only act on manual nodechanges\r\n\t\t\t\t\t\t\tif (e.type == 'nodechange' && e.selectionChange) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// IE 11 reports active element as iframe not body of iframe\r\n\t\t\t\t\t\t\tif (node && node.id == editor.id + '_ifr') {\r\n\t\t\t\t\t\t\t\tnode = editor.getBody();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (editor.dom.isChildOf(node, editor.getBody())) {\r\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Handles the issue with WebKit not retaining selection within inline document\r\n\t\t\t\t\t// If the user releases the mouse out side the body since a mouse up event wont occur on the body\r\n\t\t\t\t\tif (Env.webkit && !selectionChangeHandler) {\r\n\t\t\t\t\t\tselectionChangeHandler = function() {\r\n\t\t\t\t\t\t\tvar activeEditor = editorManager.activeEditor;\r\n\r\n\t\t\t\t\t\t\tif (activeEditor && activeEditor.selection) {\r\n\t\t\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\r\n\r\n\t\t\t\t\t\t\t\t// Store when it's non collapsed\r\n\t\t\t\t\t\t\t\tif (rng && !rng.collapsed) {\r\n\t\t\t\t\t\t\t\t\teditor.lastRng = rng;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tDOM.bind(document, 'selectionchange', selectionChangeHandler);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('setcontent', function() {\r\n\t\t\t\teditor.lastRng = null;\r\n\t\t\t});\r\n\r\n\t\t\t// Remove last selection bookmark on mousedown see #6305\r\n\t\t\teditor.on('mousedown', function() {\r\n\t\t\t\teditor.selection.lastFocusBookmark = null;\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('focusin', function() {\r\n\t\t\t\tvar focusedEditor = editorManager.focusedEditor, lastRng;\r\n\r\n\t\t\t\tif (editor.selection.lastFocusBookmark) {\r\n\t\t\t\t\tlastRng = bookmarkToRng(editor, editor.selection.lastFocusBookmark);\r\n\t\t\t\t\teditor.selection.lastFocusBookmark = null;\r\n\t\t\t\t\teditor.selection.setRng(lastRng);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (focusedEditor != editor) {\r\n\t\t\t\t\tif (focusedEditor) {\r\n\t\t\t\t\t\tfocusedEditor.fire('blur', {focusedEditor: editor});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\teditorManager.setActive(editor);\r\n\t\t\t\t\teditorManager.focusedEditor = editor;\r\n\t\t\t\t\teditor.fire('focus', {blurredEditor: focusedEditor});\r\n\t\t\t\t\teditor.focus(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\teditor.lastRng = null;\r\n\t\t\t});\r\n\r\n\t\t\teditor.on('focusout', function() {\r\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\r\n\t\t\t\t\tvar focusedEditor = editorManager.focusedEditor;\r\n\r\n\t\t\t\t\t// Still the same editor the blur was outside any editor UI\r\n\t\t\t\t\tif (!isUIElement(getActiveElement()) && focusedEditor == editor) {\r\n\t\t\t\t\t\teditor.fire('blur', {focusedEditor: null});\r\n\t\t\t\t\t\teditorManager.focusedEditor = null;\r\n\r\n\t\t\t\t\t\t// Make sure selection is valid could be invalid if the editor is blured and removed before the timeout occurs\r\n\t\t\t\t\t\tif (editor.selection) {\r\n\t\t\t\t\t\t\teditor.selection.lastFocusBookmark = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Check if focus is moved to an element outside the active editor by checking if the target node\r\n\t\t\t// isn't within the body of the activeEditor nor a UI element such as a dialog child control\r\n\t\t\tif (!documentFocusInHandler) {\r\n\t\t\t\tdocumentFocusInHandler = function(e) {\r\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, target;\r\n\r\n\t\t\t\t\ttarget = e.target;\r\n\r\n\t\t\t\t\tif (activeEditor && target.ownerDocument == document) {\r\n\t\t\t\t\t\t// Check to make sure we have a valid selection don't update the bookmark if it's\r\n\t\t\t\t\t\t// a focusin to the body of the editor see #7025\r\n\t\t\t\t\t\tif (activeEditor.selection && target != activeEditor.getBody()) {\r\n\t\t\t\t\t\t\tactiveEditor.selection.lastFocusBookmark = createBookmark(activeEditor.dom, activeEditor.lastRng);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Fire a blur event if the element isn't a UI element\r\n\t\t\t\t\t\tif (target != document.body && !isUIElement(target) && editorManager.focusedEditor == activeEditor) {\r\n\t\t\t\t\t\t\tactiveEditor.fire('blur', {focusedEditor: null});\r\n\t\t\t\t\t\t\teditorManager.focusedEditor = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tDOM.bind(document, 'focusin', documentFocusInHandler);\r\n\t\t\t}\r\n\r\n\t\t\t// Handle edge case when user starts the selection inside the editor and releases\r\n\t\t\t// the mouse outside the editor producing a new selection. This weird workaround is needed since\r\n\t\t\t// Gecko doesn't have the \"selectionchange\" event we need to do this. Fixes: #6843\r\n\t\t\tif (editor.inline && !documentMouseUpHandler) {\r\n\t\t\t\tdocumentMouseUpHandler = function(e) {\r\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, dom = activeEditor.dom;\r\n\r\n\t\t\t\t\tif (activeEditor.inline && dom && !dom.isChildOf(e.target, activeEditor.getBody())) {\r\n\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\r\n\r\n\t\t\t\t\t\tif (!rng.collapsed) {\r\n\t\t\t\t\t\t\tactiveEditor.lastRng = rng;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tDOM.bind(document, 'mouseup', documentMouseUpHandler);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction unregisterDocumentEvents(e) {\r\n\t\t\tif (editorManager.focusedEditor == e.editor) {\r\n\t\t\t\teditorManager.focusedEditor = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (!editorManager.activeEditor) {\r\n\t\t\t\tDOM.unbind(document, 'selectionchange', selectionChangeHandler);\r\n\t\t\t\tDOM.unbind(document, 'focusin', documentFocusInHandler);\r\n\t\t\t\tDOM.unbind(document, 'mouseup', documentMouseUpHandler);\r\n\t\t\t\tselectionChangeHandler = documentFocusInHandler = documentMouseUpHandler = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\teditorManager.on('AddEditor', registerEvents);\r\n\t\teditorManager.on('RemoveEditor', unregisterDocumentEvents);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if the specified element is part of the UI for example an button or text input.\r\n\t *\r\n\t * @method isEditorUIElement\r\n\t * @param  {Element} elm Element to check if it's part of the UI or not.\r\n\t * @return {Boolean} True/false state if the element is part of the UI or not.\r\n\t */\r\n\tFocusManager.isEditorUIElement = function(elm) {\r\n\t\t// Needs to be converted to string since svg can have focus: #6776\r\n\t\treturn elm.className.toString().indexOf('mce-') !== -1;\r\n\t};\r\n\r\n\treturn FocusManager;\r\n});\r\n\r\n// Included from: js/tinymce/classes/EditorManager.js\r\n\r\n/**\r\n * EditorManager.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class used as a factory for manager for tinymce.Editor instances.\r\n *\r\n * @example\r\n * tinymce.EditorManager.init({});\r\n *\r\n * @class tinymce.EditorManager\r\n * @mixes tinymce.util.Observable\r\n * @static\r\n */\r\ndefine(\"tinymce/EditorManager\", [\r\n\t\"tinymce/Editor\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/util/URI\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/util/Promise\",\r\n\t\"tinymce/util/Observable\",\r\n\t\"tinymce/util/I18n\",\r\n\t\"tinymce/FocusManager\"\r\n], function(Editor, $, DOMUtils, URI, Env, Tools, Promise, Observable, I18n, FocusManager) {\r\n\tvar DOM = DOMUtils.DOM;\r\n\tvar explode = Tools.explode, each = Tools.each, extend = Tools.extend;\r\n\tvar instanceCounter = 0, beforeUnloadDelegate, EditorManager, boundGlobalEvents = false;\r\n\r\n\tfunction globalEventDelegate(e) {\r\n\t\teach(EditorManager.editors, function(editor) {\r\n\t\t\tif (e.type === 'scroll') {\r\n\t\t\t\teditor.fire('ScrollWindow', e);\r\n\t\t\t} else {\r\n\t\t\t\teditor.fire('ResizeWindow', e);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction toggleGlobalEvents(editors, state) {\r\n\t\tif (state !== boundGlobalEvents) {\r\n\t\t\tif (state) {\r\n\t\t\t\t$(window).on('resize scroll', globalEventDelegate);\r\n\t\t\t} else {\r\n\t\t\t\t$(window).off('resize scroll', globalEventDelegate);\r\n\t\t\t}\r\n\r\n\t\t\tboundGlobalEvents = state;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction removeEditorFromList(editor) {\r\n\t\tvar editors = EditorManager.editors, removedFromList;\r\n\r\n\t\tdelete editors[editor.id];\r\n\r\n\t\tfor (var i = 0; i < editors.length; i++) {\r\n\t\t\tif (editors[i] == editor) {\r\n\t\t\t\teditors.splice(i, 1);\r\n\t\t\t\tremovedFromList = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Select another editor since the active one was removed\r\n\t\tif (EditorManager.activeEditor == editor) {\r\n\t\t\tEditorManager.activeEditor = editors[0];\r\n\t\t}\r\n\r\n\t\t// Clear focusedEditor if necessary, so that we don't try to blur the destroyed editor\r\n\t\tif (EditorManager.focusedEditor == editor) {\r\n\t\t\tEditorManager.focusedEditor = null;\r\n\t\t}\r\n\r\n\t\treturn removedFromList;\r\n\t}\r\n\r\n\tfunction purgeDestroyedEditor(editor) {\r\n\t\t// User has manually destroyed the editor lets clean up the mess\r\n\t\tif (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\r\n\t\t\tremoveEditorFromList(editor);\r\n\t\t\teditor.unbindAllNativeEvents();\r\n\t\t\teditor.destroy(true);\r\n\t\t\teditor.removed = true;\r\n\t\t\teditor = null;\r\n\t\t}\r\n\r\n\t\treturn editor;\r\n\t}\r\n\r\n\tEditorManager = {\r\n\t\t/**\r\n\t\t * Dom query instance.\r\n\t\t *\r\n\t\t * @property $\r\n\t\t * @type tinymce.dom.DomQuery\r\n\t\t */\r\n\t\t$: $,\r\n\r\n\t\t/**\r\n\t\t * Major version of TinyMCE build.\r\n\t\t *\r\n\t\t * @property majorVersion\r\n\t\t * @type String\r\n\t\t */\r\n\t\tmajorVersion: '4',\r\n\r\n\t\t/**\r\n\t\t * Minor version of TinyMCE build.\r\n\t\t *\r\n\t\t * @property minorVersion\r\n\t\t * @type String\r\n\t\t */\r\n\t\tminorVersion: '4.0',\r\n\r\n\t\t/**\r\n\t\t * Release date of TinyMCE build.\r\n\t\t *\r\n\t\t * @property releaseDate\r\n\t\t * @type String\r\n\t\t */\r\n\t\treleaseDate: '2016-06-30',\r\n\r\n\t\t/**\r\n\t\t * Collection of editor instances.\r\n\t\t *\r\n\t\t * @property editors\r\n\t\t * @type Object\r\n\t\t * @example\r\n\t\t * for (edId in tinymce.editors)\r\n\t\t *     tinymce.editors[edId].save();\r\n\t\t */\r\n\t\teditors: [],\r\n\r\n\t\t/**\r\n\t\t * Collection of language pack data.\r\n\t\t *\r\n\t\t * @property i18n\r\n\t\t * @type Object\r\n\t\t */\r\n\t\ti18n: I18n,\r\n\r\n\t\t/**\r\n\t\t * Currently active editor instance.\r\n\t\t *\r\n\t\t * @property activeEditor\r\n\t\t * @type tinymce.Editor\r\n\t\t * @example\r\n\t\t * tinyMCE.activeEditor.selection.getContent();\r\n\t\t * tinymce.EditorManager.activeEditor.selection.getContent();\r\n\t\t */\r\n\t\tactiveEditor: null,\r\n\r\n\t\tsetup: function() {\r\n\t\t\tvar self = this, baseURL, documentBaseURL, suffix = \"\", preInit, src;\r\n\r\n\t\t\t// Get base URL for the current document\r\n\t\t\tdocumentBaseURL = URI.getDocumentBaseUrl(document.location);\r\n\r\n\t\t\t// Check if the URL is a document based format like: http://site/dir/file and file:///\r\n\t\t\t// leave other formats like applewebdata://... intact\r\n\t\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\r\n\t\t\t\tdocumentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\r\n\r\n\t\t\t\tif (!/[\\/\\\\]$/.test(documentBaseURL)) {\r\n\t\t\t\t\tdocumentBaseURL += '/';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If tinymce is defined and has a base use that or use the old tinyMCEPreInit\r\n\t\t\tpreInit = window.tinymce || window.tinyMCEPreInit;\r\n\t\t\tif (preInit) {\r\n\t\t\t\tbaseURL = preInit.base || preInit.baseURL;\r\n\t\t\t\tsuffix = preInit.suffix;\r\n\t\t\t} else {\r\n\t\t\t\t// Get base where the tinymce script is located\r\n\t\t\t\tvar scripts = document.getElementsByTagName('script');\r\n\t\t\t\tfor (var i = 0; i < scripts.length; i++) {\r\n\t\t\t\t\tsrc = scripts[i].src;\r\n\r\n\t\t\t\t\t// Script types supported:\r\n\t\t\t\t\t// tinymce.js tinymce.min.js tinymce.dev.js\r\n\t\t\t\t\t// tinymce.jquery.js tinymce.jquery.min.js tinymce.jquery.dev.js\r\n\t\t\t\t\t// tinymce.full.js tinymce.full.min.js tinymce.full.dev.js\r\n\t\t\t\t\tvar srcScript = src.substring(src.lastIndexOf('/'));\r\n\t\t\t\t\tif (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\r\n\t\t\t\t\t\tif (srcScript.indexOf('.min') != -1) {\r\n\t\t\t\t\t\t\tsuffix = '.min';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// We didn't find any baseURL by looking at the script elements\r\n\t\t\t\t// Try to use the document.currentScript as a fallback\r\n\t\t\t\tif (!baseURL && document.currentScript) {\r\n\t\t\t\t\tsrc = document.currentScript.src;\r\n\r\n\t\t\t\t\tif (src.indexOf('.min') != -1) {\r\n\t\t\t\t\t\tsuffix = '.min';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Base URL where the root directory if TinyMCE is located.\r\n\t\t\t *\r\n\t\t\t * @property baseURL\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tself.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\r\n\r\n\t\t\t/**\r\n\t\t\t * Document base URL where the current document is located.\r\n\t\t\t *\r\n\t\t\t * @property documentBaseURL\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tself.documentBaseURL = documentBaseURL;\r\n\r\n\t\t\t/**\r\n\t\t\t * Absolute baseURI for the installation path of TinyMCE.\r\n\t\t\t *\r\n\t\t\t * @property baseURI\r\n\t\t\t * @type tinymce.util.URI\r\n\t\t\t */\r\n\t\t\tself.baseURI = new URI(self.baseURL);\r\n\r\n\t\t\t/**\r\n\t\t\t * Current suffix to add to each plugin/theme that gets loaded for example \".min\".\r\n\t\t\t *\r\n\t\t\t * @property suffix\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tself.suffix = suffix;\r\n\r\n\t\t\tself.focusManager = new FocusManager(self);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Overrides the default settings for editor instances.\r\n\t\t *\r\n\t\t * @method overrideDefaults\r\n\t\t * @param {Object} defaultSettings Defaults settings object.\r\n\t\t */\r\n\t\toverrideDefaults: function(defaultSettings) {\r\n\t\t\tvar baseUrl, suffix;\r\n\r\n\t\t\tbaseUrl = defaultSettings.base_url;\r\n\t\t\tif (baseUrl) {\r\n\t\t\t\tthis.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\r\n\t\t\t\tthis.baseURI = new URI(this.baseURL);\r\n\t\t\t}\r\n\r\n\t\t\tsuffix = defaultSettings.suffix;\r\n\t\t\tif (defaultSettings.suffix) {\r\n\t\t\t\tthis.suffix = suffix;\r\n\t\t\t}\r\n\r\n\t\t\tthis.defaultSettings = defaultSettings;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Initializes a set of editors. This method will create editors based on various settings.\r\n\t\t *\r\n\t\t * @method init\r\n\t\t * @param {Object} settings Settings object to be passed to each editor instance.\r\n\t\t * @return {tinymce.util.Promise} Promise that gets resolved with an array of editors when all editor instances are initialized.\r\n\t\t * @example\r\n\t\t * // Initializes a editor using the longer method\r\n\t\t * tinymce.EditorManager.init({\r\n\t\t *    some_settings : 'some value'\r\n\t\t * });\r\n\t\t *\r\n\t\t * // Initializes a editor instance using the shorter version and with a promise\r\n\t\t * tinymce.init({\r\n\t\t *    some_settings : 'some value'\r\n\t\t * }).then(function(editors) {\r\n\t\t *    ...\r\n\t\t * });\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this, result, invalidInlineTargets;\r\n\r\n\t\t\tinvalidInlineTargets = Tools.makeMap(\r\n\t\t\t\t'area base basefont br col frame hr img input isindex link meta param embed source wbr track ' +\r\n\t\t\t\t'colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu',\r\n\t\t\t\t' '\r\n\t\t\t);\r\n\r\n\t\t\tfunction isInvalidInlineTarget(settings, elm) {\r\n\t\t\t\treturn settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\r\n\t\t\t}\r\n\r\n\t\t\tfunction report(msg, elm) {\r\n\t\t\t\t// Log in a non test environment\r\n\t\t\t\tif (window.console && !window.test) {\r\n\t\t\t\t\twindow.console.log(msg, elm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction createId(elm) {\r\n\t\t\t\tvar id = elm.id;\r\n\r\n\t\t\t\t// Use element id, or unique name or generate a unique id\r\n\t\t\t\tif (!id) {\r\n\t\t\t\t\tid = elm.name;\r\n\r\n\t\t\t\t\tif (id && !DOM.get(id)) {\r\n\t\t\t\t\t\tid = elm.name;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Generate unique name\r\n\t\t\t\t\t\tid = DOM.uniqueId();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telm.setAttribute('id', id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn id;\r\n\t\t\t}\r\n\r\n\t\t\tfunction execCallback(name) {\r\n\t\t\t\tvar callback = settings[name];\r\n\r\n\t\t\t\tif (!callback) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback.apply(self, Array.prototype.slice.call(arguments, 2));\r\n\t\t\t}\r\n\r\n\t\t\tfunction hasClass(elm, className) {\r\n\t\t\t\treturn className.constructor === RegExp ? className.test(elm.className) : DOM.hasClass(elm, className);\r\n\t\t\t}\r\n\r\n\t\t\tfunction findTargets(settings) {\r\n\t\t\t\tvar l, targets = [];\r\n\r\n\t\t\t\tif (settings.types) {\r\n\t\t\t\t\teach(settings.types, function(type) {\r\n\t\t\t\t\t\ttargets = targets.concat(DOM.select(type.selector));\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn targets;\r\n\t\t\t\t} else if (settings.selector) {\r\n\t\t\t\t\treturn DOM.select(settings.selector);\r\n\t\t\t\t} else if (settings.target) {\r\n\t\t\t\t\treturn [settings.target];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fallback to old setting\r\n\t\t\t\tswitch (settings.mode) {\r\n\t\t\t\t\tcase \"exact\":\r\n\t\t\t\t\t\tl = settings.elements || '';\r\n\r\n\t\t\t\t\t\tif (l.length > 0) {\r\n\t\t\t\t\t\t\teach(explode(l), function(id) {\r\n\t\t\t\t\t\t\t\tvar elm;\r\n\r\n\t\t\t\t\t\t\t\tif ((elm = DOM.get(id))) {\r\n\t\t\t\t\t\t\t\t\ttargets.push(elm);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\teach(document.forms, function(f) {\r\n\t\t\t\t\t\t\t\t\t\teach(f.elements, function(e) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (e.name === id) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tid = 'mce_editor_' + instanceCounter++;\r\n\t\t\t\t\t\t\t\t\t\t\t\tDOM.setAttrib(e, 'id', id);\r\n\t\t\t\t\t\t\t\t\t\t\t\ttargets.push(e);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"textareas\":\r\n\t\t\t\t\tcase \"specific_textareas\":\r\n\t\t\t\t\t\teach(DOM.select('textarea'), function(elm) {\r\n\t\t\t\t\t\t\tif (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\r\n\t\t\t\t\t\t\t\ttargets.push(elm);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn targets;\r\n\t\t\t}\r\n\r\n\t\t\tvar provideResults = function(editors) {\r\n\t\t\t\tresult = editors;\r\n\t\t\t};\r\n\r\n\t\t\tfunction initEditors() {\r\n\t\t\t\tvar initCount = 0, editors = [], targets;\r\n\r\n\t\t\t\tfunction createEditor(id, settings, targetElm) {\r\n\t\t\t\t\tvar editor = new Editor(id, settings, self);\r\n\r\n\t\t\t\t\teditors.push(editor);\r\n\r\n\t\t\t\t\teditor.on('init', function() {\r\n\t\t\t\t\t\tif (++initCount === targets.length) {\r\n\t\t\t\t\t\t\tprovideResults(editors);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teditor.targetElm = editor.targetElm || targetElm;\r\n\t\t\t\t\teditor.render();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDOM.unbind(window, 'ready', initEditors);\r\n\t\t\t\texecCallback('onpageload');\r\n\r\n\t\t\t\ttargets = $.unique(findTargets(settings));\r\n\r\n\t\t\t\t// TODO: Deprecate this one\r\n\t\t\t\tif (settings.types) {\r\n\t\t\t\t\teach(settings.types, function(type) {\r\n\t\t\t\t\t\tTools.each(targets, function(elm) {\r\n\t\t\t\t\t\t\tif (DOM.is(elm, type.selector)) {\r\n\t\t\t\t\t\t\t\tcreateEditor(createId(elm), extend({}, settings, type), elm);\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tTools.each(targets, function(elm) {\r\n\t\t\t\t\tpurgeDestroyedEditor(self.get(elm.id));\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttargets = Tools.grep(targets, function(elm) {\r\n\t\t\t\t\treturn !self.get(elm.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\teach(targets, function(elm) {\r\n\t\t\t\t\tif (isInvalidInlineTarget(settings, elm)) {\r\n\t\t\t\t\t\treport('Could not initialize inline editor on invalid inline target element', elm);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcreateEditor(createId(elm), settings, elm);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tself.settings = settings;\r\n\t\t\tDOM.bind(window, 'ready', initEditors);\r\n\r\n\t\t\treturn new Promise(function(resolve) {\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprovideResults = function(editors) {\r\n\t\t\t\t\t\tresolve(editors);\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a editor instance by id.\r\n\t\t *\r\n\t\t * @method get\r\n\t\t * @param {String/Number} id Editor instance id or index to return.\r\n\t\t * @return {tinymce.Editor} Editor instance to return.\r\n\t\t * @example\r\n\t\t * // Adds an onclick event to an editor by id (shorter version)\r\n\t\t * tinymce.get('mytextbox').on('click', function(e) {\r\n\t\t *    ed.windowManager.alert('Hello world!');\r\n\t\t * });\r\n\t\t *\r\n\t\t * // Adds an onclick event to an editor by id (longer version)\r\n\t\t * tinymce.EditorManager.get('mytextbox').on('click', function(e) {\r\n\t\t *    ed.windowManager.alert('Hello world!');\r\n\t\t * });\r\n\t\t */\r\n\t\tget: function(id) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn this.editors;\r\n\t\t\t}\r\n\r\n\t\t\treturn id in this.editors ? this.editors[id] : null;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds an editor instance to the editor collection. This will also set it as the active editor.\r\n\t\t *\r\n\t\t * @method add\r\n\t\t * @param {tinymce.Editor} editor Editor instance to add to the collection.\r\n\t\t * @return {tinymce.Editor} The same instance that got passed in.\r\n\t\t */\r\n\t\tadd: function(editor) {\r\n\t\t\tvar self = this, editors = self.editors;\r\n\r\n\t\t\t// Add named and index editor instance\r\n\t\t\teditors[editor.id] = editor;\r\n\t\t\teditors.push(editor);\r\n\r\n\t\t\ttoggleGlobalEvents(editors, true);\r\n\r\n\t\t\t// Doesn't call setActive method since we don't want\r\n\t\t\t// to fire a bunch of activate/deactivate calls while initializing\r\n\t\t\tself.activeEditor = editor;\r\n\r\n\t\t\t/**\r\n\t\t\t * Fires when an editor is added to the EditorManager collection.\r\n\t\t\t *\r\n\t\t\t * @event AddEditor\r\n\t\t\t * @param {Object} e Event arguments.\r\n\t\t\t */\r\n\t\t\tself.fire('AddEditor', {editor: editor});\r\n\r\n\t\t\tif (!beforeUnloadDelegate) {\r\n\t\t\t\tbeforeUnloadDelegate = function() {\r\n\t\t\t\t\tself.fire('BeforeUnload');\r\n\t\t\t\t};\r\n\r\n\t\t\t\tDOM.bind(window, 'beforeunload', beforeUnloadDelegate);\r\n\t\t\t}\r\n\r\n\t\t\treturn editor;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Creates an editor instance and adds it to the EditorManager collection.\r\n\t\t *\r\n\t\t * @method createEditor\r\n\t\t * @param {String} id Instance id to use for editor.\r\n\t\t * @param {Object} settings Editor instance settings.\r\n\t\t * @return {tinymce.Editor} Editor instance that got created.\r\n\t\t */\r\n\t\tcreateEditor: function(id, settings) {\r\n\t\t\treturn this.add(new Editor(id, settings, this));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes a editor or editors form page.\r\n\t\t *\r\n\t\t * @example\r\n\t\t * // Remove all editors bound to divs\r\n\t\t * tinymce.remove('div');\r\n\t\t *\r\n\t\t * // Remove all editors bound to textareas\r\n\t\t * tinymce.remove('textarea');\r\n\t\t *\r\n\t\t * // Remove all editors\r\n\t\t * tinymce.remove();\r\n\t\t *\r\n\t\t * // Remove specific instance by id\r\n\t\t * tinymce.remove('#id');\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t * @param {tinymce.Editor/String/Object} [selector] CSS selector or editor instance to remove.\r\n\t\t * @return {tinymce.Editor} The editor that got passed in will be return if it was found otherwise null.\r\n\t\t */\r\n\t\tremove: function(selector) {\r\n\t\t\tvar self = this, i, editors = self.editors, editor;\r\n\r\n\t\t\t// Remove all editors\r\n\t\t\tif (!selector) {\r\n\t\t\t\tfor (i = editors.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tself.remove(editors[i]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove editors by selector\r\n\t\t\tif (typeof selector == \"string\") {\r\n\t\t\t\tselector = selector.selector || selector;\r\n\r\n\t\t\t\teach(DOM.select(selector), function(elm) {\r\n\t\t\t\t\teditor = editors[elm.id];\r\n\r\n\t\t\t\t\tif (editor) {\r\n\t\t\t\t\t\tself.remove(editor);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove specific editor\r\n\t\t\teditor = selector;\r\n\r\n\t\t\t// Not in the collection\r\n\t\t\tif (!editors[editor.id]) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Fires when an editor is removed from EditorManager collection.\r\n\t\t\t *\r\n\t\t\t * @event RemoveEditor\r\n\t\t\t * @param {Object} e Event arguments.\r\n\t\t\t */\r\n\t\t\tif (removeEditorFromList(editor)) {\r\n\t\t\t\tself.fire('RemoveEditor', {editor: editor});\r\n\t\t\t}\r\n\r\n\t\t\tif (!editors.length) {\r\n\t\t\t\tDOM.unbind(window, 'beforeunload', beforeUnloadDelegate);\r\n\t\t\t}\r\n\r\n\t\t\teditor.remove();\r\n\r\n\t\t\ttoggleGlobalEvents(editors, editors.length > 0);\r\n\r\n\t\t\treturn editor;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Executes a specific command on the currently active editor.\r\n\t\t *\r\n\t\t * @method execCommand\r\n\t\t * @param {String} cmd Command to perform for example Bold.\r\n\t\t * @param {Boolean} ui Optional boolean state if a UI should be presented for the command or not.\r\n\t\t * @param {String} value Optional value parameter like for example an URL to a link.\r\n\t\t * @return {Boolean} true/false if the command was executed or not.\r\n\t\t */\r\n\t\texecCommand: function(cmd, ui, value) {\r\n\t\t\tvar self = this, editor = self.get(value);\r\n\r\n\t\t\t// Manager commands\r\n\t\t\tswitch (cmd) {\r\n\t\t\t\tcase \"mceAddEditor\":\r\n\t\t\t\t\tif (!self.get(value)) {\r\n\t\t\t\t\t\tnew Editor(value, self.settings, self).render();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase \"mceRemoveEditor\":\r\n\t\t\t\t\tif (editor) {\r\n\t\t\t\t\t\teditor.remove();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\tcase 'mceToggleEditor':\r\n\t\t\t\t\tif (!editor) {\r\n\t\t\t\t\t\tself.execCommand('mceAddEditor', 0, value);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (editor.isHidden()) {\r\n\t\t\t\t\t\teditor.show();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\teditor.hide();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Run command on active editor\r\n\t\t\tif (self.activeEditor) {\r\n\t\t\t\treturn self.activeEditor.execCommand(cmd, ui, value);\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Calls the save method on all editor instances in the collection. This can be useful when a form is to be submitted.\r\n\t\t *\r\n\t\t * @method triggerSave\r\n\t\t * @example\r\n\t\t * // Saves all contents\r\n\t\t * tinyMCE.triggerSave();\r\n\t\t */\r\n\t\ttriggerSave: function() {\r\n\t\t\teach(this.editors, function(editor) {\r\n\t\t\t\teditor.save();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Adds a language pack, this gets called by the loaded language files like en.js.\r\n\t\t *\r\n\t\t * @method addI18n\r\n\t\t * @param {String} code Optional language code.\r\n\t\t * @param {Object} items Name/value object with translations.\r\n\t\t */\r\n\t\taddI18n: function(code, items) {\r\n\t\t\tI18n.add(code, items);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Translates the specified string using the language pack items.\r\n\t\t *\r\n\t\t * @method translate\r\n\t\t * @param {String/Array/Object} text String to translate\r\n\t\t * @return {String} Translated string.\r\n\t\t */\r\n\t\ttranslate: function(text) {\r\n\t\t\treturn I18n.translate(text);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the active editor instance and fires the deactivate/activate events.\r\n\t\t *\r\n\t\t * @method setActive\r\n\t\t * @param {tinymce.Editor} editor Editor instance to set as the active instance.\r\n\t\t */\r\n\t\tsetActive: function(editor) {\r\n\t\t\tvar activeEditor = this.activeEditor;\r\n\r\n\t\t\tif (this.activeEditor != editor) {\r\n\t\t\t\tif (activeEditor) {\r\n\t\t\t\t\tactiveEditor.fire('deactivate', {relatedTarget: editor});\r\n\t\t\t\t}\r\n\r\n\t\t\t\teditor.fire('activate', {relatedTarget: activeEditor});\r\n\t\t\t}\r\n\r\n\t\t\tthis.activeEditor = editor;\r\n\t\t}\r\n\t};\r\n\r\n\textend(EditorManager, Observable);\r\n\r\n\tEditorManager.setup();\r\n\r\n\t// Export EditorManager as tinymce/tinymce in global namespace\r\n\twindow.tinymce = window.tinyMCE = EditorManager;\r\n\r\n\treturn EditorManager;\r\n});\r\n\r\n// Included from: js/tinymce/classes/LegacyInput.js\r\n\r\n/**\r\n * LegacyInput.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Converts legacy input to modern HTML.\r\n *\r\n * @class tinymce.LegacyInput\r\n * @private\r\n */\r\ndefine(\"tinymce/LegacyInput\", [\r\n\t\"tinymce/EditorManager\",\r\n\t\"tinymce/util/Tools\"\r\n], function(EditorManager, Tools) {\r\n\tvar each = Tools.each, explode = Tools.explode;\r\n\r\n\tEditorManager.on('AddEditor', function(e) {\r\n\t\tvar editor = e.editor;\r\n\r\n\t\teditor.on('preInit', function() {\r\n\t\t\tvar filters, fontSizes, dom, settings = editor.settings;\r\n\r\n\t\t\tfunction replaceWithSpan(node, styles) {\r\n\t\t\t\teach(styles, function(value, name) {\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tdom.setStyle(node, name, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdom.rename(node, 'span');\r\n\t\t\t}\r\n\r\n\t\t\tfunction convert(e) {\r\n\t\t\t\tdom = editor.dom;\r\n\r\n\t\t\t\tif (settings.convert_fonts_to_spans) {\r\n\t\t\t\t\teach(dom.select('font,u,strike', e.node), function(node) {\r\n\t\t\t\t\t\tfilters[node.nodeName.toLowerCase()](dom, node);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.inline_styles) {\r\n\t\t\t\tfontSizes = explode(settings.font_size_legacy_values);\r\n\r\n\t\t\t\tfilters = {\r\n\t\t\t\t\tfont: function(dom, node) {\r\n\t\t\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\t\t\tbackgroundColor: node.style.backgroundColor,\r\n\t\t\t\t\t\t\tcolor: node.color,\r\n\t\t\t\t\t\t\tfontFamily: node.face,\r\n\t\t\t\t\t\t\tfontSize: fontSizes[parseInt(node.size, 10) - 1]\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tu: function(dom, node) {\r\n\t\t\t\t\t\t// HTML5 allows U element\r\n\t\t\t\t\t\tif (editor.settings.schema === \"html4\") {\r\n\t\t\t\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\t\t\t\ttextDecoration: 'underline'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tstrike: function(dom, node) {\r\n\t\t\t\t\t\treplaceWithSpan(node, {\r\n\t\t\t\t\t\t\ttextDecoration: 'line-through'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\teditor.on('PreProcess SetContent', convert);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/XHR.js\r\n\r\n/**\r\n * XHR.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class enables you to send XMLHTTPRequests cross browser.\r\n * @class tinymce.util.XHR\r\n * @mixes tinymce.util.Observable\r\n * @static\r\n * @example\r\n * // Sends a low level Ajax request\r\n * tinymce.util.XHR.send({\r\n *    url: 'someurl',\r\n *    success: function(text) {\r\n *       console.debug(text);\r\n *    }\r\n * });\r\n *\r\n * // Add custom header to XHR request\r\n * tinymce.util.XHR.on('beforeSend', function(e) {\r\n *     e.xhr.setRequestHeader('X-Requested-With', 'Something');\r\n * });\r\n */\r\ndefine(\"tinymce/util/XHR\", [\r\n\t\"tinymce/util/Observable\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Observable, Tools) {\r\n\tvar XHR = {\r\n\t\t/**\r\n\t\t * Sends a XMLHTTPRequest.\r\n\t\t * Consult the Wiki for details on what settings this method takes.\r\n\t\t *\r\n\t\t * @method send\r\n\t\t * @param {Object} settings Object will target URL, callbacks and other info needed to make the request.\r\n\t\t */\r\n\t\tsend: function(settings) {\r\n\t\t\tvar xhr, count = 0;\r\n\r\n\t\t\tfunction ready() {\r\n\t\t\t\tif (!settings.async || xhr.readyState == 4 || count++ > 10000) {\r\n\t\t\t\t\tif (settings.success && count < 10000 && xhr.status == 200) {\r\n\t\t\t\t\t\tsettings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\r\n\t\t\t\t\t} else if (settings.error) {\r\n\t\t\t\t\t\tsettings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\txhr = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(ready, 10);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Default settings\r\n\t\t\tsettings.scope = settings.scope || this;\r\n\t\t\tsettings.success_scope = settings.success_scope || settings.scope;\r\n\t\t\tsettings.error_scope = settings.error_scope || settings.scope;\r\n\t\t\tsettings.async = settings.async === false ? false : true;\r\n\t\t\tsettings.data = settings.data || '';\r\n\r\n\t\t\tXHR.fire('beforeInitialize', {settings: settings});\r\n\r\n\t\t\txhr = new XMLHttpRequest();\r\n\r\n\t\t\tif (xhr) {\r\n\t\t\t\tif (xhr.overrideMimeType) {\r\n\t\t\t\t\txhr.overrideMimeType(settings.content_type);\r\n\t\t\t\t}\r\n\r\n\t\t\t\txhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\r\n\r\n\t\t\t\tif (settings.crossDomain) {\r\n\t\t\t\t\txhr.withCredentials = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.content_type) {\r\n\t\t\t\t\txhr.setRequestHeader('Content-Type', settings.content_type);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.requestheaders) {\r\n\t\t\t\t\tTools.each(settings.requestheaders, function(header) {\r\n\t\t\t\t\t\txhr.setRequestHeader(header.key, header.value);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n\r\n\t\t\t\txhr = XHR.fire('beforeSend', {xhr: xhr, settings: settings}).xhr;\r\n\t\t\t\txhr.send(settings.data);\r\n\r\n\t\t\t\t// Syncronous request\r\n\t\t\t\tif (!settings.async) {\r\n\t\t\t\t\treturn ready();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Wait for response, onReadyStateChange can not be used since it leaks memory in IE\r\n\t\t\t\tsetTimeout(ready, 10);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tTools.extend(XHR, Observable);\r\n\r\n\treturn XHR;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/JSON.js\r\n\r\n/**\r\n * JSON.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * JSON parser and serializer class.\r\n *\r\n * @class tinymce.util.JSON\r\n * @static\r\n * @example\r\n * // JSON parse a string into an object\r\n * var obj = tinymce.util.JSON.parse(somestring);\r\n *\r\n * // JSON serialize a object into an string\r\n * var str = tinymce.util.JSON.serialize(obj);\r\n */\r\ndefine(\"tinymce/util/JSON\", [], function() {\r\n\tfunction serialize(o, quote) {\r\n\t\tvar i, v, t, name;\r\n\r\n\t\tquote = quote || '\"';\r\n\r\n\t\tif (o === null) {\r\n\t\t\treturn 'null';\r\n\t\t}\r\n\r\n\t\tt = typeof o;\r\n\r\n\t\tif (t == 'string') {\r\n\t\t\tv = '\\bb\\tt\\nn\\ff\\rr\\\"\"\\'\\'\\\\\\\\';\r\n\r\n\t\t\t/*eslint no-control-regex:0 */\r\n\t\t\treturn quote + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g, function(a, b) {\r\n\t\t\t\t// Make sure single quotes never get encoded inside double quotes for JSON compatibility\r\n\t\t\t\tif (quote === '\"' && a === \"'\") {\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ti = v.indexOf(b);\r\n\r\n\t\t\t\tif (i + 1) {\r\n\t\t\t\t\treturn '\\\\' + v.charAt(i + 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ta = b.charCodeAt().toString(16);\r\n\r\n\t\t\t\treturn '\\\\u' + '0000'.substring(a.length) + a;\r\n\t\t\t}) + quote;\r\n\t\t}\r\n\r\n\t\tif (t == 'object') {\r\n\t\t\tif (o.hasOwnProperty && Object.prototype.toString.call(o) === '[object Array]') {\r\n\t\t\t\tfor (i = 0, v = '['; i < o.length; i++) {\r\n\t\t\t\t\tv += (i > 0 ? ',' : '') + serialize(o[i], quote);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn v + ']';\r\n\t\t\t}\r\n\r\n\t\t\tv = '{';\r\n\r\n\t\t\tfor (name in o) {\r\n\t\t\t\tif (o.hasOwnProperty(name)) {\r\n\t\t\t\t\tv += typeof o[name] != 'function' ? (v.length > 1 ? ',' + quote : quote) + name +\r\n\t\t\t\t\t\tquote + ':' + serialize(o[name], quote) : '';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn v + '}';\r\n\t\t}\r\n\r\n\t\treturn '' + o;\r\n\t}\r\n\r\n\treturn {\r\n\t\t/**\r\n\t\t * Serializes the specified object as a JSON string.\r\n\t\t *\r\n\t\t * @method serialize\r\n\t\t * @param {Object} obj Object to serialize as a JSON string.\r\n\t\t * @param {String} quote Optional quote string defaults to \".\r\n\t\t * @return {string} JSON string serialized from input.\r\n\t\t */\r\n\t\tserialize: serialize,\r\n\r\n\t\t/**\r\n\t\t * Unserializes/parses the specified JSON string into a object.\r\n\t\t *\r\n\t\t * @method parse\r\n\t\t * @param {string} s JSON String to parse into a JavaScript object.\r\n\t\t * @return {Object} Object from input JSON string or undefined if it failed.\r\n\t\t */\r\n\t\tparse: function(text) {\r\n\t\t\ttry {\r\n\t\t\t\t// Trick uglify JS\r\n\t\t\t\treturn window[String.fromCharCode(101) + 'val']('(' + text + ')');\r\n\t\t\t} catch (ex) {\r\n\t\t\t\t// Ignore\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**#@-*/\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/JSONRequest.js\r\n\r\n/**\r\n * JSONRequest.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class enables you to use JSON-RPC to call backend methods.\r\n *\r\n * @class tinymce.util.JSONRequest\r\n * @example\r\n * var json = new tinymce.util.JSONRequest({\r\n *     url: 'somebackend.php'\r\n * });\r\n *\r\n * // Send RPC call 1\r\n * json.send({\r\n *     method: 'someMethod1',\r\n *     params: ['a', 'b'],\r\n *     success: function(result) {\r\n *         console.dir(result);\r\n *     }\r\n * });\r\n *\r\n * // Send RPC call 2\r\n * json.send({\r\n *     method: 'someMethod2',\r\n *     params: ['a', 'b'],\r\n *     success: function(result) {\r\n *         console.dir(result);\r\n *     }\r\n * });\r\n */\r\ndefine(\"tinymce/util/JSONRequest\", [\r\n\t\"tinymce/util/JSON\",\r\n\t\"tinymce/util/XHR\",\r\n\t\"tinymce/util/Tools\"\r\n], function(JSON, XHR, Tools) {\r\n\tvar extend = Tools.extend;\r\n\r\n\tfunction JSONRequest(settings) {\r\n\t\tthis.settings = extend({}, settings);\r\n\t\tthis.count = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Simple helper function to send a JSON-RPC request without the need to initialize an object.\r\n\t * Consult the Wiki API documentation for more details on what you can pass to this function.\r\n\t *\r\n\t * @method sendRPC\r\n\t * @static\r\n\t * @param {Object} o Call object where there are three field id, method and params this object should also contain callbacks etc.\r\n\t */\r\n\tJSONRequest.sendRPC = function(o) {\r\n\t\treturn new JSONRequest().send(o);\r\n\t};\r\n\r\n\tJSONRequest.prototype = {\r\n\t\t/**\r\n\t\t * Sends a JSON-RPC call. Consult the Wiki API documentation for more details on what you can pass to this function.\r\n\t\t *\r\n\t\t * @method send\r\n\t\t * @param {Object} args Call object where there are three field id, method and params this object should also contain callbacks etc.\r\n\t\t */\r\n\t\tsend: function(args) {\r\n\t\t\tvar ecb = args.error, scb = args.success;\r\n\r\n\t\t\targs = extend(this.settings, args);\r\n\r\n\t\t\targs.success = function(c, x) {\r\n\t\t\t\tc = JSON.parse(c);\r\n\r\n\t\t\t\tif (typeof c == 'undefined') {\r\n\t\t\t\t\tc = {\r\n\t\t\t\t\t\terror: 'JSON Parse error.'\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (c.error) {\r\n\t\t\t\t\tecb.call(args.error_scope || args.scope, c.error, x);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tscb.call(args.success_scope || args.scope, c.result);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\targs.error = function(ty, x) {\r\n\t\t\t\tif (ecb) {\r\n\t\t\t\t\tecb.call(args.error_scope || args.scope, ty, x);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\targs.data = JSON.serialize({\r\n\t\t\t\tid: args.id || 'c' + (this.count++),\r\n\t\t\t\tmethod: args.method,\r\n\t\t\t\tparams: args.params\r\n\t\t\t});\r\n\r\n\t\t\t// JSON content type for Ruby on rails. Bug: #1883287\r\n\t\t\targs.content_type = 'application/json';\r\n\r\n\t\t\tXHR.send(args);\r\n\t\t}\r\n\t};\r\n\r\n\treturn JSONRequest;\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/JSONP.js\r\n\r\n/**\r\n * JSONP.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\ndefine(\"tinymce/util/JSONP\", [\r\n\t\"tinymce/dom/DOMUtils\"\r\n], function(DOMUtils) {\r\n\treturn {\r\n\t\tcallbacks: {},\r\n\t\tcount: 0,\r\n\r\n\t\tsend: function(settings) {\r\n\t\t\tvar self = this, dom = DOMUtils.DOM, count = settings.count !== undefined ? settings.count : self.count;\r\n\t\t\tvar id = 'tinymce_jsonp_' + count;\r\n\r\n\t\t\tself.callbacks[count] = function(json) {\r\n\t\t\t\tdom.remove(id);\r\n\t\t\t\tdelete self.callbacks[count];\r\n\r\n\t\t\t\tsettings.callback(json);\r\n\t\t\t};\r\n\r\n\t\t\tdom.add(dom.doc.body, 'script', {\r\n\t\t\t\tid: id,\r\n\t\t\t\tsrc: settings.url,\r\n\t\t\t\ttype: 'text/javascript'\r\n\t\t\t});\r\n\r\n\t\t\tself.count++;\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/LocalStorage.js\r\n\r\n/**\r\n * LocalStorage.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class will simulate LocalStorage on IE 7 and return the native version on modern browsers.\r\n * Storage is done using userData on IE 7 and a special serialization format. The format is designed\r\n * to be as small as possible by making sure that the keys and values doesn't need to be encoded. This\r\n * makes it possible to store for example HTML data.\r\n *\r\n * Storage format for userData:\r\n * <base 32 key length>,<key string>,<base 32 value length>,<value>,...\r\n *\r\n * For example this data key1=value1,key2=value2 would be:\r\n * 4,key1,6,value1,4,key2,6,value2\r\n *\r\n * @class tinymce.util.LocalStorage\r\n * @static\r\n * @version 4.0\r\n * @example\r\n * tinymce.util.LocalStorage.setItem('key', 'value');\r\n * var value = tinymce.util.LocalStorage.getItem('key');\r\n */\r\ndefine(\"tinymce/util/LocalStorage\", [], function() {\r\n\tvar LocalStorage, storageElm, items, keys, userDataKey, hasOldIEDataSupport;\r\n\r\n\t// Check for native support\r\n\ttry {\r\n\t\tif (window.localStorage) {\r\n\t\t\treturn localStorage;\r\n\t\t}\r\n\t} catch (ex) {\r\n\t\t// Ignore\r\n\t}\r\n\r\n\tuserDataKey = \"tinymce\";\r\n\tstorageElm = document.documentElement;\r\n\thasOldIEDataSupport = !!storageElm.addBehavior;\r\n\r\n\tif (hasOldIEDataSupport) {\r\n\t\tstorageElm.addBehavior('#default#userData');\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the keys names and updates LocalStorage.length property. Since IE7 doesn't have any getters/setters.\r\n\t */\r\n\tfunction updateKeys() {\r\n\t\tkeys = [];\r\n\r\n\t\tfor (var key in items) {\r\n\t\t\tkeys.push(key);\r\n\t\t}\r\n\r\n\t\tLocalStorage.length = keys.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads the userData string and parses it into the items structure.\r\n\t */\r\n\tfunction load() {\r\n\t\tvar key, data, value, pos = 0;\r\n\r\n\t\titems = {};\r\n\r\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\r\n\t\tif (!hasOldIEDataSupport) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfunction next(end) {\r\n\t\t\tvar value, nextPos;\r\n\r\n\t\t\tnextPos = end !== undefined ? pos + end : data.indexOf(',', pos);\r\n\t\t\tif (nextPos === -1 || nextPos > data.length) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvalue = data.substring(pos, nextPos);\r\n\t\t\tpos = nextPos + 1;\r\n\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tstorageElm.load(userDataKey);\r\n\t\tdata = storageElm.getAttribute(userDataKey) || '';\r\n\r\n\t\tdo {\r\n\t\t\tvar offset = next();\r\n\t\t\tif (offset === null) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tkey = next(parseInt(offset, 32) || 0);\r\n\t\t\tif (key !== null) {\r\n\t\t\t\toffset = next();\r\n\t\t\t\tif (offset === null) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvalue = next(parseInt(offset, 32) || 0);\r\n\r\n\t\t\t\tif (key) {\r\n\t\t\t\t\titems[key] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} while (key !== null);\r\n\r\n\t\tupdateKeys();\r\n\t}\r\n\r\n\t/**\r\n\t * Saves the items structure into a the userData format.\r\n\t */\r\n\tfunction save() {\r\n\t\tvar value, data = '';\r\n\r\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\r\n\t\tif (!hasOldIEDataSupport) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (var key in items) {\r\n\t\t\tvalue = items[key];\r\n\t\t\tdata += (data ? ',' : '') + key.length.toString(32) + ',' + key + ',' + value.length.toString(32) + ',' + value;\r\n\t\t}\r\n\r\n\t\tstorageElm.setAttribute(userDataKey, data);\r\n\r\n\t\ttry {\r\n\t\t\tstorageElm.save(userDataKey);\r\n\t\t} catch (ex) {\r\n\t\t\t// Ignore disk full\r\n\t\t}\r\n\r\n\t\tupdateKeys();\r\n\t}\r\n\r\n\tLocalStorage = {\r\n\t\t/**\r\n\t\t * Length of the number of items in storage.\r\n\t\t *\r\n\t\t * @property length\r\n\t\t * @type Number\r\n\t\t * @return {Number} Number of items in storage.\r\n\t\t */\r\n\t\t//length:0,\r\n\r\n\t\t/**\r\n\t\t * Returns the key name by index.\r\n\t\t *\r\n\t\t * @method key\r\n\t\t * @param {Number} index Index of key to return.\r\n\t\t * @return {String} Key value or null if it wasn't found.\r\n\t\t */\r\n\t\tkey: function(index) {\r\n\t\t\treturn keys[index];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns the value if the specified key or null if it wasn't found.\r\n\t\t *\r\n\t\t * @method getItem\r\n\t\t * @param {String} key Key of item to retrieve.\r\n\t\t * @return {String} Value of the specified item or null if it wasn't found.\r\n\t\t */\r\n\t\tgetItem: function(key) {\r\n\t\t\treturn key in items ? items[key] : null;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the value of the specified item by it's key.\r\n\t\t *\r\n\t\t * @method setItem\r\n\t\t * @param {String} key Key of the item to set.\r\n\t\t * @param {String} value Value of the item to set.\r\n\t\t */\r\n\t\tsetItem: function(key, value) {\r\n\t\t\titems[key] = \"\" + value;\r\n\t\t\tsave();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the specified item by key.\r\n\t\t *\r\n\t\t * @method removeItem\r\n\t\t * @param {String} key Key of item to remove.\r\n\t\t */\r\n\t\tremoveItem: function(key) {\r\n\t\t\tdelete items[key];\r\n\t\t\tsave();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes all items.\r\n\t\t *\r\n\t\t * @method clear\r\n\t\t */\r\n\t\tclear: function() {\r\n\t\t\titems = {};\r\n\t\t\tsave();\r\n\t\t}\r\n\t};\r\n\r\n\tload();\r\n\r\n\treturn LocalStorage;\r\n});\r\n\r\n// Included from: js/tinymce/classes/Compat.js\r\n\r\n/**\r\n * Compat.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * TinyMCE core class.\r\n *\r\n * @static\r\n * @class tinymce\r\n * @borrow-members tinymce.EditorManager\r\n * @borrow-members tinymce.util.Tools\r\n */\r\ndefine(\"tinymce/Compat\", [\r\n\t\"tinymce/dom/DOMUtils\",\r\n\t\"tinymce/dom/EventUtils\",\r\n\t\"tinymce/dom/ScriptLoader\",\r\n\t\"tinymce/AddOnManager\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/Env\"\r\n], function(DOMUtils, EventUtils, ScriptLoader, AddOnManager, Tools, Env) {\r\n\tvar tinymce = window.tinymce;\r\n\r\n\t/**\r\n\t * @property {tinymce.dom.DOMUtils} DOM Global DOM instance.\r\n\t * @property {tinymce.dom.ScriptLoader} ScriptLoader Global ScriptLoader instance.\r\n\t * @property {tinymce.AddOnManager} PluginManager Global PluginManager instance.\r\n\t * @property {tinymce.AddOnManager} ThemeManager Global ThemeManager instance.\r\n\t */\r\n\ttinymce.DOM = DOMUtils.DOM;\r\n\ttinymce.ScriptLoader = ScriptLoader.ScriptLoader;\r\n\ttinymce.PluginManager = AddOnManager.PluginManager;\r\n\ttinymce.ThemeManager = AddOnManager.ThemeManager;\r\n\r\n\ttinymce.dom = tinymce.dom || {};\r\n\ttinymce.dom.Event = EventUtils.Event;\r\n\r\n\tTools.each(Tools, function(func, key) {\r\n\t\ttinymce[key] = func;\r\n\t});\r\n\r\n\tTools.each('isOpera isWebKit isIE isGecko isMac'.split(' '), function(name) {\r\n\t\ttinymce[name] = Env[name.substr(2).toLowerCase()];\r\n\t});\r\n\r\n\treturn {};\r\n});\r\n\r\n// Describe the different namespaces\r\n\r\n/**\r\n * Root level namespace this contains classes directly related to the TinyMCE editor.\r\n *\r\n * @namespace tinymce\r\n */\r\n\r\n/**\r\n * Contains classes for handling the browsers DOM.\r\n *\r\n * @namespace tinymce.dom\r\n */\r\n\r\n/**\r\n * Contains html parser and serializer logic.\r\n *\r\n * @namespace tinymce.html\r\n */\r\n\r\n/**\r\n * Contains the different UI types such as buttons, listboxes etc.\r\n *\r\n * @namespace tinymce.ui\r\n */\r\n\r\n/**\r\n * Contains various utility classes such as json parser, cookies etc.\r\n *\r\n * @namespace tinymce.util\r\n */\r\n\r\n/**\r\n * Contains modules to handle data binding.\r\n *\r\n * @namespace tinymce.data\r\n */\r\n\r\n// Included from: js/tinymce/classes/ui/Layout.js\r\n\r\n/**\r\n * Layout.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Base layout manager class.\r\n *\r\n * @class tinymce.ui.Layout\r\n */\r\ndefine(\"tinymce/ui/Layout\", [\r\n\t\"tinymce/util/Class\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Class, Tools) {\r\n\t\"use strict\";\r\n\r\n\treturn Class.extend({\r\n\t\tDefaults: {\r\n\t\t\tfirstControlClass: 'first',\r\n\t\t\tlastControlClass: 'last'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a layout instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tthis.settings = Tools.extend({}, this.Defaults, settings);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method gets invoked before the layout renders the controls.\r\n\t\t *\r\n\t\t * @method preRender\r\n\t\t * @param {tinymce.ui.Container} container Container instance to preRender.\r\n\t\t */\r\n\t\tpreRender: function(container) {\r\n\t\t\tcontainer.bodyClasses.add(this.settings.containerClass);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Applies layout classes to the container.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tapplyClasses: function(items) {\r\n\t\t\tvar self = this, settings = self.settings, firstClass, lastClass, firstItem, lastItem;\r\n\r\n\t\t\tfirstClass = settings.firstControlClass;\r\n\t\t\tlastClass = settings.lastControlClass;\r\n\r\n\t\t\titems.each(function(item) {\r\n\t\t\t\titem.classes.remove(firstClass).remove(lastClass).add(settings.controlClass);\r\n\r\n\t\t\t\tif (item.visible()) {\r\n\t\t\t\t\tif (!firstItem) {\r\n\t\t\t\t\t\tfirstItem = item;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlastItem = item;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (firstItem) {\r\n\t\t\t\tfirstItem.classes.add(firstClass);\r\n\t\t\t}\r\n\r\n\t\t\tif (lastItem) {\r\n\t\t\t\tlastItem.classes.add(lastClass);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the specified container and any layout specific HTML.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\r\n\t\t */\r\n\t\trenderHtml: function(container) {\r\n\t\t\tvar self = this, html = '';\r\n\r\n\t\t\tself.applyClasses(container.items());\r\n\r\n\t\t\tcontainer.items().each(function(item) {\r\n\t\t\t\thtml += item.renderHtml();\r\n\t\t\t});\r\n\r\n\t\t\treturn html;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the specified container.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\r\n\t\t */\r\n\t\trecalc: function() {\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method gets invoked after the layout renders the controls.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t * @param {tinymce.ui.Container} container Container instance to postRender.\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t},\r\n\r\n\t\tisNative: function() {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/AbsoluteLayout.js\r\n\r\n/**\r\n * AbsoluteLayout.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * LayoutManager for absolute positioning. This layout manager is more of\r\n * a base class for other layouts but can be created and used directly.\r\n *\r\n * @-x-less AbsoluteLayout.less\r\n * @class tinymce.ui.AbsoluteLayout\r\n * @extends tinymce.ui.Layout\r\n */\r\ndefine(\"tinymce/ui/AbsoluteLayout\", [\r\n\t\"tinymce/ui/Layout\"\r\n], function(Layout) {\r\n\t\"use strict\";\r\n\r\n\treturn Layout.extend({\r\n\t\tDefaults: {\r\n\t\t\tcontainerClass: 'abs-layout',\r\n\t\t\tcontrolClass: 'abs-layout-item'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the specified container.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\r\n\t\t */\r\n\t\trecalc: function(container) {\r\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\r\n\t\t\t\tvar settings = ctrl.settings;\r\n\r\n\t\t\t\tctrl.layoutRect({\r\n\t\t\t\t\tx: settings.x,\r\n\t\t\t\t\ty: settings.y,\r\n\t\t\t\t\tw: settings.w,\r\n\t\t\t\t\th: settings.h\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (ctrl.recalc) {\r\n\t\t\t\t\tctrl.recalc();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the specified container and any layout specific HTML.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\r\n\t\t */\r\n\t\trenderHtml: function(container) {\r\n\t\t\treturn '<div id=\"' + container._id + '-absend\" class=\"' + container.classPrefix + 'abs-end\"></div>' + this._super(container);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Button.js\r\n\r\n/**\r\n * Button.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is used to create buttons. You can create them directly or through the Factory.\r\n *\r\n * @example\r\n * // Create and render a button to the body element\r\n * tinymce.ui.Factory.create({\r\n *     type: 'button',\r\n *     text: 'My button'\r\n * }).renderTo(document.body);\r\n *\r\n * @-x-less Button.less\r\n * @class tinymce.ui.Button\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/Button\", [\r\n\t\"tinymce/ui/Widget\"\r\n], function(Widget) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\tDefaults: {\r\n\t\t\tclasses: \"widget btn\",\r\n\t\t\trole: \"button\"\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a new button instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {String} size Size of the button small|medium|large.\r\n\t\t * @setting {String} image Image to use for icon.\r\n\t\t * @setting {String} icon Icon to use for button.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this, size;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tsettings = self.settings;\r\n\r\n\t\t\tsize = self.settings.size;\r\n\r\n\t\t\tself.on('click mousedown', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\r\n\t\t\tself.on('touchstart', function(e) {\r\n\t\t\t\tself.fire('click', e);\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\r\n\t\t\tif (settings.subtype) {\r\n\t\t\t\tself.classes.add(settings.subtype);\r\n\t\t\t}\r\n\r\n\t\t\tif (size) {\r\n\t\t\t\tself.classes.add('btn-' + size);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.icon) {\r\n\t\t\t\tself.icon(settings.icon);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the current button icon.\r\n\t\t *\r\n\t\t * @method icon\r\n\t\t * @param {String} [icon] New icon identifier.\r\n\t\t * @return {String|tinymce.ui.MenuButton} Current icon or current MenuButton instance.\r\n\t\t */\r\n\t\ticon: function(icon) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn this.state.get('icon');\r\n\t\t\t}\r\n\r\n\t\t\tthis.state.set('icon', icon);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the button for example after it's been resizes by a layout engine.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar btnElm = this.getEl().firstChild,\r\n\t\t\t\tbtnStyle;\r\n\r\n\t\t\tif (btnElm) {\r\n\t\t\t\tbtnStyle = btnElm.style;\r\n\t\t\t\tbtnStyle.width = btnStyle.height = \"100%\";\r\n\t\t\t}\r\n\r\n\t\t\tthis._super();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\r\n\t\t\tvar icon = self.state.get('icon'), image, text = self.state.get('text'), textHtml = '';\r\n\r\n\t\t\timage = self.settings.image;\r\n\t\t\tif (image) {\r\n\t\t\t\ticon = 'none';\r\n\r\n\t\t\t\t// Support for [high dpi, low dpi] image sources\r\n\t\t\t\tif (typeof image != \"string\") {\r\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\r\n\t\t\t} else {\r\n\t\t\t\timage = '';\r\n\t\t\t}\r\n\r\n\t\t\tif (text) {\r\n\t\t\t\tself.classes.add('btn-has-text');\r\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\r\n\t\t\t}\r\n\r\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\r\n\t\t\t\t\t'<button role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\r\n\t\t\t\t\t\ttextHtml +\r\n\t\t\t\t\t'</button>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this, $ = self.$, textCls = self.classPrefix + 'txt';\r\n\r\n\t\t\tfunction setButtonText(text) {\r\n\t\t\t\tvar $span = $('span.' + textCls, self.getEl());\r\n\r\n\t\t\t\tif (text) {\r\n\t\t\t\t\tif (!$span[0]) {\r\n\t\t\t\t\t\t$('button:first', self.getEl()).append('<span class=\"' + textCls + '\"></span>');\r\n\t\t\t\t\t\t$span = $('span.' + textCls, self.getEl());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$span.html(self.encode(text));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$span.remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.classes.toggle('btn-has-text', !!text);\r\n\t\t\t}\r\n\r\n\t\t\tself.state.on('change:text', function(e) {\r\n\t\t\t\tsetButtonText(e.value);\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:icon', function(e) {\r\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\r\n\r\n\t\t\t\tself.settings.icon = icon;\r\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\r\n\r\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\r\n\r\n\t\t\t\tif (icon) {\r\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\r\n\t\t\t\t\t\ticonElm = document.createElement('i');\r\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ticonElm.className = icon;\r\n\t\t\t\t} else if (iconElm) {\r\n\t\t\t\t\tbtnElm.removeChild(iconElm);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetButtonText(self.state.get('text'));\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ButtonGroup.js\r\n\r\n/**\r\n * ButtonGroup.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This control enables you to put multiple buttons into a group. This is\r\n * useful when you want to combine similar toolbar buttons into a group.\r\n *\r\n * @example\r\n * // Create and render a buttongroup with two buttons to the body element\r\n * tinymce.ui.Factory.create({\r\n *     type: 'buttongroup',\r\n *     items: [\r\n *         {text: 'Button A'},\r\n *         {text: 'Button B'}\r\n *     ]\r\n * }).renderTo(document.body);\r\n *\r\n * @-x-less ButtonGroup.less\r\n * @class tinymce.ui.ButtonGroup\r\n * @extends tinymce.ui.Container\r\n */\r\ndefine(\"tinymce/ui/ButtonGroup\", [\r\n\t\"tinymce/ui/Container\"\r\n], function(Container) {\r\n\t\"use strict\";\r\n\r\n\treturn Container.extend({\r\n\t\tDefaults: {\r\n\t\t\tdefaultType: 'button',\r\n\t\t\trole: 'group'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, layout = self._layout;\r\n\r\n\t\t\tself.classes.add('btn-group');\r\n\t\t\tself.preRender();\r\n\t\t\tlayout.preRender(self);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\r\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Checkbox.js\r\n\r\n/**\r\n * Checkbox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This control creates a custom checkbox.\r\n *\r\n * @example\r\n * // Create and render a checkbox to the body element\r\n * tinymce.ui.Factory.create({\r\n *     type: 'checkbox',\r\n *     checked: true,\r\n *     text: 'My checkbox'\r\n * }).renderTo(document.body);\r\n *\r\n * @-x-less Checkbox.less\r\n * @class tinymce.ui.Checkbox\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/Checkbox\", [\r\n\t\"tinymce/ui/Widget\"\r\n], function(Widget) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\tDefaults: {\r\n\t\t\tclasses: \"checkbox\",\r\n\t\t\trole: \"checkbox\",\r\n\t\t\tchecked: false\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a new Checkbox instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Boolean} checked True if the checkbox should be checked by default.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\r\n\t\t\tself.on('click mousedown', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tif (!self.disabled()) {\r\n\t\t\t\t\tself.checked(!self.checked());\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.checked(self.settings.checked);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Getter/setter function for the checked state.\r\n\t\t *\r\n\t\t * @method checked\r\n\t\t * @param {Boolean} [state] State to be set.\r\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\r\n\t\t */\r\n\t\tchecked: function(state) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn this.state.get('checked');\r\n\t\t\t}\r\n\r\n\t\t\tthis.state.set('checked', state);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Getter/setter function for the value state.\r\n\t\t *\r\n\t\t * @method value\r\n\t\t * @param {Boolean} [state] State to be set.\r\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\r\n\t\t */\r\n\t\tvalue: function(state) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn this.checked();\r\n\t\t\t}\r\n\r\n\t\t\treturn this.checked(state);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" unselectable=\"on\" aria-labelledby=\"' + id + '-al\" tabindex=\"-1\">' +\r\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-checkbox\"></i>' +\r\n\t\t\t\t\t'<span id=\"' + id + '-al\" class=\"' + prefix + 'label\">' + self.encode(self.state.get('text')) + '</span>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tfunction checked(state) {\r\n\t\t\t\tself.classes.toggle(\"checked\", state);\r\n\t\t\t\tself.aria('checked', state);\r\n\t\t\t}\r\n\r\n\t\t\tself.state.on('change:text', function(e) {\r\n\t\t\t\tself.getEl('al').firstChild.data = self.translate(e.value);\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:checked change:value', function(e) {\r\n\t\t\t\tself.fire('change');\r\n\t\t\t\tchecked(e.value);\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:icon', function(e) {\r\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\r\n\r\n\t\t\t\tif (typeof icon == 'undefined') {\r\n\t\t\t\t\treturn self.settings.icon;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.settings.icon = icon;\r\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\r\n\r\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\r\n\r\n\t\t\t\tif (icon) {\r\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\r\n\t\t\t\t\t\ticonElm = document.createElement('i');\r\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ticonElm.className = icon;\r\n\t\t\t\t} else if (iconElm) {\r\n\t\t\t\t\tbtnElm.removeChild(iconElm);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (self.state.get('checked')) {\r\n\t\t\t\tchecked(true);\r\n\t\t\t}\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ComboBox.js\r\n\r\n/**\r\n * ComboBox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class creates a combobox control. Select box that you select a value from or\r\n * type a value into.\r\n *\r\n * @-x-less ComboBox.less\r\n * @class tinymce.ui.ComboBox\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/ComboBox\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/ui/Factory\",\r\n\t\"tinymce/ui/DomUtils\",\r\n\t\"tinymce/dom/DomQuery\"\r\n], function(Widget, Factory, DomUtils, $) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Constructs a new control instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {String} placeholder Placeholder text to display.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tsettings = self.settings;\r\n\r\n\t\t\tself.classes.add('combobox');\r\n\t\t\tself.subinput = true;\r\n\t\t\tself.ariaTarget = 'inp'; // TODO: Figure out a better way\r\n\r\n\t\t\tsettings.menu = settings.menu || settings.values;\r\n\r\n\t\t\tif (settings.menu) {\r\n\t\t\t\tsettings.icon = 'caret';\r\n\t\t\t}\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tvar elm = e.target, root = self.getEl();\r\n\r\n\t\t\t\tif (!$.contains(root, elm) && elm != root) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (elm && elm != root) {\r\n\t\t\t\t\tif (elm.id && elm.id.indexOf('-open') != -1) {\r\n\t\t\t\t\t\tself.fire('action');\r\n\r\n\t\t\t\t\t\tif (settings.menu) {\r\n\t\t\t\t\t\t\tself.showMenu();\r\n\r\n\t\t\t\t\t\t\tif (e.aria) {\r\n\t\t\t\t\t\t\t\tself.menu.items()[0].focus();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telm = elm.parentNode;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// TODO: Rework this\r\n\t\t\tself.on('keydown', function(e) {\r\n\t\t\t\tif (e.target.nodeName == \"INPUT\" && e.keyCode == 13) {\r\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\r\n\t\t\t\t\t\tvar stateValue = self.state.get('value'), inputValue = self.getEl('inp').value;\r\n\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tself.state.set('value', inputValue);\r\n\r\n\t\t\t\t\t\tif (stateValue != inputValue) {\r\n\t\t\t\t\t\t\tself.fire('change');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (ctrl.hasEventListeners('submit') && ctrl.toJSON) {\r\n\t\t\t\t\t\t\tctrl.fire('submit', {data: ctrl.toJSON()});\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.on('keyup', function(e) {\r\n\t\t\t\tif (e.target.nodeName == \"INPUT\") {\r\n\t\t\t\t\tself.state.set('value', e.target.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tshowMenu: function() {\r\n\t\t\tvar self = this, settings = self.settings, menu;\r\n\r\n\t\t\tif (!self.menu) {\r\n\t\t\t\tmenu = settings.menu || [];\r\n\r\n\t\t\t\t// Is menu array then auto constuct menu control\r\n\t\t\t\tif (menu.length) {\r\n\t\t\t\t\tmenu = {\r\n\t\t\t\t\t\ttype: 'menu',\r\n\t\t\t\t\t\titems: menu\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmenu.type = menu.type || 'menu';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo(self.getContainerElm());\r\n\t\t\t\tself.fire('createmenu');\r\n\t\t\t\tself.menu.reflow();\r\n\t\t\t\tself.menu.on('cancel', function(e) {\r\n\t\t\t\t\tif (e.control === self.menu) {\r\n\t\t\t\t\t\tself.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.menu.on('show hide', function(e) {\r\n\t\t\t\t\te.control.items().each(function(ctrl) {\r\n\t\t\t\t\t\tctrl.active(ctrl.value() == self.value());\r\n\t\t\t\t\t});\r\n\t\t\t\t}).fire('show');\r\n\r\n\t\t\t\tself.menu.on('select', function(e) {\r\n\t\t\t\t\tself.value(e.control.value());\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.on('focusin', function(e) {\r\n\t\t\t\t\tif (e.target.tagName.toUpperCase() == 'INPUT') {\r\n\t\t\t\t\t\tself.menu.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.aria('expanded', true);\r\n\t\t\t}\r\n\r\n\t\t\tself.menu.show();\r\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\r\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Focuses the input area of the control.\r\n\t\t *\r\n\t\t * @method focus\r\n\t\t */\r\n\t\tfocus: function() {\r\n\t\t\tthis.getEl('inp').focus();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar self = this, elm = self.getEl(), openElm = self.getEl('open'), rect = self.layoutRect();\r\n\t\t\tvar width, lineHeight;\r\n\r\n\t\t\tif (openElm) {\r\n\t\t\t\twidth = rect.w - DomUtils.getSize(openElm).width - 10;\r\n\t\t\t} else {\r\n\t\t\t\twidth = rect.w - 10;\r\n\t\t\t}\r\n\r\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\r\n\t\t\tvar doc = document;\r\n\t\t\tif (doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\r\n\t\t\t\tlineHeight = (self.layoutRect().h - 2) + 'px';\r\n\t\t\t}\r\n\r\n\t\t\t$(elm.firstChild).css({\r\n\t\t\t\twidth: width,\r\n\t\t\t\tlineHeight: lineHeight\r\n\t\t\t});\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Post render method. Called after the control has been rendered to the target.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t$(this.getEl('inp')).on('change', function(e) {\r\n\t\t\t\tself.state.set('value', e.target.value);\r\n\t\t\t\tself.fire('change', e);\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix;\r\n\t\t\tvar value = self.state.get('value') || '';\r\n\t\t\tvar icon, text, openBtnHtml = '', extraAttrs = '';\r\n\r\n\t\t\tif (\"spellcheck\" in settings) {\r\n\t\t\t\textraAttrs += ' spellcheck=\"' + settings.spellcheck + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.maxLength) {\r\n\t\t\t\textraAttrs += ' maxlength=\"' + settings.maxLength + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.size) {\r\n\t\t\t\textraAttrs += ' size=\"' + settings.size + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.subtype) {\r\n\t\t\t\textraAttrs += ' type=\"' + settings.subtype + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tif (self.disabled()) {\r\n\t\t\t\textraAttrs += ' disabled=\"disabled\"';\r\n\t\t\t}\r\n\r\n\t\t\ticon = settings.icon;\r\n\t\t\tif (icon && icon != 'caret') {\r\n\t\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + settings.icon;\r\n\t\t\t}\r\n\r\n\t\t\ttext = self.state.get('text');\r\n\r\n\t\t\tif (icon || text) {\r\n\t\t\t\topenBtnHtml = (\r\n\t\t\t\t\t'<div id=\"' + id + '-open\" class=\"' + prefix + 'btn ' + prefix + 'open\" tabIndex=\"-1\" role=\"button\">' +\r\n\t\t\t\t\t\t'<button id=\"' + id + '-action\" type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t\t(icon != 'caret' ? '<i class=\"' + icon + '\"></i>' : '<i class=\"' + prefix + 'caret\"></i>') +\r\n\t\t\t\t\t\t\t(text ? (icon ? ' ' : '') + text : '') +\r\n\t\t\t\t\t\t'</button>' +\r\n\t\t\t\t\t'</div>'\r\n\t\t\t\t);\r\n\r\n\t\t\t\tself.classes.add('has-open');\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\t'<input id=\"' + id + '-inp\" class=\"' + prefix + 'textbox\" value=\"' +\r\n\t\t\t\t\tself.encode(value, false) + '\" hidefocus=\"1\"' + extraAttrs + ' placeholder=\"' +\r\n\t\t\t\t\tself.encode(settings.placeholder) + '\" />' +\r\n\t\t\t\t\topenBtnHtml +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tvalue: function(value) {\r\n\t\t\tif (arguments.length) {\r\n\t\t\t\tthis.state.set('value', value);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\t// Make sure the real state is in sync\r\n\t\t\tif (this.state.get('rendered')) {\r\n\t\t\t\tthis.state.set('value', this.getEl('inp').value);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.state.get('value');\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:value', function(e) {\r\n\t\t\t\tif (self.getEl('inp').value != e.value) {\r\n\t\t\t\t\tself.getEl('inp').value = e.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:disabled', function(e) {\r\n\t\t\t\tself.getEl('inp').disabled = e.value;\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\tremove: function() {\r\n\t\t\t$(this.getEl('inp')).off();\r\n\t\t\tthis._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ColorBox.js\r\n\r\n/**\r\n * ColorBox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This widget lets you enter colors and browse for colors by pressing the color button. It also displays\r\n * a preview of the current color.\r\n *\r\n * @-x-less ColorBox.less\r\n * @class tinymce.ui.ColorBox\r\n * @extends tinymce.ui.ComboBox\r\n */\r\ndefine(\"tinymce/ui/ColorBox\", [\r\n\t\"tinymce/ui/ComboBox\"\r\n], function(ComboBox) {\r\n\t\"use strict\";\r\n\r\n\treturn ComboBox.extend({\r\n\t\t/**\r\n\t\t * Constructs a new control instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tsettings.spellcheck = false;\r\n\r\n\t\t\tif (settings.onaction) {\r\n\t\t\t\tsettings.icon = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tself._super(settings);\r\n\r\n\t\t\tself.classes.add('colorbox');\r\n\t\t\tself.on('change keyup postrender', function() {\r\n\t\t\t\tself.repaintColor(self.value());\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\trepaintColor: function(value) {\r\n\t\t\tvar elm = this.getEl().getElementsByTagName('i')[0];\r\n\r\n\t\t\tif (elm) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\telm.style.background = value;\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t// Ignore\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:value', function(e) {\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tself.repaintColor(e.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/PanelButton.js\r\n\r\n/**\r\n * PanelButton.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new panel button.\r\n *\r\n * @class tinymce.ui.PanelButton\r\n * @extends tinymce.ui.Button\r\n */\r\ndefine(\"tinymce/ui/PanelButton\", [\r\n\t\"tinymce/ui/Button\",\r\n\t\"tinymce/ui/FloatPanel\"\r\n], function(Button, FloatPanel) {\r\n\t\"use strict\";\r\n\r\n\treturn Button.extend({\r\n\t\t/**\r\n\t\t * Shows the panel for the button.\r\n\t\t *\r\n\t\t * @method showPanel\r\n\t\t */\r\n\t\tshowPanel: function() {\r\n\t\t\tvar self = this, settings = self.settings;\r\n\r\n\t\t\tself.active(true);\r\n\r\n\t\t\tif (!self.panel) {\r\n\t\t\t\tvar panelSettings = settings.panel;\r\n\r\n\t\t\t\t// Wrap panel in grid layout if type if specified\r\n\t\t\t\t// This makes it possible to add forms or other containers directly in the panel option\r\n\t\t\t\tif (panelSettings.type) {\r\n\t\t\t\t\tpanelSettings = {\r\n\t\t\t\t\t\tlayout: 'grid',\r\n\t\t\t\t\t\titems: panelSettings\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpanelSettings.role = panelSettings.role || 'dialog';\r\n\t\t\t\tpanelSettings.popover = true;\r\n\t\t\t\tpanelSettings.autohide = true;\r\n\t\t\t\tpanelSettings.ariaRoot = true;\r\n\r\n\t\t\t\tself.panel = new FloatPanel(panelSettings).on('hide', function() {\r\n\t\t\t\t\tself.active(false);\r\n\t\t\t\t}).on('cancel', function(e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tself.focus();\r\n\t\t\t\t\tself.hidePanel();\r\n\t\t\t\t}).parent(self).renderTo(self.getContainerElm());\r\n\r\n\t\t\t\tself.panel.fire('show');\r\n\t\t\t\tself.panel.reflow();\r\n\t\t\t} else {\r\n\t\t\t\tself.panel.show();\r\n\t\t\t}\r\n\r\n\t\t\tself.panel.moveRel(self.getEl(), settings.popoverAlign || (self.isRtl() ? ['bc-tr', 'bc-tc'] : ['bc-tl', 'bc-tc']));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides the panel for the button.\r\n\t\t *\r\n\t\t * @method hidePanel\r\n\t\t */\r\n\t\thidePanel: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.panel) {\r\n\t\t\t\tself.panel.hide();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.aria('haspopup', true);\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tif (e.control === self) {\r\n\t\t\t\t\tif (self.panel && self.panel.visible()) {\r\n\t\t\t\t\t\tself.hidePanel();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.showPanel();\r\n\t\t\t\t\t\tself.panel.focus(!!e.aria);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\tremove: function() {\r\n\t\t\tif (this.panel) {\r\n\t\t\t\tthis.panel.remove();\r\n\t\t\t\tthis.panel = null;\r\n\t\t\t}\r\n\r\n\t\t\treturn this._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ColorButton.js\r\n\r\n/**\r\n * ColorButton.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class creates a color button control. This is a split button in which the main\r\n * button has a visual representation of the currently selected color. When clicked\r\n * the caret button displays a color picker, allowing the user to select a new color.\r\n *\r\n * @-x-less ColorButton.less\r\n * @class tinymce.ui.ColorButton\r\n * @extends tinymce.ui.PanelButton\r\n */\r\ndefine(\"tinymce/ui/ColorButton\", [\r\n\t\"tinymce/ui/PanelButton\",\r\n\t\"tinymce/dom/DOMUtils\"\r\n], function(PanelButton, DomUtils) {\r\n\t\"use strict\";\r\n\r\n\tvar DOM = DomUtils.DOM;\r\n\r\n\treturn PanelButton.extend({\r\n\t\t/**\r\n\t\t * Constructs a new ColorButton instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tthis._super(settings);\r\n\t\t\tthis.classes.add('colorbutton');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Getter/setter for the current color.\r\n\t\t *\r\n\t\t * @method color\r\n\t\t * @param {String} [color] Color to set.\r\n\t\t * @return {String|tinymce.ui.ColorButton} Current color or current instance.\r\n\t\t */\r\n\t\tcolor: function(color) {\r\n\t\t\tif (color) {\r\n\t\t\t\tthis._color = color;\r\n\t\t\t\tthis.getEl('preview').style.backgroundColor = color;\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\treturn this._color;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Resets the current color.\r\n\t\t *\r\n\t\t * @method resetColor\r\n\t\t * @return {tinymce.ui.ColorButton} Current instance.\r\n\t\t */\r\n\t\tresetColor: function() {\r\n\t\t\tthis._color = null;\r\n\t\t\tthis.getEl('preview').style.backgroundColor = null;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, text = self.state.get('text');\r\n\t\t\tvar icon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\r\n\t\t\tvar image = self.settings.image ? ' style=\"background-image: url(\\'' + self.settings.image + '\\')\"' : '',\r\n\t\t\t\ttextHtml = '';\r\n\r\n\t\t\tif (text) {\r\n\t\t\t\tself.classes.add('btn-has-text');\r\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\" aria-haspopup=\"true\">' +\r\n\t\t\t\t\t'<button role=\"presentation\" hidefocus=\"1\" type=\"button\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\r\n\t\t\t\t\t\t'<span id=\"' + id + '-preview\" class=\"' + prefix + 'preview\"></span>' +\r\n\t\t\t\t\t\ttextHtml +\r\n\t\t\t\t\t'</button>' +\r\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\r\n\t\t\t\t\t'</button>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tif (e.aria && e.aria.key == 'down') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (e.control == self && !DOM.getParent(e.target, '.' + self.classPrefix + 'open')) {\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\tonClickHandler.call(self, e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tdelete self.settings.onclick;\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/util/Color.js\r\n\r\n/**\r\n * Color.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class lets you parse/serialize colors and convert rgb/hsb.\r\n *\r\n * @class tinymce.util.Color\r\n * @example\r\n * var white = new tinymce.util.Color({r: 255, g: 255, b: 255});\r\n * var red = new tinymce.util.Color('#FF0000');\r\n *\r\n * console.log(white.toHex(), red.toHsv());\r\n */\r\ndefine(\"tinymce/util/Color\", [], function() {\r\n\tvar min = Math.min, max = Math.max, round = Math.round;\r\n\r\n\t/**\r\n\t * Constructs a new color instance.\r\n\t *\r\n\t * @constructor\r\n\t * @method Color\r\n\t * @param {String} value Optional initial value to parse.\r\n\t */\r\n\tfunction Color(value) {\r\n\t\tvar self = this, r = 0, g = 0, b = 0;\r\n\r\n\t\tfunction rgb2hsv(r, g, b) {\r\n\t\t\tvar h, s, v, d, minRGB, maxRGB;\r\n\r\n\t\t\th = 0;\r\n\t\t\ts = 0;\r\n\t\t\tv = 0;\r\n\t\t\tr = r / 255;\r\n\t\t\tg = g / 255;\r\n\t\t\tb = b / 255;\r\n\r\n\t\t\tminRGB = min(r, min(g, b));\r\n\t\t\tmaxRGB = max(r, max(g, b));\r\n\r\n\t\t\tif (minRGB == maxRGB) {\r\n\t\t\t\tv = minRGB;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\th: 0,\r\n\t\t\t\t\ts: 0,\r\n\t\t\t\t\tv: v * 100\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t/*eslint no-nested-ternary:0 */\r\n\t\t\td = (r == minRGB) ? g - b : ((b == minRGB) ? r - g : b - r);\r\n\t\t\th = (r == minRGB) ? 3 : ((b == minRGB) ? 1 : 5);\r\n\t\t\th = 60 * (h - d / (maxRGB - minRGB));\r\n\t\t\ts = (maxRGB - minRGB) / maxRGB;\r\n\t\t\tv = maxRGB;\r\n\r\n\t\t\treturn {\r\n\t\t\t\th: round(h),\r\n\t\t\t\ts: round(s * 100),\r\n\t\t\t\tv: round(v * 100)\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction hsvToRgb(hue, saturation, brightness) {\r\n\t\t\tvar side, chroma, x, match;\r\n\r\n\t\t\thue = (parseInt(hue, 10) || 0) % 360;\r\n\t\t\tsaturation = parseInt(saturation, 10) / 100;\r\n\t\t\tbrightness = parseInt(brightness, 10) / 100;\r\n\t\t\tsaturation = max(0, min(saturation, 1));\r\n\t\t\tbrightness = max(0, min(brightness, 1));\r\n\r\n\t\t\tif (saturation === 0) {\r\n\t\t\t\tr = g = b = round(255 * brightness);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tside = hue / 60;\r\n\t\t\tchroma = brightness * saturation;\r\n\t\t\tx = chroma * (1 - Math.abs(side % 2 - 1));\r\n\t\t\tmatch = brightness - chroma;\r\n\r\n\t\t\tswitch (Math.floor(side)) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tr = chroma;\r\n\t\t\t\t\tg = x;\r\n\t\t\t\t\tb = 0;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tr = x;\r\n\t\t\t\t\tg = chroma;\r\n\t\t\t\t\tb = 0;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tr = 0;\r\n\t\t\t\t\tg = chroma;\r\n\t\t\t\t\tb = x;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tr = 0;\r\n\t\t\t\t\tg = x;\r\n\t\t\t\t\tb = chroma;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tr = x;\r\n\t\t\t\t\tg = 0;\r\n\t\t\t\t\tb = chroma;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\tr = chroma;\r\n\t\t\t\t\tg = 0;\r\n\t\t\t\t\tb = x;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tr = g = b = 0;\r\n\t\t\t}\r\n\r\n\t\t\tr = round(255 * (r + match));\r\n\t\t\tg = round(255 * (g + match));\r\n\t\t\tb = round(255 * (b + match));\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the hex string of the current color. For example: #ff00ff\r\n\t\t *\r\n\t\t * @method toHex\r\n\t\t * @return {String} Hex string of current color.\r\n\t\t */\r\n\t\tfunction toHex() {\r\n\t\t\tfunction hex(val) {\r\n\t\t\t\tval = parseInt(val, 10).toString(16);\r\n\r\n\t\t\t\treturn val.length > 1 ? val : '0' + val;\r\n\t\t\t}\r\n\r\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the r, g, b values of the color. Each channel has a range from 0-255.\r\n\t\t *\r\n\t\t * @method toRgb\r\n\t\t * @return {Object} Object with r, g, b fields.\r\n\t\t */\r\n\t\tfunction toRgb() {\r\n\t\t\treturn {\r\n\t\t\t\tr: r,\r\n\t\t\t\tg: g,\r\n\t\t\t\tb: b\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Returns the h, s, v values of the color. Ranges: h=0-360, s=0-100, v=0-100.\r\n\t\t *\r\n\t\t * @method toHsv\r\n\t\t * @return {Object} Object with h, s, v fields.\r\n\t\t */\r\n\t\tfunction toHsv() {\r\n\t\t\treturn rgb2hsv(r, g, b);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Parses the specified value and populates the color instance.\r\n\t\t *\r\n\t\t * Supported format examples:\r\n\t\t *  * rbg(255,0,0)\r\n\t\t *  * #ff0000\r\n\t\t *  * #fff\r\n\t\t *  * {r: 255, g: 0, b: 0}\r\n\t\t *  * {h: 360, s: 100, v: 100}\r\n\t\t *\r\n\t\t * @method parse\r\n\t\t * @param {Object/String} value Color value to parse.\r\n\t\t * @return {tinymce.util.Color} Current color instance.\r\n\t\t */\r\n\t\tfunction parse(value) {\r\n\t\t\tvar matches;\r\n\r\n\t\t\tif (typeof value == 'object') {\r\n\t\t\t\tif (\"r\" in value) {\r\n\t\t\t\t\tr = value.r;\r\n\t\t\t\t\tg = value.g;\r\n\t\t\t\t\tb = value.b;\r\n\t\t\t\t} else if (\"v\" in value) {\r\n\t\t\t\t\thsvToRgb(value.h, value.s, value.v);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif ((matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value))) {\r\n\t\t\t\t\tr = parseInt(matches[1], 10);\r\n\t\t\t\t\tg = parseInt(matches[2], 10);\r\n\t\t\t\t\tb = parseInt(matches[3], 10);\r\n\t\t\t\t} else if ((matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))) {\r\n\t\t\t\t\tr = parseInt(matches[1], 16);\r\n\t\t\t\t\tg = parseInt(matches[2], 16);\r\n\t\t\t\t\tb = parseInt(matches[3], 16);\r\n\t\t\t\t} else if ((matches = /#([0-F])([0-F])([0-F])/gi.exec(value))) {\r\n\t\t\t\t\tr = parseInt(matches[1] + matches[1], 16);\r\n\t\t\t\t\tg = parseInt(matches[2] + matches[2], 16);\r\n\t\t\t\t\tb = parseInt(matches[3] + matches[3], 16);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tr = r < 0 ? 0 : (r > 255 ? 255 : r);\r\n\t\t\tg = g < 0 ? 0 : (g > 255 ? 255 : g);\r\n\t\t\tb = b < 0 ? 0 : (b > 255 ? 255 : b);\r\n\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\tif (value) {\r\n\t\t\tparse(value);\r\n\t\t}\r\n\r\n\t\tself.toRgb = toRgb;\r\n\t\tself.toHsv = toHsv;\r\n\t\tself.toHex = toHex;\r\n\t\tself.parse = parse;\r\n\t}\r\n\r\n\treturn Color;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ColorPicker.js\r\n\r\n/**\r\n * ColorPicker.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Color picker widget lets you select colors.\r\n *\r\n * @-x-less ColorPicker.less\r\n * @class tinymce.ui.ColorPicker\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/ColorPicker\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/ui/DragHelper\",\r\n\t\"tinymce/ui/DomUtils\",\r\n\t\"tinymce/util/Color\"\r\n], function(Widget, DragHelper, DomUtils, Color) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\tDefaults: {\r\n\t\t\tclasses: \"widget colorpicker\"\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a new colorpicker instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {String} color Initial color value.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tthis._super(settings);\r\n\t\t},\r\n\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, color = self.color(), hsv, hueRootElm, huePointElm, svRootElm, svPointElm;\r\n\r\n\t\t\thueRootElm = self.getEl('h');\r\n\t\t\thuePointElm = self.getEl('hp');\r\n\t\t\tsvRootElm = self.getEl('sv');\r\n\t\t\tsvPointElm = self.getEl('svp');\r\n\r\n\t\t\tfunction getPos(elm, event) {\r\n\t\t\t\tvar pos = DomUtils.getPos(elm), x, y;\r\n\r\n\t\t\t\tx = event.pageX - pos.x;\r\n\t\t\t\ty = event.pageY - pos.y;\r\n\r\n\t\t\t\tx = Math.max(0, Math.min(x / elm.clientWidth, 1));\r\n\t\t\t\ty = Math.max(0, Math.min(y / elm.clientHeight, 1));\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty: y\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction updateColor(hsv, hueUpdate) {\r\n\t\t\t\tvar hue = (360 - hsv.h) / 360;\r\n\r\n\t\t\t\tDomUtils.css(huePointElm, {\r\n\t\t\t\t\ttop: (hue * 100) + '%'\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!hueUpdate) {\r\n\t\t\t\t\tDomUtils.css(svPointElm, {\r\n\t\t\t\t\t\tleft: hsv.s + '%',\r\n\t\t\t\t\t\ttop: (100 - hsv.v) + '%'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsvRootElm.style.background = new Color({s: 100, v: 100, h: hsv.h}).toHex();\r\n\t\t\t\tself.color().parse({s: hsv.s, v: hsv.v, h: hsv.h});\r\n\t\t\t}\r\n\r\n\t\t\tfunction updateSaturationAndValue(e) {\r\n\t\t\t\tvar pos;\r\n\r\n\t\t\t\tpos = getPos(svRootElm, e);\r\n\t\t\t\thsv.s = pos.x * 100;\r\n\t\t\t\thsv.v = (1 - pos.y) * 100;\r\n\r\n\t\t\t\tupdateColor(hsv);\r\n\t\t\t\tself.fire('change');\r\n\t\t\t}\r\n\r\n\t\t\tfunction updateHue(e) {\r\n\t\t\t\tvar pos;\r\n\r\n\t\t\t\tpos = getPos(hueRootElm, e);\r\n\t\t\t\thsv = color.toHsv();\r\n\t\t\t\thsv.h = (1 - pos.y) * 360;\r\n\t\t\t\tupdateColor(hsv, true);\r\n\t\t\t\tself.fire('change');\r\n\t\t\t}\r\n\r\n\t\t\tself._repaint = function() {\r\n\t\t\t\thsv = color.toHsv();\r\n\t\t\t\tupdateColor(hsv);\r\n\t\t\t};\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tself._svdraghelper = new DragHelper(self._id + '-sv', {\r\n\t\t\t\tstart: updateSaturationAndValue,\r\n\t\t\t\tdrag: updateSaturationAndValue\r\n\t\t\t});\r\n\r\n\t\t\tself._hdraghelper = new DragHelper(self._id + '-h', {\r\n\t\t\t\tstart: updateHue,\r\n\t\t\t\tdrag: updateHue\r\n\t\t\t});\r\n\r\n\t\t\tself._repaint();\r\n\t\t},\r\n\r\n\t\trgb: function() {\r\n\t\t\treturn this.color().toRgb();\r\n\t\t},\r\n\r\n\t\tvalue: function(value) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (arguments.length) {\r\n\t\t\t\tself.color().parse(value);\r\n\r\n\t\t\t\tif (self._rendered) {\r\n\t\t\t\t\tself._repaint();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn self.color().toHex();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcolor: function() {\r\n\t\t\tif (!this._color) {\r\n\t\t\t\tthis._color = new Color();\r\n\t\t\t}\r\n\r\n\t\t\treturn this._color;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, hueHtml;\r\n\t\t\tvar stops = '#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000';\r\n\r\n\t\t\tfunction getOldIeFallbackHtml() {\r\n\t\t\t\tvar i, l, html = '', gradientPrefix, stopsList;\r\n\r\n\t\t\t\tgradientPrefix = 'filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=';\r\n\t\t\t\tstopsList = stops.split(',');\r\n\t\t\t\tfor (i = 0, l = stopsList.length - 1; i < l; i++) {\r\n\t\t\t\t\thtml += (\r\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-h-chunk\" style=\"' +\r\n\t\t\t\t\t\t\t'height:' + (100 / l) + '%;' +\r\n\t\t\t\t\t\t\tgradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ');' +\r\n\t\t\t\t\t\t\t'-ms-' + gradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ')' +\r\n\t\t\t\t\t\t'\"></div>'\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\r\n\t\t\tvar gradientCssText = (\r\n\t\t\t\t'background: -ms-linear-gradient(top,' + stops + ');' +\r\n\t\t\t\t'background: linear-gradient(to bottom,' + stops + ');'\r\n\t\t\t);\r\n\r\n\t\t\thueHtml = (\r\n\t\t\t\t'<div id=\"' + id + '-h\" class=\"' + prefix + 'colorpicker-h\" style=\"' + gradientCssText + '\">' +\r\n\t\t\t\t\tgetOldIeFallbackHtml() +\r\n\t\t\t\t\t'<div id=\"' + id + '-hp\" class=\"' + prefix + 'colorpicker-h-marker\"></div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\t'<div id=\"' + id + '-sv\" class=\"' + prefix + 'colorpicker-sv\">' +\r\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay1\">' +\r\n\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay2\">' +\r\n\t\t\t\t\t\t\t\t'<div id=\"' + id + '-svp\" class=\"' + prefix + 'colorpicker-selector1\">' +\r\n\t\t\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-selector2\"></div>' +\r\n\t\t\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t\thueHtml +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Path.js\r\n\r\n/**\r\n * Path.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new path control.\r\n *\r\n * @-x-less Path.less\r\n * @class tinymce.ui.Path\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/Path\", [\r\n\t\"tinymce/ui/Widget\"\r\n], function(Widget) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {String} delimiter Delimiter to display between row in path.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!settings.delimiter) {\r\n\t\t\t\tsettings.delimiter = '\\u00BB';\r\n\t\t\t}\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself.classes.add('path');\r\n\t\t\tself.canFocus = true;\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tvar index, target = e.target;\r\n\r\n\t\t\t\tif ((index = target.getAttribute('data-index'))) {\r\n\t\t\t\t\tself.fire('select', {value: self.row()[index], index: index});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.row(self.settings.row);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Focuses the current control.\r\n\t\t *\r\n\t\t * @method focus\r\n\t\t * @return {tinymce.ui.Control} Current control instance.\r\n\t\t */\r\n\t\tfocus: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.getEl().firstChild.focus();\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets/gets the data to be used for the path.\r\n\t\t *\r\n\t\t * @method row\r\n\t\t * @param {Array} row Array with row name is rendered to path.\r\n\t\t */\r\n\t\trow: function(row) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn this.state.get('row');\r\n\t\t\t}\r\n\r\n\t\t\tthis.state.set('row', row);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\tself._getDataPathHtml(self.state.get('row')) +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:row', function(e) {\r\n\t\t\t\tself.innerHtml(self._getDataPathHtml(e.value));\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\t_getDataPathHtml: function(data) {\r\n\t\t\tvar self = this, parts = data || [], i, l, html = '', prefix = self.classPrefix;\r\n\r\n\t\t\tfor (i = 0, l = parts.length; i < l; i++) {\r\n\t\t\t\thtml += (\r\n\t\t\t\t\t(i > 0 ? '<div class=\"' + prefix + 'divider\" aria-hidden=\"true\"> ' + self.settings.delimiter + ' </div>' : '') +\r\n\t\t\t\t\t'<div role=\"button\" class=\"' + prefix + 'path-item' + (i == l - 1 ? ' ' + prefix + 'last' : '') + '\" data-index=\"' +\r\n\t\t\t\t\ti + '\" tabindex=\"-1\" id=\"' + self._id + '-' + i + '\" aria-level=\"' + i + '\">' + parts[i].name + '</div>'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (!html) {\r\n\t\t\t\thtml = '<div class=\"' + prefix + 'path-item\">\\u00a0</div>';\r\n\t\t\t}\r\n\r\n\t\t\treturn html;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ElementPath.js\r\n\r\n/**\r\n * ElementPath.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This control creates an path for the current selections parent elements in TinyMCE.\r\n *\r\n * @class tinymce.ui.ElementPath\r\n * @extends tinymce.ui.Path\r\n */\r\ndefine(\"tinymce/ui/ElementPath\", [\r\n\t\"tinymce/ui/Path\",\r\n\t\"tinymce/EditorManager\"\r\n], function(Path, EditorManager) {\r\n\treturn Path.extend({\r\n\t\t/**\r\n\t\t * Post render method. Called after the control has been rendered to the target.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t * @return {tinymce.ui.ElementPath} Current combobox instance.\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, editor = EditorManager.activeEditor;\r\n\r\n\t\t\tfunction isHidden(elm) {\r\n\t\t\t\tif (elm.nodeType === 1) {\r\n\t\t\t\t\tif (elm.nodeName == \"BR\" || !!elm.getAttribute('data-mce-bogus')) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (elm.getAttribute('data-mce-type') === 'bookmark') {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (editor.settings.elementpath !== false) {\r\n\t\t\t\tself.on('select', function(e) {\r\n\t\t\t\t\teditor.focus();\r\n\t\t\t\t\teditor.selection.select(this.row()[e.index].element);\r\n\t\t\t\t\teditor.nodeChanged();\r\n\t\t\t\t});\r\n\r\n\t\t\t\teditor.on('nodeChange', function(e) {\r\n\t\t\t\t\tvar outParents = [], parents = e.parents, i = parents.length;\r\n\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tif (parents[i].nodeType == 1 && !isHidden(parents[i])) {\r\n\t\t\t\t\t\t\tvar args = editor.fire('ResolveName', {\r\n\t\t\t\t\t\t\t\tname: parents[i].nodeName.toLowerCase(),\r\n\t\t\t\t\t\t\t\ttarget: parents[i]\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (!args.isDefaultPrevented()) {\r\n\t\t\t\t\t\t\t\toutParents.push({name: args.name, element: parents[i]});\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (args.isPropagationStopped()) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.row(outParents);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FormItem.js\r\n\r\n/**\r\n * FormItem.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class is a container created by the form element with\r\n * a label and control item.\r\n *\r\n * @class tinymce.ui.FormItem\r\n * @extends tinymce.ui.Container\r\n * @setting {String} label Label to display for the form item.\r\n */\r\ndefine(\"tinymce/ui/FormItem\", [\r\n\t\"tinymce/ui/Container\"\r\n], function(Container) {\r\n\t\"use strict\";\r\n\r\n\treturn Container.extend({\r\n\t\tDefaults: {\r\n\t\t\tlayout: 'flex',\r\n\t\t\talign: 'center',\r\n\t\t\tdefaults: {\r\n\t\t\t\tflex: 1\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\r\n\r\n\t\t\tself.classes.add('formitem');\r\n\t\t\tlayout.preRender(self);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\r\n\t\t\t\t\t(self.settings.title ? ('<div id=\"' + self._id + '-title\" class=\"' + prefix + 'title\">' +\r\n\t\t\t\t\t\tself.settings.title + '</div>') : '') +\r\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\r\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Form.js\r\n\r\n/**\r\n * Form.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class creates a form container. A form container has the ability\r\n * to automatically wrap items in tinymce.ui.FormItem instances.\r\n *\r\n * Each FormItem instance is a container for the label and the item.\r\n *\r\n * @example\r\n * tinymce.ui.Factory.create({\r\n *     type: 'form',\r\n *     items: [\r\n *         {type: 'textbox', label: 'My text box'}\r\n *     ]\r\n * }).renderTo(document.body);\r\n *\r\n * @class tinymce.ui.Form\r\n * @extends tinymce.ui.Container\r\n */\r\ndefine(\"tinymce/ui/Form\", [\r\n\t\"tinymce/ui/Container\",\r\n\t\"tinymce/ui/FormItem\",\r\n\t\"tinymce/util/Tools\"\r\n], function(Container, FormItem, Tools) {\r\n\t\"use strict\";\r\n\r\n\treturn Container.extend({\r\n\t\tDefaults: {\r\n\t\t\tcontainerCls: 'form',\r\n\t\t\tlayout: 'flex',\r\n\t\t\tdirection: 'column',\r\n\t\t\talign: 'stretch',\r\n\t\t\tflex: 1,\r\n\t\t\tpadding: 20,\r\n\t\t\tlabelGap: 30,\r\n\t\t\tspacing: 10,\r\n\t\t\tcallbacks: {\r\n\t\t\t\tsubmit: function() {\r\n\t\t\t\t\tthis.submit();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method gets invoked before the control is rendered.\r\n\t\t *\r\n\t\t * @method preRender\r\n\t\t */\r\n\t\tpreRender: function() {\r\n\t\t\tvar self = this, items = self.items();\r\n\r\n\t\t\tif (!self.settings.formItemDefaults) {\r\n\t\t\t\tself.settings.formItemDefaults = {\r\n\t\t\t\t\tlayout: 'flex',\r\n\t\t\t\t\tautoResize: \"overflow\",\r\n\t\t\t\t\tdefaults: {flex: 1}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Wrap any labeled items in FormItems\r\n\t\t\titems.each(function(ctrl) {\r\n\t\t\t\tvar formItem, label = ctrl.settings.label;\r\n\r\n\t\t\t\tif (label) {\r\n\t\t\t\t\tformItem = new FormItem(Tools.extend({\r\n\t\t\t\t\t\titems: {\r\n\t\t\t\t\t\t\ttype: 'label',\r\n\t\t\t\t\t\t\tid: ctrl._id + '-l',\r\n\t\t\t\t\t\t\ttext: label,\r\n\t\t\t\t\t\t\tflex: 0,\r\n\t\t\t\t\t\t\tforId: ctrl._id,\r\n\t\t\t\t\t\t\tdisabled: ctrl.disabled()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, self.settings.formItemDefaults));\r\n\r\n\t\t\t\t\tformItem.type = 'formitem';\r\n\t\t\t\t\tctrl.aria('labelledby', ctrl._id + '-l');\r\n\r\n\t\t\t\t\tif (typeof ctrl.settings.flex == \"undefined\") {\r\n\t\t\t\t\t\tctrl.settings.flex = 1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.replace(ctrl, formItem);\r\n\t\t\t\t\tformItem.add(ctrl);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Fires a submit event with the serialized form.\r\n\t\t *\r\n\t\t * @method submit\r\n\t\t * @return {Object} Event arguments object.\r\n\t\t */\r\n\t\tsubmit: function() {\r\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Post render method. Called after the control has been rendered to the target.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super();\r\n\t\t\tself.fromJSON(self.settings.data);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tfunction recalcLabels() {\r\n\t\t\t\tvar maxLabelWidth = 0, labels = [], i, labelGap, items;\r\n\r\n\t\t\t\tif (self.settings.labelGapCalc === false) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.settings.labelGapCalc == \"children\") {\r\n\t\t\t\t\titems = self.find('formitem');\r\n\t\t\t\t} else {\r\n\t\t\t\t\titems = self.items();\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.filter('formitem').each(function(item) {\r\n\t\t\t\t\tvar labelCtrl = item.items()[0], labelWidth = labelCtrl.getEl().clientWidth;\r\n\r\n\t\t\t\t\tmaxLabelWidth = labelWidth > maxLabelWidth ? labelWidth : maxLabelWidth;\r\n\t\t\t\t\tlabels.push(labelCtrl);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tlabelGap = self.settings.labelGap || 0;\r\n\r\n\t\t\t\ti = labels.length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tlabels[i].settings.minWidth = maxLabelWidth + labelGap;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.on('show', recalcLabels);\r\n\t\t\trecalcLabels();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FieldSet.js\r\n\r\n/**\r\n * FieldSet.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class creates fieldset containers.\r\n *\r\n * @-x-less FieldSet.less\r\n * @class tinymce.ui.FieldSet\r\n * @extends tinymce.ui.Form\r\n */\r\ndefine(\"tinymce/ui/FieldSet\", [\r\n\t\"tinymce/ui/Form\"\r\n], function(Form) {\r\n\t\"use strict\";\r\n\r\n\treturn Form.extend({\r\n\t\tDefaults: {\r\n\t\t\tcontainerCls: 'fieldset',\r\n\t\t\tlayout: 'flex',\r\n\t\t\tdirection: 'column',\r\n\t\t\talign: 'stretch',\r\n\t\t\tflex: 1,\r\n\t\t\tpadding: \"25 15 5 15\",\r\n\t\t\tlabelGap: 30,\r\n\t\t\tspacing: 10,\r\n\t\t\tborder: 1\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\r\n\r\n\t\t\tself.preRender();\r\n\t\t\tlayout.preRender(self);\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<fieldset id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\r\n\t\t\t\t\t(self.settings.title ? ('<legend id=\"' + self._id + '-title\" class=\"' + prefix + 'fieldset-title\">' +\r\n\t\t\t\t\t\tself.settings.title + '</legend>') : '') +\r\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\r\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</fieldset>'\r\n\t\t\t);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FilePicker.js\r\n\r\n/**\r\n * FilePicker.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*global tinymce:true */\r\n\r\n/**\r\n * This class creates a file picker control.\r\n *\r\n * @class tinymce.ui.FilePicker\r\n * @extends tinymce.ui.ComboBox\r\n */\r\ndefine(\"tinymce/ui/FilePicker\", [\r\n\t\"tinymce/ui/ComboBox\",\r\n\t\"tinymce/util/Tools\"\r\n], function(ComboBox, Tools) {\r\n\t\"use strict\";\r\n\r\n\treturn ComboBox.extend({\r\n\t\t/**\r\n\t\t * Constructs a new control instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this, editor = tinymce.activeEditor, editorSettings = editor.settings;\r\n\t\t\tvar actionCallback, fileBrowserCallback, fileBrowserCallbackTypes;\r\n\r\n\t\t\tsettings.spellcheck = false;\r\n\r\n\t\t\tfileBrowserCallbackTypes = editorSettings.file_picker_types || editorSettings.file_browser_callback_types;\r\n\t\t\tif (fileBrowserCallbackTypes) {\r\n\t\t\t\tfileBrowserCallbackTypes = Tools.makeMap(fileBrowserCallbackTypes, /[, ]/);\r\n\t\t\t}\r\n\r\n\t\t\tif (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[settings.filetype]) {\r\n\t\t\t\tfileBrowserCallback = editorSettings.file_picker_callback;\r\n\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[settings.filetype])) {\r\n\t\t\t\t\tactionCallback = function() {\r\n\t\t\t\t\t\tvar meta = self.fire('beforecall').meta;\r\n\r\n\t\t\t\t\t\tmeta = Tools.extend({filetype: settings.filetype}, meta);\r\n\r\n\t\t\t\t\t\t// file_picker_callback(callback, currentValue, metaData)\r\n\t\t\t\t\t\tfileBrowserCallback.call(\r\n\t\t\t\t\t\t\teditor,\r\n\t\t\t\t\t\t\tfunction(value, meta) {\r\n\t\t\t\t\t\t\t\tself.value(value).fire('change', {meta: meta});\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tself.value(),\r\n\t\t\t\t\t\t\tmeta\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Legacy callback: file_picker_callback(id, currentValue, filetype, window)\r\n\t\t\t\t\tfileBrowserCallback = editorSettings.file_browser_callback;\r\n\t\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[settings.filetype])) {\r\n\t\t\t\t\t\tactionCallback = function() {\r\n\t\t\t\t\t\t\tfileBrowserCallback(\r\n\t\t\t\t\t\t\t\tself.getEl('inp').id,\r\n\t\t\t\t\t\t\t\tself.value(),\r\n\t\t\t\t\t\t\t\tsettings.filetype,\r\n\t\t\t\t\t\t\t\twindow\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (actionCallback) {\r\n\t\t\t\tsettings.icon = 'browse';\r\n\t\t\t\tsettings.onaction = actionCallback;\r\n\t\t\t}\r\n\r\n\t\t\tself._super(settings);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FitLayout.js\r\n\r\n/**\r\n * FitLayout.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This layout manager will resize the control to be the size of it's parent container.\r\n * In other words width: 100% and height: 100%.\r\n *\r\n * @-x-less FitLayout.less\r\n * @class tinymce.ui.FitLayout\r\n * @extends tinymce.ui.AbsoluteLayout\r\n */\r\ndefine(\"tinymce/ui/FitLayout\", [\r\n\t\"tinymce/ui/AbsoluteLayout\"\r\n], function(AbsoluteLayout) {\r\n\t\"use strict\";\r\n\r\n\treturn AbsoluteLayout.extend({\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the specified container.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\r\n\t\t */\r\n\t\trecalc: function(container) {\r\n\t\t\tvar contLayoutRect = container.layoutRect(), paddingBox = container.paddingBox;\r\n\r\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\r\n\t\t\t\tctrl.layoutRect({\r\n\t\t\t\t\tx: paddingBox.left,\r\n\t\t\t\t\ty: paddingBox.top,\r\n\t\t\t\t\tw: contLayoutRect.innerW - paddingBox.right - paddingBox.left,\r\n\t\t\t\t\th: contLayoutRect.innerH - paddingBox.top - paddingBox.bottom\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (ctrl.recalc) {\r\n\t\t\t\t\tctrl.recalc();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FlexLayout.js\r\n\r\n/**\r\n * FlexLayout.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This layout manager works similar to the CSS flex box.\r\n *\r\n * @setting {String} direction row|row-reverse|column|column-reverse\r\n * @setting {Number} flex A positive-number to flex by.\r\n * @setting {String} align start|end|center|stretch\r\n * @setting {String} pack start|end|justify\r\n *\r\n * @class tinymce.ui.FlexLayout\r\n * @extends tinymce.ui.AbsoluteLayout\r\n */\r\ndefine(\"tinymce/ui/FlexLayout\", [\r\n\t\"tinymce/ui/AbsoluteLayout\"\r\n], function(AbsoluteLayout) {\r\n\t\"use strict\";\r\n\r\n\treturn AbsoluteLayout.extend({\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the specified container.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\r\n\t\t */\r\n\t\trecalc: function(container) {\r\n\t\t\t// A ton of variables, needs to be in the same scope for performance\r\n\t\t\tvar i, l, items, contLayoutRect, contPaddingBox, contSettings, align, pack, spacing, totalFlex, availableSpace, direction;\r\n\t\t\tvar ctrl, ctrlLayoutRect, ctrlSettings, flex, maxSizeItems = [], size, maxSize, ratio, rect, pos, maxAlignEndPos;\r\n\t\t\tvar sizeName, minSizeName, posName, maxSizeName, beforeName, innerSizeName, deltaSizeName, contentSizeName;\r\n\t\t\tvar alignAxisName, alignInnerSizeName, alignSizeName, alignMinSizeName, alignBeforeName, alignAfterName;\r\n\t\t\tvar alignDeltaSizeName, alignContentSizeName;\r\n\t\t\tvar max = Math.max, min = Math.min;\r\n\r\n\t\t\t// Get container items, properties and settings\r\n\t\t\titems = container.items().filter(':visible');\r\n\t\t\tcontLayoutRect = container.layoutRect();\r\n\t\t\tcontPaddingBox = container.paddingBox;\r\n\t\t\tcontSettings = container.settings;\r\n\t\t\tdirection = container.isRtl() ? (contSettings.direction || 'row-reversed') : contSettings.direction;\r\n\t\t\talign = contSettings.align;\r\n\t\t\tpack = container.isRtl() ? (contSettings.pack || 'end') : contSettings.pack;\r\n\t\t\tspacing = contSettings.spacing || 0;\r\n\r\n\t\t\tif (direction == \"row-reversed\" || direction == \"column-reverse\") {\r\n\t\t\t\titems = items.set(items.toArray().reverse());\r\n\t\t\t\tdirection = direction.split('-')[0];\r\n\t\t\t}\r\n\r\n\t\t\t// Setup axis variable name for row/column direction since the calculations is the same\r\n\t\t\tif (direction == \"column\") {\r\n\t\t\t\tposName = \"y\";\r\n\t\t\t\tsizeName = \"h\";\r\n\t\t\t\tminSizeName = \"minH\";\r\n\t\t\t\tmaxSizeName = \"maxH\";\r\n\t\t\t\tinnerSizeName = \"innerH\";\r\n\t\t\t\tbeforeName = 'top';\r\n\t\t\t\tdeltaSizeName = \"deltaH\";\r\n\t\t\t\tcontentSizeName = \"contentH\";\r\n\r\n\t\t\t\talignBeforeName = \"left\";\r\n\t\t\t\talignSizeName = \"w\";\r\n\t\t\t\talignAxisName = \"x\";\r\n\t\t\t\talignInnerSizeName = \"innerW\";\r\n\t\t\t\talignMinSizeName = \"minW\";\r\n\t\t\t\talignAfterName = \"right\";\r\n\t\t\t\talignDeltaSizeName = \"deltaW\";\r\n\t\t\t\talignContentSizeName = \"contentW\";\r\n\t\t\t} else {\r\n\t\t\t\tposName = \"x\";\r\n\t\t\t\tsizeName = \"w\";\r\n\t\t\t\tminSizeName = \"minW\";\r\n\t\t\t\tmaxSizeName = \"maxW\";\r\n\t\t\t\tinnerSizeName = \"innerW\";\r\n\t\t\t\tbeforeName = 'left';\r\n\t\t\t\tdeltaSizeName = \"deltaW\";\r\n\t\t\t\tcontentSizeName = \"contentW\";\r\n\r\n\t\t\t\talignBeforeName = \"top\";\r\n\t\t\t\talignSizeName = \"h\";\r\n\t\t\t\talignAxisName = \"y\";\r\n\t\t\t\talignInnerSizeName = \"innerH\";\r\n\t\t\t\talignMinSizeName = \"minH\";\r\n\t\t\t\talignAfterName = \"bottom\";\r\n\t\t\t\talignDeltaSizeName = \"deltaH\";\r\n\t\t\t\talignContentSizeName = \"contentH\";\r\n\t\t\t}\r\n\r\n\t\t\t// Figure out total flex, availableSpace and collect any max size elements\r\n\t\t\tavailableSpace = contLayoutRect[innerSizeName] - contPaddingBox[beforeName] - contPaddingBox[beforeName];\r\n\t\t\tmaxAlignEndPos = totalFlex = 0;\r\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\r\n\t\t\t\tctrl = items[i];\r\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\r\n\t\t\t\tctrlSettings = ctrl.settings;\r\n\t\t\t\tflex = ctrlSettings.flex;\r\n\t\t\t\tavailableSpace -= (i < l - 1 ? spacing : 0);\r\n\r\n\t\t\t\tif (flex > 0) {\r\n\t\t\t\t\ttotalFlex += flex;\r\n\r\n\t\t\t\t\t// Flexed item has a max size then we need to check if we will hit that size\r\n\t\t\t\t\tif (ctrlLayoutRect[maxSizeName]) {\r\n\t\t\t\t\t\tmaxSizeItems.push(ctrl);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctrlLayoutRect.flex = flex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tavailableSpace -= ctrlLayoutRect[minSizeName];\r\n\r\n\t\t\t\t// Calculate the align end position to be used to check for overflow/underflow\r\n\t\t\t\tsize = contPaddingBox[alignBeforeName] + ctrlLayoutRect[alignMinSizeName] + contPaddingBox[alignAfterName];\r\n\t\t\t\tif (size > maxAlignEndPos) {\r\n\t\t\t\t\tmaxAlignEndPos = size;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate minW/minH\r\n\t\t\trect = {};\r\n\t\t\tif (availableSpace < 0) {\r\n\t\t\t\trect[minSizeName] = contLayoutRect[minSizeName] - availableSpace + contLayoutRect[deltaSizeName];\r\n\t\t\t} else {\r\n\t\t\t\trect[minSizeName] = contLayoutRect[innerSizeName] - availableSpace + contLayoutRect[deltaSizeName];\r\n\t\t\t}\r\n\r\n\t\t\trect[alignMinSizeName] = maxAlignEndPos + contLayoutRect[alignDeltaSizeName];\r\n\r\n\t\t\trect[contentSizeName] = contLayoutRect[innerSizeName] - availableSpace;\r\n\t\t\trect[alignContentSizeName] = maxAlignEndPos;\r\n\t\t\trect.minW = min(rect.minW, contLayoutRect.maxW);\r\n\t\t\trect.minH = min(rect.minH, contLayoutRect.maxH);\r\n\t\t\trect.minW = max(rect.minW, contLayoutRect.startMinWidth);\r\n\t\t\trect.minH = max(rect.minH, contLayoutRect.startMinHeight);\r\n\r\n\t\t\t// Resize container container if minSize was changed\r\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\r\n\t\t\t\trect.w = rect.minW;\r\n\t\t\t\trect.h = rect.minH;\r\n\r\n\t\t\t\tcontainer.layoutRect(rect);\r\n\t\t\t\tthis.recalc(container);\r\n\r\n\t\t\t\t// Forced recalc for example if items are hidden/shown\r\n\t\t\t\tif (container._lastRect === null) {\r\n\t\t\t\t\tvar parentCtrl = container.parent();\r\n\t\t\t\t\tif (parentCtrl) {\r\n\t\t\t\t\t\tparentCtrl._lastRect = null;\r\n\t\t\t\t\t\tparentCtrl.recalc();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Handle max size elements, check if they will become to wide with current options\r\n\t\t\tratio = availableSpace / totalFlex;\r\n\t\t\tfor (i = 0, l = maxSizeItems.length; i < l; i++) {\r\n\t\t\t\tctrl = maxSizeItems[i];\r\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\r\n\t\t\t\tmaxSize = ctrlLayoutRect[maxSizeName];\r\n\t\t\t\tsize = ctrlLayoutRect[minSizeName] + ctrlLayoutRect.flex * ratio;\r\n\r\n\t\t\t\tif (size > maxSize) {\r\n\t\t\t\t\tavailableSpace -= (ctrlLayoutRect[maxSizeName] - ctrlLayoutRect[minSizeName]);\r\n\t\t\t\t\ttotalFlex -= ctrlLayoutRect.flex;\r\n\t\t\t\t\tctrlLayoutRect.flex = 0;\r\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = maxSize;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setup new ratio, target layout rect, start position\r\n\t\t\tratio = availableSpace / totalFlex;\r\n\t\t\tpos = contPaddingBox[beforeName];\r\n\t\t\trect = {};\r\n\r\n\t\t\t// Handle pack setting moves the start position to end, center\r\n\t\t\tif (totalFlex === 0) {\r\n\t\t\t\tif (pack == \"end\") {\r\n\t\t\t\t\tpos = availableSpace + contPaddingBox[beforeName];\r\n\t\t\t\t} else if (pack == \"center\") {\r\n\t\t\t\t\tpos = Math.round(\r\n\t\t\t\t\t\t(contLayoutRect[innerSizeName] / 2) - ((contLayoutRect[innerSizeName] - availableSpace) / 2)\r\n\t\t\t\t\t) + contPaddingBox[beforeName];\r\n\r\n\t\t\t\t\tif (pos < 0) {\r\n\t\t\t\t\t\tpos = contPaddingBox[beforeName];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (pack == \"justify\") {\r\n\t\t\t\t\tpos = contPaddingBox[beforeName];\r\n\t\t\t\t\tspacing = Math.floor(availableSpace / (items.length - 1));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Default aligning (start) the other ones needs to be calculated while doing the layout\r\n\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\r\n\r\n\t\t\t// Start laying out controls\r\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\r\n\t\t\t\tctrl = items[i];\r\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\r\n\t\t\t\tsize = ctrlLayoutRect.maxFlexSize || ctrlLayoutRect[minSizeName];\r\n\r\n\t\t\t\t// Align the control on the other axis\r\n\t\t\t\tif (align === \"center\") {\r\n\t\t\t\t\trect[alignAxisName] = Math.round((contLayoutRect[alignInnerSizeName] / 2) - (ctrlLayoutRect[alignSizeName] / 2));\r\n\t\t\t\t} else if (align === \"stretch\") {\r\n\t\t\t\t\trect[alignSizeName] = max(\r\n\t\t\t\t\t\tctrlLayoutRect[alignMinSizeName] || 0,\r\n\t\t\t\t\t\tcontLayoutRect[alignInnerSizeName] - contPaddingBox[alignBeforeName] - contPaddingBox[alignAfterName]\r\n\t\t\t\t\t);\r\n\t\t\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\r\n\t\t\t\t} else if (align === \"end\") {\r\n\t\t\t\t\trect[alignAxisName] = contLayoutRect[alignInnerSizeName] - ctrlLayoutRect[alignSizeName] - contPaddingBox.top;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Calculate new size based on flex\r\n\t\t\t\tif (ctrlLayoutRect.flex > 0) {\r\n\t\t\t\t\tsize += ctrlLayoutRect.flex * ratio;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trect[sizeName] = size;\r\n\t\t\t\trect[posName] = pos;\r\n\t\t\t\tctrl.layoutRect(rect);\r\n\r\n\t\t\t\t// Recalculate containers\r\n\t\t\t\tif (ctrl.recalc) {\r\n\t\t\t\t\tctrl.recalc();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move x/y position\r\n\t\t\t\tpos += size + spacing;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FlowLayout.js\r\n\r\n/**\r\n * FlowLayout.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This layout manager will place the controls by using the browsers native layout.\r\n *\r\n * @-x-less FlowLayout.less\r\n * @class tinymce.ui.FlowLayout\r\n * @extends tinymce.ui.Layout\r\n */\r\ndefine(\"tinymce/ui/FlowLayout\", [\r\n\t\"tinymce/ui/Layout\"\r\n], function(Layout) {\r\n\treturn Layout.extend({\r\n\t\tDefaults: {\r\n\t\t\tcontainerClass: 'flow-layout',\r\n\t\t\tcontrolClass: 'flow-layout-item',\r\n\t\t\tendClass: 'break'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the specified container.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\r\n\t\t */\r\n\t\trecalc: function(container) {\r\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\r\n\t\t\t\tif (ctrl.recalc) {\r\n\t\t\t\t\tctrl.recalc();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tisNative: function() {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/FormatControls.js\r\n\r\n/**\r\n * FormatControls.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Internal class containing all TinyMCE specific control types such as\r\n * format listboxes, fontlist boxes, toolbar buttons etc.\r\n *\r\n * @class tinymce.ui.FormatControls\r\n */\r\ndefine(\"tinymce/ui/FormatControls\", [\r\n\t\"tinymce/ui/Control\",\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/ui/FloatPanel\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/EditorManager\",\r\n\t\"tinymce/Env\"\r\n], function(Control, Widget, FloatPanel, Tools, EditorManager, Env) {\r\n\tvar each = Tools.each;\r\n\r\n\tEditorManager.on('AddEditor', function(e) {\r\n\t\tif (e.editor.rtl) {\r\n\t\t\tControl.rtl = true;\r\n\t\t}\r\n\r\n\t\tregisterControls(e.editor);\r\n\t});\r\n\r\n\tControl.translate = function(text) {\r\n\t\treturn EditorManager.translate(text);\r\n\t};\r\n\r\n\tWidget.tooltips = !Env.iOS;\r\n\r\n\tfunction registerControls(editor) {\r\n\t\tvar formatMenu;\r\n\r\n\t\tfunction createListBoxChangeHandler(items, formatName) {\r\n\t\t\treturn function() {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\teditor.on('nodeChange', function(e) {\r\n\t\t\t\t\tvar formatter = editor.formatter;\r\n\t\t\t\t\tvar value = null;\r\n\r\n\t\t\t\t\teach(e.parents, function(node) {\r\n\t\t\t\t\t\teach(items, function(item) {\r\n\t\t\t\t\t\t\tif (formatName) {\r\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, formatName, {value: item.value})) {\r\n\t\t\t\t\t\t\t\t\tvalue = item.value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, item.value)) {\r\n\t\t\t\t\t\t\t\t\tvalue = item.value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.value(value);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction createFormats(formats) {\r\n\t\t\tformats = formats.replace(/;$/, '').split(';');\r\n\r\n\t\t\tvar i = formats.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tformats[i] = formats[i].split('=');\r\n\t\t\t}\r\n\r\n\t\t\treturn formats;\r\n\t\t}\r\n\r\n\t\tfunction createFormatMenu() {\r\n\t\t\tvar count = 0, newFormats = [];\r\n\r\n\t\t\tvar defaultStyleFormats = [\r\n\t\t\t\t{title: 'Headings', items: [\r\n\t\t\t\t\t{title: 'Heading 1', format: 'h1'},\r\n\t\t\t\t\t{title: 'Heading 2', format: 'h2'},\r\n\t\t\t\t\t{title: 'Heading 3', format: 'h3'},\r\n\t\t\t\t\t{title: 'Heading 4', format: 'h4'},\r\n\t\t\t\t\t{title: 'Heading 5', format: 'h5'},\r\n\t\t\t\t\t{title: 'Heading 6', format: 'h6'}\r\n\t\t\t\t]},\r\n\r\n\t\t\t\t{title: 'Inline', items: [\r\n\t\t\t\t\t{title: 'Bold', icon: 'bold', format: 'bold'},\r\n\t\t\t\t\t{title: 'Italic', icon: 'italic', format: 'italic'},\r\n\t\t\t\t\t{title: 'Underline', icon: 'underline', format: 'underline'},\r\n\t\t\t\t\t{title: 'Strikethrough', icon: 'strikethrough', format: 'strikethrough'},\r\n\t\t\t\t\t{title: 'Superscript', icon: 'superscript', format: 'superscript'},\r\n\t\t\t\t\t{title: 'Subscript', icon: 'subscript', format: 'subscript'},\r\n\t\t\t\t\t{title: 'Code', icon: 'code', format: 'code'}\r\n\t\t\t\t]},\r\n\r\n\t\t\t\t{title: 'Blocks', items: [\r\n\t\t\t\t\t{title: 'Paragraph', format: 'p'},\r\n\t\t\t\t\t{title: 'Blockquote', format: 'blockquote'},\r\n\t\t\t\t\t{title: 'Div', format: 'div'},\r\n\t\t\t\t\t{title: 'Pre', format: 'pre'}\r\n\t\t\t\t]},\r\n\r\n\t\t\t\t{title: 'Alignment', items: [\r\n\t\t\t\t\t{title: 'Left', icon: 'alignleft', format: 'alignleft'},\r\n\t\t\t\t\t{title: 'Center', icon: 'aligncenter', format: 'aligncenter'},\r\n\t\t\t\t\t{title: 'Right', icon: 'alignright', format: 'alignright'},\r\n\t\t\t\t\t{title: 'Justify', icon: 'alignjustify', format: 'alignjustify'}\r\n\t\t\t\t]}\r\n\t\t\t];\r\n\r\n\t\t\tfunction createMenu(formats) {\r\n\t\t\t\tvar menu = [];\r\n\r\n\t\t\t\tif (!formats) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teach(formats, function(format) {\r\n\t\t\t\t\tvar menuItem = {\r\n\t\t\t\t\t\ttext: format.title,\r\n\t\t\t\t\t\ticon: format.icon\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (format.items) {\r\n\t\t\t\t\t\tmenuItem.menu = createMenu(format.items);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar formatName = format.format || \"custom\" + count++;\r\n\r\n\t\t\t\t\t\tif (!format.format) {\r\n\t\t\t\t\t\t\tformat.name = formatName;\r\n\t\t\t\t\t\t\tnewFormats.push(format);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmenuItem.format = formatName;\r\n\t\t\t\t\t\tmenuItem.cmd = format.cmd;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmenu.push(menuItem);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn menu;\r\n\t\t\t}\r\n\r\n\t\t\tfunction createStylesMenu() {\r\n\t\t\t\tvar menu;\r\n\r\n\t\t\t\tif (editor.settings.style_formats_merge) {\r\n\t\t\t\t\tif (editor.settings.style_formats) {\r\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats.concat(editor.settings.style_formats));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmenu = createMenu(editor.settings.style_formats || defaultStyleFormats);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn menu;\r\n\t\t\t}\r\n\r\n\t\t\teditor.on('init', function() {\r\n\t\t\t\teach(newFormats, function(format) {\r\n\t\t\t\t\teditor.formatter.register(format.name, format);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'menu',\r\n\t\t\t\titems: createStylesMenu(),\r\n\t\t\t\tonPostRender: function(e) {\r\n\t\t\t\t\teditor.fire('renderFormatsMenu', {control: e.control});\r\n\t\t\t\t},\r\n\t\t\t\titemDefaults: {\r\n\t\t\t\t\tpreview: true,\r\n\r\n\t\t\t\t\ttextStyle: function() {\r\n\t\t\t\t\t\tif (this.settings.format) {\r\n\t\t\t\t\t\t\treturn editor.formatter.getCssText(this.settings.format);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tonPostRender: function() {\r\n\t\t\t\t\t\tvar self = this;\r\n\r\n\t\t\t\t\t\tself.parent().on('show', function() {\r\n\t\t\t\t\t\t\tvar formatName, command;\r\n\r\n\t\t\t\t\t\t\tformatName = self.settings.format;\r\n\t\t\t\t\t\t\tif (formatName) {\r\n\t\t\t\t\t\t\t\tself.disabled(!editor.formatter.canApply(formatName));\r\n\t\t\t\t\t\t\t\tself.active(editor.formatter.match(formatName));\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tcommand = self.settings.cmd;\r\n\t\t\t\t\t\t\tif (command) {\r\n\t\t\t\t\t\t\t\tself.active(editor.queryCommandState(command));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tonclick: function() {\r\n\t\t\t\t\t\tif (this.settings.format) {\r\n\t\t\t\t\t\t\ttoggleFormat(this.settings.format);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this.settings.cmd) {\r\n\t\t\t\t\t\t\teditor.execCommand(this.settings.cmd);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tformatMenu = createFormatMenu();\r\n\r\n\t\tfunction initOnPostRender(name) {\r\n\t\t\treturn function() {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\t// TODO: Fix this\r\n\t\t\t\tif (editor.formatter) {\r\n\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\r\n\t\t\t\t\t\tself.active(state);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\teditor.on('init', function() {\r\n\t\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\r\n\t\t\t\t\t\t\tself.active(state);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Simple format controls <control/format>:<UI text>\r\n\t\teach({\r\n\t\t\tbold: 'Bold',\r\n\t\t\titalic: 'Italic',\r\n\t\t\tunderline: 'Underline',\r\n\t\t\tstrikethrough: 'Strikethrough',\r\n\t\t\tsubscript: 'Subscript',\r\n\t\t\tsuperscript: 'Superscript'\r\n\t\t}, function(text, name) {\r\n\t\t\teditor.addButton(name, {\r\n\t\t\t\ttooltip: text,\r\n\t\t\t\tonPostRender: initOnPostRender(name),\r\n\t\t\t\tonclick: function() {\r\n\t\t\t\t\ttoggleFormat(name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Simple command controls <control>:[<UI text>,<Command>]\r\n\t\teach({\r\n\t\t\toutdent: ['Decrease indent', 'Outdent'],\r\n\t\t\tindent: ['Increase indent', 'Indent'],\r\n\t\t\tcut: ['Cut', 'Cut'],\r\n\t\t\tcopy: ['Copy', 'Copy'],\r\n\t\t\tpaste: ['Paste', 'Paste'],\r\n\t\t\thelp: ['Help', 'mceHelp'],\r\n\t\t\tselectall: ['Select all', 'SelectAll'],\r\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat'],\r\n\t\t\tvisualaid: ['Visual aids', 'mceToggleVisualAid'],\r\n\t\t\tnewdocument: ['New document', 'mceNewDocument']\r\n\t\t}, function(item, name) {\r\n\t\t\teditor.addButton(name, {\r\n\t\t\t\ttooltip: item[0],\r\n\t\t\t\tcmd: item[1]\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Simple command controls with format state\r\n\t\teach({\r\n\t\t\tblockquote: ['Blockquote', 'mceBlockQuote'],\r\n\t\t\tnumlist: ['Numbered list', 'InsertOrderedList'],\r\n\t\t\tbullist: ['Bullet list', 'InsertUnorderedList'],\r\n\t\t\tsubscript: ['Subscript', 'Subscript'],\r\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\r\n\t\t\talignleft: ['Align left', 'JustifyLeft'],\r\n\t\t\taligncenter: ['Align center', 'JustifyCenter'],\r\n\t\t\talignright: ['Align right', 'JustifyRight'],\r\n\t\t\talignjustify: ['Justify', 'JustifyFull'],\r\n\t\t\talignnone: ['No alignment', 'JustifyNone']\r\n\t\t}, function(item, name) {\r\n\t\t\teditor.addButton(name, {\r\n\t\t\t\ttooltip: item[0],\r\n\t\t\t\tcmd: item[1],\r\n\t\t\t\tonPostRender: initOnPostRender(name)\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tfunction toggleUndoRedoState(type) {\r\n\t\t\treturn function() {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\ttype = type == 'redo' ? 'hasRedo' : 'hasUndo';\r\n\r\n\t\t\t\tfunction checkState() {\r\n\t\t\t\t\treturn editor.undoManager ? editor.undoManager[type]() : false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.disabled(!checkState());\r\n\t\t\t\teditor.on('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', function() {\r\n\t\t\t\t\tself.disabled(editor.readonly || !checkState());\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction toggleVisualAidState() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\teditor.on('VisualAid', function(e) {\r\n\t\t\t\tself.active(e.hasVisual);\r\n\t\t\t});\r\n\r\n\t\t\tself.active(editor.hasVisual);\r\n\t\t}\r\n\r\n\t\teditor.addButton('undo', {\r\n\t\t\ttooltip: 'Undo',\r\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\r\n\t\t\tcmd: 'undo'\r\n\t\t});\r\n\r\n\t\teditor.addButton('redo', {\r\n\t\t\ttooltip: 'Redo',\r\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\r\n\t\t\tcmd: 'redo'\r\n\t\t});\r\n\r\n\t\teditor.addMenuItem('newdocument', {\r\n\t\t\ttext: 'New document',\r\n\t\t\ticon: 'newdocument',\r\n\t\t\tcmd: 'mceNewDocument'\r\n\t\t});\r\n\r\n\t\teditor.addMenuItem('undo', {\r\n\t\t\ttext: 'Undo',\r\n\t\t\ticon: 'undo',\r\n\t\t\tshortcut: 'Meta+Z',\r\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\r\n\t\t\tcmd: 'undo'\r\n\t\t});\r\n\r\n\t\teditor.addMenuItem('redo', {\r\n\t\t\ttext: 'Redo',\r\n\t\t\ticon: 'redo',\r\n\t\t\tshortcut: 'Meta+Y',\r\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\r\n\t\t\tcmd: 'redo'\r\n\t\t});\r\n\r\n\t\teditor.addMenuItem('visualaid', {\r\n\t\t\ttext: 'Visual aids',\r\n\t\t\tselectable: true,\r\n\t\t\tonPostRender: toggleVisualAidState,\r\n\t\t\tcmd: 'mceToggleVisualAid'\r\n\t\t});\r\n\r\n\t\teditor.addButton('remove', {\r\n\t\t\ttooltip: 'Remove',\r\n\t\t\ticon: 'remove',\r\n\t\t\tcmd: 'Delete'\r\n\t\t});\r\n\r\n\t\teach({\r\n\t\t\tcut: ['Cut', 'Cut', 'Meta+X'],\r\n\t\t\tcopy: ['Copy', 'Copy', 'Meta+C'],\r\n\t\t\tpaste: ['Paste', 'Paste', 'Meta+V'],\r\n\t\t\tselectall: ['Select all', 'SelectAll', 'Meta+A'],\r\n\t\t\tbold: ['Bold', 'Bold', 'Meta+B'],\r\n\t\t\titalic: ['Italic', 'Italic', 'Meta+I'],\r\n\t\t\tunderline: ['Underline', 'Underline'],\r\n\t\t\tstrikethrough: ['Strikethrough', 'Strikethrough'],\r\n\t\t\tsubscript: ['Subscript', 'Subscript'],\r\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\r\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat']\r\n\t\t}, function(item, name) {\r\n\t\t\teditor.addMenuItem(name, {\r\n\t\t\t\ttext: item[0],\r\n\t\t\t\ticon: name,\r\n\t\t\t\tshortcut: item[2],\r\n\t\t\t\tcmd: item[1]\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\teditor.on('mousedown', function() {\r\n\t\t\tFloatPanel.hideAll();\r\n\t\t});\r\n\r\n\t\tfunction toggleFormat(fmt) {\r\n\t\t\tif (fmt.control) {\r\n\t\t\t\tfmt = fmt.control.value();\r\n\t\t\t}\r\n\r\n\t\t\tif (fmt) {\r\n\t\t\t\teditor.execCommand('mceToggleFormat', false, fmt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\teditor.addButton('styleselect', {\r\n\t\t\ttype: 'menubutton',\r\n\t\t\ttext: 'Formats',\r\n\t\t\tmenu: formatMenu\r\n\t\t});\r\n\r\n\t\teditor.addButton('formatselect', function() {\r\n\t\t\tvar items = [], blocks = createFormats(editor.settings.block_formats ||\r\n\t\t\t\t'Paragraph=p;' +\r\n\t\t\t\t'Heading 1=h1;' +\r\n\t\t\t\t'Heading 2=h2;' +\r\n\t\t\t\t'Heading 3=h3;' +\r\n\t\t\t\t'Heading 4=h4;' +\r\n\t\t\t\t'Heading 5=h5;' +\r\n\t\t\t\t'Heading 6=h6;' +\r\n\t\t\t\t'Preformatted=pre'\r\n\t\t\t);\r\n\r\n\t\t\teach(blocks, function(block) {\r\n\t\t\t\titems.push({\r\n\t\t\t\t\ttext: block[0],\r\n\t\t\t\t\tvalue: block[1],\r\n\t\t\t\t\ttextStyle: function() {\r\n\t\t\t\t\t\treturn editor.formatter.getCssText(block[1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'listbox',\r\n\t\t\t\ttext: blocks[0][0],\r\n\t\t\t\tvalues: items,\r\n\t\t\t\tfixedWidth: true,\r\n\t\t\t\tonselect: toggleFormat,\r\n\t\t\t\tonPostRender: createListBoxChangeHandler(items)\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\teditor.addButton('fontselect', function() {\r\n\t\t\tvar defaultFontsFormats =\r\n\t\t\t\t'Andale Mono=andale mono,monospace;' +\r\n\t\t\t\t'Arial=arial,helvetica,sans-serif;' +\r\n\t\t\t\t'Arial Black=arial black,sans-serif;' +\r\n\t\t\t\t'Book Antiqua=book antiqua,palatino,serif;' +\r\n\t\t\t\t'Comic Sans MS=comic sans ms,sans-serif;' +\r\n\t\t\t\t'Courier New=courier new,courier,monospace;' +\r\n\t\t\t\t'Georgia=georgia,palatino,serif;' +\r\n\t\t\t\t'Helvetica=helvetica,arial,sans-serif;' +\r\n\t\t\t\t'Impact=impact,sans-serif;' +\r\n\t\t\t\t'Symbol=symbol;' +\r\n\t\t\t\t'Tahoma=tahoma,arial,helvetica,sans-serif;' +\r\n\t\t\t\t'Terminal=terminal,monaco,monospace;' +\r\n\t\t\t\t'Times New Roman=times new roman,times,serif;' +\r\n\t\t\t\t'Trebuchet MS=trebuchet ms,geneva,sans-serif;' +\r\n\t\t\t\t'Verdana=verdana,geneva,sans-serif;' +\r\n\t\t\t\t'Webdings=webdings;' +\r\n\t\t\t\t'Wingdings=wingdings,zapf dingbats';\r\n\r\n\t\t\tvar items = [], fonts = createFormats(editor.settings.font_formats || defaultFontsFormats);\r\n\r\n\t\t\teach(fonts, function(font) {\r\n\t\t\t\titems.push({\r\n\t\t\t\t\ttext: {raw: font[0]},\r\n\t\t\t\t\tvalue: font[1],\r\n\t\t\t\t\ttextStyle: font[1].indexOf('dings') == -1 ? 'font-family:' + font[1] : ''\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'listbox',\r\n\t\t\t\ttext: 'Font Family',\r\n\t\t\t\ttooltip: 'Font Family',\r\n\t\t\t\tvalues: items,\r\n\t\t\t\tfixedWidth: true,\r\n\t\t\t\tonPostRender: createListBoxChangeHandler(items, 'fontname'),\r\n\t\t\t\tonselect: function(e) {\r\n\t\t\t\t\tif (e.control.settings.value) {\r\n\t\t\t\t\t\teditor.execCommand('FontName', false, e.control.settings.value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\teditor.addButton('fontsizeselect', function() {\r\n\t\t\tvar items = [], defaultFontsizeFormats = '8pt 10pt 12pt 14pt 18pt 24pt 36pt';\r\n\t\t\tvar fontsize_formats = editor.settings.fontsize_formats || defaultFontsizeFormats;\r\n\r\n\t\t\teach(fontsize_formats.split(' '), function(item) {\r\n\t\t\t\tvar text = item, value = item;\r\n\t\t\t\t// Allow text=value font sizes.\r\n\t\t\t\tvar values = item.split('=');\r\n\t\t\t\tif (values.length > 1) {\r\n\t\t\t\t\ttext = values[0];\r\n\t\t\t\t\tvalue = values[1];\r\n\t\t\t\t}\r\n\t\t\t\titems.push({text: text, value: value});\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'listbox',\r\n\t\t\t\ttext: 'Font Sizes',\r\n\t\t\t\ttooltip: 'Font Sizes',\r\n\t\t\t\tvalues: items,\r\n\t\t\t\tfixedWidth: true,\r\n\t\t\t\tonPostRender: createListBoxChangeHandler(items, 'fontsize'),\r\n\t\t\t\tonclick: function(e) {\r\n\t\t\t\t\tif (e.control.settings.value) {\r\n\t\t\t\t\t\teditor.execCommand('FontSize', false, e.control.settings.value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\teditor.addMenuItem('formats', {\r\n\t\t\ttext: 'Formats',\r\n\t\t\tmenu: formatMenu\r\n\t\t});\r\n\t}\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/GridLayout.js\r\n\r\n/**\r\n * GridLayout.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This layout manager places controls in a grid.\r\n *\r\n * @setting {Number} spacing Spacing between controls.\r\n * @setting {Number} spacingH Horizontal spacing between controls.\r\n * @setting {Number} spacingV Vertical spacing between controls.\r\n * @setting {Number} columns Number of columns to use.\r\n * @setting {String/Array} alignH start|end|center|stretch or array of values for each column.\r\n * @setting {String/Array} alignV start|end|center|stretch or array of values for each column.\r\n * @setting {String} pack start|end\r\n *\r\n * @class tinymce.ui.GridLayout\r\n * @extends tinymce.ui.AbsoluteLayout\r\n */\r\ndefine(\"tinymce/ui/GridLayout\", [\r\n\t\"tinymce/ui/AbsoluteLayout\"\r\n], function(AbsoluteLayout) {\r\n\t\"use strict\";\r\n\r\n\treturn AbsoluteLayout.extend({\r\n\t\t/**\r\n\t\t * Recalculates the positions of the controls in the specified container.\r\n\t\t *\r\n\t\t * @method recalc\r\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\r\n\t\t */\r\n\t\trecalc: function(container) {\r\n\t\t\tvar settings, rows, cols, items, contLayoutRect, width, height, rect,\r\n\t\t\t\tctrlLayoutRect, ctrl, x, y, posX, posY, ctrlSettings, contPaddingBox, align, spacingH, spacingV, alignH, alignV, maxX, maxY,\r\n\t\t\t\tcolWidths = [], rowHeights = [], ctrlMinWidth, ctrlMinHeight, availableWidth, availableHeight, reverseRows, idx;\r\n\r\n\t\t\t// Get layout settings\r\n\t\t\tsettings = container.settings;\r\n\t\t\titems = container.items().filter(':visible');\r\n\t\t\tcontLayoutRect = container.layoutRect();\r\n\t\t\tcols = settings.columns || Math.ceil(Math.sqrt(items.length));\r\n\t\t\trows = Math.ceil(items.length / cols);\r\n\t\t\tspacingH = settings.spacingH || settings.spacing || 0;\r\n\t\t\tspacingV = settings.spacingV || settings.spacing || 0;\r\n\t\t\talignH = settings.alignH || settings.align;\r\n\t\t\talignV = settings.alignV || settings.align;\r\n\t\t\tcontPaddingBox = container.paddingBox;\r\n\t\t\treverseRows = 'reverseRows' in settings ? settings.reverseRows : container.isRtl();\r\n\r\n\t\t\tif (alignH && typeof alignH == \"string\") {\r\n\t\t\t\talignH = [alignH];\r\n\t\t\t}\r\n\r\n\t\t\tif (alignV && typeof alignV == \"string\") {\r\n\t\t\t\talignV = [alignV];\r\n\t\t\t}\r\n\r\n\t\t\t// Zero padd columnWidths\r\n\t\t\tfor (x = 0; x < cols; x++) {\r\n\t\t\t\tcolWidths.push(0);\r\n\t\t\t}\r\n\r\n\t\t\t// Zero padd rowHeights\r\n\t\t\tfor (y = 0; y < rows; y++) {\r\n\t\t\t\trowHeights.push(0);\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate columnWidths and rowHeights\r\n\t\t\tfor (y = 0; y < rows; y++) {\r\n\t\t\t\tfor (x = 0; x < cols; x++) {\r\n\t\t\t\t\tctrl = items[y * cols + x];\r\n\r\n\t\t\t\t\t// Out of bounds\r\n\t\t\t\t\tif (!ctrl) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\r\n\t\t\t\t\tctrlMinWidth = ctrlLayoutRect.minW;\r\n\t\t\t\t\tctrlMinHeight = ctrlLayoutRect.minH;\r\n\r\n\t\t\t\t\tcolWidths[x] = ctrlMinWidth > colWidths[x] ? ctrlMinWidth : colWidths[x];\r\n\t\t\t\t\trowHeights[y] = ctrlMinHeight > rowHeights[y] ? ctrlMinHeight : rowHeights[y];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate maxX\r\n\t\t\tavailableWidth = contLayoutRect.innerW - contPaddingBox.left - contPaddingBox.right;\r\n\t\t\tfor (maxX = 0, x = 0; x < cols; x++) {\r\n\t\t\t\tmaxX += colWidths[x] + (x > 0 ? spacingH : 0);\r\n\t\t\t\tavailableWidth -= (x > 0 ? spacingH : 0) + colWidths[x];\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate maxY\r\n\t\t\tavailableHeight = contLayoutRect.innerH - contPaddingBox.top - contPaddingBox.bottom;\r\n\t\t\tfor (maxY = 0, y = 0; y < rows; y++) {\r\n\t\t\t\tmaxY += rowHeights[y] + (y > 0 ? spacingV : 0);\r\n\t\t\t\tavailableHeight -= (y > 0 ? spacingV : 0) + rowHeights[y];\r\n\t\t\t}\r\n\r\n\t\t\tmaxX += contPaddingBox.left + contPaddingBox.right;\r\n\t\t\tmaxY += contPaddingBox.top + contPaddingBox.bottom;\r\n\r\n\t\t\t// Calculate minW/minH\r\n\t\t\trect = {};\r\n\t\t\trect.minW = maxX + (contLayoutRect.w - contLayoutRect.innerW);\r\n\t\t\trect.minH = maxY + (contLayoutRect.h - contLayoutRect.innerH);\r\n\r\n\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\r\n\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\r\n\t\t\trect.minW = Math.min(rect.minW, contLayoutRect.maxW);\r\n\t\t\trect.minH = Math.min(rect.minH, contLayoutRect.maxH);\r\n\t\t\trect.minW = Math.max(rect.minW, contLayoutRect.startMinWidth);\r\n\t\t\trect.minH = Math.max(rect.minH, contLayoutRect.startMinHeight);\r\n\r\n\t\t\t// Resize container container if minSize was changed\r\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\r\n\t\t\t\trect.w = rect.minW;\r\n\t\t\t\trect.h = rect.minH;\r\n\r\n\t\t\t\tcontainer.layoutRect(rect);\r\n\t\t\t\tthis.recalc(container);\r\n\r\n\t\t\t\t// Forced recalc for example if items are hidden/shown\r\n\t\t\t\tif (container._lastRect === null) {\r\n\t\t\t\t\tvar parentCtrl = container.parent();\r\n\t\t\t\t\tif (parentCtrl) {\r\n\t\t\t\t\t\tparentCtrl._lastRect = null;\r\n\t\t\t\t\t\tparentCtrl.recalc();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Update contentW/contentH so absEnd moves correctly\r\n\t\t\tif (contLayoutRect.autoResize) {\r\n\t\t\t\trect = container.layoutRect(rect);\r\n\t\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\r\n\t\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\r\n\t\t\t}\r\n\r\n\t\t\tvar flexV;\r\n\r\n\t\t\tif (settings.packV == 'start') {\r\n\t\t\t\tflexV = 0;\r\n\t\t\t} else {\r\n\t\t\t\tflexV = availableHeight > 0 ? Math.floor(availableHeight / rows) : 0;\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate totalFlex\r\n\t\t\tvar totalFlex = 0;\r\n\t\t\tvar flexWidths = settings.flexWidths;\r\n\t\t\tif (flexWidths) {\r\n\t\t\t\tfor (x = 0; x < flexWidths.length; x++) {\r\n\t\t\t\t\ttotalFlex += flexWidths[x];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttotalFlex = cols;\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate new column widths based on flex values\r\n\t\t\tvar ratio = availableWidth / totalFlex;\r\n\t\t\tfor (x = 0; x < cols; x++) {\r\n\t\t\t\tcolWidths[x] += flexWidths ? flexWidths[x] * ratio : ratio;\r\n\t\t\t}\r\n\r\n\t\t\t// Move/resize controls\r\n\t\t\tposY = contPaddingBox.top;\r\n\t\t\tfor (y = 0; y < rows; y++) {\r\n\t\t\t\tposX = contPaddingBox.left;\r\n\t\t\t\theight = rowHeights[y] + flexV;\r\n\r\n\t\t\t\tfor (x = 0; x < cols; x++) {\r\n\t\t\t\t\tif (reverseRows) {\r\n\t\t\t\t\t\tidx = y * cols + cols - 1 - x;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tidx = y * cols + x;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctrl = items[idx];\r\n\r\n\t\t\t\t\t// No more controls to render then break\r\n\t\t\t\t\tif (!ctrl) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get control settings and calculate x, y\r\n\t\t\t\t\tctrlSettings = ctrl.settings;\r\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\r\n\t\t\t\t\twidth = Math.max(colWidths[x], ctrlLayoutRect.startMinWidth);\r\n\t\t\t\t\tctrlLayoutRect.x = posX;\r\n\t\t\t\t\tctrlLayoutRect.y = posY;\r\n\r\n\t\t\t\t\t// Align control horizontal\r\n\t\t\t\t\talign = ctrlSettings.alignH || (alignH ? (alignH[x] || alignH[0]) : null);\r\n\t\t\t\t\tif (align == \"center\") {\r\n\t\t\t\t\t\tctrlLayoutRect.x = posX + (width / 2) - (ctrlLayoutRect.w / 2);\r\n\t\t\t\t\t} else if (align == \"right\") {\r\n\t\t\t\t\t\tctrlLayoutRect.x = posX + width - ctrlLayoutRect.w;\r\n\t\t\t\t\t} else if (align == \"stretch\") {\r\n\t\t\t\t\t\tctrlLayoutRect.w = width;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Align control vertical\r\n\t\t\t\t\talign = ctrlSettings.alignV || (alignV ? (alignV[x] || alignV[0]) : null);\r\n\t\t\t\t\tif (align == \"center\") {\r\n\t\t\t\t\t\tctrlLayoutRect.y = posY + (height / 2) - (ctrlLayoutRect.h / 2);\r\n\t\t\t\t\t} else if (align == \"bottom\") {\r\n\t\t\t\t\t\tctrlLayoutRect.y = posY + height - ctrlLayoutRect.h;\r\n\t\t\t\t\t} else if (align == \"stretch\") {\r\n\t\t\t\t\t\tctrlLayoutRect.h = height;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tctrl.layoutRect(ctrlLayoutRect);\r\n\r\n\t\t\t\t\tposX += width + spacingH;\r\n\r\n\t\t\t\t\tif (ctrl.recalc) {\r\n\t\t\t\t\t\tctrl.recalc();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tposY += height + spacingV;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Iframe.js\r\n\r\n/**\r\n * Iframe.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/*jshint scripturl:true */\r\n\r\n/**\r\n * This class creates an iframe.\r\n *\r\n * @setting {String} url Url to open in the iframe.\r\n *\r\n * @-x-less Iframe.less\r\n * @class tinymce.ui.Iframe\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/Iframe\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/util/Delay\"\r\n], function(Widget, Delay) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.classes.add('iframe');\r\n\t\t\tself.canFocus = false;\r\n\r\n\t\t\t/*eslint no-script-url:0 */\r\n\t\t\treturn (\r\n\t\t\t\t'<iframe id=\"' + self._id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" src=\"' +\r\n\t\t\t\t(self.settings.url || \"javascript:''\") + '\" frameborder=\"0\"></iframe>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Setter for the iframe source.\r\n\t\t *\r\n\t\t * @method src\r\n\t\t * @param {String} src Source URL for iframe.\r\n\t\t */\r\n\t\tsrc: function(src) {\r\n\t\t\tthis.getEl().src = src;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Inner HTML for the iframe.\r\n\t\t *\r\n\t\t * @method html\r\n\t\t * @param {String} html HTML string to set as HTML inside the iframe.\r\n\t\t * @param {function} callback Optional callback to execute when the iframe body is filled with contents.\r\n\t\t * @return {tinymce.ui.Iframe} Current iframe control.\r\n\t\t */\r\n\t\thtml: function(html, callback) {\r\n\t\t\tvar self = this, body = this.getEl().contentWindow.document.body;\r\n\r\n\t\t\t// Wait for iframe to initialize IE 10 takes time\r\n\t\t\tif (!body) {\r\n\t\t\t\tDelay.setTimeout(function() {\r\n\t\t\t\t\tself.html(html);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tbody.innerHTML = html;\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/InfoBox.js\r\n\r\n/**\r\n * InfoBox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * ....\r\n *\r\n * @-x-less InfoBox.less\r\n * @class tinymce.ui.InfoBox\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/InfoBox\", [\r\n\t\"tinymce/ui/Widget\"\r\n], function(Widget) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Boolean} multiline Multiline label.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself.classes.add('widget').add('infobox');\r\n\t\t\tself.canFocus = false;\r\n\t\t},\r\n\r\n\t\tseverity: function(level) {\r\n\t\t\tthis.classes.remove('error');\r\n\t\t\tthis.classes.remove('warning');\r\n\t\t\tthis.classes.remove('success');\r\n\t\t\tthis.classes.add(level);\r\n\t\t},\r\n\r\n\t\thelp: function(state) {\r\n\t\t\tthis.state.set('help', state);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, prefix = self.classPrefix;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\r\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\r\n\t\t\t\t\t\t'<button role=\"button\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-help\"></i>' +\r\n\t\t\t\t\t\t'</button>' +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:text', function(e) {\r\n\t\t\t\tself.getEl('body').firstChild.data = self.encode(e.value);\r\n\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tself.updateLayoutRect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:help', function(e) {\r\n\t\t\t\tself.classes.toggle('has-help', e.value);\r\n\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tself.updateLayoutRect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Label.js\r\n\r\n/**\r\n * Label.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class creates a label element. A label is a simple text control\r\n * that can be bound to other controls.\r\n *\r\n * @-x-less Label.less\r\n * @class tinymce.ui.Label\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/Label\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/ui/DomUtils\"\r\n], function(Widget, DomUtils) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Boolean} multiline Multiline label.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself.classes.add('widget').add('label');\r\n\t\t\tself.canFocus = false;\r\n\r\n\t\t\tif (settings.multiline) {\r\n\t\t\t\tself.classes.add('autoscroll');\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.strong) {\r\n\t\t\t\tself.classes.add('strong');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Initializes the current controls layout rect.\r\n\t\t * This will be executed by the layout managers to determine the\r\n\t\t * default minWidth/minHeight etc.\r\n\t\t *\r\n\t\t * @method initLayoutRect\r\n\t\t * @return {Object} Layout rect instance.\r\n\t\t */\r\n\t\tinitLayoutRect: function() {\r\n\t\t\tvar self = this, layoutRect = self._super();\r\n\r\n\t\t\tif (self.settings.multiline) {\r\n\t\t\t\tvar size = DomUtils.getSize(self.getEl());\r\n\r\n\t\t\t\t// Check if the text fits within maxW if not then try word wrapping it\r\n\t\t\t\tif (size.width > layoutRect.maxW) {\r\n\t\t\t\t\tlayoutRect.minW = layoutRect.maxW;\r\n\t\t\t\t\tself.classes.add('multiline');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.getEl().style.width = layoutRect.minW + 'px';\r\n\t\t\t\tlayoutRect.startMinH = layoutRect.h = layoutRect.minH = Math.min(layoutRect.maxH, DomUtils.getSize(self.getEl()).height);\r\n\t\t\t}\r\n\r\n\t\t\treturn layoutRect;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!self.settings.multiline) {\r\n\t\t\t\tself.getEl().style.lineHeight = self.layoutRect().h + 'px';\r\n\t\t\t}\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\tseverity: function(level) {\r\n\t\t\tthis.classes.remove('error');\r\n\t\t\tthis.classes.remove('warning');\r\n\t\t\tthis.classes.remove('success');\r\n\t\t\tthis.classes.add(level);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, targetCtrl, forName, forId = self.settings.forId;\r\n\r\n\t\t\tif (!forId && (forName = self.settings.forName)) {\r\n\t\t\t\ttargetCtrl = self.getRoot().find('#' + forName)[0];\r\n\r\n\t\t\t\tif (targetCtrl) {\r\n\t\t\t\t\tforId = targetCtrl._id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (forId) {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t'<label id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (forId ? ' for=\"' + forId + '\"' : '') + '>' +\r\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\r\n\t\t\t\t\t'</label>'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<span id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\tself.encode(self.state.get('text')) +\r\n\t\t\t\t'</span>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:text', function(e) {\r\n\t\t\t\tself.innerHtml(self.encode(e.value));\r\n\r\n\t\t\t\tif (self.state.get('rendered')) {\r\n\t\t\t\t\tself.updateLayoutRect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Toolbar.js\r\n\r\n/**\r\n * Toolbar.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new toolbar.\r\n *\r\n * @class tinymce.ui.Toolbar\r\n * @extends tinymce.ui.Container\r\n */\r\ndefine(\"tinymce/ui/Toolbar\", [\r\n\t\"tinymce/ui/Container\"\r\n], function(Container) {\r\n\t\"use strict\";\r\n\r\n\treturn Container.extend({\r\n\t\tDefaults: {\r\n\t\t\trole: 'toolbar',\r\n\t\t\tlayout: 'flow'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself.classes.add('toolbar');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.items().each(function(ctrl) {\r\n\t\t\t\tctrl.classes.add('toolbar-item');\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/MenuBar.js\r\n\r\n/**\r\n * MenuBar.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new menubar.\r\n *\r\n * @-x-less MenuBar.less\r\n * @class tinymce.ui.MenuBar\r\n * @extends tinymce.ui.Container\r\n */\r\ndefine(\"tinymce/ui/MenuBar\", [\r\n\t\"tinymce/ui/Toolbar\"\r\n], function(Toolbar) {\r\n\t\"use strict\";\r\n\r\n\treturn Toolbar.extend({\r\n\t\tDefaults: {\r\n\t\t\trole: 'menubar',\r\n\t\t\tcontainerCls: 'menubar',\r\n\t\t\tariaRoot: true,\r\n\t\t\tdefaults: {\r\n\t\t\t\ttype: 'menubutton'\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/MenuButton.js\r\n\r\n/**\r\n * MenuButton.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new menu button.\r\n *\r\n * @-x-less MenuButton.less\r\n * @class tinymce.ui.MenuButton\r\n * @extends tinymce.ui.Button\r\n */\r\ndefine(\"tinymce/ui/MenuButton\", [\r\n\t\"tinymce/ui/Button\",\r\n\t\"tinymce/ui/Factory\",\r\n\t\"tinymce/ui/MenuBar\"\r\n], function(Button, Factory, MenuBar) {\r\n\t\"use strict\";\r\n\r\n\t// TODO: Maybe add as some global function\r\n\tfunction isChildOf(node, parent) {\r\n\t\twhile (node) {\r\n\t\t\tif (parent === node) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar MenuButton = Button.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._renderOpen = true;\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tsettings = self.settings;\r\n\r\n\t\t\tself.classes.add('menubtn');\r\n\r\n\t\t\tif (settings.fixedWidth) {\r\n\t\t\t\tself.classes.add('fixed-width');\r\n\t\t\t}\r\n\r\n\t\t\tself.aria('haspopup', true);\r\n\r\n\t\t\tself.state.set('menu', settings.menu || self.render());\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Shows the menu for the button.\r\n\t\t *\r\n\t\t * @method showMenu\r\n\t\t */\r\n\t\tshowMenu: function() {\r\n\t\t\tvar self = this, menu;\r\n\r\n\t\t\tif (self.menu && self.menu.visible()) {\r\n\t\t\t\treturn self.hideMenu();\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.menu) {\r\n\t\t\t\tmenu = self.state.get('menu') || [];\r\n\r\n\t\t\t\t// Is menu array then auto constuct menu control\r\n\t\t\t\tif (menu.length) {\r\n\t\t\t\t\tmenu = {\r\n\t\t\t\t\t\ttype: 'menu',\r\n\t\t\t\t\t\titems: menu\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmenu.type = menu.type || 'menu';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!menu.renderTo) {\r\n\t\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.menu = menu.parent(self).show().renderTo();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.fire('createmenu');\r\n\t\t\t\tself.menu.reflow();\r\n\t\t\t\tself.menu.on('cancel', function(e) {\r\n\t\t\t\t\tif (e.control.parent() === self.menu) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tself.focus();\r\n\t\t\t\t\t\tself.hideMenu();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Move focus to button when a menu item is selected/clicked\r\n\t\t\t\tself.menu.on('select', function() {\r\n\t\t\t\t\tself.focus();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.menu.on('show hide', function(e) {\r\n\t\t\t\t\tif (e.control == self.menu) {\r\n\t\t\t\t\t\tself.activeMenu(e.type == 'show');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.aria('expanded', e.type == 'show');\r\n\t\t\t\t}).fire('show');\r\n\t\t\t}\r\n\r\n\t\t\tself.menu.show();\r\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\r\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides the menu for the button.\r\n\t\t *\r\n\t\t * @method hideMenu\r\n\t\t */\r\n\t\thideMenu: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.menu) {\r\n\t\t\t\tself.menu.items().each(function(item) {\r\n\t\t\t\t\tif (item.hideMenu) {\r\n\t\t\t\t\t\titem.hideMenu();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.menu.hide();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the active menu state.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tactiveMenu: function(state) {\r\n\t\t\tthis.classes.toggle('active', state);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\r\n\t\t\tvar icon = self.settings.icon, image, text = self.state.get('text'),\r\n\t\t\t\ttextHtml = '';\r\n\r\n\t\t\timage = self.settings.image;\r\n\t\t\tif (image) {\r\n\t\t\t\ticon = 'none';\r\n\r\n\t\t\t\t// Support for [high dpi, low dpi] image sources\r\n\t\t\t\tif (typeof image != \"string\") {\r\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\r\n\t\t\t} else {\r\n\t\t\t\timage = '';\r\n\t\t\t}\r\n\r\n\t\t\tif (text) {\r\n\t\t\t\tself.classes.add('btn-has-text');\r\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\r\n\t\t\t}\r\n\r\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\r\n\r\n\t\t\tself.aria('role', self.parent() instanceof MenuBar ? 'menuitem' : 'button');\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\r\n\t\t\t\t\t'<button id=\"' + id + '-open\" role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\r\n\t\t\t\t\t\ttextHtml +\r\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\r\n\t\t\t\t\t'</button>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Gets invoked after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tif (e.control === self && isChildOf(e.target, self.getEl())) {\r\n\t\t\t\t\tself.showMenu();\r\n\r\n\t\t\t\t\tif (e.aria) {\r\n\t\t\t\t\t\tself.menu.items()[0].focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.on('mouseenter', function(e) {\r\n\t\t\t\tvar overCtrl = e.control, parent = self.parent(), hasVisibleSiblingMenu;\r\n\r\n\t\t\t\tif (overCtrl && parent && overCtrl instanceof MenuButton && overCtrl.parent() == parent) {\r\n\t\t\t\t\tparent.items().filter('MenuButton').each(function(ctrl) {\r\n\t\t\t\t\t\tif (ctrl.hideMenu && ctrl != overCtrl) {\r\n\t\t\t\t\t\t\tif (ctrl.menu && ctrl.menu.visible()) {\r\n\t\t\t\t\t\t\t\thasVisibleSiblingMenu = true;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tctrl.hideMenu();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (hasVisibleSiblingMenu) {\r\n\t\t\t\t\t\toverCtrl.focus(); // Fix for: #5887\r\n\t\t\t\t\t\toverCtrl.showMenu();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:menu', function() {\r\n\t\t\t\tif (self.menu) {\r\n\t\t\t\t\tself.menu.remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.menu = null;\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the control and it's menus.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tthis._super();\r\n\r\n\t\t\tif (this.menu) {\r\n\t\t\t\tthis.menu.remove();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn MenuButton;\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/MenuItem.js\r\n\r\n/**\r\n * MenuItem.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new menu item.\r\n *\r\n * @-x-less MenuItem.less\r\n * @class tinymce.ui.MenuItem\r\n * @extends tinymce.ui.Control\r\n */\r\ndefine(\"tinymce/ui/MenuItem\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/ui/Factory\",\r\n\t\"tinymce/Env\",\r\n\t\"tinymce/util/Delay\"\r\n], function(Widget, Factory, Env, Delay) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\tDefaults: {\r\n\t\t\tborder: 0,\r\n\t\t\trole: 'menuitem'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Boolean} selectable Selectable menu.\r\n\t\t * @setting {Array} menu Submenu array with items.\r\n\t\t * @setting {String} shortcut Shortcut to display for menu item. Example: Ctrl+X\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this, text;\r\n\r\n\t\t\tself._super(settings);\r\n\r\n\t\t\tsettings = self.settings;\r\n\r\n\t\t\tself.classes.add('menu-item');\r\n\r\n\t\t\tif (settings.menu) {\r\n\t\t\t\tself.classes.add('menu-item-expand');\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.preview) {\r\n\t\t\t\tself.classes.add('menu-item-preview');\r\n\t\t\t}\r\n\r\n\t\t\ttext = self.state.get('text');\r\n\t\t\tif (text === '-' || text === '|') {\r\n\t\t\t\tself.classes.add('menu-item-sep');\r\n\t\t\t\tself.aria('role', 'separator');\r\n\t\t\t\tself.state.set('text', '-');\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.selectable) {\r\n\t\t\t\tself.aria('role', 'menuitemcheckbox');\r\n\t\t\t\tself.classes.add('menu-item-checkbox');\r\n\t\t\t\tsettings.icon = 'selected';\r\n\t\t\t}\r\n\r\n\t\t\tif (!settings.preview && !settings.selectable) {\r\n\t\t\t\tself.classes.add('menu-item-normal');\r\n\t\t\t}\r\n\r\n\t\t\tself.on('mousedown', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\r\n\t\t\tif (settings.menu && !settings.ariaHideMenu) {\r\n\t\t\t\tself.aria('haspopup', true);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns true/false if the menuitem has sub menu.\r\n\t\t *\r\n\t\t * @method hasMenus\r\n\t\t * @return {Boolean} True/false state if it has submenu.\r\n\t\t */\r\n\t\thasMenus: function() {\r\n\t\t\treturn !!this.settings.menu;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Shows the menu for the menu item.\r\n\t\t *\r\n\t\t * @method showMenu\r\n\t\t */\r\n\t\tshowMenu: function() {\r\n\t\t\tvar self = this, settings = self.settings, menu, parent = self.parent();\r\n\r\n\t\t\tparent.items().each(function(ctrl) {\r\n\t\t\t\tif (ctrl !== self) {\r\n\t\t\t\t\tctrl.hideMenu();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (settings.menu) {\r\n\t\t\t\tmenu = self.menu;\r\n\r\n\t\t\t\tif (!menu) {\r\n\t\t\t\t\tmenu = settings.menu;\r\n\r\n\t\t\t\t\t// Is menu array then auto constuct menu control\r\n\t\t\t\t\tif (menu.length) {\r\n\t\t\t\t\t\tmenu = {\r\n\t\t\t\t\t\t\ttype: 'menu',\r\n\t\t\t\t\t\t\titems: menu\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmenu.type = menu.type || 'menu';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (parent.settings.itemDefaults) {\r\n\t\t\t\t\t\tmenu.itemDefaults = parent.settings.itemDefaults;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmenu = self.menu = Factory.create(menu).parent(self).renderTo();\r\n\t\t\t\t\tmenu.reflow();\r\n\t\t\t\t\tmenu.on('cancel', function(e) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tself.focus();\r\n\t\t\t\t\t\tmenu.hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tmenu.on('show hide', function(e) {\r\n\t\t\t\t\t\te.control.items().each(function(ctrl) {\r\n\t\t\t\t\t\t\tctrl.active(ctrl.settings.selected);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).fire('show');\r\n\r\n\t\t\t\t\tmenu.on('hide', function(e) {\r\n\t\t\t\t\t\tif (e.control === menu) {\r\n\t\t\t\t\t\t\tself.classes.remove('selected');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tmenu.submenu = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmenu.show();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmenu._parentMenu = parent;\r\n\r\n\t\t\t\tmenu.classes.add('menu-sub');\r\n\r\n\t\t\t\tvar rel = menu.testMoveRel(\r\n\t\t\t\t\tself.getEl(),\r\n\t\t\t\t\tself.isRtl() ? ['tl-tr', 'bl-br', 'tr-tl', 'br-bl'] : ['tr-tl', 'br-bl', 'tl-tr', 'bl-br']\r\n\t\t\t\t);\r\n\r\n\t\t\t\tmenu.moveRel(self.getEl(), rel);\r\n\t\t\t\tmenu.rel = rel;\r\n\r\n\t\t\t\trel = 'menu-sub-' + rel;\r\n\t\t\t\tmenu.classes.remove(menu._lastRel).add(rel);\r\n\t\t\t\tmenu._lastRel = rel;\r\n\r\n\t\t\t\tself.classes.add('selected');\r\n\t\t\t\tself.aria('expanded', true);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides the menu for the menu item.\r\n\t\t *\r\n\t\t * @method hideMenu\r\n\t\t */\r\n\t\thideMenu: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.menu) {\r\n\t\t\t\tself.menu.items().each(function(item) {\r\n\t\t\t\t\tif (item.hideMenu) {\r\n\t\t\t\t\t\titem.hideMenu();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.menu.hide();\r\n\t\t\t\tself.aria('expanded', false);\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix, text = self.encode(self.state.get('text'));\r\n\t\t\tvar icon = self.settings.icon, image = '', shortcut = settings.shortcut;\r\n\r\n\t\t\t// Converts shortcut format to Mac/PC variants\r\n\t\t\tfunction convertShortcut(shortcut) {\r\n\t\t\t\tvar i, value, replace = {};\r\n\r\n\t\t\t\tif (Env.mac) {\r\n\t\t\t\t\treplace = {\r\n\t\t\t\t\t\talt: '&#x2325;',\r\n\t\t\t\t\t\tctrl: '&#x2318;',\r\n\t\t\t\t\t\tshift: '&#x21E7;',\r\n\t\t\t\t\t\tmeta: '&#x2318;'\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\treplace = {\r\n\t\t\t\t\t\tmeta: 'Ctrl'\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tshortcut = shortcut.split('+');\r\n\r\n\t\t\t\tfor (i = 0; i < shortcut.length; i++) {\r\n\t\t\t\t\tvalue = replace[shortcut[i].toLowerCase()];\r\n\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tshortcut[i] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn shortcut.join('+');\r\n\t\t\t}\r\n\r\n\t\t\tif (icon) {\r\n\t\t\t\tself.parent().classes.add('menu-has-icons');\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.image) {\r\n\t\t\t\timage = ' style=\"background-image: url(\\'' + settings.image + '\\')\"';\r\n\t\t\t}\r\n\r\n\t\t\tif (shortcut) {\r\n\t\t\t\tshortcut = convertShortcut(shortcut);\r\n\t\t\t}\r\n\r\n\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + (self.settings.icon || 'none');\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\">' +\r\n\t\t\t\t\t(text !== '-' ? '<i class=\"' + icon + '\"' + image + '></i>\\u00a0' : '') +\r\n\t\t\t\t\t(text !== '-' ? '<span id=\"' + id + '-text\" class=\"' + prefix + 'text\">' + text + '</span>' : '') +\r\n\t\t\t\t\t(shortcut ? '<div id=\"' + id + '-shortcut\" class=\"' + prefix + 'menu-shortcut\">' + shortcut + '</div>' : '') +\r\n\t\t\t\t\t(settings.menu ? '<div class=\"' + prefix + 'caret\"></div>' : '') +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Gets invoked after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, settings = self.settings;\r\n\r\n\t\t\tvar textStyle = settings.textStyle;\r\n\t\t\tif (typeof textStyle == \"function\") {\r\n\t\t\t\ttextStyle = textStyle.call(this);\r\n\t\t\t}\r\n\r\n\t\t\tif (textStyle) {\r\n\t\t\t\tvar textElm = self.getEl('text');\r\n\t\t\t\tif (textElm) {\r\n\t\t\t\t\ttextElm.setAttribute('style', textStyle);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.on('mouseenter click', function(e) {\r\n\t\t\t\tif (e.control === self) {\r\n\t\t\t\t\tif (!settings.menu && e.type === 'click') {\r\n\t\t\t\t\t\tself.fire('select');\r\n\r\n\t\t\t\t\t\t// Edge will crash if you stress it see #2660\r\n\t\t\t\t\t\tDelay.requestAnimationFrame(function() {\r\n\t\t\t\t\t\t\tself.parent().hideAll();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.showMenu();\r\n\r\n\t\t\t\t\t\tif (e.aria) {\r\n\t\t\t\t\t\t\tself.menu.focus(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\thover: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.parent().items().each(function(ctrl) {\r\n\t\t\t\tctrl.classes.remove('selected');\r\n\t\t\t});\r\n\r\n\t\t\tself.classes.toggle('selected', true);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tactive: function(state) {\r\n\t\t\tif (typeof state != \"undefined\") {\r\n\t\t\t\tthis.aria('checked', state);\r\n\t\t\t}\r\n\r\n\t\t\treturn this._super(state);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removes the control and it's menus.\r\n\t\t *\r\n\t\t * @method remove\r\n\t\t */\r\n\t\tremove: function() {\r\n\t\t\tthis._super();\r\n\r\n\t\t\tif (this.menu) {\r\n\t\t\t\tthis.menu.remove();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Throbber.js\r\n\r\n/**\r\n * Throbber.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This class enables you to display a Throbber for any element.\r\n *\r\n * @-x-less Throbber.less\r\n * @class tinymce.ui.Throbber\r\n */\r\ndefine(\"tinymce/ui/Throbber\", [\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/ui/Control\",\r\n\t\"tinymce/util/Delay\"\r\n], function($, Control, Delay) {\r\n\t\"use strict\";\r\n\r\n\t/**\r\n\t * Constructs a new throbber.\r\n\t *\r\n\t * @constructor\r\n\t * @param {Element} elm DOM Html element to display throbber in.\r\n\t * @param {Boolean} inline Optional true/false state if the throbber should be appended to end of element for infinite scroll.\r\n\t */\r\n\treturn function(elm, inline) {\r\n\t\tvar self = this, state, classPrefix = Control.classPrefix, timer;\r\n\r\n\t\t/**\r\n\t\t * Shows the throbber.\r\n\t\t *\r\n\t\t * @method show\r\n\t\t * @param {Number} [time] Time to wait before showing.\r\n\t\t * @param {function} [callback] Optional callback to execute when the throbber is shown.\r\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\r\n\t\t */\r\n\t\tself.show = function(time, callback) {\r\n\t\t\tfunction render() {\r\n\t\t\t\t\tif (state) {\r\n\t\t\t\t\t\t$(elm).append(\r\n\t\t\t\t\t\t\t'<div class=\"' + classPrefix + 'throbber' + (inline ? ' ' + classPrefix + 'throbber-inline' : '') + '\"></div>'\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.hide();\r\n\r\n\t\t\tstate = true;\r\n\r\n\t\t\tif (time) {\r\n\t\t\t\ttimer = Delay.setTimeout(render, time);\r\n\t\t\t} else {\r\n\t\t\t\trender();\r\n\t\t\t}\r\n\r\n\t\t\treturn self;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Hides the throbber.\r\n\t\t *\r\n\t\t * @method hide\r\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\r\n\t\t */\r\n\t\tself.hide = function() {\r\n\t\t\tvar child = elm.lastChild;\r\n\r\n\t\t\tDelay.clearTimeout(timer);\r\n\r\n\t\t\tif (child && child.className.indexOf('throbber') != -1) {\r\n\t\t\t\tchild.parentNode.removeChild(child);\r\n\t\t\t}\r\n\r\n\t\t\tstate = false;\r\n\r\n\t\t\treturn self;\r\n\t\t};\r\n\t};\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Menu.js\r\n\r\n/**\r\n * Menu.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new menu.\r\n *\r\n * @-x-less Menu.less\r\n * @class tinymce.ui.Menu\r\n * @extends tinymce.ui.FloatPanel\r\n */\r\ndefine(\"tinymce/ui/Menu\", [\r\n\t\"tinymce/ui/FloatPanel\",\r\n\t\"tinymce/ui/MenuItem\",\r\n\t\"tinymce/ui/Throbber\",\r\n\t\"tinymce/util/Tools\"\r\n], function(FloatPanel, MenuItem, Throbber, Tools) {\r\n\t\"use strict\";\r\n\r\n\treturn FloatPanel.extend({\r\n\t\tDefaults: {\r\n\t\t\tdefaultType: 'menuitem',\r\n\t\t\tborder: 1,\r\n\t\t\tlayout: 'stack',\r\n\t\t\trole: 'application',\r\n\t\t\tbodyRole: 'menu',\r\n\t\t\tariaRoot: true\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tsettings.autohide = true;\r\n\t\t\tsettings.constrainToViewport = true;\r\n\r\n\t\t\tif (typeof settings.items === 'function') {\r\n\t\t\t\tsettings.itemsFactory = settings.items;\r\n\t\t\t\tsettings.items = [];\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.itemDefaults) {\r\n\t\t\t\tvar items = settings.items, i = items.length;\r\n\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\titems[i] = Tools.extend({}, settings.itemDefaults, items[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself.classes.add('menu');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tthis.classes.toggle('menu-align', true);\r\n\r\n\t\t\tthis._super();\r\n\r\n\t\t\tthis.getEl().style.height = '';\r\n\t\t\tthis.getEl('body').style.height = '';\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hides/closes the menu.\r\n\t\t *\r\n\t\t * @method cancel\r\n\t\t */\r\n\t\tcancel: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.hideAll();\r\n\t\t\tself.fire('select');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Loads new items from the factory items function.\r\n\t\t *\r\n\t\t * @method load\r\n\t\t */\r\n\t\tload: function() {\r\n\t\t\tvar self = this, time, factory;\r\n\r\n\t\t\tfunction hideThrobber() {\r\n\t\t\t\tif (self.throbber) {\r\n\t\t\t\t\tself.throbber.hide();\r\n\t\t\t\t\tself.throbber = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfactory = self.settings.itemsFactory;\r\n\t\t\tif (!factory) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!self.throbber) {\r\n\t\t\t\tself.throbber = new Throbber(self.getEl('body'), true);\r\n\r\n\t\t\t\tif (self.items().length === 0) {\r\n\t\t\t\t\tself.throbber.show();\r\n\t\t\t\t\tself.fire('loading');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.throbber.show(100, function() {\r\n\t\t\t\t\t\tself.items().remove();\r\n\t\t\t\t\t\tself.fire('loading');\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.on('hide close', hideThrobber);\r\n\t\t\t}\r\n\r\n\t\t\tself.requestTime = time = new Date().getTime();\r\n\r\n\t\t\tself.settings.itemsFactory(function(items) {\r\n\t\t\t\tif (items.length === 0) {\r\n\t\t\t\t\tself.hide();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.requestTime !== time) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.getEl().style.width = '';\r\n\t\t\t\tself.getEl('body').style.width = '';\r\n\r\n\t\t\t\thideThrobber();\r\n\t\t\t\tself.items().remove();\r\n\t\t\t\tself.getEl('body').innerHTML = '';\r\n\r\n\t\t\t\tself.add(items);\r\n\t\t\t\tself.renderNew();\r\n\t\t\t\tself.fire('loaded');\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hide menu and all sub menus.\r\n\t\t *\r\n\t\t * @method hideAll\r\n\t\t */\r\n\t\thideAll: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.find('menuitem').exec('hideMenu');\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Invoked before the menu is rendered.\r\n\t\t *\r\n\t\t * @method preRender\r\n\t\t */\r\n\t\tpreRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.items().each(function(ctrl) {\r\n\t\t\t\tvar settings = ctrl.settings;\r\n\r\n\t\t\t\tif (settings.icon || settings.image || settings.selectable) {\r\n\t\t\t\t\tself._hasIcons = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (self.settings.itemsFactory) {\r\n\t\t\t\tself.on('postrender', function() {\r\n\t\t\t\t\tif (self.settings.itemsFactory) {\r\n\t\t\t\t\t\tself.load();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ListBox.js\r\n\r\n/**\r\n * ListBox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new list box control.\r\n *\r\n * @-x-less ListBox.less\r\n * @class tinymce.ui.ListBox\r\n * @extends tinymce.ui.MenuButton\r\n */\r\ndefine(\"tinymce/ui/ListBox\", [\r\n\t\"tinymce/ui/MenuButton\",\r\n\t\"tinymce/ui/Menu\"\r\n], function(MenuButton, Menu) {\r\n\t\"use strict\";\r\n\r\n\treturn MenuButton.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Array} values Array with values to add to list box.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this, values, selected, selectedText, lastItemCtrl;\r\n\r\n\t\t\tfunction setSelected(menuValues) {\r\n\t\t\t\t// Try to find a selected value\r\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\r\n\t\t\t\t\tselected = menuValues[i].selected || settings.value === menuValues[i].value;\r\n\r\n\t\t\t\t\tif (selected) {\r\n\t\t\t\t\t\tselectedText = selectedText || menuValues[i].text;\r\n\t\t\t\t\t\tself.state.set('value', menuValues[i].value);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the value has a submenu, try to find the selected values in that menu\r\n\t\t\t\t\tif (menuValues[i].menu) {\r\n\t\t\t\t\t\tif (setSelected(menuValues[i].menu)) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tsettings = self.settings;\r\n\r\n\t\t\tself._values = values = settings.values;\r\n\t\t\tif (values) {\r\n\t\t\t\tif (typeof settings.value != \"undefined\") {\r\n\t\t\t\t\tsetSelected(values);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Default with first item\r\n\t\t\t\tif (!selected && values.length > 0) {\r\n\t\t\t\t\tselectedText = values[0].text;\r\n\t\t\t\t\tself.state.set('value', values[0].value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.state.set('menu', values);\r\n\t\t\t}\r\n\r\n\t\t\tself.state.set('text', settings.text || selectedText);\r\n\r\n\t\t\tself.classes.add('listbox');\r\n\r\n\t\t\tself.on('select', function(e) {\r\n\t\t\t\tvar ctrl = e.control;\r\n\r\n\t\t\t\tif (lastItemCtrl) {\r\n\t\t\t\t\te.lastControl = lastItemCtrl;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.multiple) {\r\n\t\t\t\t\tctrl.active(!ctrl.active());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.value(e.control.value());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastItemCtrl = ctrl;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Getter/setter function for the control value.\r\n\t\t *\r\n\t\t * @method value\r\n\t\t * @param {String} [value] Value to be set.\r\n\t\t * @return {Boolean/tinymce.ui.ListBox} Value or self if it's a set operation.\r\n\t\t */\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tfunction activateMenuItemsByValue(menu, value) {\r\n\t\t\t\tif (menu instanceof Menu) {\r\n\t\t\t\t\tmenu.items().each(function(ctrl) {\r\n\t\t\t\t\t\tif (!ctrl.hasMenus()) {\r\n\t\t\t\t\t\t\tctrl.active(ctrl.value() === value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction getSelectedItem(menuValues, value) {\r\n\t\t\t\tvar selectedItem;\r\n\r\n\t\t\t\tif (!menuValues) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\r\n\t\t\t\t\tif (menuValues[i].value === value) {\r\n\t\t\t\t\t\treturn menuValues[i];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (menuValues[i].menu) {\r\n\t\t\t\t\t\tselectedItem = getSelectedItem(menuValues[i].menu, value);\r\n\t\t\t\t\t\tif (selectedItem) {\r\n\t\t\t\t\t\t\treturn selectedItem;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.on('show', function(e) {\r\n\t\t\t\tactivateMenuItemsByValue(e.control, self.value());\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:value', function(e) {\r\n\t\t\t\tvar selectedItem = getSelectedItem(self.state.get('menu'), e.value);\r\n\r\n\t\t\t\tif (selectedItem) {\r\n\t\t\t\t\tself.text(selectedItem.text);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.text(self.settings.text);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Radio.js\r\n\r\n/**\r\n * Radio.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new radio button.\r\n *\r\n * @-x-less Radio.less\r\n * @class tinymce.ui.Radio\r\n * @extends tinymce.ui.Checkbox\r\n */\r\ndefine(\"tinymce/ui/Radio\", [\r\n\t\"tinymce/ui/Checkbox\"\r\n], function(Checkbox) {\r\n\t\"use strict\";\r\n\r\n\treturn Checkbox.extend({\r\n\t\tDefaults: {\r\n\t\t\tclasses: \"radio\",\r\n\t\t\trole: \"radio\"\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/ResizeHandle.js\r\n\r\n/**\r\n * ResizeHandle.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Renders a resize handle that fires ResizeStart, Resize and ResizeEnd events.\r\n *\r\n * @-x-less ResizeHandle.less\r\n * @class tinymce.ui.ResizeHandle\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/ResizeHandle\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/ui/DragHelper\"\r\n], function(Widget, DragHelper) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, prefix = self.classPrefix;\r\n\r\n\t\t\tself.classes.add('resizehandle');\r\n\r\n\t\t\tif (self.settings.direction == \"both\") {\r\n\t\t\t\tself.classes.add('resizehandle-both');\r\n\t\t\t}\r\n\r\n\t\t\tself.canFocus = false;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-resize\"></i>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tself.resizeDragHelper = new DragHelper(this._id, {\r\n\t\t\t\tstart: function() {\r\n\t\t\t\t\tself.fire('ResizeStart');\r\n\t\t\t\t},\r\n\r\n\t\t\t\tdrag: function(e) {\r\n\t\t\t\t\tif (self.settings.direction != \"both\") {\r\n\t\t\t\t\t\te.deltaX = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.fire('Resize', e);\r\n\t\t\t\t},\r\n\r\n\t\t\t\tstop: function() {\r\n\t\t\t\t\tself.fire('ResizeEnd');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tremove: function() {\r\n\t\t\tif (this.resizeDragHelper) {\r\n\t\t\t\tthis.resizeDragHelper.destroy();\r\n\t\t\t}\r\n\r\n\t\t\treturn this._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/SelectBox.js\r\n\r\n/**\r\n * SelectBox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new select box control.\r\n *\r\n * @-x-less SelectBox.less\r\n * @class tinymce.ui.SelectBox\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/SelectBox\", [\r\n\t\"tinymce/ui/Widget\"\r\n], function(Widget) {\r\n\t\"use strict\";\r\n\r\n\tfunction createOptions(options) {\r\n\t\tvar strOptions = '';\r\n\t\tif (options) {\r\n\t\t\tfor (var i = 0; i < options.length; i++) {\r\n\t\t\t\tstrOptions += '<option value=\"' + options[i] + '\">' + options[i] + '</option>';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn strOptions;\r\n\t}\r\n\r\n\treturn Widget.extend({\r\n\t\tDefaults: {\r\n\t\t\tclasses: \"selectbox\",\r\n\t\t\trole: \"selectbox\",\r\n\t\t\toptions: []\r\n\t\t},\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Array} values Array with values to add to list box.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\r\n\t\t\tif (self.settings.size) {\r\n\t\t\t\tself.size = self.settings.size;\r\n\t\t\t}\r\n\r\n\t\t\tif (self.settings.options) {\r\n\t\t\t\tself._options = self.settings.options;\r\n\t\t\t}\r\n\r\n\t\t\tself.on('keydown', function(e) {\r\n\t\t\t\tvar rootControl;\r\n\r\n\t\t\t\tif (e.keyCode == 13) {\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t// Find root control that we can do toJSON on\r\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\r\n\t\t\t\t\t\tif (ctrl.toJSON) {\r\n\t\t\t\t\t\t\trootControl = ctrl;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\r\n\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Getter/setter function for the options state.\r\n\t\t *\r\n\t\t * @method options\r\n\t\t * @param {Array} [state] State to be set.\r\n\t\t * @return {Array|tinymce.ui.SelectBox} Array of string options.\r\n\t\t */\r\n\t\toptions: function(state) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn this.state.get('options');\r\n\t\t\t}\r\n\r\n\t\t\tthis.state.set('options', state);\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, options, size = '';\r\n\r\n\t\t\toptions = createOptions(self._options);\r\n\r\n\t\t\tif (self.size) {\r\n\t\t\t\tsize = ' size = \"' + self.size + '\"';\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<select id=\"' + self._id + '\" class=\"' + self.classes + '\"' + size + '>' +\r\n\t\t\t\t\toptions +\r\n\t\t\t\t'</select>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:options', function(e) {\r\n\t\t\t\tself.getEl().innerHTML = createOptions(e.value);\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Slider.js\r\n\r\n/**\r\n * Slider.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Slider control.\r\n *\r\n * @-x-less Slider.less\r\n * @class tinymce.ui.Slider\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/Slider\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/ui/DragHelper\",\r\n\t\"tinymce/ui/DomUtils\"\r\n], function(Widget, DragHelper, DomUtils) {\r\n\t\"use strict\";\r\n\r\n\tfunction constrain(value, minVal, maxVal) {\r\n\t\tif (value < minVal) {\r\n\t\t\tvalue = minVal;\r\n\t\t}\r\n\r\n\t\tif (value > maxVal) {\r\n\t\t\tvalue = maxVal;\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tfunction setAriaProp(el, name, value) {\r\n\t\tel.setAttribute('aria-' + name, value);\r\n\t}\r\n\r\n\tfunction updateSliderHandle(ctrl, value) {\r\n\t\tvar maxHandlePos, shortSizeName, sizeName, stylePosName, styleValue, handleEl;\r\n\r\n\t\tif (ctrl.settings.orientation == \"v\") {\r\n\t\t\tstylePosName = \"top\";\r\n\t\t\tsizeName = \"height\";\r\n\t\t\tshortSizeName = \"h\";\r\n\t\t} else {\r\n\t\t\tstylePosName = \"left\";\r\n\t\t\tsizeName = \"width\";\r\n\t\t\tshortSizeName = \"w\";\r\n\t\t}\r\n\r\n\t\thandleEl = ctrl.getEl('handle');\r\n\t\tmaxHandlePos = (ctrl.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\r\n\r\n\t\tstyleValue = (maxHandlePos * ((value - ctrl._minValue) / (ctrl._maxValue - ctrl._minValue))) + 'px';\r\n\t\thandleEl.style[stylePosName] = styleValue;\r\n\t\thandleEl.style.height = ctrl.layoutRect().h + 'px';\r\n\r\n\t\tsetAriaProp(handleEl, 'valuenow', value);\r\n\t\tsetAriaProp(handleEl, 'valuetext', '' + ctrl.settings.previewFilter(value));\r\n\t\tsetAriaProp(handleEl, 'valuemin', ctrl._minValue);\r\n\t\tsetAriaProp(handleEl, 'valuemax', ctrl._maxValue);\r\n\t}\r\n\r\n\treturn Widget.extend({\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!settings.previewFilter) {\r\n\t\t\t\tsettings.previewFilter = function(value) {\r\n\t\t\t\t\treturn Math.round(value * 100) / 100.0;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tself._super(settings);\r\n\t\t\tself.classes.add('slider');\r\n\r\n\t\t\tif (settings.orientation == \"v\") {\r\n\t\t\t\tself.classes.add('vertical');\r\n\t\t\t}\r\n\r\n\t\t\tself._minValue = settings.minValue || 0;\r\n\t\t\tself._maxValue = settings.maxValue || 100;\r\n\t\t\tself._initValue = self.state.get('value');\r\n\t\t},\r\n\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\r\n\t\t\t\t\t'<div id=\"' + id + '-handle\" class=\"' + prefix + 'slider-handle\" role=\"slider\" tabindex=\"-1\"></div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\treset: function() {\r\n\t\t\tthis.value(this._initValue).repaint();\r\n\t\t},\r\n\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, minValue, maxValue, screenCordName,\r\n\t\t\t\t\tstylePosName, sizeName, shortSizeName;\r\n\r\n\t\t\tfunction toFraction(min, max, val) {\r\n\t\t\t\treturn (val + min) / (max - min);\r\n\t\t\t}\r\n\r\n\t\t\tfunction fromFraction(min, max, val) {\r\n\t\t\t\treturn (val * (max - min)) - min;\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleKeyboard(minValue, maxValue) {\r\n\t\t\t\tfunction alter(delta) {\r\n\t\t\t\t\tvar value;\r\n\r\n\t\t\t\t\tvalue = self.value();\r\n\t\t\t\t\tvalue = fromFraction(minValue, maxValue, toFraction(minValue, maxValue, value) + (delta * 0.05));\r\n\t\t\t\t\tvalue = constrain(value, minValue, maxValue);\r\n\r\n\t\t\t\t\tself.value(value);\r\n\r\n\t\t\t\t\tself.fire('dragstart', {value: value});\r\n\t\t\t\t\tself.fire('drag', {value: value});\r\n\t\t\t\t\tself.fire('dragend', {value: value});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.on('keydown', function(e) {\r\n\t\t\t\t\tswitch (e.keyCode) {\r\n\t\t\t\t\t\tcase 37:\r\n\t\t\t\t\t\tcase 38:\r\n\t\t\t\t\t\t\talter(-1);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 39:\r\n\t\t\t\t\t\tcase 40:\r\n\t\t\t\t\t\t\talter(1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleDrag(minValue, maxValue, handleEl) {\r\n\t\t\t\tvar startPos, startHandlePos, maxHandlePos, handlePos, value;\r\n\r\n\t\t\t\tself._dragHelper = new DragHelper(self._id, {\r\n\t\t\t\t\thandle: self._id + \"-handle\",\r\n\r\n\t\t\t\t\tstart: function(e) {\r\n\t\t\t\t\t\tstartPos = e[screenCordName];\r\n\t\t\t\t\t\tstartHandlePos = parseInt(self.getEl('handle').style[stylePosName], 10);\r\n\t\t\t\t\t\tmaxHandlePos = (self.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\r\n\t\t\t\t\t\tself.fire('dragstart', {value: value});\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tdrag: function(e) {\r\n\t\t\t\t\t\tvar delta = e[screenCordName] - startPos;\r\n\r\n\t\t\t\t\t\thandlePos = constrain(startHandlePos + delta, 0, maxHandlePos);\r\n\t\t\t\t\t\thandleEl.style[stylePosName] = handlePos + 'px';\r\n\r\n\t\t\t\t\t\tvalue = minValue + (handlePos / maxHandlePos) * (maxValue - minValue);\r\n\t\t\t\t\t\tself.value(value);\r\n\r\n\t\t\t\t\t\tself.tooltip().text('' + self.settings.previewFilter(value)).show().moveRel(handleEl, 'bc tc');\r\n\r\n\t\t\t\t\t\tself.fire('drag', {value: value});\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tstop: function() {\r\n\t\t\t\t\t\tself.tooltip().hide();\r\n\t\t\t\t\t\tself.fire('dragend', {value: value});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tminValue = self._minValue;\r\n\t\t\tmaxValue = self._maxValue;\r\n\r\n\t\t\tif (self.settings.orientation == \"v\") {\r\n\t\t\t\tscreenCordName = \"screenY\";\r\n\t\t\t\tstylePosName = \"top\";\r\n\t\t\t\tsizeName = \"height\";\r\n\t\t\t\tshortSizeName = \"h\";\r\n\t\t\t} else {\r\n\t\t\t\tscreenCordName = \"screenX\";\r\n\t\t\t\tstylePosName = \"left\";\r\n\t\t\t\tsizeName = \"width\";\r\n\t\t\t\tshortSizeName = \"w\";\r\n\t\t\t}\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\thandleKeyboard(minValue, maxValue, self.getEl('handle'));\r\n\t\t\thandleDrag(minValue, maxValue, self.getEl('handle'));\r\n\t\t},\r\n\r\n\t\trepaint: function() {\r\n\t\t\tthis._super();\r\n\t\t\tupdateSliderHandle(this, this.value());\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:value', function(e) {\r\n\t\t\t\tupdateSliderHandle(self, e.value);\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/Spacer.js\r\n\r\n/**\r\n * Spacer.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a spacer. This control is used in flex layouts for example.\r\n *\r\n * @-x-less Spacer.less\r\n * @class tinymce.ui.Spacer\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/Spacer\", [\r\n\t\"tinymce/ui/Widget\"\r\n], function(Widget) {\r\n\t\"use strict\";\r\n\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.classes.add('spacer');\r\n\t\t\tself.canFocus = false;\r\n\r\n\t\t\treturn '<div id=\"' + self._id + '\" class=\"' + self.classes + '\"></div>';\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/SplitButton.js\r\n\r\n/**\r\n * SplitButton.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a split button.\r\n *\r\n * @-x-less SplitButton.less\r\n * @class tinymce.ui.SplitButton\r\n * @extends tinymce.ui.Button\r\n */\r\ndefine(\"tinymce/ui/SplitButton\", [\r\n\t\"tinymce/ui/MenuButton\",\r\n\t\"tinymce/ui/DomUtils\",\r\n\t\"tinymce/dom/DomQuery\"\r\n], function(MenuButton, DomUtils, $) {\r\n\treturn MenuButton.extend({\r\n\t\tDefaults: {\r\n\t\t\tclasses: \"widget btn splitbtn\",\r\n\t\t\trole: \"button\"\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar self = this, elm = self.getEl(), rect = self.layoutRect(), mainButtonElm, menuButtonElm;\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tmainButtonElm = elm.firstChild;\r\n\t\t\tmenuButtonElm = elm.lastChild;\r\n\r\n\t\t\t$(mainButtonElm).css({\r\n\t\t\t\twidth: rect.w - DomUtils.getSize(menuButtonElm).width,\r\n\t\t\t\theight: rect.h - 2\r\n\t\t\t});\r\n\r\n\t\t\t$(menuButtonElm).css({\r\n\t\t\t\theight: rect.h - 2\r\n\t\t\t});\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sets the active menu state.\r\n\t\t *\r\n\t\t * @private\r\n\t\t */\r\n\t\tactiveMenu: function(state) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t$(self.getEl().lastChild).toggleClass(self.classPrefix + 'active', state);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, image;\r\n\t\t\tvar icon = self.state.get('icon'), text = self.state.get('text'),\r\n\t\t\t\ttextHtml = '';\r\n\r\n\t\t\timage = self.settings.image;\r\n\t\t\tif (image) {\r\n\t\t\t\ticon = 'none';\r\n\r\n\t\t\t\t// Support for [high dpi, low dpi] image sources\r\n\t\t\t\tif (typeof image != \"string\") {\r\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\r\n\t\t\t} else {\r\n\t\t\t\timage = '';\r\n\t\t\t}\r\n\r\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\r\n\r\n\t\t\tif (text) {\r\n\t\t\t\tself.classes.add('btn-has-text');\r\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\r\n\t\t\t}\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\">' +\r\n\t\t\t\t\t'<button type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\r\n\t\t\t\t\t\ttextHtml +\r\n\t\t\t\t\t'</button>' +\r\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\r\n\t\t\t\t\t\t//(icon ? '<i class=\"' + icon + '\"></i>' : '') +\r\n\t\t\t\t\t\t(self._menuBtnText ? (icon ? '\\u00a0' : '') + self._menuBtnText : '') +\r\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\r\n\t\t\t\t\t'</button>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\r\n\r\n\t\t\tself.on('click', function(e) {\r\n\t\t\t\tvar node = e.target;\r\n\r\n\t\t\t\tif (e.control == this) {\r\n\t\t\t\t\t// Find clicks that is on the main button\r\n\t\t\t\t\twhile (node) {\r\n\t\t\t\t\t\tif ((e.aria && e.aria.key != 'down') || (node.nodeName == 'BUTTON' && node.className.indexOf('open') == -1)) {\r\n\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t\t\t\t\tif (onClickHandler) {\r\n\t\t\t\t\t\t\t\tonClickHandler.call(this, e);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tdelete self.settings.onclick;\r\n\r\n\t\t\treturn self._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/StackLayout.js\r\n\r\n/**\r\n * StackLayout.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This layout uses the browsers layout when the items are blocks.\r\n *\r\n * @-x-less StackLayout.less\r\n * @class tinymce.ui.StackLayout\r\n * @extends tinymce.ui.FlowLayout\r\n */\r\ndefine(\"tinymce/ui/StackLayout\", [\r\n\t\"tinymce/ui/FlowLayout\"\r\n], function(FlowLayout) {\r\n\t\"use strict\";\r\n\r\n\treturn FlowLayout.extend({\r\n\t\tDefaults: {\r\n\t\t\tcontainerClass: 'stack-layout',\r\n\t\t\tcontrolClass: 'stack-layout-item',\r\n\t\t\tendClass: 'break'\r\n\t\t},\r\n\r\n\t\tisNative: function() {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/TabPanel.js\r\n\r\n/**\r\n * TabPanel.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a tab panel control.\r\n *\r\n * @-x-less TabPanel.less\r\n * @class tinymce.ui.TabPanel\r\n * @extends tinymce.ui.Panel\r\n *\r\n * @setting {Number} activeTab Active tab index.\r\n */\r\ndefine(\"tinymce/ui/TabPanel\", [\r\n\t\"tinymce/ui/Panel\",\r\n\t\"tinymce/dom/DomQuery\",\r\n\t\"tinymce/ui/DomUtils\"\r\n], function(Panel, $, DomUtils) {\r\n\t\"use strict\";\r\n\r\n\treturn Panel.extend({\r\n\t\tDefaults: {\r\n\t\t\tlayout: 'absolute',\r\n\t\t\tdefaults: {\r\n\t\t\t\ttype: 'panel'\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Activates the specified tab by index.\r\n\t\t *\r\n\t\t * @method activateTab\r\n\t\t * @param {Number} idx Index of the tab to activate.\r\n\t\t */\r\n\t\tactivateTab: function(idx) {\r\n\t\t\tvar activeTabElm;\r\n\r\n\t\t\tif (this.activeTabId) {\r\n\t\t\t\tactiveTabElm = this.getEl(this.activeTabId);\r\n\t\t\t\t$(activeTabElm).removeClass(this.classPrefix + 'active');\r\n\t\t\t\tactiveTabElm.setAttribute('aria-selected', \"false\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.activeTabId = 't' + idx;\r\n\r\n\t\t\tactiveTabElm = this.getEl('t' + idx);\r\n\t\t\tactiveTabElm.setAttribute('aria-selected', \"true\");\r\n\t\t\t$(activeTabElm).addClass(this.classPrefix + 'active');\r\n\r\n\t\t\tthis.items()[idx].show().fire('showtab');\r\n\t\t\tthis.reflow();\r\n\r\n\t\t\tthis.items().each(function(item, i) {\r\n\t\t\t\tif (idx != i) {\r\n\t\t\t\t\titem.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, layout = self._layout, tabsHtml = '', prefix = self.classPrefix;\r\n\r\n\t\t\tself.preRender();\r\n\t\t\tlayout.preRender(self);\r\n\r\n\t\t\tself.items().each(function(ctrl, i) {\r\n\t\t\t\tvar id = self._id + '-t' + i;\r\n\r\n\t\t\t\tctrl.aria('role', 'tabpanel');\r\n\t\t\t\tctrl.aria('labelledby', id);\r\n\r\n\t\t\t\ttabsHtml += (\r\n\t\t\t\t\t'<div id=\"' + id + '\" class=\"' + prefix + 'tab\" ' +\r\n\t\t\t\t\t\t'unselectable=\"on\" role=\"tab\" aria-controls=\"' + ctrl._id + '\" aria-selected=\"false\" tabIndex=\"-1\">' +\r\n\t\t\t\t\t\tself.encode(ctrl.settings.title) +\r\n\t\t\t\t\t'</div>'\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\treturn (\r\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\r\n\t\t\t\t\t'<div id=\"' + self._id + '-head\" class=\"' + prefix + 'tabs\" role=\"tablist\">' +\r\n\t\t\t\t\t\ttabsHtml +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\r\n\t\t\t\t\t\tlayout.renderHtml(self) +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super();\r\n\r\n\t\t\tself.settings.activeTab = self.settings.activeTab || 0;\r\n\t\t\tself.activateTab(self.settings.activeTab);\r\n\r\n\t\t\tthis.on('click', function(e) {\r\n\t\t\t\tvar targetParent = e.target.parentNode;\r\n\r\n\t\t\t\tif (e.target.parentNode.id == self._id + '-head') {\r\n\t\t\t\t\tvar i = targetParent.childNodes.length;\r\n\r\n\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\tif (targetParent.childNodes[i] == e.target) {\r\n\t\t\t\t\t\t\tself.activateTab(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Initializes the current controls layout rect.\r\n\t\t * This will be executed by the layout managers to determine the\r\n\t\t * default minWidth/minHeight etc.\r\n\t\t *\r\n\t\t * @method initLayoutRect\r\n\t\t * @return {Object} Layout rect instance.\r\n\t\t */\r\n\t\tinitLayoutRect: function() {\r\n\t\t\tvar self = this, rect, minW, minH;\r\n\r\n\t\t\tminW = DomUtils.getSize(self.getEl('head')).width;\r\n\t\t\tminW = minW < 0 ? 0 : minW;\r\n\t\t\tminH = 0;\r\n\r\n\t\t\tself.items().each(function(item) {\r\n\t\t\t\tminW = Math.max(minW, item.layoutRect().minW);\r\n\t\t\t\tminH = Math.max(minH, item.layoutRect().minH);\r\n\t\t\t});\r\n\r\n\t\t\tself.items().each(function(ctrl) {\r\n\t\t\t\tctrl.settings.x = 0;\r\n\t\t\t\tctrl.settings.y = 0;\r\n\t\t\t\tctrl.settings.w = minW;\r\n\t\t\t\tctrl.settings.h = minH;\r\n\r\n\t\t\t\tctrl.layoutRect({\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\tw: minW,\r\n\t\t\t\t\th: minH\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tvar headH = DomUtils.getSize(self.getEl('head')).height;\r\n\r\n\t\t\tself.settings.minWidth = minW;\r\n\t\t\tself.settings.minHeight = minH + headH;\r\n\r\n\t\t\trect = self._super();\r\n\t\t\trect.deltaH += headH;\r\n\t\t\trect.innerH = rect.h - rect.deltaH;\r\n\r\n\t\t\treturn rect;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/ui/TextBox.js\r\n\r\n/**\r\n * TextBox.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * Creates a new textbox.\r\n *\r\n * @-x-less TextBox.less\r\n * @class tinymce.ui.TextBox\r\n * @extends tinymce.ui.Widget\r\n */\r\ndefine(\"tinymce/ui/TextBox\", [\r\n\t\"tinymce/ui/Widget\",\r\n\t\"tinymce/util/Tools\",\r\n\t\"tinymce/ui/DomUtils\"\r\n], function(Widget, Tools, DomUtils) {\r\n\treturn Widget.extend({\r\n\t\t/**\r\n\t\t * Constructs a instance with the specified settings.\r\n\t\t *\r\n\t\t * @constructor\r\n\t\t * @param {Object} settings Name/value object with settings.\r\n\t\t * @setting {Boolean} multiline True if the textbox is a multiline control.\r\n\t\t * @setting {Number} maxLength Max length for the textbox.\r\n\t\t * @setting {Number} size Size of the textbox in characters.\r\n\t\t */\r\n\t\tinit: function(settings) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself._super(settings);\r\n\r\n\t\t\tself.classes.add('textbox');\r\n\r\n\t\t\tif (settings.multiline) {\r\n\t\t\t\tself.classes.add('multiline');\r\n\t\t\t} else {\r\n\t\t\t\tself.on('keydown', function(e) {\r\n\t\t\t\t\tvar rootControl;\r\n\r\n\t\t\t\t\tif (e.keyCode == 13) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t// Find root control that we can do toJSON on\r\n\t\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\r\n\t\t\t\t\t\t\tif (ctrl.toJSON) {\r\n\t\t\t\t\t\t\t\trootControl = ctrl;\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\r\n\t\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.on('keyup', function(e) {\r\n\t\t\t\t\tself.state.set('value', e.target.value);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Repaints the control after a layout operation.\r\n\t\t *\r\n\t\t * @method repaint\r\n\t\t */\r\n\t\trepaint: function() {\r\n\t\t\tvar self = this, style, rect, borderBox, borderW, borderH = 0, lastRepaintRect;\r\n\r\n\t\t\tstyle = self.getEl().style;\r\n\t\t\trect = self._layoutRect;\r\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\r\n\r\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\r\n\t\t\tvar doc = document;\r\n\t\t\tif (!self.settings.multiline && doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\r\n\t\t\t\tstyle.lineHeight = (rect.h - borderH) + 'px';\r\n\t\t\t}\r\n\r\n\t\t\tborderBox = self.borderBox;\r\n\t\t\tborderW = borderBox.left + borderBox.right + 8;\r\n\t\t\tborderH = borderBox.top + borderBox.bottom + (self.settings.multiline ? 8 : 0);\r\n\r\n\t\t\tif (rect.x !== lastRepaintRect.x) {\r\n\t\t\t\tstyle.left = rect.x + 'px';\r\n\t\t\t\tlastRepaintRect.x = rect.x;\r\n\t\t\t}\r\n\r\n\t\t\tif (rect.y !== lastRepaintRect.y) {\r\n\t\t\t\tstyle.top = rect.y + 'px';\r\n\t\t\t\tlastRepaintRect.y = rect.y;\r\n\t\t\t}\r\n\r\n\t\t\tif (rect.w !== lastRepaintRect.w) {\r\n\t\t\t\tstyle.width = (rect.w - borderW) + 'px';\r\n\t\t\t\tlastRepaintRect.w = rect.w;\r\n\t\t\t}\r\n\r\n\t\t\tif (rect.h !== lastRepaintRect.h) {\r\n\t\t\t\tstyle.height = (rect.h - borderH) + 'px';\r\n\t\t\t\tlastRepaintRect.h = rect.h;\r\n\t\t\t}\r\n\r\n\t\t\tself._lastRepaintRect = lastRepaintRect;\r\n\t\t\tself.fire('repaint', {}, false);\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Renders the control as a HTML string.\r\n\t\t *\r\n\t\t * @method renderHtml\r\n\t\t * @return {String} HTML representing the control.\r\n\t\t */\r\n\t\trenderHtml: function() {\r\n\t\t\tvar self = this, settings = self.settings, attrs, elm;\r\n\r\n\t\t\tattrs = {\r\n\t\t\t\tid: self._id,\r\n\t\t\t\thidefocus: '1'\r\n\t\t\t};\r\n\r\n\t\t\tTools.each([\r\n\t\t\t\t'rows',\t'spellcheck',\t'maxLength', 'size', 'readonly', 'min',\r\n\t\t\t\t'max', 'step', 'list', 'pattern', 'placeholder', 'required', 'multiple'\r\n\t\t\t], function(name) {\r\n\t\t\t\tattrs[name] = settings[name];\r\n\t\t\t});\r\n\r\n\t\t\tif (self.disabled()) {\r\n\t\t\t\tattrs.disabled = 'disabled';\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.subtype) {\r\n\t\t\t\tattrs.type = settings.subtype;\r\n\t\t\t}\r\n\r\n\t\t\telm = DomUtils.create(settings.multiline ? 'textarea' : 'input', attrs);\r\n\t\t\telm.value = self.state.get('value');\r\n\t\t\telm.className = self.classes;\r\n\r\n\t\t\treturn elm.outerHTML;\r\n\t\t},\r\n\r\n\t\tvalue: function(value) {\r\n\t\t\tif (arguments.length) {\r\n\t\t\t\tthis.state.set('value', value);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\t// Make sure the real state is in sync\r\n\t\t\tif (this.state.get('rendered')) {\r\n\t\t\t\tthis.state.set('value', this.getEl().value);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.state.get('value');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Called after the control has been rendered.\r\n\t\t *\r\n\t\t * @method postRender\r\n\t\t */\r\n\t\tpostRender: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.getEl().value = self.state.get('value');\r\n\t\t\tself._super();\r\n\r\n\t\t\tself.$el.on('change', function(e) {\r\n\t\t\t\tself.state.set('value', e.target.value);\r\n\t\t\t\tself.fire('change', e);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tbindStates: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tself.state.on('change:value', function(e) {\r\n\t\t\t\tif (self.getEl().value != e.value) {\r\n\t\t\t\t\tself.getEl().value = e.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.state.on('change:disabled', function(e) {\r\n\t\t\t\tself.getEl().disabled = e.value;\r\n\t\t\t});\r\n\r\n\t\t\treturn self._super();\r\n\t\t},\r\n\r\n\t\tremove: function() {\r\n\t\t\tthis.$el.off();\r\n\t\t\tthis._super();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Included from: js/tinymce/classes/Register.js\r\n\r\n/**\r\n * Register.js\r\n *\r\n * Released under LGPL License.\r\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\r\n *\r\n * License: http://www.tinymce.com/license\r\n * Contributing: http://www.tinymce.com/contributing\r\n */\r\n\r\n/**\r\n * This registers tinymce in common module loaders.\r\n *\r\n * @private\r\n * @class tinymce.Register\r\n */\r\ndefine(\"tinymce/Register\", [\r\n], function() {\r\n\t/*eslint consistent-this: 0 */\r\n\tvar context = this || window;\r\n\r\n\tvar tinymce = function() {\r\n\t\treturn context.tinymce;\r\n\t};\r\n\r\n\tif (typeof context.define === \"function\") {\r\n\t\t// Bolt\r\n\t\tif (!context.define.amd) {\r\n\t\t\tcontext.define(\"ephox/tinymce\", [], tinymce);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {};\r\n});\r\n\r\nexpose([\"tinymce/geom/Rect\",\"tinymce/util/Promise\",\"tinymce/util/Delay\",\"tinymce/Env\",\"tinymce/dom/EventUtils\",\"tinymce/dom/Sizzle\",\"tinymce/util/Tools\",\"tinymce/dom/DomQuery\",\"tinymce/html/Styles\",\"tinymce/dom/TreeWalker\",\"tinymce/html/Entities\",\"tinymce/dom/DOMUtils\",\"tinymce/dom/ScriptLoader\",\"tinymce/AddOnManager\",\"tinymce/dom/RangeUtils\",\"tinymce/html/Node\",\"tinymce/html/Schema\",\"tinymce/html/SaxParser\",\"tinymce/html/DomParser\",\"tinymce/html/Writer\",\"tinymce/html/Serializer\",\"tinymce/dom/Serializer\",\"tinymce/util/VK\",\"tinymce/dom/ControlSelection\",\"tinymce/dom/BookmarkManager\",\"tinymce/dom/Selection\",\"tinymce/Formatter\",\"tinymce/UndoManager\",\"tinymce/EditorCommands\",\"tinymce/util/URI\",\"tinymce/util/Class\",\"tinymce/util/EventDispatcher\",\"tinymce/util/Observable\",\"tinymce/ui/Selector\",\"tinymce/ui/Collection\",\"tinymce/ui/ReflowQueue\",\"tinymce/ui/Control\",\"tinymce/ui/Factory\",\"tinymce/ui/KeyboardNavigation\",\"tinymce/ui/Container\",\"tinymce/ui/DragHelper\",\"tinymce/ui/Scrollable\",\"tinymce/ui/Panel\",\"tinymce/ui/Movable\",\"tinymce/ui/Resizable\",\"tinymce/ui/FloatPanel\",\"tinymce/ui/Window\",\"tinymce/ui/MessageBox\",\"tinymce/WindowManager\",\"tinymce/ui/Tooltip\",\"tinymce/ui/Widget\",\"tinymce/ui/Progress\",\"tinymce/ui/Notification\",\"tinymce/NotificationManager\",\"tinymce/EditorObservable\",\"tinymce/Shortcuts\",\"tinymce/Editor\",\"tinymce/util/I18n\",\"tinymce/FocusManager\",\"tinymce/EditorManager\",\"tinymce/util/XHR\",\"tinymce/util/JSON\",\"tinymce/util/JSONRequest\",\"tinymce/util/JSONP\",\"tinymce/util/LocalStorage\",\"tinymce/Compat\",\"tinymce/ui/Layout\",\"tinymce/ui/AbsoluteLayout\",\"tinymce/ui/Button\",\"tinymce/ui/ButtonGroup\",\"tinymce/ui/Checkbox\",\"tinymce/ui/ComboBox\",\"tinymce/ui/ColorBox\",\"tinymce/ui/PanelButton\",\"tinymce/ui/ColorButton\",\"tinymce/util/Color\",\"tinymce/ui/ColorPicker\",\"tinymce/ui/Path\",\"tinymce/ui/ElementPath\",\"tinymce/ui/FormItem\",\"tinymce/ui/Form\",\"tinymce/ui/FieldSet\",\"tinymce/ui/FilePicker\",\"tinymce/ui/FitLayout\",\"tinymce/ui/FlexLayout\",\"tinymce/ui/FlowLayout\",\"tinymce/ui/FormatControls\",\"tinymce/ui/GridLayout\",\"tinymce/ui/Iframe\",\"tinymce/ui/InfoBox\",\"tinymce/ui/Label\",\"tinymce/ui/Toolbar\",\"tinymce/ui/MenuBar\",\"tinymce/ui/MenuButton\",\"tinymce/ui/MenuItem\",\"tinymce/ui/Throbber\",\"tinymce/ui/Menu\",\"tinymce/ui/ListBox\",\"tinymce/ui/Radio\",\"tinymce/ui/ResizeHandle\",\"tinymce/ui/SelectBox\",\"tinymce/ui/Slider\",\"tinymce/ui/Spacer\",\"tinymce/ui/SplitButton\",\"tinymce/ui/StackLayout\",\"tinymce/ui/TabPanel\",\"tinymce/ui/TextBox\"]);\r\n})(this);\r\n//# sourceMappingURL=pageedit.js.map\r\n"],"sourceRoot":"/source/"}